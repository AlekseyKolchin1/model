!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var i=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(e){var r=this;G.DEBUG_MODE=!0,G.DEBUG_SPARK_LOCAL=e,this.client.debugger=this,this.serverQueueInfo=document.getElementById("dev-panel-info-server-queue"),this.browserQueueInfo=document.getElementById("dev-panel-info-browser-queue"),this.parseTimeInfo=document.getElementById("dev-panel-info-parse-time"),this.shapeCountInfo=document.getElementById("dev-panel-info-shape-count"),this.cudCountInfo=document.getElementById("dev-panel-info-cud-count"),this.drawTimeInfo=document.getElementById("dev-panel-info-draw-time"),this.fpsInfo=document.getElementById("dev-panel-info-fps"),this.timeInfo=document.getElementById("dev-panel-info-time"),e&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return r.onNewModelSelected()}),t.elementcount=0},t.prototype.stop=function(){this.serverQueueInfo=void 0,this.browserQueueInfo=void 0,this.parseTimeInfo=void 0,this.shapeCountInfo=void 0,this.cudCountInfo=void 0,this.drawTimeInfo=void 0,this.fpsInfo=void 0,this.timeInfo=void 0,this.modelSelector&&(this.modelSelector.onchange=void 0,this.modelSelector=void 0),t.elementcount=0},t.prototype.onNewModelSelected=function(){var e=this;if(null!=this.client.svg&&this.client.stop("TERMINATED"),this.shapeCountInfo.innerHTML=t.elementcount,"NO MODEL SELECTED"!=this.modelSelector.value){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200===r.status&&e.client.start({})},r.open("GET","/http/start?path="+this.modelSelector.value,!0),r.send()}},t}(),n=function(){function t(){}return t.createSvgElement=function(e){return G.DEBUG_MODE&&i.elementcount++,document.createElementNS(t.svgns,e)},t.createXhtmlElement=function(e){return G.DEBUG_MODE&&i.elementcount++,document.createElementNS(t.xhtmlns,e)},t.createTextNode=function(t){return G.DEBUG_MODE&&i.elementcount++,document.createTextNode(t)},t.createUseElement=function(e){var r=t.createSvgElement("use"),i="#"+e;return r.setAttributeNS(t.xlinkns,"href",i),r},t.cloneElementWithId=function(e){var r=document.getElementById(e);return t.cloneElement(r)},t.cloneElement=function(e){var r=e.cloneNode(!0);return r.removeAttribute("id"),G.DEBUG_MODE&&(i.elementcount+=1+t.childNodeDeepCount(r)),r},t.removeElement=function(e,r){var n=document.getElementById("canvas-group");if(n)for(var a=n.children,o=a.length-1;o>=0;o--){var s=parseInt(a[o].id),l=document.getElementById(s.toString());(r==l||r.contains(l))&&n.removeChild(a[o])}G.DEBUG_MODE&&(i.elementcount-=1+t.childNodeDeepCount(r)),e.removeChild(r)},t.removeAllChildren=function(e){for(;e.lastChild;)t.removeElement(e,e.lastChild)},t.bringElementToFront=function(t){t.parentNode.appendChild(t)},t.childElements=function(t){var e=t.children;if(!e){for(var r=t.childNodes,i=[],n=0;n<r.length;n++){var a=r[n];1==a.nodeType&&i.push(a)}return i}return e},t.isPrimitiveSVGElement=function(t){return!(t.startsWith("Shape")||t.startsWith("Markup")||t.startsWith("Control")||t.startsWith("Chart")||t.startsWith("Window3D"))},t.isContainedInElementOfType=function(t,e){for(;t&&1==t.nodeType&&e.indexOf(t.getAttribute("type"))<0;)t=t.parentNode;return t&&1==t.nodeType},t.findChildOfType=function(e,r){for(var i=t.childElements(e),n=0;n<i.length;n++)if(i[n].getAttribute("type")==r)return i[n];return console.log("Child of type "+r+" not found in",e),null},t.findParentOfType=function(t,e){for(var r=t.parentNode;;){if(!r||1!=r.nodeType)return null;var i=r;if(i.getAttribute("type")==e)return i;r=i.parentNode}},t.childNodeDeepCount=function(e){var r=e.childNodes;if(!r)return 0;for(var i=r.length,n=0;n<r.length;n++)i+=t.childNodeDeepCount(r[n]);return i},t.createCanvas=function(){var e=t.createXhtmlElement("canvas");return document.getElementById("canvas-group").appendChild(e),e},t.xhtmlns="http://www.w3.org/1999/xhtml",t.xlinkns="http://www.w3.org/1999/xlink",t.svgns="http://www.w3.org/2000/svg",t}(),a=function(){function t(){}return t.offsetPage=function(t){var e=t.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+i,left:e.left+r}},t.indexInParent=function(t){var e;for(e=0;t=t.previousElementSibling;e++);return e},t.radiansToDegrees=function(t){return 360*t/(2*Math.PI)},t.modulo=function(t,e){var r=t%e;return Math.floor(r>=0?r:r+e)},t.remainderPositive=function(t,e){var r=t%e;return r>=0?r:r+e},t.formatNumber=function(t,e){if(t==-1/0)return"-Infinity";if(t==1/0)return"+Infinity";if(isNaN(t))return"NaN";var r=Math.abs(t);return r<1e-12?String(0):r>9999999999||r<.001&&0!=t?String(+t.toExponential(2)):String(+t.toFixed(2))},t.formatPercent=function(t){return+Math.round(100*t)+"%"},t.reducePrecision=function(t){return+t.toPrecision(4)},t.dateComponent=function(t,e){var r,i=t.getFullYear();switch(e){case"YYYY":return String(i);case"MMM":switch(t.getMonth()+1){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec";default:return null}case"MM":r=t.getMonth()+1;break;case"DD":r=t.getDate();break;case"HH":r=t.getHours();break;case"mm":r=t.getMinutes();break;case"ss":r=t.getSeconds()}return r<10?"0"+r:String(r)},t.formatDate=function(e,r){switch(r){case"YYYY":return t.dateComponent(e,"YYYY");case"MMMYYYY":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"YYYY");case"DDMMM":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"DD");case"DDMMHH":return t.dateComponent(e,"MM")+"/"+t.dateComponent(e,"DD")+" "+t.dateComponent(e,"HH")+":00";case"HHmm":return t.dateComponent(e,"HH")+":"+t.dateComponent(e,"mm");case"mmss":default:return t.dateComponent(e,"mm")+"'"+t.dateComponent(e,"ss")+"''"}},t.toMilliseconds=function(e,r){switch(e.settings.timeUnit){case"MILLISECOND":return r*t.MILLISECOND;case"SECOND":return r*t.SECOND;case"MINUTE":return r*t.MINUTE;case"HOUR":return r*t.HOUR;case"DAY":return r*t.DAY;case"WEEK":return r*t.WEEK;case"MONTH":return r*t.MONTH;case"YEAR":return r*t.YEAR}},t.toDate=function(e,r){var i=e.settings,n=r-i.startTime;return new Date(i.startDate+t.toMilliseconds(e,n))},t.date=function(e){return t.toDate(e,e.time)},t.setMultipleAttributes=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i].toString())},t.getSubAttribute=function(t,e){for(var r=0;r<t.length;r++){var i=t[r].split(":");if(2==i.length&&i[0]==e)return i[1]}return null},t.getIntAttribute=function(t,e){return parseInt(t.getAttribute(e))},t.getFloatAttribute=function(t,e){return parseFloat(t.getAttribute(e))},t.splitSkipEmpty=function(e,r){return e.split(r).filter(t.isEmpty)},t.isEmpty=function(t){return t.length>0},t.splitToFloats=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseFloat(i[n]);return i},t.splitToInts=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseInt(i[n]);return i},t.hyphenToCameLCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.parseTranslateTransform=function(e){var r=t.translateRegExp2.exec(e);return null!=r?[parseFloat(r[1]),parseFloat(r[2])]:(r=t.translateRegExp1.exec(e),[parseFloat(r[1]),0])},t.increaseTransparency=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=i[4]?i[4]:1;return"rgba("+i[1]+","+i[2]+","+i[3]+","+r*n+")"},t.addPathArrows=function(e,r,i,a,o,s){for(var l=e.getTotalLength(),u=o;u<l;u+=s){var c=e.getPointAtLength(u),h=e.getPointAtLength(u-3),d=t.radiansToDegrees(Math.PI/2-Math.atan2(c.x-h.x,c.y-h.y)),p=n.createUseElement(r);p.setAttribute("stroke-width",i.toString()),p.setAttribute("transform","translate("+c.x+" "+c.y+") rotate( "+d+")"),a.appendChild(p)}},t.sectorData=function(t,e,r,i,n,a){var o=Math.abs(a)>2*Math.PI?a%(2*Math.PI):a;a==2*Math.PI&&(a-=1e-4);var s=n+a,l=t+r*Math.cos(n),u=e+i*Math.sin(n),c=t+r*Math.cos(s),h=e+i*Math.sin(s);return"M "+t+" "+e+" L "+l+" "+u+" A "+r+" "+i+" 0 "+(Math.abs(o)>Math.PI?"1 ":"0 ")+(o>0?"1 ":"0 ")+c+" "+h+" Z"},t.roundPathCorners=function(t,e,r){function i(t,e,r){var i=e.x-t.x,a=e.y-t.y,o=Math.sqrt(i*i+a*a);return n(t,e,Math.min(1,r/o))}function n(t,e,r){return{x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}}function a(t,e){t.length>2&&(t[t.length-2]=e.x,t[t.length-1]=e.y)}function o(t){return{x:parseFloat(t[t.length-2]),y:parseFloat(t[t.length-1])}}var s=t.split(/[,\s]/).reduce(function(t,e){var r=e.match("([a-zA-Z])(.+)");return r?(t.push(r[1]),t.push(r[2])):t.push(e),t},[]).reduce(function(t,e){return parseFloat(e)==e&&t.length?t[t.length-1].push(e):t.push([e]),t},[]),l=[];if(s.length>1){var u=o(s[0]),c=null;"Z"==s[s.length-1][0]&&s[0].length>2&&(c=["L",u.x,u.y],s[s.length-1]=c),l.push(s[0]);for(var h=1;h<s.length;h++){var d=l[l.length-1],p=s[h],f=p==c?s[1]:s[h+1];if(f&&d&&d.length>2&&"L"==p[0]&&f.length>2&&"L"==f[0]){var m,g,v=o(d),b=o(p),y=o(f);r?(m=n(b,d.origPoint||v,e),g=n(b,f.origPoint||y,e)):(m=i(b,v,e),g=i(b,y,e)),a(p,m),p.origPoint=b,l.push(p);var A=n(m,b,.5),T=n(b,g,.5),C=["C",A.x,A.y,T.x,T.y,g.x,g.y];C.origPoint=b,l.push(C)}else l.push(p)}if(c){var S=o(l[l.length-1]);l.push(["Z"]),a(l[0],S)}}else l=s;return l.reduce(function(t,e){return t+e.join(" ")+" "},"")},t.stringToByteArray=function(t){for(var e=[],r=0,i=0;i<t.length;i++){for(var n=t.charCodeAt(i);n>255;)e[r++]=255&n,n>>=8;e[r++]=n}return e},t.byteArrayToString=function(t){if(t.length<=8192)return String.fromCharCode.apply(null,t);for(var e="",r=0;r<t.length;r+=8192){var i=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,i)}return e},t.translateRegExp1=/^translate\s*\(\s*(-?\d*.?\d*)\s*\)\s*$/i,t.translateRegExp2=/^translate\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)\s*$/i,t.rgbRegExp=/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,t.rgbaRegExp=/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*.?\d*)\s*\)\s*$/i,t.MILLISECOND=1,t.SECOND=1e3*t.MILLISECOND,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR,t.WEEK=7*t.DAY,t.MONTH=30*t.DAY,t.YEAR=365*t.DAY,t}(),o=function(){function t(t){this.frameDrawing=t}return t.createShapeArc=function(){return n.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createShapeText=function(){return n.createSvgElement("text")},t.updateShapeText=function(t,e,r){for(var i=0;i<e.length;i++)if("text-content"==e[i]){null==r[i]&&(r[i]="");var o=r[i].split("\n"),s=t.childElementCount;if(1==o.length&&1==s)t.firstChild.firstChild.textContent=o[0];else{for(var l=a.getFloatAttribute(t,"first-line-offset"),u=a.getFloatAttribute(t,"line-height"),c=0;c<o.length;c++){var h=n.childElements(t),d=o[c];if(d.endsWith("\r")&&(d=d.substring(0,d.length-1)),h[c])h[c].firstChild.textContent=d;else{var p=n.createSvgElement("tspan");p.setAttribute("x","0"),p.setAttribute("y",(l+c*u).toString());var f=n.createTextNode(d);p.appendChild(f),t.appendChild(p)}}for(;t.childElementCount>o.length;)n.removeElement(t,t.lastChild)}}else t.setAttribute(e[i],r[i])},t.createShapeImage=function(){return n.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":n.removeAllChildren(t);break;case"add":var a=n.createSvgElement("image");a.setAttributeNS(n.xlinkns,"href",this.frameDrawing.client.network.getJarResourceURL(r[i])),a.setAttribute("visibility","hidden"),a.setAttribute("width",t.getAttribute("width")),a.setAttribute("height",t.getAttribute("height")),t.appendChild(a);break;case"set":for(var o=parseInt(r[i]),s=t.childNodes,l=0;l<s.length;l++)(a=s[l]).setAttribute("visibility",l==o?"inherit":"hidden");break;case"width":case"height":s=t.childNodes;for(l=0;l<s.length;l++)(a=s[l]).setAttribute(e[i],r[i]);default:t.setAttribute(e[i],r[i])}},t.createShapeCanvas=function(t){var e=n.createSvgElement("image");return n.createCanvas().id=t+"canvas",e},t.updateShapeCanvas=function(t,e,r){for(var i=t,o=document.getElementById(t.id+"canvas"),s=o.getContext("2d"),l=0;l<e.length;l++)switch(e[l]){case"width":case"height":i.setAttribute(e[l],r[l]),o.setAttribute(e[l],r[l]);break;case"fill-rect":case"clear-rect":var u=a.splitToFloats(r[l]," "),c=u[0],h=u[1],d=u[2],p=u[3];if("clear-rect"==e[l])s.clearRect(c,h,d,p);else{var f=u[4];s.fillStyle=f,s.fillRect(c,h,d,p)}break;case"fill-circle":u=r[l].split(" ");var m=parseFloat(u[0]),g=parseFloat(u[1]),v=parseFloat(u[2]),b=u[3];s.fillStyle=b,s.beginPath(),s.arc(m,g,v,0,2*Math.PI),s.fill();break;case"clear":s.clearRect(0,0,o.width,o.height);break;case"update":i.setAttributeNS(n.xlinkns,"href",o.toDataURL("image/x-xbitmap"));break;default:t.setAttribute(e[l],r[l])}},t.createUnsupportedObject=function(t){var e=n.cloneElementWithId("unsupported-object");return n.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=n.findChildOfType(t,"background"),a=n.findChildOfType(t,"text"),o=0;o<e.length;o++)switch(e[o]){case"width":var s=parseFloat(r[o]);i.setAttribute("width",s.toString());var l=a.getBBox();s<l.width&&(a.firstChild.textContent="Not supported",l=a.getBBox()),s<l.width&&(a.firstChild.textContent="N/A",l=a.getBBox()),s<l.width&&(a.firstChild.textContent=""),a.setAttribute("x",(s/2).toString());break;case"height":var u=parseFloat(r[o]);i.setAttribute("height",u.toString()),a.setAttribute("y",(u/2+3).toString());break;default:t.setAttribute(e[o],r[o])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeGISMap"],t}(),s=function(){function t(){}return t.create=function(){return o.createUnsupportedObject("Vector 3D is under development. To view 3D use Play(video)")},t.update=function(t,e,r){o.updateUnsupportedObject(t,e,r)},t}(),l=function(){function t(){}return t.prototype.LANGUAGE=function(){return"English"},t.prototype.BOX_TITLE_MESSAGE=function(){return"Message"},t.prototype.BOX_TITLE_ERROR=function(){return"Error"},t.prototype.BOX_TITLE_FATAL_ERROR=function(){return"Fatal error"},t.prototype.BOX_TITLE_NOT_SUPPORTED=function(){return"Not supported"},t.prototype.BOX_TITLE_WAIT_OR_KILL=function(){return"The model is taking long time to start"},t.prototype.BOX_TEXT_WAIT_OR_KILL_OPTIONS=function(){return"You can continue waiting or you can kill the model by pressing the link below."},t.prototype.BOX_TEXT_WAIT_OR_KILL_IF_DOES_NOT_START=function(){return"If the model does not start within"},t.prototype.BOX_TEXT_WAIT_OR_KILL_WILL_BE_KILLED=function(){return"minutes, it will be killed automatically."},t.prototype.BOX_TEXT_WAIT_OR_KILL_KILL=function(){return"Kill the model"},t.prototype.BOX_TITLE_ANIMATED_RUN_TIME_LIMIT=function(){return"Animated run time limit"},t.prototype.BOX_TEXT_ANIMATED_RUN_TIME_LIMIT=function(){return"The model has run for the maximum time allowed.\nFor unlimited run time please choose a "},t.prototype.BOX_TITLE_CONNECTION_LOST=function(){return"Connection lost"},t.prototype.BOX_TEXT_CONNECTION_LOST=function(){return"The model is not responding.\nNetwork connection has probably been lost."},t.prototype.BOX_TITLE_OPEN_URL=function(){return"Open URL"},t.prototype.BOX_TITLE_UNKNOWN_COMMAND=function(){return"INTERNAL ERROR: Unknown command"},t.prototype.BOX_TITLE_UNKNOWN_SHAPE_TYPE=function(){return"INTERNAL ERROR: Unknown shape type"},t.prototype.BOX_TITLE_LOAD_SNAPSHOT=function(){return"Load snapshot"},t.prototype.BOX_TITLE_SAVE_SNAPSHOT=function(){return"Save snapshot"},t.prototype.BOX_TEXT_SNAPSHOT_LOAD_NOT_SUPPORTED=function(){return"Snapshot loading\nIs currently not supported in the Cloud."},t.prototype.BOX_TITLE_CLIPBOARD_ACCESS=function(){return"Clipboard access"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD=function(){return"The model wants to copy data to the clipboard."},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_ALLOW=function(){return"Allow"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_REJECT=function(){return"or close this dialog to reject."},t.prototype.SEE_CONSOLE=function(){return"Console"},t.prototype.PERCENT_OF=function(){return"of"},t.prototype.TIME=function(){return"time"},t.prototype.DATE=function(){return"date"},t.prototype.BYTES=function(){return"bytes"},t.prototype.KILOBYTES=function(){return"K"},t.prototype.MEGABYTES=function(){return"M"},t.prototype.MILLISECOND=function(){return"ms"},t.prototype.SECOND=function(){return"sec"},t.prototype.MINUTE=function(){return"min"},t.prototype.HOUR=function(){return"hours"},t.prototype.DAY=function(){return"days"},t.prototype.WEEK=function(){return"weeks"},t.prototype.MONTH=function(){return"months"},t.prototype.YEAR=function(){return"years"},t.prototype.JAN=function(){return"Jan"},t.prototype.FEB=function(){return"Feb"},t.prototype.MAR=function(){return"Mar"},t.prototype.APR=function(){return"Apr"},t.prototype.MAY=function(){return"May"},t.prototype.JUN=function(){return"Jun"},t.prototype.JUL=function(){return"Jul"},t.prototype.AUG=function(){return"Aug"},t.prototype.SEP=function(){return"Sep"},t.prototype.OCT=function(){return"Oct"},t.prototype.NOV=function(){return"Nov"},t.prototype.DEC=function(){return"Dec"},t.prototype.MILLIMETER=function(){return"mm"},t.prototype.CENTIMETER=function(){return"cm"},t.prototype.METER=function(){return"m"},t.prototype.KILOMETER=function(){return"km"},t.prototype.INCH=function(){return"in"},t.prototype.FOOT=function(){return"ft"},t.prototype.YARD=function(){return"yd"},t.prototype.MILE=function(){return"mi"},t.prototype.NAUTICAL_MILE=function(){return"nm"},t.prototype.PIXEL=function(){return"px"},t.prototype.RUN_UNTIL=function(){return"Run until"},t.prototype.RUN_FOR=function(){return"Run for"},t.prototype.PAUSE_AT=function(){return"Pause at"},t.prototype.CONSOLE=function(){return"Console"},t.prototype.EVENTS=function(){return"Events"},t.prototype.EVENTS_EVENTS_SCHEDULED_BY=function(){return"events scheduled by"},t.prototype.EVENTS_TIME_LEFT=function(){return"T left"},t.prototype.EVENTS_CONDITIONS_MONITORED_BY=function(){return"conditions monitored by"},t.prototype.EVENTS_PAUSE_THE_MODEL_TO_FOLLOW_EVENT_LINK=function(){return"Pause the model to follow event links"},t.prototype.EVENTS_PAUSE_THE_MODEL_RUN_TO_EVENT=function(){return"You can only run to the event in the Paused state"},t.prototype.EVENTS_MORE=function(){return"more"},t.prototype.EPS=function(){return"EPS"},t.prototype.FPS=function(){return"FPS"},t.prototype.STEP=function(){return"Step"},t.prototype.REAL_TIME=function(){return"Running"},t.prototype.COPY_CAMERA_LOCATION=function(){return"Copy camera location"},t.prototype.FOR_MORE_DETAILS_SEE=function(){return"For more details see"},t.prototype.ANYLOGIC_WEBSITE=function(){return"AnyLogic website"},t.prototype.TERMS_OF_USE=function(){return"Terms of use"},t.prototype.ABOUT_ANYLOGIC=function(){return"About AnyLogic"},t.prototype.SYSTEM_INFORMATION=function(){return"System information"},t.prototype.RUNNING_FROM_IDE=function(){return"from AnyLogic development environment"},t.prototype.RUNNING_AS_STANDALONE=function(){return"as exported standalone application"},t.prototype.RUNNING_IN_CLOUD=function(){return"in AnyLogic Cloud"},t.prototype.ABOUT_CREATED_WITH=function(){return"This model was created with simulation modeling software"},t.prototype.ABOUT_AND_CONTAINS=function(){return"and contains components of AnyLogic. For terms of use see"},t.prototype.ABOUT_THE_MODEL_IS_RUNNING=function(){return"The model is running"},t.prototype.ABOUT_ANYLOGIC_VERSION=function(){return"AnyLogic version"},t.prototype.ABOUT_JAVA_VERSION=function(){return"Java version"},t.prototype.ABOUT_PLATFORM=function(){return"Platform"},t.prototype.ABOUT_LICENSING_INFORMATION=function(){return"Licensing information"},t.prototype.ABOUT_THE_PRODUCT_INCLUDES=function(){return"This product includes the following software"},t.prototype.ABOUT_USES_SOFTWARE=function(){return"uses the following software"},t.prototype.ABOUT_SEE_ALSO=function(){return"See also"},t.prototype.ABOUT_FILE_IN_EXPORTED_MODEL=function(){return"file located in the exported model folder, or"},t.prototype.ABOUT_FILE_IN_INSTALLATION=function(){return"file in the AnyLogic installation folder"},t.prototype.EVALUATION_USE_ONLY=function(){return"EVALUATION USE ONLY"},t.prototype.DISTRIBUTOR_DEMO_USE_ONLY=function(){return"DISTRIBUTOR DEMO USE ONLY"},t.prototype.SUBSCRIPTION_OPTION=function(){return"subscription option"},t.prototype.ASK_OPEN_URL=function(){return"The model asks you to open an external URL"},t.prototype.URL_OPENS_IN_NEW_WINDOW=function(){return"The URL will open in a new window."},t.prototype.UPLOADING=function(){return"Uploading"},t.prototype.UPLOAD_FAILED=function(){return"Upload failed"},t.prototype.FORBIDDEN=function(){return"Forbidden"},t.prototype.ITEMS_DELETED=function(){return"item(s) deleted"},t.prototype.ITEMS_SKIPPED=function(){return"item(s) skipped"},t.prototype.WINDOW_REFRESH_DISABLED=function(){return"Window refresh is disabled"},t.prototype.ERROR_DRAWING_FRAME=function(){return"Error while drawing animation frame.\nPossibly caused by dynamic properties of animation shapes.\nThe picture will be restored when (and if) the error goes away."},t.prototype.ANIMATION_COMMAND_NOT_SUPPORTED=function(){return"The animation command is not supported"},t.prototype.SHAPE_TYPE_NOT_SUPPORTED=function(){return"The shape type is not supported"},t.prototype.ENGINE_AND_FRONTEND_DONT_MATCH=function(){return"Probably, the simulation engine and the frontend versions don't match."},t.prototype.ENTER_NUMBER_GREATER_THAN=function(){return"enter a number >"},t.prototype.ENTER_DATE_LATER_THAN=function(){return"enter a date later than"},t.prototype.NON_NEGATIVE_INTEGER_REQUIRED=function(){return"a non-negative integer required"},t.prototype.VALID_DATE_REQUIRED=function(){return"a valid date required"},t.prototype.OPERATION_CANNOT_BE_INTERRUPTED=function(){return"This operation cannot be interrupted. Please wait..."},t.prototype.UPLOADING_SNAPSHOT_FILE=function(){return"Uploading snapshot file"},t.prototype.RESTORING_SNAPSHOT=function(){return"Restoring snapshot"},t.prototype.SNAPSHOT_FAILED_TO_UPLOAD=function(){return"Snapshot file failed to upload"},t.prototype.SNAPSHOT_FAILED_TO_RESTORE=function(){return"Snapshot failed to restore"},t.prototype.WRITING_SNAPSHOT_FILE=function(){return"Writing snapshot file"},t.prototype.SNAPSHOT_FAILED_TO_SAVE=function(){return"Snapshot could not be saved"},t.prototype.DOWNLOADING_SNAPSHOT=function(){return"Snapshot file is being downloaded"},t.prototype.STATE_IDLE=function(){return"Idle"},t.prototype.STATE_RUNNING=function(){return"Running"},t.prototype.STATE_PAUSED=function(){return"Paused"},t.prototype.STATE_FINISHED=function(){return"Finished"},t.prototype.STATE_ERROR=function(){return"Error"},t.prototype.STATE_PLEASE_WAIT=function(){return"Please wait..."},t.prototype.STATE_INITIALIZE=function(){return"Initializing..."},t.prototype.STATE_STOPPED=function(){return"Stopped"},t.prototype.STATE_TIME_LIMIT=function(){return"Time limit"},t.prototype.STATE_TERMINATED=function(){return"Terminated"},t.prototype.TOOLTIP_MODEL_TIME_IN_MODEL_TIME_UNITS=function(){return"Model time in model time units"},t.prototype.TOOLTIP_MODEL_TIME_UNIT=function(){return"Model time unit"},t.prototype.TOOLTIP_PAUSE_TIME_IN_MODEL_TIME_UNITS=function(){return"Pause time in model time units"},t.prototype.TOOLTIP_MODEL_DATE=function(){return"Model date"},t.prototype.TOOLTIP_SHOW_HIDE_SNAPSHOT_OPTIONS=function(){return"Show/hide snapshot options"},t.prototype.TOOLTIP_LOAD_SNAPSHOT=function(){return"Load snapshot"},t.prototype.TOOLTIP_SAVE_SNAPSHOT=function(){return"Save snapshot"},t.prototype.TOOLTIP_SNAPSHOT_NOT_SUPPORTED=function(){return"Snapshot is not supported for this experiment type"},t.prototype.TOOLTIP_SNAPSHOT_NOT_WHILE_RUNNING=function(){return"Pause the model to enable snapshot"},t.prototype.TOOLTIP_RUN=function(){return"Run"},t.prototype.TOOLTIP_PAUSE=function(){return"Pause"},t.prototype.TOOLTIP_STEP=function(){return"Step"},t.prototype.TOOLTIP_STOP=function(){return"Stop"},t.prototype.TOOLTIP_DISABLED_BY_MODEL_DESIGNER=function(){return"Disabled by model designer"},t.prototype.TOOLTIP_SHOW_HIDE_RUN_OPTIONS=function(){return"Show/hide run options"},t.prototype.TOOLTIP_RUN_UNTIL_A_GIVEN_TIME_OR_DATE_THEN_PAUSE=function(){return"Run until a given time or date, then pause"},t.prototype.TOOLTIP_TOGGLE_DATE_TIME_UNITS=function(){return"Toggle date/time units"},t.prototype.TOOLTIP_RUN_FOR_A_GIVEN_TIME_INTERVAL_THEN_PAUSE=function(){return"Run for a given time interval, then pause"},t.prototype.TOOLTIP_PAUSE_AT_A_GIVEN_TIME_OR_DATE=function(){return"Pause at a given time or date"},t.prototype.TOOLTIP_SELECT_AGENT_TO_DIVE_IN=function(){return"Select agent to dive in"},t.prototype.TOOLTIP_UP_ONE_LEVEL=function(){return"Up one level"},t.prototype.TOOLTIP_TO_EXPERIMENT_START_PAGE=function(){return"To experiment (start page)"},t.prototype.TOOLTIP_TO_TOP_LEVEL_ROOT_AGENT=function(){return"To top level (root) agent"},t.prototype.TOOLTIP_GO_BACK=function(){return"Go back"},t.prototype.TOOLTIP_TO_0_0_ZOOM_1_SAME_PAGE_ORIGIN=function(){return"To (0,0), zoom 1, same page [origin]"},t.prototype.TOOLTIP_ZOOM_OUT=function(){return"Zoom out"},t.prototype.TOOLTIP_CURRENT_ZOOM=function(){return"Current zoom"},t.prototype.TOOLTIP_ZOOM_IN=function(){return"Zoom in"},t.prototype.TOOLTIP_SELECT_VIEW_AREA_TO_NAVIGATE=function(){return"Select view area to navigate"},t.prototype.TOOLTIP_CONSOLE=function(){return"Show console"},t.prototype.TOOLTIP_CLEAR_CONSOLE=function(){return"Clear console"},t.prototype.TOOLTIP_STAY_AT_THE_LATEST_ITEM=function(){return"Stay at the latest item"},t.prototype.TOOLTIP_TOGGLE_LINE_WRAP=function(){return"Toggle line wrap"},t.prototype.TOOLTIP_EVENTS=function(){return"Show events"},t.prototype.TOOLTIP_EVENTS_QUEUE=function(){return"Show event queue"},t.prototype.TOOLTIP_EVENTS_MONITOR=function(){return"Show monitored conditions"},t.prototype.TOOLTIP_EVENTS_SHOW_AGENT=function(){return"Show agent"},t.prototype.TOOLTIP_EVENTS_RUN_TO=function(){return"Run to"},t.prototype.TOOLTIP_EVENTS_IN_PAUSED_STATE_ONLY=function(){return"in Paused state only"},t.prototype.TOOLTIP_REAL_SPEED=function(){return"Simulated time per second"},t.prototype.TOOLTIP_EVENTS_PER_SECOND=function(){return"Events per second"},t.prototype.TOOLTIP_FRAMES_PER_SECOND=function(){return"Frames per second"},t.prototype.TOOLTIP_CURRENT_MODEL_STEP_DISCRETE_EVENT=function(){return"Current model step (discrete event)"},t.prototype.TOOLTIP_REAL_RUNNING_TIME_OF_SIMULATION=function(){return"Real running time of simulation"},t.prototype.TOOLTIP_MEMORY_CONSUMPTION=function(){return"Memory consumption"},t.prototype.TOOLTIP_SET_REAL_TIME_SCALE_X1=function(){return"Set real time scale x1"},t.prototype.TOOLTIP_SLOW_DOWN=function(){return"Slow down"},t.prototype.TOOLTIP_MODEL_TIME_UNITS_PER_REAL_SECOND=function(){return"Model time units per real second"},t.prototype.TOOLTIP_SPEED_UP=function(){return"Speed up"},t.prototype.TOOLTIP_RUN_AS_FAST_AS_POSSIBLE_VIRTUAL_TIME_MODE=function(){return"Run as fast as possible (virtual time mode)"},t.prototype.TOOLTIP_MULTI_RUN_PROGRESS=function(){return"Progress of parallel runs"},t.prototype.TOOLTIP_RESPONSIVENESS=function(){return"Responsiveness and network access"},t.prototype.TOOLTIP_EXPERIMENT_STATE=function(){return"Experiment state"},t.prototype.TOOLTIP_TOGGLE_FULL_SCREEN_MODE=function(){return"Toggle full screen mode"},t.prototype.TOOLTIP_DEVELOPER_PANEL=function(){return"Toggle Developer panel"},t}(),u=function(){function t(){}return t.prototype.LANGUAGE=function(){return"Русский"},t.prototype.BOX_TITLE_MESSAGE=function(){return"Сообщение"},t.prototype.BOX_TITLE_ERROR=function(){return"Ошибка"},t.prototype.BOX_TITLE_FATAL_ERROR=function(){return"Фатальная ошибка"},t.prototype.BOX_TITLE_NOT_SUPPORTED=function(){return"Не поддерживается"},t.prototype.BOX_TITLE_WAIT_OR_KILL=function(){return"Модель долго стартует"},t.prototype.BOX_TEXT_WAIT_OR_KILL_OPTIONS=function(){return"Вы можете продолжать ждать или убить модель, нажав на линк внизу."},t.prototype.BOX_TEXT_WAIT_OR_KILL_IF_DOES_NOT_START=function(){return"Если модель не запустится в течение"},t.prototype.BOX_TEXT_WAIT_OR_KILL_WILL_BE_KILLED=function(){return"минут, она будет завершена принудительно."},t.prototype.BOX_TEXT_WAIT_OR_KILL_KILL=function(){return"Убить модель"},t.prototype.BOX_TITLE_ANIMATED_RUN_TIME_LIMIT=function(){return"Ограничено время анимации"},t.prototype.BOX_TEXT_ANIMATED_RUN_TIME_LIMIT=function(){return"Исчерпан лимит времени анимационного запуска.\nДля снятия ограничения выберите "},t.prototype.BOX_TITLE_CONNECTION_LOST=function(){return"Соединение прервано"},t.prototype.BOX_TEXT_CONNECTION_LOST=function(){return"Модель не отвечает.\nВозможно, разорвано сетевое соединение."},t.prototype.BOX_TITLE_OPEN_URL=function(){return"Открыть внешнюю ссылку"},t.prototype.BOX_TITLE_UNKNOWN_COMMAND=function(){return"ОШИБКА СИСТЕМЫ: Неизвестная команда"},t.prototype.BOX_TITLE_UNKNOWN_SHAPE_TYPE=function(){return"ОШИБКА СИСТЕМЫ: Неизвестный тип фигуры"},t.prototype.BOX_TITLE_LOAD_SNAPSHOT=function(){return"Загрузка снэпшота"},t.prototype.BOX_TITLE_SAVE_SNAPSHOT=function(){return"Сохранение снэпшота"},t.prototype.BOX_TEXT_SNAPSHOT_LOAD_NOT_SUPPORTED=function(){return"Загрузка снэпшота в Облаке\nв настоящее время не поддерживается."},t.prototype.BOX_TITLE_CLIPBOARD_ACCESS=function(){return"Доступ к буферу обмена"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD=function(){return"Модель пытается скопировать данные в буфер обмена."},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_ALLOW=function(){return"Разрешите"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_REJECT=function(){return"или закройте этот диалог, чтобы отклонить."},t.prototype.SEE_CONSOLE=function(){return"Консоли"},t.prototype.PERCENT_OF=function(){return"из"},t.prototype.TIME=function(){return"время"},t.prototype.DATE=function(){return"дата"},t.prototype.BYTES=function(){return"байт"},t.prototype.KILOBYTES=function(){return"Кб"},t.prototype.MEGABYTES=function(){return"Мб"},t.prototype.MILLISECOND=function(){return"мс"},t.prototype.SECOND=function(){return"сек"},t.prototype.MINUTE=function(){return"мин"},t.prototype.HOUR=function(){return"ч"},t.prototype.DAY=function(){return"дней"},t.prototype.WEEK=function(){return"недель"},t.prototype.MONTH=function(){return"мес"},t.prototype.YEAR=function(){return"лет"},t.prototype.JAN=function(){return"янв"},t.prototype.FEB=function(){return"фев"},t.prototype.MAR=function(){return"мар"},t.prototype.APR=function(){return"апр"},t.prototype.MAY=function(){return"май"},t.prototype.JUN=function(){return"июн"},t.prototype.JUL=function(){return"июл"},t.prototype.AUG=function(){return"авг"},t.prototype.SEP=function(){return"сен"},t.prototype.OCT=function(){return"окт"},t.prototype.NOV=function(){return"ноя"},t.prototype.DEC=function(){return"дек"},t.prototype.MILLIMETER=function(){return"мм"},t.prototype.CENTIMETER=function(){return"см"},t.prototype.METER=function(){return"м"},t.prototype.KILOMETER=function(){return"км"},t.prototype.INCH=function(){return"дюйм"},t.prototype.FOOT=function(){return"фут"},t.prototype.YARD=function(){return"ярд"},t.prototype.MILE=function(){return"миля"},t.prototype.NAUTICAL_MILE=function(){return"морская миля"},t.prototype.PIXEL=function(){return"пиксель"},t.prototype.RUN_UNTIL=function(){return"Запустить до"},t.prototype.RUN_FOR=function(){return"Запустить на"},t.prototype.PAUSE_AT=function(){return"Приостановить в"},t.prototype.CONSOLE=function(){return"Консоль"},t.prototype.EVENTS=function(){return"События"},t.prototype.EVENTS_EVENTS_SCHEDULED_BY=function(){return"событий, созданных"},t.prototype.EVENTS_TIME_LEFT=function(){return"Время до"},t.prototype.EVENTS_CONDITIONS_MONITORED_BY=function(){return"условий, отслеживаемых"},t.prototype.EVENTS_PAUSE_THE_MODEL_TO_FOLLOW_EVENT_LINK=function(){return"Для перехода по ссылке приостановите модель"},t.prototype.EVENTS_PAUSE_THE_MODEL_RUN_TO_EVENT=function(){return"Выбор события для приостановки модели возможен только в режиме Пауза"},t.prototype.EVENTS_MORE=function(){return"еще"},t.prototype.EPS=function(){return"Соб/сек"},t.prototype.FPS=function(){return"Кадр/сек"},t.prototype.STEP=function(){return"Шаг"},t.prototype.REAL_TIME=function(){return"Длит"},t.prototype.COPY_CAMERA_LOCATION=function(){return"Скопировать положение камеры"},t.prototype.FOR_MORE_DETAILS_SEE=function(){return"Подробности смотрите в"},t.prototype.ANYLOGIC_WEBSITE=function(){return"Сайт AnyLogic"},t.prototype.TERMS_OF_USE=function(){return"Условия использования"},t.prototype.ABOUT_ANYLOGIC=function(){return"Информация об AnyLogic"},t.prototype.SYSTEM_INFORMATION=function(){return"Информация о системе"},t.prototype.RUNNING_FROM_IDE=function(){return"из среды разработки моделей AnyLogic"},t.prototype.RUNNING_AS_STANDALONE=function(){return"как экспортированное независимое приложение"},t.prototype.RUNNING_IN_CLOUD=function(){return"в облаке AnyLogic"},t.prototype.ABOUT_CREATED_WITH=function(){return"Эта модель была создана с помощью программного продукта"},t.prototype.ABOUT_AND_CONTAINS=function(){return"и содержит компоненты AnyLogic. Условия использования описаны в "},t.prototype.ABOUT_THE_MODEL_IS_RUNNING=function(){return"Модель выполняется"},t.prototype.ABOUT_ANYLOGIC_VERSION=function(){return"Версия AnyLogic"},t.prototype.ABOUT_JAVA_VERSION=function(){return"Версия Java"},t.prototype.ABOUT_PLATFORM=function(){return"Платформа"},t.prototype.ABOUT_LICENSING_INFORMATION=function(){return"Лицензионная информация"},t.prototype.ABOUT_THE_PRODUCT_INCLUDES=function(){return"Данный продукт содержит следующие компоненты"},t.prototype.ABOUT_USES_SOFTWARE=function(){return"использует следующие компоненты"},t.prototype.ABOUT_SEE_ALSO=function(){return"Смотрите также файл"},t.prototype.ABOUT_FILE_IN_EXPORTED_MODEL=function(){return"в папке экспортированной модели, или файл"},t.prototype.ABOUT_FILE_IN_INSTALLATION=function(){return"в папке установочного пакета"},t.prototype.EVALUATION_USE_ONLY=function(){return"ТОЛЬКО В ЦЕЛЯХ ОЗНАКОМЛЕНИЯ"},t.prototype.DISTRIBUTOR_DEMO_USE_ONLY=function(){return"ТОЛЬКО ДЛЯ ДЕМОНСТРАЦИИ ПАРТНЁРОМ AnyLogic"},t.prototype.SUBSCRIPTION_OPTION=function(){return"вариант подписки"},t.prototype.ASK_OPEN_URL=function(){return"Модель предлагает открыть внешнюю ссылку"},t.prototype.URL_OPENS_IN_NEW_WINDOW=function(){return"Ссылка откроется в новом окне."},t.prototype.UPLOADING=function(){return"Загружается"},t.prototype.UPLOAD_FAILED=function(){return"Файл не загружен"},t.prototype.FORBIDDEN=function(){return"Отказано в доступе"},t.prototype.ITEMS_DELETED=function(){return"элементов удалено"},t.prototype.ITEMS_SKIPPED=function(){return"элементов пропущено"},t.prototype.WINDOW_REFRESH_DISABLED=function(){return"Обновление окна отключено"},t.prototype.ERROR_DRAWING_FRAME=function(){return"Ошибка при отрисовке кадра.\nВозможно, причина в динамических свойствах фигур.\nАнимация будет восствновлена, когда (и если) ошибка уйдёт."},t.prototype.ANIMATION_COMMAND_NOT_SUPPORTED=function(){return"Эта команда не поддерживается"},t.prototype.SHAPE_TYPE_NOT_SUPPORTED=function(){return"Этот тип фигуры не поддерживается"},t.prototype.ENGINE_AND_FRONTEND_DONT_MATCH=function(){return"Возможно, версии модели и интерфейса несовместимы."},t.prototype.ENTER_NUMBER_GREATER_THAN=function(){return"введите число >"},t.prototype.ENTER_DATE_LATER_THAN=function(){return"введите дату позднее, чем"},t.prototype.NON_NEGATIVE_INTEGER_REQUIRED=function(){return"введите неотрицательное целое"},t.prototype.VALID_DATE_REQUIRED=function(){return"введите корректную дату"},t.prototype.OPERATION_CANNOT_BE_INTERRUPTED=function(){return"Эта операция не может быть прервана. Ждите..."},t.prototype.UPLOADING_SNAPSHOT_FILE=function(){return"Загружается файл снэпшота"},t.prototype.RESTORING_SNAPSHOT=function(){return"Восстанавливается снэпшот"},t.prototype.SNAPSHOT_FAILED_TO_UPLOAD=function(){return"Ошибка загрузки файла снэпшота"},t.prototype.SNAPSHOT_FAILED_TO_RESTORE=function(){return"Ошибка восстановления снэпшота"},t.prototype.WRITING_SNAPSHOT_FILE=function(){return"Запись снэпшота в файл"},t.prototype.SNAPSHOT_FAILED_TO_SAVE=function(){return"Ошибка сохранения снэпшота"},t.prototype.DOWNLOADING_SNAPSHOT=function(){return"Файл снэпшота скачивается"},t.prototype.STATE_IDLE=function(){return"Готов"},t.prototype.STATE_RUNNING=function(){return"Выполняется"},t.prototype.STATE_PAUSED=function(){return"Пауза"},t.prototype.STATE_FINISHED=function(){return"Завершено"},t.prototype.STATE_ERROR=function(){return"Ошибка"},t.prototype.STATE_PLEASE_WAIT=function(){return"Ожидание..."},t.prototype.STATE_INITIALIZE=function(){return"Инициализация..."},t.prototype.STATE_STOPPED=function(){return"Остановлено"},t.prototype.STATE_TIME_LIMIT=function(){return"Лимит времени"},t.prototype.STATE_TERMINATED=function(){return"Прекращено"},t.prototype.TOOLTIP_MODEL_TIME_IN_MODEL_TIME_UNITS=function(){return"Модельное (виртуальное) время"},t.prototype.TOOLTIP_MODEL_TIME_UNIT=function(){return"Единица модельного времени"},t.prototype.TOOLTIP_PAUSE_TIME_IN_MODEL_TIME_UNITS=function(){return"Время остановки"},t.prototype.TOOLTIP_MODEL_DATE=function(){return"Модельная дата"},t.prototype.TOOLTIP_SHOW_HIDE_SNAPSHOT_OPTIONS=function(){return"Показать/скрыть действия со снэпшотом"},t.prototype.TOOLTIP_LOAD_SNAPSHOT=function(){return"Загрузить снэпшот"},t.prototype.TOOLTIP_SAVE_SNAPSHOT=function(){return"Сохранить снэпшот"},t.prototype.TOOLTIP_SNAPSHOT_NOT_SUPPORTED=function(){return"Снэпшот не поддерживается для этого типа эксперимента"},t.prototype.TOOLTIP_SNAPSHOT_NOT_WHILE_RUNNING=function(){return"Поставьте модель на паузу для применения снэпшота"},t.prototype.TOOLTIP_RUN=function(){return"Запустить"},t.prototype.TOOLTIP_PAUSE=function(){return"Пауза"},t.prototype.TOOLTIP_STEP=function(){return"Шаг"},t.prototype.TOOLTIP_STOP=function(){return"Прекратить выполнение эксперимента"},t.prototype.TOOLTIP_DISABLED_BY_MODEL_DESIGNER=function(){return"Отключено разработчиком модели"},t.prototype.TOOLTIP_SHOW_HIDE_RUN_OPTIONS=function(){return"Показать/скрыть опции запуска"},t.prototype.TOOLTIP_RUN_UNTIL_A_GIVEN_TIME_OR_DATE_THEN_PAUSE=function(){return"Выполнить до заданного времени/даты, затем приостановить"},t.prototype.TOOLTIP_TOGGLE_DATE_TIME_UNITS=function(){return"Задать дату или время"},t.prototype.TOOLTIP_RUN_FOR_A_GIVEN_TIME_INTERVAL_THEN_PAUSE=function(){return"Выполнить в течение заданного интервала, затем приостановить"},t.prototype.TOOLTIP_PAUSE_AT_A_GIVEN_TIME_OR_DATE=function(){return"Приостановить в заданное время/дату"},t.prototype.TOOLTIP_SELECT_AGENT_TO_DIVE_IN=function(){return"Выбрать агента уровнем ниже и перейти"},t.prototype.TOOLTIP_UP_ONE_LEVEL=function(){return"Перейти в агента уровнем выше"},t.prototype.TOOLTIP_TO_EXPERIMENT_START_PAGE=function(){return"На страницу эксперимента (начальную страницу)"},t.prototype.TOOLTIP_TO_TOP_LEVEL_ROOT_AGENT=function(){return"К основному агенту (root)"},t.prototype.TOOLTIP_GO_BACK=function(){return"Назад"},t.prototype.TOOLTIP_TO_0_0_ZOOM_1_SAME_PAGE_ORIGIN=function(){return"В (0,0) этой же страницы с масштабом 100%"},t.prototype.TOOLTIP_ZOOM_OUT=function(){return"Отдалить"},t.prototype.TOOLTIP_CURRENT_ZOOM=function(){return"Текущий масштаб"},t.prototype.TOOLTIP_ZOOM_IN=function(){return"Приблизить"},t.prototype.TOOLTIP_SELECT_VIEW_AREA_TO_NAVIGATE=function(){return"Выбрать область и показать"},t.prototype.TOOLTIP_CONSOLE=function(){return"Показать консоль"},t.prototype.TOOLTIP_CLEAR_CONSOLE=function(){return"Очистить консоль"},t.prototype.TOOLTIP_STAY_AT_THE_LATEST_ITEM=function(){return"Показывать свежие элементы"},t.prototype.TOOLTIP_TOGGLE_LINE_WRAP=function(){return"Вкл/выкл перенос строки"},t.prototype.TOOLTIP_EVENTS=function(){return"Показать события"},t.prototype.TOOLTIP_EVENTS_QUEUE=function(){return"Очередь событий"},t.prototype.TOOLTIP_EVENTS_MONITOR=function(){return"Отслеживаемые условия"},t.prototype.TOOLTIP_EVENTS_SHOW_AGENT=function(){return"Показать агент"},t.prototype.TOOLTIP_EVENTS_RUN_TO=function(){return"Выполнить до"},t.prototype.TOOLTIP_EVENTS_IN_PAUSED_STATE_ONLY=function(){return"только в приостановленной модели"},t.prototype.TOOLTIP_REAL_SPEED=function(){return"Модельное время в секунду"},t.prototype.TOOLTIP_EVENTS_PER_SECOND=function(){return"Событий в секунду"},t.prototype.TOOLTIP_FRAMES_PER_SECOND=function(){return"Кадров в секунду"},t.prototype.TOOLTIP_CURRENT_MODEL_STEP_DISCRETE_EVENT=function(){return"Текущий шаг модели (дискретное событие)"},t.prototype.TOOLTIP_REAL_RUNNING_TIME_OF_SIMULATION=function(){return"Реальная длительность выполнения эксперимента"},t.prototype.TOOLTIP_MEMORY_CONSUMPTION=function(){return"Используемая память"},t.prototype.TOOLTIP_SET_REAL_TIME_SCALE_X1=function(){return"Включить режим реального времени (масштаб x1)"},t.prototype.TOOLTIP_SLOW_DOWN=function(){return"Замедлить"},t.prototype.TOOLTIP_MODEL_TIME_UNITS_PER_REAL_SECOND=function(){return"Масштаб к реальному времени (единиц модельного времени в секунду)"},t.prototype.TOOLTIP_SPEED_UP=function(){return"Ускорить"},t.prototype.TOOLTIP_RUN_AS_FAST_AS_POSSIBLE_VIRTUAL_TIME_MODE=function(){return"Вкл/выкл режим виртуального времени"},t.prototype.TOOLTIP_MULTI_RUN_PROGRESS=function(){return"Прогресс параллельно выполняемых прогонов"},t.prototype.TOOLTIP_RESPONSIVENESS=function(){return"Время отклика и доступ к сети"},t.prototype.TOOLTIP_EXPERIMENT_STATE=function(){return"Состояние эксперимента"},t.prototype.TOOLTIP_TOGGLE_FULL_SCREEN_MODE=function(){return"Вкл/выкл полноэкранный режим"},t.prototype.TOOLTIP_DEVELOPER_PANEL=function(){return"Показать/скрыть панель разработчика"},t}(),c=function(){function t(){}return t.prototype.LANGUAGE=function(){return"中文"},t.prototype.BOX_TITLE_MESSAGE=function(){return"消息"},t.prototype.BOX_TITLE_ERROR=function(){return"错误"},t.prototype.BOX_TITLE_FATAL_ERROR=function(){return"致命错误"},t.prototype.BOX_TITLE_NOT_SUPPORTED=function(){return"不支持"},t.prototype.BOX_TITLE_WAIT_OR_KILL=function(){return"The model is taking long time to start"},t.prototype.BOX_TEXT_WAIT_OR_KILL_OPTIONS=function(){return"You can continue waiting or kill the model by pressing the link below."},t.prototype.BOX_TEXT_WAIT_OR_KILL_IF_DOES_NOT_START=function(){return"If the model does not start within"},t.prototype.BOX_TEXT_WAIT_OR_KILL_WILL_BE_KILLED=function(){return"minutes, it will be killed automatically."},t.prototype.BOX_TEXT_WAIT_OR_KILL_KILL=function(){return"Kill the model"},t.prototype.BOX_TITLE_ANIMATED_RUN_TIME_LIMIT=function(){return"动画运行时间限制"},t.prototype.BOX_TEXT_ANIMATED_RUN_TIME_LIMIT=function(){return"模型已经运行允许的最长时间。\n如需无限运行时间，请选择"},t.prototype.BOX_TITLE_CONNECTION_LOST=function(){return"连接丢失"},t.prototype.BOX_TEXT_CONNECTION_LOST=function(){return"模型没有响应\n网络连接可能已经丢失。"},t.prototype.BOX_TITLE_OPEN_URL=function(){return"打开网址"},t.prototype.BOX_TITLE_UNKNOWN_COMMAND=function(){return"内部错误：未知命令"},t.prototype.BOX_TITLE_UNKNOWN_SHAPE_TYPE=function(){return"内部错误：未知图形类型"},t.prototype.BOX_TITLE_LOAD_SNAPSHOT=function(){return"加载快照"},t.prototype.BOX_TITLE_SAVE_SNAPSHOT=function(){return"保存快照"},t.prototype.BOX_TEXT_SNAPSHOT_LOAD_NOT_SUPPORTED=function(){return"在云中快照加载\n当前不支持。"},t.prototype.BOX_TITLE_CLIPBOARD_ACCESS=function(){return"剪贴板访问"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD=function(){return"模型想要复制数据到剪贴板。"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_ALLOW=function(){return"允许"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_REJECT=function(){return"或关闭这个对话框以拒绝。"},t.prototype.SEE_CONSOLE=function(){return"控制台"},t.prototype.PERCENT_OF=function(){return"共"},t.prototype.TIME=function(){return"时间"},t.prototype.DATE=function(){return"日期"},t.prototype.BYTES=function(){return"字节"},t.prototype.KILOBYTES=function(){return"千"},t.prototype.MEGABYTES=function(){return"百万"},t.prototype.MILLISECOND=function(){return"毫秒"},t.prototype.SECOND=function(){return"秒"},t.prototype.MINUTE=function(){return"分钟"},t.prototype.HOUR=function(){return"小时"},t.prototype.DAY=function(){return"天"},t.prototype.WEEK=function(){return"星期"},t.prototype.MONTH=function(){return"月"},t.prototype.YEAR=function(){return"年"},t.prototype.JAN=function(){return"一月"},t.prototype.FEB=function(){return"二月"},t.prototype.MAR=function(){return"三月"},t.prototype.APR=function(){return"四月"},t.prototype.MAY=function(){return"五月"},t.prototype.JUN=function(){return"六月"},t.prototype.JUL=function(){return"七月"},t.prototype.AUG=function(){return"八月"},t.prototype.SEP=function(){return"九月"},t.prototype.OCT=function(){return"十月"},t.prototype.NOV=function(){return"十一月"},t.prototype.DEC=function(){return"十二月"},t.prototype.MILLIMETER=function(){return"毫米"},t.prototype.CENTIMETER=function(){return"厘米"},t.prototype.METER=function(){return"米"},t.prototype.KILOMETER=function(){return"千米"},t.prototype.INCH=function(){return"英寸"},t.prototype.FOOT=function(){return"英尺"},t.prototype.YARD=function(){return"码"},t.prototype.MILE=function(){return"英里"},t.prototype.NAUTICAL_MILE=function(){return"海里"},t.prototype.PIXEL=function(){return"像素"},t.prototype.RUN_UNTIL=function(){return"运行直至"},t.prototype.RUN_FOR=function(){return"运行时长"},t.prototype.PAUSE_AT=function(){return"暂停在"},t.prototype.CONSOLE=function(){return"控制台"},t.prototype.EVENTS=function(){return"事件"},t.prototype.EVENTS_EVENTS_SCHEDULED_BY=function(){return"事件预定通过"},t.prototype.EVENTS_TIME_LEFT=function(){return"剩余时间"},t.prototype.EVENTS_CONDITIONS_MONITORED_BY=function(){return"条件监测通过"},t.prototype.EVENTS_PAUSE_THE_MODEL_TO_FOLLOW_EVENT_LINK=function(){return"暂停模型以跟踪事件链接"},t.prototype.EVENTS_PAUSE_THE_MODEL_RUN_TO_EVENT=function(){return"您只能在暂停状态运行事件"},t.prototype.EVENTS_MORE=function(){return"更多"},t.prototype.EPS=function(){return"事件每秒"},t.prototype.FPS=function(){return"帧每秒"},t.prototype.STEP=function(){return"步数"},t.prototype.REAL_TIME=function(){return"运行"},t.prototype.COPY_CAMERA_LOCATION=function(){return"复制摄像机位置"},t.prototype.FOR_MORE_DETAILS_SEE=function(){return"详情请见"},t.prototype.ANYLOGIC_WEBSITE=function(){return"AnyLogic网站"},t.prototype.TERMS_OF_USE=function(){return"使用条款"},t.prototype.ABOUT_ANYLOGIC=function(){return"关于AnyLogic"},t.prototype.SYSTEM_INFORMATION=function(){return"系统信息"},t.prototype.RUNNING_FROM_IDE=function(){return"从AnyLogic开发环境"},t.prototype.RUNNING_AS_STANDALONE=function(){return"作为导出的独立应用程序"},t.prototype.RUNNING_IN_CLOUD=function(){return"在AnyLogic云中"},t.prototype.ABOUT_CREATED_WITH=function(){return"这个模型是用仿真建模软件创建的"},t.prototype.ABOUT_AND_CONTAINS=function(){return"并包含AnyLogic组件。使用条款请见"},t.prototype.ABOUT_THE_MODEL_IS_RUNNING=function(){return"模型在运行"},t.prototype.ABOUT_ANYLOGIC_VERSION=function(){return"AnyLogic版本"},t.prototype.ABOUT_JAVA_VERSION=function(){return"Java版本"},t.prototype.ABOUT_PLATFORM=function(){return"平台"},t.prototype.ABOUT_LICENSING_INFORMATION=function(){return"许可信息"},t.prototype.ABOUT_THE_PRODUCT_INCLUDES=function(){return"这个产品包括下列软件"},t.prototype.ABOUT_USES_SOFTWARE=function(){return"使用下列软件"},t.prototype.ABOUT_SEE_ALSO=function(){return"另见"},t.prototype.ABOUT_FILE_IN_EXPORTED_MODEL=function(){return"位于导出的模型文件夹中的文件，或"},t.prototype.ABOUT_FILE_IN_INSTALLATION=function(){return"AnyLogic安装文件夹中的文件"},t.prototype.EVALUATION_USE_ONLY=function(){return"评估专用"},t.prototype.DISTRIBUTOR_DEMO_USE_ONLY=function(){return"经销商演示专用"},t.prototype.SUBSCRIPTION_OPTION=function(){return"订阅选项"},t.prototype.ASK_OPEN_URL=function(){return"模型要求您打开外部网址"},t.prototype.URL_OPENS_IN_NEW_WINDOW=function(){return"网址会在新窗口中打开。"},t.prototype.UPLOADING=function(){return"正在上传"},t.prototype.UPLOAD_FAILED=function(){return"上传失败"},t.prototype.FORBIDDEN=function(){return"禁止"},t.prototype.ITEMS_DELETED=function(){return"项目删除"},t.prototype.ITEMS_SKIPPED=function(){return"项目跳过"},t.prototype.WINDOW_REFRESH_DISABLED=function(){return"窗口刷新已禁用"},t.prototype.ERROR_DRAWING_FRAME=function(){return"绘制动画帧时发生错误\n可能是由动画图形的动态属性引起的。\n当（且如果）错误消失，图片将恢复。"},t.prototype.ANIMATION_COMMAND_NOT_SUPPORTED=function(){return"不支持动画命令"},t.prototype.SHAPE_TYPE_NOT_SUPPORTED=function(){return"不支持图形类型"},t.prototype.ENGINE_AND_FRONTEND_DONT_MATCH=function(){return"可能，仿真引擎和前端版本不匹配。"},t.prototype.ENTER_NUMBER_GREATER_THAN=function(){return"输入数字>"},t.prototype.ENTER_DATE_LATER_THAN=function(){return"输入日期晚于"},t.prototype.NON_NEGATIVE_INTEGER_REQUIRED=function(){return"要求非负整数"},t.prototype.VALID_DATE_REQUIRED=function(){return"要求有效日期"},t.prototype.OPERATION_CANNOT_BE_INTERRUPTED=function(){return"这个操作无法中断。请稍候……"},t.prototype.UPLOADING_SNAPSHOT_FILE=function(){return"正在上传快照文件"},t.prototype.RESTORING_SNAPSHOT=function(){return"正在还原快照"},t.prototype.SNAPSHOT_FAILED_TO_UPLOAD=function(){return"快照文件上传失败"},t.prototype.SNAPSHOT_FAILED_TO_RESTORE=function(){return"快照还原失败"},t.prototype.WRITING_SNAPSHOT_FILE=function(){return"正在写入快照文件"},t.prototype.SNAPSHOT_FAILED_TO_SAVE=function(){return"快照无法保存"},t.prototype.DOWNLOADING_SNAPSHOT=function(){return"快照文件正在下载"},t.prototype.STATE_IDLE=function(){return"空闲"},t.prototype.STATE_RUNNING=function(){return"运行"},t.prototype.STATE_PAUSED=function(){return"暂停"},t.prototype.STATE_FINISHED=function(){return"完成"},t.prototype.STATE_ERROR=function(){return"错误"},t.prototype.STATE_PLEASE_WAIT=function(){return"请稍候……"},t.prototype.STATE_INITIALIZE=function(){return"正在初始化……"},t.prototype.STATE_STOPPED=function(){return"停止"},t.prototype.STATE_TIME_LIMIT=function(){return"时间限制"},t.prototype.STATE_TERMINATED=function(){return"终止"},t.prototype.TOOLTIP_MODEL_TIME_IN_MODEL_TIME_UNITS=function(){return"模型时间以模型时间单位"},t.prototype.TOOLTIP_MODEL_TIME_UNIT=function(){return"模型时间单位"},t.prototype.TOOLTIP_PAUSE_TIME_IN_MODEL_TIME_UNITS=function(){return"暂停时间以模型时间单位"},t.prototype.TOOLTIP_MODEL_DATE=function(){return"模型日期"},t.prototype.TOOLTIP_SHOW_HIDE_SNAPSHOT_OPTIONS=function(){return"显示/隐藏快照选项"},t.prototype.TOOLTIP_LOAD_SNAPSHOT=function(){return"加载快照"},t.prototype.TOOLTIP_SAVE_SNAPSHOT=function(){return"保存快照"},t.prototype.TOOLTIP_SNAPSHOT_NOT_SUPPORTED=function(){return"这个实验类型不支持快照"},t.prototype.TOOLTIP_SNAPSHOT_NOT_WHILE_RUNNING=function(){return"暂停模型以启用快照"},t.prototype.TOOLTIP_RUN=function(){return"运行"},t.prototype.TOOLTIP_PAUSE=function(){return"暂停"},t.prototype.TOOLTIP_STEP=function(){return"单步"},t.prototype.TOOLTIP_STOP=function(){return"停止"},t.prototype.TOOLTIP_DISABLED_BY_MODEL_DESIGNER=function(){return"被模型设计者禁用"},t.prototype.TOOLTIP_SHOW_HIDE_RUN_OPTIONS=function(){return"显示/隐藏运行选项"},t.prototype.TOOLTIP_RUN_UNTIL_A_GIVEN_TIME_OR_DATE_THEN_PAUSE=function(){return"运行直至给定的时间或日期，然后暂停"},t.prototype.TOOLTIP_TOGGLE_DATE_TIME_UNITS=function(){return"切换日期/时间单位"},t.prototype.TOOLTIP_RUN_FOR_A_GIVEN_TIME_INTERVAL_THEN_PAUSE=function(){return"运行给定的时间间隔，然后暂停"},t.prototype.TOOLTIP_PAUSE_AT_A_GIVEN_TIME_OR_DATE=function(){return"在给定的时间或日期暂停"},t.prototype.TOOLTIP_SELECT_AGENT_TO_DIVE_IN=function(){return"选择智能体以进入"},t.prototype.TOOLTIP_UP_ONE_LEVEL=function(){return"向上一级"},t.prototype.TOOLTIP_TO_EXPERIMENT_START_PAGE=function(){return"到实验（开始页面）"},t.prototype.TOOLTIP_TO_TOP_LEVEL_ROOT_AGENT=function(){return"到最高层（根）智能体"},t.prototype.TOOLTIP_GO_BACK=function(){return"返回"},t.prototype.TOOLTIP_TO_0_0_ZOOM_1_SAME_PAGE_ORIGIN=function(){return"到（0,0），缩放1, 同一页面[原点]"},t.prototype.TOOLTIP_ZOOM_OUT=function(){return"缩小"},t.prototype.TOOLTIP_CURRENT_ZOOM=function(){return"当前缩放"},t.prototype.TOOLTIP_ZOOM_IN=function(){return"放大"},t.prototype.TOOLTIP_SELECT_VIEW_AREA_TO_NAVIGATE=function(){return"选择要导航的视图区域"},t.prototype.TOOLTIP_CONSOLE=function(){return"展示控制台"},t.prototype.TOOLTIP_CLEAR_CONSOLE=function(){return"清除控制台"},t.prototype.TOOLTIP_STAY_AT_THE_LATEST_ITEM=function(){return"停留在最新的项目"},t.prototype.TOOLTIP_TOGGLE_LINE_WRAP=function(){return"切换换行"},t.prototype.TOOLTIP_EVENTS=function(){return"展示事件"},t.prototype.TOOLTIP_EVENTS_QUEUE=function(){return"展示事件队列"},t.prototype.TOOLTIP_EVENTS_MONITOR=function(){return"展示监测的条件"},t.prototype.TOOLTIP_EVENTS_SHOW_AGENT=function(){return"展示智能体"},t.prototype.TOOLTIP_EVENTS_RUN_TO=function(){return"运行到"},t.prototype.TOOLTIP_EVENTS_IN_PAUSED_STATE_ONLY=function(){return"仅在暂停状态"},t.prototype.TOOLTIP_REAL_SPEED=function(){return"每秒仿真的时间"},t.prototype.TOOLTIP_EVENTS_PER_SECOND=function(){return"事件每秒"},t.prototype.TOOLTIP_FRAMES_PER_SECOND=function(){return"帧每秒"},t.prototype.TOOLTIP_CURRENT_MODEL_STEP_DISCRETE_EVENT=function(){return"当前模型步数（离散事件）"},t.prototype.TOOLTIP_REAL_RUNNING_TIME_OF_SIMULATION=function(){return"仿真真实运行时间"},t.prototype.TOOLTIP_MEMORY_CONSUMPTION=function(){return"内存消耗"},t.prototype.TOOLTIP_SET_REAL_TIME_SCALE_X1=function(){return"设置真实时间比例x1"},t.prototype.TOOLTIP_SLOW_DOWN=function(){return"减速"},t.prototype.TOOLTIP_MODEL_TIME_UNITS_PER_REAL_SECOND=function(){return"模型时间单位每真实秒"},t.prototype.TOOLTIP_SPEED_UP=function(){return"加速"},t.prototype.TOOLTIP_RUN_AS_FAST_AS_POSSIBLE_VIRTUAL_TIME_MODE=function(){return"尽可能快地运行（虚拟时间模式）"},t.prototype.TOOLTIP_MULTI_RUN_PROGRESS=function(){return"并行运行进度"},t.prototype.TOOLTIP_RESPONSIVENESS=function(){return"响应能力和网络访问"},t.prototype.TOOLTIP_EXPERIMENT_STATE=function(){return"实验状态"},t.prototype.TOOLTIP_TOGGLE_FULL_SCREEN_MODE=function(){return"切换全屏模式"},t.prototype.TOOLTIP_DEVELOPER_PANEL=function(){return"切换开发面板"},t}(),h=function(){function t(){}return t.setLanguage=function(e){e.startsWith("en")||e.startsWith("EN")?t.msg=new l:e.startsWith("ru")||e.startsWith("RU")?t.msg=new u:(e.startsWith("zh")||e.startsWith("ZH")||e.startsWith("cn")||e.startsWith("CN"))&&(t.msg=new c)},t.msg=new l,t}(),d=function(){function t(){}return t.setDebugMode=function(){t.debugmode=!0},t.isDebugMode=function(){return t.debugmode},t.getElementCount=function(){return t.elementcount},t.createSvgElement=function(e){return t.debugmode&&t.elementcount++,document.createElementNS(t.svgns,e)},t.createXhtmlElement=function(e){return t.debugmode&&t.elementcount++,document.createElementNS(t.xhtmlns,e)},t.createTextNode=function(e){return t.debugmode&&t.elementcount++,document.createTextNode(e)},t.createUseElement=function(e){var r=t.createSvgElement("use"),i="#"+e;return r.setAttributeNS(t.xlinkns,"href",i),r},t.changeUseHref=function(e,r){e.setAttributeNS(t.xlinkns,"href","#"+r)},t.cloneElementWithId=function(e){var r=document.getElementById(e);return t.cloneElement(r)},t.cloneElement=function(e){var r=e.cloneNode(!0);return r.removeAttribute("id"),t.debugmode&&(t.elementcount+=1+t.childNodeDeepCount(r)),r},t.cloneHTMLElement=function(t){var e=document.getElementById(t).cloneNode(!0);return e.removeAttribute("id"),e.style.removeProperty("display"),e},t.removeElement=function(e){for(var r=0,i=["canvas-group","canvas-group-3d"];r<i.length;r++){var n=i[r],a=document.getElementById(n);if(a)for(var o=a.children,s=o.length-1;s>=0;s--){var l=parseInt(o[s].id),u=document.getElementById(l.toString());(e==u||e.contains(u))&&(a.removeChild(o[s]),t.debugmode&&t.elementcount--)}}t.debugmode&&(t.elementcount-=1+t.childNodeDeepCount(e)),e.remove()},t.removeAllChildren=function(e){for(;e.lastChild;)t.removeElement(e.lastChild)},t.bringElementToFront=function(t){t.parentNode.appendChild(t)},t.childElements=function(t){var e=t.children;if(!e){for(var r=t.childNodes,i=[],n=0;n<r.length;n++){var a=r[n];1==a.nodeType&&i.push(a)}return i}return e},t.indexOfChildElement=function(t,e){for(var r=0,i=t.firstElementChild;null!=i;){if(i==e)return r;r++,i=i.nextElementSibling}return-1},t.isPrimitiveSVGElement=function(t){return!(t.startsWith("Shape")||t.startsWith("Markup")||t.startsWith("Control")||t.startsWith("Chart")||t.startsWith("Window3D"))},t.isContainedInElementOfType=function(t,e){for(;t&&1==t.nodeType&&e.indexOf(t.getAttribute("type"))<0;)t=t.parentNode;return t&&1==t.nodeType},t.findChildOfType=function(e,r){for(var i=t.childElements(e),n=0;n<i.length;n++)if(i[n].getAttribute("type")==r)return i[n];return null},t.findChildWithId=function(t,e){for(var r=t.childNodes,i=0;i<r.length;i++){var n=r[i];if(n.id==e)return n}return console.log("Child with id "+e+" not found in",t),null},t.findParentOfType=function(t,e){for(var r=t.parentNode;;){if(!r||1!=r.nodeType)return null;var i=r;if(i.getAttribute("type")==e)return i;r=i.parentNode}},t.childNodeDeepCount=function(e){if(e instanceof SVGElement&&t.excludeFromNodeCount.indexOf(e.getAttribute("type"))>=0)return 0;var r=e.childNodes;if(!r)return 0;for(var i=r.length,n=0;n<r.length;n++)i+=t.childNodeDeepCount(r[n]);return i},t.createCanvas=function(e,r){var i=t.createXhtmlElement("canvas");return document.getElementById(r).appendChild(i),i.id=e+"canvas",i},t.debugmode=!1,t.elementcount=0,t.xhtmlns="http://www.w3.org/1999/xhtml",t.xlinkns="http://www.w3.org/1999/xlink",t.svgns="http://www.w3.org/2000/svg",t.excludeFromNodeCount=["ShapeSVG","shapefile"],t}(),p=function(){function t(){}return t.offsetPage=function(t){var e=t.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+i,left:e.left+r}},t.indexInParent=function(t){var e;for(e=0;t=t.previousElementSibling;e++);return e},t.touchEventExists=function(){return window.TouchEvent},t.radiansToDegrees=function(t){return 360*t/(2*Math.PI)},t.degreesToRadians=function(t){return 2*Math.PI*(t/360)},t.modulo=function(t,e){var r=t%e;return Math.floor(r>=0?r:r+e)},t.remainderPositive=function(t,e){var r=t%e;return r>=0?r:r+e},t.findNearestArrayIndex=function(t,e,r,i){void 0===i&&(i=0);var n,a=t.length,o=!1;if(r){for(var s=0;s<a;s++)if(e<t[s]-i){o=!0,n=s;break}}else for(s=a-1;s>=0;s--)if(t[s]+i<e){o=!0,n=s;break}return o?n:r?1/0:-1/0},t.snapToArrayValue=function(e,r,i,n){void 0===n&&(n=0);var a=t.findNearestArrayIndex(e,r,i,n);return a<0?e[0]:a>=e.length?e[e.length-1]:e[a]},t.formatNumber=function(t,e,r){if(void 0===r&&(r=!0),t==-1/0)return"-Infinity";if(t==1/0)return"+Infinity";if(isNaN(t))return"NaN";var i=Math.abs(t);if(i<1e-12)return r?String(0):(0).toFixed(e);if(i>9999999999||i<.001&&0!=t)return r?String(+t.toExponential(e)):t.toExponential(e);var n=r?String(+t.toFixed(e)):t.toFixed(e),a=n.indexOf(".");if(a>=0){var o=n.substring(0,a),s=n.substring(a);return o.replace(this.threeDigitGroupsRegExp,",")+s}return n.replace(this.threeDigitGroupsRegExp,",")},t.formatPercent=function(t){return+Math.round(100*t)+"%"},t.reducePrecision=function(t){return+t.toPrecision(4)},t.fixedPrecision=function(t,e){return+t.toFixed(e)},t.goodGridStep=function(t,e,r){var i=t/Math.floor(e/r),n=Math.pow(10,Math.ceil(Math.log(t)/Math.log(10))-1),a=n/5;return a<i&&(a=n/2)<i&&(a=n)<i&&(a=2*n)<i&&(a=5*n),a},t.dateComponent=function(e,r){switch(r){case"yyyy":case"YYYY":case"y":return e.getFullYear().toString();case"yy":case"YY":return e.getFullYear().toString().substring(2);case"w":return t.getWeek(e).toString();case"MMM":switch(e.getMonth()+1){case 1:return h.msg.JAN();case 2:return h.msg.FEB();case 3:return h.msg.MAR();case 4:return h.msg.APR();case 5:return h.msg.MAY();case 6:return h.msg.JUN();case 7:return h.msg.JUL();case 8:return h.msg.AUG();case 9:return h.msg.SEP();case 10:return h.msg.OCT();case 11:return h.msg.NOV();case 12:return h.msg.DEC();default:return""}case"a":return""}var i;switch(r){case"MM":case"M":i=e.getMonth()+1;break;case"dd":case"DD":case"d":i=e.getDate();break;case"hh":case"HH":case"h":i=e.getHours();break;case"mm":case"m":i=e.getMinutes();break;case"ss":case"s":i=e.getSeconds()}return null!=i?i<10?"0"+i:i.toString():""},t.getWeek=function(t){var e=new Date(t.getFullYear(),0,1);return Math.ceil(((t.valueOf()-e.valueOf())/864e5+e.getDay()+1)/7)},t.formatDate=function(e,r){if(isNaN(e.getTime()))return"[invalid date]";r||(r=t.getLocalDateFormat());for(var i=r,n=0,a=t.dateFormatPatternLists;n<a.length;n++)for(var o=0,s=a[n];o<s.length;o++){var l=s[o];if(i.indexOf(l)>=0){i=i.replace(l,t.dateComponent(e,l));break}}return i},t.getLocalDateFormat=function(){if(!this.localDateFormat){var t=new Date(1917,10,7).toLocaleDateString();this.localDateFormat=t.replace(/\d+/g,function(t){switch(parseInt(t)%100){case 17:return t.replace(/.{1}/g,"Y");case 11:return"MM";case 7:return"DD"}}),this.localDateFormat+=" HH:mm"}return this.localDateFormat},t.replaceTabsWithSpaces=function(t,e){for(var r;!((r=t.indexOf("\t"))<0);){var i=" ".repeat(e-r%e);t=t.substring(0,r).concat(i,t.substring(r+1))}return t},t.timeUnitToString=function(t){switch(t){case"MILLISECOND":return h.msg.MILLISECOND();case"SECOND":return h.msg.SECOND();case"MINUTE":return h.msg.MINUTE();case"HOUR":return h.msg.HOUR();case"DAY":return h.msg.DAY();case"WEEK":return h.msg.WEEK();case"MONTH":return h.msg.MONTH();case"YEAR":return h.msg.YEAR()}return t},t.toMilliseconds=function(e,r){switch(r){case"MILLISECOND":return e;case"SECOND":return e*t.SECOND;case"MINUTE":return e*t.MINUTE;case"HOUR":return e*t.HOUR;case"DAY":return e*t.DAY;case"WEEK":return e*t.WEEK;case"MONTH":return e*t.MONTH;case"YEAR":return e*t.YEAR}},t.formatTimeInterval=function(e,r){if(e<=0)return"0 "+t.timeUnitToString(r);for(var i=t.toMilliseconds(e,r),n=0,a=t.niceTimeUnits;n<a.length;n++){var o=a[n],s=t.toMilliseconds(1,o);if(i>.5*s)return t.formatNumber(i/s,2,!1)+" "+t.timeUnitToString(o)}return t.formatNumber(i,2,!1)+" "+t.timeUnitToString("MILLISECOND")},t.setMultipleAttributes=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],null==r[i]?"":r[i].toString())},t.getAttributeValue=function(t,e,r){var i=t.indexOf(r);return i<0?null:e[i]},t.removeAttribute=function(t,e,r){for(var i=0;i<t.length;i++)if(t[i]==r)return t.splice(i,1),void e.splice(i,1)},t.getSubAttribute=function(t,e){for(var r=0;r<t.length;r++){var i=t[r].split(":");if(2==i.length&&i[0]==e)return i[1]}return null},t.getFloatSubAttribute=function(e,r){var i=t.getSubAttribute(e,r);if(null==i)return null;var n=parseFloat(i);return isNaN(n)?null:n},t.getIntAttribute=function(t,e){var r=parseInt(t.getAttribute(e));return isNaN(r)?null:r},t.getFloatAttribute=function(t,e){var r=parseFloat(t.getAttribute(e));return isNaN(r)?null:r},t.splitSkipEmpty=function(e,r){return e.split(r).filter(t.isEmpty)},t.isEmpty=function(t){return t.length>0},t.splitToFloats=function(e,r){return t.splitSkipEmpty(e,r).map(function(t){return parseFloat(t)})},t.splitToInts=function(e,r){return t.splitSkipEmpty(e,r).map(function(t){return parseInt(t)})},t.hyphenToCameLCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.parseFloatIgnoreCommas=function(t){return parseFloat(t.replace(/,/g,""))},t.increaseTransparency=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=i[4]?i[4]:1;return"rgba("+i[1]+","+i[2]+","+i[3]+","+r*n+")"},t.removeTransparency=function(e){var r=t.rgbRegExp.exec(e);return r||(r=t.rgbaRegExp.exec(e)),r?"rgb("+r[1]+","+r[2]+","+r[3]+")":e},t.changeBrightness=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=parseInt(i[1]),a=parseInt(i[2]),o=parseInt(i[3]);if(r<=1)n*=r,a*=r,o*=r;else{var s=1-1/r;n+=(255-n)*s,a+=(255-a)*s,o+=(255-o)*s}return n=Math.round(n),a=Math.round(a),o=Math.round(o),i[4]?"rgba("+n+","+a+","+o+","+i[4]+")":"rgb("+n+","+a+","+o+")"},t.applyTransformAttribute=function(t,e){null==e||""==e?t.removeAttribute("transform"):t.setAttribute("transform",e)},t.posOrScaleToTransform=function(e,r,i){var n="",a="",o=e.getAttribute("transform"),s=null==o?-1:o.indexOf("scale");if("pos"==r){var l=t.splitToFloats(i,":"),u=l[0],c=l[1],h=t.radiansToDegrees(l[2]);0==u&&0==c||(n="translate("+u+" "+c+") "),0!=h&&(n+="rotate("+h+") "),a=s>=0?o.substring(s):""}else{var d=t.splitToFloats(i,":"),p=d[0],f=d[1];1==p&&1==f||(a="scale("+p+" "+f+")"),n=null==o||0==s?"":s<0?o:o.substring(0,s)}return""==(o=n+a)?null:o},t.parseTransform=function(e){var r=0,i=0,n=0,a=1,o=1;if(null!=e&&null!=e){var s=t.translateXYRegExp.exec(e);null!=s?i=parseFloat(s[2]):s=t.translateXRegExp.exec(e),null!=s&&(r=parseFloat(s[1])),null!=(s=t.rotateRegExp.exec(e))&&(n=t.degreesToRadians(parseFloat(s[1]))),null!=(s=t.scaleXYRegExp.exec(e))?(a=parseFloat(s[1]),o=parseFloat(s[2])):null!=(s=t.scaleRegExp.exec(e))&&(o=a=parseFloat(s[1]))}return[r,i,n,a,o]},t.constructTransform=function(e,r,i,n,a){if(0==e&&0==r&&0==i&&1==n&&1==a)return null;var o="";return 0==e&&0==r||(o+="translate("+e+","+r+") "),0!=i&&(o+="rotate("+t.radiansToDegrees(i)+") "),1==n&&1==a||(o+=a==n?"scale("+n+") ":"scale("+n+","+a+") "),o},t.setTransformScale=function(e,r){var i=t.parseTransform(e);return t.constructTransform(i[0],i[1],i[2],r,r)},t.adjustTransformScale=function(e,r,i){var n=t.parseTransform(e);return t.constructTransform(n[0],n[1],n[2],n[3]*r,n[4]*i)},t.pathAngleAt=function(t,e){var r=t.getTotalLength();e=Math.max(3,e),e=Math.min(e,r);var i=Math.max(0,e-3),n=t.getPointAtLength(e),a=t.getPointAtLength(i);return Math.atan2(n.y-a.y,n.x-a.x)},t.addPathArrows=function(e,r,i,n,a,o){for(var s=e.getTotalLength(),l=a;l<s;l+=o){var u=e.getPointAtLength(l),c=e.getPointAtLength(l-3),h=t.radiansToDegrees(Math.PI/2-Math.atan2(u.x-c.x,u.y-c.y)),p=d.createUseElement(r);p.setAttribute("stroke-width",i.toString()),p.setAttribute("transform","translate("+u.x+" "+u.y+") rotate( "+h+")"),n.appendChild(p)}},t.sectorData=function(t,e,r,i,n,a){var o=Math.abs(a)>2*Math.PI?a%(2*Math.PI):a;a==2*Math.PI&&(a-=1e-4);var s=n+a,l=t+r*Math.cos(n),u=e+i*Math.sin(n),c=t+r*Math.cos(s),h=e+i*Math.sin(s);return"M "+t+" "+e+" L "+l+" "+u+" A "+r+" "+i+" 0 "+(Math.abs(o)>Math.PI?"1 ":"0 ")+(o>0?"1 ":"0 ")+c+" "+h+" Z"},t.roundPathCorners=function(t,e,r){function i(t,e,r){var i=e.x-t.x,a=e.y-t.y,o=Math.sqrt(i*i+a*a);return n(t,e,Math.min(1,r/o))}function n(t,e,r){return{x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}}function a(t,e){t.length>2&&(t[t.length-2]=e.x,t[t.length-1]=e.y)}function o(t){return{x:parseFloat(t[t.length-2]),y:parseFloat(t[t.length-1])}}var s=t.split(/[,\s]/).reduce(function(t,e){var r=e.match("([a-zA-Z])(.+)");return r?(t.push(r[1]),t.push(r[2])):t.push(e),t},[]).reduce(function(t,e){return parseFloat(e)==e&&t.length?t[t.length-1].push(e):t.push([e]),t},[]),l=[];if(s.length>1){var u=o(s[0]),c=null;"Z"==s[s.length-1][0]&&s[0].length>2&&(c=["L",u.x,u.y],s[s.length-1]=c),l.push(s[0]);for(var h=1;h<s.length;h++){var d=l[l.length-1],p=s[h],f=p==c?s[1]:s[h+1];if(f&&d&&d.length>2&&"L"==p[0]&&f.length>2&&"L"==f[0]){var m,g,v=o(d),b=o(p),y=o(f);r?(m=n(b,d.origPoint||v,e),g=n(b,f.origPoint||y,e)):(m=i(b,v,e),g=i(b,y,e)),a(p,m),p.origPoint=b,l.push(p);var A=n(m,b,.5),T=n(b,g,.5),C=["C",A.x,A.y,T.x,T.y,g.x,g.y];C.origPoint=b,l.push(C)}else l.push(p)}if(c){var S=o(l[l.length-1]);l.push(["Z"]),a(l[0],S)}}else l=s;return l.reduce(function(t,e){return t+e.join(" ")+" "},"")},t.stringToByteArray=function(t){for(var e=[],r=0,i=0;i<t.length;i++){for(var n=t.charCodeAt(i);n>255;)e[r++]=255&n,n>>=8;e[r++]=n}return e},t.byteArrayToString=function(t){if(t.length<=8192)return String.fromCharCode.apply(null,t);for(var e="",r=0;r<t.length;r+=8192){var i=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,i)}return e},t.copyToClipboard=function(t){var e=document.createElement("textarea");document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy",!1),e.remove()},t.isIOS=function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},t.showErrorMessageBox=function(t,e,r){var i=document.getElementById("svg-message-background"),n=document.getElementById("svg-message-box"),a=document.getElementById("svg-message-box-header"),o=document.getElementById("svg-message-box-title"),s=document.getElementById("svg-message-box-text"),l=document.getElementById("svg-message-box-icon-use"),u=document.getElementById("svg-message-box-close"),c=document.getElementById("svg-message-box-progress"),d=function(){i.style.display="none",r&&r()};u.classList.contains("dev-panel-control")||u.classList.add("dev-panel-control"),u.classList.remove("dev-panel-control-disabled"),u.onclick=d,i.onclick=function(t){t.target==i&&d()},i.onkeydown=function(t){"Escape"==t.code&&d()},a.className="svg-message-box-colors-error";l.setAttribute("href","#dev-panel-icon-error"),l.setAttribute("xlink:href","#dev-panel-icon-error"),o.innerText=t&&""!=t?t:h.msg.BOX_TITLE_ERROR(),e=e.replace(/\n/g,"<br>"),s.innerHTML=e,c.style.display="none";var p=document.getElementById("svg-and-dev-panel-container").parentElement.getBoundingClientRect();n.style.maxWidth=Math.round(.8*p.width)+"px",n.style.maxHeight=Math.round(.8*p.height)+"px",i.style.removeProperty("display"),i.focus()},t.threeDigitGroupsRegExp=/\B(?=(\d{3})+(?!\d))/g,t.yearPatterns=["yyyy","YYYY","yy","YY","y"],t.weekPatterns=["w"],t.datePatterns=["dd","DD","d"],t.hourPatterns=["hh","HH","h"],t.ampmPatterns=["a"],t.minutePatterns=["mm","m"],t.secondPatterns=["ss","s"],t.monthPatterns=["MMM","MM","M"],t.dateFormatPatternLists=[t.yearPatterns,t.weekPatterns,t.datePatterns,t.hourPatterns,t.ampmPatterns,t.minutePatterns,t.secondPatterns,t.monthPatterns],t.MILLISECOND=1,t.SECOND=1e3*t.MILLISECOND,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR,t.WEEK=7*t.DAY,t.MONTH=30*t.DAY,t.YEAR=365*t.DAY,t.niceTimeUnits=["YEAR","DAY","HOUR","MINUTE","SECOND"],t.rgbRegExp=/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,t.rgbaRegExp=/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*.?\d*)\s*\)\s*$/i,t.translateXRegExp=/translate\s*\(\s*(-?\d*.?\d*)\s*\)/i,t.translateXYRegExp=/translate\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)/i,t.rotateRegExp=/rotate\s*\(\s*(-?\d*.?\d*)\s*\)/i,t.scaleRegExp=/scale\s*\(\s*(-?\d*.?\d*)\s*\)/i,t.scaleXYRegExp=/scale\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)/i,t}(),f=function(){function t(t,e,r,i,n,a,o){var s=this;void 0===o&&(o=null),this.over=!1,this.inClick=!1,this.xydown=[0,0],this.shape=t,this.onover=e,this.onout=r,this.ondown=i,this.onclick=n,this.ondblclick=o,this.ignorecondition=a;var l=function(t){return s.onEvent(t)};this.shape.addEventListener("mouseover",l),this.shape.addEventListener("mouseout",l),this.shape.addEventListener("mousedown",l),this.shape.addEventListener("mouseup",l),null!=this.ondblclick&&this.shape.addEventListener("dblclick",l),this.shape.addEventListener("touchstart",l),this.shape.addEventListener("touchmove",l),this.shape.addEventListener("touchend",l),this.shape.style.pointerEvents="auto"}return t.prototype.onEvent=function(e){var r=this;if(null==this.ignorecondition||!this.ignorecondition(e))if(e instanceof MouseEvent){var i=e;switch(i.type){case"mouseover":this.over||null==this.onover||this.onover(i),this.over=!0;break;case"mouseout":this.shape.contains(i.relatedTarget)||(this.over=!1,this.inClick=!1,null!=this.onout&&this.onout(i));break;case"mousedown":1==i.which&&(i.preventDefault(),this.inClick=!0,this.xydown=[i.pageX,i.pageY],null!=this.ondown&&this.ondown(i));break;case"mouseup":if(this.inClick&&1==i.which){i.preventDefault(),this.inClick=!1;var n=i.pageX-this.xydown[0],a=i.pageY-this.xydown[1];Math.sqrt(n*n+a*a)<=t.clickTolerance&&null!=this.onclick&&(null!=this.ondblclick?(clearTimeout(this.onclickTimeoutId),this.onclickTimeoutId=setTimeout(function(){return r.onclick(i)},t.DBLCLICK_TIMEOUT)):this.onclick(i)),null!=this.onover&&this.onover(i)}break;case"dblclick":null!=this.ondblclick&&(clearTimeout(this.onclickTimeoutId),this.ondblclick(i))}}else if(p.touchEventExists()&&e instanceof TouchEvent){var o=e;switch(o.type){case"touchstart":1==o.touches.length?(o.preventDefault(),this.inClick=!0,this.xydown=[o.touches[0].pageX,o.touches[0].pageY],null!=this.onover&&this.onover(o)):this.inClick=!1;break;case"touchmove":this.inClick=!1,null!=this.onout&&this.onout(o);break;case"touchend":n=o.changedTouches[0].pageX-this.xydown[0],a=o.changedTouches[0].pageY-this.xydown[1];Math.sqrt(n*n+a*a)<=t.clickTolerance&&null!=this.onclick&&this.inClick&&0==o.touches.length&&(o.preventDefault(),this.onclick(o)),this.inClick=!1,null!=this.onout&&this.onout(o)}}},t.eventPageXY=function(t){var e,r;if(t instanceof MouseEvent){var i=t;e=i.pageX,r=i.pageY}else{var n=t;n.touches.length>0?(e=n.touches[0].pageX,r=n.touches[0].pageY):(e=n.changedTouches[0].pageX,r=n.changedTouches[0].pageY)}return[e,r]},t.clickTolerance=2,t.DBLCLICK_TIMEOUT=300,t}(),m=function(){function t(t,e){this.frameDrawing=t,this.control=e}return t.createControlList=function(){var e=n.cloneElementWithId("control-list"),r=function(e){return t.onControlListMouseEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("wheel",r);var i=n.findChildOfType(e,"svg"),a=n.findChildOfType(i,"scrollbargroup"),o=function(e){return t.onControlListScrollbarMouseEvent(e)};return a.addEventListener("mouseout",o),a.addEventListener("mousedown",o),a.addEventListener("mouseup",o),a.addEventListener("mousemove",o),a.addEventListener("click",o),e},t.prototype.updateControlList=function(e,r,i){for(var o=n.findChildOfType(e,"svg"),s=n.findChildOfType(e,"border"),l=n.findChildOfType(o,"background"),u=n.findChildOfType(o,"itemgroup"),c=(n.findChildOfType(o,"scrollbargroup"),0);c<r.length;c++)switch(r[c]){case"enabled":e.setAttribute(r[c],i[c]);for(var h="true"==i[c],d=n.childElements(u),p=0;p<d.length;p++)t.updateControlListItemLook(d[p],!1,!1);s.setAttribute("class",h?"control-border":"control-border-disabled");break;case"text-array":n.removeAllChildren(u),u.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var f=a.splitSkipEmpty(i[c],"\n"),m=0,g=0;for(p=0;p<f.length;p++){var v=n.cloneElementWithId("list-item");n.findChildOfType(v,"background").setAttribute("fill",l.getAttribute("fill")),(C=n.findChildOfType(v,"text")).firstChild.textContent=f[p],e.hasAttribute("text-color")&&C.setAttribute("fill",e.getAttribute("text-color")),u.appendChild(v);var b=C.getBBox();m<b.width&&(m=b.width),g<b.height&&(g=b.height)}d=n.childElements(u);var y=Math.max(m+4,a.getFloatAttribute(o,"width")),A=Math.max(20,1.35*g);e.setAttribute("item-height",A.toString());for(p=0;p<d.length;p++)this.setupControlListItem(d[p],A*p,y,A,g);t.updateControlListScrollbar(e);break;case"background-color":l.setAttribute("fill",i[c]);break;case"text-color":e.setAttribute(r[c],i[c]);break;case"font-style":e.style.font=i[c];break;case"width":case"height":o.setAttribute(r[c],i[c]),l.setAttribute(r[c],i[c]),s.setAttribute(r[c],i[c]),o.hasAttribute("width")&&o.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[c],i[c]);break;case"value":var T=a.splitSkipEmpty(i[c],"\n");d=n.childElements(u),e.setAttribute("last-clicked","0");for(p=0;p<d.length;p++){v=d[p];var C=n.findChildOfType(v,"text"),S=T.indexOf(C.firstChild.textContent)>=0;v.setAttribute("selected",S),t.updateControlListItemLook(v,!1,!1),S&&e.setAttribute("last-clicked",p.toString())}break;default:e.setAttribute(r[c],i[c])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=n.findChildOfType(t,"svg"),i=n.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var o=i*a.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[o.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=n.findChildOfType(r,"border"),a=n.findChildOfType(r,"svg"),o=n.findChildOfType(a,"itemgroup"),s=n.findChildOfType(a,"scrollbargroup"),l=n.childElements(o);switch(e.type){case"mouseover":if("control-border-hover"!=i.getAttribute("class")){i.setAttribute("class","control-border-hover"),s.setAttribute("class","control-opaque1");for(var u=0;u<l.length;u++)t.updateControlListItemLook(l[u],!0,!1)}break;case"mouseout":if(r.contains(e.relatedTarget))return;i.setAttribute("class","control-border"),s.setAttribute("class","control-opaque0");for(u=0;u<l.length;u++)t.updateControlListItemLook(l[u],!1,!1);break;case"wheel":e.altKey||e.ctrlKey||(e.stopPropagation(),e.preventDefault(),t.scrollControlList(r,e.deltaY<0?1:-1))}}},t.scrollControlList=function(t,e){var r=n.findChildOfType(t,"svg"),i=n.findChildOfType(r,"itemgroup"),o=i.childElementCount;if(0!=o){var s=a.getFloatAttribute(r,"height"),l=a.getFloatAttribute(t,"item-height"),u=o*l,c=i.getAttribute("transform"),h=a.parseTranslateTransform(c)[1];h+=e*l,h=Math.max(-u+s,h),h=Math.min(h,0),h=Math.round(h),i.setAttribute("transform","translate(0,"+h+")");var d=n.findChildOfType(r,"scrollbargroup"),p=n.findChildOfType(d,"handle"),f=a.getFloatAttribute(p,"height"),m=(s/2-h)/u,g=Math.max(2,s*m-f/2);g=Math.min(s-f-2,g),p.setAttribute("y",g.toString())}},t.prototype.setupControlListItem=function(t,e,r,i,o){var s=this,l=n.findChildOfType(t,"background"),u=n.findChildOfType(t,"text");t.setAttribute("transform","translate(0,"+e+")"),a.setMultipleAttributes(l,["width","height"],[r,i]),a.setMultipleAttributes(u,["x","y"],[2,i/2+.3*o]);var c=function(t){return s.onControlListItemMouseEvent(t)};t.addEventListener("mouseover",c),t.addEventListener("mouseout",c),t.addEventListener("click",c)},t.prototype.onControlListItemMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode,o=i.parentNode.parentNode;if("false"!=o.getAttribute("enabled"))switch(e.type){case"mouseover":t.updateControlListItemLook(r,!0,!0);break;case"mouseout":t.updateControlListItemLook(r,!0,!1);break;case"click":e.stopPropagation(),e.preventDefault();var s="true"==o.getAttribute("multiple"),l=n.childElements(i),u=a.indexInParent(r),c="true"==r.getAttribute("selected");if(s)if(e.ctrlKey)r.setAttribute("selected",String(!c)),t.updateControlListItemLook(r,!0,!0);else if(e.shiftKey){var h=a.getIntAttribute(o,"last-clicked");for(d=0;d<l.length;d++)c=h<=u?h<=d&&d<=u:u<=d&&d<=h,l[d].setAttribute("selected",c),t.updateControlListItemLook(l[d],!0,d==u)}else for(d=0;d<l.length;d++)l[d].setAttribute("selected",d==u),t.updateControlListItemLook(l[d],!0,d==u);else{c=!e.ctrlKey||!c;for(var d=0;d<l.length;d++)l[d].setAttribute("selected",d==u&&c),t.updateControlListItemLook(l[d],!0,d==u)}o.setAttribute("last-clicked",u.toString());var p="";for(d=0;d<l.length;d++){if("true"==l[d].getAttribute("selected"))p+=n.findChildOfType(l[d],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(o,p)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,a=n.findChildOfType(t,"background"),o=n.findChildOfType(t,"text"),s="true"==i.getAttribute("enabled"),l="true"==t.getAttribute("selected");if(!s)return a.setAttribute("class",l?"control-background-selected-disabled":""),void o.setAttribute("class","control-text-disabled");e?(r?a.setAttribute("class",l?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):a.setAttribute("class",l?"control-list-background-selected-hover":""),o.setAttribute("class",l?"control-text-selected-hover":"")):(a.setAttribute("class",l?"control-list-background-selected":""),o.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=n.findChildOfType(e,"svg"),i=n.findChildOfType(r,"scrollbargroup"),o=n.findChildOfType(i,"scrollbar"),s=n.findChildOfType(i,"handle"),l=a.getFloatAttribute(r,"width"),u=a.getFloatAttribute(r,"height"),c=l-a.getFloatAttribute(o,"width");o.setAttribute("x",c.toString()),o.setAttribute("height",u.toString()),s.setAttribute("x",(c+2).toString()),s.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=n.findChildOfType(t,"svg"),i=n.findChildOfType(r,"scrollbargroup"),o=(n.findChildOfType(i,"scrollbar"),n.findChildOfType(i,"handle")),s=a.getFloatAttribute(r,"height"),l=n.findChildOfType(r,"itemgroup").childElementCount,u=0;e=l>0&&s<(u=l*a.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e&&o.setAttribute("height",Math.max(s*(s/u)-4,7).toString())},t.onControlListScrollbarMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode.parentNode;if("false"!=i.getAttribute("enabled")){var o=n.findChildOfType(r,"scrollbar"),s=a.getFloatAttribute(o,"height"),l=o.getBoundingClientRect().height/s,u=a.offsetPage(o),c=(e.pageY-u.top)/l,h=n.findChildOfType(r,"handle"),d=a.getFloatAttribute(h,"y");switch(e.type){case"mouseout":case"mouseup":t.controlListScrollbarButtonDown=0;break;case"mousedown":1==e.which&&e.target==h&&(e.stopPropagation(),t.controlListScrollbarButtonDown=1,t.controlListScrollbarMousePos=c);break;case"mousemove":if(1==t.controlListScrollbarButtonDown){e.stopPropagation();var p=c-t.controlListScrollbarMousePos,f=n.findChildOfType(i,"svg"),m=n.findChildOfType(f,"itemgroup").childElementCount,g=a.getFloatAttribute(i,"item-height"),v=p*(m*g/s)/g;t.scrollControlList(i,-v),t.controlListScrollbarMousePos=c}break;case"click":if(e.stopPropagation(),e.preventDefault(),e.target==o){v=Math.floor(s/a.getFloatAttribute(i,"item-height"));t.scrollControlList(i,c<d?v:-v)}}}},t.controlListScrollbarButtonDown=0,t}(),g=function(){function t(t){this.frameDrawing=t,this.controlList=new m(t,this)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return o.createUnsupportedObject("File chooser is not supported in the Cloud mode");case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":t.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":o.updateUnsupportedObject(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=n.cloneElementWithId("control-button");return new f(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var a=n.findChildOfType(e,"background"),o=n.findChildOfType(e,"text"),s=0;s<r.length;s++)switch(r[s]){case"enabled":e.setAttribute(r[s],i[s]);var l="true"==i[s];a.setAttribute("class",l?"control-background":"control-background-disabled"),o.setAttribute("class",l?"control-button-text":"control-text-disabled");break;case"text":o.firstChild.textContent=i[s];break;case"background-color":break;case"text-color":o.setAttribute("fill",i[s]);break;case"font-style":o.style.font=i[s],t.centerControlText(o,a,!0,!0);break;case"width":case"height":var u=parseFloat(i[s])-2;a.setAttribute(r[s],u.toString()),t.centerControlText(o,a,!0,!0);break;default:e.setAttribute(r[s],i[s])}},t.onButtonOver=function(t){var e=n.findChildOfType(t,"background"),r=n.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=n.findChildOfType(t,"background"),r=n.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=n.findChildOfType(t,"background"),r=n.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.onControlAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=n.cloneElementWithId("control-checkbox");return new f(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var a=n.findChildOfType(e,"background"),o=n.findChildOfType(e,"box"),s=n.findChildOfType(e,"check"),l=n.findChildOfType(e,"text"),u=0;u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];o.setAttribute("class",c?"control-checkbox-box":"control-checkbox-box-disabled"),s.setAttribute("class",c?"control-checkbox-check":"control-checkbox-check-disabled"),l.setAttribute("class",c?"":"control-text-disabled");break;case"text":l.firstChild.textContent=i[u];break;case"background-color":a.setAttribute("fill",i[u]);break;case"text-color":l.setAttribute("fill",i[u]);break;case"font-style":l.style.font=i[u],t.centerControlText(l,a,!1,!0);break;case"width":a.setAttribute(r[u],i[u]);break;case"height":a.setAttribute(r[u],i[u]);var h=parseFloat(i[u]);o.setAttribute("y",(h/2-8).toString()),s.setAttribute("transform","translate(0,"+(h/2-8)+")"),t.centerControlText(l,a,!1,!0);break;case"value":s.setAttribute("visibility","true"==i[u]?"inherit":"hidden");break;default:e.setAttribute(r[u],i[u])}},t.onCheckboxOver=function(t){var e=n.findChildOfType(t,"box"),r=n.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=n.findChildOfType(t,"box"),r=n.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=n.findChildOfType(t,"box"),r=n.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=n.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.onControlAction(t.id,r)},t.prototype.createSlider=function(){var t=this,e=n.cloneElementWithId("control-slider"),r=function(e){return t.onSliderEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r),e},t.updateSlider=function(e,r,i){for(var o=n.findChildOfType(e,"sensor"),s=n.findChildOfType(e,"background"),l=n.findChildOfType(e,"line"),u=n.findChildOfType(e,"progress"),c=n.findChildOfType(e,"handle"),h=(n.findChildOfType(e,"value"),0);h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var d="true"==i[h];l.setAttribute("class",d?"control-background":"control-background-disabled"),u.setAttribute("class",d?"control-slider-progress":"control-background-selected-disabled"),c.setAttribute("class",d?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":s.setAttribute("fill",i[h]);break;case"width":case"height":s.setAttribute(r[h],i[h]);break;case"vertical":e.setAttribute(r[h],i[h]);var p=a.getFloatAttribute(s,"width"),f=a.getFloatAttribute(s,"height");a.setMultipleAttributes(o,["x","y","width","height"],[String(-1e3),String(-1e3),String(p+2e3),String(f+2e3)]);var m=void 0,g=void 0,v=void 0,b=void 0,y=void 0,A=void 0,T=void 0,C=void 0,S=void 0,E=void 0;"false"==i[h]?(y=m=0,A=g=f/2-2,v=p,T=0,C=b=4,S=0,E=f/2):(y=m=p/2-2,g=0,A=f,T=v=4,b=f,C=0,S=p/2,E=f),a.setMultipleAttributes(l,["x","y","width","height"],[m,g,v,b]),a.setMultipleAttributes(u,["x","y","width","height"],[y,A,T,C]),a.setMultipleAttributes(c,["cx","cy"],[S,E]);break;case"value":var w=a.getFloatAttribute(e,"min"),k=a.getFloatAttribute(e,"max");p=a.getFloatAttribute(s,"width"),f=a.getFloatAttribute(s,"height");var x="true"==e.getAttribute("vertical")?f:p,M=(parseFloat(i[h])-w)/(k-w)*x;t.setSliderHandlePosition(e,M);break;default:e.setAttribute(r[h],i[h])}},t.prototype.onSliderEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=n.findChildOfType(r,"background"),o=n.findChildOfType(r,"progress"),s=a.getFloatAttribute(i,"width"),l=a.getFloatAttribute(i,"height"),u=i.getBoundingClientRect(),c=u.width/s,h=u.height/l,d=a.offsetPage(i),p="true"==r.getAttribute("vertical");if(e.type.startsWith("mouse")||"wheel"==e.type){var f=e,m=(f.pageX-d.left)/c,g=(f.pageY-d.top)/h,v=p?l-g:m;switch(e.type){case"mouseover":e.stopPropagation(),t.onSliderOver(r);break;case"mouseout":if(r.contains(f.relatedTarget))return;1==t.sliderButtonDown&&(t.setSliderHandlePosition(r,v),this.confirmSliderValue(r)),t.sliderButtonDown=0,t.onSliderOut(r);break;case"mousedown":t.sliderButtonDown=f.which,1==t.sliderButtonDown&&(e.stopPropagation(),t.onSliderHandleGrabbed(r,v));break;case"mousemove":1==t.sliderButtonDown&&(e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,v));break;case"mouseup":1==t.sliderButtonDown&&(e.stopPropagation(),this.onSliderHandleReleased(r)),t.sliderButtonDown=0;break;case"wheel":if(!f.altKey&&!f.ctrlKey){var b=e;e.stopPropagation(),e.preventDefault();var y=a.getFloatAttribute(o,p?"height":"width");t.setSliderHandlePosition(r,y+(b.deltaY<0?1:-1)),this.confirmSliderValue(r)}}}else if(e.type.startsWith("touch")){var A=e;if(A.touches.length>1)return void this.onSliderHandleReleased(r);var T="touchend"==e.type?A.changedTouches[0]:A.touches[0];m=void 0,g=void 0;m=(T.pageX-d.left)/c,g=(T.pageY-d.top)/h;v=p?l-g:m;switch(e.type){case"touchstart":e.stopPropagation(),t.onSliderOver(r),t.onSliderHandleGrabbed(r,v);break;case"touchmove":e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,v);break;case"touchend":e.stopPropagation(),this.onSliderHandleReleased(r),t.onSliderOut(r)}}}},t.onSliderOver=function(e){var r=n.findChildOfType(e,"line"),i=n.findChildOfType(e,"progress"),a=n.findChildOfType(e,"handle"),o=n.findChildOfType(e,"value");r.setAttribute("class","control-slider-line-hover"),i.setAttribute("class","control-fill-color-transition"),a.setAttribute("class",1==t.sliderButtonDown?"control-slider-handle-pressed":"control-slider-handle-hover"),o.setAttribute("class","control-opaque1")},t.onSliderOut=function(t){var e=n.findChildOfType(t,"sensor"),r=n.findChildOfType(t,"line"),i=n.findChildOfType(t,"progress"),a=n.findChildOfType(t,"handle"),o=n.findChildOfType(t,"value");e.setAttribute("visibility","hidden"),r.setAttribute("class","control-background"),i.setAttribute("class","control-slider-progress"),a.setAttribute("r","8"),a.setAttribute("class","control-slider-handle"),o.setAttribute("class","control-opaque0")},t.onSliderHandleGrabbed=function(e,r){var i=n.findChildOfType(e,"sensor"),a=n.findChildOfType(e,"handle");n.bringElementToFront(e),a.setAttribute("r","7"),a.setAttribute("class","control-slider-handle-pressed"),i.setAttribute("visibility","inherit"),t.setSliderHandlePosition(e,r)},t.prototype.onSliderHandleReleased=function(t){var e=n.findChildOfType(t,"sensor"),r=n.findChildOfType(t,"handle");r.setAttribute("r","8"),r.setAttribute("class","control-slider-handle-hover"),e.setAttribute("visibility","hidden"),this.confirmSliderValue(t)},t.setSliderHandlePosition=function(t,e){var r=n.findChildOfType(t,"background"),i=n.findChildOfType(t,"progress"),o=n.findChildOfType(t,"handle"),s=n.findChildOfType(t,"value"),l=a.getFloatAttribute(r,"width"),u=a.getFloatAttribute(r,"height"),c="true"==t.getAttribute("vertical"),h=c?u:l;e=Math.min(h,Math.max(e,0));var d,p=a.getFloatAttribute(t,"min"),f=a.getFloatAttribute(t,"max"),m=a.getFloatAttribute(t,"step");d=m>0?p+Math.round(e/h*(f-p)/m)*m:p+e/h*(f-p),e=((d=Math.min(d,f))-p)/(f-p)*h,c?(i.setAttribute("y",(h-e).toString()),i.setAttribute("height",e.toString()),o.setAttribute("cy",(h-e).toString())):(i.setAttribute("width",e.toString()),o.setAttribute("cx",e.toString()));var g=s.firstElementChild,v=s.lastElementChild;v.firstChild.textContent=a.formatNumber(d,void 0);var b=v.getComputedTextLength()+10;g.setAttribute("width",b.toString()),g.setAttribute("x",(5-b).toString());var y=c?l/2-9:e-14,A=c?u-e-15-10:u/2-15-4;s.setAttribute("transform","translate("+y+","+A+")"),t.setAttribute("current-value",d)},t.prototype.confirmSliderValue=function(t){var e=a.getFloatAttribute(t,"current-value");e!=a.getFloatAttribute(t,"last-value")&&(this.frameDrawing.onControlAction(t.id,e),t.setAttribute("last-value",e.toString()))},t.createRadioButtonGroup=function(){return n.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var o=this,s=0;s<r.length;s++)switch(r[s]){case"enabled":e.setAttribute(r[s],i[s]);for(var l="true"==i[s],u=n.childElements(e),c=0;c<u.length;c++){var h=u[c],d=n.findChildOfType(h,"circle"),p=n.findChildOfType(h,"check"),m=n.findChildOfType(h,"text");d.setAttribute("class",l?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),p.setAttribute("class",l?"control-radiobutton-check":"control-text-disabled"),m.setAttribute("class",l?"":"control-text-disabled")}break;case"text-array":var g=i[s].split("\n"),v=function(r){var i=n.cloneElementWithId("radio-button"),a=n.findChildOfType(i,"background");e.hasAttribute("background-color")&&a.setAttribute("fill",e.getAttribute("background-color"));var s=n.findChildOfType(i,"text");s.firstChild.textContent=g[r],e.hasAttribute("text-color")&&s.setAttribute("fill",e.getAttribute("text-color")),new f(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return o.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(c=0;c<g.length;c++)v(c);break;case"background-color":case"text-color":e.setAttribute(r[s],i[s]);break;case"font-style":e.style.font=i[s];break;case"width":case"height":e.setAttribute(r[s],i[s]);break;case"vertical":var b=a.getFloatAttribute(e,"width"),y=a.getFloatAttribute(e,"height"),A=0;u=n.childElements(e);for(c=0;c<u.length;c++){h=u[c];var T=n.findChildOfType(h,"background"),C=(m=n.findChildOfType(h,"text")).getBBox();if("true"==i[s]){var S=Math.max(25,1.5*C.height);h.setAttribute("transform","translate(0,"+S*c+")"),a.setMultipleAttributes(T,["width","height"],[b,S])}else{var E=20+C.width+10;h.setAttribute("transform","translate("+A+",0)"),a.setMultipleAttributes(T,["width","height"],[E,y]),A+=E}t.centerRadioButton(h)}break;case"value":var w=parseInt(i[s]);u=n.childElements(e);for(c=0;c<u.length;c++){h=u[c];(p=n.findChildOfType(h,"check")).setAttribute("visibility",w==c?"inherit":"hidden")}break;default:e.setAttribute(r[s],i[s])}},t.onRadioButtonOver=function(t){var e=n.findChildOfType(t,"circle"),r=n.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=n.findChildOfType(t,"circle"),r=n.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=n.findChildOfType(t,"circle"),r=n.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=n.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=n.childElements(r),a=0;a<i.length;a++){var o=i[a];n.findChildOfType(o,"check").setAttribute("visibility",o==t?"inherit":"hidden"),o==t&&(e=a)}this.frameDrawing.onControlAction(r.id,e)}},t.centerRadioButton=function(e){var r=n.findChildOfType(e,"background"),i=n.findChildOfType(e,"circle"),o=n.findChildOfType(e,"check"),s=n.findChildOfType(e,"text"),l=a.getFloatAttribute(r,"height");i.setAttribute("cy",(l/2).toString()),o.setAttribute("cy",(l/2).toString()),t.centerControlText(s,r,!1,!0)},t.createListBox=function(){return m.createControlList()},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var t=this,e=n.cloneElementWithId("control-combobox"),r=function(e){return t.onComboBoxEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("click",r);var i=m.createControlList();return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),e.appendChild(i),e},t.prototype.updateComboBox=function(e,r,i){for(var o=n.findChildOfType(e,"svg"),s=n.findChildOfType(e,"border"),l=n.findChildOfType(e,"dropdown"),u=n.findChildOfType(o,"background"),c=n.findChildOfType(o,"text"),h=n.findChildOfType(o,"arrowback"),d=n.findChildOfType(o,"arrow"),p=0;p<r.length;p++)switch(r[p]){case"enabled":e.setAttribute(r[p],i[p]);var f="true"==i[p];c.setAttribute("class",f?"":"control-text-disabled"),s.setAttribute("class",f?"control-border":"control-border-disabled"),f||l.setAttribute("visibility","hidden"),this.controlList.updateControlList(l,[r[p]],[i[p]]);break;case"text-array":var m=a.splitSkipEmpty(i[p],"\n"),g=m.length>0?m[0]:"";c.firstChild.textContent=g,this.controlList.updateControlList(l,[r[p]],[i[p]]),this.controlList.adjustControlListHeightToItems(l,5),this.controlList.updateControlList(l,["value"],[g]);break;case"background-color":u.setAttribute("fill",i[p]),this.controlList.updateControlList(l,[r[p]],[i[p]]);break;case"text-color":c.setAttribute("fill",i[p]),this.controlList.updateControlList(l,[r[p]],[i[p]]);break;case"font-style":e.style.font=i[p],t.centerControlText(c,u,!1,!0),this.controlList.updateControlList(l,[r[p]],[i[p]]);break;case"width":case"height":var v=parseFloat(i[p]);if(o.setAttribute(r[p],i[p]),u.setAttribute(r[p],i[p]),s.setAttribute(r[p],i[p]),"width"==r[p])h.setAttribute("x",(v-20).toString()),this.controlList.updateControlList(l,[r[p]],[i[p]]);else{t.centerControlText(c,u,!1,!0),h.setAttribute("height",v.toString()),l.setAttribute("transform","translate(0,"+i[p]+")");var b=5*parseFloat(i[p]);this.controlList.updateControlList(l,["height"],[b.toString()])}if(o.hasAttribute("width")&&o.hasAttribute("height")){var y=a.getFloatAttribute(o,"width")-10,A=a.getFloatAttribute(o,"height")/2;d.setAttribute("transform","translate("+y+","+A+")")}break;case"editable":e.setAttribute(r[p],i[p]);break;case"value":c.firstChild.textContent=i[p],this.controlList.updateControlList(l,[r[p]],[i[p]]);break;default:e.setAttribute(r[p],i[p])}},t.prototype.onComboBoxEvent=function(t){var e=t.currentTarget;if("false"!=e.getAttribute("enabled")){var r=n.findChildOfType(e,"svg"),i=n.findChildOfType(e,"border"),a=n.findChildOfType(e,"dropdown"),o=n.findChildOfType(r,"background"),s=n.findChildOfType(r,"text"),l=n.findChildOfType(r,"arrowback"),u=n.findChildOfType(r,"arrow"),c="true"==e.getAttribute("editable");switch(t.type){case"mouseover":i.setAttribute("class","control-border-hover"),l.setAttribute("class","control-combobox-arrow-background-hover"),u.setAttribute("class","control-fill-color-transition");break;case"mouseout":if(e.contains(t.relatedTarget))return;i.setAttribute("class","control-border"),l.setAttribute("class","control-fill-transparent-transition"),u.setAttribute("class","control-fill-transparent-transition"),a.setAttribute("visibility","hidden");break;case"mousedown":1!=t.which||!c||t.target!=o&&t.target!=s||(t.stopPropagation(),this.displayTextInputForSVG(e,"left"));break;case"click":if(!c||t.target==l||t.target==u){t.stopPropagation(),t.preventDefault(),n.bringElementToFront(e);var h="inherit"==a.getAttribute("visibility");a.setAttribute("visibility",h?"hidden":"inherit")}}}},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=n.findChildOfType(t,"svg"),i=n.findChildOfType(t,"dropdown"),a=n.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var o=e.split("\n")[0];a.firstChild.textContent=o,this.frameDrawing.onControlAction(t.id,o)},t.prototype.createTextField=function(){var e=this,r=n.cloneElementWithId("control-textfield");return new f(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r)},function(t){return e.onTextFieldDown(r)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var a=n.findChildOfType(e,"svg"),o=n.findChildOfType(e,"border"),s=n.findChildOfType(a,"background"),l=n.findChildOfType(a,"text"),u=0;u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];l.setAttribute("class",c?"":"control-text-disabled"),o.setAttribute("class",c?"control-border":"control-border-disabled");break;case"background-color":s.setAttribute("fill",i[u]);break;case"text-color":l.setAttribute("fill",i[u]);break;case"font-style":e.style.font=i[u],t.centerControlText(l,s,!1,!0);break;case"width":case"height":a.setAttribute(r[u],i[u]),s.setAttribute(r[u],i[u]),o.setAttribute(r[u],i[u]),"width"==r[u]&&l.setAttribute("x",(parseFloat(i[u])-2).toString()),t.centerControlText(l,s,!1,!0);break;case"value":l.firstChild.textContent=i[u];break;default:e.setAttribute(r[u],i[u])}},t.onTextFieldOver=function(t){n.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){n.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t){this.displayTextInputForSVG(t,"right")},t.createProgressBar=function(){return n.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var o=e.firstElementChild,s=n.findChildOfType(o,"background"),l=n.findChildOfType(o,"progress"),u=n.findChildOfType(o,"text"),c=n.findChildOfType(o,"border"),h=0;h<r.length;h++)switch(r[h]){case"background-color":s.setAttribute("fill",i[h]);break;case"text-color":u.setAttribute("fill",i[h]);break;case"font-style":e.style.font=i[h],t.centerControlText(u,s,!1,!0);break;case"width":case"height":e.setAttribute(r[h],i[h]);break;case"vertical":var d="true"==i[h],p=e.getAttribute(d?"height":"width"),f=e.getAttribute(d?"width":"height");s.setAttribute("width",p),s.setAttribute("height",f),l.setAttribute("height",f),t.centerControlText(u,s,!0,!0),c.setAttribute("width",p),c.setAttribute("height",f),d&&o.setAttribute("transform","translate(0,"+p+") rotate(-90)");break;case"text":u.firstChild.textContent="null"==i[h]?"":i[h];break;case"value":var m=a.getFloatAttribute(s,"width");"null"==i[h]?(l.setAttribute("class","control-progressbar-indeterminate"),l.setAttribute("width",m.toString())):(l.setAttribute("class","control-slider-progress"),l.setAttribute("width",(parseFloat(i[h])*m).toString()));break;default:e.setAttribute(r[h],i[h])}},t.prototype.displayTextInputForSVG=function(t,e){var r=this,i=n.findChildOfType(t,"svg"),o=n.findChildOfType(i,"text"),s=document.getElementById("text-input-for-svg-container");s.style.display="block";var l=i.getBoundingClientRect(),u=a.getFloatAttribute(i,"width"),c=a.getFloatAttribute(i,"height"),h=l.width/u,d=s.firstElementChild;d.style.left=l.left+"px",d.style.top=l.top+"px",d.style.width=u+"px",d.style.height=c+"px",d.style.transform="scale("+h+")",d.style.font=t.style.font,d.style.textAlign=e,d.value=o.firstChild.textContent,s.setAttribute("control-id",t.id);var p=function(t){return r.onTextInputForSVGEvent(t)};s.onmousedown=p,s.onwheel=p,s.onkeypress=p,s.ontouchstart=p,window.setTimeout(function(){d.focus(),d.select()},0)},t.prototype.onTextInputForSVGEvent=function(t){var e=t.currentTarget,r=e.firstElementChild,i=e.getAttribute("control-id"),n=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=r&&(n=!0);break;case"wheel":n=!0;break;case"keypress":"Enter"==t.code&&(n=!0)}n&&(e.style.display="none",this.onTextInputForSVGChanged(i,r.value))},t.prototype.onTextInputForSVGChanged=function(t,e){var r=document.getElementById(t),i=n.findChildOfType(r,"svg");if(n.findChildOfType(i,"text").firstChild.textContent=e,this.frameDrawing.onControlAction(t,e),"ControlComboBox"==r.getAttribute("type")){var a=n.findChildOfType(r,"dropdown");this.controlList.updateControlList(a,["value"],[e])}},t.centerControlText=function(t,e,r,i){var n=a.getFloatAttribute(e,"width"),o=a.getFloatAttribute(e,"height"),s=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&o&&t.setAttribute("y",(1+o/2+.3*s.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.onControlAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t.sliderButtonDown=0,t}(),v=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){for(var e=n.findChildOfType(t,"picture"),r=n.findChildOfType(t,"pictureback"),i=n.childElements(n.findChildOfType(t,"legend")),o=i.length,s="true"==t.getAttribute("show-pdf"),l="true"==t.getAttribute("show-cdf"),u="true"==t.getAttribute("show-mean"),c=(a.getFloatAttribute(r,"x"),a.getFloatAttribute(r,"y")),h=(a.getFloatAttribute(r,"width"),a.getFloatAttribute(r,"height")),d=0;d<o;d++){var p=n.createSvgElement("g");if(s){var f=n.createSvgElement("g");p.appendChild(f)}if(l){var m=n.createSvgElement("polyline");a.setMultipleAttributes(m,["fill","stroke-width","stroke"],["none",i[d].getAttribute("cdf-line-width"),i[d].getAttribute("cdf-color")]),p.appendChild(m)}if(u){var g=n.createSvgElement("line");a.setMultipleAttributes(g,["stroke-width","stroke","y1","y2"],[i[d].getAttribute("cdf-line-width"),i[d].getAttribute("mean-color"),c.toString(),(c+h).toString()]),p.appendChild(g)}e.appendChild(p),S.addClickTapHandlerToChartItem(p)}},t.prototype.draw=function(t,e){for(var r=n.findChildOfType(t,"pictureback"),i=n.findChildOfType(t,"picture"),o=n.findChildOfType(t,"grid"),s=n.childElements(n.findChildOfType(t,"legend")),l="true"==t.getAttribute("show-pdf"),u="true"==t.getAttribute("show-cdf"),c="true"==t.getAttribute("show-mean"),h=a.getFloatAttribute(t,"bar-width"),d=a.getFloatAttribute(r,"x"),p=a.getFloatAttribute(r,"y"),f=a.getFloatAttribute(r,"width"),m=a.getFloatAttribute(r,"height"),g=a.splitSkipEmpty(e," "),v=g.length,b=1/0,y=-1/0,A=1/0,T=-1/0,C=[],E=[],w=[],k=[],x=[],M=[],O=[],I=[],_=[],L=0;L<v;L++)if("empty"!=g[L]){g[L]=a.splitSkipEmpty(g[L],":"),C[L]="true"==g[L][0],E[L]="true"==g[L][1],w[L]=parseFloat(g[L][2]),k[L]=parseFloat(g[L][3]),x[L]=parseFloat(g[L][4]),M[L]=parseInt(g[L][5]),O[L]=parseInt(g[L][6]),I[L]=a.splitToFloats(g[L][7],"|");for(var P=0;P<I[L].length;P++)I[L][P]<A&&(A=I[L][P]),T<I[L][P]&&(T=I[L][P]);C[L]&&(_[L]=a.splitToFloats(g[L][8],"|")),w[L]<b&&(b=w[L]),y<k[L]&&(y=k[L])}b==1/0&&(b=0,y=0),A==1/0&&(A=0,T=1),this.chartScaleAndGrid.recalcChartScale(t,b,y,!1,!1),this.chartScaleAndGrid.recalcChartScale(t,0,T,!0,!1);var R=a.getFloatAttribute(o,"min-x"),D=a.getFloatAttribute(o,"max-x"),F=a.getFloatAttribute(o,"min-y"),N=a.getFloatAttribute(o,"max-y"),B=f/(D-R),G=m/(N-F),U=n.childElements(i);for(L=0;L<v;L++)if("empty"!=g[L]){"hidden"==U[L].getAttribute("visibility")&&U[L].setAttribute("visibility","inherit");var z=I[L].length,W=(k[L]-w[L])/z,H=s[L].getAttribute("original-color"),V=void 0,Y=void 0;if(E[L]&&(V=s[L].getAttribute("low-color"),Y=s[L].getAttribute("high-color")),l){var j=U[L].firstElementChild,X=h*W*B,q=W*(1-h)/2;for(P=0;P<z;P++){var Z=d+(w[L]+P*W+q-R)*B,K=p+(N-I[L][P])*G,Q=I[L][P]*G,J=n.childElements(j)[P];J?J.setAttribute("visibility","inherit"):(J=n.createSvgElement("rect"),j.appendChild(J)),a.setMultipleAttributes(J,["x","y","width","height"],[a.reducePrecision(Z),a.reducePrecision(K),a.reducePrecision(X),a.reducePrecision(Q)]),C[L]&&E[L]&&P<M[L]?J.setAttribute("fill",V):C[L]&&E[L]&&O[L]<P?J.setAttribute("fill",Y):J.setAttribute("fill",H)}var $=n.childElements(j);for(P=z;P<$.length;P++)$[P].setAttribute("visibility","hidden")}if(u){var tt=l?U[L].firstElementChild.nextElementSibling:U[L].firstElementChild,et="";if(et+=d+(w[L]-R)*B+" "+(p+m)+" ",C[L])for(P=0;P<z;P++){et+=a.reducePrecision(d+(w[L]+(P+1)*W-R)*B)+","+a.reducePrecision(p+(1-_[L][P])*m)+" "}tt.setAttribute("points",et)}if(c){var rt=U[L].lastElementChild,it=d+(x[L]-R)*B;rt.setAttribute("x1",it),rt.setAttribute("x2",it)}if("NONE"!=t.getAttribute("leg-pos")){var nt=n.findChildOfType(s[L],"value");nt.firstChild.textContent=a.formatNumber(x[L],void 0),nt.setAttribute("fill",s[L].getAttribute("mean-color"))}}else U[L].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&S.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var a=n.findChildOfType(t,"picture"),o=n.childElements(a),s=n.childElements(o[e]),l=0;l<s.length;l++)s[l].setAttribute("visibility",r?"hidden":"inherit")},t}(),b=function(){function t(t){this.frameDrawing=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",o=t.getAttribute("scale-type-"+i),s=n.findChildOfType(t,"grid"),l=n.findChildOfType(t,"pictureback"),u=n.findChildOfType(t,e?"pictureborderh":"pictureborderw"),c=s.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=c){var h=a.getFloatAttribute(l,"x"),d=a.getFloatAttribute(l,"y"),p=a.getFloatAttribute(l,"width"),f=a.getFloatAttribute(l,"height"),m="GRID_DEFAULT"==c,g="ChartBar"==r||"ChartStack"==r,v=t.getAttribute("bar-dir");e?g&&(!g||"NORTH"!=v&&"SOUTH"!=v)||a.setMultipleAttributes(u,["x1","y1","x2","y2"],m?[h,d,h,d+f]:[h+p,d,h+p,d+f]):g&&(!g||"EAST"!=v&&"WEST"!=v)||a.setMultipleAttributes(u,["x1","y1","x2","y2"],m?[h,d+f,h+p,d+f]:[h,d,h+p,d])}var b=s.getAttribute("grid-line-color");switch(s.setAttribute("grid-line-color",a.increaseTransparency(b,.5)),o){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var y=a.getFloatAttribute(t,"scale-min-"+i),A=a.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(y="ChartStack"==r?0:Math.min(0,y),A=Math.max(0,A)),this.recalcChartScale(t,y,A,e,!0);break;case"SCALE_TIME_WINDOW":A=Math.max(0,a.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,A,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,o){var s=n.findChildOfType(t,"grid"),l=i?"min-y":"min-x",u=i?"max-y":"max-x";if(e!=a.getFloatAttribute(s,l)||r!=a.getFloatAttribute(s,u)){var c=e,h=r;if(c==h){if(o)return;c-=1,h+=1}var d=n.findChildOfType(t,"pictureback"),p=a.getFloatAttribute(d,i?"height":"width"),f=i?25:45,m=(h-c)/Math.floor(p/f),g=Math.pow(10,Math.ceil(Math.log(h-c)/Math.log(10))-1),v=g/5;v<m&&(v=g/2)<m&&(v=g)<m&&(v=2*g)<m&&(v=5*g),o?(c=Math.ceil(c/v)*v,h=Math.floor(h/v)*v):(c=Math.floor(c/v)*v,h=Math.ceil(h/v)*v);var b=o?e:c,y=o?r:h;a.setMultipleAttributes(s,[l,u],[b,y]),this.drawChartGrid(t,c,h,v,b,y,i)}},t.prototype.drawChartGrid=function(t,e,r,i,o,s,l){var u=t.getAttribute("type"),c=n.findChildOfType(t,"grid"),h=c.getAttribute(l?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=h){var d=l?c.lastElementChild:c.firstElementChild,p=n.findChildOfType(t,"pictureback"),f=c.getAttribute("grid-text-color"),m=c.getAttribute("grid-line-color"),g=l?"scale-type-y":"scale-type-x",v="SCALE_100_PERCENT"==t.getAttribute(g),b="SCALE_TIME_WINDOW"==t.getAttribute(g)?t.getAttribute("date-format-pattern"):"null",y=Math.round((r-e)/i)+1,A="GRID_DEFAULT"==h,T=!0;if("ChartBar"==u||"ChartStack"==u){var C=t.getAttribute("bar-dir");"SOUTH"!=C&&"WEST"!=C||(T=!1)}for(var S=a.getFloatAttribute(p,"x"),E=a.getFloatAttribute(p,"y"),w=a.getFloatAttribute(p,"width"),k=a.getFloatAttribute(p,"height"),x=s-o,M=(l?k:w)/x,O=i*M;d.childElementCount<y;){var I=n.cloneElementWithId("grid-item");d.appendChild(I)}for(var _=n.childElements(d),L=e,P=l?T?E+(s-e)*M:E+(e-o)*M:T?S+(e-o)*M:S+(s-e)*M,R=0;R<y;R++){var D=l?A?S-4:S:P,F=l?P:A?E+k+4:E+k,N=l?A?S+w:S+w+4:P,B=l?P:A?E:E-4,G=l?A?D-3:N+3:D,U=l?F+3:A?F+11:B-3,z=l?A?"end":"start":"middle";(I=_[R]).setAttribute("visibility","inherit");var W=I.lastElementChild;a.setMultipleAttributes(W,["x1","x2","y1","y2","stroke"],[D,N,F,B,m]);var H=I.firstElementChild;a.setMultipleAttributes(H,["x","y","text-anchor","fill"],[G,U,z,f]);var V=void 0;V=v?a.formatPercent(L):"null"!=b?this.gridFormattedDate(L,x,b):a.formatNumber(L,void 0),H.firstChild.textContent=V,L+=i,P+=l?T?-O:+O:T?+O:-O}for(R=y;R<_.length;R++)_[R].setAttribute("visibility","hidden")}},t.prototype.gridFormattedDate=function(t,e,r){var i=a.toDate(this.frameDrawing,t),n=a.toMilliseconds(this.frameDrawing,e);return n>5*a.YEAR?a.formatDate(i,"YYYY"):n>5*a.MONTH?a.formatDate(i,"MMMYYYY"):n>5*a.DAY?a.formatDate(i,"DDMMM"):n>5*a.HOUR?a.formatDate(i,"DDMMHH"):n>5*a.MINUTE?a.formatDate(i,"HHmm"):a.formatDate(i,"mmss")},t}(),y=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e,r,i=t.getAttribute("type"),o=n.findChildOfType(t,"pictureback"),s=n.findChildOfType(t,"picture"),l=n.childElements(n.findChildOfType(t,"legend")),u=l.length,c=a.getFloatAttribute(o,"x"),h=a.getFloatAttribute(o,"y"),d=a.getFloatAttribute(o,"width"),p=a.getFloatAttribute(o,"height");if("ChartBar"==i||"ChartStack"==i){var f=t.getAttribute("bar-dir");e="NORTH"==f||"SOUTH"==f;var m=a.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?d/u:p/u)*m:(e?d:p)*m}for(var g=0;g<u;g++){var v=void 0,b=l[g].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(v=n.createSvgElement("rect")).setAttribute("stroke","none"),v.setAttribute("fill",b);var y=void 0;e?(y=d/u,v.setAttribute("x","ChartBar"==i?c+y*g+(y-r)/2:c+(d-r)/2),v.setAttribute("width",r)):(y=p/u,v.setAttribute("y","ChartBar"==i?h+y*g+(y-r)/2:h+(p-r)/2),v.setAttribute("height",r)),s.appendChild(v);break;case"ChartPie":(v=n.createSvgElement("path")).setAttribute("stroke","none"),v.setAttribute("fill",b),s.appendChild(v)}S.addClickTapHandlerToChartItem(v)}},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=n.findChildOfType(t,"pictureback"),o=n.findChildOfType(t,"picture"),s=n.childElements(o),l=n.findChildOfType(t,"grid"),u=a.getFloatAttribute(i,"x"),c=a.getFloatAttribute(i,"y"),h=a.getFloatAttribute(i,"width"),d=a.getFloatAttribute(i,"height"),p=a.splitSkipEmpty(e," "),f=p.length,m=1/0,g=-1/0,v=!1,b=0,y=0;y<f;y++)p[y]=parseFloat(p[y]),p[y]<m&&(m=p[y]),g<p[y]&&(g=p[y]),p[y]<0&&(v=!0),b+=p[y];var A=!1;if("ChartBar"==r||"ChartStack"==r){var T=t.getAttribute("bar-dir"),C="NORTH"==T||"SOUTH"==T;"ChartBar"==r?(m=Math.min(0,m),g=Math.max(0,g)):(m=0,g=Math.max(0,b));var E=t.getAttribute(C?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=E&&"SCALE_AUTO_FROM_0"!=E||this.chartScaleAndGrid.recalcChartScale(t,m,g,C,!1),A="SCALE_100_PERCENT"==E;var w=a.getFloatAttribute(l,C?"min-y":"min-x"),k=a.getFloatAttribute(l,C?"max-y":"max-x"),x=(C?d:h)/(k-w),M=0;for(y=0;y<f;y++)if("ChartStack"==r&&(v||0==b)||"ChartBar"==r&&A&&(v||0==b))s[y].setAttribute(C?"height":"width",0);else{var O=A?p[y]/b:p[y],I=Math.abs(O),_=void 0;if("ChartBar"==r)switch(T){case"NORTH":case"WEST":_=O>0?k-O:k;break;case"SOUTH":case"EAST":_=O<0?O-w:-w}else{switch(T){case"NORTH":case"WEST":_=k-(O+M);break;case"SOUTH":case"EAST":_=-w+M}M+=O}I*=x;var L=C?d:h;(_*=x)<0?(I-=-_,_=0):_+I>L&&(I-=_+I-L),I<0&&(I=0),C?(s[y].setAttribute("y",c+_),s[y].setAttribute("height",I)):(s[y].setAttribute("x",u+_),s[y].setAttribute("width",I))}}else{var P=-Math.PI/2;for(y=0;y<f;y++){var R=b<=0||v?0:2*Math.PI*(p[y]/b),D=h/2,F=d/2,N=a.sectorData(u+D,c+F,D,F,P,R);s[y].setAttribute("d",N),P+=R}}if(("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&A)&&v?S.showChartWarning(t,"Neg!"):S.hideChartWarning(t),"NONE"!=t.getAttribute("leg-pos")){var B=n.childElements(n.findChildOfType(t,"legend"));for(y=0;y<f;y++){var G=n.findChildOfType(B[y],"value"),U=a.formatNumber(p[y],void 0);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&A)&&b>0&&!v&&(U+=" ("+a.formatPercent(p[y]/b)+")"),G.firstChild.textContent=U,G.setAttribute("fill",p[y]>=0?"royalBlue":"fireBrick")}S.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){n.childElements(n.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t}(),A=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(e){for(var r=e.getAttribute("type"),i=n.findChildOfType(e,"picture"),o=n.childElements(n.findChildOfType(e,"legend")),s=o.length,l=0;l<s;l++){var u=o[l].getAttribute("original-color"),c=n.createSvgElement("g");switch(r){case"ChartPlot":case"ChartTimePlot":if("true"==o[l].getAttribute("draw-line")){var h=n.createSvgElement("polyline");if(h.setAttribute("fill","none"),h.setAttribute("stroke",u),h.setAttribute("stroke-width",o[l].getAttribute("line-width")),c.appendChild(h),"ChartTimePlot"==r){var d=n.createSvgElement("polyline");d.setAttribute("stroke","none"),d.setAttribute("fill",a.increaseTransparency(u,t.timePlotAlpha)),c.appendChild(d)}}if("POINT_NONE"!=o[l].getAttribute("point-style")){var p=n.createSvgElement("g");p.setAttribute("fill",u),c.appendChild(p)}break;case"ChartTimeStack":var f=n.createSvgElement("polyline");f.setAttribute("stroke-width","1"),f.setAttribute("stroke",u),f.setAttribute("fill","none"),c.appendChild(f);var m=n.createSvgElement("polyline");m.setAttribute("stroke","none"),m.setAttribute("fill",a.increaseTransparency(u,t.stackChartAlpha)),c.appendChild(m)}i.appendChild(c),S.addClickTapHandlerToChartItem(c)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),o=n.findChildOfType(e,"pictureback"),s=n.findChildOfType(e,"picture"),l=n.findChildOfType(e,"grid"),u=n.childElements(n.findChildOfType(e,"legend")),c=a.getFloatAttribute(o,"x"),h=a.getFloatAttribute(o,"y"),d=a.getFloatAttribute(o,"width"),p=a.getFloatAttribute(o,"height"),f=h+p,m=t.parseDataAndFindMinMax(r),g=m.datasets,v=g.length,b=m.minx,y=m.maxx,A=m.miny,T=m.maxy;if("ChartTimeStack"==i&&A<0)S.showChartWarning(e,"Neg!");else{S.hideChartWarning(e),"ChartTimeStack"==i&&(A=0,T=t.prepareChartTimeStackData(g));var C,E=e.getAttribute("scale-type-x"),w=e.getAttribute("scale-type-y"),k="SCALE_100_PERCENT"==w;if("SCALE_AUTO"==E)this.chartScaleAndGrid.recalcChartScale(e,b,y,!1,!1);else if("SCALE_TIME_WINDOW"==E){C=a.getFloatAttribute(e,"scale-max-x");var x=void 0;x="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(y,C):Math.max(y,C,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,x-C,x,!1,!0)}"SCALE_AUTO"==w&&this.chartScaleAndGrid.recalcChartScale(e,A,T,!0,!1);for(var M=a.getFloatAttribute(l,"min-x"),O=a.getFloatAttribute(l,"max-x"),I=a.getFloatAttribute(l,"min-y"),_=a.getFloatAttribute(l,"max-y"),L=d/(O-M),P=p/(_-I),R=n.childElements(s),D="",F=0;F<v;F++){var N=void 0,B=void 0,G=void 0,U=void 0,z=void 0,W=void 0,H=void 0,V=void 0,Y=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(N="true"==u[F].getAttribute("draw-line"),B=u[F].getAttribute("point-style"),G="INTERPOLATION_STEP"==u[F].getAttribute("interpolation")),(N||"ChartTimeStack"==i)&&(z=(U=R[F].firstElementChild).nextElementSibling),B&&"POINT_NONE"!=B)switch(W=R[F].lastElementChild,B){case"POINT_CIRCLE":H="plot-point-circle",V=0,Y=0;break;case"POINT_SQUARE":H="plot-point-square",V=-1.5,Y=-1.5;break;case"POINT_TRIANGLE":H="plot-point-triangle",V=0,Y=0}for(var j=void 0,X=void 0,q="",Z="",K=void 0,Q=void 0,J=0,$=0;$<g[F].length;$++){var tt=c+(g[F][$][0]-M)*L,et=h+(-(k?g[F][$][1]/g[v-1][$][1]:g[F][$][1])+_)*P;if(tt<c&&(tt=c),c+d<tt&&(tt=c+d),et<h&&(et=h),h+p<et&&(et=h+p),!(null!=j&&Math.abs(tt-j)<S.chartTolerance&&Math.abs(et-X)<S.chartTolerance)){if(tt=a.reducePrecision(tt),et=a.reducePrecision(et),0==$&&(K=tt),Q=tt,U&&(G&&null!=j&&(q+=tt+","+X+" "),q+=tt+","+et+" ",z&&(0==F&&(D=tt+","+f+" "+D),Z=tt+","+et+" "+Z)),W){var rt=n.childElements(W)[J];rt?rt.setAttribute("visibility","inherit"):(rt=n.createUseElement(H),W.appendChild(rt)),rt.setAttribute("x",V+tt),rt.setAttribute("y",Y+et)}J++,j=tt,X=et}}if(U&&(U.setAttribute("points",q),z))if("ChartTimePlot"==i){var it="";if(""!=q){var nt=h+_*P;nt<h&&(nt=h),h+p<nt&&(nt=h+p),it=Q+","+nt+" "+K+","+nt}z.setAttribute("points",q+it)}else z.setAttribute("points",q+D),D=Z;if(W){var at=n.childElements(W);for($=J;$<at.length;$++)at[$].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,o){var s=e.getAttribute("type"),l=n.childElements(n.findChildOfType(e,"legend")),u=n.childElements(n.findChildOfType(e,"picture"));if("ChartTimeStack"==s)u[r].firstElementChild.setAttribute("stroke",o),u[r].lastElementChild.setAttribute("fill",a.increaseTransparency(o,t.stackChartAlpha));else{if("true"==l[r].getAttribute("draw-line")){var c=u[r].firstElementChild;c.setAttribute("stroke",o),"ChartTimePlot"==s&&c.nextElementSibling.setAttribute("fill",a.increaseTransparency(o,t.timePlotAlpha))}"POINT_NONE"!=l[r].getAttribute("point-style")&&u[r].lastElementChild.setAttribute("fill",o)}},t.parseDataAndFindMinMax=function(t){for(var e=a.splitSkipEmpty(t," "),r=e.length,i=1/0,n=-1/0,o=1/0,s=-1/0,l=0;l<r;l++)if("empty"==e[l])e[l]=[];else{e[l]=a.splitSkipEmpty(e[l],"|");for(var u=0;u<e[l].length;u++){e[l][u]=e[l][u].split(":");var c=e[l][u][0]=parseFloat(e[l][u][0]),h=e[l][u][1]=parseFloat(e[l][u][1]);c<i&&(i=c),n<c&&(n=c),h<o&&(o=h),s<h&&(s=h)}}return i==1/0&&(i=0,n=0),o==1/0&&(o=0,s=0),{datasets:e,minx:i,maxx:n,miny:o,maxy:s}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),T=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=n.findChildOfType(t,"picture"),r=n.findChildOfType(t,"pictureback"),i=a.getFloatAttribute(r,"x"),o=a.getFloatAttribute(r,"y"),s=a.getFloatAttribute(r,"width"),l=a.getFloatAttribute(r,"height"),u=n.cloneElementWithId("normal-text");u.setAttribute("fill","grey"),u.setAttribute("text-anchor","middle"),u.setAttribute("x",(i+s/2).toString()),u.setAttribute("y",(o+l/2+3).toString()),u.firstChild.textContent="Not supported at the moment",e.appendChild(u)},t.draw=function(t,e){},t.setItemLook=function(t,e,r,i){},t}(),C=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=n.findChildOfType(t,"picture"),r=n.findChildOfType(t,"pictureback"),i=a.getFloatAttribute(r,"x"),o=a.getFloatAttribute(r,"y"),s=a.getFloatAttribute(r,"height"),l=n.childElements(n.findChildOfType(t,"legend")).length,u=s/l,c=u*a.getFloatAttribute(t,"bar-width"),h=(u-c)/2;t.setAttribute("rect-height",a.reducePrecision(c).toString());for(var d=0;d<l;d++){var p=n.createSvgElement("g");p.setAttribute("transform","translate("+i+","+(o+d*u+h)+")"),e.appendChild(p),S.addClickTapHandlerToChartItem(p)}},t.prototype.draw=function(e,r){for(var i=n.findChildOfType(e,"pictureback"),o=n.findChildOfType(e,"picture"),s=n.findChildOfType(e,"grid"),l=(a.getFloatAttribute(i,"x"),a.getFloatAttribute(i,"width")),u=a.splitSkipEmpty(r," "),c=u.length,h=-1/0,d=0;d<c;d++)if("empty"==u[d])u[d]=[];else{u[d]=a.splitSkipEmpty(u[d],"|");for(var p=0;p<u[d].length;p++)u[d][p]=u[d][p].split(":"),u[d][p][0]=parseFloat(u[d][p][0]),u[d][p][1]=parseFloat(u[d][p][1]);var f=u[d][u[d].length-1][0];h<f&&(h=f)}h==1/0&&(h=0);for(d=0;d<c;d++)0!=u[d].length&&u[d][u[d].length-1][0]<h&&u[d].push([h,u[d][u[d].length-1][1]]);var m,g=a.getFloatAttribute(e,"scale-max-x");m="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(h,g):Math.max(h,g,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,m-g,m,!1,!0);var v=a.getFloatAttribute(s,"min-x"),b=l/(a.getFloatAttribute(s,"max-x")-v),y=n.childElements(o),A=a.getFloatAttribute(e,"rect-height"),T=t.colorMapping(e);for(d=0;d<c;d++){var C=y[d],S=n.childElements(C),E=S.length,w=0,k="",x=null;for(p=0;p<u[d].length;p++){var M=u[d][p][0],O=u[d][p][1];if(M<v)x=0,k=T(O);else if(null==x)x=(M-v)*b,k=T(O);else{var I=T(O);if(I!=k||p==u[d].length-1){var _=(M-v)*b,L=void 0;w<E?(L=S[w],w++,L.setAttribute("visibility","inherit")):(L=n.createSvgElement("rect"),C.appendChild(L)),a.setMultipleAttributes(L,["x","width","height","fill"],[a.reducePrecision(x),a.reducePrecision(_-x),A,k]),x=_,k=I}}}for(var P=w;P<E;P++)S[P].setAttribute("visibility","hidden")}},t.colorMapping=function(t){var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color");e=a.splitSkipEmpty(e," ");for(var i=[],n=[],o=function(t){var r=e[t].split(":"),a=void 0,o=parseFloat(r[1]);switch(r[0]){case"GREATER":a=function(t){return t>o};break;case"GREATER_OR_EQUALS":a=function(t){return t>=o};break;case"LESS":a=function(t){return t<o};break;case"LESS_OR_EQUALS":a=function(t){return t<=o};break;case"EQUALS":a=function(t){return t==o};break;case"NOT_EQUALS":a=function(t){return t!=o}}i[t]=a,n[t]=r[2]},s=0;s<e.length;s++)o(s);return function(t){for(var e=0;e<i.length;e++)if(i[e](t))return n[e];return r}},t.setItemLook=function(t,e,r,i){var a=n.findChildOfType(t,"picture");n.childElements(a)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),S=function(){function t(t){this.frameDrawing=t,this.chartScaleAndGrid=new b(t),this.chart1D=new y(t,this.chartScaleAndGrid),this.chart2D=new A(t,this.chartScaleAndGrid),this.chartHistogram=new v(t,this.chartScaleAndGrid),this.chartHistogram2D=new T(t,this.chartScaleAndGrid),this.chartTimeColor=new C(t,this.chartScaleAndGrid)}return t.create=function(){return n.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var a=e.getAttribute("type"),o=n.findChildOfType(e,"background"),s=n.findChildOfType(e,"pictureback"),l=n.findChildOfType(e,"pictureselect"),u=n.findChildOfType(e,"pictureborderh"),c=n.findChildOfType(e,"pictureborderw"),h=n.findChildOfType(e,"grid"),d=0;d<r.length;d++)switch(r[d]){case"width":case"height":case"fill":case"stroke":o.setAttribute(r[d],i[d]);break;case"pic-width":case"pic-height":s.setAttribute(r[d].substring(4),i[d]),l.setAttribute(r[d].substring(4),i[d]);break;case"pic-fill":s.setAttribute(r[d].substring(4),i[d]);break;case"pic-stroke":u.setAttribute(r[d].substring(4),i[d]),c.setAttribute(r[d].substring(4),i[d]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":h.setAttribute(r[d],i[d]);break;case"grid-completed":"ChartPie"!=a&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":t.addItem(e,i[d]);break;case"items-completed":t.setupLegendItemsLayout(e),t.setupPicture(e);break;case"data":this.drawPicture(e,i[d]);break;default:e.setAttribute(r[d],i[d])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=n.findChildOfType(e,"background"),o=n.findChildOfType(e,"pictureback"),s=n.findChildOfType(e,"pictureselect"),l=n.findChildOfType(e,"pictureborderh"),u=n.findChildOfType(e,"pictureborderw"),c=n.findChildOfType(e,"warning"),h=n.findChildOfType(e,"legend"),d=e.getAttribute("leg-pos"),p=a.getFloatAttribute(i,"width"),f=a.getFloatAttribute(i,"height"),m=a.getFloatAttribute(e,"pic-offset-x"),g=a.getFloatAttribute(e,"pic-offset-y"),v=a.getFloatAttribute(o,"width"),b=a.getFloatAttribute(o,"height"),y=a.getFloatAttribute(e,"leg-size"),A=0,T=0,C=0,S=0;switch(d){case"SOUTH":A=m,T=f-y,C=p-m,S=y;break;case"WEST":m+=y,A=0,T=g,C=y,S=f-g;break;case"EAST":A=p-y,T=g,C=y,S=f-g;break;case"NORTH":g+=y,A=m,T=0,C=p-m,S=y}if(a.setMultipleAttributes(o,["x","y"],[m,g]),a.setMultipleAttributes(s,["x","y"],[m,g]),a.setMultipleAttributes(c,["x","y"],[m+v/2,g+b/2+3]),"NONE"==d?h.setAttribute("visibility","hidden"):(h.setAttribute("transform","translate("+A+","+T+")"),a.setMultipleAttributes(h,["width","height"],[C,S])),"ChartPie"==r){var E=v/2,w=b/2,k=n.createSvgElement("ellipse");a.setMultipleAttributes(k,["cx","cy","rx","ry","stroke","fill","visibility"],[m+E,g+w,E,w,"none",o.getAttribute("fill"),"hidden"]),e.insertBefore(k,o);var x=n.createSvgElement("ellipse");a.setMultipleAttributes(x,["cx","cy","rx","ry","stroke","fill"],[m+E,g+w,E,w,l.getAttribute("stroke"),"none"]),e.insertBefore(x,l),n.removeElement(e,l),n.removeElement(e,u)}e.onmouseover=function(e){return t.selectChart(e,!0)},e.onmouseout=function(e){return t.selectChart(e,!1)}},t.setupLegendItemsLayout=function(t){for(var e=n.findChildOfType(t,"legend"),r=n.childElements(e),i=a.getFloatAttribute(e,"width"),o=0,s=0,l=0;l<r.length;l++){var u=r[l],c=n.findChildOfType(u,"back"),h=a.getFloatAttribute(c,"width"),d=n.findChildOfType(u,"value"),p=d.getComputedTextLength(),f=Math.max(h,a.getFloatAttribute(d,"x")+p);c.setAttribute("width",f.toString()),0<o&&i<o+f&&(o=0,s+=20),u.setAttribute("transform","translate("+o+","+s+")"),o+=f+5}},t.showChartWarning=function(t,e){var r=n.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=n.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=n.findChildOfType(t,"picture"),r=n.findChildOfType(t,"legend");n.removeAllChildren(r),n.removeAllChildren(e)},t.addItem=function(e,r){var i=e.getAttribute("type"),o=n.findChildOfType(e,"legend"),s=r.split("\n"),l=s[0],u=s[1],c=n.cloneElementWithId("legend-item"),h=n.findChildOfType(c,"color"),d=n.findChildOfType(c,"name"),p=n.findChildOfType(c,"value");h.setAttribute("fill",l),c.setAttribute("original-color",l),d.setAttribute("fill",e.getAttribute("leg-text-color")),d.appendChild(n.createTextNode(u)),p.appendChild(n.createTextNode("")),o.appendChild(c);var f=d.getComputedTextLength();p.setAttribute("x",(a.getFloatAttribute(d,"x")+f+4).toString()),"ChartPlot"==i||"ChartTimePlot"==i?a.setMultipleAttributes(c,["draw-line","line-width","interpolation","point-style"],[s[2],s[3],s[4],s[5]]):"ChartHistogram"==i&&a.setMultipleAttributes(c,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[s[2],s[3],s[4],s[5],s[6]]),t.addClickTapHandlerToChartItem(c)},t.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":y.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":A.setup(t);break;case"ChartTimeColor":C.setup(t);break;case"ChartHistogram":v.setup(t);break;case"ChartHistogram2D":T.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":T.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.selectChart=function(t,e){var r=t.currentTarget;n.findChildOfType(r,"pictureselect").setAttribute("visibility",e?"inherit":"hidden")},t.addClickTapHandlerToChartItem=function(e){new f(e,function(r){return t.selectChartItem(e,!0,!1)},function(r){return t.selectChartItem(e,!1,!1)},null,function(r){return t.selectChartItem(e,!0,!0)},function(t){return!1})},t.selectChartItem=function(e,r,i){for(var o=t.getChartShape(e),s=a.indexInParent(e),l=n.childElements(n.findChildOfType(o,"legend")),u=l[s],c="true"==u.getAttribute("selected"),h=!1,d=0;d<l.length;d++)if(d!=s&&"true"==l[d].getAttribute("selected")){h=!0;break}if(i)return c=!c,u.setAttribute("selected",c?"true":"false"),void t.setChartItemLook(o,s,!1,c);if(c||h){if(c)return;t.setChartItemLook(o,s,!r,r)}else{t.setChartItemLook(o,s,!1,r);for(d=0;d<l.length;d++)d!=s&&t.setChartItemLook(o,d,r,!1)}},t.setChartItemLook=function(e,r,i,a){var o=n.childElements(n.findChildOfType(e,"legend")),s=n.findChildOfType(o[r],"back"),l=n.findChildOfType(o[r],"color");s.setAttribute("class",a?"legend-item-background-selected":"legend-item-background");var u=i?t.colorItemGrayed:o[r].getAttribute("original-color");switch(l.setAttribute("fill",u),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":y.setItemLook(e,r,i,u);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":A.setItemLook(e,r,i,u);break;case"ChartTimeColor":C.setItemLook(e,r,i,u);break;case"ChartHistogram":v.setItemLook(e,r,i,u);break;case"ChartHistogram2D":T.setItemLook(e,r,i,u)}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),E=function(){function t(){}return t.isFullScreenEnabled=function(){return document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled},t.isFullScreen=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},t.requestFullScreen=function(t){t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},t.cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},t.toggleFullScreen=function(e){t.isFullScreen()?t.cancelFullScreen():t.requestFullScreen(e)},t.addFullScreenListener=function(t){document.addEventListener("fullscreenchange",t,!1),document.addEventListener("webkitfullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),document.addEventListener("msfullscreenchange",t,!1)},t.removeFullScreenListener=function(t){document.removeEventListener("fullscreenchange",t,!1),document.removeEventListener("webkitfullscreenchange",t,!1),document.removeEventListener("mozfullscreenchange",t,!1),document.removeEventListener("msfullscreenchange",t,!1)},t.setBrowserWindowInnerSize=function(t,e){window.outerWidth?window.resizeTo(t+(window.outerWidth-window.innerWidth),e+(window.outerHeight-window.innerHeight)):(window.resizeTo(500,500),window.resizeTo(t+(500-document.body.offsetWidth),e+(500-document.body.offsetHeight)))},t}(),w=function(){function t(t){var e=this;this.client=t,this.onWindowResizeEventClosure=function(t){return e.updateSVGSize()},this.onSVGPointingEventClosure=function(t){return e.onSVGPointingEvent(t)}}return t.prototype.initSVGNavigation=function(){window.addEventListener("resize",this.onWindowResizeEventClosure,!1),E.addFullScreenListener(this.onWindowResizeEventClosure),this.client.svg.oncontextmenu=function(){return!1},this.client.svg.addEventListener("mousedown",this.onSVGPointingEventClosure),this.client.svg.addEventListener("mousemove",this.onSVGPointingEventClosure),this.client.svg.addEventListener("mouseup",this.onSVGPointingEventClosure),this.client.svg.addEventListener("mouseout",this.onSVGPointingEventClosure),this.client.svg.addEventListener("wheel",this.onSVGPointingEventClosure),this.client.svg.addEventListener("touchstart",this.onSVGPointingEventClosure),this.client.svg.addEventListener("touchmove",this.onSVGPointingEventClosure),this.client.svg.addEventListener("touchend",this.onSVGPointingEventClosure),this.buttonDown=0,this.prevPtrCoords=[],this.presentationCoords=[0,0],this.zoom=1},t.prototype.clearSVGNavigation=function(){this.client.svg&&(window.removeEventListener("resize",this.onWindowResizeEventClosure),E.removeFullScreenListener(this.onWindowResizeEventClosure),this.client.svg.removeEventListener("mousedown",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("mousemove",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("mouseup",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("mouseout",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("wheel",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("touchstart",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("touchmove",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("touchend",this.onSVGPointingEventClosure))},t.prototype.onSVGPointingEvent=function(e){e.stopPropagation();var r=a.offsetPage(this.client.svg);if(e.type.startsWith("mouse")||"wheel"==e.type){var i=e,n=i.pageX-r.left,o=i.pageY-r.top;switch(i.type){case"mousedown":this.buttonDown=i.which,this.prevPtrCoords=[n,o],1==this.buttonDown||this.buttonDown;break;case"mousemove":if(1==this.buttonDown)i.preventDefault();else if(3==this.buttonDown&&this.client.frameDrawing.settings.enablePanning){var s=n-this.prevPtrCoords[0],l=o-this.prevPtrCoords[1];this.onPanning(s,l),this.prevPtrCoords=[n,o]}break;case"mouseup":case"mouseout":if(this.client.svg.contains(i.relatedTarget))return;var u=this.buttonDown;if(this.buttonDown=0,1==u){s=n-this.prevPtrCoords[0],l=o-this.prevPtrCoords[1];Math.abs(s)<=t.clickTolerance&&Math.abs(l)<=t.clickTolerance&&this.onPresentationClick(i,n,o)}this.prevPtrCoords=[];break;case"wheel":var c=e;c.altKey&&this.client.frameDrawing.settings.enableZoom?this.onWheelZooming(0<c.deltaY,n,o):this.client.frameDrawing.settings.enablePanning&&(e.preventDefault(),0<c.deltaY?this.onPanning(0,-50):this.onPanning(0,50))}}else if(e.type.startsWith("touch")){var h=e,d=void 0,p=void 0,f=void 0,m=void 0;switch(h.touches.length>0&&(d=h.touches[0].pageX-r.left,p=h.touches[0].pageY-r.top),h.touches.length>1&&(f=h.touches[1].pageX-r.left,m=h.touches[1].pageY-r.top),h.type){case"touchstart":this.prevPtrCoords=h.touches.length>1?[d,p,f,m]:[d,p];break;case"touchmove":if(h.preventDefault(),h.touches.length>1&&4==this.prevPtrCoords.length){var g=(d+f)/2,v=(p+m)/2,b=Math.hypot(this.prevPtrCoords[2]-this.prevPtrCoords[0],this.prevPtrCoords[3]-this.prevPtrCoords[1]),y=Math.hypot(f-d,m-p)/b*this.zoom;y=Math.max(y,t.zooms[0]),y=Math.min(y,t.zooms[t.zooms.length-1]),this.applyZoom(y,g,v)}else if(this.prevPtrCoords.length>=2){s=d-this.prevPtrCoords[0],l=p-this.prevPtrCoords[1];if(4==this.prevPtrCoords.length){var A=Math.hypot(s,l),T=d-this.prevPtrCoords[2],C=p-this.prevPtrCoords[3];Math.hypot(T,C)<A&&(s=T,l=C)}this.onPanning(s,l)}this.prevPtrCoords=h.touches.length>1?[d,p,f,m]:[d,p];break;case"touchend":this.prevPtrCoords=[]}}},t.prototype.applyPresentationTransform=function(){var t="translate("+this.presentationCoords[0]+","+this.presentationCoords[1]+")",e="scale("+this.zoom+")";this.client.presentation.setAttribute("transform",t+" "+e)},t.prototype.applyZoom=function(t,e,r){var i=t/this.zoom,n=e-(e-this.presentationCoords[0])*i,a=r-(r-this.presentationCoords[1])*i;this.presentationCoords=[n,a],this.zoom=t,this.applyPresentationTransform()},t.prototype.onPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform()},t.prototype.onWheelZooming=function(e,r,i){var n=this.zoom;if(e){for(var a=t.zooms.length-1;a>=0;a--)if(t.zooms[a]<this.zoom){n=t.zooms[a];break}}else for(a=0;a<t.zooms.length;a++)if(this.zoom<t.zooms[a]){n=t.zooms[a];break}this.applyZoom(n,r,i)},t.prototype.onPresentationClick=function(t,e,r){var i=e-this.presentationCoords[0],n=r-this.presentationCoords[1];i/=this.zoom,n/=this.zoom,this.client.frameDrawing.onUserClick(t.target,i,n)},t.prototype.navigateTo=function(t,e,r){this.zoom=r,this.presentationCoords=[-t*this.zoom,-e*this.zoom],this.applyPresentationTransform()},t.prototype.updateSVGSize=function(){var t=this.client.svg,e=t.parentNode.getBoundingClientRect(),r=e.width,i=e.height;a.setMultipleAttributes(t,["width","height"],[r,i])},t.clickTolerance=1,t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t}(),k=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return n.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return n.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return n.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)r[n],e.setAttribute(r[n],i[n]);t.updateGISMarkupPosition(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=n.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=a.getFloatAttribute(t,"lon"),o=a.getFloatAttribute(t,"lat"),s=x.lonLatToXY(r,i,o);a.setMultipleAttributes(t,["cx","cy"],[s[0],s[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var l=t.getAttribute("lonlatpoints"),u=x.lonLatPointsToXYPoints(r,l);t.setAttribute("points",u)}},t}(),x=function(){function t(t){this.frameDrawing=t}return t.prototype.createShapeGISMap=function(){var t=this,e=n.cloneElementWithId("shape-gis-map"),r=function(e){return t.onGISEvent(e)};e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r);var i=n.findChildOfType(e,"map").firstElementChild;return n.findChildOfType(i,"agents").addEventListener("click",function(e){return t.onGISAgentLayerClick(e)}),e},t.prototype.updateShapeGISMap=function(t,e,r){for(var i=n.findChildOfType(t,"background"),a=n.findChildOfType(t,"map"),o=n.findChildOfType(t,"shadow"),s=n.findChildOfType(t,"border"),l=0;l<e.length;l++)switch(e[l]){case"width":case"height":i.setAttribute(e[l],r[l]),a.setAttribute(e[l],r[l]),o.setAttribute(e[l],r[l]),s.setAttribute(e[l],r[l]);break;case"size-completed":t.getAttribute("zoom")&&this.redrawGISMap(t);break;case"background-color":i.setAttribute("fill",r[l]);break;case"border-color":s.setAttribute("stroke",r[l]);break;case"map-completed":this.redrawGISMap(t);break;default:t.setAttribute(e[l],r[l])}},t.prototype.redrawGISMap=function(e){this.redrawGISTiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.prototype.redrawGISTiles=function(e){var r=n.findChildOfType(e,"background"),i=a.getFloatAttribute(r,"width"),o=a.getFloatAttribute(r,"height"),s=t.minGISZoom(i,o),l=n.findChildOfType(e,"map").firstElementChild;l.setAttribute("transform","translate(0,0)");var u=a.getIntAttribute(e,"zoom"),c=a.getFloatAttribute(e,"center-lon"),h=a.getFloatAttribute(e,"center-lat");u<s&&(u=s,e.setAttribute("zoom",u.toString()));var d,p=Math.pow(2,u),f=t.latToTileYFloat(h,u),m=o/2/t.tileImageSize;f-m<0?d=m:p<f+m&&(d=p-m),d&&(h=t.tileYToLat(d,u),e.setAttribute("center-lat",h.toString()));var g=n.findChildOfType(l,"tiles");n.removeAllChildren(g),this.updateGISTiles(g,u,h,c,0,0,i,o,p)},t.prototype.updateGISTiles=function(e,r,i,o,s,l,u,c,h){for(var d=t.lonToTileXInt(o,r),p=t.latToTileYInt(i,r),f=s+u/2-t.lonToXOffsetWithinTile(o,r),m=l+c/2-t.latToYOffsetWithinTile(i,r);f>0;)f-=t.tileImageSize,d--;for(;m>0;)m-=t.tileImageSize,p--;d=a.modulo(d,h),p=a.modulo(p,h);for(var g=[],v=n.childElements(e),b=0;b<v.length;b++)g.push(v[b]);for(var y=d,A=f;A<u;A+=t.tileImageSize){for(var T=p,C=m;C<c;C+=t.tileImageSize){var S=r+"/"+y+"/"+T,E=null;for(b=0;b<g.length;b++)if(g[b].getAttribute("tileid")==S){E=g[b];break}null==E&&(E=this.addGISTile(e,r,y,T)),E.setAttribute("x",(A-s).toString()),E.setAttribute("y",(C-l).toString()),T=a.modulo(T+1,h)}y=a.modulo(y+1,h)}},t.prototype.addGISTile=function(e,r,i,a){var o=n.findParentOfType(e,"ShapeGISMap"),s=this.tileURL(o,r,i,a),l=n.createSvgElement("image");return l.setAttribute("width",t.tileImageSize.toString()),l.setAttribute("height",t.tileImageSize.toString()),l.setAttributeNS(n.xlinkns,"href",s),l.setAttribute("tileid",r+"/"+i+"/"+a),e.appendChild(l),l},t.redrawGISMarkup=function(t){for(var e=n.findChildOfType(t,"map").firstElementChild,r=n.findChildOfType(e,"markup"),i=n.childElements(r),a=0;a<i.length;a++)k.updateGISMarkupPosition(i[a])},t.redrawGISAgents=function(e){for(var r=n.findChildOfType(e,"map").firstElementChild,i=n.findChildOfType(r,"agents"),a=n.childElements(i),o=0;o<a.length;o++)t.updateGISObjectScale(a[o]),"hidden"!=a[o].getAttribute("visibility")&&t.updateGISObjectPosition(a[o])},t.updateGISObjectPosition=function(e){var r=n.findParentOfType(e,"ShapeGISMap"),i=a.getFloatAttribute(e,"lon"),o=a.getFloatAttribute(e,"lat"),s=a.getFloatAttribute(e,"heading"),l=t.lonLatToXY(r,i,o),u="translate("+l[0]+","+l[1]+") rotate("+s+")",c=e.getAttribute("scale");c&&(u+=" scale("+c+")"),e.setAttribute("transform",u)},t.updateGISObjectScale=function(e){var r=n.findParentOfType(e,"ShapeGISMap"),i=a.getIntAttribute(e,"fixed-scale-zoom");if(i){var o=a.getIntAttribute(r,"zoom");if(o<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var s=1;if(a.getIntAttribute(e,"real-scale-zoom")<=o){var l=a.getFloatAttribute(e,"pixels-per-meter"),u=a.getFloatAttribute(e,"lat");s=t.pixelsPerGISMeter(o,u)/l}e.setAttribute("scale",s.toString())}},t.prototype.panGIS=function(e,r,i){var o=n.findChildOfType(e,"map").firstElementChild,s=a.parseTranslateTransform(o.getAttribute("transform")),l=s[0]+r,u=s[1]+i,c=a.getIntAttribute(e,"zoom"),h=Math.pow(2,c),d=a.getFloatAttribute(e,"center-lon"),p=a.getFloatAttribute(e,"center-lat"),f=t.latToTileYFloat(p,c),m=n.findChildOfType(e,"background"),g=a.getFloatAttribute(m,"width"),v=a.getFloatAttribute(m,"height"),b=v/2/t.tileImageSize;f-b-u/t.tileImageSize<0?u=(f-b)*t.tileImageSize:h<f+b-u/t.tileImageSize&&(u=(f+b-h)*t.tileImageSize),l=t.normalizedGISX(l,c),l=Math.round(l),u=Math.round(u),o.setAttribute("transform","translate("+l+","+u+")");var y=n.findChildOfType(o,"tiles");this.updateGISTiles(y,c,p,d,l,u,g,v,h)},t.prototype.zoomOutGIS=function(e,r,i){var o=n.findChildOfType(e,"background"),s=a.getFloatAttribute(o,"width"),l=a.getFloatAttribute(o,"height"),u=a.getIntAttribute(e,"zoom");t.minGISZoom(s,l)<u&&this.setGISZoom(e,r,i,u-1)},t.prototype.zoomInGIS=function(t,e,r){var i=a.getIntAttribute(t,"zoom");i<19&&this.setGISZoom(t,e,r,i+1)},t.prototype.setGISZoom=function(e,r,i,o){var s=n.findChildOfType(e,"background"),l=a.getFloatAttribute(s,"width"),u=a.getFloatAttribute(s,"height"),c=n.findChildOfType(e,"map").firstElementChild,h=a.parseTranslateTransform(c.getAttribute("transform")),d=t.xyToLonLat(e,r-h[0],i-h[1]),p=t.lonToTileXFloat(d[0],o),f=t.latToTileYFloat(d[1],o),m=Math.pow(2,o);p=a.remainderPositive(p-(r-l/2)/t.tileImageSize,m),f=a.remainderPositive(f-(i-u/2)/t.tileImageSize,m);var g=t.tileXToLon(p,o),v=t.tileYToLat(f,o);a.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[o,g,v]),this.redrawGISMap(e)},t.prototype.onGISClick=function(e,r,i){var o=n.findChildOfType(e,"map").firstElementChild,s=a.parseTranslateTransform(o.getAttribute("transform")),l=t.xyToLonLat(e,r-s[0],i-s[1]);this.frameDrawing.client.network.postUserAction(e.id,l[0]+" "+l[1])},t.prototype.onGISEvent=function(e){var r=e.currentTarget;if("true"==r.getAttribute("navigation-enabled")){var i=n.findChildOfType(r,"background"),o=a.getFloatAttribute(i,"width"),s=a.getFloatAttribute(i,"height"),l=i.getBoundingClientRect(),u=l.width/o,c=l.height/s,h=a.offsetPage(i);if(e.type.startsWith("mouse")||"wheel"==e.type){var d=e,p=(d.pageX-h.left)/u,f=(d.pageY-h.top)/c;switch(e.type){case"mousedown":t.buttonDown=d.which,1==t.buttonDown&&(e.stopPropagation(),t.prevPtrCoords=[p,f]);break;case"mousemove":if(1==t.buttonDown){e.stopPropagation(),e.preventDefault();var m=p-t.prevPtrCoords[0],g=f-t.prevPtrCoords[1];t.prevPtrCoords=[p,f],this.panGIS(r,m,g)}break;case"mouseup":case"mouseout":if(r.contains(d.relatedTarget))return;if(1==t.buttonDown){e.stopPropagation();m=p-t.prevPtrCoords[0],g=f-t.prevPtrCoords[1];Math.abs(m)<=w.clickTolerance&&Math.abs(g)<=w.clickTolerance&&this.onGISClick(r,p,f)}t.buttonDown=0;break;case"wheel":if(!d.altKey&&!d.ctrlKey){var v=e;e.stopPropagation(),e.preventDefault(),0<v.deltaY?this.zoomOutGIS(r,p,f):this.zoomInGIS(r,p,f)}}}else if(e.type.startsWith("touch")){var b=e;if(b.touches.length>2)return;var y=void 0,A=void 0,T=void 0,C=void 0;switch(b.touches.length>0&&(y=(b.touches[0].pageX-h.left)/u,A=(b.touches[0].pageY-h.top)/c),b.touches.length>1&&(T=(b.touches[1].pageX-h.left)/u,C=(b.touches[1].pageY-h.top)/c),e.type){case"touchstart":e.stopPropagation(),t.prevPtrCoords=b.touches.length>1?[y,A,T,C]:[y,A];break;case"touchmove":if(e.stopPropagation(),e.preventDefault(),b.touches.length>1&&4==t.prevPtrCoords.length){var S=(y+T)/2,E=(A+C)/2,k=Math.hypot(t.prevPtrCoords[2]-t.prevPtrCoords[0],t.prevPtrCoords[3]-t.prevPtrCoords[1]),x=Math.hypot(T-y,C-A);(x<.8*k||1.2*k<x)&&(x<k?this.zoomOutGIS(r,S,E):this.zoomInGIS(r,S,E),t.prevPtrCoords=[y,A,T,C])}else if(t.prevPtrCoords.length>=2){m=y-t.prevPtrCoords[0],g=A-t.prevPtrCoords[1];if(4==t.prevPtrCoords.length){var M=Math.hypot(m,g),O=y-t.prevPtrCoords[2],I=A-t.prevPtrCoords[3];Math.hypot(O,I)<M&&(m=O,g=I)}this.panGIS(r,m,g),t.prevPtrCoords=b.touches.length>1?[y,A,T,C]:[y,A]}else t.prevPtrCoords=b.touches.length>1?[y,A,T,C]:[y,A];break;case"touchend":e.stopPropagation(),t.prevPtrCoords=[]}}}},t.prototype.onGISAgentLayerClick=function(t){t.stopPropagation(),t.preventDefault();for(var e=t.currentTarget,r=t.target;r.parentNode!=e;)r=r.parentNode;this.frameDrawing.client.network.postUserAction(r.id,"0 0")},t.xyToLonLat=function(e,r,i){var o=n.findChildOfType(e,"background"),s=a.getFloatAttribute(o,"width"),l=a.getFloatAttribute(o,"height"),u=a.getIntAttribute(e,"zoom"),c=Math.pow(2,u),h=t.lonToTileXFloat(a.getFloatAttribute(e,"center-lon"),u),d=t.latToTileYFloat(a.getFloatAttribute(e,"center-lat"),u),p=(r-s/2)/t.tileImageSize,f=(i-l/2)/t.tileImageSize,m=a.remainderPositive(h+p,c),g=a.remainderPositive(d+f,c);return[t.tileXToLon(m,u),t.tileYToLat(g,u)]},t.lonLatToXY=function(e,r,i){var o=n.findChildOfType(e,"background"),s=a.getFloatAttribute(o,"width"),l=a.getFloatAttribute(o,"height"),u=a.getIntAttribute(e,"zoom"),c=t.lonToTileXFloat(a.getFloatAttribute(e,"center-lon"),u),h=t.latToTileYFloat(a.getFloatAttribute(e,"center-lat"),u),d=t.lonToTileXFloat(r,u),p=t.latToTileYFloat(i,u);return[s/2+(d-c)*t.tileImageSize,l/2+(p-h)*t.tileImageSize]},t.lonLatPointsToXYPoints=function(e,r){var i=n.findChildOfType(e,"background"),o=a.getFloatAttribute(i,"width"),s=a.getFloatAttribute(i,"height"),l=a.getIntAttribute(e,"zoom"),u=t.lonToTileXFloat(a.getFloatAttribute(e,"center-lon"),l),c=t.latToTileYFloat(a.getFloatAttribute(e,"center-lat"),l),h=void 0,d=void 0,p="";r=a.splitSkipEmpty(r," ");for(var f=0;f<r.length;f++){var m=r[f].split(","),g=t.lonToTileXFloat(parseFloat(m[0]),l),v=t.latToTileYFloat(parseFloat(m[1]),l),b=o/2+(g-u)*t.tileImageSize,y=s/2+(v-c)*t.tileImageSize;null!=h&&Math.abs(b-h)<t.gisTolerance&&Math.abs(y-d)<t.gisTolerance||(p+=(b=a.reducePrecision(b))+","+(y=a.reducePrecision(y))+" ",h=b,d=y)}return p},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.prototype.tileURL=function(e,r,i,n){var o;switch(e.getAttribute("tile-url-provider-type")){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":o=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":o=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":o=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":o=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":o=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":o=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":o=a.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}return o[Math.floor(Math.random()*o.length)].replace("[zoom]",r.toString()).replace("[x]",i.toString()).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=a.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=a.stringToByteArray(t+"/"+e+"/"+r+".png"),o=0;o<n.length;o++)n[o]^=i[o%n.length];return btoa(a.byteArrayToString(n))},t.buttonDown=0,t.prevPtrCoords=[0,0],t.gisTolerance=2,t.tileImageSize=256,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),M=function(){function t(){}return t.createMarkupPipe=function(t){var e=n.cloneElementWithId("markup-pipe"),r=t+"basepath";n.findChildOfType(e,"basepath").firstElementChild.id=r;var i=n.findChildOfType(e,"pipe"),a=n.findChildOfType(e,"inner-pipe"),o=n.findChildOfType(e,"bubbles"),s="#"+r;return i.setAttributeNS(n.xlinkns,"href",s),a.setAttributeNS(n.xlinkns,"href",s),o.setAttributeNS(n.xlinkns,"href",s),e},t.updateMarkupPipe=function(t,e,r){for(var i,o=n.findChildOfType(t,"basepath").firstElementChild,s=o.id,l=n.findChildOfType(t,"batches"),u=n.findChildOfType(t,"bubbles"),c=0;c<e.length;c++)switch(e[c]){case"phase":u.setAttribute("stroke-dashoffset",(12-parseFloat(r[c])).toString());break;case"batch":var h=r[c].split(" ");i||(i=o.getTotalLength());var d=parseFloat(h[1])*i,p=parseFloat(h[2])*i,f=n.childElements(l)[parseInt(h[0])];f.setAttribute("stroke",h[3]),f.setAttribute("stroke-dasharray","0.1,"+d+","+p+","+i);break;case"newbatches":for(var m=parseInt(r[c]),g=l.childElementCount,v=m;v<g;v++)n.removeElement(l,l.lastElementChild);for(v=g;v<m;v++)f=n.createUseElement(s),l.appendChild(f);break;case"d":var b=parseFloat(n.findChildOfType(t,"pipe").getAttribute("stroke-width")),y=a.roundPathCorners(r[c],2*b,!1);o.setAttribute("d",y);break;case"width":var A=parseFloat(r[c]);n.findChildOfType(t,"pipe").setAttribute("stroke-width",A.toString()),n.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*A).toString()),l.setAttribute("stroke-width",(.6*A).toString());var T=Math.min(5,.2*A);u.setAttribute("stroke-width",T.toString()),u.setAttribute("stroke-dasharray",T+","+(12-T));break;case"color":n.findChildOfType(t,"pipe").setAttribute("stroke",r[c]);break;case"inner-color":n.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[c]);break;default:t.setAttribute(e[c],r[c])}},t.createMarkupStorageTank=function(){return n.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=n.findChildOfType(t,"square"),o=n.findChildOfType(t,"batches"),s=parseFloat(i.getAttribute("width")),l=0;l<e.length;l++)switch(e[l]){case"batch":var u=r[l].split(" "),c=parseFloat(u[1])*s,h=parseFloat(u[2])*s,d=n.childElements(o)[parseInt(u[0])];a.setMultipleAttributes(d,["y","height","fill"],[s/2-c-h,h,u[3]]);break;case"newbatches":for(var p=parseInt(r[l]),f=o.childElementCount,m=p;m<f;m++)n.removeElement(o,o.lastElementChild);for(m=f;m<p;m++)d=n.createSvgElement("rect"),a.setMultipleAttributes(d,["stroke","width","x"],["none",s,-s/2]),o.appendChild(d);break;case"progress":var g=parseFloat(r[l])*Math.PI*2,v=parseFloat(n.findChildOfType(t,"circle").getAttribute("r"))-2,b=v*Math.sin(g),y=-v*Math.cos(g),A="M 0 "+-v+" ";A+="A "+v+" "+v+" 0 "+(g>Math.PI?"1":"0")+" 1 "+b+" "+y,n.findChildOfType(t,"arc").setAttribute("d",A);break;case"radius":n.findChildOfType(t,"circle").setAttribute("r",r[l]),s=Math.max(10,2*parseFloat(r[l])/Math.sqrt(2)-8),a.setMultipleAttributes(i,["width","height","x","y"],[s,s,-s/2,-s/2]);break;case"color":n.findChildOfType(t,"circle").setAttribute("fill",r[l]);break;case"stroke-color":n.findChildOfType(t,"circle").setAttribute("stroke",r[l]),n.findChildOfType(t,"square").setAttribute("stroke",r[l]);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupBulkConveyorBelt=function(t){var e=n.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";n.findChildOfType(e,"basepath").firstElementChild.id=r;var i=n.findChildOfType(e,"belt"),a=n.findChildOfType(e,"belt-sections"),o="#"+r;return i.setAttributeNS(n.xlinkns,"href",o),a.setAttributeNS(n.xlinkns,"href",o),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,a=n.findChildOfType(t,"basepath").firstElementChild,o=a.id,s=n.findChildOfType(t,"belt-sections"),l=n.findChildOfType(t,"batches"),u=0;u<e.length;u++)switch(e[u]){case"phase":s.setAttribute("stroke-dashoffset",r[u]);break;case"batch":var c=r[u].split(" ");i||(i=a.getTotalLength());var h=parseFloat(c[1])*i,d=parseFloat(c[2])*i,p=n.childElements(l)[parseInt(c[0])];p.setAttribute("stroke",c[3]),p.setAttribute("stroke-dasharray","0.1,"+h+","+d+","+i);break;case"newbatches":for(var f=parseInt(r[u]),m=l.childElementCount,g=f;g<m;g++)n.removeElement(l,l.lastElementChild);for(g=m;g<f;g++)p=n.createUseElement(o),l.appendChild(p);break;case"d":a.setAttribute("d",r[u]);break;case"width":var v=r[u];n.findChildOfType(t,"belt").setAttribute("stroke-width",v),s.setAttribute("stroke-width",v),s.setAttribute("stroke-dasharray","2, 10"),l.setAttribute("stroke-width",(.4*parseFloat(v)).toString());break;case"color":n.findChildOfType(t,"belt").setAttribute("stroke",r[u]);break;case"sections-color":s.setAttribute("stroke",r[u]);break;default:t.setAttribute(e[u],r[u])}},t}(),O=function(){function t(){}return t.createMarkupPath=function(t,e){var r=n.cloneElementWithId("markup-path"),i=e+"basepath";n.findChildOfType(r,"basepath").firstElementChild.id=i;var a=n.findChildOfType(r,"paths"),o=1;"MarkupPathRoad"==t&&(o=2),"MarkupPathRailroad"==t&&(o=4);for(var s=0;s<o;s++){var l=n.createUseElement(i);a.appendChild(l)}var u=n.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(a.firstElementChild.setAttribute("stroke","gray"),u.setAttribute("stroke","white")):"MarkupPathRoad"==t?(a.firstElementChild.setAttribute("stroke","gray"),a.lastElementChild.setAttribute("stroke","white"),u.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(a.firstElementChild.setAttribute("stroke","gray"),n.childElements(a)[1].setAttribute("stroke","black"),n.childElements(a)[2].setAttribute("stroke","white"),a.lastElementChild.setAttribute("stroke","gray"),u.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),o=n.findChildOfType(t,"basepath").firstElementChild,s=n.findChildOfType(t,"paths"),l=s.firstElementChild,u=n.findChildOfType(t,"arrows"),c=0;c<e.length;c++)switch(e[c]){case"d":o.setAttribute("d",r[c]);break;case"bidirectional":n.removeAllChildren(u),"false"==r[c]&&a.addPathArrows(o,"arrowhead",1.7,u,50,100);break;case"stroke-width":var h=parseFloat(r[c]);switch(i){case"MarkupPathLine":l.setAttribute("stroke-width",h.toString());break;case"MarkupPathDashline":l.setAttribute("stroke-width",h.toString()),l.setAttribute("stroke-dasharray",4*h+" "+h);break;case"MarkupPathConveyor":l.setAttribute("stroke-width",h.toString()),l.setAttribute("stroke-dasharray",h/2+" "+h/10);break;case"MarkupPathRoad":l.setAttribute("stroke-width",h.toString());var d=s.lastElementChild;d.setAttribute("stroke-width",(h/12).toString()),d.setAttribute("stroke-dasharray",h/2+" "+h/5);break;case"MarkupPathRailroad":var p=h/10+" "+h/2.5;l.setAttribute("stroke-width",h.toString()),l.setAttribute("stroke-dasharray",p),n.childElements(s)[1].setAttribute("stroke-width",(h/2+h/12).toString()),n.childElements(s)[2].setAttribute("stroke-width",(h/2).toString());var f=s.lastElementChild;f.setAttribute("stroke-width",(h/2).toString()),f.setAttribute("stroke-dasharray",p)}break;case"stroke":l.setAttribute("stroke",r[c]),h=parseFloat(l.getAttribute("stroke-width")),u.setAttribute("stroke",h>4?"white":r[c]);break;default:t.setAttribute(e[c],r[c])}},t.createMarkupAreaNode=function(t){var e,r=n.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=n.createSvgElement("rect");break;case"MarkupPolygonalNode":e=n.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:i.setAttribute(e[n],r[n])}},t.createMarkupPalletRack=function(){return n.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,o=t.lastElementChild,s=0;s<e.length;s++)switch(e[s]){case"stroke":o.setAttribute(e[s],r[s]);break;case"fill":i.setAttribute(e[s],r[s]);break;case"rack-data":n.removeAllChildren(i),n.removeAllChildren(o);var l=r[s].split(" "),u=parseInt(l[0]),c=parseInt(l[1]),h=parseFloat(l[2]),d=parseFloat(l[3]),p=parseFloat(l[4]),f=void 0,m=void 0,g=void 0;u>1&&(f=parseFloat(l[5]),m=parseFloat(l[6]),g=d+f);var v=n.createSvgElement("rect");if(v.setAttribute("width",h.toString()),v.setAttribute("height",d.toString()),i.appendChild(v),u>1){var b=n.createSvgElement("rect");b.setAttribute("width",h.toString()),b.setAttribute("height",m.toString()),b.setAttribute("transform","translate( 0 "+g+")"),i.appendChild(b)}for(var y=p,A=0;A<c-1;A++){var T=n.createSvgElement("line");a.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,"0",d]),o.appendChild(T),y+=p}if(u>1){var C=g+m;y=p;for(A=0;A<c-1;A++){T=n.createSvgElement("line");a.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,g,C]),o.appendChild(T),y+=p}}break;default:t.setAttribute(e[s],r[s])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),I=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=n.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=n.createSvgElement("path");break;case"MarkupCircularWall":r=n.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=n.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupTargetLine=function(){return n.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var a=n.findChildOfType(e,"polyline"),o=n.findChildOfType(e,"serif-start"),s=n.findChildOfType(e,"serif-end"),l=0;l<r.length;l++)switch(r[l]){case"color":e.setAttribute("stroke",i[l]);break;case"points":a.setAttribute(r[l],i[l]);var u=i[l].split(" "),c=u.length;u[c-1].includes(",")||c--,t.setSerif(u[0],u[1],o),t.setSerif(u[c-1],u[c-2],s);break;default:e.setAttribute(r[l],i[l])}},t.createMarkupPathway=function(){return n.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=n.findChildOfType(t,"polygon"),o=n.findChildOfType(t,"polyline"),s=n.findChildOfType(t,"ties"),l=0;l<e.length;l++)switch(e[l]){case"color":s.setAttribute("stroke",r[l]);break;case"points":var u=r[l].split(" "),c="",h="",d="";n.removeAllChildren(s);for(var p=0;p<u.length;p++){var f=a.splitToFloats(u[p],",");if(4==f.length){c+=f[0]+","+f[1]+" ",h=f[2]+","+f[3]+" "+h,d+=(f[0]+f[2])/2+","+(f[1]+f[3])/2+" ";var m=n.createSvgElement("line");a.setMultipleAttributes(m,["x1","y1","x2","y2"],[f[0],f[1],f[2],f[3]]),s.appendChild(m)}}i.setAttribute("points",c+h),o.setAttribute("points",d);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupPedFlowStatistics=function(){return n.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=n.findChildOfType(t,"line"),a=n.findChildOfType(t,"serif-end"),o=n.findChildOfType(t,"direction"),s=n.findChildOfType(t,"arrow-right"),l=n.findChildOfType(t,"arrow-left"),u=0;u<e.length;u++)switch(e[u]){case"color":t.setAttribute("stroke",r[u]);break;case"length":i.setAttribute("x2",r[u]),a.setAttribute("x1",r[u]),a.setAttribute("x2",r[u]);var c=parseInt(r[u])/2;o.setAttribute("x1",c.toString()),o.setAttribute("x2",c.toString()),s.setAttribute("transform","translate("+c+" 13) rotate(90)"),l.setAttribute("transform","translate("+c+" -13) rotate(-90)");break;case"direction":switch(s.setAttribute("visibility","inherit"),l.setAttribute("visibility","inherit"),r[u]){case"right":l.setAttribute("visibility","hidden");break;case"left":s.setAttribute("visibility","hidden")}break;default:t.setAttribute(e[u],r[u])}},t.createMarkupServiceWithLines=function(){return n.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var a=n.findChildOfType(e,"queues"),o=n.findChildOfType(e,"services"),s=n.findChildOfType(e,"reverse-queues"),l=n.findChildOfType(e,"area"),u=0;u<r.length;u++)switch(r[u]){case"queue-color":a.setAttribute("stroke",i[u]);break;case"reverse-queue-color":s.setAttribute("stroke",i[u]);break;case"service-color":o.setAttribute("stroke",i[u]);break;case"clear-all-queues":n.removeAllChildren(a),n.removeAllChildren(s);break;case"queue":t.addQueue(a,i[u]);break;case"reverse-queue":t.addQueue(s,i[u]);break;case"clear-services":n.removeAllChildren(o);break;case"service":t.addService(o,i[u]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":l.setAttribute(r[u],i[u]);break;default:e.setAttribute(r[u],i[u])}},t.createMarkupServiceWithArea=function(){return n.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var a=n.findChildOfType(e,"services"),o=0;o<r.length;o++)switch(r[o]){case"service-color":a.setAttribute("stroke",i[o]);break;case"clear-services":n.removeAllChildren(a);break;case"service":t.addService(a,i[o]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":break;default:e.setAttribute(r[o],i[o])}},t.createMarkupEscalatorGroup=function(){return n.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=n.findChildOfType(t,"background"),o=n.findChildOfType(t,"escalators"),s=0;s<e.length;s++)switch(e[s]){case"balustrade-color":i.setAttribute("fill",r[s]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[s]?"inherit":"hidden");break;case"dimensions-completed":var l=a.getIntAttribute(t,"number-of-escalators"),u=a.getFloatAttribute(t,"width"),c=a.getFloatAttribute(t,"length"),h=a.getFloatAttribute(t,"left-balustrade-width"),d=a.getFloatAttribute(t,"right-balustrade-width"),p=a.getFloatAttribute(t,"internal-balustrade-width"),f=a.getFloatAttribute(t,"lower-landing-length"),m=h+d+l*u+(l-1)*p,g=f+c+a.getFloatAttribute(t,"upper-landing-length");a.setMultipleAttributes(i,["y","width","height"],[-h,g,m]);for(var v=0;v<l;v++){var b=v*(u+p),y=n.cloneElementWithId("escalator"),A=n.findChildOfType(y,"background");a.setMultipleAttributes(A,["y","width","height"],[b,g,u]);var T=n.findChildOfType(y,"handrail-left"),C=n.findChildOfType(y,"handrail-right");a.setMultipleAttributes(T,["x2","y1","y2"],[g,b,b]),a.setMultipleAttributes(C,["x2","y1","y2"],[g,b+u,b+u]);var S=n.findChildOfType(y,"lower-landing-end"),E=n.findChildOfType(y,"upper-landing-end");a.setMultipleAttributes(S,["x1","x2","y1","y2"],[f,f,b,b+u]),a.setMultipleAttributes(E,["x1","x2","y1","y2"],[f+c,f+c,b,b+u]);var w=n.findChildOfType(y,"stairs");a.setMultipleAttributes(w,["x1","x2","y1","y2","stroke-width"],[f,f+c,b+u/2,b+u/2,u]),o.appendChild(y)}break;case"offsets":var k=a.splitToFloats(r[s]," "),x=n.childElements(o);for(v=0;v<x.length;v++)n.findChildOfType(x[v],"stairs").setAttribute("stroke-dashoffset",(-k[v]).toString());break;default:t.setAttribute(e[s],r[s])}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),o=parseFloat(i[0]),s=parseFloat(i[1]),l=parseFloat(n[0])-o,u=parseFloat(n[1])-s,c=Math.hypot(l,u),h=3*u/c,d=3*l/c;a.setMultipleAttributes(r,["x1","x2","y1","y2"],[o+h,o-h,s-d,s+d])},t.addService=function(t,e){var r,i=e.split(" "),o=parseFloat(a.getSubAttribute(i,"x")),s=parseFloat(a.getSubAttribute(i,"y")),l=a.radiansToDegrees(parseFloat(a.getSubAttribute(i,"orientation")));if("point"==a.getSubAttribute(i,"type")){(r=n.createUseElement("service-point")).setAttribute("transform","translate("+o+" "+s+")");var u=n.createUseElement("arrowhead-small");u.setAttribute("transform","translate("+(o-11)+" "+s+") rotate("+l+" 11 0)"),t.appendChild(u)}else{(r=n.cloneElementWithId("service-line")).setAttribute("transform","translate("+o+" "+s+") rotate("+l+")");var c=r.firstElementChild.nextElementSibling,h=parseFloat(a.getSubAttribute(i,"length"));if(c.setAttribute("x2",h),"true"==a.getSubAttribute(i,"bidirectional")){var d=r.lastElementChild;d.setAttribute("visibility","inherit"),d.setAttribute("transform","translate("+(h+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=a.splitSkipEmpty(e,"|"),i=a.getSubAttribute(r,"queue-path"),o=n.createSvgElement("path");o.setAttribute("d",i),t.appendChild(o),a.addPathArrows(o,"arrowhead-small",.7,t,50,100);var s=a.getSubAttribute(r,"fence-color");if(s)for(var l=[a.getSubAttribute(r,"fence-path-left"),a.getSubAttribute(r,"fence-path-right")],u=0;u<l.length;u++){var c=n.createSvgElement("path");a.setMultipleAttributes(c,["d","stroke","stroke-width","stroke-dasharray"],[l[u],s,"2","none"]),t.appendChild(c)}},t}(),_=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return n.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return n.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i])},t}(),L=function(){function t(){}return t.createMarkupIntersection=function(){return n.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,o=n.findChildOfType(t,"lane-connectors"),s=0;s<e.length;s++)switch(e[s]){case"fill":case"d":i.setAttribute(e[s],r[s]);break;case"lane-connector":var l=n.createSvgElement("g"),u=n.createSvgElement("path");u.setAttribute("d",r[s]),l.appendChild(u),a.addPathArrows(u,"arrowhead-tiny",.5,l,20,40),o.appendChild(l);break;case"lane-connector-colors":for(var c=a.splitSkipEmpty(r[s]," "),h=n.childElements(o),d=0;d<h.length;d++)h[d].setAttribute("stroke",c[d]);break;default:t.setAttribute(e[s],r[s])}},t.createMarkupRoad=function(){return n.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var o=n.findChildOfType(e,"lanes"),s=n.findChildOfType(e,"delimiters"),l=n.findChildOfType(e,"median"),u=0;u<r.length;u++)switch(r[u]){case"lane-width":o.setAttribute("stroke-width",i[u]);break;case"lane-color":o.setAttribute("stroke",i[u]);break;case"forward-lane":case"backward-lane":var c=n.createSvgElement("path");c.setAttribute("d",i[u]),o.appendChild(c);break;case"lane-delimiter-color":s.setAttribute("stroke",i[u]);break;case"lane-delimiter-width":case"lane-delimiter-style":s.setAttribute(r[u],i[u]);break;case"lane-delimiter":var h=a.getFloatAttribute(s,"lane-delimiter-width"),d=s.getAttribute("lane-delimiter-style");t.addDelimiter(s,h,d,i[u],o.getAttribute("stroke"));break;case"median-color":l.setAttribute("stroke",i[u]);break;case"median-width":case"median-style":l.setAttribute(r[u],i[u]);break;case"median":h=a.getFloatAttribute(l,"median-width"),d=l.getAttribute("median-style"),t.addDelimiter(l,h,d,i[u],o.getAttribute("stroke"));break;default:e.setAttribute(r[u],i[u])}},t.addDelimiter=function(t,e,r,i,o){var s=r.includes("DASHED"),l=r.includes("DOUBLE"),u=n.createSvgElement("path");if(u.setAttribute("d",i),u.setAttribute("stroke-width",(l?3*e:e).toString()),s&&u.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(u),l){var c=n.createSvgElement("path");a.setMultipleAttributes(c,["d","stroke-width","stroke"],[i,e,o]),t.appendChild(c)}},t.createMarkupStopLine=function(){return n.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:t.setAttribute(e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return n.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t}(),P=function(){function t(e){this.serverFPS=t.MAX_FPS,this.client=e,this.chart=new S(this),this.control=new g(this),this.shapeComposite=new o(this),this.shapeGISMap=new x(this)}return t.prototype.start=function(){this.frameDrawStartTime=Date.now(),this.catchingUp=!1,this.frameCount=0,this.fpsMeasureStartTime=null,this.actualFPS=0,this.settings={},this.packetBuffer=[],this.fullFrame=!1,this.packetFPS=t.MAX_FPS,this.desiredFPS=t.MAX_FPS,this.frameBuffer=[],this.sleepTimeStatistics=new Array(t.SLEEP_TIME_STATISTICS_SIZE),this.sleepTimeStatistics.fill(1e3/t.MAX_FPS),this.startMeasureInterval(),this.startFrameDrawingTimeout(this.desiredFPS)},t.prototype.stop=function(){this.settings={},this.packetBuffer=[],this.frameBuffer=[],this.stopMeasureInterval(),this.stopFrameDrawingTimeout()},t.prototype.startMeasureInterval=function(){var t=this;this.fpsMeasureIntervalId=setInterval(function(){return t.measureFPS()},1e3)},t.prototype.stopMeasureInterval=function(){this.fpsMeasureIntervalId&&(clearInterval(this.fpsMeasureIntervalId),this.fpsMeasureIntervalId=void 0)},t.prototype.startFrameDrawingTimeout=function(t){var e=this;this.frameDrawingTimeoutId=setTimeout(function(){var t=Date.now();e.drawFrame();var r=1e3/e.desiredFPS-(Date.now()-t);r<0&&(r=0),e.sleepTimeStatistics.push(r),e.sleepTimeStatistics.shift(),e.startFrameDrawingTimeout(r)},t)},t.prototype.stopFrameDrawingTimeout=function(){this.frameDrawingTimeoutId&&(clearTimeout(this.frameDrawingTimeoutId),this.frameDrawingTimeoutId=void 0)},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.totalFrameCount=function(){var t=this.frameBuffer.length;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.findOrRequestFullFrame=function(){if(this.fullFrame)console.log("Found a full frame in the local buffer, starting from there");else{for(var t=0;t<this.packetBuffer.length;t++){if(this.packetBuffer[t].fullFrame)return console.log("Found a full frame in the local buffer, starting from there"),void this.packetBuffer.splice(0,t)}this.packetBuffer=[],console.log("Cleared local frame buffer, requesting full frame from the server"),this.client.network.requestAndWaitFullFrame()}},t.prototype.switchToNextFrame=function(){if(0==this.frameBuffer.length){if(0==this.packetBuffer.length)return this.fullFrame=!1,this.packetFPS=t.MAX_FPS,void(this.desiredFPS=t.MAX_FPS);var e=this.packetBuffer.shift();this.frameBuffer=e.frames,this.fullFrame=e.fullFrame,this.packetFPS=e.fps,this.desiredFPS=e.fps,this.updateServerFpsIfNeeded()}return this.frameBuffer.shift()},t.prototype.updateServerFpsIfNeeded=function(){var e=this.actualFPS/this.packetFPS,r=this.measureSleepTime();if(e>=.9&&r>50&&this.serverFPS<t.MAX_FPS)return this.serverFPS++,void this.client.network.postMaxFPS(this.serverFPS);e<.9&&r<50&&this.serverFPS>1&&(this.serverFPS--,e<.7&&this.serverFPS>1&&this.serverFPS--,e<.6&&this.serverFPS>1&&this.serverFPS--,this.client.network.postMaxFPS(this.serverFPS))},t.prototype.measureSleepTime=function(){for(var t=0,e=0;e<this.sleepTimeStatistics.length;e++)t+=this.sleepTimeStatistics[e];return t/=this.sleepTimeStatistics.length},t.prototype.drawFrame=function(){var t=this.switchToNextFrame();if(t){this.client.updateExperimentState(t),this.fullFrame&&(this.fullFrame=!1,n.removeAllChildren(this.client.presentation)),this.frameDrawStartTime=Date.now(),this.client.svg.suspendRedraw(5e3),this.time=t.time;var e,r,o,s=t.commands;if(s.length>0&&"white"!=this.client.svg.style.backgroundColor&&(this.client.svg.style.backgroundColor="white"),G.DEBUG_MODE){var l=this.totalFrameCount();this.client.debugger.timeInfo.innerHTML=a.formatNumber(this.time,2),this.client.debugger.serverQueueInfo.innerHTML=this.client.network.serverQueue,this.client.debugger.browserQueueInfo.innerHTML=l+":"+this.client.network.packetManager.totalFrameCount(),e=0,r=0,o=0}for(var u=0;u<s.length;u++){var c=s[u],h=void 0,d=c.groupId,p=c.att,f=c.val,m=void 0;switch(c.cmd){case"C":if(m=this.createShape(c.type,c.id),null==d)this.client.presentation.appendChild(m);else{if(null==(h=document.getElementById(d)))return console.log("Can't find container to add a shape to, container id = "+d,c),void this.findOrRequestFullFrame();if("ShapeGISMap"==h.getAttribute("type")){var g=n.findChildOfType(h,"map").firstElementChild;h=c.type.startsWith("MarkupGIS")?n.findChildOfType(g,"markup"):n.findChildOfType(g,"agents")}h.appendChild(m)}this.updateShape(m,p,f),e++;break;case"U":if(null==(m=document.getElementById(c.id)))return console.log("Can't find shape to be updated, shape id = "+c.id,c),void this.findOrRequestFullFrame();this.updateShape(m,p,f),r++;break;case"D":if(null==(m=document.getElementById(c.id)))return console.log("Can't find shape to be deleted, shape id = "+c.id,c),void this.findOrRequestFullFrame();n.removeElement(m.parentNode,m),o++;break;case"N":this.applyNavigation(p,f);break;case"S":this.applySettings(p,f);break;default:return void this.client.stopAndAlert("Unknown command: "+c.cmd,null)}}this.client.svg.unsuspendRedrawAll(),this.frameCount++,G.DEBUG_MODE&&(this.client.debugger.cudCountInfo.innerHTML=e+"/"+r+"/"+o,this.client.debugger.drawTimeInfo.innerHTML=Date.now()-this.frameDrawStartTime,this.client.debugger.shapeCountInfo.innerHTML=i.elementcount),!this.catchingUp&&this.packetBuffer.length>1?(this.catchingUp=!0,this.desiredFPS=1e3/this.packetFPS*.8):this.catchingUp&&(this.catchingUp=!1,this.desiredFPS=1e3/this.packetFPS)}},t.prototype.createShape=function(t,e){var r;if(n.isPrimitiveSVGElement(t))r=n.createSvgElement(t);else switch(t){case"ShapeArc":r=o.createShapeArc();break;case"ShapeText":r=o.createShapeText();break;case"ShapeImage":r=o.createShapeImage();break;case"ShapeCanvas":r=o.createShapeCanvas(e);break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=O.createMarkupPath(t,e);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=O.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=O.createMarkupPalletRack();break;case"MarkupRailwaySwitch":r=_.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=_.createMarkupPositionOnTrack();break;case"MarkupPipe":r=M.createMarkupPipe(e);break;case"MarkupStorageTank":r=M.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=M.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=I.createMarkupWall(t,e);break;case"MarkupTargetLine":r=I.createMarkupTargetLine();break;case"MarkupPathway":r=I.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=I.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=I.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=I.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=I.createMarkupEscalatorGroup();break;case"MarkupIntersection":r=L.createMarkupIntersection();break;case"MarkupRoad":r=L.createMarkupRoad();break;case"MarkupStopLine":r=L.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=L.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=k.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=S.create();break;case"Window3D":r=s.create();break;default:return this.client.stopAndAlert("Can't create: unknown object type: "+t,void 0),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(t,e,r){var i=t.getAttribute("type");if(n.isPrimitiveSVGElement(i))for(var a=0;a<e.length;a++)if("href"==e[a])t.setAttributeNS(n.xlinkns,"href",r[a]);else if("href-path"==e[a])t.setAttributeNS(n.xlinkns,"href",this.client.network.getJarResourceURL(r[a]));else if("geo"==e[a]){var l=r[a].split("|");t.setAttribute("lon",l[0]),t.setAttribute("lat",l[1]),t.setAttribute("heading",l[2]),x.updateGISObjectPosition(t)}else t.setAttribute(e[a],r[a]);else switch(i){case"ShapeArc":o.updateShapeArc(t,e,r);break;case"ShapeText":o.updateShapeText(t,e,r);break;case"ShapeImage":this.shapeComposite.updateShapeImage(t,e,r);break;case"ShapeCanvas":o.updateShapeCanvas(t,e,r);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(t,e,r);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(t,e,r);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":O.updateMarkupPath(t,e,r);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":O.updateMarkupAreaNode(t,e,r);break;case"MarkupPalletRack":O.updateMarkupPalletRack(t,e,r);break;case"MarkupRailwaySwitch":_.updateMarkupRailwaySwitch(t,e,r);break;case"MarkupPositionOnTrack":_.updateMarkupPositionOnTrack(t,e,r);break;case"MarkupPipe":M.updateMarkupPipe(t,e,r);break;case"MarkupStorageTank":M.updateMarkupStorageTank(t,e,r);break;case"MarkupBulkConveyorBelt":M.updateMarkupBulkConveyorBelt(t,e,r);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":I.updateMarkupWall(t,e,r);break;case"MarkupTargetLine":I.updateMarkupTargetLine(t,e,r);break;case"MarkupPathway":I.updateMarkupPathway(t,e,r);break;case"MarkupPedFlowStatistics":I.updateMarkupPedFlowStatistics(t,e,r);break;case"MarkupServiceWithLines":I.updateMarkupServiceWithLines(t,e,r);break;case"MarkupServiceWithArea":I.updateMarkupServiceWithArea(t,e,r);break;case"MarkupEscalatorGroup":I.updateMarkupEscalatorGroup(t,e,r);break;case"MarkupIntersection":L.updateMarkupIntersection(t,e,r);break;case"MarkupRoad":L.updateMarkupRoad(t,e,r);break;case"MarkupStopLine":L.updateMarkupStopLine(t,e,r);break;case"MarkupBusStop":case"MarkupParkingLot":L.updateMarkupBusStopOrParkingLot(t,e,r);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":k.updateGISMarkup(t,e,r);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(t,e,r);break;case"Window3D":s.update(t,e,r)}},t.prototype.measureFPS=function(){var t=Date.now();null!=this.fpsMeasureStartTime&&(this.actualFPS=Math.round(1e3*this.frameCount/(t-this.fpsMeasureStartTime))),G.DEBUG_MODE&&(this.client.debugger.fpsInfo.innerHTML=this.actualFPS+":"+this.packetFPS),this.fpsMeasureStartTime=t,this.frameCount=0},t.prototype.onControlAction=function(t,e){this.client.network.postUserAction(t,e)},t.prototype.onUserClick=function(t,e,r){n.isContainedInElementOfType(t,g.controlTypes)||n.isContainedInElementOfType(t,S.chartTypes)||n.isContainedInElementOfType(t,["Window3D"])||n.isContainedInElementOfType(t,["ShapeGISMap"])||this.client.network.postUserAction(0,e+" "+r)},t.prototype.applySettings=function(t,e){for(var r=0;r<t.length;r++)this.settings[a.hyphenToCameLCase(t[r])]=e[r];this.settings.startTime=parseInt(this.settings.startTime),this.settings.startDate=parseInt(this.settings.startDate),this.settings.stopTime&&(this.settings.stopTime=parseInt(this.settings.startTime),this.settings.stopDate=parseInt(this.settings.startDate)),G.DEBUG_SPARK_LOCAL&&(this.client.svg.style.width=this.settings.width+"px",this.client.svg.style.height=this.settings.height+"px")},t.prototype.applyNavigation=function(t,e){for(var r,i,n,a=0;a<t.length;a++)switch(t[a]){case"x":r=parseFloat(e[a]);break;case"y":i=parseFloat(e[a]);break;case"zoom":n=parseFloat(e[a])}this.client.navigation.navigateTo(r,i,n)},t.SLEEP_TIME_STATISTICS_SIZE=20,t.MAX_FPS=20,t}(),R=function(){function t(t,e,r){var i=this;this.networkManager=t,this.startTime=Date.now(),this.xhttp=this.networkManager.getAnimationPacket(e,function(){i.stopTime=Date.now(),r(i)})}return t.prototype.requestTime=function(){return this.stopTime?this.stopTime-this.startTime:Date.now()-this.startTime},t.prototype.abort=function(){this.xhttp.abort()},t}(),D=function(){function t(t){this.paused=!1,this.networkManager=t}return t.prototype.start=function(){this.fullFrame=!0,this.activeRequests=[],this.responseTimeStatistics=new Array(t.REQUEST_STATISTICS_SIZE),this.responseTimeStatistics.fill(N.MIN_REQUEST_INTERVAL),this.requestInterval=N.MIN_REQUEST_INTERVAL,this.lastRequestTime=0,this.createRequest(),this.startRequestTimeout()},t.prototype.stop=function(){this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.pause=function(){this.paused=!0,this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.requestFullFrame=function(){console.debug(">> SVG: Request full frame."),this.fullFrame=!0},t.prototype.startRequestTimeout=function(){var t=this;this.requestTimeoutId=setTimeout(function(){t.processRequestTimeout()},this.requestInterval)},t.prototype.processRequestTimeout=function(){this.requestTimeoutId=void 0,this.activeRequests.length<N.MAX_REQUEST_COUNT&&(this.createRequest(),this.startRequestTimeout())},t.prototype.createRequest=function(){var t=this,e=new R(this.networkManager,this.fullFrame,function(e){return t.processResponse(e)});this.fullFrame=!1,this.activeRequests.push(e),this.lastRequestTime=Date.now()},t.prototype.processResponse=function(t){var e=this.activeRequests.indexOf(t);if(this.activeRequests.splice(e,1),this.addToResponseTimeStatistics(t.requestTime()),void 0!==this.requestTimeoutId||this.paused||(this.createRequest(),this.startRequestTimeout()),4==t.xhttp.readyState&&200==t.xhttp.status){var r=JSON.parse(t.xhttp.responseText);this.networkManager.packetManager.addPacket(r)}},t.prototype.addToResponseTimeStatistics=function(t){this.responseTimeStatistics.push(t),this.responseTimeStatistics.shift(),this.requestInterval=this.calculateRequestInterval(),this.networkManager.RPS=1e3/this.requestInterval},t.prototype.calculateRequestInterval=function(){if(0===this.responseTimeStatistics.length)return N.MIN_REQUEST_INTERVAL;for(var t=0,e=0;e<this.responseTimeStatistics.length;e++)t+=this.responseTimeStatistics[e];var r=t/this.responseTimeStatistics.length*.5;return r<N.MIN_REQUEST_INTERVAL?N.MIN_REQUEST_INTERVAL:r>N.MAX_REQUEST_INTERVAL?N.MAX_REQUEST_INTERVAL:r},t.REQUEST_STATISTICS_SIZE=10,t}(),F=function(){function t(t){this.client=t,this.reset()}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.waitingFullFrame=!1,this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.pause=function(){this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.addPacket=function(t){if(t){var e=t.frames;if(e&&0!==e.length){var r=e[0];if(!(r.number<this.expectedFrameNumber)){if(r.number===this.expectedFrameNumber||t.fullFrame){this.client.network.serverQueue=t.serverQueue;var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),this.cancelWaitExpectedFrameTimeoutIfNeeded(),void(t.fullFrame&&(this.waitingFullFrame=!1))}this.insertToPacketBuffer(t),console.debug(">> SVG: Reordering  or packet loss expectedFrame=",this.expectedFrameNumber),this.startWaitExpectedFrameTimeoutIfNeeded()}}}},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length&&!(this.packetBuffer[0].frames[0].number>=this.expectedFrameNumber)){var t=this.packetBuffer[this.packetBuffer.length-1];if(t.frames[t.frames.length-1].number>=this.expectedFrameNumber)this.packetBuffer=[];else{for(var e=0;e<this.packetBuffer.length&&!(this.packetBuffer[e].frames[0].number>=this.expectedFrameNumber);e++);this.packetBuffer.splice(0,e)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length&&this.packetBuffer[0].frames[0].number===this.expectedFrameNumber){for(var t=this.expectedFrameNumber,e=0;e<this.packetBuffer.length;e++){var r=this.packetBuffer[e].frames;if(r[0].number!==t)break;t=r[r.length-1].number+1}var i=this.packetBuffer.splice(0,e);this.client.frameDrawing.addAllPackets(i),this.expectedFrameNumber=t}},t.prototype.cancelWaitExpectedFrameTimeoutIfNeeded=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startWaitExpectedFrameTimeoutIfNeeded=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,t.client.network.requestFullFrame()},4*this.client.network.RPS*1e3))},t.prototype.waitFullFrame=function(){console.debug(">> SVG: Wait full frame."),this.waitingFullFrame=!0,this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t}(),N=function(){function t(t){this.client=t,this.packetRequester=new D(this),this.packetManager=new F(t)}return t.prototype.start=function(){this.packetManager.reset(),this.packetRequester.start()},t.prototype.stop=function(){this.packetRequester.stop(),this.packetManager.reset()},t.prototype.pause=function(){this.paused=!0,this.packetRequester.pause()},t.prototype.getAnimationPacket=function(t,e){if(!this.paused){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},G.DEBUG_SPARK_LOCAL?r.open("GET","/http/update?fullFrame="+t+"&time="+Date.now(),!0):r.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+Date.now(),!0),r.send(),r}},t.prototype.postUserAction=function(t,e){if(!this.paused){var r=new XMLHttpRequest;G.DEBUG_SPARK_LOCAL?r.open("GET","/http/useraction?id="+t+"&value="+encodeURIComponent(e)):r.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),r.send()}},t.prototype.postUserCommand=function(t,e){if(!this.paused){var r=new XMLHttpRequest;r.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),r.send()}},t.prototype.getJarResourceURL=function(t){return this.getResourceURLWithSubpath("internal-resources",t)},t.prototype.getResourceURL=function(t){return this.getResourceURLWithSubpath("resources",t)},t.prototype.getResourceURLWithSubpath=function(t,e){if(!this.paused)return G.DEBUG_SPARK_LOCAL?"/http/image?path="+e:this.getRestRoot()+t+"?path="+e},t.prototype.getRestRoot=function(){return this.client.svgAnimationInfo.host+"/nodes/"+this.client.svgAnimationInfo.restUrl+"sessions/"+this.client.svgAnimationInfo.sessionUuid+"/"},t.prototype.postMaxFPS=function(t){if(!this.paused){var e=new XMLHttpRequest;G.DEBUG_SPARK_LOCAL?e.open("POST","http/max-fps"):e.open("POST",this.getRestRoot()+"max-fps"),e.send(t.toString())}},t.prototype.requestFullFrame=function(){this.packetRequester.requestFullFrame()},t.prototype.requestAndWaitFullFrame=function(){this.packetRequester.requestFullFrame(),this.packetManager.waitFullFrame()},t.MIN_REQUEST_INTERVAL=500,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_REQUEST_COUNT=2,t}(),B=function(){function t(e){var r=this;this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDebugContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDebugContainer.parentElement,this.controlPanel=document.getElementById("control-panel"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDebugTools=document.getElementById("control-panel-button-dev-panel"),this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpInfoState=document.getElementById("control-panel-info-state"),t.assignActionOnClick(this.cpButtonRun,function(){return r.client.network.postUserCommand("run","")}),t.assignActionOnClick(this.cpButtonPause,function(){return r.client.network.postUserCommand("pause","")}),t.assignActionOnClick(this.cpButtonX1,function(){return r.setSpeed(1)}),t.assignActionOnClick(this.cpButtonSlower,function(){return r.speedUpOrDown(!1)}),t.assignActionOnClick(this.cpButtonFaster,function(){return r.speedUpOrDown(!0)}),t.assignActionOnClick(this.cpButtonVirtual,function(){return r.setSpeed(1/0)}),this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},t.assignActionOnClick(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),E.addFullScreenListener(function(){return r.onFullScreenChange()}),this.cpButtonDebugTools.style.display="none"}return t.prototype.updateExperimentState=function(){this.updateInfoState(),this.updateModelTimeScale(),this.updateRunGroup(),this.updateSpeedGroup()},t.prototype.updateModelTimeScale=function(){this.cpInfoScale.innerText=t.timeScaleToString(this.client.getModelTimeScale())},t.prototype.updateExperimentProgress=function(){var t=this.client.getModelProgress(),e=this.progressBar.firstElementChild,r=100*t;this.progressBar.style.width=t<=0?"0":r+"%",e.innerText=t<0?"progress n/a":Math.round(r)+"%"},t.prototype.updateInfoState=function(){var e=this.client.getModelState(),r=t.modelStateToString(e);this.cpInfoState.innerText=t.modelStateToString(r),this.indicateCpErrorState("ERROR"==e)},t.prototype.indicateCpErrorState=function(t){t?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getModelState()&&this.indicateCpErrorState(!1)},t.prototype.updateRunGroup=function(){var e=this.client.getModelState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e;t.setVisible(this.cpButtonRun,!r),this.setEnabled(this.cpButtonRun,!r&&i),t.setVisible(this.cpButtonPause,r),this.setEnabled(this.cpButtonPause,r)},t.prototype.updateSpeedGroup=function(){var e=this.client.getModelState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e,i=t.stringToTimeScale(this.cpInfoScale.innerText);this.setEnabled(this.cpButtonX1,r&&1!=i),this.setEnabled(this.cpButtonSlower,r&&i>t.speeds[0]),this.setEnabled(this.cpButtonFaster,r&&i!=1/0),this.setEnabled(this.cpButtonVirtual,r&&i!=1/0)},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=p.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r)},t.prototype.setSpeed=function(e){this.cpInfoScale.innerText=t.timeScaleToString(e),this.client.network.postUserCommand("setspeed",e.toString()),this.updateSpeedGroup()},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=E.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed"))},t.prototype.toggleFullScreen=function(){E.toggleFullScreen(this.presentationContainer)},t.modelStateToString=function(t){switch(t){case"INITIALIZE":return"Initializing...";case"IDLE":return"Idle";case"RUNNING":return"Running";case"PAUSED":return"Paused";case"FINISHED":return"Finished.";case"ERROR":return"Error!";case"PLEASE_WAIT":return"Please Wait..."}return t},t.timeScaleToString=function(t){return t<0||t==1/0?"Virtual":t>=1?"x"+t:"x1/"+1/t},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.setVisible=function(t,e){e?t.style.removeProperty("display"):t.style.display="none"},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.assignActionOnClick=function(e,r){e.onclick=function(){t.isEnabled(e)&&r()}},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t}(),G=function(){function t(){this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new P(this),this.navigation=new w(this),this.network=new N(this),this.controlPanel=new B(this)}return t.prototype.start=function(t){this.svgAnimationInfo=t,this.svg.style.pointerEvents="auto",this.navigation.initSVGNavigation(),this.network.start(),this.frameDrawing.start(),this.navigation.updateSVGSize()},t.prototype.stop=function(t){t?(this.modelState=t.type,this.controlPanel.updateExperimentState()):this.modelState=void 0,this.frameDrawing.stop(),this.navigation.clearSVGNavigation(),this.network.stop(),n.removeAllChildren(this.presentation)},t.prototype.setCallback=function(t,e){},t.prototype.pause=function(){this.network.pause()},t.prototype.stopAndAlert=function(t,e){this.frameDrawing.stop(),console.log(t),e&&console.log(e)},t.prototype.updateExperimentState=function(t){t.state!=this.modelState&&(this.modelState=t.state,this.controlPanel.updateExperimentState()),t.progress!=this.modelProgress&&(this.modelProgress=t.progress,this.controlPanel.updateExperimentProgress()),t.time!=this.modelTime&&(this.modelTime=t.time),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.controlPanel.updateModelTimeScale())},t.prototype.getModelTime=function(){},t.prototype.getModelState=function(){},t.prototype.getModelTimeScale=function(){},t.prototype.getModelProgress=function(){},t.DEBUG_MODE=!1,t.DEBUG_SPARK_LOCAL=!1,t}(),U=function(){function t(){}return t.createClient=function(){return new G},t.createDebugger=function(){return new i(new G)},t}(),z=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(e){var r=this;mt.DEBUG_MODE=!0,mt.DEBUG_SPARK_LOCAL=e,this.client.debugger=this,this.serverQueueInfo=document.getElementById("dev-panel-info-server-queue"),this.browserQueueInfo=document.getElementById("dev-panel-info-browser-queue"),this.parseTimeInfo=document.getElementById("dev-panel-info-parse-time"),this.shapeCountInfo=document.getElementById("dev-panel-info-shape-count"),this.cudCountInfo=document.getElementById("dev-panel-info-cud-count"),this.drawTimeInfo=document.getElementById("dev-panel-info-draw-time"),this.fpsInfo=document.getElementById("dev-panel-info-fps"),this.timeInfo=document.getElementById("dev-panel-info-time"),e&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return r.onNewModelSelected()}),t.elementcount=0},t.prototype.stop=function(){this.serverQueueInfo=void 0,this.browserQueueInfo=void 0,this.parseTimeInfo=void 0,this.shapeCountInfo=void 0,this.cudCountInfo=void 0,this.drawTimeInfo=void 0,this.fpsInfo=void 0,this.timeInfo=void 0,this.modelSelector&&(this.modelSelector.onchange=void 0,this.modelSelector=void 0),t.elementcount=0},t.prototype.onNewModelSelected=function(){var e=this;if(null!=this.client.svg&&this.client.stop("TERMINATED"),this.shapeCountInfo.innerHTML=t.elementcount,"NO MODEL SELECTED"!=this.modelSelector.value){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200===r.status&&e.client.start({})},r.open("GET","/http/start?path="+this.modelSelector.value,!0),r.send()}},t}(),W=function(){function t(){}return t.createSvgElement=function(e){return mt.DEBUG_MODE&&z.elementcount++,document.createElementNS(t.svgns,e)},t.createXhtmlElement=function(e){return mt.DEBUG_MODE&&z.elementcount++,document.createElementNS(t.xhtmlns,e)},t.createTextNode=function(t){return mt.DEBUG_MODE&&z.elementcount++,document.createTextNode(t)},t.createUseElement=function(e){var r=t.createSvgElement("use"),i="#"+e;return r.setAttributeNS(t.xlinkns,"href",i),r},t.cloneElementWithId=function(e){var r=document.getElementById(e);return t.cloneElement(r)},t.cloneElement=function(e){var r=e.cloneNode(!0);return r.removeAttribute("id"),mt.DEBUG_MODE&&(z.elementcount+=1+t.childNodeDeepCount(r)),r},t.removeElement=function(e,r){var i=document.getElementById("canvas-group");if(i)for(var n=i.children,a=n.length-1;a>=0;a--){var o=parseInt(n[a].id),s=document.getElementById(o.toString());(r==s||r.contains(s))&&i.removeChild(n[a])}mt.DEBUG_MODE&&(z.elementcount-=1+t.childNodeDeepCount(r)),e.removeChild(r)},t.removeAllChildren=function(e){for(;e.lastChild;)t.removeElement(e,e.lastChild)},t.bringElementToFront=function(t){t.parentNode.appendChild(t)},t.childElements=function(t){var e=t.children;if(!e){for(var r=t.childNodes,i=[],n=0;n<r.length;n++){var a=r[n];1==a.nodeType&&i.push(a)}return i}return e},t.isPrimitiveSVGElement=function(t){return!(t.startsWith("Shape")||t.startsWith("Markup")||t.startsWith("Control")||t.startsWith("Chart")||t.startsWith("Window3D"))},t.isContainedInElementOfType=function(t,e){for(;t&&1==t.nodeType&&e.indexOf(t.getAttribute("type"))<0;)t=t.parentNode;return t&&1==t.nodeType},t.findChildOfType=function(e,r){for(var i=t.childElements(e),n=0;n<i.length;n++)if(i[n].getAttribute("type")==r)return i[n];return console.log("Child of type "+r+" not found in",e),null},t.findParentOfType=function(t,e){for(var r=t.parentNode;;){if(!r||1!=r.nodeType)return null;var i=r;if(i.getAttribute("type")==e)return i;r=i.parentNode}},t.childNodeDeepCount=function(e){var r=e.childNodes;if(!r)return 0;for(var i=r.length,n=0;n<r.length;n++)i+=t.childNodeDeepCount(r[n]);return i},t.createCanvas=function(){var e=t.createXhtmlElement("canvas");return document.getElementById("canvas-group").appendChild(e),e},t.xhtmlns="http://www.w3.org/1999/xhtml",t.xlinkns="http://www.w3.org/1999/xlink",t.svgns="http://www.w3.org/2000/svg",t}(),H=function(){function t(){}return t.offsetPage=function(t){var e=t.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+i,left:e.left+r}},t.indexInParent=function(t){var e;for(e=0;t=t.previousElementSibling;e++);return e},t.radiansToDegrees=function(t){return 360*t/(2*Math.PI)},t.modulo=function(t,e){var r=t%e;return Math.floor(r>=0?r:r+e)},t.remainderPositive=function(t,e){var r=t%e;return r>=0?r:r+e},t.formatNumber=function(t,e){if(t==-1/0)return"-Infinity";if(t==1/0)return"+Infinity";if(isNaN(t))return"NaN";var r=Math.abs(t);return r<1e-12?String(0):r>9999999999||r<.001&&0!=t?String(+t.toExponential(2)):String(+t.toFixed(2))},t.formatPercent=function(t){return+Math.round(100*t)+"%"},t.reducePrecision=function(t){return+t.toPrecision(4)},t.dateComponent=function(t,e){var r,i=t.getFullYear();switch(e){case"YYYY":return String(i);case"MMM":switch(t.getMonth()+1){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec";default:return null}case"MM":r=t.getMonth()+1;break;case"DD":r=t.getDate();break;case"HH":r=t.getHours();break;case"mm":r=t.getMinutes();break;case"ss":r=t.getSeconds()}return r<10?"0"+r:String(r)},t.formatDate=function(e,r){switch(r){case"YYYY":return t.dateComponent(e,"YYYY");case"MMMYYYY":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"YYYY");case"DDMMM":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"DD");case"DDMMHH":return t.dateComponent(e,"MM")+"/"+t.dateComponent(e,"DD")+" "+t.dateComponent(e,"HH")+":00";case"HHmm":return t.dateComponent(e,"HH")+":"+t.dateComponent(e,"mm");case"mmss":default:return t.dateComponent(e,"mm")+"'"+t.dateComponent(e,"ss")+"''"}},t.toMilliseconds=function(e,r){switch(e.modelSettings.timeUnit){case"MILLISECOND":return r*t.MILLISECOND;case"SECOND":return r*t.SECOND;case"MINUTE":return r*t.MINUTE;case"HOUR":return r*t.HOUR;case"DAY":return r*t.DAY;case"WEEK":return r*t.WEEK;case"MONTH":return r*t.MONTH;case"YEAR":return r*t.YEAR}},t.toDate=function(e,r){var i=e.modelSettings,n=r-i.startTime;return new Date(i.startDate+t.toMilliseconds(e,n))},t.date=function(e){return t.toDate(e,e.time)},t.setMultipleAttributes=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i].toString())},t.getSubAttribute=function(t,e){for(var r=0;r<t.length;r++){var i=t[r].split(":");if(2==i.length&&i[0]==e)return i[1]}return null},t.getIntAttribute=function(t,e){return parseInt(t.getAttribute(e))},t.getFloatAttribute=function(t,e){return parseFloat(t.getAttribute(e))},t.splitSkipEmpty=function(e,r){return e.split(r).filter(t.isEmpty)},t.isEmpty=function(t){return t.length>0},t.splitToFloats=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseFloat(i[n]);return i},t.splitToInts=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseInt(i[n]);return i},t.hyphenToCameLCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.parseTranslateTransform=function(e){var r=t.translateRegExp2.exec(e);return null!=r?[parseFloat(r[1]),parseFloat(r[2])]:(r=t.translateRegExp1.exec(e),[parseFloat(r[1]),0])},t.increaseTransparency=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=i[4]?i[4]:1;return"rgba("+i[1]+","+i[2]+","+i[3]+","+r*n+")"},t.addPathArrows=function(e,r,i,n,a,o){for(var s=e.getTotalLength(),l=a;l<s;l+=o){var u=e.getPointAtLength(l),c=e.getPointAtLength(l-3),h=t.radiansToDegrees(Math.PI/2-Math.atan2(u.x-c.x,u.y-c.y)),d=W.createUseElement(r);d.setAttribute("stroke-width",i.toString()),d.setAttribute("transform","translate("+u.x+" "+u.y+") rotate( "+h+")"),n.appendChild(d)}},t.sectorData=function(t,e,r,i,n,a){var o=Math.abs(a)>2*Math.PI?a%(2*Math.PI):a;a==2*Math.PI&&(a-=1e-4);var s=n+a,l=t+r*Math.cos(n),u=e+i*Math.sin(n),c=t+r*Math.cos(s),h=e+i*Math.sin(s);return"M "+t+" "+e+" L "+l+" "+u+" A "+r+" "+i+" 0 "+(Math.abs(o)>Math.PI?"1 ":"0 ")+(o>0?"1 ":"0 ")+c+" "+h+" Z"},t.roundPathCorners=function(t,e,r){function i(t,e,r){var i=e.x-t.x,a=e.y-t.y,o=Math.sqrt(i*i+a*a);return n(t,e,Math.min(1,r/o))}function n(t,e,r){return{x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}}function a(t,e){t.length>2&&(t[t.length-2]=e.x,t[t.length-1]=e.y)}function o(t){return{x:parseFloat(t[t.length-2]),y:parseFloat(t[t.length-1])}}var s=t.split(/[,\s]/).reduce(function(t,e){var r=e.match("([a-zA-Z])(.+)");return r?(t.push(r[1]),t.push(r[2])):t.push(e),t},[]).reduce(function(t,e){return parseFloat(e)==e&&t.length?t[t.length-1].push(e):t.push([e]),t},[]),l=[];if(s.length>1){var u=o(s[0]),c=null;"Z"==s[s.length-1][0]&&s[0].length>2&&(c=["L",u.x,u.y],s[s.length-1]=c),l.push(s[0]);for(var h=1;h<s.length;h++){var d=l[l.length-1],p=s[h],f=p==c?s[1]:s[h+1];if(f&&d&&d.length>2&&"L"==p[0]&&f.length>2&&"L"==f[0]){var m,g,v=o(d),b=o(p),y=o(f);r?(m=n(b,d.origPoint||v,e),g=n(b,f.origPoint||y,e)):(m=i(b,v,e),g=i(b,y,e)),a(p,m),p.origPoint=b,l.push(p);var A=n(m,b,.5),T=n(b,g,.5),C=["C",A.x,A.y,T.x,T.y,g.x,g.y];C.origPoint=b,l.push(C)}else l.push(p)}if(c){var S=o(l[l.length-1]);l.push(["Z"]),a(l[0],S)}}else l=s;return l.reduce(function(t,e){return t+e.join(" ")+" "},"")},t.stringToByteArray=function(t){for(var e=[],r=0,i=0;i<t.length;i++){for(var n=t.charCodeAt(i);n>255;)e[r++]=255&n,n>>=8;e[r++]=n}return e},t.byteArrayToString=function(t){if(t.length<=8192)return String.fromCharCode.apply(null,t);for(var e="",r=0;r<t.length;r+=8192){var i=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,i)}return e},t.translateRegExp1=/^translate\s*\(\s*(-?\d*.?\d*)\s*\)\s*$/i,t.translateRegExp2=/^translate\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)\s*$/i,t.rgbRegExp=/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,t.rgbaRegExp=/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*.?\d*)\s*\)\s*$/i,t.MILLISECOND=1,t.SECOND=1e3*t.MILLISECOND,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR,t.WEEK=7*t.DAY,t.MONTH=30*t.DAY,t.YEAR=365*t.DAY,t}(),V=function(){function t(t){this.frameDrawing=t}return t.createShapeArc=function(){return W.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createShapeText=function(){return W.createSvgElement("text")},t.updateShapeText=function(t,e,r){for(var i=0;i<e.length;i++)if("text-content"==e[i]){null==r[i]&&(r[i]="");var n=r[i].split("\n"),a=t.childElementCount;if(1==n.length&&1==a)t.firstChild.firstChild.textContent=n[0];else{for(var o=H.getFloatAttribute(t,"first-line-offset"),s=H.getFloatAttribute(t,"line-height"),l=0;l<n.length;l++){var u=W.childElements(t),c=n[l];if(c.endsWith("\r")&&(c=c.substring(0,c.length-1)),u[l])u[l].firstChild.textContent=c;else{var h=W.createSvgElement("tspan");h.setAttribute("x","0"),h.setAttribute("y",(o+l*s).toString());var d=W.createTextNode(c);h.appendChild(d),t.appendChild(h)}}for(;t.childElementCount>n.length;)W.removeElement(t,t.lastChild)}}else t.setAttribute(e[i],r[i])},t.createShapeImage=function(){return W.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":W.removeAllChildren(t);break;case"add":var n=W.createSvgElement("image");n.setAttributeNS(W.xlinkns,"href",this.frameDrawing.client.network.getJarResourceURL(r[i])),n.setAttribute("visibility","hidden"),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.appendChild(n);break;case"set":for(var a=parseInt(r[i]),o=t.childNodes,s=0;s<o.length;s++)(n=o[s]).setAttribute("visibility",s==a?"inherit":"hidden");break;case"width":case"height":o=t.childNodes;for(s=0;s<o.length;s++)(n=o[s]).setAttribute(e[i],r[i]);default:t.setAttribute(e[i],r[i])}},t.createShapeCanvas=function(t){var e=W.createSvgElement("image");return W.createCanvas().id=t+"canvas",e},t.updateShapeCanvas=function(t,e,r){for(var i=t,n=document.getElementById(t.id+"canvas"),a=n.getContext("2d"),o=0;o<e.length;o++)switch(e[o]){case"width":case"height":i.setAttribute(e[o],r[o]),n.setAttribute(e[o],r[o]);break;case"fill-rect":case"clear-rect":var s=H.splitToFloats(r[o]," "),l=s[0],u=s[1],c=s[2],h=s[3];if("clear-rect"==e[o])a.clearRect(l,u,c,h);else{var d=s[4];a.fillStyle=d,a.fillRect(l,u,c,h)}break;case"fill-circle":s=r[o].split(" ");var p=parseFloat(s[0]),f=parseFloat(s[1]),m=parseFloat(s[2]),g=s[3];a.fillStyle=g,a.beginPath(),a.arc(p,f,m,0,2*Math.PI),a.fill();break;case"clear":a.clearRect(0,0,n.width,n.height);break;case"update":i.setAttributeNS(W.xlinkns,"href",n.toDataURL("image/x-xbitmap"));break;default:t.setAttribute(e[o],r[o])}},t.createUnsupportedObject=function(t){var e=W.cloneElementWithId("unsupported-object");return W.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=W.findChildOfType(t,"background"),n=W.findChildOfType(t,"text"),a=0;a<e.length;a++)switch(e[a]){case"width":var o=parseFloat(r[a]);i.setAttribute("width",o.toString());var s=n.getBBox();o<s.width&&(n.firstChild.textContent="Not supported",s=n.getBBox()),o<s.width&&(n.firstChild.textContent="N/A",s=n.getBBox()),o<s.width&&(n.firstChild.textContent=""),n.setAttribute("x",(o/2).toString());break;case"height":var l=parseFloat(r[a]);i.setAttribute("height",l.toString()),n.setAttribute("y",(l/2+3).toString());break;default:t.setAttribute(e[a],r[a])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeGISMap"],t}(),Y=function(){function t(){}return t.create=function(){return V.createUnsupportedObject("Vector 3D is under development. To view 3D use Play(video)")},t.update=function(t,e,r){V.updateUnsupportedObject(t,e,r)},t}(),j=function(){function t(t,e){this.frameDrawing=t,this.control=e}return t.createControlList=function(){var e=W.cloneElementWithId("control-list"),r=function(e){return t.onControlListMouseEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("wheel",r);var i=W.findChildOfType(e,"svg"),n=W.findChildOfType(i,"scrollbargroup"),a=function(e){return t.onControlListScrollbarMouseEvent(e)};return n.addEventListener("mouseout",a),n.addEventListener("mousedown",a),n.addEventListener("mouseup",a),n.addEventListener("mousemove",a),n.addEventListener("click",a),e},t.prototype.updateControlList=function(e,r,i){for(var n=W.findChildOfType(e,"svg"),a=W.findChildOfType(e,"border"),o=W.findChildOfType(n,"background"),s=W.findChildOfType(n,"itemgroup"),l=(W.findChildOfType(n,"scrollbargroup"),0);l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);for(var u="true"==i[l],c=W.childElements(s),h=0;h<c.length;h++)t.updateControlListItemLook(c[h],!1,!1);a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"text-array":W.removeAllChildren(s),s.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var d=H.splitSkipEmpty(i[l],"\n"),p=0,f=0;for(h=0;h<d.length;h++){var m=W.cloneElementWithId("list-item");W.findChildOfType(m,"background").setAttribute("fill",o.getAttribute("fill")),(A=W.findChildOfType(m,"text")).firstChild.textContent=d[h],e.hasAttribute("text-color")&&A.setAttribute("fill",e.getAttribute("text-color")),s.appendChild(m);var g=A.getBBox();p<g.width&&(p=g.width),f<g.height&&(f=g.height)}c=W.childElements(s);var v=Math.max(p+4,H.getFloatAttribute(n,"width")),b=Math.max(20,1.35*f);e.setAttribute("item-height",b.toString());for(h=0;h<c.length;h++)this.setupControlListItem(c[h],b*h,v,b,f);t.updateControlListScrollbar(e);break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":e.setAttribute(r[l],i[l]);break;case"font-style":e.style.font=i[l];break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),n.hasAttribute("width")&&n.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[l],i[l]);break;case"value":var y=H.splitSkipEmpty(i[l],"\n");c=W.childElements(s),e.setAttribute("last-clicked","0");for(h=0;h<c.length;h++){m=c[h];var A=W.findChildOfType(m,"text"),T=y.indexOf(A.firstChild.textContent)>=0;m.setAttribute("selected",T),t.updateControlListItemLook(m,!1,!1),T&&e.setAttribute("last-clicked",h.toString())}break;default:e.setAttribute(r[l],i[l])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=W.findChildOfType(t,"svg"),i=W.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var n=i*H.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[n.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=W.findChildOfType(r,"border"),n=W.findChildOfType(r,"svg"),a=W.findChildOfType(n,"itemgroup"),o=W.findChildOfType(n,"scrollbargroup"),s=W.childElements(a);switch(e.type){case"mouseover":if("control-border-hover"!=i.getAttribute("class")){i.setAttribute("class","control-border-hover"),o.setAttribute("class","control-opaque1");for(var l=0;l<s.length;l++)t.updateControlListItemLook(s[l],!0,!1)}break;case"mouseout":if(r.contains(e.relatedTarget))return;i.setAttribute("class","control-border"),o.setAttribute("class","control-opaque0");for(l=0;l<s.length;l++)t.updateControlListItemLook(s[l],!1,!1);break;case"wheel":e.altKey||e.ctrlKey||(e.stopPropagation(),e.preventDefault(),t.scrollControlList(r,e.deltaY<0?1:-1))}}},t.scrollControlList=function(t,e){var r=W.findChildOfType(t,"svg"),i=W.findChildOfType(r,"itemgroup"),n=i.childElementCount;if(0!=n){var a=H.getFloatAttribute(r,"height"),o=H.getFloatAttribute(t,"item-height"),s=n*o,l=i.getAttribute("transform"),u=H.parseTranslateTransform(l)[1];u+=e*o,u=Math.max(-s+a,u),u=Math.min(u,0),u=Math.round(u),i.setAttribute("transform","translate(0,"+u+")");var c=W.findChildOfType(r,"scrollbargroup"),h=W.findChildOfType(c,"handle"),d=H.getFloatAttribute(h,"height"),p=(a/2-u)/s,f=Math.max(2,a*p-d/2);f=Math.min(a-d-2,f),h.setAttribute("y",f.toString())}},t.prototype.setupControlListItem=function(t,e,r,i,n){var a=this,o=W.findChildOfType(t,"background"),s=W.findChildOfType(t,"text");t.setAttribute("transform","translate(0,"+e+")"),H.setMultipleAttributes(o,["width","height"],[r,i]),H.setMultipleAttributes(s,["x","y"],[2,i/2+.3*n]);var l=function(t){return a.onControlListItemMouseEvent(t)};t.addEventListener("mouseover",l),t.addEventListener("mouseout",l),t.addEventListener("click",l)},t.prototype.onControlListItemMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode,n=i.parentNode.parentNode;if("false"!=n.getAttribute("enabled"))switch(e.type){case"mouseover":t.updateControlListItemLook(r,!0,!0);break;case"mouseout":t.updateControlListItemLook(r,!0,!1);break;case"click":e.stopPropagation(),e.preventDefault();var a="true"==n.getAttribute("multiple"),o=W.childElements(i),s=H.indexInParent(r),l="true"==r.getAttribute("selected");if(a)if(e.ctrlKey)r.setAttribute("selected",String(!l)),t.updateControlListItemLook(r,!0,!0);else if(e.shiftKey){var u=H.getIntAttribute(n,"last-clicked");for(c=0;c<o.length;c++)l=u<=s?u<=c&&c<=s:s<=c&&c<=u,o[c].setAttribute("selected",l),t.updateControlListItemLook(o[c],!0,c==s)}else for(c=0;c<o.length;c++)o[c].setAttribute("selected",c==s),t.updateControlListItemLook(o[c],!0,c==s);else{l=!e.ctrlKey||!l;for(var c=0;c<o.length;c++)o[c].setAttribute("selected",c==s&&l),t.updateControlListItemLook(o[c],!0,c==s)}n.setAttribute("last-clicked",s.toString());var h="";for(c=0;c<o.length;c++){if("true"==o[c].getAttribute("selected"))h+=W.findChildOfType(o[c],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(n,h)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,n=W.findChildOfType(t,"background"),a=W.findChildOfType(t,"text"),o="true"==i.getAttribute("enabled"),s="true"==t.getAttribute("selected");if(!o)return n.setAttribute("class",s?"control-background-selected-disabled":""),void a.setAttribute("class","control-text-disabled");e?(r?n.setAttribute("class",s?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):n.setAttribute("class",s?"control-list-background-selected-hover":""),a.setAttribute("class",s?"control-text-selected-hover":"")):(n.setAttribute("class",s?"control-list-background-selected":""),a.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=W.findChildOfType(e,"svg"),i=W.findChildOfType(r,"scrollbargroup"),n=W.findChildOfType(i,"scrollbar"),a=W.findChildOfType(i,"handle"),o=H.getFloatAttribute(r,"width"),s=H.getFloatAttribute(r,"height"),l=o-H.getFloatAttribute(n,"width");n.setAttribute("x",l.toString()),n.setAttribute("height",s.toString()),a.setAttribute("x",(l+2).toString()),a.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=W.findChildOfType(t,"svg"),i=W.findChildOfType(r,"scrollbargroup"),n=(W.findChildOfType(i,"scrollbar"),W.findChildOfType(i,"handle")),a=H.getFloatAttribute(r,"height"),o=W.findChildOfType(r,"itemgroup").childElementCount,s=0;e=o>0&&a<(s=o*H.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e&&n.setAttribute("height",Math.max(a*(a/s)-4,7).toString())},t.onControlListScrollbarMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode.parentNode;if("false"!=i.getAttribute("enabled")){var n=W.findChildOfType(r,"scrollbar"),a=H.getFloatAttribute(n,"height"),o=n.getBoundingClientRect().height/a,s=H.offsetPage(n),l=(e.pageY-s.top)/o,u=W.findChildOfType(r,"handle"),c=H.getFloatAttribute(u,"y");switch(e.type){case"mouseout":case"mouseup":t.controlListScrollbarButtonDown=0;break;case"mousedown":1==e.which&&e.target==u&&(e.stopPropagation(),t.controlListScrollbarButtonDown=1,t.controlListScrollbarMousePos=l);break;case"mousemove":if(1==t.controlListScrollbarButtonDown){e.stopPropagation();var h=l-t.controlListScrollbarMousePos,d=W.findChildOfType(i,"svg"),p=W.findChildOfType(d,"itemgroup").childElementCount,f=H.getFloatAttribute(i,"item-height"),m=h*(p*f/a)/f;t.scrollControlList(i,-m),t.controlListScrollbarMousePos=l}break;case"click":if(e.stopPropagation(),e.preventDefault(),e.target==n){m=Math.floor(a/H.getFloatAttribute(i,"item-height"));t.scrollControlList(i,l<c?m:-m)}}}},t.controlListScrollbarButtonDown=0,t}(),X=function(){function t(t){this.frameDrawing=t,this.controlList=new j(t,this)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return V.createUnsupportedObject("File chooser is not supported in the Cloud mode");case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":t.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":V.updateUnsupportedObject(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=W.cloneElementWithId("control-button");return new f(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var n=W.findChildOfType(e,"background"),a=W.findChildOfType(e,"text"),o=0;o<r.length;o++)switch(r[o]){case"enabled":e.setAttribute(r[o],i[o]);var s="true"==i[o];n.setAttribute("class",s?"control-background":"control-background-disabled"),a.setAttribute("class",s?"control-button-text":"control-text-disabled");break;case"text":a.firstChild.textContent=i[o];break;case"background-color":break;case"text-color":a.setAttribute("fill",i[o]);break;case"font-style":a.style.font=i[o],t.centerControlText(a,n,!0,!0);break;case"width":case"height":var l=parseFloat(i[o])-2;n.setAttribute(r[o],l.toString()),t.centerControlText(a,n,!0,!0);break;default:e.setAttribute(r[o],i[o])}},t.onButtonOver=function(t){var e=W.findChildOfType(t,"background"),r=W.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=W.findChildOfType(t,"background"),r=W.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=W.findChildOfType(t,"background"),r=W.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.onControlAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=W.cloneElementWithId("control-checkbox");return new f(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var n=W.findChildOfType(e,"background"),a=W.findChildOfType(e,"box"),o=W.findChildOfType(e,"check"),s=W.findChildOfType(e,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-checkbox-box":"control-checkbox-box-disabled"),o.setAttribute("class",u?"control-checkbox-check":"control-checkbox-check-disabled"),s.setAttribute("class",u?"":"control-text-disabled");break;case"text":s.firstChild.textContent=i[l];break;case"background-color":n.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":s.style.font=i[l],t.centerControlText(s,n,!1,!0);break;case"width":n.setAttribute(r[l],i[l]);break;case"height":n.setAttribute(r[l],i[l]);var c=parseFloat(i[l]);a.setAttribute("y",(c/2-8).toString()),o.setAttribute("transform","translate(0,"+(c/2-8)+")"),t.centerControlText(s,n,!1,!0);break;case"value":o.setAttribute("visibility","true"==i[l]?"inherit":"hidden");break;default:e.setAttribute(r[l],i[l])}},t.onCheckboxOver=function(t){var e=W.findChildOfType(t,"box"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=W.findChildOfType(t,"box"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=W.findChildOfType(t,"box"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=W.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.onControlAction(t.id,r)},t.prototype.createSlider=function(){var t=this,e=W.cloneElementWithId("control-slider"),r=function(e){return t.onSliderEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r),e},t.updateSlider=function(e,r,i){for(var n=W.findChildOfType(e,"sensor"),a=W.findChildOfType(e,"background"),o=W.findChildOfType(e,"line"),s=W.findChildOfType(e,"progress"),l=W.findChildOfType(e,"handle"),u=(W.findChildOfType(e,"value"),0);u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];o.setAttribute("class",c?"control-background":"control-background-disabled"),s.setAttribute("class",c?"control-slider-progress":"control-background-selected-disabled"),l.setAttribute("class",c?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":a.setAttribute("fill",i[u]);break;case"width":case"height":a.setAttribute(r[u],i[u]);break;case"vertical":e.setAttribute(r[u],i[u]);var h=H.getFloatAttribute(a,"width"),d=H.getFloatAttribute(a,"height");H.setMultipleAttributes(n,["x","y","width","height"],[String(-1e3),String(-1e3),String(h+2e3),String(d+2e3)]);var p=void 0,f=void 0,m=void 0,g=void 0,v=void 0,b=void 0,y=void 0,A=void 0,T=void 0,C=void 0;"false"==i[u]?(v=p=0,b=f=d/2-2,m=h,y=0,A=g=4,T=0,C=d/2):(v=p=h/2-2,f=0,b=d,y=m=4,g=d,A=0,T=h/2,C=d),H.setMultipleAttributes(o,["x","y","width","height"],[p,f,m,g]),H.setMultipleAttributes(s,["x","y","width","height"],[v,b,y,A]),H.setMultipleAttributes(l,["cx","cy"],[T,C]);break;case"value":var S=H.getFloatAttribute(e,"min"),E=H.getFloatAttribute(e,"max");h=H.getFloatAttribute(a,"width"),d=H.getFloatAttribute(a,"height");var w="true"==e.getAttribute("vertical")?d:h,k=(parseFloat(i[u])-S)/(E-S)*w;t.setSliderHandlePosition(e,k);break;default:e.setAttribute(r[u],i[u])}},t.prototype.onSliderEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=W.findChildOfType(r,"background"),n=W.findChildOfType(r,"progress"),a=H.getFloatAttribute(i,"width"),o=H.getFloatAttribute(i,"height"),s=i.getBoundingClientRect(),l=s.width/a,u=s.height/o,c=H.offsetPage(i),h="true"==r.getAttribute("vertical");if(e.type.startsWith("mouse")||"wheel"==e.type){var d=e,p=(d.pageX-c.left)/l,f=(d.pageY-c.top)/u,m=h?o-f:p;switch(e.type){case"mouseover":e.stopPropagation(),t.onSliderOver(r);break;case"mouseout":if(r.contains(d.relatedTarget))return;1==t.sliderButtonDown&&(t.setSliderHandlePosition(r,m),this.confirmSliderValue(r)),t.sliderButtonDown=0,t.onSliderOut(r);break;case"mousedown":t.sliderButtonDown=d.which,1==t.sliderButtonDown&&(e.stopPropagation(),t.onSliderHandleGrabbed(r,m));break;case"mousemove":1==t.sliderButtonDown&&(e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m));break;case"mouseup":1==t.sliderButtonDown&&(e.stopPropagation(),this.onSliderHandleReleased(r)),t.sliderButtonDown=0;break;case"wheel":if(!d.altKey&&!d.ctrlKey){var g=e;e.stopPropagation(),e.preventDefault();var v=H.getFloatAttribute(n,h?"height":"width");t.setSliderHandlePosition(r,v+(g.deltaY<0?1:-1)),this.confirmSliderValue(r)}}}else if(e.type.startsWith("touch")){var b=e;if(b.touches.length>1)return void this.onSliderHandleReleased(r);var y="touchend"==e.type?b.changedTouches[0]:b.touches[0];p=void 0,f=void 0;p=(y.pageX-c.left)/l,f=(y.pageY-c.top)/u;m=h?o-f:p;switch(e.type){case"touchstart":e.stopPropagation(),t.onSliderOver(r),t.onSliderHandleGrabbed(r,m);break;case"touchmove":e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m);break;case"touchend":e.stopPropagation(),this.onSliderHandleReleased(r),t.onSliderOut(r)}}}},t.onSliderOver=function(e){var r=W.findChildOfType(e,"line"),i=W.findChildOfType(e,"progress"),n=W.findChildOfType(e,"handle"),a=W.findChildOfType(e,"value");r.setAttribute("class","control-slider-line-hover"),i.setAttribute("class","control-fill-color-transition"),n.setAttribute("class",1==t.sliderButtonDown?"control-slider-handle-pressed":"control-slider-handle-hover"),a.setAttribute("class","control-opaque1")},t.onSliderOut=function(t){var e=W.findChildOfType(t,"sensor"),r=W.findChildOfType(t,"line"),i=W.findChildOfType(t,"progress"),n=W.findChildOfType(t,"handle"),a=W.findChildOfType(t,"value");e.setAttribute("visibility","hidden"),r.setAttribute("class","control-background"),i.setAttribute("class","control-slider-progress"),n.setAttribute("r","8"),n.setAttribute("class","control-slider-handle"),a.setAttribute("class","control-opaque0")},t.onSliderHandleGrabbed=function(e,r){var i=W.findChildOfType(e,"sensor"),n=W.findChildOfType(e,"handle");W.bringElementToFront(e),n.setAttribute("r","7"),n.setAttribute("class","control-slider-handle-pressed"),i.setAttribute("visibility","inherit"),t.setSliderHandlePosition(e,r)},t.prototype.onSliderHandleReleased=function(t){var e=W.findChildOfType(t,"sensor"),r=W.findChildOfType(t,"handle");r.setAttribute("r","8"),r.setAttribute("class","control-slider-handle-hover"),e.setAttribute("visibility","hidden"),this.confirmSliderValue(t)},t.setSliderHandlePosition=function(t,e){var r=W.findChildOfType(t,"background"),i=W.findChildOfType(t,"progress"),n=W.findChildOfType(t,"handle"),a=W.findChildOfType(t,"value"),o=H.getFloatAttribute(r,"width"),s=H.getFloatAttribute(r,"height"),l="true"==t.getAttribute("vertical"),u=l?s:o;e=Math.min(u,Math.max(e,0));var c,h=H.getFloatAttribute(t,"min"),d=H.getFloatAttribute(t,"max"),p=H.getFloatAttribute(t,"step");c=p>0?h+Math.round(e/u*(d-h)/p)*p:h+e/u*(d-h),e=((c=Math.min(c,d))-h)/(d-h)*u,l?(i.setAttribute("y",(u-e).toString()),i.setAttribute("height",e.toString()),n.setAttribute("cy",(u-e).toString())):(i.setAttribute("width",e.toString()),n.setAttribute("cx",e.toString()));var f=a.firstElementChild,m=a.lastElementChild;m.firstChild.textContent=H.formatNumber(c,void 0);var g=m.getComputedTextLength()+10;f.setAttribute("width",g.toString()),f.setAttribute("x",(5-g).toString());var v=l?o/2-9:e-14,b=l?s-e-15-10:s/2-15-4;a.setAttribute("transform","translate("+v+","+b+")"),t.setAttribute("current-value",c)},t.prototype.confirmSliderValue=function(t){var e=H.getFloatAttribute(t,"current-value");e!=H.getFloatAttribute(t,"last-value")&&(this.frameDrawing.onControlAction(t.id,e),t.setAttribute("last-value",e.toString()))},t.createRadioButtonGroup=function(){return W.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"enabled":e.setAttribute(r[a],i[a]);for(var o="true"==i[a],s=W.childElements(e),l=0;l<s.length;l++){var u=s[l],c=W.findChildOfType(u,"circle"),h=W.findChildOfType(u,"check"),d=W.findChildOfType(u,"text");c.setAttribute("class",o?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),h.setAttribute("class",o?"control-radiobutton-check":"control-text-disabled"),d.setAttribute("class",o?"":"control-text-disabled")}break;case"text-array":var p=i[a].split("\n"),m=function(r){var i=W.cloneElementWithId("radio-button"),a=W.findChildOfType(i,"background");e.hasAttribute("background-color")&&a.setAttribute("fill",e.getAttribute("background-color"));var o=W.findChildOfType(i,"text");o.firstChild.textContent=p[r],e.hasAttribute("text-color")&&o.setAttribute("fill",e.getAttribute("text-color")),new f(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return n.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(l=0;l<p.length;l++)m(l);break;case"background-color":case"text-color":e.setAttribute(r[a],i[a]);break;case"font-style":e.style.font=i[a];break;case"width":case"height":e.setAttribute(r[a],i[a]);break;case"vertical":var g=H.getFloatAttribute(e,"width"),v=H.getFloatAttribute(e,"height"),b=0;s=W.childElements(e);for(l=0;l<s.length;l++){u=s[l];var y=W.findChildOfType(u,"background"),A=(d=W.findChildOfType(u,"text")).getBBox();if("true"==i[a]){var T=Math.max(25,1.5*A.height);u.setAttribute("transform","translate(0,"+T*l+")"),H.setMultipleAttributes(y,["width","height"],[g,T])}else{var C=20+A.width+10;u.setAttribute("transform","translate("+b+",0)"),H.setMultipleAttributes(y,["width","height"],[C,v]),b+=C}t.centerRadioButton(u)}break;case"value":var S=parseInt(i[a]);s=W.childElements(e);for(l=0;l<s.length;l++){u=s[l];(h=W.findChildOfType(u,"check")).setAttribute("visibility",S==l?"inherit":"hidden")}break;default:e.setAttribute(r[a],i[a])}},t.onRadioButtonOver=function(t){var e=W.findChildOfType(t,"circle"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=W.findChildOfType(t,"circle"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=W.findChildOfType(t,"circle"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=W.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=W.childElements(r),n=0;n<i.length;n++){var a=i[n];W.findChildOfType(a,"check").setAttribute("visibility",a==t?"inherit":"hidden"),a==t&&(e=n)}this.frameDrawing.onControlAction(r.id,e)}},t.centerRadioButton=function(e){var r=W.findChildOfType(e,"background"),i=W.findChildOfType(e,"circle"),n=W.findChildOfType(e,"check"),a=W.findChildOfType(e,"text"),o=H.getFloatAttribute(r,"height");i.setAttribute("cy",(o/2).toString()),n.setAttribute("cy",(o/2).toString()),t.centerControlText(a,r,!1,!0)},t.createListBox=function(){return j.createControlList()},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var t=this,e=W.cloneElementWithId("control-combobox"),r=function(e){return t.onComboBoxEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("click",r);var i=j.createControlList();return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),e.appendChild(i),e},t.prototype.updateComboBox=function(e,r,i){for(var n=W.findChildOfType(e,"svg"),a=W.findChildOfType(e,"border"),o=W.findChildOfType(e,"dropdown"),s=W.findChildOfType(n,"background"),l=W.findChildOfType(n,"text"),u=W.findChildOfType(n,"arrowback"),c=W.findChildOfType(n,"arrow"),h=0;h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var d="true"==i[h];l.setAttribute("class",d?"":"control-text-disabled"),a.setAttribute("class",d?"control-border":"control-border-disabled"),d||o.setAttribute("visibility","hidden"),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-array":var p=H.splitSkipEmpty(i[h],"\n"),f=p.length>0?p[0]:"";l.firstChild.textContent=f,this.controlList.updateControlList(o,[r[h]],[i[h]]),this.controlList.adjustControlListHeightToItems(o,5),this.controlList.updateControlList(o,["value"],[f]);break;case"background-color":s.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-color":l.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"font-style":e.style.font=i[h],t.centerControlText(l,s,!1,!0),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"width":case"height":var m=parseFloat(i[h]);if(n.setAttribute(r[h],i[h]),s.setAttribute(r[h],i[h]),a.setAttribute(r[h],i[h]),"width"==r[h])u.setAttribute("x",(m-20).toString()),this.controlList.updateControlList(o,[r[h]],[i[h]]);else{t.centerControlText(l,s,!1,!0),u.setAttribute("height",m.toString()),o.setAttribute("transform","translate(0,"+i[h]+")");var g=5*parseFloat(i[h]);this.controlList.updateControlList(o,["height"],[g.toString()])}if(n.hasAttribute("width")&&n.hasAttribute("height")){var v=H.getFloatAttribute(n,"width")-10,b=H.getFloatAttribute(n,"height")/2;c.setAttribute("transform","translate("+v+","+b+")")}break;case"editable":e.setAttribute(r[h],i[h]);break;case"value":l.firstChild.textContent=i[h],this.controlList.updateControlList(o,[r[h]],[i[h]]);break;default:e.setAttribute(r[h],i[h])}},t.prototype.onComboBoxEvent=function(t){var e=t.currentTarget;if("false"!=e.getAttribute("enabled")){var r=W.findChildOfType(e,"svg"),i=W.findChildOfType(e,"border"),n=W.findChildOfType(e,"dropdown"),a=W.findChildOfType(r,"background"),o=W.findChildOfType(r,"text"),s=W.findChildOfType(r,"arrowback"),l=W.findChildOfType(r,"arrow"),u="true"==e.getAttribute("editable");switch(t.type){case"mouseover":i.setAttribute("class","control-border-hover"),s.setAttribute("class","control-combobox-arrow-background-hover"),l.setAttribute("class","control-fill-color-transition");break;case"mouseout":if(e.contains(t.relatedTarget))return;i.setAttribute("class","control-border"),s.setAttribute("class","control-fill-transparent-transition"),l.setAttribute("class","control-fill-transparent-transition"),n.setAttribute("visibility","hidden");break;case"mousedown":1!=t.which||!u||t.target!=a&&t.target!=o||(t.stopPropagation(),this.displayTextInputForSVG(e,"left"));break;case"click":if(!u||t.target==s||t.target==l){t.stopPropagation(),t.preventDefault(),W.bringElementToFront(e);var c="inherit"==n.getAttribute("visibility");n.setAttribute("visibility",c?"hidden":"inherit")}}}},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=W.findChildOfType(t,"svg"),i=W.findChildOfType(t,"dropdown"),n=W.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var a=e.split("\n")[0];n.firstChild.textContent=a,this.frameDrawing.onControlAction(t.id,a)},t.prototype.createTextField=function(){var e=this,r=W.cloneElementWithId("control-textfield");return new f(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r)},function(t){return e.onTextFieldDown(r)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var n=W.findChildOfType(e,"svg"),a=W.findChildOfType(e,"border"),o=W.findChildOfType(n,"background"),s=W.findChildOfType(n,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];s.setAttribute("class",u?"":"control-text-disabled"),a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":e.style.font=i[l],t.centerControlText(s,o,!1,!0);break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),"width"==r[l]&&s.setAttribute("x",(parseFloat(i[l])-2).toString()),t.centerControlText(s,o,!1,!0);break;case"value":s.firstChild.textContent=i[l];break;default:e.setAttribute(r[l],i[l])}},t.onTextFieldOver=function(t){W.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){W.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t){this.displayTextInputForSVG(t,"right")},t.createProgressBar=function(){return W.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var n=e.firstElementChild,a=W.findChildOfType(n,"background"),o=W.findChildOfType(n,"progress"),s=W.findChildOfType(n,"text"),l=W.findChildOfType(n,"border"),u=0;u<r.length;u++)switch(r[u]){case"background-color":a.setAttribute("fill",i[u]);break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":e.style.font=i[u],t.centerControlText(s,a,!1,!0);break;case"width":case"height":e.setAttribute(r[u],i[u]);break;case"vertical":var c="true"==i[u],h=e.getAttribute(c?"height":"width"),d=e.getAttribute(c?"width":"height");a.setAttribute("width",h),a.setAttribute("height",d),o.setAttribute("height",d),t.centerControlText(s,a,!0,!0),l.setAttribute("width",h),l.setAttribute("height",d),c&&n.setAttribute("transform","translate(0,"+h+") rotate(-90)");break;case"text":s.firstChild.textContent="null"==i[u]?"":i[u];break;case"value":var p=H.getFloatAttribute(a,"width");"null"==i[u]?(o.setAttribute("class","control-progressbar-indeterminate"),o.setAttribute("width",p.toString())):(o.setAttribute("class","control-slider-progress"),o.setAttribute("width",(parseFloat(i[u])*p).toString()));break;default:e.setAttribute(r[u],i[u])}},t.prototype.displayTextInputForSVG=function(t,e){var r=this,i=W.findChildOfType(t,"svg"),n=W.findChildOfType(i,"text"),a=document.getElementById("text-input-for-svg-container");a.style.display="block";var o=i.getBoundingClientRect(),s=H.getFloatAttribute(i,"width"),l=H.getFloatAttribute(i,"height"),u=o.width/s,c=a.firstElementChild;c.style.left=o.left+"px",c.style.top=o.top+"px",c.style.width=s+"px",c.style.height=l+"px",c.style.transform="scale("+u+")",c.style.font=t.style.font,c.style.textAlign=e,c.value=n.firstChild.textContent,a.setAttribute("control-id",t.id);var h=function(t){return r.onTextInputForSVGEvent(t)};a.onmousedown=h,a.onwheel=h,a.onkeypress=h,a.ontouchstart=h,window.setTimeout(function(){c.focus(),c.select()},0)},t.prototype.onTextInputForSVGEvent=function(t){var e=t.currentTarget,r=e.firstElementChild,i=e.getAttribute("control-id"),n=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=r&&(n=!0);break;case"wheel":n=!0;break;case"keypress":"Enter"==t.code&&(n=!0)}n&&(e.style.display="none",this.onTextInputForSVGChanged(i,r.value))},t.prototype.onTextInputForSVGChanged=function(t,e){var r=document.getElementById(t),i=W.findChildOfType(r,"svg");if(W.findChildOfType(i,"text").firstChild.textContent=e,this.frameDrawing.onControlAction(t,e),"ControlComboBox"==r.getAttribute("type")){var n=W.findChildOfType(r,"dropdown");this.controlList.updateControlList(n,["value"],[e])}},t.centerControlText=function(t,e,r,i){var n=H.getFloatAttribute(e,"width"),a=H.getFloatAttribute(e,"height"),o=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&a&&t.setAttribute("y",(1+a/2+.3*o.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.onControlAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t.sliderButtonDown=0,t}(),q=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){for(var e=W.findChildOfType(t,"picture"),r=W.findChildOfType(t,"pictureback"),i=W.childElements(W.findChildOfType(t,"legend")),n=i.length,a="true"==t.getAttribute("show-pdf"),o="true"==t.getAttribute("show-cdf"),s="true"==t.getAttribute("show-mean"),l=(H.getFloatAttribute(r,"x"),H.getFloatAttribute(r,"y")),u=(H.getFloatAttribute(r,"width"),H.getFloatAttribute(r,"height")),c=0;c<n;c++){var h=W.createSvgElement("g");if(a){var d=W.createSvgElement("g");h.appendChild(d)}if(o){var p=W.createSvgElement("polyline");H.setMultipleAttributes(p,["fill","stroke-width","stroke"],["none",i[c].getAttribute("cdf-line-width"),i[c].getAttribute("cdf-color")]),h.appendChild(p)}if(s){var f=W.createSvgElement("line");H.setMultipleAttributes(f,["stroke-width","stroke","y1","y2"],[i[c].getAttribute("cdf-line-width"),i[c].getAttribute("mean-color"),l.toString(),(l+u).toString()]),h.appendChild(f)}e.appendChild(h),tt.addClickTapHandlerToChartItem(h)}},t.prototype.draw=function(t,e){for(var r=W.findChildOfType(t,"pictureback"),i=W.findChildOfType(t,"picture"),n=W.findChildOfType(t,"grid"),a=W.childElements(W.findChildOfType(t,"legend")),o="true"==t.getAttribute("show-pdf"),s="true"==t.getAttribute("show-cdf"),l="true"==t.getAttribute("show-mean"),u=H.getFloatAttribute(t,"bar-width"),c=H.getFloatAttribute(r,"x"),h=H.getFloatAttribute(r,"y"),d=H.getFloatAttribute(r,"width"),p=H.getFloatAttribute(r,"height"),f=H.splitSkipEmpty(e," "),m=f.length,g=1/0,v=-1/0,b=1/0,y=-1/0,A=[],T=[],C=[],S=[],E=[],w=[],k=[],x=[],M=[],O=0;O<m;O++)if("empty"!=f[O]){f[O]=H.splitSkipEmpty(f[O],":"),A[O]="true"==f[O][0],T[O]="true"==f[O][1],C[O]=parseFloat(f[O][2]),S[O]=parseFloat(f[O][3]),E[O]=parseFloat(f[O][4]),w[O]=parseInt(f[O][5]),k[O]=parseInt(f[O][6]),x[O]=H.splitToFloats(f[O][7],"|");for(var I=0;I<x[O].length;I++)x[O][I]<b&&(b=x[O][I]),y<x[O][I]&&(y=x[O][I]);A[O]&&(M[O]=H.splitToFloats(f[O][8],"|")),C[O]<g&&(g=C[O]),v<S[O]&&(v=S[O])}g==1/0&&(g=0,v=0),b==1/0&&(b=0,y=1),this.chartScaleAndGrid.recalcChartScale(t,g,v,!1,!1),this.chartScaleAndGrid.recalcChartScale(t,0,y,!0,!1);var _=H.getFloatAttribute(n,"min-x"),L=H.getFloatAttribute(n,"max-x"),P=H.getFloatAttribute(n,"min-y"),R=H.getFloatAttribute(n,"max-y"),D=d/(L-_),F=p/(R-P),N=W.childElements(i);for(O=0;O<m;O++)if("empty"!=f[O]){"hidden"==N[O].getAttribute("visibility")&&N[O].setAttribute("visibility","inherit");var B=x[O].length,G=(S[O]-C[O])/B,U=a[O].getAttribute("original-color"),z=void 0,V=void 0;if(T[O]&&(z=a[O].getAttribute("low-color"),V=a[O].getAttribute("high-color")),o){var Y=N[O].firstElementChild,j=u*G*D,X=G*(1-u)/2;for(I=0;I<B;I++){var q=c+(C[O]+I*G+X-_)*D,Z=h+(R-x[O][I])*F,K=x[O][I]*F,Q=W.childElements(Y)[I];Q?Q.setAttribute("visibility","inherit"):(Q=W.createSvgElement("rect"),Y.appendChild(Q)),H.setMultipleAttributes(Q,["x","y","width","height"],[H.reducePrecision(q),H.reducePrecision(Z),H.reducePrecision(j),H.reducePrecision(K)]),A[O]&&T[O]&&I<w[O]?Q.setAttribute("fill",z):A[O]&&T[O]&&k[O]<I?Q.setAttribute("fill",V):Q.setAttribute("fill",U)}var J=W.childElements(Y);for(I=B;I<J.length;I++)J[I].setAttribute("visibility","hidden")}if(s){var $=o?N[O].firstElementChild.nextElementSibling:N[O].firstElementChild,et="";if(et+=c+(C[O]-_)*D+" "+(h+p)+" ",A[O])for(I=0;I<B;I++){et+=H.reducePrecision(c+(C[O]+(I+1)*G-_)*D)+","+H.reducePrecision(h+(1-M[O][I])*p)+" "}$.setAttribute("points",et)}if(l){var rt=N[O].lastElementChild,it=c+(E[O]-_)*D;rt.setAttribute("x1",it),rt.setAttribute("x2",it)}if("NONE"!=t.getAttribute("leg-pos")){var nt=W.findChildOfType(a[O],"value");nt.firstChild.textContent=H.formatNumber(E[O],void 0),nt.setAttribute("fill",a[O].getAttribute("mean-color"))}}else N[O].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&tt.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var n=W.findChildOfType(t,"picture"),a=W.childElements(n),o=W.childElements(a[e]),s=0;s<o.length;s++)o[s].setAttribute("visibility",r?"hidden":"inherit")},t}(),Z=function(){function t(t){this.frameDrawing=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",n=t.getAttribute("scale-type-"+i),a=W.findChildOfType(t,"grid"),o=W.findChildOfType(t,"pictureback"),s=W.findChildOfType(t,e?"pictureborderh":"pictureborderw"),l=a.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=l){var u=H.getFloatAttribute(o,"x"),c=H.getFloatAttribute(o,"y"),h=H.getFloatAttribute(o,"width"),d=H.getFloatAttribute(o,"height"),p="GRID_DEFAULT"==l,f="ChartBar"==r||"ChartStack"==r,m=t.getAttribute("bar-dir");e?f&&(!f||"NORTH"!=m&&"SOUTH"!=m)||H.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c,u,c+d]:[u+h,c,u+h,c+d]):f&&(!f||"EAST"!=m&&"WEST"!=m)||H.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c+d,u+h,c+d]:[u,c,u+h,c])}var g=a.getAttribute("grid-line-color");switch(a.setAttribute("grid-line-color",H.increaseTransparency(g,.5)),n){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var v=H.getFloatAttribute(t,"scale-min-"+i),b=H.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(v="ChartStack"==r?0:Math.min(0,v),b=Math.max(0,b)),this.recalcChartScale(t,v,b,e,!0);break;case"SCALE_TIME_WINDOW":b=Math.max(0,H.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,b,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,n){var a=W.findChildOfType(t,"grid"),o=i?"min-y":"min-x",s=i?"max-y":"max-x";if(e!=H.getFloatAttribute(a,o)||r!=H.getFloatAttribute(a,s)){var l=e,u=r;if(l==u){if(n)return;l-=1,u+=1}var c=W.findChildOfType(t,"pictureback"),h=H.getFloatAttribute(c,i?"height":"width"),d=i?25:45,p=(u-l)/Math.floor(h/d),f=Math.pow(10,Math.ceil(Math.log(u-l)/Math.log(10))-1),m=f/5;m<p&&(m=f/2)<p&&(m=f)<p&&(m=2*f)<p&&(m=5*f),n?(l=Math.ceil(l/m)*m,u=Math.floor(u/m)*m):(l=Math.floor(l/m)*m,u=Math.ceil(u/m)*m);var g=n?e:l,v=n?r:u;H.setMultipleAttributes(a,[o,s],[g,v]),this.drawChartGrid(t,l,u,m,g,v,i)}},t.prototype.drawChartGrid=function(t,e,r,i,n,a,o){var s=t.getAttribute("type"),l=W.findChildOfType(t,"grid"),u=l.getAttribute(o?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=u){var c=o?l.lastElementChild:l.firstElementChild,h=W.findChildOfType(t,"pictureback"),d=l.getAttribute("grid-text-color"),p=l.getAttribute("grid-line-color"),f=o?"scale-type-y":"scale-type-x",m="SCALE_100_PERCENT"==t.getAttribute(f),g="SCALE_TIME_WINDOW"==t.getAttribute(f)?t.getAttribute("date-format-pattern"):"null",v=Math.round((r-e)/i)+1,b="GRID_DEFAULT"==u,y=!0;if("ChartBar"==s||"ChartStack"==s){var A=t.getAttribute("bar-dir");"SOUTH"!=A&&"WEST"!=A||(y=!1)}for(var T=H.getFloatAttribute(h,"x"),C=H.getFloatAttribute(h,"y"),S=H.getFloatAttribute(h,"width"),E=H.getFloatAttribute(h,"height"),w=a-n,k=(o?E:S)/w,x=i*k;c.childElementCount<v;){var M=W.cloneElementWithId("grid-item");c.appendChild(M)}for(var O=W.childElements(c),I=e,_=o?y?C+(a-e)*k:C+(e-n)*k:y?T+(e-n)*k:T+(a-e)*k,L=0;L<v;L++){var P=o?b?T-4:T:_,R=o?_:b?C+E+4:C+E,D=o?b?T+S:T+S+4:_,F=o?_:b?C:C-4,N=o?b?P-3:D+3:P,B=o?R+3:b?R+11:F-3,G=o?b?"end":"start":"middle";(M=O[L]).setAttribute("visibility","inherit");var U=M.lastElementChild;H.setMultipleAttributes(U,["x1","x2","y1","y2","stroke"],[P,D,R,F,p]);var z=M.firstElementChild;H.setMultipleAttributes(z,["x","y","text-anchor","fill"],[N,B,G,d]);var V=void 0;V=m?H.formatPercent(I):"null"!=g?this.gridFormattedDate(I,w,g):H.formatNumber(I,void 0),z.firstChild.textContent=V,I+=i,_+=o?y?-x:+x:y?+x:-x}for(L=v;L<O.length;L++)O[L].setAttribute("visibility","hidden")}},t.prototype.gridFormattedDate=function(t,e,r){var i=H.toDate(this.frameDrawing,t),n=H.toMilliseconds(this.frameDrawing,e);return n>5*H.YEAR?H.formatDate(i,"YYYY"):n>5*H.MONTH?H.formatDate(i,"MMMYYYY"):n>5*H.DAY?H.formatDate(i,"DDMMM"):n>5*H.HOUR?H.formatDate(i,"DDMMHH"):n>5*H.MINUTE?H.formatDate(i,"HHmm"):H.formatDate(i,"mmss")},t}(),K=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e,r,i=t.getAttribute("type"),n=W.findChildOfType(t,"pictureback"),a=W.findChildOfType(t,"picture"),o=W.childElements(W.findChildOfType(t,"legend")),s=o.length,l=H.getFloatAttribute(n,"x"),u=H.getFloatAttribute(n,"y"),c=H.getFloatAttribute(n,"width"),h=H.getFloatAttribute(n,"height");if("ChartBar"==i||"ChartStack"==i){var d=t.getAttribute("bar-dir");e="NORTH"==d||"SOUTH"==d;var p=H.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?c/s:h/s)*p:(e?c:h)*p}for(var f=0;f<s;f++){var m=void 0,g=o[f].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(m=W.createSvgElement("rect")).setAttribute("stroke","none"),m.setAttribute("fill",g);var v=void 0;e?(v=c/s,m.setAttribute("x","ChartBar"==i?l+v*f+(v-r)/2:l+(c-r)/2),m.setAttribute("width",r)):(v=h/s,m.setAttribute("y","ChartBar"==i?u+v*f+(v-r)/2:u+(h-r)/2),m.setAttribute("height",r)),a.appendChild(m);break;case"ChartPie":(m=W.createSvgElement("path")).setAttribute("stroke","none"),m.setAttribute("fill",g),a.appendChild(m)}tt.addClickTapHandlerToChartItem(m)}},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=W.findChildOfType(t,"pictureback"),n=W.findChildOfType(t,"picture"),a=W.childElements(n),o=W.findChildOfType(t,"grid"),s=H.getFloatAttribute(i,"x"),l=H.getFloatAttribute(i,"y"),u=H.getFloatAttribute(i,"width"),c=H.getFloatAttribute(i,"height"),h=H.splitSkipEmpty(e," "),d=h.length,p=1/0,f=-1/0,m=!1,g=0,v=0;v<d;v++)h[v]=parseFloat(h[v]),h[v]<p&&(p=h[v]),f<h[v]&&(f=h[v]),h[v]<0&&(m=!0),g+=h[v];var b=!1;if("ChartBar"==r||"ChartStack"==r){var y=t.getAttribute("bar-dir"),A="NORTH"==y||"SOUTH"==y;"ChartBar"==r?(p=Math.min(0,p),f=Math.max(0,f)):(p=0,f=Math.max(0,g));var T=t.getAttribute(A?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=T&&"SCALE_AUTO_FROM_0"!=T||this.chartScaleAndGrid.recalcChartScale(t,p,f,A,!1),b="SCALE_100_PERCENT"==T;var C=H.getFloatAttribute(o,A?"min-y":"min-x"),S=H.getFloatAttribute(o,A?"max-y":"max-x"),E=(A?c:u)/(S-C),w=0;for(v=0;v<d;v++)if("ChartStack"==r&&(m||0==g)||"ChartBar"==r&&b&&(m||0==g))a[v].setAttribute(A?"height":"width",0);else{var k=b?h[v]/g:h[v],x=Math.abs(k),M=void 0;if("ChartBar"==r)switch(y){case"NORTH":case"WEST":M=k>0?S-k:S;break;case"SOUTH":case"EAST":M=k<0?k-C:-C}else{switch(y){case"NORTH":case"WEST":M=S-(k+w);break;case"SOUTH":case"EAST":M=-C+w}w+=k}x*=E;var O=A?c:u;(M*=E)<0?(x-=-M,M=0):M+x>O&&(x-=M+x-O),x<0&&(x=0),A?(a[v].setAttribute("y",l+M),a[v].setAttribute("height",x)):(a[v].setAttribute("x",s+M),a[v].setAttribute("width",x))}}else{var I=-Math.PI/2;for(v=0;v<d;v++){var _=g<=0||m?0:2*Math.PI*(h[v]/g),L=u/2,P=c/2,R=H.sectorData(s+L,l+P,L,P,I,_);a[v].setAttribute("d",R),I+=_}}if(("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&b)&&m?tt.showChartWarning(t,"Neg!"):tt.hideChartWarning(t),"NONE"!=t.getAttribute("leg-pos")){var D=W.childElements(W.findChildOfType(t,"legend"));for(v=0;v<d;v++){var F=W.findChildOfType(D[v],"value"),N=H.formatNumber(h[v],void 0);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&b)&&g>0&&!m&&(N+=" ("+H.formatPercent(h[v]/g)+")"),F.firstChild.textContent=N,F.setAttribute("fill",h[v]>=0?"royalBlue":"fireBrick")}tt.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){W.childElements(W.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t}(),Q=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(e){for(var r=e.getAttribute("type"),i=W.findChildOfType(e,"picture"),n=W.childElements(W.findChildOfType(e,"legend")),a=n.length,o=0;o<a;o++){var s=n[o].getAttribute("original-color"),l=W.createSvgElement("g");switch(r){case"ChartPlot":case"ChartTimePlot":if("true"==n[o].getAttribute("draw-line")){var u=W.createSvgElement("polyline");if(u.setAttribute("fill","none"),u.setAttribute("stroke",s),u.setAttribute("stroke-width",n[o].getAttribute("line-width")),l.appendChild(u),"ChartTimePlot"==r){var c=W.createSvgElement("polyline");c.setAttribute("stroke","none"),c.setAttribute("fill",H.increaseTransparency(s,t.timePlotAlpha)),l.appendChild(c)}}if("POINT_NONE"!=n[o].getAttribute("point-style")){var h=W.createSvgElement("g");h.setAttribute("fill",s),l.appendChild(h)}break;case"ChartTimeStack":var d=W.createSvgElement("polyline");d.setAttribute("stroke-width","1"),d.setAttribute("stroke",s),d.setAttribute("fill","none"),l.appendChild(d);var p=W.createSvgElement("polyline");p.setAttribute("stroke","none"),p.setAttribute("fill",H.increaseTransparency(s,t.stackChartAlpha)),l.appendChild(p)}i.appendChild(l),tt.addClickTapHandlerToChartItem(l)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),n=W.findChildOfType(e,"pictureback"),a=W.findChildOfType(e,"picture"),o=W.findChildOfType(e,"grid"),s=W.childElements(W.findChildOfType(e,"legend")),l=H.getFloatAttribute(n,"x"),u=H.getFloatAttribute(n,"y"),c=H.getFloatAttribute(n,"width"),h=H.getFloatAttribute(n,"height"),d=u+h,p=t.parseDataAndFindMinMax(r),f=p.datasets,m=f.length,g=p.minx,v=p.maxx,b=p.miny,y=p.maxy;if("ChartTimeStack"==i&&b<0)tt.showChartWarning(e,"Neg!");else{tt.hideChartWarning(e),"ChartTimeStack"==i&&(b=0,y=t.prepareChartTimeStackData(f));var A,T=e.getAttribute("scale-type-x"),C=e.getAttribute("scale-type-y"),S="SCALE_100_PERCENT"==C;if("SCALE_AUTO"==T)this.chartScaleAndGrid.recalcChartScale(e,g,v,!1,!1);else if("SCALE_TIME_WINDOW"==T){A=H.getFloatAttribute(e,"scale-max-x");var E=void 0;E="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(v,A):Math.max(v,A,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,E-A,E,!1,!0)}"SCALE_AUTO"==C&&this.chartScaleAndGrid.recalcChartScale(e,b,y,!0,!1);for(var w=H.getFloatAttribute(o,"min-x"),k=H.getFloatAttribute(o,"max-x"),x=H.getFloatAttribute(o,"min-y"),M=H.getFloatAttribute(o,"max-y"),O=c/(k-w),I=h/(M-x),_=W.childElements(a),L="",P=0;P<m;P++){var R=void 0,D=void 0,F=void 0,N=void 0,B=void 0,G=void 0,U=void 0,z=void 0,V=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(R="true"==s[P].getAttribute("draw-line"),D=s[P].getAttribute("point-style"),F="INTERPOLATION_STEP"==s[P].getAttribute("interpolation")),(R||"ChartTimeStack"==i)&&(B=(N=_[P].firstElementChild).nextElementSibling),D&&"POINT_NONE"!=D)switch(G=_[P].lastElementChild,D){case"POINT_CIRCLE":U="plot-point-circle",z=0,V=0;break;case"POINT_SQUARE":U="plot-point-square",z=-1.5,V=-1.5;break;case"POINT_TRIANGLE":U="plot-point-triangle",z=0,V=0}for(var Y=void 0,j=void 0,X="",q="",Z=void 0,K=void 0,Q=0,J=0;J<f[P].length;J++){var $=l+(f[P][J][0]-w)*O,et=void 0;if(S){var rt=f[m-1][J][1];et=rt<=0?0:f[P][J][1]/rt}else et=f[P][J][1];var it=u+(-et+M)*I;if($<l&&($=l),l+c<$&&($=l+c),it<u&&(it=u),u+h<it&&(it=u+h),!(null!=Y&&Math.abs($-Y)<tt.chartTolerance&&Math.abs(it-j)<tt.chartTolerance)){if($=H.reducePrecision($),it=H.reducePrecision(it),0==J&&(Z=$),K=$,N&&(F&&null!=Y&&(X+=$+","+j+" "),X+=$+","+it+" ",B&&(0==P&&(L=$+","+d+" "+L),q=$+","+it+" "+q)),G){var nt=W.childElements(G)[Q];nt?nt.setAttribute("visibility","inherit"):(nt=W.createUseElement(U),G.appendChild(nt)),nt.setAttribute("x",z+$),nt.setAttribute("y",V+it)}Q++,Y=$,j=it}}if(N&&(N.setAttribute("points",X),B))if("ChartTimePlot"==i){var at="";if(""!=X){var ot=u+M*I;ot<u&&(ot=u),u+h<ot&&(ot=u+h),at=K+","+ot+" "+Z+","+ot}B.setAttribute("points",X+at)}else B.setAttribute("points",X+L),L=q;if(G){var st=W.childElements(G);for(J=Q;J<st.length;J++)st[J].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,n){var a=e.getAttribute("type"),o=W.childElements(W.findChildOfType(e,"legend")),s=W.childElements(W.findChildOfType(e,"picture"));if("ChartTimeStack"==a)s[r].firstElementChild.setAttribute("stroke",n),s[r].lastElementChild.setAttribute("fill",H.increaseTransparency(n,t.stackChartAlpha));else{if("true"==o[r].getAttribute("draw-line")){var l=s[r].firstElementChild;l.setAttribute("stroke",n),"ChartTimePlot"==a&&l.nextElementSibling.setAttribute("fill",H.increaseTransparency(n,t.timePlotAlpha))}"POINT_NONE"!=o[r].getAttribute("point-style")&&s[r].lastElementChild.setAttribute("fill",n)}},t.parseDataAndFindMinMax=function(t){for(var e=H.splitSkipEmpty(t," "),r=e.length,i=1/0,n=-1/0,a=1/0,o=-1/0,s=0;s<r;s++)if("empty"==e[s])e[s]=[];else{e[s]=H.splitSkipEmpty(e[s],"|");for(var l=0;l<e[s].length;l++){e[s][l]=e[s][l].split(":");var u=e[s][l][0]=parseFloat(e[s][l][0]),c=e[s][l][1]=parseFloat(e[s][l][1]);u<i&&(i=u),n<u&&(n=u),c<a&&(a=c),o<c&&(o=c)}}return i==1/0&&(i=0,n=0),a==1/0&&(a=0,o=0),{datasets:e,minx:i,maxx:n,miny:a,maxy:o}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),J=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=W.findChildOfType(t,"picture"),r=W.findChildOfType(t,"pictureback"),i=H.getFloatAttribute(r,"x"),n=H.getFloatAttribute(r,"y"),a=H.getFloatAttribute(r,"width"),o=H.getFloatAttribute(r,"height"),s=W.cloneElementWithId("normal-text");s.setAttribute("fill","grey"),s.setAttribute("text-anchor","middle"),s.setAttribute("x",(i+a/2).toString()),s.setAttribute("y",(n+o/2+3).toString()),s.firstChild.textContent="Not supported at the moment",e.appendChild(s)},t.draw=function(t,e){},t.setItemLook=function(t,e,r,i){},t}(),$=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=W.findChildOfType(t,"picture"),r=W.findChildOfType(t,"pictureback"),i=H.getFloatAttribute(r,"x"),n=H.getFloatAttribute(r,"y"),a=H.getFloatAttribute(r,"height"),o=W.childElements(W.findChildOfType(t,"legend")).length,s=a/o,l=s*H.getFloatAttribute(t,"bar-width"),u=(s-l)/2;t.setAttribute("rect-height",H.reducePrecision(l).toString());for(var c=0;c<o;c++){var h=W.createSvgElement("g");h.setAttribute("transform","translate("+i+","+(n+c*s+u)+")"),e.appendChild(h),tt.addClickTapHandlerToChartItem(h)}},t.prototype.draw=function(e,r){for(var i=W.findChildOfType(e,"pictureback"),n=W.findChildOfType(e,"picture"),a=W.findChildOfType(e,"grid"),o=(H.getFloatAttribute(i,"x"),H.getFloatAttribute(i,"width")),s=H.splitSkipEmpty(r," "),l=s.length,u=-1/0,c=0;c<l;c++)if("empty"==s[c])s[c]=[];else{s[c]=H.splitSkipEmpty(s[c],"|");for(var h=0;h<s[c].length;h++)s[c][h]=s[c][h].split(":"),s[c][h][0]=parseFloat(s[c][h][0]),s[c][h][1]=parseFloat(s[c][h][1]);var d=s[c][s[c].length-1][0];u<d&&(u=d)}u==1/0&&(u=0);for(c=0;c<l;c++)0!=s[c].length&&s[c][s[c].length-1][0]<u&&s[c].push([u,s[c][s[c].length-1][1]]);var p,f=H.getFloatAttribute(e,"scale-max-x");p="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(u,f):Math.max(u,f,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,p-f,p,!1,!0);var m=H.getFloatAttribute(a,"min-x"),g=o/(H.getFloatAttribute(a,"max-x")-m),v=W.childElements(n),b=H.getFloatAttribute(e,"rect-height"),y=t.colorMapping(e);for(c=0;c<l;c++){var A=v[c],T=W.childElements(A),C=T.length,S=0,E="",w=null;for(h=0;h<s[c].length;h++){var k=s[c][h][0],x=s[c][h][1];if(k<m)w=0,E=y(x);else if(null==w)w=(k-m)*g,E=y(x);else{var M=y(x);if(M!=E||h==s[c].length-1){var O=(k-m)*g,I=void 0;S<C?(I=T[S],S++,I.setAttribute("visibility","inherit")):(I=W.createSvgElement("rect"),A.appendChild(I)),H.setMultipleAttributes(I,["x","width","height","fill"],[H.reducePrecision(w),H.reducePrecision(O-w),b,E]),w=O,E=M}}}for(var _=S;_<C;_++)T[_].setAttribute("visibility","hidden")}},t.colorMapping=function(t){var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color");e=H.splitSkipEmpty(e," ");for(var i=[],n=[],a=function(t){var r=e[t].split(":"),a=void 0,o=parseFloat(r[1]);switch(r[0]){case"GREATER":a=function(t){return t>o};break;case"GREATER_OR_EQUALS":a=function(t){return t>=o};break;case"LESS":a=function(t){return t<o};break;case"LESS_OR_EQUALS":a=function(t){return t<=o};break;case"EQUALS":a=function(t){return t==o};break;case"NOT_EQUALS":a=function(t){return t!=o}}i[t]=a,n[t]=r[2]},o=0;o<e.length;o++)a(o);return function(t){for(var e=0;e<i.length;e++)if(i[e](t))return n[e];return r}},t.setItemLook=function(t,e,r,i){var n=W.findChildOfType(t,"picture");W.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),tt=function(){function t(t){this.frameDrawing=t,this.chartScaleAndGrid=new Z(t),this.chart1D=new K(t,this.chartScaleAndGrid),this.chart2D=new Q(t,this.chartScaleAndGrid),this.chartHistogram=new q(t,this.chartScaleAndGrid),this.chartHistogram2D=new J(t,this.chartScaleAndGrid),this.chartTimeColor=new $(t,this.chartScaleAndGrid)}return t.create=function(){return W.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var n=e.getAttribute("type"),a=W.findChildOfType(e,"background"),o=W.findChildOfType(e,"pictureback"),s=W.findChildOfType(e,"pictureselect"),l=W.findChildOfType(e,"pictureborderh"),u=W.findChildOfType(e,"pictureborderw"),c=W.findChildOfType(e,"grid"),h=0;h<r.length;h++)switch(r[h]){case"width":case"height":case"fill":case"stroke":a.setAttribute(r[h],i[h]);break;case"pic-width":case"pic-height":o.setAttribute(r[h].substring(4),i[h]),s.setAttribute(r[h].substring(4),i[h]);break;case"pic-fill":o.setAttribute(r[h].substring(4),i[h]);break;case"pic-stroke":l.setAttribute(r[h].substring(4),i[h]),u.setAttribute(r[h].substring(4),i[h]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":c.setAttribute(r[h],i[h]);break;case"grid-completed":"ChartPie"!=n&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":t.addItem(e,i[h]);break;case"items-completed":t.setupLegendItemsLayout(e),t.setupPicture(e);break;case"data":this.drawPicture(e,i[h]);break;default:e.setAttribute(r[h],i[h])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=W.findChildOfType(e,"background"),n=W.findChildOfType(e,"pictureback"),a=W.findChildOfType(e,"pictureselect"),o=W.findChildOfType(e,"pictureborderh"),s=W.findChildOfType(e,"pictureborderw"),l=W.findChildOfType(e,"warning"),u=W.findChildOfType(e,"legend"),c=e.getAttribute("leg-pos"),h=H.getFloatAttribute(i,"width"),d=H.getFloatAttribute(i,"height"),p=H.getFloatAttribute(e,"pic-offset-x"),f=H.getFloatAttribute(e,"pic-offset-y"),m=H.getFloatAttribute(n,"width"),g=H.getFloatAttribute(n,"height"),v=H.getFloatAttribute(e,"leg-size"),b=0,y=0,A=0,T=0;switch(c){case"SOUTH":b=p,y=d-v,A=h-p,T=v;break;case"WEST":p+=v,b=0,y=f,A=v,T=d-f;break;case"EAST":b=h-v,y=f,A=v,T=d-f;break;case"NORTH":f+=v,b=p,y=0,A=h-p,T=v}if(H.setMultipleAttributes(n,["x","y"],[p,f]),H.setMultipleAttributes(a,["x","y"],[p,f]),H.setMultipleAttributes(l,["x","y"],[p+m/2,f+g/2+3]),"NONE"==c?u.setAttribute("visibility","hidden"):(u.setAttribute("transform","translate("+b+","+y+")"),H.setMultipleAttributes(u,["width","height"],[A,T])),"ChartPie"==r){var C=m/2,S=g/2,E=W.createSvgElement("ellipse");H.setMultipleAttributes(E,["cx","cy","rx","ry","stroke","fill","visibility"],[p+C,f+S,C,S,"none",n.getAttribute("fill"),"hidden"]),e.insertBefore(E,n);var w=W.createSvgElement("ellipse");H.setMultipleAttributes(w,["cx","cy","rx","ry","stroke","fill"],[p+C,f+S,C,S,o.getAttribute("stroke"),"none"]),e.insertBefore(w,o),W.removeElement(e,o),W.removeElement(e,s)}e.onmouseover=function(e){return t.selectChart(e,!0)},e.onmouseout=function(e){return t.selectChart(e,!1)}},t.setupLegendItemsLayout=function(t){for(var e=W.findChildOfType(t,"legend"),r=W.childElements(e),i=H.getFloatAttribute(e,"width"),n=0,a=0,o=0;o<r.length;o++){var s=r[o],l=W.findChildOfType(s,"back"),u=H.getFloatAttribute(l,"width"),c=W.findChildOfType(s,"value"),h=c.getComputedTextLength(),d=Math.max(u,H.getFloatAttribute(c,"x")+h);l.setAttribute("width",d.toString()),0<n&&i<n+d&&(n=0,a+=20),s.setAttribute("transform","translate("+n+","+a+")"),n+=d+5}},t.showChartWarning=function(t,e){var r=W.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=W.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=W.findChildOfType(t,"picture"),r=W.findChildOfType(t,"legend");W.removeAllChildren(r),W.removeAllChildren(e)},t.addItem=function(e,r){var i=e.getAttribute("type"),n=W.findChildOfType(e,"legend"),a=r.split("\n"),o=a[0],s=a[1],l=W.cloneElementWithId("legend-item"),u=W.findChildOfType(l,"color"),c=W.findChildOfType(l,"name"),h=W.findChildOfType(l,"value");u.setAttribute("fill",o),l.setAttribute("original-color",o),c.setAttribute("fill",e.getAttribute("leg-text-color")),c.appendChild(W.createTextNode(s)),h.appendChild(W.createTextNode("")),n.appendChild(l);var d=c.getComputedTextLength();h.setAttribute("x",(H.getFloatAttribute(c,"x")+d+4).toString()),"ChartPlot"==i||"ChartTimePlot"==i?H.setMultipleAttributes(l,["draw-line","line-width","interpolation","point-style"],[a[2],a[3],a[4],a[5]]):"ChartHistogram"==i&&H.setMultipleAttributes(l,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[a[2],a[3],a[4],a[5],a[6]]),t.addClickTapHandlerToChartItem(l)},t.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":K.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":Q.setup(t);break;case"ChartTimeColor":$.setup(t);break;case"ChartHistogram":q.setup(t);break;case"ChartHistogram2D":J.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":J.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.selectChart=function(t,e){var r=t.currentTarget;W.findChildOfType(r,"pictureselect").setAttribute("visibility",e?"inherit":"hidden")},t.addClickTapHandlerToChartItem=function(e){new f(e,function(r){return t.selectChartItem(e,!0,!1)},function(r){return t.selectChartItem(e,!1,!1)},null,function(r){return t.selectChartItem(e,!0,!0)},function(t){return!1})},t.selectChartItem=function(e,r,i){for(var n=t.getChartShape(e),a=H.indexInParent(e),o=W.childElements(W.findChildOfType(n,"legend")),s=o[a],l="true"==s.getAttribute("selected"),u=!1,c=0;c<o.length;c++)if(c!=a&&"true"==o[c].getAttribute("selected")){u=!0;break}if(i)return l=!l,s.setAttribute("selected",l?"true":"false"),void t.setChartItemLook(n,a,!1,l);if(l||u){if(l)return;t.setChartItemLook(n,a,!r,r)}else{t.setChartItemLook(n,a,!1,r);for(c=0;c<o.length;c++)c!=a&&t.setChartItemLook(n,c,r,!1)}},t.setChartItemLook=function(e,r,i,n){var a=W.childElements(W.findChildOfType(e,"legend")),o=W.findChildOfType(a[r],"back"),s=W.findChildOfType(a[r],"color");o.setAttribute("class",n?"legend-item-background-selected":"legend-item-background");var l=i?t.colorItemGrayed:a[r].getAttribute("original-color");switch(s.setAttribute("fill",l),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":K.setItemLook(e,r,i,l);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":Q.setItemLook(e,r,i,l);break;case"ChartTimeColor":$.setItemLook(e,r,i,l);break;case"ChartHistogram":q.setItemLook(e,r,i,l);break;case"ChartHistogram2D":J.setItemLook(e,r,i,l)}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),et=function(){function t(t){var e=this;this.client=t,this.onWindowResizeEventClosure=function(t){return e.applyNavigationSettings()},this.onSVGPointingEventClosure=function(t){return e.onSVGPointingEvent(t)}}return t.prototype.initSVGNavigation=function(){window.addEventListener("resize",this.onWindowResizeEventClosure,!1),E.addFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.oncontextmenu=function(){return!1},t.addEventListener("mousedown",this.onSVGPointingEventClosure),t.addEventListener("mousemove",this.onSVGPointingEventClosure),t.addEventListener("mouseup",this.onSVGPointingEventClosure),t.addEventListener("mouseout",this.onSVGPointingEventClosure),t.addEventListener("wheel",this.onSVGPointingEventClosure),t.addEventListener("touchstart",this.onSVGPointingEventClosure),t.addEventListener("touchmove",this.onSVGPointingEventClosure),t.addEventListener("touchend",this.onSVGPointingEventClosure),this.buttonDown=0,this.prevPtrCoords=[],this.presentationCoords=[0,0],this.zoom=1},t.prototype.clearSVGNavigation=function(){if(this.client.svg){window.removeEventListener("resize",this.onWindowResizeEventClosure),E.removeFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.removeEventListener("mousedown",this.onSVGPointingEventClosure),t.removeEventListener("mousemove",this.onSVGPointingEventClosure),t.removeEventListener("mouseup",this.onSVGPointingEventClosure),t.removeEventListener("mouseout",this.onSVGPointingEventClosure),t.removeEventListener("wheel",this.onSVGPointingEventClosure),t.removeEventListener("touchstart",this.onSVGPointingEventClosure),t.removeEventListener("touchmove",this.onSVGPointingEventClosure),t.removeEventListener("touchend",this.onSVGPointingEventClosure)}},t.prototype.onSVGPointingEvent=function(e){e.stopPropagation();var r=H.offsetPage(this.client.svg);if(e.type.startsWith("mouse")||"wheel"==e.type){var i=e,n=i.pageX-r.left,a=i.pageY-r.top;switch(i.type){case"mousedown":this.buttonDown=i.which,this.prevPtrCoords=[n,a],1==this.buttonDown||this.buttonDown;break;case"mousemove":if(1==this.buttonDown)i.preventDefault();else if(3==this.buttonDown){var o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];this.applyPanning(o,s),this.prevPtrCoords=[n,a]}break;case"mouseup":case"mouseout":if(this.client.svg.parentNode.contains(i.relatedTarget))return;var l=this.buttonDown;if(this.buttonDown=0,1==l){o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];Math.abs(o)<=t.clickTolerance&&Math.abs(s)<=t.clickTolerance&&this.onPresentationClick(i,n,a)}this.prevPtrCoords=[];break;case"wheel":var u=e;u.altKey?this.onWheelZooming(0<u.deltaY,n,a):(e.preventDefault(),0<u.deltaY?this.applyPanning(0,-50):this.applyPanning(0,50))}}else if(e.type.startsWith("touch")){var c=e,h=void 0,d=void 0,p=void 0,f=void 0;switch(c.touches.length>0&&(h=c.touches[0].pageX-r.left,d=c.touches[0].pageY-r.top),c.touches.length>1&&(p=c.touches[1].pageX-r.left,f=c.touches[1].pageY-r.top),c.type){case"touchstart":this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchmove":if(c.preventDefault(),c.touches.length>1&&4==this.prevPtrCoords.length){var m=(h+p)/2,g=(d+f)/2,v=Math.hypot(this.prevPtrCoords[2]-this.prevPtrCoords[0],this.prevPtrCoords[3]-this.prevPtrCoords[1]),b=Math.hypot(p-h,f-d)/v*this.zoom;b=Math.max(b,t.zooms[0]),b=Math.min(b,t.zooms[t.zooms.length-1]),this.applyZoom(b,m,g)}else if(this.prevPtrCoords.length>=2){o=h-this.prevPtrCoords[0],s=d-this.prevPtrCoords[1];if(4==this.prevPtrCoords.length){var y=Math.hypot(o,s),A=h-this.prevPtrCoords[2],T=d-this.prevPtrCoords[3];Math.hypot(A,T)<y&&(o=A,s=T)}this.applyPanning(o,s)}this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchend":this.prevPtrCoords=[]}}},t.prototype.applyPresentationTransform=function(){var t=this.client.frameDrawing.navigationSettings;if(!t.zoomAndPanningEnabled){var e=this.zoom,r=this.presentationCoords[0],i=this.presentationCoords[1],n=this.client.svg.getBoundingClientRect(),a=n.width,o=n.height;e=Math.max(e,a/t.width),e=Math.max(e,o/t.height),r=Math.min(r,-t.x*e),r=Math.max(r,a-(t.x+t.width)*e),i=Math.min(i,-t.y*e),i=Math.max(i,o-(t.y+t.height)*e),this.presentationCoords=[r,i],this.zoom=e}var s="translate("+this.presentationCoords[0]+","+this.presentationCoords[1]+")",l="scale("+this.zoom+")";this.client.presentation.setAttribute("transform",s+" "+l)},t.prototype.applyZoom=function(t,e,r){if(t!=this.zoom){var i=this.client.frameDrawing.navigationSettings;if(!i.zoomAndPanningEnabled){var n=this.client.svg,a=this.client.svg.getBoundingClientRect(),o=a.width,s=a.height,l=i.width,u=i.height,c=n.parentNode.getBoundingClientRect(),h=c.width,d=c.height;if((t=l/u>h/d?Math.max(t,h/l):Math.max(t,d/u))==this.zoom)return;var p=Math.min(l*t,h),f=Math.min(u*t,d);p!=o&&n.setAttribute("width",p.toString()),f!=s&&n.setAttribute("height",f.toString())}var m=t/this.zoom,g=e-(e-this.presentationCoords[0])*m,v=r-(r-this.presentationCoords[1])*m;this.presentationCoords=[g,v],this.zoom=t,this.applyPresentationTransform()}},t.prototype.applyPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform()},t.prototype.navigateTo=function(t,e,r){this.zoom=r,this.presentationCoords=[-t*this.zoom,-e*this.zoom],this.applyPresentationTransform()},t.prototype.onWheelZooming=function(e,r,i){var n=this.zoom;if(e){for(var a=t.zooms.length-1;a>=0;a--)if(t.zooms[a]<this.zoom){n=t.zooms[a];break}}else for(a=0;a<t.zooms.length;a++)if(this.zoom<t.zooms[a]){n=t.zooms[a];break}this.applyZoom(n,r,i)},t.prototype.onPresentationClick=function(t,e,r){var i=e-this.presentationCoords[0],n=r-this.presentationCoords[1];i/=this.zoom,n/=this.zoom,this.client.frameDrawing.onUserClick(t.target,i,n)},t.prototype.applyNavigationSettings=function(){var t,e,r,i=this.client.svg,n=this.client.frameDrawing.navigationSettings,a=n.width,o=n.height,s=n.zoomAndPanningEnabled,l=n.width/n.height,u=i.parentNode.getBoundingClientRect(),c=u.width,h=u.height,d=c/h,p=n.x,f=n.y;l>d?(r=c/a,t=c,s?f-=((e=h)/r-o)/2:e=c/l):(r=h/o,s?p-=((t=c)/r-a)/2:t=h*l,e=h),H.setMultipleAttributes(i,["width","height"],[t,e]),this.navigateTo(p,f,r)},t.clickTolerance=1,t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t}(),rt=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return W.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return W.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return W.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)r[n],e.setAttribute(r[n],i[n]);t.updateGISMarkupPosition(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=W.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=H.getFloatAttribute(t,"lon"),n=H.getFloatAttribute(t,"lat"),a=it.lonLatToXY(r,i,n);H.setMultipleAttributes(t,["cx","cy"],[a[0],a[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var o=t.getAttribute("lonlatpoints"),s=it.lonLatPointsToXYPoints(r,o);t.setAttribute("points",s)}},t}(),it=function(){function t(t){this.frameDrawing=t}return t.prototype.createShapeGISMap=function(){var t=this,e=W.cloneElementWithId("shape-gis-map"),r=function(e){return t.onGISEvent(e)};e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r);var i=W.findChildOfType(e,"map").firstElementChild;return W.findChildOfType(i,"agents").addEventListener("click",function(e){return t.onGISAgentLayerClick(e)}),e},t.prototype.updateShapeGISMap=function(t,e,r){for(var i=W.findChildOfType(t,"background"),n=W.findChildOfType(t,"map"),a=W.findChildOfType(t,"shadow"),o=W.findChildOfType(t,"border"),s=0;s<e.length;s++)switch(e[s]){case"width":case"height":i.setAttribute(e[s],r[s]),n.setAttribute(e[s],r[s]),a.setAttribute(e[s],r[s]),o.setAttribute(e[s],r[s]);break;case"size-completed":t.getAttribute("zoom")&&this.redrawGISMap(t);break;case"background-color":i.setAttribute("fill",r[s]);break;case"border-color":o.setAttribute("stroke",r[s]);break;case"map-completed":this.redrawGISMap(t);break;default:t.setAttribute(e[s],r[s])}},t.prototype.redrawGISMap=function(e){this.redrawGISTiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.prototype.redrawGISTiles=function(e){var r=W.findChildOfType(e,"background"),i=H.getFloatAttribute(r,"width"),n=H.getFloatAttribute(r,"height"),a=t.minGISZoom(i,n),o=W.findChildOfType(e,"map").firstElementChild;o.setAttribute("transform","translate(0,0)");var s=H.getIntAttribute(e,"zoom"),l=H.getFloatAttribute(e,"center-lon"),u=H.getFloatAttribute(e,"center-lat");s<a&&(s=a,e.setAttribute("zoom",s.toString()));var c,h=Math.pow(2,s),d=t.latToTileYFloat(u,s),p=n/2/t.tileImageSize;d-p<0?c=p:h<d+p&&(c=h-p),c&&(u=t.tileYToLat(c,s),e.setAttribute("center-lat",u.toString()));var f=W.findChildOfType(o,"tiles");W.removeAllChildren(f),this.updateGISTiles(f,s,u,l,0,0,i,n,h)},t.prototype.updateGISTiles=function(e,r,i,n,a,o,s,l,u){for(var c=t.lonToTileXInt(n,r),h=t.latToTileYInt(i,r),d=a+s/2-t.lonToXOffsetWithinTile(n,r),p=o+l/2-t.latToYOffsetWithinTile(i,r);d>0;)d-=t.tileImageSize,c--;for(;p>0;)p-=t.tileImageSize,h--;c=H.modulo(c,u),h=H.modulo(h,u);for(var f=[],m=W.childElements(e),g=0;g<m.length;g++)f.push(m[g]);for(var v=c,b=d;b<s;b+=t.tileImageSize){for(var y=h,A=p;A<l;A+=t.tileImageSize){var T=r+"/"+v+"/"+y,C=null;for(g=0;g<f.length;g++)if(f[g].getAttribute("tileid")==T){C=f[g];break}null==C&&(C=this.addGISTile(e,r,v,y)),C.setAttribute("x",(b-a).toString()),C.setAttribute("y",(A-o).toString()),y=H.modulo(y+1,u)}v=H.modulo(v+1,u)}},t.prototype.addGISTile=function(e,r,i,n){var a=W.findParentOfType(e,"ShapeGISMap"),o=this.tileURL(a,r,i,n),s=W.createSvgElement("image");return s.setAttribute("width",t.tileImageSize.toString()),s.setAttribute("height",t.tileImageSize.toString()),s.setAttributeNS(W.xlinkns,"href",o),s.setAttribute("tileid",r+"/"+i+"/"+n),e.appendChild(s),s},t.redrawGISMarkup=function(t){for(var e=W.findChildOfType(t,"map").firstElementChild,r=W.findChildOfType(e,"markup"),i=W.childElements(r),n=0;n<i.length;n++)rt.updateGISMarkupPosition(i[n])},t.redrawGISAgents=function(e){for(var r=W.findChildOfType(e,"map").firstElementChild,i=W.findChildOfType(r,"agents"),n=W.childElements(i),a=0;a<n.length;a++)t.updateGISObjectScale(n[a]),"hidden"!=n[a].getAttribute("visibility")&&t.updateGISObjectPosition(n[a])},t.updateGISObjectPosition=function(e){var r=W.findParentOfType(e,"ShapeGISMap"),i=H.getFloatAttribute(e,"lon"),n=H.getFloatAttribute(e,"lat"),a=H.getFloatAttribute(e,"heading"),o=t.lonLatToXY(r,i,n),s="translate("+o[0]+","+o[1]+") rotate("+a+")",l=e.getAttribute("scale");l&&(s+=" scale("+l+")"),e.setAttribute("transform",s)},t.updateGISObjectScale=function(e){var r=W.findParentOfType(e,"ShapeGISMap"),i=H.getIntAttribute(e,"fixed-scale-zoom");if(i){var n=H.getIntAttribute(r,"zoom");if(n<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var a=1;if(H.getIntAttribute(e,"real-scale-zoom")<=n){var o=H.getFloatAttribute(e,"pixels-per-meter"),s=H.getFloatAttribute(e,"lat");a=t.pixelsPerGISMeter(n,s)/o}e.setAttribute("scale",a.toString())}},t.prototype.panGIS=function(e,r,i){var n=W.findChildOfType(e,"map").firstElementChild,a=H.parseTranslateTransform(n.getAttribute("transform")),o=a[0]+r,s=a[1]+i,l=H.getIntAttribute(e,"zoom"),u=Math.pow(2,l),c=H.getFloatAttribute(e,"center-lon"),h=H.getFloatAttribute(e,"center-lat"),d=t.latToTileYFloat(h,l),p=W.findChildOfType(e,"background"),f=H.getFloatAttribute(p,"width"),m=H.getFloatAttribute(p,"height"),g=m/2/t.tileImageSize;d-g-s/t.tileImageSize<0?s=(d-g)*t.tileImageSize:u<d+g-s/t.tileImageSize&&(s=(d+g-u)*t.tileImageSize),o=t.normalizedGISX(o,l),o=Math.round(o),s=Math.round(s),n.setAttribute("transform","translate("+o+","+s+")");var v=W.findChildOfType(n,"tiles");this.updateGISTiles(v,l,h,c,o,s,f,m,u)},t.prototype.zoomOutGIS=function(e,r,i){var n=W.findChildOfType(e,"background"),a=H.getFloatAttribute(n,"width"),o=H.getFloatAttribute(n,"height"),s=H.getIntAttribute(e,"zoom");t.minGISZoom(a,o)<s&&this.setGISZoom(e,r,i,s-1)},t.prototype.zoomInGIS=function(t,e,r){var i=H.getIntAttribute(t,"zoom");i<19&&this.setGISZoom(t,e,r,i+1)},t.prototype.setGISZoom=function(e,r,i,n){var a=W.findChildOfType(e,"background"),o=H.getFloatAttribute(a,"width"),s=H.getFloatAttribute(a,"height"),l=W.findChildOfType(e,"map").firstElementChild,u=H.parseTranslateTransform(l.getAttribute("transform")),c=t.xyToLonLat(e,r-u[0],i-u[1]),h=t.lonToTileXFloat(c[0],n),d=t.latToTileYFloat(c[1],n),p=Math.pow(2,n);h=H.remainderPositive(h-(r-o/2)/t.tileImageSize,p),d=H.remainderPositive(d-(i-s/2)/t.tileImageSize,p);var f=t.tileXToLon(h,n),m=t.tileYToLat(d,n);H.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[n,f,m]),this.redrawGISMap(e)},t.prototype.onGISClick=function(e,r,i){var n=W.findChildOfType(e,"map").firstElementChild,a=H.parseTranslateTransform(n.getAttribute("transform")),o=t.xyToLonLat(e,r-a[0],i-a[1]);this.frameDrawing.client.network.postUserAction(e.id,o[0]+" "+o[1])},t.prototype.onGISEvent=function(e){var r=e.currentTarget;if("true"==r.getAttribute("navigation-enabled")){var i=W.findChildOfType(r,"background"),n=H.getFloatAttribute(i,"width"),a=H.getFloatAttribute(i,"height"),o=i.getBoundingClientRect(),s=o.width/n,l=o.height/a,u=H.offsetPage(i);if(e.type.startsWith("mouse")||"wheel"==e.type){var c=e,h=(c.pageX-u.left)/s,d=(c.pageY-u.top)/l;switch(e.type){case"mousedown":t.buttonDown=c.which,1==t.buttonDown&&(e.stopPropagation(),t.prevPtrCoords=[h,d]);break;case"mousemove":if(1==t.buttonDown){e.stopPropagation(),e.preventDefault();var p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];t.prevPtrCoords=[h,d],this.panGIS(r,p,f)}break;case"mouseup":case"mouseout":if(r.contains(c.relatedTarget))return;if(1==t.buttonDown){e.stopPropagation();p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];Math.abs(p)<=et.clickTolerance&&Math.abs(f)<=et.clickTolerance&&this.onGISClick(r,h,d)}t.buttonDown=0;break;case"wheel":if(!c.altKey&&!c.ctrlKey){var m=e;e.stopPropagation(),e.preventDefault(),0<m.deltaY?this.zoomOutGIS(r,h,d):this.zoomInGIS(r,h,d)}}}else if(e.type.startsWith("touch")){var g=e;if(g.touches.length>2)return;var v=void 0,b=void 0,y=void 0,A=void 0;switch(g.touches.length>0&&(v=(g.touches[0].pageX-u.left)/s,b=(g.touches[0].pageY-u.top)/l),g.touches.length>1&&(y=(g.touches[1].pageX-u.left)/s,A=(g.touches[1].pageY-u.top)/l),e.type){case"touchstart":e.stopPropagation(),t.prevPtrCoords=g.touches.length>1?[v,b,y,A]:[v,b];break;case"touchmove":if(e.stopPropagation(),e.preventDefault(),g.touches.length>1&&4==t.prevPtrCoords.length){var T=(v+y)/2,C=(b+A)/2,S=Math.hypot(t.prevPtrCoords[2]-t.prevPtrCoords[0],t.prevPtrCoords[3]-t.prevPtrCoords[1]),E=Math.hypot(y-v,A-b);(E<.8*S||1.2*S<E)&&(E<S?this.zoomOutGIS(r,T,C):this.zoomInGIS(r,T,C),t.prevPtrCoords=[v,b,y,A])}else if(t.prevPtrCoords.length>=2){p=v-t.prevPtrCoords[0],f=b-t.prevPtrCoords[1];if(4==t.prevPtrCoords.length){var w=Math.hypot(p,f),k=v-t.prevPtrCoords[2],x=b-t.prevPtrCoords[3];Math.hypot(k,x)<w&&(p=k,f=x)}this.panGIS(r,p,f),t.prevPtrCoords=g.touches.length>1?[v,b,y,A]:[v,b]}else t.prevPtrCoords=g.touches.length>1?[v,b,y,A]:[v,b];break;case"touchend":e.stopPropagation(),t.prevPtrCoords=[]}}}},t.prototype.onGISAgentLayerClick=function(t){t.stopPropagation(),t.preventDefault();for(var e=t.currentTarget,r=t.target;r.parentNode!=e;)r=r.parentNode;this.frameDrawing.client.network.postUserAction(r.id,"0 0")},t.xyToLonLat=function(e,r,i){var n=W.findChildOfType(e,"background"),a=H.getFloatAttribute(n,"width"),o=H.getFloatAttribute(n,"height"),s=H.getIntAttribute(e,"zoom"),l=Math.pow(2,s),u=t.lonToTileXFloat(H.getFloatAttribute(e,"center-lon"),s),c=t.latToTileYFloat(H.getFloatAttribute(e,"center-lat"),s),h=(r-a/2)/t.tileImageSize,d=(i-o/2)/t.tileImageSize,p=H.remainderPositive(u+h,l),f=H.remainderPositive(c+d,l);return[t.tileXToLon(p,s),t.tileYToLat(f,s)]},t.lonLatToXY=function(e,r,i){var n=W.findChildOfType(e,"background"),a=H.getFloatAttribute(n,"width"),o=H.getFloatAttribute(n,"height"),s=H.getIntAttribute(e,"zoom"),l=t.lonToTileXFloat(H.getFloatAttribute(e,"center-lon"),s),u=t.latToTileYFloat(H.getFloatAttribute(e,"center-lat"),s),c=t.lonToTileXFloat(r,s),h=t.latToTileYFloat(i,s);return[a/2+(c-l)*t.tileImageSize,o/2+(h-u)*t.tileImageSize]},t.lonLatPointsToXYPoints=function(e,r){var i=W.findChildOfType(e,"background"),n=H.getFloatAttribute(i,"width"),a=H.getFloatAttribute(i,"height"),o=H.getIntAttribute(e,"zoom"),s=t.lonToTileXFloat(H.getFloatAttribute(e,"center-lon"),o),l=t.latToTileYFloat(H.getFloatAttribute(e,"center-lat"),o),u=void 0,c=void 0,h="";r=H.splitSkipEmpty(r," ");for(var d=0;d<r.length;d++){var p=r[d].split(","),f=t.lonToTileXFloat(parseFloat(p[0]),o),m=t.latToTileYFloat(parseFloat(p[1]),o),g=n/2+(f-s)*t.tileImageSize,v=a/2+(m-l)*t.tileImageSize;null!=u&&Math.abs(g-u)<t.gisTolerance&&Math.abs(v-c)<t.gisTolerance||(h+=(g=H.reducePrecision(g))+","+(v=H.reducePrecision(v))+" ",u=g,c=v)}return h},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.prototype.tileURL=function(e,r,i,n){var a;switch(e.getAttribute("tile-url-provider-type")){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":a=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":a=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":a=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":a=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":a=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":a=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":a=H.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}return a[Math.floor(Math.random()*a.length)].replace("[zoom]",r.toString()).replace("[x]",i.toString()).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=H.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=H.stringToByteArray(t+"/"+e+"/"+r+".png"),a=0;a<n.length;a++)n[a]^=i[a%n.length];return btoa(H.byteArrayToString(n))},t.buttonDown=0,t.prevPtrCoords=[0,0],t.gisTolerance=2,t.tileImageSize=256,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),nt=function(){function t(){}return t.createMarkupPipe=function(t){var e=W.cloneElementWithId("markup-pipe"),r=t+"basepath";W.findChildOfType(e,"basepath").firstElementChild.id=r;var i=W.findChildOfType(e,"pipe"),n=W.findChildOfType(e,"inner-pipe"),a=W.findChildOfType(e,"bubbles"),o="#"+r;return i.setAttributeNS(W.xlinkns,"href",o),n.setAttributeNS(W.xlinkns,"href",o),a.setAttributeNS(W.xlinkns,"href",o),e},t.updateMarkupPipe=function(t,e,r){for(var i,n=W.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=W.findChildOfType(t,"batches"),s=W.findChildOfType(t,"bubbles"),l=0;l<e.length;l++)switch(e[l]){case"phase":s.setAttribute("stroke-dashoffset",(12-parseFloat(r[l])).toString());break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=W.childElements(o)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=o.childElementCount,m=p;m<f;m++)W.removeElement(o,o.lastElementChild);for(m=f;m<p;m++)d=W.createUseElement(a),o.appendChild(d);break;case"d":var g=parseFloat(W.findChildOfType(t,"pipe").getAttribute("stroke-width")),v=H.roundPathCorners(r[l],2*g,!1);n.setAttribute("d",v);break;case"width":var b=parseFloat(r[l]);W.findChildOfType(t,"pipe").setAttribute("stroke-width",b.toString()),W.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*b).toString()),o.setAttribute("stroke-width",(.6*b).toString());var y=Math.min(5,.2*b);s.setAttribute("stroke-width",y.toString()),s.setAttribute("stroke-dasharray",y+","+(12-y));break;case"color":W.findChildOfType(t,"pipe").setAttribute("stroke",r[l]);break;case"inner-color":W.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[l]);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupStorageTank=function(){return W.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=W.findChildOfType(t,"square"),n=W.findChildOfType(t,"batches"),a=parseFloat(i.getAttribute("width")),o=0;o<e.length;o++)switch(e[o]){case"batch":var s=r[o].split(" "),l=parseFloat(s[1])*a,u=parseFloat(s[2])*a,c=W.childElements(n)[parseInt(s[0])];H.setMultipleAttributes(c,["y","height","fill"],[a/2-l-u,u,s[3]]);break;case"newbatches":for(var h=parseInt(r[o]),d=n.childElementCount,p=h;p<d;p++)W.removeElement(n,n.lastElementChild);for(p=d;p<h;p++)c=W.createSvgElement("rect"),H.setMultipleAttributes(c,["stroke","width","x"],["none",a,-a/2]),n.appendChild(c);break;case"progress":var f=parseFloat(r[o])*Math.PI*2,m=parseFloat(W.findChildOfType(t,"circle").getAttribute("r"))-2,g=m*Math.sin(f),v=-m*Math.cos(f),b="M 0 "+-m+" ";b+="A "+m+" "+m+" 0 "+(f>Math.PI?"1":"0")+" 1 "+g+" "+v,W.findChildOfType(t,"arc").setAttribute("d",b);break;case"radius":W.findChildOfType(t,"circle").setAttribute("r",r[o]),a=Math.max(10,2*parseFloat(r[o])/Math.sqrt(2)-8),H.setMultipleAttributes(i,["width","height","x","y"],[a,a,-a/2,-a/2]);break;case"color":W.findChildOfType(t,"circle").setAttribute("fill",r[o]);break;case"stroke-color":W.findChildOfType(t,"circle").setAttribute("stroke",r[o]),W.findChildOfType(t,"square").setAttribute("stroke",r[o]);break;default:t.setAttribute(e[o],r[o])}},t.createMarkupBulkConveyorBelt=function(t){var e=W.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";W.findChildOfType(e,"basepath").firstElementChild.id=r;var i=W.findChildOfType(e,"belt"),n=W.findChildOfType(e,"belt-sections"),a="#"+r;return i.setAttributeNS(W.xlinkns,"href",a),n.setAttributeNS(W.xlinkns,"href",a),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,n=W.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=W.findChildOfType(t,"belt-sections"),s=W.findChildOfType(t,"batches"),l=0;l<e.length;l++)switch(e[l]){case"phase":o.setAttribute("stroke-dashoffset",r[l]);break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=W.childElements(s)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=s.childElementCount,m=p;m<f;m++)W.removeElement(s,s.lastElementChild);for(m=f;m<p;m++)d=W.createUseElement(a),s.appendChild(d);break;case"d":n.setAttribute("d",r[l]);break;case"width":var g=r[l];W.findChildOfType(t,"belt").setAttribute("stroke-width",g),o.setAttribute("stroke-width",g),o.setAttribute("stroke-dasharray","2, 10"),s.setAttribute("stroke-width",(.4*parseFloat(g)).toString());break;case"color":W.findChildOfType(t,"belt").setAttribute("stroke",r[l]);break;case"sections-color":o.setAttribute("stroke",r[l]);break;default:t.setAttribute(e[l],r[l])}},t}(),at=function(){function t(){}return t.createMarkupPath=function(t,e){var r=W.cloneElementWithId("markup-path"),i=e+"basepath";W.findChildOfType(r,"basepath").firstElementChild.id=i;var n=W.findChildOfType(r,"paths"),a=1;"MarkupPathRoad"==t&&(a=2),"MarkupPathRailroad"==t&&(a=4);for(var o=0;o<a;o++){var s=W.createUseElement(i);n.appendChild(s)}var l=W.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(n.firstElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","white")):"MarkupPathRoad"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","white"),l.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(n.firstElementChild.setAttribute("stroke","gray"),W.childElements(n)[1].setAttribute("stroke","black"),W.childElements(n)[2].setAttribute("stroke","white"),n.lastElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),n=W.findChildOfType(t,"basepath").firstElementChild,a=W.findChildOfType(t,"paths"),o=a.firstElementChild,s=W.findChildOfType(t,"arrows"),l=0;l<e.length;l++)switch(e[l]){case"d":n.setAttribute("d",r[l]);break;case"bidirectional":W.removeAllChildren(s),"false"==r[l]&&H.addPathArrows(n,"arrowhead",1.7,s,50,100);break;case"stroke-width":var u=parseFloat(r[l]);switch(i){case"MarkupPathLine":o.setAttribute("stroke-width",u.toString());break;case"MarkupPathDashline":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",4*u+" "+u);break;case"MarkupPathConveyor":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",u/2+" "+u/10);break;case"MarkupPathRoad":o.setAttribute("stroke-width",u.toString());var c=a.lastElementChild;c.setAttribute("stroke-width",(u/12).toString()),c.setAttribute("stroke-dasharray",u/2+" "+u/5);break;case"MarkupPathRailroad":var h=u/10+" "+u/2.5;o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",h),W.childElements(a)[1].setAttribute("stroke-width",(u/2+u/12).toString()),W.childElements(a)[2].setAttribute("stroke-width",(u/2).toString());var d=a.lastElementChild;d.setAttribute("stroke-width",(u/2).toString()),d.setAttribute("stroke-dasharray",h)}break;case"stroke":o.setAttribute("stroke",r[l]),u=parseFloat(o.getAttribute("stroke-width")),s.setAttribute("stroke",u>4?"white":r[l]);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupAreaNode=function(t){var e,r=W.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=W.createSvgElement("rect");break;case"MarkupPolygonalNode":e=W.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:i.setAttribute(e[n],r[n])}},t.createMarkupPalletRack=function(){return W.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"stroke":n.setAttribute(e[a],r[a]);break;case"fill":i.setAttribute(e[a],r[a]);break;case"rack-data":W.removeAllChildren(i),W.removeAllChildren(n);var o=r[a].split(" "),s=parseInt(o[0]),l=parseInt(o[1]),u=parseFloat(o[2]),c=parseFloat(o[3]),h=parseFloat(o[4]),d=void 0,p=void 0,f=void 0;s>1&&(d=parseFloat(o[5]),p=parseFloat(o[6]),f=c+d);var m=W.createSvgElement("rect");if(m.setAttribute("width",u.toString()),m.setAttribute("height",c.toString()),i.appendChild(m),s>1){var g=W.createSvgElement("rect");g.setAttribute("width",u.toString()),g.setAttribute("height",p.toString()),g.setAttribute("transform","translate( 0 "+f+")"),i.appendChild(g)}for(var v=h,b=0;b<l-1;b++){var y=W.createSvgElement("line");H.setMultipleAttributes(y,["x1","x2","y1","y2"],[v,v,"0",c]),n.appendChild(y),v+=h}if(s>1){var A=f+p;v=h;for(b=0;b<l-1;b++){y=W.createSvgElement("line");H.setMultipleAttributes(y,["x1","x2","y1","y2"],[v,v,f,A]),n.appendChild(y),v+=h}}break;default:t.setAttribute(e[a],r[a])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),ot=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=W.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=W.createSvgElement("path");break;case"MarkupCircularWall":r=W.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=W.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupTargetLine=function(){return W.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var n=W.findChildOfType(e,"polyline"),a=W.findChildOfType(e,"serif-start"),o=W.findChildOfType(e,"serif-end"),s=0;s<r.length;s++)switch(r[s]){case"color":e.setAttribute("stroke",i[s]);break;case"points":n.setAttribute(r[s],i[s]);var l=i[s].split(" "),u=l.length;l[u-1].includes(",")||u--,t.setSerif(l[0],l[1],a),t.setSerif(l[u-1],l[u-2],o);break;default:e.setAttribute(r[s],i[s])}},t.createMarkupPathway=function(){return W.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=W.findChildOfType(t,"polygon"),n=W.findChildOfType(t,"polyline"),a=W.findChildOfType(t,"ties"),o=0;o<e.length;o++)switch(e[o]){case"color":a.setAttribute("stroke",r[o]);break;case"points":var s=r[o].split(" "),l="",u="",c="";W.removeAllChildren(a);for(var h=0;h<s.length;h++){var d=H.splitToFloats(s[h],",");if(4==d.length){l+=d[0]+","+d[1]+" ",u=d[2]+","+d[3]+" "+u,c+=(d[0]+d[2])/2+","+(d[1]+d[3])/2+" ";var p=W.createSvgElement("line");H.setMultipleAttributes(p,["x1","y1","x2","y2"],[d[0],d[1],d[2],d[3]]),a.appendChild(p)}}i.setAttribute("points",l+u),n.setAttribute("points",c);break;default:t.setAttribute(e[o],r[o])}},t.createMarkupPedFlowStatistics=function(){return W.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=W.findChildOfType(t,"line"),n=W.findChildOfType(t,"serif-end"),a=W.findChildOfType(t,"direction"),o=W.findChildOfType(t,"arrow-right"),s=W.findChildOfType(t,"arrow-left"),l=0;l<e.length;l++)switch(e[l]){case"color":t.setAttribute("stroke",r[l]);break;case"length":i.setAttribute("x2",r[l]),n.setAttribute("x1",r[l]),n.setAttribute("x2",r[l]);var u=parseInt(r[l])/2;a.setAttribute("x1",u.toString()),a.setAttribute("x2",u.toString()),o.setAttribute("transform","translate("+u+" 13) rotate(90)"),s.setAttribute("transform","translate("+u+" -13) rotate(-90)");break;case"direction":switch(o.setAttribute("visibility","inherit"),s.setAttribute("visibility","inherit"),r[l]){case"right":s.setAttribute("visibility","hidden");break;case"left":o.setAttribute("visibility","hidden")}break;default:t.setAttribute(e[l],r[l])}},t.createMarkupServiceWithLines=function(){return W.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var n=W.findChildOfType(e,"queues"),a=W.findChildOfType(e,"services"),o=W.findChildOfType(e,"reverse-queues"),s=W.findChildOfType(e,"area"),l=0;l<r.length;l++)switch(r[l]){case"queue-color":n.setAttribute("stroke",i[l]);break;case"reverse-queue-color":o.setAttribute("stroke",i[l]);break;case"service-color":a.setAttribute("stroke",i[l]);break;case"clear-all-queues":W.removeAllChildren(n),W.removeAllChildren(o);break;case"queue":t.addQueue(n,i[l]);break;case"reverse-queue":t.addQueue(o,i[l]);break;case"clear-services":W.removeAllChildren(a);break;case"service":t.addService(a,i[l]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":s.setAttribute(r[l],i[l]);break;default:e.setAttribute(r[l],i[l])}},t.createMarkupServiceWithArea=function(){return W.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var n=W.findChildOfType(e,"services"),a=0;a<r.length;a++)switch(r[a]){case"service-color":n.setAttribute("stroke",i[a]);break;case"clear-services":W.removeAllChildren(n);break;case"service":t.addService(n,i[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":break;default:e.setAttribute(r[a],i[a])}},t.createMarkupEscalatorGroup=function(){return W.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=W.findChildOfType(t,"background"),n=W.findChildOfType(t,"escalators"),a=0;a<e.length;a++)switch(e[a]){case"balustrade-color":i.setAttribute("fill",r[a]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[a]?"inherit":"hidden");break;case"dimensions-completed":var o=H.getIntAttribute(t,"number-of-escalators"),s=H.getFloatAttribute(t,"width"),l=H.getFloatAttribute(t,"length"),u=H.getFloatAttribute(t,"left-balustrade-width"),c=H.getFloatAttribute(t,"right-balustrade-width"),h=H.getFloatAttribute(t,"internal-balustrade-width"),d=H.getFloatAttribute(t,"lower-landing-length"),p=u+c+o*s+(o-1)*h,f=d+l+H.getFloatAttribute(t,"upper-landing-length");H.setMultipleAttributes(i,["y","width","height"],[-u,f,p]);for(var m=0;m<o;m++){var g=m*(s+h),v=W.cloneElementWithId("escalator"),b=W.findChildOfType(v,"background");H.setMultipleAttributes(b,["y","width","height"],[g,f,s]);var y=W.findChildOfType(v,"handrail-left"),A=W.findChildOfType(v,"handrail-right");H.setMultipleAttributes(y,["x2","y1","y2"],[f,g,g]),H.setMultipleAttributes(A,["x2","y1","y2"],[f,g+s,g+s]);var T=W.findChildOfType(v,"lower-landing-end"),C=W.findChildOfType(v,"upper-landing-end");H.setMultipleAttributes(T,["x1","x2","y1","y2"],[d,d,g,g+s]),H.setMultipleAttributes(C,["x1","x2","y1","y2"],[d+l,d+l,g,g+s]);var S=W.findChildOfType(v,"stairs");H.setMultipleAttributes(S,["x1","x2","y1","y2","stroke-width"],[d,d+l,g+s/2,g+s/2,s]),n.appendChild(v)}break;case"offsets":var E=H.splitToFloats(r[a]," "),w=W.childElements(n);for(m=0;m<w.length;m++)W.findChildOfType(w[m],"stairs").setAttribute("stroke-dashoffset",(-E[m]).toString());break;default:t.setAttribute(e[a],r[a])}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),a=parseFloat(i[0]),o=parseFloat(i[1]),s=parseFloat(n[0])-a,l=parseFloat(n[1])-o,u=Math.hypot(s,l),c=3*l/u,h=3*s/u;H.setMultipleAttributes(r,["x1","x2","y1","y2"],[a+c,a-c,o-h,o+h])},t.addService=function(t,e){var r,i=e.split(" "),n=parseFloat(H.getSubAttribute(i,"x")),a=parseFloat(H.getSubAttribute(i,"y")),o=H.radiansToDegrees(parseFloat(H.getSubAttribute(i,"orientation")));if("point"==H.getSubAttribute(i,"type")){(r=W.createUseElement("service-point")).setAttribute("transform","translate("+n+" "+a+")");var s=W.createUseElement("arrowhead-small");s.setAttribute("transform","translate("+(n-11)+" "+a+") rotate("+o+" 11 0)"),t.appendChild(s)}else{(r=W.cloneElementWithId("service-line")).setAttribute("transform","translate("+n+" "+a+") rotate("+o+")");var l=r.firstElementChild.nextElementSibling,u=parseFloat(H.getSubAttribute(i,"length"));if(l.setAttribute("x2",u),"true"==H.getSubAttribute(i,"bidirectional")){var c=r.lastElementChild;c.setAttribute("visibility","inherit"),c.setAttribute("transform","translate("+(u+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=H.splitSkipEmpty(e,"|"),i=H.getSubAttribute(r,"queue-path"),n=W.createSvgElement("path");n.setAttribute("d",i),t.appendChild(n),H.addPathArrows(n,"arrowhead-small",.7,t,50,100);var a=H.getSubAttribute(r,"fence-color");if(a)for(var o=[H.getSubAttribute(r,"fence-path-left"),H.getSubAttribute(r,"fence-path-right")],s=0;s<o.length;s++){var l=W.createSvgElement("path");H.setMultipleAttributes(l,["d","stroke","stroke-width","stroke-dasharray"],[o[s],a,"2","none"]),t.appendChild(l)}},t}(),st=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return W.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return W.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i])},t}(),lt=function(){function t(){}return t.createMarkupIntersection=function(){return W.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,n=W.findChildOfType(t,"lane-connectors"),a=0;a<e.length;a++)switch(e[a]){case"fill":case"d":i.setAttribute(e[a],r[a]);break;case"lane-connector":var o=W.createSvgElement("g"),s=W.createSvgElement("path");s.setAttribute("d",r[a]),o.appendChild(s),H.addPathArrows(s,"arrowhead-tiny",.5,o,20,40),n.appendChild(o);break;case"lane-connector-colors":for(var l=H.splitSkipEmpty(r[a]," "),u=W.childElements(n),c=0;c<u.length;c++)u[c].setAttribute("stroke",l[c]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupRoad=function(){return W.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var n=W.findChildOfType(e,"lanes"),a=W.findChildOfType(e,"delimiters"),o=W.findChildOfType(e,"median"),s=0;s<r.length;s++)switch(r[s]){case"lane-width":n.setAttribute("stroke-width",i[s]);break;case"lane-color":n.setAttribute("stroke",i[s]);break;case"forward-lane":case"backward-lane":var l=W.createSvgElement("path");l.setAttribute("d",i[s]),n.appendChild(l);break;case"lane-delimiter-color":a.setAttribute("stroke",i[s]);break;case"lane-delimiter-width":case"lane-delimiter-style":a.setAttribute(r[s],i[s]);break;case"lane-delimiter":var u=H.getFloatAttribute(a,"lane-delimiter-width"),c=a.getAttribute("lane-delimiter-style");t.addDelimiter(a,u,c,i[s],n.getAttribute("stroke"));break;case"median-color":o.setAttribute("stroke",i[s]);break;case"median-width":case"median-style":o.setAttribute(r[s],i[s]);break;case"median":u=H.getFloatAttribute(o,"median-width"),c=o.getAttribute("median-style"),t.addDelimiter(o,u,c,i[s],n.getAttribute("stroke"));break;default:e.setAttribute(r[s],i[s])}},t.addDelimiter=function(t,e,r,i,n){var a=r.includes("DASHED"),o=r.includes("DOUBLE"),s=W.createSvgElement("path");if(s.setAttribute("d",i),s.setAttribute("stroke-width",(o?3*e:e).toString()),a&&s.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(s),o){var l=W.createSvgElement("path");H.setMultipleAttributes(l,["d","stroke-width","stroke"],[i,e,n]),t.appendChild(l)}},t.createMarkupStopLine=function(){return W.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:t.setAttribute(e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return W.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t}(),ut=function(){function t(e){this.serverFPS=t.MAX_FPS,this.client=e,this.chart=new tt(this),this.control=new X(this),this.shapeComposite=new V(this),this.shapeGISMap=new it(this)}return t.prototype.start=function(){this.frameDrawStartTime=Date.now(),this.catchingUp=!1,this.frameCount=0,this.fpsMeasureStartTime=null,this.actualFPS=0,this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.fullFrame=!1,this.packetFPS=t.MAX_FPS,this.desiredFPS=t.MAX_FPS,this.frameBuffer=[],this.sleepTimeStatistics=new Array(t.SLEEP_TIME_STATISTICS_SIZE),this.sleepTimeStatistics.fill(1e3/t.MAX_FPS),this.startMeasureInterval(),this.startFrameDrawingTimeout(this.desiredFPS)},t.prototype.stop=function(){this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.frameBuffer=[],this.stopMeasureInterval(),this.stopFrameDrawingTimeout()},t.prototype.startMeasureInterval=function(){var t=this;this.fpsMeasureIntervalId=setInterval(function(){return t.measureFPS()},1e3)},t.prototype.stopMeasureInterval=function(){this.fpsMeasureIntervalId&&(clearInterval(this.fpsMeasureIntervalId),this.fpsMeasureIntervalId=void 0)},t.prototype.startFrameDrawingTimeout=function(t){var e=this;this.frameDrawingTimeoutId=setTimeout(function(){var t=Date.now();e.drawFrame();var r=1e3/e.desiredFPS-(Date.now()-t);r<0&&(r=0),e.sleepTimeStatistics.push(r),e.sleepTimeStatistics.shift(),e.startFrameDrawingTimeout(r)},t)},t.prototype.stopFrameDrawingTimeout=function(){this.frameDrawingTimeoutId&&(clearTimeout(this.frameDrawingTimeoutId),this.frameDrawingTimeoutId=void 0)},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.totalFrameCount=function(){var t=this.frameBuffer.length;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.findOrRequestFullFrame=function(){if(this.fullFrame)console.log("Found a full frame in the local buffer, starting from there");else{for(var t=0;t<this.packetBuffer.length;t++){if(this.packetBuffer[t].fullFrame)return console.log("Found a full frame in the local buffer, starting from there"),void this.packetBuffer.splice(0,t)}this.packetBuffer=[],console.log("Cleared local frame buffer, requesting full frame from the server"),this.client.network.requestAndWaitFullFrame()}},t.prototype.switchToNextFrame=function(){if(0==this.frameBuffer.length){if(0==this.packetBuffer.length)return this.fullFrame=!1,this.packetFPS=t.MAX_FPS,void(this.desiredFPS=t.MAX_FPS);var e=this.packetBuffer.shift();this.frameBuffer=e.frames,this.fullFrame=e.fullFrame,this.packetFPS=e.fps,this.desiredFPS=e.fps,this.updateServerFpsIfNeeded()}return this.frameBuffer.shift()},t.prototype.updateServerFpsIfNeeded=function(){var e=this.actualFPS/this.packetFPS,r=this.measureSleepTime();if(e>=.9&&r>50&&this.serverFPS<t.MAX_FPS)return this.serverFPS++,void this.client.network.postMaxFPS(this.serverFPS);e<.9&&r<50&&this.serverFPS>1&&(this.serverFPS--,e<.7&&this.serverFPS>1&&this.serverFPS--,e<.6&&this.serverFPS>1&&this.serverFPS--,this.client.network.postMaxFPS(this.serverFPS))},t.prototype.measureSleepTime=function(){for(var t=0,e=0;e<this.sleepTimeStatistics.length;e++)t+=this.sleepTimeStatistics[e];return t/=this.sleepTimeStatistics.length},t.prototype.drawFrame=function(){var e=this.switchToNextFrame();if(e){this.client.updateExperimentState(e),this.fullFrame&&(this.fullFrame=!1,W.removeAllChildren(this.client.presentation)),this.frameDrawStartTime=Date.now(),this.client.svg.suspendRedraw(5e3),this.time=e.time;var r,i,n,a=e.commands;if(a.length>0&&"white"!=this.client.svg.style.backgroundColor&&(this.client.svg.style.backgroundColor="white"),mt.DEBUG_MODE){var o=this.totalFrameCount();this.client.debugger.timeInfo.innerHTML=H.formatNumber(this.time,2),this.client.debugger.serverQueueInfo.innerHTML=this.client.network.serverQueue,this.client.debugger.browserQueueInfo.innerHTML=o+":"+this.client.network.packetManager.totalFrameCount(),r=0,i=0,n=0}for(var s=0;s<a.length;s++){var l=a[s],u=void 0,c=l.groupId,h=l.att,d=l.val,p=void 0;switch(l.cmd){case"C":if(p=this.createShape(l.type,l.id),null==c)this.client.presentation.appendChild(p);else{if(null==(u=document.getElementById(c)))return console.log("Can't find container to add a shape to, container id = "+c,l),void this.findOrRequestFullFrame();if("ShapeGISMap"==u.getAttribute("type")){var f=W.findChildOfType(u,"map").firstElementChild;u=l.type.startsWith("MarkupGIS")?W.findChildOfType(f,"markup"):W.findChildOfType(f,"agents")}u.appendChild(p)}this.updateShape(p,h,d),r++;break;case"U":if(null==(p=document.getElementById(l.id)))return console.log("Can't find shape to be updated, shape id = "+l.id,l),void this.findOrRequestFullFrame();this.updateShape(p,h,d),i++;break;case"D":if(null==(p=document.getElementById(l.id)))return console.log("Can't find shape to be deleted, shape id = "+l.id,l),void this.findOrRequestFullFrame();W.removeElement(p.parentNode,p),n++;break;case"S":this.applySettings(h,d);break;case"N":this.applyNavigation(h,d);break;case"M":t.showMessage(h,d);break;case"W":t.openURL(h,d);break;default:return void this.client.stopAndAlert("Unknown command: "+l.cmd,null)}}this.client.svg.unsuspendRedrawAll(),this.frameCount++,mt.DEBUG_MODE&&(this.client.debugger.cudCountInfo.innerHTML=r+"/"+i+"/"+n,this.client.debugger.drawTimeInfo.innerHTML=Date.now()-this.frameDrawStartTime,this.client.debugger.shapeCountInfo.innerHTML=z.elementcount),!this.catchingUp&&this.packetBuffer.length>1?(this.catchingUp=!0,this.desiredFPS=1e3/this.packetFPS*.8):this.catchingUp&&(this.catchingUp=!1,this.desiredFPS=1e3/this.packetFPS)}},t.prototype.createShape=function(t,e){var r;if(W.isPrimitiveSVGElement(t))r=W.createSvgElement(t);else switch(t){case"ShapeArc":r=V.createShapeArc();break;case"ShapeText":r=V.createShapeText();break;case"ShapeImage":r=V.createShapeImage();break;case"ShapeCanvas":r=V.createShapeCanvas(e);break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=at.createMarkupPath(t,e);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=at.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=at.createMarkupPalletRack();break;case"MarkupRailwaySwitch":r=st.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=st.createMarkupPositionOnTrack();break;case"MarkupPipe":r=nt.createMarkupPipe(e);break;case"MarkupStorageTank":r=nt.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=nt.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=ot.createMarkupWall(t,e);break;case"MarkupTargetLine":r=ot.createMarkupTargetLine();break;case"MarkupPathway":r=ot.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=ot.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=ot.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=ot.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=ot.createMarkupEscalatorGroup();break;case"MarkupIntersection":r=lt.createMarkupIntersection();break;case"MarkupRoad":r=lt.createMarkupRoad();break;case"MarkupStopLine":r=lt.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=lt.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=rt.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=tt.create();break;case"Window3D":r=Y.create();break;default:return this.client.stopAndAlert("Can't create: unknown object type: "+t,void 0),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(t,e,r){var i=t.getAttribute("type");if(W.isPrimitiveSVGElement(i))for(var n=0;n<e.length;n++)if("href"==e[n])t.setAttributeNS(W.xlinkns,"href",r[n]);else if("href-path"==e[n])t.setAttributeNS(W.xlinkns,"href",this.client.network.getJarResourceURL(r[n]));else if("geo"==e[n]){var a=r[n].split("|");t.setAttribute("lon",a[0]),t.setAttribute("lat",a[1]),t.setAttribute("heading",a[2]),it.updateGISObjectPosition(t)}else t.setAttribute(e[n],r[n]);else switch(i){case"ShapeArc":V.updateShapeArc(t,e,r);break;case"ShapeText":V.updateShapeText(t,e,r);break;case"ShapeImage":this.shapeComposite.updateShapeImage(t,e,r);break;case"ShapeCanvas":V.updateShapeCanvas(t,e,r);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(t,e,r);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(t,e,r);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":at.updateMarkupPath(t,e,r);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":at.updateMarkupAreaNode(t,e,r);break;case"MarkupPalletRack":at.updateMarkupPalletRack(t,e,r);break;case"MarkupRailwaySwitch":st.updateMarkupRailwaySwitch(t,e,r);break;case"MarkupPositionOnTrack":st.updateMarkupPositionOnTrack(t,e,r);break;case"MarkupPipe":nt.updateMarkupPipe(t,e,r);break;case"MarkupStorageTank":nt.updateMarkupStorageTank(t,e,r);break;case"MarkupBulkConveyorBelt":nt.updateMarkupBulkConveyorBelt(t,e,r);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":ot.updateMarkupWall(t,e,r);break;case"MarkupTargetLine":ot.updateMarkupTargetLine(t,e,r);break;case"MarkupPathway":ot.updateMarkupPathway(t,e,r);break;case"MarkupPedFlowStatistics":ot.updateMarkupPedFlowStatistics(t,e,r);break;case"MarkupServiceWithLines":ot.updateMarkupServiceWithLines(t,e,r);break;case"MarkupServiceWithArea":ot.updateMarkupServiceWithArea(t,e,r);break;case"MarkupEscalatorGroup":ot.updateMarkupEscalatorGroup(t,e,r);break;case"MarkupIntersection":lt.updateMarkupIntersection(t,e,r);break;case"MarkupRoad":lt.updateMarkupRoad(t,e,r);break;case"MarkupStopLine":lt.updateMarkupStopLine(t,e,r);break;case"MarkupBusStop":case"MarkupParkingLot":lt.updateMarkupBusStopOrParkingLot(t,e,r);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":rt.updateGISMarkup(t,e,r);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(t,e,r);break;case"Window3D":Y.update(t,e,r)}},t.prototype.measureFPS=function(){var t=Date.now();null!=this.fpsMeasureStartTime&&(this.actualFPS=Math.round(1e3*this.frameCount/(t-this.fpsMeasureStartTime))),mt.DEBUG_MODE&&(this.client.debugger.fpsInfo.innerHTML=this.actualFPS+":"+this.packetFPS),this.fpsMeasureStartTime=t,this.frameCount=0},t.prototype.onControlAction=function(t,e){this.client.network.postUserAction(t,e)},t.prototype.onUserClick=function(t,e,r){W.isContainedInElementOfType(t,X.controlTypes)||W.isContainedInElementOfType(t,tt.chartTypes)||W.isContainedInElementOfType(t,["Window3D"])||W.isContainedInElementOfType(t,["ShapeGISMap"])||this.client.network.postUserAction(0,e+" "+r)},t.prototype.applySettings=function(t,e){for(var r=0;r<t.length;r++)this.modelSettings[H.hyphenToCameLCase(t[r])]=e[r];this.modelSettings.startTime=parseInt(this.modelSettings.startTime),this.modelSettings.startDate=parseInt(this.modelSettings.startDate),this.modelSettings.stopTime&&(this.modelSettings.stopTime=parseInt(this.modelSettings.startTime),this.modelSettings.stopDate=parseInt(this.modelSettings.startDate))},t.prototype.applyNavigation=function(t,e){for(var r=0;r<t.length;r++)this.navigationSettings[H.hyphenToCameLCase(t[r])]=e[r];this.navigationSettings.x=parseFloat(this.navigationSettings.x),this.navigationSettings.y=parseFloat(this.navigationSettings.y),this.navigationSettings.width=parseFloat(this.navigationSettings.width),this.navigationSettings.height=parseFloat(this.navigationSettings.height),this.navigationSettings.zoomAndPanningEnabled="true"==this.navigationSettings.zoomAndPanningEnabled,this.client.setNavigationSettings(this.navigationSettings.width,this.navigationSettings.height),this.client.navigation.applyNavigationSettings()},t.showMessage=function(t,e){for(var r={},i=0;i<t.length;i++)r[H.hyphenToCameLCase(t[i])]=e[i];var n=document.getElementById("svg-message-background"),a=document.getElementById("svg-message-box-title"),o=document.getElementById("svg-message-box-text"),s=document.getElementById("svg-message-box-icon-info"),l=document.getElementById("svg-message-box-icon-error");a.innerText=r.title,o.innerHTML=r.text.replace(/\n/g,"<br>"),r.type.startsWith("error")?(s.style.display="none",l.style.removeProperty("display"),a.classList.remove("svg-message-box-colors-info"),a.classList.add("svg-message-box-colors-error"),""==r.title&&(a.innerHTML="Error")):(s.style.removeProperty("display"),l.style.display="none",a.classList.remove("svg-message-box-colors-error"),a.classList.add("svg-message-box-colors-info"),""==r.title&&(a.innerHTML="Message")),n.style.removeProperty("display")},t.openURL=function(e,r){var i=r[0];i.startsWith("http://")&&i.startsWith("https://")||(i="http://"+i);var n=["message","Open URL","The model asks you to open an external URL:<br><a href="+i+" target = '_blank' onclick = 'document.getElementById( \"svg-message-background\" ).style.display = \"none\"'>"+i+"</a><br><br>The URL will open in a new window"];t.showMessage(["type","title","text"],n)},t.SLEEP_TIME_STATISTICS_SIZE=20,t.MAX_FPS=20,t}(),ct=function(){function t(t,e,r){var i=this;this.networkManager=t,this.startTime=Date.now(),this.xhttp=this.networkManager.getAnimationPacket(e,function(){i.stopTime=Date.now(),r(i)})}return t.prototype.requestTime=function(){return this.stopTime?this.stopTime-this.startTime:Date.now()-this.startTime},t.prototype.abort=function(){this.xhttp.abort()},t}(),ht=function(){function t(t){this.paused=!1,this.networkManager=t}return t.prototype.start=function(){this.fullFrame=!0,this.activeRequests=[],this.responseTimeStatistics=new Array(t.REQUEST_STATISTICS_SIZE),this.responseTimeStatistics.fill(pt.MIN_REQUEST_INTERVAL),this.requestInterval=pt.MIN_REQUEST_INTERVAL,this.lastRequestTime=0,this.createRequest(),this.startRequestTimeout()},t.prototype.stop=function(){this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.pause=function(){this.paused=!0,this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.requestFullFrame=function(){console.debug(">> SVG: Request full frame."),this.fullFrame=!0},t.prototype.startRequestTimeout=function(){var t=this;this.requestTimeoutId=setTimeout(function(){t.processRequestTimeout()},this.requestInterval)},t.prototype.processRequestTimeout=function(){this.requestTimeoutId=void 0,this.activeRequests.length<pt.MAX_REQUEST_COUNT&&(this.createRequest(),this.startRequestTimeout())},t.prototype.createRequest=function(){var t=this,e=new ct(this.networkManager,this.fullFrame,function(e){return t.processResponse(e)});this.fullFrame=!1,this.activeRequests.push(e),this.lastRequestTime=Date.now()},t.prototype.processResponse=function(t){var e=this.activeRequests.indexOf(t);if(this.activeRequests.splice(e,1),this.addToResponseTimeStatistics(t.requestTime()),void 0!==this.requestTimeoutId||this.paused||(this.createRequest(),this.startRequestTimeout()),4==t.xhttp.readyState&&200==t.xhttp.status){var r=JSON.parse(t.xhttp.responseText);this.networkManager.packetManager.addPacket(r)}},t.prototype.addToResponseTimeStatistics=function(t){this.responseTimeStatistics.push(t),this.responseTimeStatistics.shift(),this.requestInterval=this.calculateRequestInterval(),this.networkManager.RPS=1e3/this.requestInterval},t.prototype.calculateRequestInterval=function(){if(0===this.responseTimeStatistics.length)return pt.MIN_REQUEST_INTERVAL;for(var t=0,e=0;e<this.responseTimeStatistics.length;e++)t+=this.responseTimeStatistics[e];var r=t/this.responseTimeStatistics.length*.5;return r<pt.MIN_REQUEST_INTERVAL?pt.MIN_REQUEST_INTERVAL:r>pt.MAX_REQUEST_INTERVAL?pt.MAX_REQUEST_INTERVAL:r},t.REQUEST_STATISTICS_SIZE=10,t}(),dt=function(){function t(t){this.client=t,this.reset()}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.waitingFullFrame=!1,this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.pause=function(){this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.addPacket=function(t){if(t){var e=t.frames;if(e&&0!==e.length){var r=e[0];if(!(r.number<this.expectedFrameNumber)){if(r.number===this.expectedFrameNumber||t.fullFrame){this.client.network.serverQueue=t.serverQueue;var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),this.cancelWaitExpectedFrameTimeoutIfNeeded(),void(t.fullFrame&&(this.waitingFullFrame=!1))}this.insertToPacketBuffer(t),console.debug(">> SVG: Reordering  or packet loss expectedFrame=",this.expectedFrameNumber),this.startWaitExpectedFrameTimeoutIfNeeded()}}}},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length&&!(this.packetBuffer[0].frames[0].number>=this.expectedFrameNumber)){var t=this.packetBuffer[this.packetBuffer.length-1];if(t.frames[t.frames.length-1].number>=this.expectedFrameNumber)this.packetBuffer=[];else{for(var e=0;e<this.packetBuffer.length&&!(this.packetBuffer[e].frames[0].number>=this.expectedFrameNumber);e++);this.packetBuffer.splice(0,e)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length&&this.packetBuffer[0].frames[0].number===this.expectedFrameNumber){for(var t=this.expectedFrameNumber,e=0;e<this.packetBuffer.length;e++){var r=this.packetBuffer[e].frames;if(r[0].number!==t)break;t=r[r.length-1].number+1}var i=this.packetBuffer.splice(0,e);this.client.frameDrawing.addAllPackets(i),this.expectedFrameNumber=t}},t.prototype.cancelWaitExpectedFrameTimeoutIfNeeded=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startWaitExpectedFrameTimeoutIfNeeded=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,t.client.network.requestFullFrame()},4*this.client.network.RPS*1e3))},t.prototype.waitFullFrame=function(){console.debug(">> SVG: Wait full frame."),this.waitingFullFrame=!0,this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t}(),pt=function(){function t(t){this.client=t,this.packetRequester=new ht(this),this.packetManager=new dt(t)}return t.prototype.start=function(){this.packetManager.reset(),this.packetRequester.start()},t.prototype.stop=function(){this.packetRequester.stop(),this.packetManager.reset()},t.prototype.pause=function(){this.paused=!0,this.packetRequester.pause()},t.prototype.getAnimationPacket=function(t,e){if(!this.paused){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},mt.DEBUG_SPARK_LOCAL?r.open("GET","/http/update?fullFrame="+t+"&time="+Date.now(),!0):r.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+Date.now(),!0),r.send(),r}},t.prototype.postUserAction=function(t,e){if(!this.paused){var r=new XMLHttpRequest;mt.DEBUG_SPARK_LOCAL?r.open("GET","/http/useraction?id="+t+"&value="+encodeURIComponent(e)):r.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),r.send()}},t.prototype.postUserCommand=function(t,e){if(!this.paused){var r=new XMLHttpRequest;r.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),r.send()}},t.prototype.getJarResourceURL=function(t){return this.getResourceURLWithSubpath("internal-resources",t)},t.prototype.getResourceURL=function(t){return this.getResourceURLWithSubpath("resources",t)},t.prototype.getResourceURLWithSubpath=function(t,e){if(!this.paused)return mt.DEBUG_SPARK_LOCAL?"/http/image?path="+e:this.getRestRoot()+t+"?path="+e},t.prototype.getRestRoot=function(){return this.client.svgAnimationInfo.host+"/nodes/"+this.client.svgAnimationInfo.restUrl+"sessions/"+this.client.svgAnimationInfo.sessionUuid+"/"},t.prototype.postMaxFPS=function(t){if(!this.paused){var e=new XMLHttpRequest;mt.DEBUG_SPARK_LOCAL?e.open("POST","http/max-fps"):e.open("POST",this.getRestRoot()+"max-fps"),e.send(t.toString())}},t.prototype.requestFullFrame=function(){this.packetRequester.requestFullFrame()},t.prototype.requestAndWaitFullFrame=function(){this.packetRequester.requestFullFrame(),this.packetManager.waitFullFrame()},t.MIN_REQUEST_INTERVAL=500,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_REQUEST_COUNT=2,t}(),ft=function(){function t(e){var r=this;this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDebugContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDebugContainer.parentElement,this.controlPanel=document.getElementById("control-panel"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDebugTools=document.getElementById("control-panel-button-dev-panel"),this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpInfoState=document.getElementById("control-panel-info-state"),t.assignActionOnClick(this.cpButtonRun,function(){return r.client.network.postUserCommand("run","")}),t.assignActionOnClick(this.cpButtonPause,function(){return r.client.network.postUserCommand("pause","")}),t.assignActionOnClick(this.cpButtonX1,function(){return r.setSpeed(1)}),t.assignActionOnClick(this.cpButtonSlower,function(){return r.speedUpOrDown(!1)}),t.assignActionOnClick(this.cpButtonFaster,function(){return r.speedUpOrDown(!0)}),t.assignActionOnClick(this.cpButtonVirtual,function(){return r.setSpeed(1/0)}),this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},t.assignActionOnClick(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),E.addFullScreenListener(function(){return r.onFullScreenChange()}),this.cpButtonDebugTools.style.display="none"}return t.prototype.updateExperimentState=function(){this.updateInfoState(),this.updateModelTimeScale(),this.updateRunGroup(),this.updateSpeedGroup()},t.prototype.updateModelTimeScale=function(){this.cpInfoScale.innerText=t.timeScaleToString(this.client.getModelTimeScale())},t.prototype.updateExperimentProgress=function(){var t=this.client.getModelProgress(),e=this.progressBar.firstElementChild,r=100*t;this.progressBar.style.width=t<=0?"0":r+"%",e.innerText=t<0?"progress n/a":Math.round(r)+"%"},t.prototype.updateInfoState=function(){var e=this.client.getModelState(),r=t.modelStateToString(e);this.cpInfoState.innerText=t.modelStateToString(r),this.indicateCpErrorState("ERROR"==e)},t.prototype.indicateCpErrorState=function(t){t?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getModelState()&&this.indicateCpErrorState(!1)},t.prototype.updateRunGroup=function(){var e=this.client.getModelState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e;t.setVisible(this.cpButtonRun,!r),this.setEnabled(this.cpButtonRun,!r&&i),t.setVisible(this.cpButtonPause,r),this.setEnabled(this.cpButtonPause,r)},t.prototype.updateSpeedGroup=function(){var e=this.client.getModelState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e,i=t.stringToTimeScale(this.cpInfoScale.innerText);this.setEnabled(this.cpButtonX1,r&&1!=i),this.setEnabled(this.cpButtonSlower,r&&i>t.speeds[0]),this.setEnabled(this.cpButtonFaster,r&&i!=1/0),this.setEnabled(this.cpButtonVirtual,r&&i!=1/0)},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=p.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r)},t.prototype.setSpeed=function(e){this.cpInfoScale.innerText=t.timeScaleToString(e),this.client.network.postUserCommand("setspeed",e.toString()),this.updateSpeedGroup()},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=E.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed"))},t.prototype.toggleFullScreen=function(){E.toggleFullScreen(this.presentationContainer)},t.modelStateToString=function(t){switch(t){case"INITIALIZE":return"Initializing...";case"IDLE":return"Idle";case"RUNNING":return"Running";case"PAUSED":return"Paused";case"FINISHED":return"Finished.";case"ERROR":return"Error!";case"PLEASE_WAIT":return"Please Wait..."}return t},t.timeScaleToString=function(t){return t<0||t==1/0?"Virtual":t>=1?"x"+t:"x1/"+1/t},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.setVisible=function(t,e){e?t.style.removeProperty("display"):t.style.display="none"},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.assignActionOnClick=function(e,r){e.onclick=function(){t.isEnabled(e)&&r()}},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t}(),mt=function(){function t(){this.windowAdjusted=!1,this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new ut(this),this.navigation=new et(this),this.network=new pt(this),this.controlPanel=new ft(this)}return t.prototype.start=function(t){this.svgAnimationInfo=t,this.svg.style.pointerEvents="auto",this.navigation.initSVGNavigation(),this.network.start(),this.frameDrawing.start()},t.prototype.stop=function(t){t?(this.modelState=t.type,this.controlPanel.updateExperimentState()):this.modelState=void 0,this.frameDrawing.stop(),this.navigation.clearSVGNavigation(),this.network.stop(),this.onToggleFullScreen=void 0,this.onResize=void 0,this.onStop=void 0,this.windowAdjusted=!1,W.removeAllChildren(this.presentation)},t.prototype.setCallback=function(t,e){switch(t){case"ontogglefullscreen":this.onToggleFullScreen=e;break;case"onstop":this.onStop=e;break;case"onresize":this.onResize=e}},t.prototype.pause=function(){this.network.pause()},t.prototype.stopAndAlert=function(t,e){this.frameDrawing.stop(),console.log(t),e&&console.log(e)},t.prototype.updateExperimentState=function(t){t.state!=this.modelState&&(this.modelState=t.state,this.controlPanel.updateExperimentState()),t.progress!=this.modelProgress&&(this.modelProgress=t.progress,this.controlPanel.updateExperimentProgress()),t.time!=this.modelTime&&(this.modelTime=t.time),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.controlPanel.updateModelTimeScale())},t.prototype.getModelTime=function(){},t.prototype.getModelState=function(){},t.prototype.getModelTimeScale=function(){},t.prototype.getModelProgress=function(){},t.prototype.setNavigationSettings=function(t,e){var r=this;!this.windowAdjusted&&this.onResize&&(this.onResize(t,e+50,function(){r.navigation.applyNavigationSettings()}),this.windowAdjusted=!0)},t.DEBUG_MODE=!1,t.DEBUG_SPARK_LOCAL=!1,t}(),gt=function(){function t(){}return t.createClient=function(){return new mt},t.createDebugger=function(){return new z(new mt)},t}(),vt=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(e){var r=this;Yt.DEBUG_MODE=!0,Yt.DEBUG_SPARK_LOCAL=e,this.client.debugger=this,this.serverQueueInfo=document.getElementById("dev-panel-info-server-queue"),this.browserQueueInfo=document.getElementById("dev-panel-info-browser-queue"),this.parseTimeInfo=document.getElementById("dev-panel-info-parse-time"),this.shapeCountInfo=document.getElementById("dev-panel-info-shape-count"),this.cudCountInfo=document.getElementById("dev-panel-info-cud-count"),this.drawTimeInfo=document.getElementById("dev-panel-info-draw-time"),this.fpsInfo=document.getElementById("dev-panel-info-fps"),this.timeInfo=document.getElementById("dev-panel-info-time"),e&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return r.onNewModelSelected()}),t.elementcount=0},t.prototype.stop=function(){this.serverQueueInfo=void 0,this.browserQueueInfo=void 0,this.parseTimeInfo=void 0,this.shapeCountInfo=void 0,this.cudCountInfo=void 0,this.drawTimeInfo=void 0,this.fpsInfo=void 0,this.timeInfo=void 0,this.modelSelector&&(this.modelSelector.onchange=void 0,this.modelSelector=void 0),t.elementcount=0},t.prototype.onNewModelSelected=function(){var e=this;if(null!=this.client.svg&&this.client.stop("TERMINATED"),this.shapeCountInfo.innerHTML=t.elementcount,"NO MODEL SELECTED"!=this.modelSelector.value){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200===r.status&&e.client.start({})},r.open("GET","/http/start?path="+this.modelSelector.value,!0),r.send()}},t}(),bt=function(){function t(){}return t.createSvgElement=function(e){return Yt.DEBUG_MODE&&vt.elementcount++,document.createElementNS(t.svgns,e)},t.createXhtmlElement=function(e){return Yt.DEBUG_MODE&&vt.elementcount++,document.createElementNS(t.xhtmlns,e)},t.createTextNode=function(t){return Yt.DEBUG_MODE&&vt.elementcount++,document.createTextNode(t)},t.createUseElement=function(e){var r=t.createSvgElement("use"),i="#"+e;return r.setAttributeNS(t.xlinkns,"href",i),r},t.cloneElementWithId=function(e){var r=document.getElementById(e);return t.cloneElement(r)},t.cloneElement=function(e){var r=e.cloneNode(!0);return r.removeAttribute("id"),Yt.DEBUG_MODE&&(vt.elementcount+=1+t.childNodeDeepCount(r)),r},t.removeElement=function(e,r){var i=document.getElementById("canvas-group");if(i)for(var n=i.children,a=n.length-1;a>=0;a--){var o=parseInt(n[a].id),s=document.getElementById(o.toString());(r==s||r.contains(s))&&i.removeChild(n[a])}Yt.DEBUG_MODE&&(vt.elementcount-=1+t.childNodeDeepCount(r)),e.removeChild(r)},t.removeAllChildren=function(e){for(;e.lastChild;)t.removeElement(e,e.lastChild)},t.bringElementToFront=function(t){t.parentNode.appendChild(t)},t.childElements=function(t){var e=t.children;if(!e){for(var r=t.childNodes,i=[],n=0;n<r.length;n++){var a=r[n];1==a.nodeType&&i.push(a)}return i}return e},t.isPrimitiveSVGElement=function(t){return!(t.startsWith("Shape")||t.startsWith("Markup")||t.startsWith("Control")||t.startsWith("Chart")||t.startsWith("Window3D"))},t.isContainedInElementOfType=function(t,e){for(;t&&1==t.nodeType&&e.indexOf(t.getAttribute("type"))<0;)t=t.parentNode;return t&&1==t.nodeType},t.findChildOfType=function(e,r){for(var i=t.childElements(e),n=0;n<i.length;n++)if(i[n].getAttribute("type")==r)return i[n];return console.log("Child of type "+r+" not found in",e),null},t.findParentOfType=function(t,e){for(var r=t.parentNode;;){if(!r||1!=r.nodeType)return null;var i=r;if(i.getAttribute("type")==e)return i;r=i.parentNode}},t.childNodeDeepCount=function(e){var r=e.childNodes;if(!r)return 0;for(var i=r.length,n=0;n<r.length;n++)i+=t.childNodeDeepCount(r[n]);return i},t.createCanvas=function(){var e=t.createXhtmlElement("canvas");return document.getElementById("canvas-group").appendChild(e),e},t.xhtmlns="http://www.w3.org/1999/xhtml",t.xlinkns="http://www.w3.org/1999/xlink",t.svgns="http://www.w3.org/2000/svg",t}(),yt=function(){function t(){}return t.offsetPage=function(t){var e=t.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+i,left:e.left+r}},t.indexInParent=function(t){var e;for(e=0;t=t.previousElementSibling;e++);return e},t.radiansToDegrees=function(t){return 360*t/(2*Math.PI)},t.modulo=function(t,e){var r=t%e;return Math.floor(r>=0?r:r+e)},t.remainderPositive=function(t,e){var r=t%e;return r>=0?r:r+e},t.formatNumber=function(t,e){if(t==-1/0)return"-Infinity";if(t==1/0)return"+Infinity";if(isNaN(t))return"NaN";var r=Math.abs(t);return r<1e-12?String(0):r>9999999999||r<.001&&0!=t?String(+t.toExponential(2)):String(+t.toFixed(2))},t.formatPercent=function(t){return+Math.round(100*t)+"%"},t.reducePrecision=function(t){return+t.toPrecision(4)},t.dateComponent=function(t,e){var r,i=t.getFullYear();switch(e){case"YYYY":return String(i);case"MMM":switch(t.getMonth()+1){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec";default:return null}case"MM":r=t.getMonth()+1;break;case"DD":r=t.getDate();break;case"HH":r=t.getHours();break;case"mm":r=t.getMinutes();break;case"ss":r=t.getSeconds()}return r<10?"0"+r:String(r)},t.formatDate=function(e,r){switch(r){case"YYYY":return t.dateComponent(e,"YYYY");case"MMMYYYY":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"YYYY");case"DDMMM":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"DD");case"DDMMHH":return t.dateComponent(e,"MM")+"/"+t.dateComponent(e,"DD")+" "+t.dateComponent(e,"HH")+":00";case"HHmm":return t.dateComponent(e,"HH")+":"+t.dateComponent(e,"mm");case"mmss":default:return t.dateComponent(e,"mm")+"'"+t.dateComponent(e,"ss")+"''"}},t.toMilliseconds=function(e,r){switch(e.modelSettings.timeUnit){case"MILLISECOND":return r*t.MILLISECOND;case"SECOND":return r*t.SECOND;case"MINUTE":return r*t.MINUTE;case"HOUR":return r*t.HOUR;case"DAY":return r*t.DAY;case"WEEK":return r*t.WEEK;case"MONTH":return r*t.MONTH;case"YEAR":return r*t.YEAR}},t.toDate=function(e,r){var i=e.modelSettings,n=r-i.startTime;return new Date(i.startDate+t.toMilliseconds(e,n))},t.date=function(e){return t.toDate(e,e.time)},t.setMultipleAttributes=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i].toString())},t.getSubAttribute=function(t,e){for(var r=0;r<t.length;r++){var i=t[r].split(":");if(2==i.length&&i[0]==e)return i[1]}return null},t.getIntAttribute=function(t,e){return parseInt(t.getAttribute(e))},t.getFloatAttribute=function(t,e){return parseFloat(t.getAttribute(e))},t.splitSkipEmpty=function(e,r){return e.split(r).filter(t.isEmpty)},t.isEmpty=function(t){return t.length>0},t.splitToFloats=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseFloat(i[n]);return i},t.splitToInts=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseInt(i[n]);return i},t.hyphenToCameLCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.parseTranslateTransform=function(e){var r=t.translateRegExp2.exec(e);return null!=r?[parseFloat(r[1]),parseFloat(r[2])]:(r=t.translateRegExp1.exec(e),[parseFloat(r[1]),0])},t.increaseTransparency=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=i[4]?i[4]:1;return"rgba("+i[1]+","+i[2]+","+i[3]+","+r*n+")"},t.addPathArrows=function(e,r,i,n,a,o){for(var s=e.getTotalLength(),l=a;l<s;l+=o){var u=e.getPointAtLength(l),c=e.getPointAtLength(l-3),h=t.radiansToDegrees(Math.PI/2-Math.atan2(u.x-c.x,u.y-c.y)),d=bt.createUseElement(r);d.setAttribute("stroke-width",i.toString()),d.setAttribute("transform","translate("+u.x+" "+u.y+") rotate( "+h+")"),n.appendChild(d)}},t.sectorData=function(t,e,r,i,n,a){var o=Math.abs(a)>2*Math.PI?a%(2*Math.PI):a;a==2*Math.PI&&(a-=1e-4);var s=n+a,l=t+r*Math.cos(n),u=e+i*Math.sin(n),c=t+r*Math.cos(s),h=e+i*Math.sin(s);return"M "+t+" "+e+" L "+l+" "+u+" A "+r+" "+i+" 0 "+(Math.abs(o)>Math.PI?"1 ":"0 ")+(o>0?"1 ":"0 ")+c+" "+h+" Z"},t.roundPathCorners=function(t,e,r){function i(t,e,r){var i=e.x-t.x,a=e.y-t.y,o=Math.sqrt(i*i+a*a);return n(t,e,Math.min(1,r/o))}function n(t,e,r){return{x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}}function a(t,e){t.length>2&&(t[t.length-2]=e.x,t[t.length-1]=e.y)}function o(t){return{x:parseFloat(t[t.length-2]),y:parseFloat(t[t.length-1])}}var s=t.split(/[,\s]/).reduce(function(t,e){var r=e.match("([a-zA-Z])(.+)");return r?(t.push(r[1]),t.push(r[2])):t.push(e),t},[]).reduce(function(t,e){return parseFloat(e)==e&&t.length?t[t.length-1].push(e):t.push([e]),t},[]),l=[];if(s.length>1){var u=o(s[0]),c=null;"Z"==s[s.length-1][0]&&s[0].length>2&&(c=["L",u.x,u.y],s[s.length-1]=c),l.push(s[0]);for(var h=1;h<s.length;h++){var d=l[l.length-1],p=s[h],f=p==c?s[1]:s[h+1];if(f&&d&&d.length>2&&"L"==p[0]&&f.length>2&&"L"==f[0]){var m,g,v=o(d),b=o(p),y=o(f);r?(m=n(b,d.origPoint||v,e),g=n(b,f.origPoint||y,e)):(m=i(b,v,e),g=i(b,y,e)),a(p,m),p.origPoint=b,l.push(p);var A=n(m,b,.5),T=n(b,g,.5),C=["C",A.x,A.y,T.x,T.y,g.x,g.y];C.origPoint=b,l.push(C)}else l.push(p)}if(c){var S=o(l[l.length-1]);l.push(["Z"]),a(l[0],S)}}else l=s;return l.reduce(function(t,e){return t+e.join(" ")+" "},"")},t.stringToByteArray=function(t){for(var e=[],r=0,i=0;i<t.length;i++){for(var n=t.charCodeAt(i);n>255;)e[r++]=255&n,n>>=8;e[r++]=n}return e},t.byteArrayToString=function(t){if(t.length<=8192)return String.fromCharCode.apply(null,t);for(var e="",r=0;r<t.length;r+=8192){var i=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,i)}return e},t.translateRegExp1=/^translate\s*\(\s*(-?\d*.?\d*)\s*\)\s*$/i,t.translateRegExp2=/^translate\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)\s*$/i,t.rgbRegExp=/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,t.rgbaRegExp=/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*.?\d*)\s*\)\s*$/i,t.MILLISECOND=1,t.SECOND=1e3*t.MILLISECOND,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR,t.WEEK=7*t.DAY,t.MONTH=30*t.DAY,t.YEAR=365*t.DAY,t}(),At=function(){function t(t){this.frameDrawing=t}return t.createShapeArc=function(){return bt.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createShapeText=function(){return bt.createSvgElement("text")},t.updateShapeText=function(t,e,r){for(var i=0;i<e.length;i++)if("text-content"==e[i]){null==r[i]&&(r[i]="");var n=r[i].split("\n"),a=t.childElementCount;if(1==n.length&&1==a)t.firstChild.firstChild.textContent=n[0];else{for(var o=yt.getFloatAttribute(t,"first-line-offset"),s=yt.getFloatAttribute(t,"line-height"),l=0;l<n.length;l++){var u=bt.childElements(t),c=n[l];if(c.endsWith("\r")&&(c=c.substring(0,c.length-1)),u[l])u[l].firstChild.textContent=c;else{var h=bt.createSvgElement("tspan");h.setAttribute("x","0"),h.setAttribute("y",(o+l*s).toString());var d=bt.createTextNode(c);h.appendChild(d),t.appendChild(h)}}for(;t.childElementCount>n.length;)bt.removeElement(t,t.lastChild)}}else t.setAttribute(e[i],r[i])},t.createShapeImage=function(){return bt.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":bt.removeAllChildren(t);break;case"add":var n=bt.createSvgElement("image");n.setAttributeNS(bt.xlinkns,"href",this.frameDrawing.client.network.getJarResourceURL(r[i])),n.setAttribute("visibility","hidden"),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.appendChild(n);break;case"set":for(var a=parseInt(r[i]),o=t.childNodes,s=0;s<o.length;s++)(n=o[s]).setAttribute("visibility",s==a?"inherit":"hidden");break;case"width":case"height":o=t.childNodes;for(s=0;s<o.length;s++)(n=o[s]).setAttribute(e[i],r[i]);default:t.setAttribute(e[i],r[i])}},t.createShapeCanvas=function(t){var e=bt.createSvgElement("image");return bt.createCanvas().id=t+"canvas",e},t.updateShapeCanvas=function(t,e,r){for(var i=t,n=document.getElementById(t.id+"canvas"),a=n.getContext("2d"),o=0;o<e.length;o++)switch(e[o]){case"global-composite-operation":a.globalCompositeOperation=r[o];break;case"width":case"height":i.setAttribute(e[o],r[o]),n.setAttribute(e[o],r[o]);break;case"fill-rect":case"clear-rect":var s=r[o].split(" "),l=parseFloat(s[0]),u=parseFloat(s[1]),c=parseFloat(s[2]),h=parseFloat(s[3]);if("clear-rect"==e[o])a.clearRect(l,u,c,h);else{var d=s[4];a.fillStyle=d,a.fillRect(l,u,c,h)}break;case"fill-circle":s=r[o].split(" ");var p=parseFloat(s[0]),f=parseFloat(s[1]),m=parseFloat(s[2]),g=s[3];a.fillStyle=g,a.beginPath(),a.arc(p,f,m,0,2*Math.PI),a.fill();break;case"clear":a.clearRect(0,0,n.width,n.height);break;case"update":i.setAttributeNS(bt.xlinkns,"href",n.toDataURL("image/x-xbitmap"));break;default:t.setAttribute(e[o],r[o])}},t.createUnsupportedObject=function(t){var e=bt.cloneElementWithId("unsupported-object");return bt.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=bt.findChildOfType(t,"background"),n=bt.findChildOfType(t,"text"),a=0;a<e.length;a++)switch(e[a]){case"width":var o=parseFloat(r[a]);i.setAttribute("width",o.toString());var s=n.getBBox();o<s.width&&(n.firstChild.textContent="Not supported",s=n.getBBox()),o<s.width&&(n.firstChild.textContent="N/A",s=n.getBBox()),o<s.width&&(n.firstChild.textContent=""),n.setAttribute("x",(o/2).toString());break;case"height":var l=parseFloat(r[a]);i.setAttribute("height",l.toString()),n.setAttribute("y",(l/2+3).toString());break;default:t.setAttribute(e[a],r[a])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeGISMap"],t}(),Tt=function(){function t(){}return t.create=function(){return At.createUnsupportedObject("Vector 3D is under development. To view 3D use Play(video)")},t.update=function(t,e,r){At.updateUnsupportedObject(t,e,r)},t}(),Ct=function(){function t(t,e){this.frameDrawing=t,this.control=e}return t.createControlList=function(e){var r=bt.cloneElementWithId("control-list"),i=function(e){return t.onControlListMouseEvent(e)};r.addEventListener("mouseover",i),r.addEventListener("mouseout",i),r.addEventListener("wheel",i);var n=bt.findChildOfType(r,"svg"),a=bt.findChildOfType(n,"scrollbargroup"),o=function(e){return t.onControlListScrollbarMouseEvent(e)};return a.addEventListener("mouseout",o),a.addEventListener("mousedown",o),a.addEventListener("mouseup",o),a.addEventListener("mousemove",o),a.addEventListener("click",o),e&&t.onGotFocus(r),r.setAttribute("always-focused",e.toString()),r},t.prototype.updateControlList=function(e,r,i){for(var n=bt.findChildOfType(e,"svg"),a=bt.findChildOfType(e,"border"),o=bt.findChildOfType(n,"background"),s=bt.findChildOfType(n,"itemgroup"),l=(bt.findChildOfType(n,"scrollbargroup"),0);l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);for(var u="true"==i[l],c=bt.childElements(s),h=0;h<c.length;h++)t.updateControlListItemLook(c[h],!1,!1);a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"text-array":bt.removeAllChildren(s),s.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var d=yt.splitSkipEmpty(i[l],"\n"),p=0,f=0;for(h=0;h<d.length;h++){var m=bt.cloneElementWithId("list-item");bt.findChildOfType(m,"background").setAttribute("fill",o.getAttribute("fill")),(A=bt.findChildOfType(m,"text")).firstChild.textContent=d[h],e.hasAttribute("text-color")&&A.setAttribute("fill",e.getAttribute("text-color")),s.appendChild(m);var g=A.getBBox();p<g.width&&(p=g.width),f<g.height&&(f=g.height)}c=bt.childElements(s);var v=Math.max(p+4,yt.getFloatAttribute(n,"width")),b=Math.max(20,1.35*f);e.setAttribute("item-height",b.toString());for(h=0;h<c.length;h++)this.setupControlListItem(c[h],b*h,v,b,f);t.updateControlListScrollbar(e);break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":e.setAttribute(r[l],i[l]);break;case"font-style":e.style.font=i[l];break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),n.hasAttribute("width")&&n.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[l],i[l]);break;case"value":var y=yt.splitSkipEmpty(i[l],"\n");c=bt.childElements(s),e.setAttribute("last-clicked","0");for(h=0;h<c.length;h++){m=c[h];var A=bt.findChildOfType(m,"text"),T=y.indexOf(A.firstChild.textContent)>=0;m.setAttribute("selected",T),t.updateControlListItemLook(m,!1,!1),T&&e.setAttribute("last-clicked",h.toString())}break;default:e.setAttribute(r[l],i[l])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=bt.findChildOfType(t,"svg"),i=bt.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var n=i*yt.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[n.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled"))switch(e.type){case"mouseover":t.onGotFocus(r);break;case"mouseout":if(r.contains(e.relatedTarget))return;t.onLostFocus(r);break;case"wheel":e.altKey||e.ctrlKey||(e.stopPropagation(),e.preventDefault(),t.scrollControlList(r,e.deltaY<0?1:-1))}},t.onGotFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=bt.findChildOfType(e,"border"),i=bt.findChildOfType(e,"svg"),n=bt.findChildOfType(i,"itemgroup"),a=bt.findChildOfType(i,"scrollbargroup"),o=bt.childElements(n);if("control-border-hover"!=r.getAttribute("class")){r.setAttribute("class","control-border-hover"),a.setAttribute("class","control-opaque1");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!0,!1)}}},t.onLostFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=bt.findChildOfType(e,"border"),i=bt.findChildOfType(e,"svg"),n=bt.findChildOfType(i,"itemgroup"),a=bt.findChildOfType(i,"scrollbargroup"),o=bt.childElements(n);r.setAttribute("class","control-border"),a.setAttribute("class","control-opaque0");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!1,!1)}},t.scrollControlList=function(t,e){var r=bt.findChildOfType(t,"svg"),i=bt.findChildOfType(r,"itemgroup"),n=i.childElementCount;if(0!=n){var a=yt.getFloatAttribute(r,"height"),o=yt.getFloatAttribute(t,"item-height"),s=n*o,l=i.getAttribute("transform"),u=yt.parseTranslateTransform(l)[1];u+=e*o,u=Math.max(-s+a,u),u=Math.min(u,0),u=Math.round(u),i.setAttribute("transform","translate(0,"+u+")");var c=bt.findChildOfType(r,"scrollbargroup"),h=bt.findChildOfType(c,"handle"),d=yt.getFloatAttribute(h,"height"),p=(a/2-u)/s,f=Math.max(2,a*p-d/2);f=Math.min(a-d-2,f),h.setAttribute("y",f.toString())}},t.prototype.setupControlListItem=function(t,e,r,i,n){var a=this,o=bt.findChildOfType(t,"background"),s=bt.findChildOfType(t,"text");t.setAttribute("transform","translate(0,"+e+")"),yt.setMultipleAttributes(o,["width","height"],[r,i]),yt.setMultipleAttributes(s,["x","y"],[2,i/2+.3*n]);var l=function(t){return a.onControlListItemMouseEvent(t)};t.addEventListener("mouseover",l),t.addEventListener("mouseout",l),t.addEventListener("click",l)},t.prototype.onControlListItemMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode,n=i.parentNode.parentNode;if("false"!=n.getAttribute("enabled"))switch(e.type){case"mouseover":t.updateControlListItemLook(r,!0,!0);break;case"mouseout":t.updateControlListItemLook(r,!0,!1);break;case"click":e.stopPropagation(),e.preventDefault();var a="true"==n.getAttribute("multiple"),o=bt.childElements(i),s=yt.indexInParent(r),l="true"==r.getAttribute("selected");if(a)if(e.ctrlKey)r.setAttribute("selected",String(!l)),t.updateControlListItemLook(r,!0,!0);else if(e.shiftKey){var u=yt.getIntAttribute(n,"last-clicked");for(c=0;c<o.length;c++)l=u<=s?u<=c&&c<=s:s<=c&&c<=u,o[c].setAttribute("selected",l),t.updateControlListItemLook(o[c],!0,c==s)}else for(c=0;c<o.length;c++)o[c].setAttribute("selected",c==s),t.updateControlListItemLook(o[c],!0,c==s);else{l=!e.ctrlKey||!l;for(var c=0;c<o.length;c++)o[c].setAttribute("selected",c==s&&l),t.updateControlListItemLook(o[c],!0,c==s)}n.setAttribute("last-clicked",s.toString());var h="";for(c=0;c<o.length;c++){if("true"==o[c].getAttribute("selected"))h+=bt.findChildOfType(o[c],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(n,h)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,n=bt.findChildOfType(t,"background"),a=bt.findChildOfType(t,"text"),o="true"==i.getAttribute("enabled"),s="true"==t.getAttribute("selected");if(!o)return n.setAttribute("class",s?"control-background-selected-disabled":""),void a.setAttribute("class","control-text-disabled");e?(r?n.setAttribute("class",s?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):n.setAttribute("class",s?"control-list-background-selected-hover":""),a.setAttribute("class",s?"control-text-selected-hover":"")):(n.setAttribute("class",s?"control-list-background-selected":""),a.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=bt.findChildOfType(e,"svg"),i=bt.findChildOfType(r,"scrollbargroup"),n=bt.findChildOfType(i,"scrollbar"),a=bt.findChildOfType(i,"handle"),o=yt.getFloatAttribute(r,"width"),s=yt.getFloatAttribute(r,"height"),l=o-yt.getFloatAttribute(n,"width");n.setAttribute("x",l.toString()),n.setAttribute("height",s.toString()),a.setAttribute("x",(l+2).toString()),a.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=bt.findChildOfType(t,"svg"),i=bt.findChildOfType(r,"scrollbargroup"),n=(bt.findChildOfType(i,"scrollbar"),bt.findChildOfType(i,"handle")),a=yt.getFloatAttribute(r,"height"),o=bt.findChildOfType(r,"itemgroup").childElementCount,s=0;e=o>0&&a<(s=o*yt.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e&&n.setAttribute("height",Math.max(a*(a/s)-4,7).toString())},t.onControlListScrollbarMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode.parentNode;if("false"!=i.getAttribute("enabled")){var n=bt.findChildOfType(r,"scrollbar"),a=yt.getFloatAttribute(n,"height"),o=n.getBoundingClientRect().height/a,s=yt.offsetPage(n),l=(e.pageY-s.top)/o,u=bt.findChildOfType(r,"handle"),c=yt.getFloatAttribute(u,"y");switch(e.type){case"mouseout":case"mouseup":t.controlListScrollbarButtonDown=0;break;case"mousedown":1==e.which&&e.target==u&&(e.stopPropagation(),t.controlListScrollbarButtonDown=1,t.controlListScrollbarMousePos=l);break;case"mousemove":if(1==t.controlListScrollbarButtonDown){e.stopPropagation();var h=l-t.controlListScrollbarMousePos,d=bt.findChildOfType(i,"svg"),p=bt.findChildOfType(d,"itemgroup").childElementCount,f=yt.getFloatAttribute(i,"item-height"),m=h*(p*f/a)/f;t.scrollControlList(i,-m),t.controlListScrollbarMousePos=l}break;case"click":if(e.stopPropagation(),e.preventDefault(),e.target==n){m=Math.floor(a/yt.getFloatAttribute(i,"item-height"));t.scrollControlList(i,l<c?m:-m)}}}},t.controlListScrollbarButtonDown=0,t}(),St=function(){function t(t){this.frameDrawing=t,this.controlList=new Ct(t,this)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return At.createUnsupportedObject("File chooser is not supported in the Cloud mode");case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":t.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":At.updateUnsupportedObject(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=bt.cloneElementWithId("control-button");return new f(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var n=bt.findChildOfType(e,"background"),a=bt.findChildOfType(e,"text"),o=0;o<r.length;o++)switch(r[o]){case"enabled":e.setAttribute(r[o],i[o]);var s="true"==i[o];n.setAttribute("class",s?"control-background":"control-background-disabled"),a.setAttribute("class",s?"control-button-text":"control-text-disabled");break;case"text":a.firstChild.textContent=i[o];break;case"background-color":break;case"text-color":a.setAttribute("fill",i[o]);break;case"font-style":a.style.font=i[o],t.centerControlText(a,n,!0,!0);break;case"width":case"height":var l=parseFloat(i[o])-2;n.setAttribute(r[o],l.toString()),t.centerControlText(a,n,!0,!0);break;default:e.setAttribute(r[o],i[o])}},t.onButtonOver=function(t){var e=bt.findChildOfType(t,"background"),r=bt.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=bt.findChildOfType(t,"background"),r=bt.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=bt.findChildOfType(t,"background"),r=bt.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.onControlAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=bt.cloneElementWithId("control-checkbox");return new f(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var n=bt.findChildOfType(e,"background"),a=bt.findChildOfType(e,"box"),o=bt.findChildOfType(e,"check"),s=bt.findChildOfType(e,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-checkbox-box":"control-checkbox-box-disabled"),o.setAttribute("class",u?"control-checkbox-check":"control-checkbox-check-disabled"),s.setAttribute("class",u?"":"control-text-disabled");break;case"text":s.firstChild.textContent=i[l];break;case"background-color":n.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":s.style.font=i[l],t.centerControlText(s,n,!1,!0);break;case"width":n.setAttribute(r[l],i[l]);break;case"height":n.setAttribute(r[l],i[l]);var c=parseFloat(i[l]);a.setAttribute("y",(c/2-8).toString()),o.setAttribute("transform","translate(0,"+(c/2-8)+")"),t.centerControlText(s,n,!1,!0);break;case"value":o.setAttribute("visibility","true"==i[l]?"inherit":"hidden");break;default:e.setAttribute(r[l],i[l])}},t.onCheckboxOver=function(t){var e=bt.findChildOfType(t,"box"),r=bt.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=bt.findChildOfType(t,"box"),r=bt.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=bt.findChildOfType(t,"box"),r=bt.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=bt.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.onControlAction(t.id,r)},t.prototype.createSlider=function(){var t=this,e=bt.cloneElementWithId("control-slider"),r=function(e){return t.onSliderEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r),e},t.updateSlider=function(e,r,i){for(var n=bt.findChildOfType(e,"sensor"),a=bt.findChildOfType(e,"background"),o=bt.findChildOfType(e,"line"),s=bt.findChildOfType(e,"progress"),l=bt.findChildOfType(e,"handle"),u=(bt.findChildOfType(e,"value"),0);u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];o.setAttribute("class",c?"control-background":"control-background-disabled"),s.setAttribute("class",c?"control-slider-progress":"control-background-selected-disabled"),l.setAttribute("class",c?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":a.setAttribute("fill",i[u]);break;case"width":case"height":a.setAttribute(r[u],i[u]);break;case"vertical":e.setAttribute(r[u],i[u]);var h=yt.getFloatAttribute(a,"width"),d=yt.getFloatAttribute(a,"height");yt.setMultipleAttributes(n,["x","y","width","height"],[String(-1e3),String(-1e3),String(h+2e3),String(d+2e3)]);var p=void 0,f=void 0,m=void 0,g=void 0,v=void 0,b=void 0,y=void 0,A=void 0,T=void 0,C=void 0;"false"==i[u]?(v=p=0,b=f=d/2-2,m=h,y=0,A=g=4,T=0,C=d/2):(v=p=h/2-2,f=0,b=d,y=m=4,g=d,A=0,T=h/2,C=d),yt.setMultipleAttributes(o,["x","y","width","height"],[p,f,m,g]),yt.setMultipleAttributes(s,["x","y","width","height"],[v,b,y,A]),yt.setMultipleAttributes(l,["cx","cy"],[T,C]);break;case"value":var S=yt.getFloatAttribute(e,"min"),E=yt.getFloatAttribute(e,"max");h=yt.getFloatAttribute(a,"width"),d=yt.getFloatAttribute(a,"height");var w="true"==e.getAttribute("vertical")?d:h,k=(parseFloat(i[u])-S)/(E-S)*w;t.setSliderHandlePosition(e,k);break;default:e.setAttribute(r[u],i[u])}},t.prototype.onSliderEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=bt.findChildOfType(r,"background"),n=bt.findChildOfType(r,"progress"),a=yt.getFloatAttribute(i,"width"),o=yt.getFloatAttribute(i,"height"),s=i.getBoundingClientRect(),l=s.width/a,u=s.height/o,c=yt.offsetPage(i),h="true"==r.getAttribute("vertical");if(e.type.startsWith("mouse")||"wheel"==e.type){var d=e,p=(d.pageX-c.left)/l,f=(d.pageY-c.top)/u,m=h?o-f:p;switch(e.type){case"mouseover":e.stopPropagation(),t.onSliderOver(r);break;case"mouseout":if(r.contains(d.relatedTarget))return;1==t.sliderButtonDown&&(t.setSliderHandlePosition(r,m),this.confirmSliderValue(r)),t.sliderButtonDown=0,t.onSliderOut(r);break;case"mousedown":t.sliderButtonDown=d.which,1==t.sliderButtonDown&&(e.stopPropagation(),t.onSliderHandleGrabbed(r,m));break;case"mousemove":1==t.sliderButtonDown&&(e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m));break;case"mouseup":1==t.sliderButtonDown&&(e.stopPropagation(),this.onSliderHandleReleased(r)),t.sliderButtonDown=0;break;case"wheel":if(!d.altKey&&!d.ctrlKey){var g=e;e.stopPropagation(),e.preventDefault();var v=yt.getFloatAttribute(n,h?"height":"width");t.setSliderHandlePosition(r,v+(g.deltaY<0?1:-1)),this.confirmSliderValue(r)}}}else if(e.type.startsWith("touch")){var b=e;if(b.touches.length>1)return void this.onSliderHandleReleased(r);var y="touchend"==e.type?b.changedTouches[0]:b.touches[0];p=void 0,f=void 0;p=(y.pageX-c.left)/l,f=(y.pageY-c.top)/u;m=h?o-f:p;switch(e.type){case"touchstart":e.stopPropagation(),t.onSliderOver(r),t.onSliderHandleGrabbed(r,m);break;case"touchmove":e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m);break;case"touchend":e.stopPropagation(),this.onSliderHandleReleased(r),t.onSliderOut(r)}}}},t.onSliderOver=function(e){var r=bt.findChildOfType(e,"line"),i=bt.findChildOfType(e,"progress"),n=bt.findChildOfType(e,"handle"),a=bt.findChildOfType(e,"value");r.setAttribute("class","control-slider-line-hover"),i.setAttribute("class","control-fill-color-transition"),n.setAttribute("class",1==t.sliderButtonDown?"control-slider-handle-pressed":"control-slider-handle-hover"),a.setAttribute("class","control-opaque1")},t.onSliderOut=function(t){var e=bt.findChildOfType(t,"sensor"),r=bt.findChildOfType(t,"line"),i=bt.findChildOfType(t,"progress"),n=bt.findChildOfType(t,"handle"),a=bt.findChildOfType(t,"value");e.setAttribute("visibility","hidden"),r.setAttribute("class","control-background"),i.setAttribute("class","control-slider-progress"),n.setAttribute("r","8"),n.setAttribute("class","control-slider-handle"),a.setAttribute("class","control-opaque0")},t.onSliderHandleGrabbed=function(e,r){var i=bt.findChildOfType(e,"sensor"),n=bt.findChildOfType(e,"handle");bt.bringElementToFront(e),n.setAttribute("r","7"),n.setAttribute("class","control-slider-handle-pressed"),i.setAttribute("visibility","inherit"),t.setSliderHandlePosition(e,r)},t.prototype.onSliderHandleReleased=function(t){var e=bt.findChildOfType(t,"sensor"),r=bt.findChildOfType(t,"handle");r.setAttribute("r","8"),r.setAttribute("class","control-slider-handle-hover"),e.setAttribute("visibility","hidden"),this.confirmSliderValue(t)},t.setSliderHandlePosition=function(t,e){var r=bt.findChildOfType(t,"background"),i=bt.findChildOfType(t,"progress"),n=bt.findChildOfType(t,"handle"),a=bt.findChildOfType(t,"value"),o=yt.getFloatAttribute(r,"width"),s=yt.getFloatAttribute(r,"height"),l="true"==t.getAttribute("vertical"),u=l?s:o;e=Math.min(u,Math.max(e,0));var c,h=yt.getFloatAttribute(t,"min"),d=yt.getFloatAttribute(t,"max"),p=yt.getFloatAttribute(t,"step");c=p>0?h+Math.round(e/u*(d-h)/p)*p:h+e/u*(d-h),e=((c=Math.min(c,d))-h)/(d-h)*u,l?(i.setAttribute("y",(u-e).toString()),i.setAttribute("height",e.toString()),n.setAttribute("cy",(u-e).toString())):(i.setAttribute("width",e.toString()),n.setAttribute("cx",e.toString()));var f=a.firstElementChild,m=a.lastElementChild;m.firstChild.textContent=yt.formatNumber(c,void 0);var g=m.getComputedTextLength()+10;f.setAttribute("width",g.toString()),f.setAttribute("x",(5-g).toString());var v=l?o/2-9:e-14,b=l?s-e-15-10:s/2-15-4;a.setAttribute("transform","translate("+v+","+b+")"),t.setAttribute("current-value",c)},t.prototype.confirmSliderValue=function(t){var e=yt.getFloatAttribute(t,"current-value");e!=yt.getFloatAttribute(t,"last-value")&&(this.frameDrawing.onControlAction(t.id,e),t.setAttribute("last-value",e.toString()))},t.createRadioButtonGroup=function(){return bt.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"enabled":e.setAttribute(r[a],i[a]);for(var o="true"==i[a],s=bt.childElements(e),l=0;l<s.length;l++){var u=s[l],c=bt.findChildOfType(u,"circle"),h=bt.findChildOfType(u,"check"),d=bt.findChildOfType(u,"text");c.setAttribute("class",o?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),h.setAttribute("class",o?"control-radiobutton-check":"control-text-disabled"),d.setAttribute("class",o?"":"control-text-disabled")}break;case"text-array":var p=i[a].split("\n"),m=function(r){var i=bt.cloneElementWithId("radio-button"),a=bt.findChildOfType(i,"background");e.hasAttribute("background-color")&&a.setAttribute("fill",e.getAttribute("background-color"));var o=bt.findChildOfType(i,"text");o.firstChild.textContent=p[r],e.hasAttribute("text-color")&&o.setAttribute("fill",e.getAttribute("text-color")),new f(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return n.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(l=0;l<p.length;l++)m(l);break;case"background-color":case"text-color":e.setAttribute(r[a],i[a]);break;case"font-style":e.style.font=i[a];break;case"width":case"height":e.setAttribute(r[a],i[a]);break;case"vertical":var g=yt.getFloatAttribute(e,"width"),v=yt.getFloatAttribute(e,"height"),b=0;s=bt.childElements(e);for(l=0;l<s.length;l++){u=s[l];var y=bt.findChildOfType(u,"background"),A=(d=bt.findChildOfType(u,"text")).getBBox();if("true"==i[a]){var T=Math.max(25,1.5*A.height);u.setAttribute("transform","translate(0,"+T*l+")"),yt.setMultipleAttributes(y,["width","height"],[g,T])}else{var C=20+A.width+10;u.setAttribute("transform","translate("+b+",0)"),yt.setMultipleAttributes(y,["width","height"],[C,v]),b+=C}t.centerRadioButton(u)}break;case"value":var S=parseInt(i[a]);s=bt.childElements(e);for(l=0;l<s.length;l++){u=s[l];(h=bt.findChildOfType(u,"check")).setAttribute("visibility",S==l?"inherit":"hidden")}break;default:e.setAttribute(r[a],i[a])}},t.onRadioButtonOver=function(t){var e=bt.findChildOfType(t,"circle"),r=bt.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=bt.findChildOfType(t,"circle"),r=bt.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=bt.findChildOfType(t,"circle"),r=bt.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=bt.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=bt.childElements(r),n=0;n<i.length;n++){var a=i[n];bt.findChildOfType(a,"check").setAttribute("visibility",a==t?"inherit":"hidden"),a==t&&(e=n)}this.frameDrawing.onControlAction(r.id,e)}},t.centerRadioButton=function(e){var r=bt.findChildOfType(e,"background"),i=bt.findChildOfType(e,"circle"),n=bt.findChildOfType(e,"check"),a=bt.findChildOfType(e,"text"),o=yt.getFloatAttribute(r,"height");i.setAttribute("cy",(o/2).toString()),n.setAttribute("cy",(o/2).toString()),t.centerControlText(a,r,!1,!0)},t.createListBox=function(){return Ct.createControlList(!1)},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var t=this,e=bt.cloneElementWithId("control-combobox"),r=function(e){return t.onComboBoxEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("click",r);var i=Ct.createControlList(!0);return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),e.appendChild(i),e},t.prototype.updateComboBox=function(e,r,i){for(var n=bt.findChildOfType(e,"svg"),a=bt.findChildOfType(e,"border"),o=bt.findChildOfType(e,"dropdown"),s=bt.findChildOfType(n,"background"),l=bt.findChildOfType(n,"text"),u=bt.findChildOfType(n,"arrowback"),c=bt.findChildOfType(n,"arrow"),h=0;h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var d="true"==i[h];l.setAttribute("class",d?"":"control-text-disabled"),a.setAttribute("class",d?"control-border":"control-border-disabled"),d||o.setAttribute("visibility","hidden"),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-array":var p=yt.splitSkipEmpty(i[h],"\n"),f=p.length>0?p[0]:"";l.firstChild.textContent=f,this.controlList.updateControlList(o,[r[h]],[i[h]]),this.controlList.adjustControlListHeightToItems(o,5),this.controlList.updateControlList(o,["value"],[f]);break;case"background-color":s.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-color":l.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"font-style":e.style.font=i[h],t.centerControlText(l,s,!1,!0),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"width":case"height":var m=parseFloat(i[h]);if(n.setAttribute(r[h],i[h]),s.setAttribute(r[h],i[h]),a.setAttribute(r[h],i[h]),"width"==r[h])u.setAttribute("x",(m-20).toString()),this.controlList.updateControlList(o,[r[h]],[i[h]]);else{t.centerControlText(l,s,!1,!0),u.setAttribute("height",m.toString()),o.setAttribute("transform","translate(0,"+i[h]+")");var g=5*parseFloat(i[h]);this.controlList.updateControlList(o,["height"],[g.toString()])}if(n.hasAttribute("width")&&n.hasAttribute("height")){var v=yt.getFloatAttribute(n,"width")-10,b=yt.getFloatAttribute(n,"height")/2;c.setAttribute("transform","translate("+v+","+b+")")}break;case"editable":e.setAttribute(r[h],i[h]);break;case"value":l.firstChild.textContent=i[h],this.controlList.updateControlList(o,[r[h]],[i[h]]);break;default:e.setAttribute(r[h],i[h])}},t.prototype.onComboBoxEvent=function(t){var e=t.currentTarget;if("false"!=e.getAttribute("enabled")){var r=bt.findChildOfType(e,"svg"),i=bt.findChildOfType(e,"border"),n=bt.findChildOfType(e,"dropdown"),a=bt.findChildOfType(r,"background"),o=bt.findChildOfType(r,"text"),s=bt.findChildOfType(r,"arrowback"),l=bt.findChildOfType(r,"arrow"),u="true"==e.getAttribute("editable");switch(t.type){case"mouseover":i.setAttribute("class","control-border-hover"),s.setAttribute("class","control-combobox-arrow-background-hover"),l.setAttribute("class","control-fill-color-transition");break;case"mouseout":if(e.contains(t.relatedTarget))return;i.setAttribute("class","control-border"),s.setAttribute("class","control-fill-transparent-transition"),l.setAttribute("class","control-fill-transparent-transition"),n.setAttribute("visibility","hidden");break;case"mousedown":1!=t.which||!u||t.target!=a&&t.target!=o||(t.stopPropagation(),this.displayTextInputForSVG(e,"left"));break;case"click":if(!u||t.target==s||t.target==l){t.stopPropagation(),t.preventDefault(),bt.bringElementToFront(e);var c="inherit"==n.getAttribute("visibility");n.setAttribute("visibility",c?"hidden":"inherit")}}}},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=bt.findChildOfType(t,"svg"),i=bt.findChildOfType(t,"dropdown"),n=bt.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var a=e.split("\n")[0];n.firstChild.textContent=a,this.frameDrawing.onControlAction(t.id,a)},t.prototype.createTextField=function(){var e=this,r=bt.cloneElementWithId("control-textfield");return new f(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r)},function(t){return e.onTextFieldDown(r)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var n=bt.findChildOfType(e,"svg"),a=bt.findChildOfType(e,"border"),o=bt.findChildOfType(n,"background"),s=bt.findChildOfType(n,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];s.setAttribute("class",u?"":"control-text-disabled"),a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":e.style.font=i[l],t.centerControlText(s,o,!1,!0);break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),"width"==r[l]&&s.setAttribute("x",(parseFloat(i[l])-2).toString()),t.centerControlText(s,o,!1,!0);break;case"value":s.firstChild.textContent=i[l];break;default:e.setAttribute(r[l],i[l])}},t.onTextFieldOver=function(t){bt.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){bt.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t){this.displayTextInputForSVG(t,"right")},t.createProgressBar=function(){return bt.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var n=e.firstElementChild,a=bt.findChildOfType(n,"background"),o=bt.findChildOfType(n,"progress"),s=bt.findChildOfType(n,"text"),l=bt.findChildOfType(n,"border"),u=0;u<r.length;u++)switch(r[u]){case"background-color":a.setAttribute("fill",i[u]);break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":e.style.font=i[u],t.centerControlText(s,a,!1,!0);break;case"width":case"height":e.setAttribute(r[u],i[u]);break;case"vertical":var c="true"==i[u],h=e.getAttribute(c?"height":"width"),d=e.getAttribute(c?"width":"height");a.setAttribute("width",h),a.setAttribute("height",d),o.setAttribute("height",d),t.centerControlText(s,a,!0,!0),l.setAttribute("width",h),l.setAttribute("height",d),c&&n.setAttribute("transform","translate(0,"+h+") rotate(-90)");break;case"text":s.firstChild.textContent="null"==i[u]?"":i[u];break;case"value":var p=yt.getFloatAttribute(a,"width");"null"==i[u]?(o.setAttribute("class","control-progressbar-indeterminate"),o.setAttribute("width",p.toString())):(o.setAttribute("class","control-slider-progress"),o.setAttribute("width",(parseFloat(i[u])*p).toString()));break;default:e.setAttribute(r[u],i[u])}},t.prototype.displayTextInputForSVG=function(t,e){var r=this,i=bt.findChildOfType(t,"svg"),n=bt.findChildOfType(i,"text"),a=document.getElementById("text-input-for-svg-container");a.style.display="block";var o=i.getBoundingClientRect(),s=yt.getFloatAttribute(i,"width"),l=yt.getFloatAttribute(i,"height"),u=o.width/s,c=a.firstElementChild;c.style.left=o.left+"px",c.style.top=o.top+"px",c.style.width=s+"px",c.style.height=l+"px",c.style.transform="scale("+u+")",c.style.font=t.style.font,c.style.textAlign=e,c.value=n.firstChild.textContent,a.setAttribute("control-id",t.id);var h=function(t){return r.onTextInputForSVGEvent(t)};a.onmousedown=h,a.onwheel=h,a.onkeypress=h,a.ontouchstart=h,window.setTimeout(function(){c.focus(),c.select()},0)},t.prototype.onTextInputForSVGEvent=function(t){var e=t.currentTarget,r=e.firstElementChild,i=e.getAttribute("control-id"),n=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=r&&(n=!0);break;case"wheel":n=!0;break;case"keypress":"Enter"==t.code&&(n=!0)}n&&(e.style.display="none",this.onTextInputForSVGChanged(i,r.value))},t.prototype.onTextInputForSVGChanged=function(t,e){var r=document.getElementById(t),i=bt.findChildOfType(r,"svg");if(bt.findChildOfType(i,"text").firstChild.textContent=e,this.frameDrawing.onControlAction(t,e),"ControlComboBox"==r.getAttribute("type")){var n=bt.findChildOfType(r,"dropdown");this.controlList.updateControlList(n,["value"],[e])}},t.centerControlText=function(t,e,r,i){var n=yt.getFloatAttribute(e,"width"),a=yt.getFloatAttribute(e,"height"),o=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&a&&t.setAttribute("y",(1+a/2+.3*o.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.onControlAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t.sliderButtonDown=0,t}(),Et=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){for(var e=bt.findChildOfType(t,"picture"),r=bt.findChildOfType(t,"pictureback"),i=bt.childElements(bt.findChildOfType(t,"legend")),n=i.length,a="true"==t.getAttribute("show-pdf"),o="true"==t.getAttribute("show-cdf"),s="true"==t.getAttribute("show-mean"),l=(yt.getFloatAttribute(r,"x"),yt.getFloatAttribute(r,"y")),u=(yt.getFloatAttribute(r,"width"),yt.getFloatAttribute(r,"height")),c=0;c<n;c++){var h=bt.createSvgElement("g");if(a){var d=bt.createSvgElement("g");h.appendChild(d)}if(o){var p=bt.createSvgElement("polyline");yt.setMultipleAttributes(p,["fill","stroke-width","stroke"],["none",i[c].getAttribute("cdf-line-width"),i[c].getAttribute("cdf-color")]),h.appendChild(p)}if(s){var f=bt.createSvgElement("line");yt.setMultipleAttributes(f,["stroke-width","stroke","y1","y2"],[i[c].getAttribute("cdf-line-width"),i[c].getAttribute("mean-color"),l.toString(),(l+u).toString()]),h.appendChild(f)}e.appendChild(h),It.addClickTapHandlerToChartItem(h)}},t.prototype.draw=function(t,e){for(var r=bt.findChildOfType(t,"pictureback"),i=bt.findChildOfType(t,"picture"),n=bt.findChildOfType(t,"grid"),a=bt.childElements(bt.findChildOfType(t,"legend")),o="true"==t.getAttribute("show-pdf"),s="true"==t.getAttribute("show-cdf"),l="true"==t.getAttribute("show-mean"),u=yt.getFloatAttribute(t,"bar-width"),c=yt.getFloatAttribute(r,"x"),h=yt.getFloatAttribute(r,"y"),d=yt.getFloatAttribute(r,"width"),p=yt.getFloatAttribute(r,"height"),f=yt.splitSkipEmpty(e," "),m=f.length,g=1/0,v=-1/0,b=1/0,y=-1/0,A=[],T=[],C=[],S=[],E=[],w=[],k=[],x=[],M=[],O=0;O<m;O++)if("empty"!=f[O]){f[O]=yt.splitSkipEmpty(f[O],":"),A[O]="true"==f[O][0],T[O]="true"==f[O][1],C[O]=parseFloat(f[O][2]),S[O]=parseFloat(f[O][3]),E[O]=parseFloat(f[O][4]),w[O]=parseInt(f[O][5]),k[O]=parseInt(f[O][6]),x[O]=yt.splitToFloats(f[O][7],"|");for(var I=0;I<x[O].length;I++)x[O][I]<b&&(b=x[O][I]),y<x[O][I]&&(y=x[O][I]);A[O]&&(M[O]=yt.splitToFloats(f[O][8],"|")),C[O]<g&&(g=C[O]),v<S[O]&&(v=S[O])}g==1/0&&(g=0,v=0),b==1/0&&(b=0,y=1),this.chartScaleAndGrid.recalcChartScale(t,g,v,!1,!1),this.chartScaleAndGrid.recalcChartScale(t,0,y,!0,!1);var _=yt.getFloatAttribute(n,"min-x"),L=yt.getFloatAttribute(n,"max-x"),P=yt.getFloatAttribute(n,"min-y"),R=yt.getFloatAttribute(n,"max-y"),D=d/(L-_),F=p/(R-P),N=bt.childElements(i);for(O=0;O<m;O++)if("empty"!=f[O]){"hidden"==N[O].getAttribute("visibility")&&N[O].setAttribute("visibility","inherit");var B=x[O].length,G=(S[O]-C[O])/B,U=a[O].getAttribute("original-color"),z=void 0,W=void 0;if(T[O]&&(z=a[O].getAttribute("low-color"),W=a[O].getAttribute("high-color")),o){var H=N[O].firstElementChild,V=u*G*D,Y=G*(1-u)/2;for(I=0;I<B;I++){var j=c+(C[O]+I*G+Y-_)*D,X=h+(R-x[O][I])*F,q=x[O][I]*F,Z=bt.childElements(H)[I];Z?Z.setAttribute("visibility","inherit"):(Z=bt.createSvgElement("rect"),H.appendChild(Z)),yt.setMultipleAttributes(Z,["x","y","width","height"],[yt.reducePrecision(j),yt.reducePrecision(X),yt.reducePrecision(V),yt.reducePrecision(q)]),A[O]&&T[O]&&I<w[O]?Z.setAttribute("fill",z):A[O]&&T[O]&&k[O]<I?Z.setAttribute("fill",W):Z.setAttribute("fill",U)}var K=bt.childElements(H);for(I=B;I<K.length;I++)K[I].setAttribute("visibility","hidden")}if(s){var Q=o?N[O].firstElementChild.nextElementSibling:N[O].firstElementChild,J="";if(J+=c+(C[O]-_)*D+" "+(h+p)+" ",A[O])for(I=0;I<B;I++){J+=yt.reducePrecision(c+(C[O]+(I+1)*G-_)*D)+","+yt.reducePrecision(h+(1-M[O][I])*p)+" "}Q.setAttribute("points",J)}if(l){var $=N[O].lastElementChild,tt=c+(E[O]-_)*D;$.setAttribute("x1",tt),$.setAttribute("x2",tt)}if("NONE"!=t.getAttribute("leg-pos")){var et=bt.findChildOfType(a[O],"value");et.firstChild.textContent=yt.formatNumber(E[O],void 0),et.setAttribute("fill",a[O].getAttribute("mean-color"))}}else N[O].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&It.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var n=bt.findChildOfType(t,"picture"),a=bt.childElements(n),o=bt.childElements(a[e]),s=0;s<o.length;s++)o[s].setAttribute("visibility",r?"hidden":"inherit")},t}(),wt=function(){function t(t){this.frameDrawing=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",n=t.getAttribute("scale-type-"+i),a=bt.findChildOfType(t,"grid"),o=bt.findChildOfType(t,"pictureback"),s=bt.findChildOfType(t,e?"pictureborderh":"pictureborderw"),l=a.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=l){var u=yt.getFloatAttribute(o,"x"),c=yt.getFloatAttribute(o,"y"),h=yt.getFloatAttribute(o,"width"),d=yt.getFloatAttribute(o,"height"),p="GRID_DEFAULT"==l,f="ChartBar"==r||"ChartStack"==r,m=t.getAttribute("bar-dir");e?f&&(!f||"NORTH"!=m&&"SOUTH"!=m)||yt.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c,u,c+d]:[u+h,c,u+h,c+d]):f&&(!f||"EAST"!=m&&"WEST"!=m)||yt.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c+d,u+h,c+d]:[u,c,u+h,c])}var g=a.getAttribute("grid-line-color");switch(a.setAttribute("grid-line-color",yt.increaseTransparency(g,.5)),n){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var v=yt.getFloatAttribute(t,"scale-min-"+i),b=yt.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(v="ChartStack"==r?0:Math.min(0,v),b=Math.max(0,b)),this.recalcChartScale(t,v,b,e,!0);break;case"SCALE_TIME_WINDOW":b=Math.max(0,yt.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,b,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,n){var a=bt.findChildOfType(t,"grid"),o=i?"min-y":"min-x",s=i?"max-y":"max-x";if(e!=yt.getFloatAttribute(a,o)||r!=yt.getFloatAttribute(a,s)){var l=e,u=r;if(l==u){if(n)return;l-=1,u+=1}var c=bt.findChildOfType(t,"pictureback"),h=yt.getFloatAttribute(c,i?"height":"width"),d=i?25:45,p=(u-l)/Math.floor(h/d),f=Math.pow(10,Math.ceil(Math.log(u-l)/Math.log(10))-1),m=f/5;m<p&&(m=f/2)<p&&(m=f)<p&&(m=2*f)<p&&(m=5*f),n?(l=Math.ceil(l/m)*m,u=Math.floor(u/m)*m):(l=Math.floor(l/m)*m,u=Math.ceil(u/m)*m);var g=n?e:l,v=n?r:u;yt.setMultipleAttributes(a,[o,s],[g,v]),this.drawChartGrid(t,l,u,m,g,v,i)}},t.prototype.drawChartGrid=function(t,e,r,i,n,a,o){var s=t.getAttribute("type"),l=bt.findChildOfType(t,"grid"),u=l.getAttribute(o?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=u){var c=o?l.lastElementChild:l.firstElementChild,h=bt.findChildOfType(t,"pictureback"),d=l.getAttribute("grid-text-color"),p=l.getAttribute("grid-line-color"),f=o?"scale-type-y":"scale-type-x",m="SCALE_100_PERCENT"==t.getAttribute(f),g="SCALE_TIME_WINDOW"==t.getAttribute(f)?t.getAttribute("date-format-pattern"):"null",v=Math.round((r-e)/i)+1,b="GRID_DEFAULT"==u,y=!0;if("ChartBar"==s||"ChartStack"==s){var A=t.getAttribute("bar-dir");"SOUTH"!=A&&"WEST"!=A||(y=!1)}for(var T=yt.getFloatAttribute(h,"x"),C=yt.getFloatAttribute(h,"y"),S=yt.getFloatAttribute(h,"width"),E=yt.getFloatAttribute(h,"height"),w=a-n,k=(o?E:S)/w,x=i*k;c.childElementCount<v;){var M=bt.cloneElementWithId("grid-item");c.appendChild(M)}for(var O=bt.childElements(c),I=e,_=o?y?C+(a-e)*k:C+(e-n)*k:y?T+(e-n)*k:T+(a-e)*k,L=0;L<v;L++){var P=o?b?T-4:T:_,R=o?_:b?C+E+4:C+E,D=o?b?T+S:T+S+4:_,F=o?_:b?C:C-4,N=o?b?P-3:D+3:P,B=o?R+3:b?R+11:F-3,G=o?b?"end":"start":"middle";(M=O[L]).setAttribute("visibility","inherit");var U=M.lastElementChild;yt.setMultipleAttributes(U,["x1","x2","y1","y2","stroke"],[P,D,R,F,p]);var z=M.firstElementChild;yt.setMultipleAttributes(z,["x","y","text-anchor","fill"],[N,B,G,d]);var W=void 0;W=m?yt.formatPercent(I):"null"!=g?this.gridFormattedDate(I,w,g):yt.formatNumber(I,void 0),z.firstChild.textContent=W,I+=i,_+=o?y?-x:+x:y?+x:-x}for(L=v;L<O.length;L++)O[L].setAttribute("visibility","hidden")}},t.prototype.gridFormattedDate=function(t,e,r){var i=yt.toDate(this.frameDrawing,t),n=yt.toMilliseconds(this.frameDrawing,e);return n>5*yt.YEAR?yt.formatDate(i,"YYYY"):n>5*yt.MONTH?yt.formatDate(i,"MMMYYYY"):n>5*yt.DAY?yt.formatDate(i,"DDMMM"):n>5*yt.HOUR?yt.formatDate(i,"DDMMHH"):n>5*yt.MINUTE?yt.formatDate(i,"HHmm"):yt.formatDate(i,"mmss")},t}(),kt=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e,r,i=t.getAttribute("type"),n=bt.findChildOfType(t,"pictureback"),a=bt.findChildOfType(t,"picture"),o=bt.childElements(bt.findChildOfType(t,"legend")),s=o.length,l=yt.getFloatAttribute(n,"x"),u=yt.getFloatAttribute(n,"y"),c=yt.getFloatAttribute(n,"width"),h=yt.getFloatAttribute(n,"height");if("ChartBar"==i||"ChartStack"==i){var d=t.getAttribute("bar-dir");e="NORTH"==d||"SOUTH"==d;var p=yt.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?c/s:h/s)*p:(e?c:h)*p}for(var f=0;f<s;f++){var m=void 0,g=o[f].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(m=bt.createSvgElement("rect")).setAttribute("stroke","none"),m.setAttribute("fill",g);var v=void 0;e?(v=c/s,m.setAttribute("x","ChartBar"==i?l+v*f+(v-r)/2:l+(c-r)/2),m.setAttribute("width",r)):(v=h/s,m.setAttribute("y","ChartBar"==i?u+v*f+(v-r)/2:u+(h-r)/2),m.setAttribute("height",r)),a.appendChild(m);break;case"ChartPie":(m=bt.createSvgElement("path")).setAttribute("stroke","none"),m.setAttribute("fill",g),a.appendChild(m)}It.addClickTapHandlerToChartItem(m)}},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=bt.findChildOfType(t,"pictureback"),n=bt.findChildOfType(t,"picture"),a=bt.childElements(n),o=bt.findChildOfType(t,"grid"),s=yt.getFloatAttribute(i,"x"),l=yt.getFloatAttribute(i,"y"),u=yt.getFloatAttribute(i,"width"),c=yt.getFloatAttribute(i,"height"),h=yt.splitSkipEmpty(e," "),d=h.length,p=1/0,f=-1/0,m=!1,g=0,v=0;v<d;v++)h[v]=parseFloat(h[v]),h[v]<p&&(p=h[v]),f<h[v]&&(f=h[v]),h[v]<0&&(m=!0),g+=h[v];var b=!1;if("ChartBar"==r||"ChartStack"==r){var y=t.getAttribute("bar-dir"),A="NORTH"==y||"SOUTH"==y;"ChartBar"==r?(p=Math.min(0,p),f=Math.max(0,f)):(p=0,f=Math.max(0,g));var T=t.getAttribute(A?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=T&&"SCALE_AUTO_FROM_0"!=T||this.chartScaleAndGrid.recalcChartScale(t,p,f,A,!1),b="SCALE_100_PERCENT"==T;var C=yt.getFloatAttribute(o,A?"min-y":"min-x"),S=yt.getFloatAttribute(o,A?"max-y":"max-x"),E=(A?c:u)/(S-C),w=0;for(v=0;v<d;v++)if("ChartStack"==r&&(m||0==g)||"ChartBar"==r&&b&&(m||0==g))a[v].setAttribute(A?"height":"width",0);else{var k=b?h[v]/g:h[v],x=Math.abs(k),M=void 0;if("ChartBar"==r)switch(y){case"NORTH":case"WEST":M=k>0?S-k:S;break;case"SOUTH":case"EAST":M=k<0?k-C:-C}else{switch(y){case"NORTH":case"WEST":M=S-(k+w);break;case"SOUTH":case"EAST":M=-C+w}w+=k}x*=E;var O=A?c:u;(M*=E)<0?(x-=-M,M=0):M+x>O&&(x-=M+x-O),x<0&&(x=0),A?(a[v].setAttribute("y",l+M),a[v].setAttribute("height",x)):(a[v].setAttribute("x",s+M),a[v].setAttribute("width",x))}}else{var I=-Math.PI/2;for(v=0;v<d;v++){var _=g<=0||m?0:2*Math.PI*(h[v]/g),L=u/2,P=c/2,R=yt.sectorData(s+L,l+P,L,P,I,_);a[v].setAttribute("d",R),I+=_}}if(("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&b)&&m?It.showChartWarning(t,"Neg!"):It.hideChartWarning(t),"NONE"!=t.getAttribute("leg-pos")){var D=bt.childElements(bt.findChildOfType(t,"legend"));for(v=0;v<d;v++){var F=bt.findChildOfType(D[v],"value"),N=yt.formatNumber(h[v],void 0);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&b)&&g>0&&!m&&(N+=" ("+yt.formatPercent(h[v]/g)+")"),F.firstChild.textContent=N,F.setAttribute("fill",h[v]>=0?"royalBlue":"fireBrick")}It.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){bt.childElements(bt.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t}(),xt=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(e){for(var r=e.getAttribute("type"),i=bt.findChildOfType(e,"picture"),n=bt.childElements(bt.findChildOfType(e,"legend")),a=n.length,o=0;o<a;o++){var s=n[o].getAttribute("original-color"),l=bt.createSvgElement("g");switch(n[o].setAttribute("data","empty"),r){case"ChartPlot":case"ChartTimePlot":if("true"==n[o].getAttribute("draw-line")){var u=bt.createSvgElement("polyline");if(u.setAttribute("fill","none"),u.setAttribute("stroke",s),u.setAttribute("stroke-width",n[o].getAttribute("line-width")),l.appendChild(u),"ChartTimePlot"==r){var c=bt.createSvgElement("polyline");c.setAttribute("stroke","none"),c.setAttribute("fill",yt.increaseTransparency(s,t.timePlotAlpha)),l.appendChild(c)}}if("POINT_NONE"!=n[o].getAttribute("point-style")){var h=bt.createSvgElement("g");h.setAttribute("fill",s),l.appendChild(h)}break;case"ChartTimeStack":var d=bt.createSvgElement("polyline");d.setAttribute("stroke-width","1"),d.setAttribute("stroke",s),d.setAttribute("fill","none"),l.appendChild(d);var p=bt.createSvgElement("polyline");p.setAttribute("stroke","none"),p.setAttribute("fill",yt.increaseTransparency(s,t.stackChartAlpha)),l.appendChild(p)}i.appendChild(l),It.addClickTapHandlerToChartItem(l)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),n=bt.findChildOfType(e,"pictureback"),a=bt.findChildOfType(e,"picture"),o=bt.findChildOfType(e,"grid"),s=bt.childElements(bt.findChildOfType(e,"legend")),l=yt.getFloatAttribute(n,"x"),u=yt.getFloatAttribute(n,"y"),c=yt.getFloatAttribute(n,"width"),h=yt.getFloatAttribute(n,"height"),d=u+h,p=t.mergeData(e,r),f=p.length,m=t.parseDataAndFindMinMax(p),g=m.datasets,v=m.minx,b=m.maxx,y=m.miny,A=m.maxy;if("ChartTimeStack"==i&&y<0)It.showChartWarning(e,"Neg!");else{It.hideChartWarning(e),"ChartTimeStack"==i&&(y=0,A=t.prepareChartTimeStackData(g));var T,C=e.getAttribute("scale-type-x"),S=e.getAttribute("scale-type-y"),E="SCALE_100_PERCENT"==S;if("SCALE_AUTO"==C)this.chartScaleAndGrid.recalcChartScale(e,v,b,!1,!1);else if("SCALE_TIME_WINDOW"==C){T=yt.getFloatAttribute(e,"scale-max-x");var w=void 0;w="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(b,T):Math.max(b,T,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,w-T,w,!1,!0)}"SCALE_AUTO"==S&&this.chartScaleAndGrid.recalcChartScale(e,y,A,!0,!1);for(var k=yt.getFloatAttribute(o,"min-x"),x=yt.getFloatAttribute(o,"max-x"),M=yt.getFloatAttribute(o,"min-y"),O=yt.getFloatAttribute(o,"max-y"),I=c/(x-k),_=h/(O-M),L=bt.childElements(a),P="",R=0;R<f;R++){var D=void 0,F=void 0,N=void 0,B=void 0,G=void 0,U=void 0,z=void 0,W=void 0,H=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(D="true"==s[R].getAttribute("draw-line"),F=s[R].getAttribute("point-style"),N="INTERPOLATION_STEP"==s[R].getAttribute("interpolation")),(D||"ChartTimeStack"==i)&&(G=(B=L[R].firstElementChild).nextElementSibling),F&&"POINT_NONE"!=F)switch(U=L[R].lastElementChild,F){case"POINT_CIRCLE":z="plot-point-circle",W=0,H=0;break;case"POINT_SQUARE":z="plot-point-square",W=-1.5,H=-1.5;break;case"POINT_TRIANGLE":z="plot-point-triangle",W=0,H=0}for(var V=void 0,Y=void 0,j="",X="",q=void 0,Z=void 0,K=0,Q=0;Q<g[R].length;Q++){var J=l+(g[R][Q][0]-k)*I,$=void 0;if(E){var tt=g[f-1][Q][1];$=tt<=0?0:g[R][Q][1]/tt}else $=g[R][Q][1];var et=u+(-$+O)*_;if(J<l&&(J=l),l+c<J&&(J=l+c),et<u&&(et=u),u+h<et&&(et=u+h),!(null!=V&&Math.abs(J-V)<It.chartTolerance&&Math.abs(et-Y)<It.chartTolerance)){if(J=yt.reducePrecision(J),et=yt.reducePrecision(et),0==Q&&(q=J),Z=J,B&&(N&&null!=V&&(j+=J+","+Y+" "),j+=J+","+et+" ",G&&(0==R&&(P=J+","+d+" "+P),X=J+","+et+" "+X)),U){var rt=bt.childElements(U)[K];rt?rt.setAttribute("visibility","inherit"):(rt=bt.createUseElement(z),U.appendChild(rt)),rt.setAttribute("x",W+J),rt.setAttribute("y",H+et)}K++,V=J,Y=et}}if(B&&(B.setAttribute("points",j),G))if("ChartTimePlot"==i){var it="";if(""!=j){var nt=u+O*_;nt<u&&(nt=u),u+h<nt&&(nt=u+h),it=Z+","+nt+" "+q+","+nt}G.setAttribute("points",j+it)}else G.setAttribute("points",j+P),P=X;if(U){var at=bt.childElements(U);for(Q=K;Q<at.length;Q++)at[Q].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,n){var a=e.getAttribute("type"),o=bt.childElements(bt.findChildOfType(e,"legend")),s=bt.childElements(bt.findChildOfType(e,"picture"));if("ChartTimeStack"==a)s[r].firstElementChild.setAttribute("stroke",n),s[r].lastElementChild.setAttribute("fill",yt.increaseTransparency(n,t.stackChartAlpha));else{if("true"==o[r].getAttribute("draw-line")){var l=s[r].firstElementChild;l.setAttribute("stroke",n),"ChartTimePlot"==a&&l.nextElementSibling.setAttribute("fill",yt.increaseTransparency(n,t.timePlotAlpha))}"POINT_NONE"!=o[r].getAttribute("point-style")&&s[r].lastElementChild.setAttribute("fill",n)}},t.mergeData=function(e,r){for(var i=bt.childElements(bt.findChildOfType(e,"legend")),n=yt.splitSkipEmpty(r," "),a=n.length,o=[],s=0;s<a;s++){var l=i[s].getAttribute("data"),u=t.mergeDataset(l,n[s]);i[s].setAttribute("data",u),o.push(u)}return o},t.mergeDataset=function(t,e){var r=yt.splitSkipEmpty(e,"#"),i=parseInt(r[0]),n=parseInt(r[1]),a=r[2];if("empty"==t||0==n)return a;var o=yt.splitSkipEmpty(t,"|");o.splice(0,i),o.splice(n);var s=o.join("|")+"|";return"empty"==a?s:s+a},t.parseDataAndFindMinMax=function(t){for(var e=t,r=e.length,i=1/0,n=-1/0,a=1/0,o=-1/0,s=0;s<r;s++)if("empty"==e[s])e[s]=[];else{e[s]=yt.splitSkipEmpty(e[s],"|");for(var l=0;l<e[s].length;l++){e[s][l]=e[s][l].split(":");var u=e[s][l][0]=parseFloat(e[s][l][0]),c=e[s][l][1]=parseFloat(e[s][l][1]);u<i&&(i=u),n<u&&(n=u),c<a&&(a=c),o<c&&(o=c)}}return i==1/0&&(i=0,n=0),a==1/0&&(a=0,o=0),{datasets:e,minx:i,maxx:n,miny:a,maxy:o}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a].length<=i||t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),Mt=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=bt.findChildOfType(t,"picture"),r=bt.findChildOfType(t,"pictureback"),i=yt.getFloatAttribute(r,"x"),n=yt.getFloatAttribute(r,"y"),a=yt.getFloatAttribute(r,"width"),o=yt.getFloatAttribute(r,"height"),s=bt.cloneElementWithId("normal-text");s.setAttribute("fill","grey"),s.setAttribute("text-anchor","middle"),s.setAttribute("x",(i+a/2).toString()),s.setAttribute("y",(n+o/2+3).toString()),s.firstChild.textContent="Not supported at the moment",e.appendChild(s)},t.draw=function(t,e){},t.setItemLook=function(t,e,r,i){},t}(),Ot=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=bt.findChildOfType(t,"picture"),r=bt.findChildOfType(t,"pictureback"),i=yt.getFloatAttribute(r,"x"),n=yt.getFloatAttribute(r,"y"),a=yt.getFloatAttribute(r,"height"),o=bt.childElements(bt.findChildOfType(t,"legend")),s=o.length,l=a/s,u=l*yt.getFloatAttribute(t,"bar-width"),c=(l-u)/2;t.setAttribute("rect-height",yt.reducePrecision(u).toString());for(var h=0;h<s;h++){o[h].setAttribute("data","empty");var d=bt.createSvgElement("g");d.setAttribute("transform","translate("+i+","+(n+h*l+c)+")"),e.appendChild(d),It.addClickTapHandlerToChartItem(d)}},t.prototype.draw=function(e,r){for(var i=bt.findChildOfType(e,"pictureback"),n=bt.findChildOfType(e,"picture"),a=bt.findChildOfType(e,"grid"),o=(yt.getFloatAttribute(i,"x"),yt.getFloatAttribute(i,"width")),s=xt.mergeData(e,r),l=s.length,u=-1/0,c=0;c<l;c++)if("empty"==s[c])s[c]=[];else{s[c]=yt.splitSkipEmpty(s[c],"|");for(var h=0;h<s[c].length;h++)s[c][h]=s[c][h].split(":"),s[c][h][0]=parseFloat(s[c][h][0]),s[c][h][1]=parseFloat(s[c][h][1]);var d=s[c][s[c].length-1][0];u<d&&(u=d)}u==1/0&&(u=0);for(c=0;c<l;c++)0!=s[c].length&&s[c][s[c].length-1][0]<u&&s[c].push([u,s[c][s[c].length-1][1]]);var p,f=yt.getFloatAttribute(e,"scale-max-x");p="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(u,f):Math.max(u,f,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,p-f,p,!1,!0);var m=yt.getFloatAttribute(a,"min-x"),g=o/(yt.getFloatAttribute(a,"max-x")-m),v=bt.childElements(n),b=yt.getFloatAttribute(e,"rect-height"),y=t.colorMapping(e);for(c=0;c<l;c++){var A=v[c],T=bt.childElements(A),C=T.length,S=0,E="",w=null;for(h=0;h<s[c].length;h++){var k=s[c][h][0],x=s[c][h][1];if(k<m)w=0,E=y(x);else if(null==w)w=(k-m)*g,E=y(x);else{var M=y(x);if(M!=E||h==s[c].length-1){var O=(k-m)*g,I=void 0;S<C?(I=T[S],S++,I.setAttribute("visibility","inherit")):(I=bt.createSvgElement("rect"),A.appendChild(I)),yt.setMultipleAttributes(I,["x","width","height","fill"],[yt.reducePrecision(w),yt.reducePrecision(O-w),b,E]),w=O,E=M}}}for(var _=S;_<C;_++)T[_].setAttribute("visibility","hidden")}},t.colorMapping=function(t){var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color");e=yt.splitSkipEmpty(e," ");for(var i=[],n=[],a=function(t){var r=e[t].split(":"),a=void 0,o=parseFloat(r[1]);switch(r[0]){case"GREATER":a=function(t){return t>o};break;case"GREATER_OR_EQUALS":a=function(t){return t>=o};break;case"LESS":a=function(t){return t<o};break;case"LESS_OR_EQUALS":a=function(t){return t<=o};break;case"EQUALS":a=function(t){return t==o};break;case"NOT_EQUALS":a=function(t){return t!=o}}i[t]=a,n[t]=r[2]},o=0;o<e.length;o++)a(o);return function(t){for(var e=0;e<i.length;e++)if(i[e](t))return n[e];return r}},t.setItemLook=function(t,e,r,i){var n=bt.findChildOfType(t,"picture");bt.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),It=function(){function t(t){this.frameDrawing=t,this.chartScaleAndGrid=new wt(t),this.chart1D=new kt(t,this.chartScaleAndGrid),this.chart2D=new xt(t,this.chartScaleAndGrid),this.chartHistogram=new Et(t,this.chartScaleAndGrid),this.chartHistogram2D=new Mt(t,this.chartScaleAndGrid),this.chartTimeColor=new Ot(t,this.chartScaleAndGrid)}return t.create=function(){return bt.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var n=e.getAttribute("type"),a=bt.findChildOfType(e,"background"),o=bt.findChildOfType(e,"pictureback"),s=bt.findChildOfType(e,"pictureselect"),l=bt.findChildOfType(e,"pictureborderh"),u=bt.findChildOfType(e,"pictureborderw"),c=bt.findChildOfType(e,"grid"),h=0;h<r.length;h++)switch(r[h]){case"width":case"height":case"fill":case"stroke":a.setAttribute(r[h],i[h]);break;case"pic-width":case"pic-height":o.setAttribute(r[h].substring(4),i[h]),s.setAttribute(r[h].substring(4),i[h]);break;case"pic-fill":o.setAttribute(r[h].substring(4),i[h]);break;case"pic-stroke":l.setAttribute(r[h].substring(4),i[h]),u.setAttribute(r[h].substring(4),i[h]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":c.setAttribute(r[h],i[h]);break;case"grid-completed":"ChartPie"!=n&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":t.addItem(e,i[h]);break;case"items-completed":t.setupLegendItemsLayout(e),t.setupPicture(e);break;case"data":this.drawPicture(e,i[h]);break;default:e.setAttribute(r[h],i[h])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=bt.findChildOfType(e,"background"),n=bt.findChildOfType(e,"pictureback"),a=bt.findChildOfType(e,"pictureselect"),o=bt.findChildOfType(e,"pictureborderh"),s=bt.findChildOfType(e,"pictureborderw"),l=bt.findChildOfType(e,"warning"),u=bt.findChildOfType(e,"legend"),c=e.getAttribute("leg-pos"),h=yt.getFloatAttribute(i,"width"),d=yt.getFloatAttribute(i,"height"),p=yt.getFloatAttribute(e,"pic-offset-x"),f=yt.getFloatAttribute(e,"pic-offset-y"),m=yt.getFloatAttribute(n,"width"),g=yt.getFloatAttribute(n,"height"),v=yt.getFloatAttribute(e,"leg-size"),b=0,y=0,A=0,T=0;switch(c){case"SOUTH":b=p,y=d-v,A=h-p,T=v;break;case"WEST":p+=v,b=0,y=f,A=v,T=d-f;break;case"EAST":b=h-v,y=f,A=v,T=d-f;break;case"NORTH":f+=v,b=p,y=0,A=h-p,T=v}if(yt.setMultipleAttributes(n,["x","y"],[p,f]),yt.setMultipleAttributes(a,["x","y"],[p,f]),yt.setMultipleAttributes(l,["x","y"],[p+m/2,f+g/2+3]),"NONE"==c?u.setAttribute("visibility","hidden"):(u.setAttribute("transform","translate("+b+","+y+")"),yt.setMultipleAttributes(u,["width","height"],[A,T])),"ChartPie"==r){var C=m/2,S=g/2,E=bt.createSvgElement("ellipse");yt.setMultipleAttributes(E,["cx","cy","rx","ry","stroke","fill","visibility"],[p+C,f+S,C,S,"none",n.getAttribute("fill"),"hidden"]),e.insertBefore(E,n);var w=bt.createSvgElement("ellipse");yt.setMultipleAttributes(w,["cx","cy","rx","ry","stroke","fill"],[p+C,f+S,C,S,o.getAttribute("stroke"),"none"]),e.insertBefore(w,o),bt.removeElement(e,o),bt.removeElement(e,s)}e.onmouseover=function(e){return t.selectChart(e,!0)},e.onmouseout=function(e){return t.selectChart(e,!1)}},t.setupLegendItemsLayout=function(t){for(var e=bt.findChildOfType(t,"legend"),r=bt.childElements(e),i=yt.getFloatAttribute(e,"width"),n=0,a=0,o=0;o<r.length;o++){var s=r[o],l=bt.findChildOfType(s,"back"),u=yt.getFloatAttribute(l,"width"),c=bt.findChildOfType(s,"value"),h=c.getComputedTextLength(),d=Math.max(u,yt.getFloatAttribute(c,"x")+h);l.setAttribute("width",d.toString()),0<n&&i<n+d&&(n=0,a+=20),s.setAttribute("transform","translate("+n+","+a+")"),n+=d+5}},t.showChartWarning=function(t,e){var r=bt.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=bt.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=bt.findChildOfType(t,"picture"),r=bt.findChildOfType(t,"legend");bt.removeAllChildren(r),bt.removeAllChildren(e)},t.addItem=function(e,r){var i=e.getAttribute("type"),n=bt.findChildOfType(e,"legend"),a=r.split("\n"),o=a[0],s=a[1],l=bt.cloneElementWithId("legend-item"),u=bt.findChildOfType(l,"color"),c=bt.findChildOfType(l,"name"),h=bt.findChildOfType(l,"value");u.setAttribute("fill",o),l.setAttribute("original-color",o),c.setAttribute("fill",e.getAttribute("leg-text-color")),c.appendChild(bt.createTextNode(s)),h.appendChild(bt.createTextNode("")),n.appendChild(l);var d=c.getComputedTextLength();h.setAttribute("x",(yt.getFloatAttribute(c,"x")+d+4).toString()),"ChartPlot"==i||"ChartTimePlot"==i?yt.setMultipleAttributes(l,["draw-line","line-width","interpolation","point-style"],[a[2],a[3],a[4],a[5]]):"ChartHistogram"==i&&yt.setMultipleAttributes(l,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[a[2],a[3],a[4],a[5],a[6]]),t.addClickTapHandlerToChartItem(l)},t.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":kt.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":xt.setup(t);break;case"ChartTimeColor":Ot.setup(t);break;case"ChartHistogram":Et.setup(t);break;case"ChartHistogram2D":Mt.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":Mt.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.selectChart=function(t,e){var r=t.currentTarget;bt.findChildOfType(r,"pictureselect").setAttribute("visibility",e?"inherit":"hidden")},t.addClickTapHandlerToChartItem=function(e){new f(e,function(r){return t.selectChartItem(e,!0,!1)},function(r){return t.selectChartItem(e,!1,!1)},null,function(r){return t.selectChartItem(e,!0,!0)},function(t){return!1})},t.selectChartItem=function(e,r,i){for(var n=t.getChartShape(e),a=yt.indexInParent(e),o=bt.childElements(bt.findChildOfType(n,"legend")),s=o[a],l="true"==s.getAttribute("selected"),u=!1,c=0;c<o.length;c++)if(c!=a&&"true"==o[c].getAttribute("selected")){u=!0;break}if(i)return l=!l,s.setAttribute("selected",l?"true":"false"),void t.setChartItemLook(n,a,!1,l);if(l||u){if(l)return;t.setChartItemLook(n,a,!r,r)}else{t.setChartItemLook(n,a,!1,r);for(c=0;c<o.length;c++)c!=a&&t.setChartItemLook(n,c,r,!1)}},t.setChartItemLook=function(e,r,i,n){var a=bt.childElements(bt.findChildOfType(e,"legend")),o=bt.findChildOfType(a[r],"back"),s=bt.findChildOfType(a[r],"color");o.setAttribute("class",n?"legend-item-background-selected":"legend-item-background");var l=i?t.colorItemGrayed:a[r].getAttribute("original-color");switch(s.setAttribute("fill",l),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":kt.setItemLook(e,r,i,l);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":xt.setItemLook(e,r,i,l);break;case"ChartTimeColor":Ot.setItemLook(e,r,i,l);break;case"ChartHistogram":Et.setItemLook(e,r,i,l);break;case"ChartHistogram2D":Mt.setItemLook(e,r,i,l)}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),_t=function(){function t(t){var e=this;this.client=t,this.onWindowResizeEventClosure=function(t){return e.applyNavigationSettings()},this.onSVGPointingEventClosure=function(t){return e.onSVGPointingEvent(t)}}return t.prototype.initSVGNavigation=function(){window.addEventListener("resize",this.onWindowResizeEventClosure,!1),E.addFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.oncontextmenu=function(){return!1},t.addEventListener("mousedown",this.onSVGPointingEventClosure),t.addEventListener("mousemove",this.onSVGPointingEventClosure),t.addEventListener("mouseup",this.onSVGPointingEventClosure),t.addEventListener("mouseout",this.onSVGPointingEventClosure),t.addEventListener("wheel",this.onSVGPointingEventClosure),t.addEventListener("touchstart",this.onSVGPointingEventClosure),t.addEventListener("touchmove",this.onSVGPointingEventClosure),t.addEventListener("touchend",this.onSVGPointingEventClosure),this.buttonDown=0,this.prevPtrCoords=[],this.presentationCoords=[0,0],this.zoom=1},t.prototype.clearSVGNavigation=function(){if(this.client.svg){window.removeEventListener("resize",this.onWindowResizeEventClosure),E.removeFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.removeEventListener("mousedown",this.onSVGPointingEventClosure),t.removeEventListener("mousemove",this.onSVGPointingEventClosure),t.removeEventListener("mouseup",this.onSVGPointingEventClosure),t.removeEventListener("mouseout",this.onSVGPointingEventClosure),t.removeEventListener("wheel",this.onSVGPointingEventClosure),t.removeEventListener("touchstart",this.onSVGPointingEventClosure),t.removeEventListener("touchmove",this.onSVGPointingEventClosure),t.removeEventListener("touchend",this.onSVGPointingEventClosure)}},t.prototype.onSVGPointingEvent=function(e){e.stopPropagation();var r=yt.offsetPage(this.client.svg);if(e.type.startsWith("mouse")||"wheel"==e.type){var i=e,n=i.pageX-r.left,a=i.pageY-r.top;switch(i.type){case"mousedown":this.buttonDown=i.which,this.prevPtrCoords=[n,a],1==this.buttonDown||this.buttonDown;break;case"mousemove":if(1==this.buttonDown)i.preventDefault();else if(3==this.buttonDown){var o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];this.applyPanning(o,s),this.prevPtrCoords=[n,a]}break;case"mouseup":case"mouseout":if(this.client.svg.parentNode.contains(i.relatedTarget))return;var l=this.buttonDown;if(this.buttonDown=0,1==l){o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];Math.abs(o)<=t.clickTolerance&&Math.abs(s)<=t.clickTolerance&&this.onPresentationClick(i,n,a)}this.prevPtrCoords=[];break;case"wheel":var u=e;u.altKey?this.onWheelZooming(0<u.deltaY,n,a):(e.preventDefault(),0<u.deltaY?this.applyPanning(0,-50):this.applyPanning(0,50))}}else if(e.type.startsWith("touch")){var c=e,h=void 0,d=void 0,p=void 0,f=void 0;switch(c.touches.length>0&&(h=c.touches[0].pageX-r.left,d=c.touches[0].pageY-r.top),c.touches.length>1&&(p=c.touches[1].pageX-r.left,f=c.touches[1].pageY-r.top),c.type){case"touchstart":this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchmove":if(c.preventDefault(),c.touches.length>1&&4==this.prevPtrCoords.length){var m=(h+p)/2,g=(d+f)/2,v=Math.hypot(this.prevPtrCoords[2]-this.prevPtrCoords[0],this.prevPtrCoords[3]-this.prevPtrCoords[1]),b=Math.hypot(p-h,f-d)/v*this.zoom;b=Math.max(b,t.zooms[0]),b=Math.min(b,t.zooms[t.zooms.length-1]),this.applyZoom(b,m,g)}else if(this.prevPtrCoords.length>=2){o=h-this.prevPtrCoords[0],s=d-this.prevPtrCoords[1];if(4==this.prevPtrCoords.length){var y=Math.hypot(o,s),A=h-this.prevPtrCoords[2],T=d-this.prevPtrCoords[3];Math.hypot(A,T)<y&&(o=A,s=T)}this.applyPanning(o,s)}this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchend":this.prevPtrCoords=[]}}},t.prototype.applyPresentationTransform=function(){var t=this.client.frameDrawing.navigationSettings;if(!t.zoomAndPanningEnabled){var e=this.zoom,r=this.presentationCoords[0],i=this.presentationCoords[1],n=this.client.svg.getBoundingClientRect(),a=n.width,o=n.height;e=Math.max(e,a/t.width),e=Math.max(e,o/t.height),r=Math.min(r,-t.x*e),r=Math.max(r,a-(t.x+t.width)*e),i=Math.min(i,-t.y*e),i=Math.max(i,o-(t.y+t.height)*e),this.presentationCoords=[r,i],this.zoom=e}var s="translate("+this.presentationCoords[0]+","+this.presentationCoords[1]+")",l="scale("+this.zoom+")";this.client.presentation.setAttribute("transform",s+" "+l)},t.prototype.applyZoom=function(t,e,r){if(t!=this.zoom){var i=this.client.frameDrawing.navigationSettings;if(!i.zoomAndPanningEnabled){var n=this.client.svg,a=this.client.svg.getBoundingClientRect(),o=a.width,s=a.height,l=i.width,u=i.height,c=n.parentNode.getBoundingClientRect(),h=c.width,d=c.height;if((t=l/u>h/d?Math.max(t,h/l):Math.max(t,d/u))==this.zoom)return;var p=Math.min(l*t,h),f=Math.min(u*t,d);p!=o&&n.setAttribute("width",p.toString()),f!=s&&n.setAttribute("height",f.toString())}var m=t/this.zoom,g=e-(e-this.presentationCoords[0])*m,v=r-(r-this.presentationCoords[1])*m;this.presentationCoords=[g,v],this.zoom=t,this.applyPresentationTransform()}},t.prototype.applyPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform()},t.prototype.navigateTo=function(t,e,r){this.zoom=r,this.presentationCoords=[-t*this.zoom,-e*this.zoom],this.applyPresentationTransform()},t.prototype.onWheelZooming=function(e,r,i){var n=this.zoom;if(e){for(var a=t.zooms.length-1;a>=0;a--)if(t.zooms[a]<this.zoom){n=t.zooms[a];break}}else for(a=0;a<t.zooms.length;a++)if(this.zoom<t.zooms[a]){n=t.zooms[a];break}this.applyZoom(n,r,i)},t.prototype.onPresentationClick=function(t,e,r){var i=e-this.presentationCoords[0],n=r-this.presentationCoords[1];i/=this.zoom,n/=this.zoom,this.client.frameDrawing.onUserClick(t.target,i,n)},t.prototype.applyNavigationSettings=function(){var t,e,r,i=this.client.svg,n=this.client.frameDrawing.navigationSettings,a=n.width,o=n.height,s=n.zoomAndPanningEnabled,l=n.width/n.height,u=i.parentNode.getBoundingClientRect(),c=u.width,h=u.height,d=c/h,p=n.x,f=n.y;l>d?(r=c/a,t=c,s?f-=((e=h)/r-o)/2:e=c/l):(r=h/o,s?p-=((t=c)/r-a)/2:t=h*l,e=h),yt.setMultipleAttributes(i,["width","height"],[t,e]),this.navigateTo(p,f,r)},t.clickTolerance=1,t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t}(),Lt=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return bt.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return bt.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return bt.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)r[n],e.setAttribute(r[n],i[n]);t.updateGISMarkupPosition(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=bt.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=yt.getFloatAttribute(t,"lon"),n=yt.getFloatAttribute(t,"lat"),a=Pt.lonLatToXY(r,i,n);yt.setMultipleAttributes(t,["cx","cy"],[a[0],a[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var o=t.getAttribute("lonlatpoints"),s=Pt.lonLatPointsToXYPoints(r,o);t.setAttribute("points",s)}},t}(),Pt=function(){function t(t){this.frameDrawing=t}return t.prototype.createShapeGISMap=function(){var t=this,e=bt.cloneElementWithId("shape-gis-map"),r=function(e){return t.onGISEvent(e)};e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r);var i=bt.findChildOfType(e,"map").firstElementChild;return bt.findChildOfType(i,"agents").addEventListener("click",function(e){return t.onGISAgentLayerClick(e)}),e},t.prototype.updateShapeGISMap=function(t,e,r){for(var i=bt.findChildOfType(t,"background"),n=bt.findChildOfType(t,"map"),a=bt.findChildOfType(t,"shadow"),o=bt.findChildOfType(t,"border"),s=0;s<e.length;s++)switch(e[s]){case"width":case"height":i.setAttribute(e[s],r[s]),n.setAttribute(e[s],r[s]),a.setAttribute(e[s],r[s]),o.setAttribute(e[s],r[s]);break;case"size-completed":t.getAttribute("zoom")&&this.redrawGISMap(t);break;case"background-color":i.setAttribute("fill",r[s]);break;case"border-color":o.setAttribute("stroke",r[s]);break;case"map-completed":this.redrawGISMap(t);break;default:t.setAttribute(e[s],r[s])}},t.prototype.redrawGISMap=function(e){this.redrawGISTiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.prototype.redrawGISTiles=function(e){var r=bt.findChildOfType(e,"background"),i=yt.getFloatAttribute(r,"width"),n=yt.getFloatAttribute(r,"height"),a=t.minGISZoom(i,n),o=bt.findChildOfType(e,"map").firstElementChild;o.setAttribute("transform","translate(0,0)");var s=yt.getIntAttribute(e,"zoom"),l=yt.getFloatAttribute(e,"center-lon"),u=yt.getFloatAttribute(e,"center-lat");s<a&&(s=a,e.setAttribute("zoom",s.toString()));var c,h=Math.pow(2,s),d=t.latToTileYFloat(u,s),p=n/2/t.tileImageSize;d-p<0?c=p:h<d+p&&(c=h-p),c&&(u=t.tileYToLat(c,s),e.setAttribute("center-lat",u.toString()));var f=bt.findChildOfType(o,"tiles");bt.removeAllChildren(f),this.updateGISTiles(f,s,u,l,0,0,i,n,h)},t.prototype.updateGISTiles=function(e,r,i,n,a,o,s,l,u){for(var c=t.lonToTileXInt(n,r),h=t.latToTileYInt(i,r),d=a+s/2-t.lonToXOffsetWithinTile(n,r),p=o+l/2-t.latToYOffsetWithinTile(i,r);d>0;)d-=t.tileImageSize,c--;for(;p>0;)p-=t.tileImageSize,h--;c=yt.modulo(c,u),h=yt.modulo(h,u);for(var f=[],m=bt.childElements(e),g=0;g<m.length;g++)f.push(m[g]);for(var v=c,b=d;b<s;b+=t.tileImageSize){for(var y=h,A=p;A<l;A+=t.tileImageSize){var T=r+"/"+v+"/"+y,C=null;for(g=0;g<f.length;g++)if(f[g].getAttribute("tileid")==T){C=f[g];break}null==C&&(C=this.addGISTile(e,r,v,y)),C.setAttribute("x",(b-a).toString()),C.setAttribute("y",(A-o).toString()),y=yt.modulo(y+1,u)}v=yt.modulo(v+1,u)}},t.prototype.addGISTile=function(e,r,i,n){var a=bt.findParentOfType(e,"ShapeGISMap"),o=this.tileURL(a,r,i,n),s=bt.createSvgElement("image");return s.setAttribute("width",t.tileImageSize.toString()),s.setAttribute("height",t.tileImageSize.toString()),s.setAttributeNS(bt.xlinkns,"href",o),s.setAttribute("tileid",r+"/"+i+"/"+n),e.appendChild(s),s},t.redrawGISMarkup=function(t){for(var e=bt.findChildOfType(t,"map").firstElementChild,r=bt.findChildOfType(e,"markup"),i=bt.childElements(r),n=0;n<i.length;n++)Lt.updateGISMarkupPosition(i[n])},t.redrawGISAgents=function(e){for(var r=bt.findChildOfType(e,"map").firstElementChild,i=bt.findChildOfType(r,"agents"),n=bt.childElements(i),a=0;a<n.length;a++)t.updateGISObjectScale(n[a]),"hidden"!=n[a].getAttribute("visibility")&&t.updateGISObjectPosition(n[a])},t.updateGISObjectPosition=function(e){var r=bt.findParentOfType(e,"ShapeGISMap"),i=yt.getFloatAttribute(e,"lon"),n=yt.getFloatAttribute(e,"lat"),a=yt.getFloatAttribute(e,"heading"),o=t.lonLatToXY(r,i,n),s="translate("+o[0]+","+o[1]+") rotate("+a+")",l=e.getAttribute("scale");l&&(s+=" scale("+l+")"),e.setAttribute("transform",s)},t.updateGISObjectScale=function(e){var r=bt.findParentOfType(e,"ShapeGISMap"),i=yt.getIntAttribute(e,"fixed-scale-zoom");if(i){var n=yt.getIntAttribute(r,"zoom");if(n<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var a=1;if(yt.getIntAttribute(e,"real-scale-zoom")<=n){var o=yt.getFloatAttribute(e,"pixels-per-meter"),s=yt.getFloatAttribute(e,"lat");a=t.pixelsPerGISMeter(n,s)/o}e.setAttribute("scale",a.toString())}},t.prototype.panGIS=function(e,r,i){var n=bt.findChildOfType(e,"map").firstElementChild,a=yt.parseTranslateTransform(n.getAttribute("transform")),o=a[0]+r,s=a[1]+i,l=yt.getIntAttribute(e,"zoom"),u=Math.pow(2,l),c=yt.getFloatAttribute(e,"center-lon"),h=yt.getFloatAttribute(e,"center-lat"),d=t.latToTileYFloat(h,l),p=bt.findChildOfType(e,"background"),f=yt.getFloatAttribute(p,"width"),m=yt.getFloatAttribute(p,"height"),g=m/2/t.tileImageSize;d-g-s/t.tileImageSize<0?s=(d-g)*t.tileImageSize:u<d+g-s/t.tileImageSize&&(s=(d+g-u)*t.tileImageSize),o=t.normalizedGISX(o,l),o=Math.round(o),s=Math.round(s),n.setAttribute("transform","translate("+o+","+s+")");var v=bt.findChildOfType(n,"tiles");this.updateGISTiles(v,l,h,c,o,s,f,m,u)},t.prototype.zoomOutGIS=function(e,r,i){var n=bt.findChildOfType(e,"background"),a=yt.getFloatAttribute(n,"width"),o=yt.getFloatAttribute(n,"height"),s=yt.getIntAttribute(e,"zoom");t.minGISZoom(a,o)<s&&this.setGISZoom(e,r,i,s-1)},t.prototype.zoomInGIS=function(t,e,r){var i=yt.getIntAttribute(t,"zoom");i<19&&this.setGISZoom(t,e,r,i+1)},t.prototype.setGISZoom=function(e,r,i,n){var a=bt.findChildOfType(e,"background"),o=yt.getFloatAttribute(a,"width"),s=yt.getFloatAttribute(a,"height"),l=bt.findChildOfType(e,"map").firstElementChild,u=yt.parseTranslateTransform(l.getAttribute("transform")),c=t.xyToLonLat(e,r-u[0],i-u[1]),h=t.lonToTileXFloat(c[0],n),d=t.latToTileYFloat(c[1],n),p=Math.pow(2,n);h=yt.remainderPositive(h-(r-o/2)/t.tileImageSize,p),d=yt.remainderPositive(d-(i-s/2)/t.tileImageSize,p);var f=t.tileXToLon(h,n),m=t.tileYToLat(d,n);yt.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[n,f,m]),this.redrawGISMap(e)},t.prototype.onGISClick=function(e,r,i){var n=bt.findChildOfType(e,"map").firstElementChild,a=yt.parseTranslateTransform(n.getAttribute("transform")),o=t.xyToLonLat(e,r-a[0],i-a[1]);this.frameDrawing.client.network.postUserAction(e.id,o[0]+" "+o[1])},t.prototype.onGISEvent=function(e){var r=e.currentTarget;if("true"==r.getAttribute("navigation-enabled")){var i=bt.findChildOfType(r,"background"),n=yt.getFloatAttribute(i,"width"),a=yt.getFloatAttribute(i,"height"),o=i.getBoundingClientRect(),s=o.width/n,l=o.height/a,u=yt.offsetPage(i);if(e.type.startsWith("mouse")||"wheel"==e.type){var c=e,h=(c.pageX-u.left)/s,d=(c.pageY-u.top)/l;switch(e.type){case"mousedown":t.buttonDown=c.which,1==t.buttonDown&&(e.stopPropagation(),t.prevPtrCoords=[h,d]);break;case"mousemove":if(1==t.buttonDown){e.stopPropagation(),e.preventDefault();var p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];t.prevPtrCoords=[h,d],this.panGIS(r,p,f)}break;case"mouseup":case"mouseout":if(r.contains(c.relatedTarget))return;if(1==t.buttonDown){e.stopPropagation();p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];Math.abs(p)<=_t.clickTolerance&&Math.abs(f)<=_t.clickTolerance&&this.onGISClick(r,h,d)}t.buttonDown=0;break;case"wheel":if(!c.altKey&&!c.ctrlKey){var m=e;e.stopPropagation(),e.preventDefault(),0<m.deltaY?this.zoomOutGIS(r,h,d):this.zoomInGIS(r,h,d)}}}else if(e.type.startsWith("touch")){var g=e;if(g.touches.length>2)return;var v=void 0,b=void 0,y=void 0,A=void 0;switch(g.touches.length>0&&(v=(g.touches[0].pageX-u.left)/s,b=(g.touches[0].pageY-u.top)/l),g.touches.length>1&&(y=(g.touches[1].pageX-u.left)/s,A=(g.touches[1].pageY-u.top)/l),e.type){case"touchstart":e.stopPropagation(),t.prevPtrCoords=g.touches.length>1?[v,b,y,A]:[v,b];break;case"touchmove":if(e.stopPropagation(),e.preventDefault(),g.touches.length>1&&4==t.prevPtrCoords.length){var T=(v+y)/2,C=(b+A)/2,S=Math.hypot(t.prevPtrCoords[2]-t.prevPtrCoords[0],t.prevPtrCoords[3]-t.prevPtrCoords[1]),E=Math.hypot(y-v,A-b);(E<.8*S||1.2*S<E)&&(E<S?this.zoomOutGIS(r,T,C):this.zoomInGIS(r,T,C),t.prevPtrCoords=[v,b,y,A])}else if(t.prevPtrCoords.length>=2){p=v-t.prevPtrCoords[0],f=b-t.prevPtrCoords[1];if(4==t.prevPtrCoords.length){var w=Math.hypot(p,f),k=v-t.prevPtrCoords[2],x=b-t.prevPtrCoords[3];Math.hypot(k,x)<w&&(p=k,f=x)}this.panGIS(r,p,f),t.prevPtrCoords=g.touches.length>1?[v,b,y,A]:[v,b]}else t.prevPtrCoords=g.touches.length>1?[v,b,y,A]:[v,b];break;case"touchend":e.stopPropagation(),t.prevPtrCoords=[]}}}},t.prototype.onGISAgentLayerClick=function(t){t.stopPropagation(),t.preventDefault();for(var e=t.currentTarget,r=t.target;r.parentNode!=e;)r=r.parentNode;this.frameDrawing.client.network.postUserAction(r.id,"0 0")},t.xyToLonLat=function(e,r,i){var n=bt.findChildOfType(e,"background"),a=yt.getFloatAttribute(n,"width"),o=yt.getFloatAttribute(n,"height"),s=yt.getIntAttribute(e,"zoom"),l=Math.pow(2,s),u=t.lonToTileXFloat(yt.getFloatAttribute(e,"center-lon"),s),c=t.latToTileYFloat(yt.getFloatAttribute(e,"center-lat"),s),h=(r-a/2)/t.tileImageSize,d=(i-o/2)/t.tileImageSize,p=yt.remainderPositive(u+h,l),f=yt.remainderPositive(c+d,l);return[t.tileXToLon(p,s),t.tileYToLat(f,s)]},t.lonLatToXY=function(e,r,i){var n=bt.findChildOfType(e,"background"),a=yt.getFloatAttribute(n,"width"),o=yt.getFloatAttribute(n,"height"),s=yt.getIntAttribute(e,"zoom"),l=t.lonToTileXFloat(yt.getFloatAttribute(e,"center-lon"),s),u=t.latToTileYFloat(yt.getFloatAttribute(e,"center-lat"),s),c=t.lonToTileXFloat(r,s),h=t.latToTileYFloat(i,s);return[a/2+(c-l)*t.tileImageSize,o/2+(h-u)*t.tileImageSize]},t.lonLatPointsToXYPoints=function(e,r){var i=bt.findChildOfType(e,"background"),n=yt.getFloatAttribute(i,"width"),a=yt.getFloatAttribute(i,"height"),o=yt.getIntAttribute(e,"zoom"),s=t.lonToTileXFloat(yt.getFloatAttribute(e,"center-lon"),o),l=t.latToTileYFloat(yt.getFloatAttribute(e,"center-lat"),o),u=void 0,c=void 0,h="";r=yt.splitSkipEmpty(r," ");for(var d=0;d<r.length;d++){var p=r[d].split(","),f=t.lonToTileXFloat(parseFloat(p[0]),o),m=t.latToTileYFloat(parseFloat(p[1]),o),g=n/2+(f-s)*t.tileImageSize,v=a/2+(m-l)*t.tileImageSize;null!=u&&Math.abs(g-u)<t.gisTolerance&&Math.abs(v-c)<t.gisTolerance||(h+=(g=yt.reducePrecision(g))+","+(v=yt.reducePrecision(v))+" ",u=g,c=v)}return h},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.prototype.tileURL=function(e,r,i,n){var a;switch(e.getAttribute("tile-url-provider-type")){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":a=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":a=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":a=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":a=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":a=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":a=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":a=yt.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}return a[Math.floor(Math.random()*a.length)].replace("[zoom]",r.toString()).replace("[x]",i.toString()).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=yt.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=yt.stringToByteArray(t+"/"+e+"/"+r+".png"),a=0;a<n.length;a++)n[a]^=i[a%n.length];return btoa(yt.byteArrayToString(n))},t.buttonDown=0,t.prevPtrCoords=[0,0],t.gisTolerance=2,t.tileImageSize=256,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),Rt=function(){function t(){}return t.createMarkupPipe=function(t){var e=bt.cloneElementWithId("markup-pipe"),r=t+"basepath";bt.findChildOfType(e,"basepath").firstElementChild.id=r;var i=bt.findChildOfType(e,"pipe"),n=bt.findChildOfType(e,"inner-pipe"),a=bt.findChildOfType(e,"bubbles"),o="#"+r;return i.setAttributeNS(bt.xlinkns,"href",o),n.setAttributeNS(bt.xlinkns,"href",o),a.setAttributeNS(bt.xlinkns,"href",o),e},t.updateMarkupPipe=function(t,e,r){for(var i,n=bt.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=bt.findChildOfType(t,"batches"),s=bt.findChildOfType(t,"bubbles"),l=0;l<e.length;l++)switch(e[l]){case"phase":s.setAttribute("stroke-dashoffset",(12-parseFloat(r[l])).toString());break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=bt.childElements(o)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=o.childElementCount,m=p;m<f;m++)bt.removeElement(o,o.lastElementChild);for(m=f;m<p;m++)d=bt.createUseElement(a),o.appendChild(d);break;case"d":var g=parseFloat(bt.findChildOfType(t,"pipe").getAttribute("stroke-width")),v=yt.roundPathCorners(r[l],2*g,!1);n.setAttribute("d",v);break;case"width":var b=parseFloat(r[l]);bt.findChildOfType(t,"pipe").setAttribute("stroke-width",b.toString()),bt.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*b).toString()),o.setAttribute("stroke-width",(.6*b).toString());var y=Math.min(5,.2*b);s.setAttribute("stroke-width",y.toString()),s.setAttribute("stroke-dasharray",y+","+(12-y));break;case"color":bt.findChildOfType(t,"pipe").setAttribute("stroke",r[l]);break;case"inner-color":bt.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[l]);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupStorageTank=function(){return bt.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=bt.findChildOfType(t,"square"),n=bt.findChildOfType(t,"batches"),a=parseFloat(i.getAttribute("width")),o=0;o<e.length;o++)switch(e[o]){case"batch":var s=r[o].split(" "),l=parseFloat(s[1])*a,u=parseFloat(s[2])*a,c=bt.childElements(n)[parseInt(s[0])];yt.setMultipleAttributes(c,["y","height","fill"],[a/2-l-u,u,s[3]]);break;case"newbatches":for(var h=parseInt(r[o]),d=n.childElementCount,p=h;p<d;p++)bt.removeElement(n,n.lastElementChild);for(p=d;p<h;p++)c=bt.createSvgElement("rect"),yt.setMultipleAttributes(c,["stroke","width","x"],["none",a,-a/2]),n.appendChild(c);break;case"progress":var f=parseFloat(r[o])*Math.PI*2,m=parseFloat(bt.findChildOfType(t,"circle").getAttribute("r"))-2,g=m*Math.sin(f),v=-m*Math.cos(f),b="M 0 "+-m+" ";b+="A "+m+" "+m+" 0 "+(f>Math.PI?"1":"0")+" 1 "+g+" "+v,bt.findChildOfType(t,"arc").setAttribute("d",b);break;case"radius":bt.findChildOfType(t,"circle").setAttribute("r",r[o]),a=Math.max(10,2*parseFloat(r[o])/Math.sqrt(2)-8),yt.setMultipleAttributes(i,["width","height","x","y"],[a,a,-a/2,-a/2]);break;case"color":bt.findChildOfType(t,"circle").setAttribute("fill",r[o]);break;case"stroke-color":bt.findChildOfType(t,"circle").setAttribute("stroke",r[o]),bt.findChildOfType(t,"square").setAttribute("stroke",r[o]);break;default:t.setAttribute(e[o],r[o])}},t.createMarkupBulkConveyorBelt=function(t){var e=bt.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";bt.findChildOfType(e,"basepath").firstElementChild.id=r;var i=bt.findChildOfType(e,"belt"),n=bt.findChildOfType(e,"belt-sections"),a="#"+r;return i.setAttributeNS(bt.xlinkns,"href",a),n.setAttributeNS(bt.xlinkns,"href",a),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,n=bt.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=bt.findChildOfType(t,"belt-sections"),s=bt.findChildOfType(t,"batches"),l=0;l<e.length;l++)switch(e[l]){case"phase":o.setAttribute("stroke-dashoffset",r[l]);break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=bt.childElements(s)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=s.childElementCount,m=p;m<f;m++)bt.removeElement(s,s.lastElementChild);for(m=f;m<p;m++)d=bt.createUseElement(a),s.appendChild(d);break;case"d":n.setAttribute("d",r[l]);break;case"width":var g=r[l];bt.findChildOfType(t,"belt").setAttribute("stroke-width",g),o.setAttribute("stroke-width",g),o.setAttribute("stroke-dasharray","2, 10"),s.setAttribute("stroke-width",(.4*parseFloat(g)).toString());break;case"color":bt.findChildOfType(t,"belt").setAttribute("stroke",r[l]);break;case"sections-color":o.setAttribute("stroke",r[l]);break;default:t.setAttribute(e[l],r[l])}},t}(),Dt=function(){function t(){}return t.createMarkupPath=function(t,e){var r=bt.cloneElementWithId("markup-path"),i=e+"basepath";bt.findChildOfType(r,"basepath").firstElementChild.id=i;var n=bt.findChildOfType(r,"paths"),a=1;"MarkupPathRoad"==t&&(a=2),"MarkupPathRailroad"==t&&(a=4);for(var o=0;o<a;o++){var s=bt.createUseElement(i);n.appendChild(s)}var l=bt.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(n.firstElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","white")):"MarkupPathRoad"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","white"),l.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(n.firstElementChild.setAttribute("stroke","gray"),bt.childElements(n)[1].setAttribute("stroke","black"),bt.childElements(n)[2].setAttribute("stroke","white"),n.lastElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),n=bt.findChildOfType(t,"basepath").firstElementChild,a=bt.findChildOfType(t,"paths"),o=a.firstElementChild,s=bt.findChildOfType(t,"arrows"),l=0;l<e.length;l++)switch(e[l]){case"d":n.setAttribute("d",r[l]);break;case"bidirectional":bt.removeAllChildren(s),"false"==r[l]&&yt.addPathArrows(n,"arrowhead",1.7,s,50,100);break;case"stroke-width":var u=parseFloat(r[l]);switch(i){case"MarkupPathLine":o.setAttribute("stroke-width",u.toString());break;case"MarkupPathDashline":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",4*u+" "+u);break;case"MarkupPathConveyor":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",u/2+" "+u/10);break;case"MarkupPathRoad":o.setAttribute("stroke-width",u.toString());var c=a.lastElementChild;c.setAttribute("stroke-width",(u/12).toString()),c.setAttribute("stroke-dasharray",u/2+" "+u/5);break;case"MarkupPathRailroad":var h=u/10+" "+u/2.5;o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",h),bt.childElements(a)[1].setAttribute("stroke-width",(u/2+u/12).toString()),bt.childElements(a)[2].setAttribute("stroke-width",(u/2).toString());var d=a.lastElementChild;d.setAttribute("stroke-width",(u/2).toString()),d.setAttribute("stroke-dasharray",h)}break;case"stroke":o.setAttribute("stroke",r[l]),u=parseFloat(o.getAttribute("stroke-width")),s.setAttribute("stroke",u>4?"white":r[l]);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupAreaNode=function(t){var e,r=bt.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=bt.createSvgElement("rect");break;case"MarkupPolygonalNode":e=bt.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:i.setAttribute(e[n],r[n])}},t.createMarkupPalletRack=function(){return bt.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"stroke":n.setAttribute(e[a],r[a]);break;case"fill":i.setAttribute(e[a],r[a]);break;case"rack-data":bt.removeAllChildren(i),bt.removeAllChildren(n);var o=r[a].split(" "),s=parseInt(o[0]),l=parseInt(o[1]),u=parseFloat(o[2]),c=parseFloat(o[3]),h=parseFloat(o[4]),d=void 0,p=void 0,f=void 0;s>1&&(d=parseFloat(o[5]),p=parseFloat(o[6]),f=c+d);var m=bt.createSvgElement("rect");if(m.setAttribute("width",u.toString()),m.setAttribute("height",c.toString()),i.appendChild(m),s>1){var g=bt.createSvgElement("rect");g.setAttribute("width",u.toString()),g.setAttribute("height",p.toString()),g.setAttribute("transform","translate( 0 "+f+")"),i.appendChild(g)}for(var v=h,b=0;b<l-1;b++){var y=bt.createSvgElement("line");yt.setMultipleAttributes(y,["x1","x2","y1","y2"],[v,v,"0",c]),n.appendChild(y),v+=h}if(s>1){var A=f+p;v=h;for(b=0;b<l-1;b++){y=bt.createSvgElement("line");yt.setMultipleAttributes(y,["x1","x2","y1","y2"],[v,v,f,A]),n.appendChild(y),v+=h}}break;default:t.setAttribute(e[a],r[a])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),Ft=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=bt.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=bt.createSvgElement("path");break;case"MarkupCircularWall":r=bt.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=bt.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupTargetLine=function(){return bt.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var n=bt.findChildOfType(e,"polyline"),a=bt.findChildOfType(e,"serif-start"),o=bt.findChildOfType(e,"serif-end"),s=0;s<r.length;s++)switch(r[s]){case"color":e.setAttribute("stroke",i[s]);break;case"points":n.setAttribute(r[s],i[s]);var l=i[s].split(" "),u=l.length;l[u-1].includes(",")||u--,t.setSerif(l[0],l[1],a),t.setSerif(l[u-1],l[u-2],o);break;default:e.setAttribute(r[s],i[s])}},t.createMarkupPathway=function(){return bt.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=bt.findChildOfType(t,"polygon"),n=bt.findChildOfType(t,"polyline"),a=bt.findChildOfType(t,"ties"),o=0;o<e.length;o++)switch(e[o]){case"color":a.setAttribute("stroke",r[o]);break;case"points":var s=r[o].split(" "),l="",u="",c="";bt.removeAllChildren(a);for(var h=0;h<s.length;h++){var d=yt.splitToFloats(s[h],",");if(4==d.length){l+=d[0]+","+d[1]+" ",u=d[2]+","+d[3]+" "+u,c+=(d[0]+d[2])/2+","+(d[1]+d[3])/2+" ";var p=bt.createSvgElement("line");yt.setMultipleAttributes(p,["x1","y1","x2","y2"],[d[0],d[1],d[2],d[3]]),a.appendChild(p)}}i.setAttribute("points",l+u),n.setAttribute("points",c);break;default:t.setAttribute(e[o],r[o])}},t.createMarkupPedFlowStatistics=function(){return bt.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=bt.findChildOfType(t,"line"),n=bt.findChildOfType(t,"serif-end"),a=bt.findChildOfType(t,"direction"),o=bt.findChildOfType(t,"arrow-right"),s=bt.findChildOfType(t,"arrow-left"),l=0;l<e.length;l++)switch(e[l]){case"color":t.setAttribute("stroke",r[l]);break;case"length":i.setAttribute("x2",r[l]),n.setAttribute("x1",r[l]),n.setAttribute("x2",r[l]);var u=parseInt(r[l])/2;a.setAttribute("x1",u.toString()),a.setAttribute("x2",u.toString()),o.setAttribute("transform","translate("+u+" 13) rotate(90)"),s.setAttribute("transform","translate("+u+" -13) rotate(-90)");break;case"direction":switch(o.setAttribute("visibility","inherit"),s.setAttribute("visibility","inherit"),r[l]){case"right":s.setAttribute("visibility","hidden");break;case"left":o.setAttribute("visibility","hidden")}break;default:t.setAttribute(e[l],r[l])}},t.createMarkupServiceWithLines=function(){return bt.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var n=bt.findChildOfType(e,"queues"),a=bt.findChildOfType(e,"services"),o=bt.findChildOfType(e,"reverse-queues"),s=bt.findChildOfType(e,"area"),l=0;l<r.length;l++)switch(r[l]){case"queue-color":n.setAttribute("stroke",i[l]);break;case"reverse-queue-color":o.setAttribute("stroke",i[l]);break;case"service-color":a.setAttribute("stroke",i[l]);break;case"clear-all-queues":bt.removeAllChildren(n),bt.removeAllChildren(o);break;case"queue":t.addQueue(n,i[l]);break;case"reverse-queue":t.addQueue(o,i[l]);break;case"clear-services":bt.removeAllChildren(a);break;case"service":t.addService(a,i[l]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":s.setAttribute(r[l],i[l]);break;default:e.setAttribute(r[l],i[l])}},t.createMarkupServiceWithArea=function(){return bt.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var n=bt.findChildOfType(e,"services"),a=0;a<r.length;a++)switch(r[a]){case"service-color":n.setAttribute("stroke",i[a]);break;case"clear-services":bt.removeAllChildren(n);break;case"service":t.addService(n,i[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":break;default:e.setAttribute(r[a],i[a])}},t.createMarkupEscalatorGroup=function(){return bt.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=bt.findChildOfType(t,"background"),n=bt.findChildOfType(t,"escalators"),a=0;a<e.length;a++)switch(e[a]){case"balustrade-color":i.setAttribute("fill",r[a]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[a]?"inherit":"hidden");break;case"dimensions-completed":var o=yt.getIntAttribute(t,"number-of-escalators"),s=yt.getFloatAttribute(t,"width"),l=yt.getFloatAttribute(t,"length"),u=yt.getFloatAttribute(t,"left-balustrade-width"),c=yt.getFloatAttribute(t,"right-balustrade-width"),h=yt.getFloatAttribute(t,"internal-balustrade-width"),d=yt.getFloatAttribute(t,"lower-landing-length"),p=u+c+o*s+(o-1)*h,f=d+l+yt.getFloatAttribute(t,"upper-landing-length");yt.setMultipleAttributes(i,["y","width","height"],[-u,f,p]);for(var m=0;m<o;m++){var g=m*(s+h),v=bt.cloneElementWithId("escalator"),b=bt.findChildOfType(v,"background");yt.setMultipleAttributes(b,["y","width","height"],[g,f,s]);var y=bt.findChildOfType(v,"handrail-left"),A=bt.findChildOfType(v,"handrail-right");yt.setMultipleAttributes(y,["x2","y1","y2"],[f,g,g]),yt.setMultipleAttributes(A,["x2","y1","y2"],[f,g+s,g+s]);var T=bt.findChildOfType(v,"lower-landing-end"),C=bt.findChildOfType(v,"upper-landing-end");yt.setMultipleAttributes(T,["x1","x2","y1","y2"],[d,d,g,g+s]),yt.setMultipleAttributes(C,["x1","x2","y1","y2"],[d+l,d+l,g,g+s]);var S=bt.findChildOfType(v,"stairs");yt.setMultipleAttributes(S,["x1","x2","y1","y2","stroke-width"],[d,d+l,g+s/2,g+s/2,s]),n.appendChild(v)}break;case"offsets":var E=yt.splitToFloats(r[a]," "),w=bt.childElements(n);for(m=0;m<w.length;m++)bt.findChildOfType(w[m],"stairs").setAttribute("stroke-dashoffset",(-E[m]).toString());break;default:t.setAttribute(e[a],r[a])}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),a=parseFloat(i[0]),o=parseFloat(i[1]),s=parseFloat(n[0])-a,l=parseFloat(n[1])-o,u=Math.hypot(s,l),c=3*l/u,h=3*s/u;yt.setMultipleAttributes(r,["x1","x2","y1","y2"],[a+c,a-c,o-h,o+h])},t.addService=function(t,e){var r,i=e.split(" "),n=parseFloat(yt.getSubAttribute(i,"x")),a=parseFloat(yt.getSubAttribute(i,"y")),o=yt.radiansToDegrees(parseFloat(yt.getSubAttribute(i,"orientation")));if("point"==yt.getSubAttribute(i,"type")){(r=bt.createUseElement("service-point")).setAttribute("transform","translate("+n+" "+a+")");var s=bt.createUseElement("arrowhead-small");s.setAttribute("transform","translate("+(n-11)+" "+a+") rotate("+o+" 11 0)"),t.appendChild(s)}else{(r=bt.cloneElementWithId("service-line")).setAttribute("transform","translate("+n+" "+a+") rotate("+o+")");var l=r.firstElementChild.nextElementSibling,u=parseFloat(yt.getSubAttribute(i,"length"));if(l.setAttribute("x2",u),"true"==yt.getSubAttribute(i,"bidirectional")){var c=r.lastElementChild;c.setAttribute("visibility","inherit"),c.setAttribute("transform","translate("+(u+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=yt.splitSkipEmpty(e,"|"),i=yt.getSubAttribute(r,"queue-path"),n=bt.createSvgElement("path");n.setAttribute("d",i),t.appendChild(n),yt.addPathArrows(n,"arrowhead-small",.7,t,50,100);var a=yt.getSubAttribute(r,"fence-color");if(a)for(var o=[yt.getSubAttribute(r,"fence-path-left"),yt.getSubAttribute(r,"fence-path-right")],s=0;s<o.length;s++){var l=bt.createSvgElement("path");yt.setMultipleAttributes(l,["d","stroke","stroke-width","stroke-dasharray"],[o[s],a,"2","none"]),t.appendChild(l)}},t}(),Nt=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return bt.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return bt.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i])},t}(),Bt=function(){function t(){}return t.createMarkupIntersection=function(){return bt.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,n=bt.findChildOfType(t,"lane-connectors"),a=0;a<e.length;a++)switch(e[a]){case"fill":case"d":i.setAttribute(e[a],r[a]);break;case"lane-connector":var o=bt.createSvgElement("g"),s=bt.createSvgElement("path");s.setAttribute("d",r[a]),o.appendChild(s),yt.addPathArrows(s,"arrowhead-tiny",.5,o,20,40),n.appendChild(o);break;case"lane-connector-colors":for(var l=yt.splitSkipEmpty(r[a]," "),u=bt.childElements(n),c=0;c<u.length;c++)u[c].setAttribute("stroke",l[c]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupRoad=function(){return bt.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var n=bt.findChildOfType(e,"lanes"),a=bt.findChildOfType(e,"delimiters"),o=bt.findChildOfType(e,"median"),s=0;s<r.length;s++)switch(r[s]){case"lane-width":n.setAttribute("stroke-width",i[s]);break;case"lane-color":n.setAttribute("stroke",i[s]);break;case"forward-lane":case"backward-lane":var l=bt.createSvgElement("path");l.setAttribute("d",i[s]),n.appendChild(l);break;case"lane-delimiter-color":a.setAttribute("stroke",i[s]);break;case"lane-delimiter-width":case"lane-delimiter-style":a.setAttribute(r[s],i[s]);break;case"lane-delimiter":var u=yt.getFloatAttribute(a,"lane-delimiter-width"),c=a.getAttribute("lane-delimiter-style");t.addDelimiter(a,u,c,i[s],n.getAttribute("stroke"));break;case"median-color":o.setAttribute("stroke",i[s]);break;case"median-width":case"median-style":o.setAttribute(r[s],i[s]);break;case"median":u=yt.getFloatAttribute(o,"median-width"),c=o.getAttribute("median-style"),t.addDelimiter(o,u,c,i[s],n.getAttribute("stroke"));break;default:e.setAttribute(r[s],i[s])}},t.addDelimiter=function(t,e,r,i,n){var a=r.includes("DASHED"),o=r.includes("DOUBLE"),s=bt.createSvgElement("path");if(s.setAttribute("d",i),s.setAttribute("stroke-width",(o?3*e:e).toString()),a&&s.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(s),o){var l=bt.createSvgElement("path");yt.setMultipleAttributes(l,["d","stroke-width","stroke"],[i,e,n]),t.appendChild(l)}},t.createMarkupStopLine=function(){return bt.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:t.setAttribute(e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return bt.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t}(),Gt=function(){function t(e){this.serverFPS=t.MAX_FPS,this.client=e,this.chart=new It(this),this.control=new St(this),this.shapeComposite=new At(this),this.shapeGISMap=new Pt(this)}return t.prototype.start=function(){this.frameDrawStartTime=Date.now(),this.catchingUp=!1,this.frameCount=0,this.fpsMeasureStartTime=null,this.actualFPS=0,this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.fullFrame=!1,this.packetFPS=t.MAX_FPS,this.desiredFPS=t.MAX_FPS,this.frameBuffer=[],this.sleepTimeStatistics=new Array(t.SLEEP_TIME_STATISTICS_SIZE),this.sleepTimeStatistics.fill(1e3/t.MAX_FPS),this.startMeasureInterval(),this.startFrameDrawingTimeout(this.desiredFPS)},t.prototype.stop=function(){this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.frameBuffer=[],this.stopMeasureInterval(),this.stopFrameDrawingTimeout()},t.prototype.startMeasureInterval=function(){var t=this;this.fpsMeasureIntervalId=setInterval(function(){return t.measureFPS()},1e3)},t.prototype.stopMeasureInterval=function(){this.fpsMeasureIntervalId&&(clearInterval(this.fpsMeasureIntervalId),this.fpsMeasureIntervalId=void 0)},t.prototype.startFrameDrawingTimeout=function(t){var e=this;this.frameDrawingTimeoutId=setTimeout(function(){var t=Date.now();e.drawFrame();var r=1e3/e.desiredFPS-(Date.now()-t);r<0&&(r=0),e.sleepTimeStatistics.push(r),e.sleepTimeStatistics.shift(),e.startFrameDrawingTimeout(r)},t)},t.prototype.stopFrameDrawingTimeout=function(){this.frameDrawingTimeoutId&&(clearTimeout(this.frameDrawingTimeoutId),this.frameDrawingTimeoutId=void 0)},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.totalFrameCount=function(){var t=this.frameBuffer.length;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.findOrRequestFullFrame=function(){if(this.fullFrame)console.log("Found a full frame in the local buffer, starting from there");else{for(var t=0;t<this.packetBuffer.length;t++){if(this.packetBuffer[t].fullFrame)return console.log("Found a full frame in the local buffer, starting from there"),void this.packetBuffer.splice(0,t)}this.packetBuffer=[],console.log("Cleared local frame buffer, requesting full frame from the server"),this.client.network.requestAndWaitFullFrame()}},t.prototype.switchToNextFrame=function(){if(0==this.frameBuffer.length){if(0==this.packetBuffer.length)return this.fullFrame=!1,this.packetFPS=t.MAX_FPS,void(this.desiredFPS=t.MAX_FPS);var e=this.packetBuffer.shift();this.frameBuffer=e.frames,this.fullFrame=e.fullFrame,this.packetFPS=e.fps,this.desiredFPS=e.fps,this.updateServerFpsIfNeeded()}return this.frameBuffer.shift()},t.prototype.updateServerFpsIfNeeded=function(){var e=this.actualFPS/this.packetFPS,r=this.measureSleepTime();if(e>=.9&&r>50&&this.serverFPS<t.MAX_FPS)return this.serverFPS++,void this.client.network.postMaxFPS(this.serverFPS);e<.9&&r<50&&this.serverFPS>1&&(this.serverFPS--,e<.7&&this.serverFPS>1&&this.serverFPS--,e<.6&&this.serverFPS>1&&this.serverFPS--,this.client.network.postMaxFPS(this.serverFPS))},t.prototype.measureSleepTime=function(){for(var t=0,e=0;e<this.sleepTimeStatistics.length;e++)t+=this.sleepTimeStatistics[e];return t/=this.sleepTimeStatistics.length},t.prototype.drawFrame=function(){var e=this.switchToNextFrame();if(e){this.client.updateExperimentState(e),this.fullFrame&&(this.fullFrame=!1,bt.removeAllChildren(this.client.presentation)),this.frameDrawStartTime=Date.now(),this.client.svg.suspendRedraw(5e3),this.time=e.time;var r,i,n,a=e.commands;if(a.length>0&&"white"!=this.client.svg.style.backgroundColor&&(this.client.svg.style.backgroundColor="white"),Yt.DEBUG_MODE){var o=this.totalFrameCount();this.client.debugger.timeInfo.innerHTML=yt.formatNumber(this.time,2),this.client.debugger.serverQueueInfo.innerHTML=this.client.network.serverQueue,this.client.debugger.browserQueueInfo.innerHTML=o+":"+this.client.network.packetManager.totalFrameCount(),r=0,i=0,n=0}for(var s=0;s<a.length;s++){var l=a[s],u=void 0,c=l.groupId,h=l.att,d=l.val,p=void 0;switch(l.cmd){case"C":if(p=this.createShape(l.type,l.id),null==c)this.client.presentation.appendChild(p);else{if(null==(u=document.getElementById(c)))return console.log("Can't find container to add a shape to, container id = "+c,l),void this.findOrRequestFullFrame();if("ShapeGISMap"==u.getAttribute("type")){var f=bt.findChildOfType(u,"map").firstElementChild;u=l.type.startsWith("MarkupGIS")?bt.findChildOfType(f,"markup"):bt.findChildOfType(f,"agents")}u.appendChild(p)}this.updateShape(p,h,d),r++;break;case"U":if(null==(p=document.getElementById(l.id)))return console.log("Can't find shape to be updated, shape id = "+l.id,l),void this.findOrRequestFullFrame();this.updateShape(p,h,d),i++;break;case"D":if(null==(p=document.getElementById(l.id)))return console.log("Can't find shape to be deleted, shape id = "+l.id,l),void this.findOrRequestFullFrame();bt.removeElement(p.parentNode,p),n++;break;case"S":this.applySettings(h,d);break;case"N":this.applyNavigation(h,d);break;case"M":t.showMessage(h,d);break;case"W":t.openURL(h,d);break;default:return void this.client.stopAndAlert("Unknown command: "+l.cmd,null)}}this.client.svg.unsuspendRedrawAll(),this.frameCount++,Yt.DEBUG_MODE&&(this.client.debugger.cudCountInfo.innerHTML=r+"/"+i+"/"+n,this.client.debugger.drawTimeInfo.innerHTML=Date.now()-this.frameDrawStartTime,this.client.debugger.shapeCountInfo.innerHTML=vt.elementcount),!this.catchingUp&&this.packetBuffer.length>1?(this.catchingUp=!0,this.desiredFPS=1e3/this.packetFPS*.8):this.catchingUp&&(this.catchingUp=!1,this.desiredFPS=1e3/this.packetFPS)}},t.prototype.createShape=function(t,e){var r;if(bt.isPrimitiveSVGElement(t))r=bt.createSvgElement(t);else switch(t){case"ShapeArc":r=At.createShapeArc();break;case"ShapeText":r=At.createShapeText();break;case"ShapeImage":r=At.createShapeImage();break;case"ShapeCanvas":r=At.createShapeCanvas(e);break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=Dt.createMarkupPath(t,e);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=Dt.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=Dt.createMarkupPalletRack();break;case"MarkupRailwaySwitch":r=Nt.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=Nt.createMarkupPositionOnTrack();break;case"MarkupPipe":r=Rt.createMarkupPipe(e);break;case"MarkupStorageTank":r=Rt.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=Rt.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=Ft.createMarkupWall(t,e);break;case"MarkupTargetLine":r=Ft.createMarkupTargetLine();break;case"MarkupPathway":r=Ft.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=Ft.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=Ft.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=Ft.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=Ft.createMarkupEscalatorGroup();break;case"MarkupIntersection":r=Bt.createMarkupIntersection();break;case"MarkupRoad":r=Bt.createMarkupRoad();break;case"MarkupStopLine":r=Bt.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=Bt.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=Lt.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=It.create();break;case"Window3D":r=Tt.create();break;default:return this.client.stopAndAlert("Can't create: unknown object type: "+t,void 0),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(t,e,r){var i=t.getAttribute("type");if(bt.isPrimitiveSVGElement(i))for(var n=0;n<e.length;n++)if("href"==e[n])t.setAttributeNS(bt.xlinkns,"href",r[n]);else if("href-path"==e[n])t.setAttributeNS(bt.xlinkns,"href",this.client.network.getJarResourceURL(r[n]));else if("geo"==e[n]){var a=r[n].split("|");t.setAttribute("lon",a[0]),t.setAttribute("lat",a[1]),t.setAttribute("heading",a[2]),Pt.updateGISObjectPosition(t)}else t.setAttribute(e[n],r[n]);else switch(i){case"ShapeArc":At.updateShapeArc(t,e,r);break;case"ShapeText":At.updateShapeText(t,e,r);break;case"ShapeImage":this.shapeComposite.updateShapeImage(t,e,r);break;case"ShapeCanvas":At.updateShapeCanvas(t,e,r);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(t,e,r);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(t,e,r);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":Dt.updateMarkupPath(t,e,r);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":Dt.updateMarkupAreaNode(t,e,r);break;case"MarkupPalletRack":Dt.updateMarkupPalletRack(t,e,r);break;case"MarkupRailwaySwitch":Nt.updateMarkupRailwaySwitch(t,e,r);break;case"MarkupPositionOnTrack":Nt.updateMarkupPositionOnTrack(t,e,r);break;case"MarkupPipe":Rt.updateMarkupPipe(t,e,r);break;case"MarkupStorageTank":Rt.updateMarkupStorageTank(t,e,r);break;case"MarkupBulkConveyorBelt":Rt.updateMarkupBulkConveyorBelt(t,e,r);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":Ft.updateMarkupWall(t,e,r);break;case"MarkupTargetLine":Ft.updateMarkupTargetLine(t,e,r);break;case"MarkupPathway":Ft.updateMarkupPathway(t,e,r);break;case"MarkupPedFlowStatistics":Ft.updateMarkupPedFlowStatistics(t,e,r);break;case"MarkupServiceWithLines":Ft.updateMarkupServiceWithLines(t,e,r);break;case"MarkupServiceWithArea":Ft.updateMarkupServiceWithArea(t,e,r);break;case"MarkupEscalatorGroup":Ft.updateMarkupEscalatorGroup(t,e,r);break;case"MarkupIntersection":Bt.updateMarkupIntersection(t,e,r);break;case"MarkupRoad":Bt.updateMarkupRoad(t,e,r);break;case"MarkupStopLine":Bt.updateMarkupStopLine(t,e,r);break;case"MarkupBusStop":case"MarkupParkingLot":Bt.updateMarkupBusStopOrParkingLot(t,e,r);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":Lt.updateGISMarkup(t,e,r);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(t,e,r);break;case"Window3D":Tt.update(t,e,r)}},t.prototype.measureFPS=function(){var t=Date.now();null!=this.fpsMeasureStartTime&&(this.actualFPS=Math.round(1e3*this.frameCount/(t-this.fpsMeasureStartTime))),Yt.DEBUG_MODE&&(this.client.debugger.fpsInfo.innerHTML=this.actualFPS+":"+this.packetFPS),this.fpsMeasureStartTime=t,this.frameCount=0},t.prototype.onControlAction=function(t,e){this.client.network.postUserAction(t,e)},t.prototype.onUserClick=function(t,e,r){bt.isContainedInElementOfType(t,St.controlTypes)||bt.isContainedInElementOfType(t,It.chartTypes)||bt.isContainedInElementOfType(t,["Window3D"])||bt.isContainedInElementOfType(t,["ShapeGISMap"])||this.client.network.postUserAction(0,e+" "+r)},t.prototype.applySettings=function(t,e){for(var r=0;r<t.length;r++)this.modelSettings[yt.hyphenToCameLCase(t[r])]=e[r];this.modelSettings.startTime=parseInt(this.modelSettings.startTime),this.modelSettings.startDate=parseInt(this.modelSettings.startDate),this.modelSettings.stopTime&&(this.modelSettings.stopTime=parseInt(this.modelSettings.startTime),this.modelSettings.stopDate=parseInt(this.modelSettings.startDate))},t.prototype.applyNavigation=function(t,e){for(var r=0;r<t.length;r++)this.navigationSettings[yt.hyphenToCameLCase(t[r])]=e[r];this.navigationSettings.x=parseFloat(this.navigationSettings.x),this.navigationSettings.y=parseFloat(this.navigationSettings.y),this.navigationSettings.width=parseFloat(this.navigationSettings.width),this.navigationSettings.height=parseFloat(this.navigationSettings.height),this.navigationSettings.zoomAndPanningEnabled="true"==this.navigationSettings.zoomAndPanningEnabled,this.client.setNavigationSettings(this.navigationSettings.width,this.navigationSettings.height),this.client.navigation.applyNavigationSettings()},t.showMessage=function(t,e){for(var r={},i=0;i<t.length;i++)r[yt.hyphenToCameLCase(t[i])]=e[i];var n=document.getElementById("svg-message-background"),a=document.getElementById("svg-message-box-title"),o=document.getElementById("svg-message-box-text"),s=document.getElementById("svg-message-box-icon-info"),l=document.getElementById("svg-message-box-icon-error");a.innerText=r.title,o.innerHTML=r.text.replace(/\n/g,"<br>"),r.type.startsWith("error")?(s.style.display="none",l.style.removeProperty("display"),a.classList.remove("svg-message-box-colors-info"),a.classList.add("svg-message-box-colors-error"),""==r.title&&(a.innerHTML="Error")):(s.style.removeProperty("display"),l.style.display="none",a.classList.remove("svg-message-box-colors-error"),a.classList.add("svg-message-box-colors-info"),""==r.title&&(a.innerHTML="Message")),n.style.removeProperty("display")},t.openURL=function(e,r){var i=r[0];i.startsWith("http://")&&i.startsWith("https://")||(i="http://"+i);var n=["message","Open URL","The model asks you to open an external URL:<br><a href="+i+" target = '_blank' onclick = 'document.getElementById( \"svg-message-background\" ).style.display = \"none\"'>"+i+"</a><br><br>The URL will open in a new window"];t.showMessage(["type","title","text"],n)},t.SLEEP_TIME_STATISTICS_SIZE=20,t.MAX_FPS=20,t}(),Ut=function(){function t(t,e,r){var i=this;this.networkManager=t,this.startTime=Date.now(),this.xhttp=this.networkManager.getAnimationPacket(e,function(){i.stopTime=Date.now(),r(i)})}return t.prototype.requestTime=function(){return this.stopTime?this.stopTime-this.startTime:Date.now()-this.startTime},t.prototype.abort=function(){this.xhttp.abort()},t}(),zt=function(){function t(t){this.paused=!1,this.networkManager=t}return t.prototype.start=function(){this.fullFrame=!0,this.activeRequests=[],this.responseTimeStatistics=new Array(t.REQUEST_STATISTICS_SIZE),this.responseTimeStatistics.fill(Ht.MIN_REQUEST_INTERVAL),this.requestInterval=Ht.MIN_REQUEST_INTERVAL,this.lastRequestTime=0,this.createRequest(),this.startRequestTimeout()},t.prototype.stop=function(){this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.pause=function(){this.paused=!0,this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.requestFullFrame=function(){console.debug(">> SVG: Request full frame."),this.fullFrame=!0},t.prototype.startRequestTimeout=function(){var t=this;this.requestTimeoutId=setTimeout(function(){t.processRequestTimeout()},this.requestInterval)},t.prototype.processRequestTimeout=function(){this.requestTimeoutId=void 0,this.activeRequests.length<Ht.MAX_REQUEST_COUNT&&(this.createRequest(),this.startRequestTimeout())},t.prototype.createRequest=function(){var t=this,e=new Ut(this.networkManager,this.fullFrame,function(e){return t.processResponse(e)});this.fullFrame=!1,this.activeRequests.push(e),this.lastRequestTime=Date.now()},t.prototype.processResponse=function(t){var e=this.activeRequests.indexOf(t);if(this.activeRequests.splice(e,1),this.addToResponseTimeStatistics(t.requestTime()),void 0!==this.requestTimeoutId||this.paused||(this.createRequest(),this.startRequestTimeout()),4==t.xhttp.readyState&&200==t.xhttp.status){var r=JSON.parse(t.xhttp.responseText);this.networkManager.packetManager.addPacket(r)}},t.prototype.addToResponseTimeStatistics=function(t){this.responseTimeStatistics.push(t),this.responseTimeStatistics.shift(),this.requestInterval=this.calculateRequestInterval(),this.networkManager.RPS=1e3/this.requestInterval},t.prototype.calculateRequestInterval=function(){if(0===this.responseTimeStatistics.length)return Ht.MIN_REQUEST_INTERVAL;for(var t=0,e=0;e<this.responseTimeStatistics.length;e++)t+=this.responseTimeStatistics[e];var r=t/this.responseTimeStatistics.length*.5;return r<Ht.MIN_REQUEST_INTERVAL?Ht.MIN_REQUEST_INTERVAL:r>Ht.MAX_REQUEST_INTERVAL?Ht.MAX_REQUEST_INTERVAL:r},t.REQUEST_STATISTICS_SIZE=10,t}(),Wt=function(){function t(t){this.client=t,this.reset()}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.waitingFullFrame=!1,this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.pause=function(){this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.addPacket=function(t){if(t){var e=t.frames;if(e&&0!==e.length){var r=e[0];if(!(r.number<this.expectedFrameNumber)){if(r.number===this.expectedFrameNumber||t.fullFrame){this.client.network.serverQueue=t.serverQueue;var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),this.cancelWaitExpectedFrameTimeoutIfNeeded(),void(t.fullFrame&&(this.waitingFullFrame=!1))}this.insertToPacketBuffer(t),console.debug(">> SVG: Reordering  or packet loss expectedFrame=",this.expectedFrameNumber),this.startWaitExpectedFrameTimeoutIfNeeded()}}}},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length&&!(this.packetBuffer[0].frames[0].number>=this.expectedFrameNumber)){var t=this.packetBuffer[this.packetBuffer.length-1];if(t.frames[t.frames.length-1].number>=this.expectedFrameNumber)this.packetBuffer=[];else{for(var e=0;e<this.packetBuffer.length&&!(this.packetBuffer[e].frames[0].number>=this.expectedFrameNumber);e++);this.packetBuffer.splice(0,e)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length&&this.packetBuffer[0].frames[0].number===this.expectedFrameNumber){for(var t=this.expectedFrameNumber,e=0;e<this.packetBuffer.length;e++){var r=this.packetBuffer[e].frames;if(r[0].number!==t)break;t=r[r.length-1].number+1}var i=this.packetBuffer.splice(0,e);this.client.frameDrawing.addAllPackets(i),this.expectedFrameNumber=t}},t.prototype.cancelWaitExpectedFrameTimeoutIfNeeded=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startWaitExpectedFrameTimeoutIfNeeded=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,t.client.network.requestFullFrame()},4*this.client.network.RPS*1e3))},t.prototype.waitFullFrame=function(){console.debug(">> SVG: Wait full frame."),this.waitingFullFrame=!0,this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t}(),Ht=function(){function t(t){this.client=t,this.packetRequester=new zt(this),this.packetManager=new Wt(t)}return t.prototype.start=function(){this.packetManager.reset(),this.packetRequester.start()},t.prototype.stop=function(){this.packetRequester.stop(),this.packetManager.reset()},t.prototype.pause=function(){this.paused=!0,this.packetRequester.pause()},t.prototype.getAnimationPacket=function(t,e){if(!this.paused){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},Yt.DEBUG_SPARK_LOCAL?r.open("GET","/http/update?fullFrame="+t+"&time="+Date.now(),!0):r.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+Date.now(),!0),r.send(),r}},t.prototype.postUserAction=function(t,e){if(!this.paused){var r=new XMLHttpRequest;Yt.DEBUG_SPARK_LOCAL?r.open("GET","/http/useraction?id="+t+"&value="+encodeURIComponent(e)):r.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),r.send()}},t.prototype.postUserCommand=function(t,e){if(!this.paused){var r=new XMLHttpRequest;r.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),r.send()}},t.prototype.getJarResourceURL=function(t){return this.getResourceURLWithSubpath("internal-resources",t)},t.prototype.getResourceURL=function(t){return this.getResourceURLWithSubpath("resources",t)},t.prototype.getResourceURLWithSubpath=function(t,e){if(!this.paused)return Yt.DEBUG_SPARK_LOCAL?"/http/image?path="+e:this.getRestRoot()+t+"?path="+e},t.prototype.getRestRoot=function(){return this.client.svgAnimationInfo.host+"/nodes/"+this.client.svgAnimationInfo.restUrl+"sessions/"+this.client.svgAnimationInfo.sessionUuid+"/"},t.prototype.postMaxFPS=function(t){if(!this.paused){var e=new XMLHttpRequest;Yt.DEBUG_SPARK_LOCAL?e.open("POST","http/max-fps"):e.open("POST",this.getRestRoot()+"max-fps"),e.send(t.toString())}},t.prototype.requestFullFrame=function(){this.packetRequester.requestFullFrame()},t.prototype.requestAndWaitFullFrame=function(){this.packetRequester.requestFullFrame(),this.packetManager.waitFullFrame()},t.MIN_REQUEST_INTERVAL=500,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_REQUEST_COUNT=2,t}(),Vt=function(){function t(e){var r=this;this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDebugContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDebugContainer.parentElement,this.controlPanel=document.getElementById("control-panel"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDebugTools=document.getElementById("control-panel-button-dev-panel"),this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpInfoState=document.getElementById("control-panel-info-state"),t.assignActionOnClick(this.cpButtonRun,function(){return r.client.network.postUserCommand("run","")}),t.assignActionOnClick(this.cpButtonPause,function(){return r.client.network.postUserCommand("pause","")}),t.assignActionOnClick(this.cpButtonX1,function(){return r.setSpeed(1)}),t.assignActionOnClick(this.cpButtonSlower,function(){return r.speedUpOrDown(!1)}),t.assignActionOnClick(this.cpButtonFaster,function(){return r.speedUpOrDown(!0)}),t.assignActionOnClick(this.cpButtonVirtual,function(){return r.setSpeed(1/0)}),this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},t.assignActionOnClick(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),E.addFullScreenListener(function(){return r.onFullScreenChange()}),this.cpButtonDebugTools.style.display="none"}return t.prototype.updateExperimentState=function(){this.updateInfoState(),this.updateModelTimeScale(),this.updateRunGroup(),this.updateSpeedGroup()},t.prototype.updateModelTimeScale=function(){this.cpInfoScale.innerText=t.timeScaleToString(this.client.getModelTimeScale())},t.prototype.updateExperimentProgress=function(){var t=this.client.getModelProgress(),e=this.progressBar.firstElementChild,r=100*t;this.progressBar.style.width=t<=0?"0":r+"%",e.innerText=t<0?"progress n/a":Math.round(r)+"%"},t.prototype.updateInfoState=function(){var e=this.client.getModelState(),r=t.modelStateToString(e);this.cpInfoState.innerText=t.modelStateToString(r),this.indicateCpErrorState("ERROR"==e)},t.prototype.indicateCpErrorState=function(t){t?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getModelState()&&this.indicateCpErrorState(!1)},t.prototype.updateRunGroup=function(){var e=this.client.getModelState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e;t.setVisible(this.cpButtonRun,!r),this.setEnabled(this.cpButtonRun,!r&&i),t.setVisible(this.cpButtonPause,r),this.setEnabled(this.cpButtonPause,r)},t.prototype.updateSpeedGroup=function(){var e=this.client.getModelState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e,i=t.stringToTimeScale(this.cpInfoScale.innerText);this.setEnabled(this.cpButtonX1,r&&1!=i),this.setEnabled(this.cpButtonSlower,r&&i>t.speeds[0]),this.setEnabled(this.cpButtonFaster,r&&i!=1/0),this.setEnabled(this.cpButtonVirtual,r&&i!=1/0)},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=p.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r)},t.prototype.setSpeed=function(e){this.cpInfoScale.innerText=t.timeScaleToString(e),this.client.network.postUserCommand("setspeed",e.toString()),this.updateSpeedGroup()},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=E.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed"))},t.prototype.toggleFullScreen=function(){E.toggleFullScreen(this.presentationContainer)},t.modelStateToString=function(t){switch(t){case"INITIALIZE":return"Initializing...";case"IDLE":return"Idle";case"RUNNING":return"Running";case"PAUSED":return"Paused";case"FINISHED":return"Finished.";case"ERROR":return"Error!";case"PLEASE_WAIT":return"Please Wait..."}return t},t.timeScaleToString=function(t){return t<0||t==1/0?"Virtual":t>=1?"x"+t:"x1/"+1/t},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.setVisible=function(t,e){e?t.style.removeProperty("display"):t.style.display="none"},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.assignActionOnClick=function(e,r){e.onclick=function(){t.isEnabled(e)&&r()}},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t}(),Yt=function(){function t(){this.windowAdjusted=!1,this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new Gt(this),this.navigation=new _t(this),this.network=new Ht(this),this.controlPanel=new Vt(this)}return t.prototype.start=function(t){this.svgAnimationInfo=t,this.svg.style.pointerEvents="auto",this.navigation.initSVGNavigation(),this.network.start(),this.frameDrawing.start()},t.prototype.stop=function(t){t?(this.modelState=t.type,this.controlPanel.updateExperimentState()):this.modelState=void 0,this.frameDrawing.stop(),this.navigation.clearSVGNavigation(),this.network.stop(),this.onToggleFullScreen=void 0,this.onResize=void 0,this.onStop=void 0,this.windowAdjusted=!1,bt.removeAllChildren(this.presentation)},t.prototype.setCallback=function(t,e){switch(t){case"ontogglefullscreen":this.onToggleFullScreen=e;break;case"onstop":this.onStop=e;break;case"onresize":this.onResize=e}},t.prototype.pause=function(){this.network.pause()},t.prototype.stopAndAlert=function(t,e){this.frameDrawing.stop(),console.log(t),e&&console.log(e)},t.prototype.updateViewArea=function(){this.navigation.applyNavigationSettings()},t.prototype.updateExperimentState=function(t){t.state!=this.modelState&&(this.modelState=t.state,this.controlPanel.updateExperimentState()),t.progress!=this.modelProgress&&(this.modelProgress=t.progress,this.controlPanel.updateExperimentProgress()),t.time!=this.modelTime&&(this.modelTime=t.time),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.controlPanel.updateModelTimeScale())},t.prototype.getModelTime=function(){},t.prototype.getModelState=function(){},t.prototype.getModelTimeScale=function(){},t.prototype.getModelProgress=function(){},t.prototype.setNavigationSettings=function(t,e){var r=this;!this.windowAdjusted&&this.onResize&&(this.onResize(t,e+50,function(){r.navigation.applyNavigationSettings()}),this.windowAdjusted=!0)},t.DEBUG_MODE=!1,t.DEBUG_SPARK_LOCAL=!1,t}(),jt=function(){function t(){}return t.createClient=function(){return new Yt},t.createDebugger=function(){return new vt(new Yt)},t}(),Xt=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(e){var r=this;np.DEBUG_MODE=!0,np.DEBUG_SPARK_LOCAL=e,this.client.debugger=this,this.serverQueueInfo=document.getElementById("dev-panel-info-server-queue"),this.browserQueueInfo=document.getElementById("dev-panel-info-browser-queue"),this.parseTimeInfo=document.getElementById("dev-panel-info-parse-time"),this.shapeCountInfo=document.getElementById("dev-panel-info-shape-count"),this.cudCountInfo=document.getElementById("dev-panel-info-cud-count"),this.drawTimeInfo=document.getElementById("dev-panel-info-draw-time"),this.fpsInfo=document.getElementById("dev-panel-info-fps"),this.timeInfo=document.getElementById("dev-panel-info-time"),e&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return r.onNewModelSelected()}),t.elementcount=0},t.prototype.stop=function(){this.serverQueueInfo=void 0,this.browserQueueInfo=void 0,this.parseTimeInfo=void 0,this.shapeCountInfo=void 0,this.cudCountInfo=void 0,this.drawTimeInfo=void 0,this.fpsInfo=void 0,this.timeInfo=void 0,this.modelSelector&&(this.modelSelector.onchange=void 0,this.modelSelector=void 0),t.elementcount=0},t.prototype.onNewModelSelected=function(){var e=this;if(null!=this.client.svg&&this.client.stop("TERMINATED"),this.shapeCountInfo.innerHTML=t.elementcount,"NO MODEL SELECTED"!=this.modelSelector.value){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200===r.status&&e.client.start({})},r.open("GET","/http/start?path="+this.modelSelector.value,!0),r.send()}},t}(),qt=function(){function t(){}return t.createSvgElement=function(e){return np.DEBUG_MODE&&Xt.elementcount++,document.createElementNS(t.svgns,e)},t.createXhtmlElement=function(e){return np.DEBUG_MODE&&Xt.elementcount++,document.createElementNS(t.xhtmlns,e)},t.createTextNode=function(t){return np.DEBUG_MODE&&Xt.elementcount++,document.createTextNode(t)},t.createUseElement=function(e){var r=t.createSvgElement("use"),i="#"+e;return r.setAttributeNS(t.xlinkns,"href",i),r},t.changeUseHref=function(e,r){e.setAttributeNS(t.xlinkns,"href","#"+r)},t.cloneElementWithId=function(e){var r=document.getElementById(e);return t.cloneElement(r)},t.cloneElement=function(e){var r=e.cloneNode(!0);return r.removeAttribute("id"),np.DEBUG_MODE&&(Xt.elementcount+=1+t.childNodeDeepCount(r)),r},t.removeElement=function(e,r){for(var i=0,n=["canvas-group","canvas-group-3d"];i<n.length;i++){var a=n[i],o=document.getElementById(a);if(o)for(var s=o.children,l=s.length-1;l>=0;l--){var u=parseInt(s[l].id),c=document.getElementById(u.toString());(r==c||r.contains(c))&&(o.removeChild(s[l]),np.DEBUG_MODE&&Xt.elementcount--)}}np.DEBUG_MODE&&(Xt.elementcount-=1+t.childNodeDeepCount(r)),e.removeChild(r)},t.removeAllChildren=function(e){for(;e.lastChild;)t.removeElement(e,e.lastChild)},t.bringElementToFront=function(t){t.parentNode.appendChild(t)},t.childElements=function(t){var e=t.children;if(!e){for(var r=t.childNodes,i=[],n=0;n<r.length;n++){var a=r[n];1==a.nodeType&&i.push(a)}return i}return e},t.isPrimitiveSVGElement=function(t){return!(t.startsWith("Shape")||t.startsWith("Markup")||t.startsWith("Control")||t.startsWith("Chart")||t.startsWith("Window3D"))},t.isContainedInElementOfType=function(t,e){for(;t&&1==t.nodeType&&e.indexOf(t.getAttribute("type"))<0;)t=t.parentNode;return t&&1==t.nodeType},t.findChildOfType=function(e,r){for(var i=t.childElements(e),n=0;n<i.length;n++)if(i[n].getAttribute("type")==r)return i[n];return console.log("Child of type "+r+" not found in",e),null},t.findChildWithId=function(t,e){for(var r=t.childNodes,i=0;i<r.length;i++){var n=r[i];if(n.id==e)return n}return console.log("Child with id "+e+" not found in",t),null},t.findParentOfType=function(t,e){for(var r=t.parentNode;;){if(!r||1!=r.nodeType)return null;var i=r;if(i.getAttribute("type")==e)return i;r=i.parentNode}},t.childNodeDeepCount=function(e){var r=e.childNodes;if(!r)return 0;for(var i=r.length,n=0;n<r.length;n++)i+=t.childNodeDeepCount(r[n]);return i},t.createCanvas=function(e,r){var i=t.createXhtmlElement("canvas");return document.getElementById(r).appendChild(i),i.id=e+"canvas",i},t.xhtmlns="http://www.w3.org/1999/xhtml",t.xlinkns="http://www.w3.org/1999/xlink",t.svgns="http://www.w3.org/2000/svg",t}(),Zt=function(){function t(){}return t.offsetPage=function(t){var e=t.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+i,left:e.left+r}},t.indexInParent=function(t){var e;for(e=0;t=t.previousElementSibling;e++);return e},t.radiansToDegrees=function(t){return 360*t/(2*Math.PI)},t.modulo=function(t,e){var r=t%e;return Math.floor(r>=0?r:r+e)},t.remainderPositive=function(t,e){var r=t%e;return r>=0?r:r+e},t.formatNumber=function(t,e){if(t==-1/0)return"-Infinity";if(t==1/0)return"+Infinity";if(isNaN(t))return"NaN";var r=Math.abs(t);return r<1e-12?String(0):r>9999999999||r<.001&&0!=t?String(+t.toExponential(2)):String(+t.toFixed(2))},t.formatPercent=function(t){return+Math.round(100*t)+"%"},t.reducePrecision=function(t){return+t.toPrecision(4)},t.fixedPrecision=function(t,e){return+t.toFixed(e)},t.dateComponent=function(t,e){var r,i=t.getFullYear();switch(e){case"YYYY":return String(i);case"MMM":switch(t.getMonth()+1){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec";default:return null}case"MM":r=t.getMonth()+1;break;case"DD":r=t.getDate();break;case"HH":r=t.getHours();break;case"mm":r=t.getMinutes();break;case"ss":r=t.getSeconds()}return r<10?"0"+r:String(r)},t.formatDate=function(e,r){switch(r){case"YYYY":return t.dateComponent(e,"YYYY");case"MMMYYYY":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"YYYY");case"DDMMM":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"DD");case"DDMMHH":return t.dateComponent(e,"MM")+"/"+t.dateComponent(e,"DD")+" "+t.dateComponent(e,"HH")+":00";case"HHmm":return t.dateComponent(e,"HH")+":"+t.dateComponent(e,"mm");case"mmss":default:return t.dateComponent(e,"mm")+"'"+t.dateComponent(e,"ss")+"''"}},t.toMilliseconds=function(e,r){switch(e.modelSettings.timeUnit){case"MILLISECOND":return r*t.MILLISECOND;case"SECOND":return r*t.SECOND;case"MINUTE":return r*t.MINUTE;case"HOUR":return r*t.HOUR;case"DAY":return r*t.DAY;case"WEEK":return r*t.WEEK;case"MONTH":return r*t.MONTH;case"YEAR":return r*t.YEAR}},t.toDate=function(e,r){var i=e.modelSettings,n=r-i.startTime;return new Date(i.startDate+t.toMilliseconds(e,n))},t.date=function(e){return t.toDate(e,e.time)},t.setMultipleAttributes=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i].toString())},t.getAttributeValue=function(t,e,r){var i=t.indexOf(r);return i<0?null:e[i]},t.removeAttribute=function(t,e,r){for(var i=0;i<t.length;i++)if(t[i]==r)return t.splice(i,1),void e.splice(i,1)},t.getSubAttribute=function(t,e){for(var r=0;r<t.length;r++){var i=t[r].split(":");if(2==i.length&&i[0]==e)return i[1]}return null},t.getFloatSubAttribute=function(e,r){var i=t.getSubAttribute(e,r);return null==i?null:parseFloat(i)},t.getIntAttribute=function(t,e){return parseInt(t.getAttribute(e))},t.getFloatAttribute=function(t,e){return parseFloat(t.getAttribute(e))},t.splitSkipEmpty=function(e,r){return e.split(r).filter(t.isEmpty)},t.isEmpty=function(t){return t.length>0},t.splitToFloats=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseFloat(i[n]);return i},t.splitToInts=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseInt(i[n]);return i},t.hyphenToCameLCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.parseTranslateTransform=function(e){var r=t.translateRegExp2.exec(e);return null!=r?[parseFloat(r[1]),parseFloat(r[2])]:(r=t.translateRegExp1.exec(e),[parseFloat(r[1]),0])},t.increaseTransparency=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=i[4]?i[4]:1;return"rgba("+i[1]+","+i[2]+","+i[3]+","+r*n+")"},t.changeBrightness=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=parseInt(i[1]),a=parseInt(i[2]),o=parseInt(i[3]);if(r<=1)n*=r,a*=r,o*=r;else{var s=1-1/r;n+=(255-n)*s,a+=(255-a)*s,o+=(255-o)*s}return n=Math.round(n),a=Math.round(a),o=Math.round(o),i[4]?"rgba("+n+","+a+","+o+","+i[4]+")":"rgb("+n+","+a+","+o+")"},t.pathAngleAt=function(t,e){var r=t.getTotalLength();e=Math.max(3,e),e=Math.min(e,r);var i=Math.max(0,e-3),n=t.getPointAtLength(e),a=t.getPointAtLength(i);return Math.atan2(n.y-a.y,n.x-a.x)},t.addPathArrows=function(e,r,i,n,a,o){for(var s=e.getTotalLength(),l=a;l<s;l+=o){var u=e.getPointAtLength(l),c=e.getPointAtLength(l-3),h=t.radiansToDegrees(Math.PI/2-Math.atan2(u.x-c.x,u.y-c.y)),d=qt.createUseElement(r);d.setAttribute("stroke-width",i.toString()),d.setAttribute("transform","translate("+u.x+" "+u.y+") rotate( "+h+")"),n.appendChild(d)}},t.sectorData=function(t,e,r,i,n,a){var o=Math.abs(a)>2*Math.PI?a%(2*Math.PI):a;a==2*Math.PI&&(a-=1e-4);var s=n+a,l=t+r*Math.cos(n),u=e+i*Math.sin(n),c=t+r*Math.cos(s),h=e+i*Math.sin(s);return"M "+t+" "+e+" L "+l+" "+u+" A "+r+" "+i+" 0 "+(Math.abs(o)>Math.PI?"1 ":"0 ")+(o>0?"1 ":"0 ")+c+" "+h+" Z"},t.roundPathCorners=function(t,e,r){function i(t,e,r){var i=e.x-t.x,a=e.y-t.y,o=Math.sqrt(i*i+a*a);return n(t,e,Math.min(1,r/o))}function n(t,e,r){return{x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}}function a(t,e){t.length>2&&(t[t.length-2]=e.x,t[t.length-1]=e.y)}function o(t){return{x:parseFloat(t[t.length-2]),y:parseFloat(t[t.length-1])}}var s=t.split(/[,\s]/).reduce(function(t,e){var r=e.match("([a-zA-Z])(.+)");return r?(t.push(r[1]),t.push(r[2])):t.push(e),t},[]).reduce(function(t,e){return parseFloat(e)==e&&t.length?t[t.length-1].push(e):t.push([e]),t},[]),l=[];if(s.length>1){var u=o(s[0]),c=null;"Z"==s[s.length-1][0]&&s[0].length>2&&(c=["L",u.x,u.y],s[s.length-1]=c),l.push(s[0]);for(var h=1;h<s.length;h++){var d=l[l.length-1],p=s[h],f=p==c?s[1]:s[h+1];if(f&&d&&d.length>2&&"L"==p[0]&&f.length>2&&"L"==f[0]){var m,g,v=o(d),b=o(p),y=o(f);r?(m=n(b,d.origPoint||v,e),g=n(b,f.origPoint||y,e)):(m=i(b,v,e),g=i(b,y,e)),a(p,m),p.origPoint=b,l.push(p);var A=n(m,b,.5),T=n(b,g,.5),C=["C",A.x,A.y,T.x,T.y,g.x,g.y];C.origPoint=b,l.push(C)}else l.push(p)}if(c){var S=o(l[l.length-1]);l.push(["Z"]),a(l[0],S)}}else l=s;return l.reduce(function(t,e){return t+e.join(" ")+" "},"")},t.stringToByteArray=function(t){for(var e=[],r=0,i=0;i<t.length;i++){for(var n=t.charCodeAt(i);n>255;)e[r++]=255&n,n>>=8;e[r++]=n}return e},t.byteArrayToString=function(t){if(t.length<=8192)return String.fromCharCode.apply(null,t);for(var e="",r=0;r<t.length;r+=8192){var i=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,i)}return e},t.translateRegExp1=/^translate\s*\(\s*(-?\d*.?\d*)\s*\)\s*$/i,t.translateRegExp2=/^translate\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)\s*$/i,t.rgbRegExp=/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,t.rgbaRegExp=/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*.?\d*)\s*\)\s*$/i,t.MILLISECOND=1,t.SECOND=1e3*t.MILLISECOND,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR,t.WEEK=7*t.DAY,t.MONTH=30*t.DAY,t.YEAR=365*t.DAY,t}(),Kt=function(){function t(t){this.frameDrawing=t}return t.createShapeArc=function(){return qt.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:Jd.filterAndSetAttribute(t,e[a],r[a])}},t.createShapeText=function(){return qt.createSvgElement("text")},t.updateShapeText=function(t,e,r){for(var i=0;i<e.length;i++)if("text-content"==e[i]){null==r[i]&&(r[i]="");var n=r[i].split("\n"),a=t.childElementCount;if(1==n.length&&1==a)t.firstChild.firstChild.textContent=n[0];else{for(var o=Zt.getFloatAttribute(t,"first-line-offset"),s=Zt.getFloatAttribute(t,"line-height"),l=0;l<n.length;l++){var u=qt.childElements(t),c=n[l];if(c.endsWith("\r")&&(c=c.substring(0,c.length-1)),u[l])u[l].firstChild.textContent=c;else{var h=qt.createSvgElement("tspan");h.setAttribute("x","0"),h.setAttribute("y",(o+l*s).toString());var d=qt.createTextNode(c);h.appendChild(d),t.appendChild(h)}}for(;t.childElementCount>n.length;)qt.removeElement(t,t.lastChild)}}else Jd.filterAndSetAttribute(t,e[i],r[i])},t.createShapeImage=function(){return qt.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":qt.removeAllChildren(t);break;case"add":var n=qt.createSvgElement("image");n.setAttributeNS(qt.xlinkns,"href",this.frameDrawing.client.network.getJarResourceURL(r[i])),n.setAttribute("visibility","hidden"),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.appendChild(n);break;case"set":for(var a=parseInt(r[i]),o=t.childNodes,s=0;s<o.length;s++)(n=o[s]).setAttribute("visibility",s==a?"inherit":"hidden");break;case"width":case"height":o=t.childNodes;for(s=0;s<o.length;s++)(n=o[s]).setAttribute(e[i],r[i]);default:Jd.filterAndSetAttribute(t,e[i],r[i])}},t.createShapeCanvas=function(t){var e=qt.createSvgElement("image");qt.createCanvas(t,"canvas-group");return e},t.updateShapeCanvas=function(t,e,r){for(var i=t,n=document.getElementById(t.id+"canvas"),a=n.getContext("2d"),o=0;o<e.length;o++)switch(e[o]){case"global-composite-operation":a.globalCompositeOperation=r[o];break;case"width":case"height":i.setAttribute(e[o],r[o]),n.setAttribute(e[o],r[o]);break;case"fill-rect":case"clear-rect":var s=r[o].split(" "),l=parseFloat(s[0]),u=parseFloat(s[1]),c=parseFloat(s[2]),h=parseFloat(s[3]);if("clear-rect"==e[o])a.clearRect(l,u,c,h);else{var d=s[4];a.fillStyle=d,a.fillRect(l,u,c,h)}break;case"fill-circle":s=r[o].split(" ");var p=parseFloat(s[0]),f=parseFloat(s[1]),m=parseFloat(s[2]),g=s[3];a.fillStyle=g,a.beginPath(),a.arc(p,f,m,0,2*Math.PI),a.fill();break;case"clear":a.clearRect(0,0,n.width,n.height);break;case"update":i.setAttributeNS(qt.xlinkns,"href",n.toDataURL("image/x-xbitmap"));break;default:Jd.filterAndSetAttribute(t,e[o],r[o])}},t.createUnsupportedObject=function(t){var e=qt.cloneElementWithId("unsupported-object");return qt.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=qt.findChildOfType(t,"background"),n=qt.findChildOfType(t,"text"),a=0;a<e.length;a++)switch(e[a]){case"width":var o=parseFloat(r[a]);i.setAttribute("width",o.toString());var s=n.getBBox();o<s.width&&(n.firstChild.textContent="Not supported",s=n.getBBox()),o<s.width&&(n.firstChild.textContent="N/A",s=n.getBBox()),o<s.width&&(n.firstChild.textContent=""),n.setAttribute("x",(o/2).toString());break;case"height":var l=parseFloat(r[a]);i.setAttribute("height",l.toString()),n.setAttribute("y",(l/2+3).toString());break;default:Jd.filterAndSetAttribute(t,e[a],r[a])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeGISMap"],t}(),Qt=function(){function t(){}return t.createStockIcon=function(t){var e=qt.cloneElementWithId("STOCK"),r=qt.findChildOfType(e,"back"),i=parseFloat(Zt.getSubAttribute(t,"width")),n=parseFloat(Zt.getSubAttribute(t,"height"));Zt.setMultipleAttributes(r,["x","y","width","height"],[-i/2,-n/2,i,n]);var a=qt.findChildOfType(e,"bars").firstElementChild;Zt.setMultipleAttributes(a,["x","width"],[-i/2+1,i-2]);var o=Zt.getSubAttribute(t,"color");return null!=o&&(r.setAttribute("stroke",o),a.setAttribute("fill",o)),e},t.createFlowIcon=function(e){for(var r=qt.cloneElementWithId("FLOW"),i=qt.findChildOfType(r,"basepath"),n=qt.findChildOfType(r,"innerpath"),a=qt.findChildOfType(r,"animation"),o=qt.findChildOfType(r,"arrow"),s=qt.findChildOfType(r,"valve"),l=Zt.getSubAttribute(e,"color"),u=Zt.getSubAttribute(e,"points"),c=Zt.splitSkipEmpty(u,";"),h="",d=0;d<c.length;d++){var p=Zt.splitToFloats(c[d],",");if(h+=0==d?"M ":"L ",h+=p[0]+" "+p[1]+" ",0==d&&"null"==Zt.getSubAttribute(e,"source")){var f=Zt.splitToFloats(c[1],","),m=Math.atan2(p[1]-f[1],p[0]-f[0]);t.addFlowCloud(r,!0,p[0],p[1],m,l)}if(d==c.length-1){var g=Zt.splitToFloats(c[d-1],","),v=(m=Math.atan2(p[1]-g[1],p[0]-g[0]),Zt.radiansToDegrees(m)),b="translate("+p[0]+","+p[1]+") rotate("+v+")";o.setAttribute("transform",b),"null"==Zt.getSubAttribute(e,"target")&&t.addFlowCloud(r,!1,p[0],p[1],m,l)}}var y=Zt.roundPathCorners(h,5,!1);i.setAttribute("d",y),n.setAttribute("d",y),a.setAttribute("d",y);var A=Zt.getSubAttribute(e,"valve-pos"),T=Zt.splitToFloats(A,","),C="translate("+T[0]+","+T[1]+") rotate("+Zt.radiansToDegrees(T[2])+")";return s.setAttribute("transform",C),"true"==Zt.getSubAttribute(e,"external")&&s.setAttribute("stroke-dasharray","1,1"),null!=l&&(i.setAttribute("stroke",l),o.setAttribute("stroke",l),o.setAttribute("fill",Zt.changeBrightness(l,2)),s.setAttribute("stroke",l),s.setAttribute("fill",Zt.changeBrightness(l,2))),r},t.addFlowCloud=function(t,e,r,i,n,a){var o=e?15:35,s=r+o*Math.cos(n),l=i+o*Math.sin(n),u=qt.createUseElement("flow-cloud-fill"),c=qt.createUseElement("flow-cloud-line");Zt.setMultipleAttributes(u,["x","y"],[s,l]),Zt.setMultipleAttributes(c,["x","y"],[s,l]),c.setAttribute("stroke",null==a?"CornflowerBlue":a),t.appendChild(u),t.appendChild(c)},t.createDynamicVariableIcon=function(t){var e,r=(e="true"==Zt.getSubAttribute(t,"external")?qt.cloneElementWithId("DYNAMIC_VARIABLE_EXTERNAL"):"true"==Zt.getSubAttribute(t,"constant")?qt.cloneElementWithId("DYNAMIC_VARIABLE_CONSTANT"):qt.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,i=Zt.getSubAttribute(t,"color");return null!=i&&r.setAttribute("fill",i),e},t.createShadowIconAndInfo=function(t,e,r){var i=Zt.getSubAttribute(r,"original"),n=$t.getModelElementByName(t,i);if(null==n)return console.log("Shadow variable could not find its original, name: "+i),qt.createUseElement("DEFAULT_MODEL_ELEMENT");var a,o=qt.findChildOfType(n,"icon");if("FLOW"==n.getAttribute("type")){var s=(a=qt.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,l=qt.findChildOfType(o,"valve");s.setAttribute("fill",l.getAttribute("stroke"))}else o.id=n.id+"icon",a=qt.createUseElement(o.id);var u=qt.findChildOfType(n,"info");u.id=n.id+"info";var c=qt.createUseElement(u.id);c.setAttribute("type","info");var h=qt.findChildOfType(e,"info"),d=Zt.getFloatAttribute(h,"x"),p=Zt.getFloatAttribute(h,"y");e.removeChild(h);var f=Zt.getFloatAttribute(u,"x"),m=Zt.getFloatAttribute(u,"y");return Zt.setMultipleAttributes(c,["x","y"],[-f+d,-m+p]),e.appendChild(c),a},t.createLinkIcon=function(t){var e=qt.cloneElementWithId("LINK"),r=qt.findChildOfType(e,"path"),i=Zt.splitToFloats(Zt.getSubAttribute(t,"start-point"),","),n=Zt.splitToFloats(Zt.getSubAttribute(t,"end-point"),","),a=Zt.getFloatSubAttribute(t,"r");if(null==a)r.setAttribute("d","M "+i[0]+" "+i[1]+" L "+n[0]+" "+n[1]);else{var o=Zt.getSubAttribute(t,"large"),s=Zt.getSubAttribute(t,"sweep");r.setAttribute("d","M "+i[0]+" "+i[1]+" A "+a+" "+a+" 0 "+o+" "+s+" "+n[0]+" "+n[1])}var l=r.getTotalLength(),u=qt.findChildOfType(e,"arrow"),c=Zt.pathAngleAt(r,l),h=Zt.radiansToDegrees(c);u.setAttribute("transform","translate("+n[0]+" "+n[1]+") rotate("+h+")");var d=Zt.getSubAttribute(t,"color");null!=d&&(r.setAttribute("stroke",d),u.setAttribute("fill",d));var p=Zt.getSubAttribute(t,"stroke-width");if(null!=p){r.setAttribute("stroke-width",p);var f=1+((C=parseInt(p))-1)/4;u.setAttribute("transform",u.getAttribute("transform")+" scale("+f+")")}var m=Zt.getSubAttribute(t,"polarity");if(null!=m){var g=qt.createSvgElement("text");g.appendChild(qt.createTextNode(m));var v=n[0]+8*Math.cos(c-Math.PI/2),b=n[1]+8*Math.sin(c-Math.PI/2)+4;Zt.setMultipleAttributes(g,["x","y"],[v,b]),Zt.setMultipleAttributes(g,["fill","text-anchor"],[r.getAttribute("stroke"),"middle"]),e.appendChild(g)}if("true"==Zt.getSubAttribute(t,"delay")){var y=qt.createUseElement("link-delay");y.setAttribute("stroke",null==d?"CornflowerBlue":d);var A=r.getPointAtLength(l/2),T=Zt.radiansToDegrees(Zt.pathAngleAt(r,l/2));y.setAttribute("transform","translate("+A.x+" "+A.y+") rotate( "+T+")"),e.appendChild(y)}if("true"==Zt.getSubAttribute(t,"initial-value")){var C=Zt.getFloatAttribute(r,"stroke-width");r.setAttribute("stroke-dasharray",4*C+","+1.5*C)}return e},t.createCausalLoopIcon=function(t){var e="true"==Zt.getSubAttribute(t,"clockwise"),r=qt.cloneElementWithId(e?"CAUSAL_LOOP_CW":"CAUSAL_LOOP_CCW"),i=qt.findChildOfType(r,"loop"),n=qt.findChildOfType(r,"arrow"),a=qt.findChildOfType(r,"text"),o=Zt.getSubAttribute(t,"text");a.firstChild.textContent=o;var s=8*o.length;if(s>18){var l=(s+6)/2;i.setAttribute("d","M0 -"+l+" A "+l+" "+l+" 0 1 "+(e?1:0)+" "+(e?-l:l)+" 0"),n.setAttribute("transform","translate("+(e?-1:1)*(l-12)+" 0)")}var u=Zt.getSubAttribute(t,"color");return null!=u&&(i.setAttribute("stroke",u),n.setAttribute("fill",u),a.setAttribute("fill",u)),r},t.updateStockState=function(t,e){var r=Zt.splitToFloats(e,","),i=r.length,n=qt.findChildOfType(t,"back"),a=qt.findChildOfType(t,"bars");if(a.childElementCount<i){for(var o=a.firstElementChild;a.childElementCount<i;)a.appendChild(qt.cloneElement(o));var s=Zt.getFloatAttribute(n,"width"),l=-s/2+1,u=(s-1)/i-1;do{Zt.setMultipleAttributes(o,["x","width"],[l,u]),l+=u+1,o=o.nextElementSibling}while(null!=o)}for(var c=1/0,h=-1/0,d=0,p=r;d<p.length;d++){var f=p[d];f<c&&(c=f),h<f&&(h=f)}var m=Math.max(Math.abs(c),Math.abs(h)),g=Math.pow(10,Math.ceil(Math.log10(m)));c<0&&(g*=2),g<=0&&(g=1);for(var v=Zt.getFloatAttribute(n,"height"),b=a.firstElementChild,y=0;y<i;y++){var A=(v-2)*(r[y]/g),T=void 0;r[y]>=0?T=c>=0?v/2-1-A:-A:(A=-A,T=0),Zt.setMultipleAttributes(b,["y","height"],[T,A]),b=b.nextElementSibling}},t.updateFlowDirection=function(t,e){var r;r="1"==e?"model-primitive-flow-forward":"-1"==e?"model-primitive-flow-backward":"",qt.findChildOfType(t,"animation").setAttribute("class",r)},t}(),Jt=function(){function t(){}return t.createStateIcon=function(t){var e=qt.cloneElementWithId("STATE"),r=parseFloat(Zt.getSubAttribute(t,"width")),i=parseFloat(Zt.getSubAttribute(t,"height"));Zt.setMultipleAttributes(e,["width","height"],[r,i]);var n=Zt.getSubAttribute(t,"color"),a="true"==Zt.getSubAttribute(t,"composite");return e.setAttribute("composite",a?"true":"false"),null!=n?(e.setAttribute("fill",n),e.setAttribute("stroke",Zt.changeBrightness(n,.8))):a&&(e.setAttribute("fill","none"),e.setAttribute("stroke","Gray")),e.setAttribute("stroke-width",a?"2":"1"),e},t.createFinalStateIcon=function(){return qt.cloneElementWithId("FINAL_STATE")},t.createTransitionIcon=function(t){for(var e=qt.cloneElementWithId("TRANSITION"),r=qt.findChildOfType(e,"path"),i=Zt.getSubAttribute(t,"points"),n=Zt.splitSkipEmpty(i,";"),a="",o=0;o<n.length;o++){var s=Zt.splitToFloats(n[o],",");if(o==n.length-1){var l=Zt.splitToFloats(n[o-1],","),u=Math.atan2(s[1]-l[1],s[0]-l[0]);s[0]-=Math.round(4*Math.cos(u)),s[1]-=Math.round(4*Math.sin(u));var c=Zt.radiansToDegrees(u),h="translate("+s[0]+","+s[1]+") rotate("+c+")";qt.findChildOfType(e,"arrow").setAttribute("transform",h)}a+=(0==o?"M ":"L ")+s[0]+" "+s[1]+" "}var d=Zt.roundPathCorners(a,10,!1);r.setAttribute("d",d);var p=Zt.getSubAttribute(t,"trigger");if(null!=p){var f=qt.createUseElement("transition-icon-"+p);f.setAttribute("type","trigger"),f.setAttribute("stroke","Black"),qt.findChildOfType(e,"path").setAttribute("d",d);var m=Zt.getFloatSubAttribute(t,"icon-offset"),g=r.getPointAtLength(m);f.setAttribute("transform","translate("+g.x+","+g.y+")"),e.appendChild(f)}return e},t.createStatePointerIcon=function(t,e){var r=qt.cloneElementWithId("STATE_POINTER"),i=qt.findChildOfType(r,"line"),n=qt.findChildOfType(r,"entry-dash"),a=Zt.getSubAttribute(t,"dxdy"),o=Zt.splitToFloats(a,","),s=Math.atan2(o[1],o[0]);o[0]-=Math.round(4*Math.cos(s)),o[1]-=Math.round(4*Math.sin(s)),Zt.setMultipleAttributes(i,["x2","y2"],[o[0],o[1]]);var l=Zt.radiansToDegrees(s),u="translate("+o[0]+","+o[1]+") rotate("+l+")";return qt.findChildOfType(r,"arrow").setAttribute("transform",u),e?n.setAttribute("transform","rotate("+l+")"):qt.removeElement(r,n),r},t.updateStateState=function(t,e,r){var i="true"==r;if("STATE"==e)if(i)Zt.setMultipleAttributes(t,["stroke","stroke-width"],["Red",2]);else{var n="true"==t.getAttribute("composite")?2:1,a=t.getAttribute("fill"),o="none"==a?"Gray":Zt.changeBrightness(a,.8);Zt.setMultipleAttributes(t,["stroke","stroke-width"],[o,n])}else{var s=qt.findChildOfType(t,"outer");n=i?2:1,o=i?"Red":"Black";Zt.setMultipleAttributes(s,["stroke","stroke-width"],[o,n])}},t.updateTransitionState=function(t,e){var r=qt.findChildOfType(t,"path"),i=qt.findChildOfType(t,"arrow"),n=qt.findChildOfType(t,"trigger"),a="Black";switch(e){case"SCHEDULED":a="Blue";break;case"CURRENT":a="Red"}r.setAttribute("stroke",a),i.setAttribute("fill",a),null!=n&&n.setAttribute("stroke",a)},t}(),$t=function(){function t(){}return t.create=function(){return qt.cloneElementWithId("shape-model-primitives")},t.update=function(e,r,i){for(var n=0;n<r.length;n++)switch(r[n]){case"static-info":for(var a=Zt.splitSkipEmpty(i[n],"\n"),o=0;o<a.length;o++){var s=Zt.splitSkipEmpty(a[o],"|"),l=Zt.getSubAttribute(s,"index"),u=Zt.getSubAttribute(s,"type"),c=Zt.getSubAttribute(s,"name"),h=Zt.getSubAttribute(s,"x"),d=Zt.getSubAttribute(s,"y"),p=qt.cloneElementWithId("model-primitive");p.id=e.id+"-"+l,p.setAttribute("type",u),p.setAttribute("transform","translate("+h+","+d+")");var f=qt.findChildOfType(p,"label"),m=qt.findChildOfType(p,"info");if(f.appendChild(qt.createTextNode(c)),"false"==Zt.getSubAttribute(s,"show-label"))f.setAttribute("visibility","hidden"),m.setAttribute("visibility","hidden");else{var g=parseFloat(Zt.getSubAttribute(s,"label-dx")),v=parseFloat(Zt.getSubAttribute(s,"label-dy"));if("FLOW"==u){var b=Zt.getSubAttribute(s,"valve-pos"),y=Zt.splitToFloats(b,",");g+=y[0],v+=y[1]}Zt.setMultipleAttributes(f,["x","y"],[g,v+4]),Zt.setMultipleAttributes(m,["x","y"],[g,v+4+9]),m.appendChild(qt.createTextNode(""))}var A=void 0;switch(u){case"CONNECTOR":A=t.createConnectorIcon(s);break;case"STOCK":A=Qt.createStockIcon(s);break;case"FLOW":A=Qt.createFlowIcon(s);break;case"DYNAMIC_VARIABLE":A=Qt.createDynamicVariableIcon(s);break;case"SHADOW":A=Qt.createShadowIconAndInfo(e,p,s);break;case"LINK":A=Qt.createLinkIcon(s);break;case"CAUSAL_LOOP":A=Qt.createCausalLoopIcon(s);break;case"STATE":A=Jt.createStateIcon(s);break;case"FINAL_STATE":A=Jt.createFinalStateIcon();break;case"TRANSITION":A=Jt.createTransitionIcon(s);break;case"STATECHART_ENTRY_POINT":A=Jt.createStatePointerIcon(s,!0);break;case"INITIAL_STATE_POINTER":A=Jt.createStatePointerIcon(s,!1);break;default:var T=null==document.getElementById(u)?"DEFAULT_MODEL_ELEMENT":u;A=qt.createUseElement(T)}A.setAttribute("type","icon"),p.insertBefore(A,f),e.appendChild(p)}break;case"update":var C=parseInt(i[n]),S=i[n].slice(i[n].indexOf(" ")+1),E=Zt.splitSkipEmpty(S,"|"),w=qt.findChildWithId(e,e.id+"-"+C),k=qt.findChildOfType(w,"icon"),x=w.getAttribute("type");for(o=0;o<E.length;o++){var M=E[o].split(":");switch(M[0]){case"label":case"info":qt.findChildOfType(w,M[0]).firstChild.textContent=M[1];break;case"info-flag":m=qt.findChildOfType(w,"info");var O="model-primitive-info";"warning"==M[1]&&(O="model-primitive-info-warning"),m.setAttribute("class",O);break;case"null":T=x+("true"==M[1]?"_NULL":"");qt.changeUseHref(k,T);break;case"standard-icon":k.setAttribute("visibility","true"==M[1]?"inherit":"hidden");break;case"event-state":qt.changeUseHref(k,"EVENT_"+M[1]);break;case"port-state":qt.changeUseHref(k,"PORT_"+M[1]);break;case"empty":T=x+("true"==M[1]?"_EMPTY":""),qt.changeUseHref(k,T);break;case"stock-state":Qt.updateStockState(k,M[1]);break;case"flow-sign":Qt.updateFlowDirection(k,M[1]);break;case"state-active":Jt.updateStateState(k,x,M[1]);break;case"transition-state":Jt.updateTransitionState(k,M[1])}}break;default:Jd.filterAndSetAttribute(e,r[n],i[n])}},t.createConnectorIcon=function(t){for(var e=qt.cloneElementWithId("CONNECTOR"),r=Zt.getSubAttribute(t,"points"),i=Zt.splitSkipEmpty(r,";"),n="",a=0;a<i.length;a++){var o=i[a].split(",");if(0==a){n+="M ";var s=qt.findChildOfType(e,"start-circle");Zt.setMultipleAttributes(s,["cx","cy"],o)}else n+="L ";if(n+=o[0]+" "+o[1]+" ",a==i.length-1){var l=qt.findChildOfType(e,"end-circle");Zt.setMultipleAttributes(l,["cx","cy"],o)}}var u=Zt.roundPathCorners(n,5,!1);return qt.findChildOfType(e,"path").setAttribute("d",u),e},t.getModelElementByName=function(t,e){for(var r=0,i=qt.childElements(t);r<i.length;r++){var n=i[r],a=qt.findChildOfType(n,"label");if(null!=a&&a.innerHTML==e)return n}return null},t}();function te(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}),Object.assign(te.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var i=r.indexOf(e);-1!==i&&r.splice(i,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=e.slice(0),i=0,n=r.length;i<n;i++)r[i].call(this,t)}}}});var ee,re,ie,ne="104",ae=0,oe=1,se=2,le=0,ue=1,ce=2,he=1,de=2,pe=0,fe=1,me=2,ge=0,ve=1,be=2,ye=0,Ae=1,Te=2,Ce=3,Se=4,Ee=5,we=100,ke=101,xe=102,Me=103,Oe=104,Ie=200,_e=201,Le=202,Pe=203,Re=204,De=205,Fe=206,Ne=207,Be=208,Ge=209,Ue=210,ze=0,We=1,He=2,Ve=3,Ye=4,je=5,Xe=6,qe=7,Ze=0,Ke=1,Qe=2,Je=0,$e=1,tr=2,er=3,rr=4,ir=5,nr=301,ar=302,or=303,sr=304,lr=305,ur=306,cr=307,hr=1e3,dr=1001,pr=1002,fr=1003,mr=1004,gr=1005,vr=1006,br=1007,yr=1008,Ar=1009,Tr=1010,Cr=1011,Sr=1012,Er=1013,wr=1014,kr=1015,xr=1016,Mr=1017,Or=1018,Ir=1019,_r=1020,Lr=1021,Pr=1022,Rr=1023,Dr=1024,Fr=1025,Nr=1026,Br=1027,Gr=1028,Ur=33776,zr=33777,Wr=33778,Hr=33779,Vr=35840,Yr=35841,jr=35842,Xr=35843,qr=36196,Zr=37808,Kr=37809,Qr=37810,Jr=37811,$r=37812,ti=37813,ei=37814,ri=37815,ii=37816,ni=37817,ai=37818,oi=37819,si=37820,li=37821,ui=2201,ci=2400,hi=0,di=1,pi=2,fi=3e3,mi=3001,gi=3007,vi=3002,bi=3004,yi=3005,Ai=3006,Ti=3200,Ci=3201,Si=0,Ei=1,wi={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return function(){var e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&r]+t[r>>8&255]+"-"+t[r>>16&15|64]+t[r>>24&255]+"-"+t[63&i|128]+t[i>>8&255]+"-"+t[i>>16&255]+t[i>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]).toUpperCase()}}(),clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,i,n){return i+(t-e)*(n-i)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*wi.DEG2RAD},radToDeg:function(t){return t*wi.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function ki(t,e){this.x=t||0,this.y=e||0}function xi(t,e,r,i){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==i?i:1}function Mi(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}function Oi(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(ki.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(ki.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,r=this.y,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6],this.y=i[1]*e+i[4]*r+i[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var r=Math.cos(e),i=Math.sin(e),n=this.x-t.x,a=this.y-t.y;return this.x=n*r-a*i+t.x,this.y=n*i+a*r+t.y,this}}),Object.assign(xi,{slerp:function(t,e,r,i){return r.copy(t).slerp(e,i)},slerpFlat:function(t,e,r,i,n,a,o){var s=r[i+0],l=r[i+1],u=r[i+2],c=r[i+3],h=n[a+0],d=n[a+1],p=n[a+2],f=n[a+3];if(c!==f||s!==h||l!==d||u!==p){var m=1-o,g=s*h+l*d+u*p+c*f,v=g>=0?1:-1,b=1-g*g;if(b>Number.EPSILON){var y=Math.sqrt(b),A=Math.atan2(y,g*v);m=Math.sin(m*A)/y,o=Math.sin(o*A)/y}var T=o*v;if(s=s*m+h*T,l=l*m+d*T,u=u*m+p*T,c=c*m+f*T,m===1-o){var C=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=C,l*=C,u*=C,c*=C}}t[e]=s,t[e+1]=l,t[e+2]=u,t[e+3]=c}}),Object.defineProperties(xi.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(xi.prototype,{isQuaternion:!0,set:function(t,e,r,i){return this._x=t,this._y=e,this._z=r,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,i=t._y,n=t._z,a=t.order,o=Math.cos,s=Math.sin,l=o(r/2),u=o(i/2),c=o(n/2),h=s(r/2),d=s(i/2),p=s(n/2);return"XYZ"===a?(this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p):"YXZ"===a?(this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p):"ZXY"===a?(this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p):"ZYX"===a?(this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p):"YZX"===a?(this._x=h*u*c+l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c-h*d*p):"XZY"===a&&(this._x=h*u*c-l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c+h*d*p),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,i=Math.sin(r);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,i=r[0],n=r[4],a=r[8],o=r[1],s=r[5],l=r[9],u=r[2],c=r[6],h=r[10],d=i+s+h;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(c-l)*e,this._y=(a-u)*e,this._z=(o-n)*e):i>s&&i>h?(e=2*Math.sqrt(1+i-s-h),this._w=(c-l)/e,this._x=.25*e,this._y=(n+o)/e,this._z=(a+u)/e):s>h?(e=2*Math.sqrt(1+s-i-h),this._w=(a-u)/e,this._x=(n+o)/e,this._y=.25*e,this._z=(l+c)/e):(e=2*Math.sqrt(1+h-i-s),this._w=(o-n)/e,this._x=(a+u)/e,this._y=(l+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(t,e){var r=t.dot(e)+1;return r<1e-6?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(wi.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var r=this.angleTo(t);if(0===r)return this;var i=Math.min(1,e/r);return this.slerp(t,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,i=t._y,n=t._z,a=t._w,o=e._x,s=e._y,l=e._z,u=e._w;return this._x=r*u+a*o+i*l-n*s,this._y=i*u+a*s+n*o-r*l,this._z=n*u+a*l+r*s-i*o,this._w=a*u-r*o-i*s-n*l,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,i=this._y,n=this._z,a=this._w,o=a*t._w+r*t._x+i*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=i,this._z=n,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-e;return this._w=l*a+e*this._w,this._x=l*r+e*this._x,this._y=l*i+e*this._y,this._z=l*n+e*this._z,this.normalize()}var u=Math.sqrt(s),c=Math.atan2(u,o),h=Math.sin((1-e)*c)/u,d=Math.sin(e*c)/u;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=i*h+this._y*d,this._z=n*h+this._z*d,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(Mi.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:(re=new xi,function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(re.setFromEuler(t))}),applyAxisAngle:function(){var t=new xi;return function(e,r){return this.applyQuaternion(t.setFromAxisAngle(e,r))}}(),applyMatrix3:function(t){var e=this.x,r=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6]*i,this.y=n[1]*e+n[4]*r+n[7]*i,this.z=n[2]*e+n[5]*r+n[8]*i,this},applyMatrix4:function(t){var e=this.x,r=this.y,i=this.z,n=t.elements,a=1/(n[3]*e+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*r+n[8]*i+n[12])*a,this.y=(n[1]*e+n[5]*r+n[9]*i+n[13])*a,this.z=(n[2]*e+n[6]*r+n[10]*i+n[14])*a,this},applyQuaternion:function(t){var e=this.x,r=this.y,i=this.z,n=t.x,a=t.y,o=t.z,s=t.w,l=s*e+a*i-o*r,u=s*r+o*e-n*i,c=s*i+n*r-a*e,h=-n*e-a*r-o*i;return this.x=l*s+h*-n+u*-o-c*-a,this.y=u*s+h*-a+c*-n-l*-o,this.z=c*s+h*-o+l*-a-u*-n,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,r=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*r+n[8]*i,this.y=n[1]*e+n[5]*r+n[9]*i,this.z=n[2]*e+n[6]*r+n[10]*i,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,i=t.y,n=t.z,a=e.x,o=e.y,s=e.z;return this.x=i*s-n*o,this.y=n*a-r*s,this.z=r*o-i*a,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:(ee=new Mi,function(t){return ee.copy(this).projectOnVector(t),this.sub(ee)}),reflect:function(){var t=new Mi;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(wi.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return e*e+r*r+i*i},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,r){var i=Math.sin(e)*t;return this.x=i*Math.sin(r),this.y=Math.cos(e)*t,this.z=i*Math.cos(r),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=i,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(Oi.prototype,{isMatrix3:!0,set:function(t,e,r,i,n,a,o,s,l){var u=this.elements;return u[0]=t,u[1]=i,u[2]=o,u[3]=e,u[4]=n,u[5]=s,u[6]=r,u[7]=a,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new Mi;return function(e){for(var r=0,i=e.count;r<i;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix3(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,i=e.elements,n=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],u=r[4],c=r[7],h=r[2],d=r[5],p=r[8],f=i[0],m=i[3],g=i[6],v=i[1],b=i[4],y=i[7],A=i[2],T=i[5],C=i[8];return n[0]=a*f+o*v+s*A,n[3]=a*m+o*b+s*T,n[6]=a*g+o*y+s*C,n[1]=l*f+u*v+c*A,n[4]=l*m+u*b+c*T,n[7]=l*g+u*y+c*C,n[2]=h*f+d*v+p*A,n[5]=h*m+d*b+p*T,n[8]=h*g+d*y+p*C,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],s=t[6],l=t[7],u=t[8];return e*a*u-e*o*l-r*n*u+r*o*s+i*n*l-i*a*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=t.elements,i=this.elements,n=r[0],a=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],h=r[7],d=r[8],p=d*l-u*h,f=u*c-d*s,m=h*s-l*c,g=n*p+a*f+o*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(v);return console.warn(v),this.identity()}var b=1/g;return i[0]=p*b,i[1]=(o*h-d*a)*b,i[2]=(u*a-o*l)*b,i[3]=f*b,i[4]=(d*n-o*c)*b,i[5]=(o*s-u*n)*b,i[6]=m*b,i[7]=(a*c-h*n)*b,i[8]=(l*n-a*s)*b,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,i,n,a,o){var s=Math.cos(n),l=Math.sin(n);this.set(r*s,r*l,-r*(s*a+l*o)+a+t,-i*l,i*s,-i*(-l*a+s*o)+o+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=this.elements,n=i[0],a=i[3],o=i[6],s=i[1],l=i[4],u=i[7];return i[0]=e*n+r*s,i[3]=e*a+r*l,i[6]=e*o+r*u,i[1]=-r*n+e*s,i[4]=-r*a+e*l,i[7]=-r*o+e*u,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,i=0;i<9;i++)if(e[i]!==r[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var Ii,_i,Li,Pi,Ri,Di,Fi,Ni,Bi,Gi,Ui,zi,Wi,Hi,Vi={getDataURL:function(t){var e;if("undefined"==typeof HTMLCanvasElement)return t.src;if(t instanceof HTMLCanvasElement)e=t;else{void 0===ie&&(ie=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),ie.width=t.width,ie.height=t.height;var r=ie.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),e=ie}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},Yi=0;function ji(t,e,r,i,n,a,o,s,l,u){Object.defineProperty(this,"id",{value:Yi++}),this.uuid=wi.generateUUID(),this.name="",this.image=void 0!==t?t:ji.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:ji.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:dr,this.wrapT=void 0!==i?i:dr,this.magFilter=void 0!==n?n:vr,this.minFilter=void 0!==a?a:yr,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:Rr,this.type=void 0!==s?s:Ar,this.offset=new ki(0,0),this.repeat=new ki(1,1),this.center=new ki(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Oi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:fi,this.version=0,this.onUpdate=null}function Xi(t,e,r,i){this.x=t||0,this.y=e||0,this.z=r||0,this.w=void 0!==i?i:1}function qi(t,e,r){this.width=t,this.height=e,this.scissor=new Xi(0,0,t,e),this.scissorTest=!1,this.viewport=new Xi(0,0,t,e),r=r||{},this.texture=new ji(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:vr,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function Zi(t,e,r){qi.call(this,t,e,r),this.samples=4}function Ki(t,e,r){qi.call(this,t,e,r)}function Qi(t,e,r,i,n,a,o,s,l,u,c,h){ji.call(this,null,a,o,s,l,u,i,n,c,h),this.image={data:t,width:e,height:r},this.magFilter=void 0!==l?l:fr,this.minFilter=void 0!==u?u:fr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function Ji(t,e){this.min=void 0!==t?t:new Mi(1/0,1/0,1/0),this.max=void 0!==e?e:new Mi(-1/0,-1/0,-1/0)}function $i(t,e){this.center=void 0!==t?t:new Mi,this.radius=void 0!==e?e:0}function tn(t,e){this.normal=void 0!==t?t:new Mi(1,0,0),this.constant=void 0!==e?e:0}function en(t,e,r,i,n,a){this.planes=[void 0!==t?t:new tn,void 0!==e?e:new tn,void 0!==r?r:new tn,void 0!==i?i:new tn,void 0!==n?n:new tn,void 0!==a?a:new tn]}function rn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}ji.DEFAULT_IMAGE=void 0,ji.DEFAULT_MAPPING=300,ji.prototype=Object.assign(Object.create(te.prototype),{constructor:ji,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=wi.generateUUID()),!e&&void 0===t.images[i.uuid]){var n;if(Array.isArray(i)){n=[];for(var a=0,o=i.length;a<o;a++)n.push(Vi.getDataURL(i[a]))}else n=Vi.getDataURL(i);t.images[i.uuid]={uuid:i.uuid,url:n}}r.image=i.uuid}return e||(t.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case hr:t.x=t.x-Math.floor(t.x);break;case dr:t.x=t.x<0?0:1;break;case pr:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case hr:t.y=t.y-Math.floor(t.y);break;case dr:t.y=t.y<0?0:1;break;case pr:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(ji.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Xi.prototype,{isVector4:!0,set:function(t,e,r,i){return this.x=t,this.y=e,this.z=r,this.w=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,i=this.z,n=this.w,a=t.elements;return this.x=a[0]*e+a[4]*r+a[8]*i+a[12]*n,this.y=a[1]*e+a[5]*r+a[9]*i+a[13]*n,this.z=a[2]*e+a[6]*r+a[10]*i+a[14]*n,this.w=a[3]*e+a[7]*r+a[11]*i+a[15]*n,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,r,i,n,a=t.elements,o=a[0],s=a[4],l=a[8],u=a[1],c=a[5],h=a[9],d=a[2],p=a[6],f=a[10];if(Math.abs(s-u)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(s+u)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(o+c+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(o+1)/2,g=(c+1)/2,v=(f+1)/2,b=(s+u)/4,y=(l+d)/4,A=(h+p)/4;return m>g&&m>v?m<.01?(r=0,i=.707106781,n=.707106781):(i=b/(r=Math.sqrt(m)),n=y/r):g>v?g<.01?(r=.707106781,i=0,n=.707106781):(r=b/(i=Math.sqrt(g)),n=A/i):v<.01?(r=.707106781,i=.707106781,n=0):(r=y/(n=Math.sqrt(v)),i=A/n),this.set(r,i,n,e),this}var T=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(u-s)*(u-s));return Math.abs(T)<.001&&(T=1),this.x=(p-h)/T,this.y=(l-d)/T,this.z=(u-s)/T,this.w=Math.acos((o+c+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return void 0===Ii&&(Ii=new Xi,_i=new Xi),Ii.set(t,t,t,t),_i.set(e,e,e,e),this.clamp(Ii,_i)},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),qi.prototype=Object.assign(Object.create(te.prototype),{constructor:qi,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Zi.prototype=Object.assign(Object.create(qi.prototype),{constructor:Zi,isWebGLMultisampleRenderTarget:!0,copy:function(t){return qi.prototype.copy.call(this,t),this.samples=t.samples,this}}),Ki.prototype=Object.create(qi.prototype),Ki.prototype.constructor=Ki,Ki.prototype.isWebGLRenderTargetCube=!0,Qi.prototype=Object.create(ji.prototype),Qi.prototype.constructor=Qi,Qi.prototype.isDataTexture=!0,Object.assign(Ji.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,r=1/0,i=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,l=t.length;s<l;s+=3){var u=t[s],c=t[s+1],h=t[s+2];u<e&&(e=u),c<r&&(r=c),h<i&&(i=h),u>n&&(n=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(e,r,i),this.max.set(n,a,o),this},setFromBufferAttribute:function(t){for(var e=1/0,r=1/0,i=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,l=t.count;s<l;s++){var u=t.getX(s),c=t.getY(s),h=t.getZ(s);u<e&&(e=u),c<r&&(r=c),h<i&&(i=h),u>n&&(n=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(e,r,i),this.max.set(n,a,o),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Mi;return function(e,r){var i=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Mi),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Mi),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,r,i=new Mi;function n(n){var a=n.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(e=0,r=o.length;e<r;e++)i.copy(o[e]),i.applyMatrix4(n.matrixWorld),t.expandByPoint(i)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(e=0,r=s.count;e<r;e++)i.fromBufferAttribute(s,e).applyMatrix4(n.matrixWorld),t.expandByPoint(i)}}return function(e){return t=this,e.updateMatrixWorld(!0),e.traverse(n),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Mi),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:(Pi=new Mi,function(t){return this.clampPoint(t.center,Pi),Pi.distanceToSquared(t.center)<=t.radius*t.radius}),intersectsPlane:function(t){var e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant},intersectsTriangle:function(){var t=new Mi,e=new Mi,r=new Mi,i=new Mi,n=new Mi,a=new Mi,o=new Mi,s=new Mi,l=new Mi,u=new Mi;function c(i){var n,a;for(n=0,a=i.length-3;n<=a;n+=3){o.fromArray(i,n);var s=l.x*Math.abs(o.x)+l.y*Math.abs(o.y)+l.z*Math.abs(o.z),u=t.dot(o),c=e.dot(o),h=r.dot(o);if(Math.max(-Math.max(u,c,h),Math.min(u,c,h))>s)return!1}return!0}return function(o){if(this.isEmpty())return!1;this.getCenter(s),l.subVectors(this.max,s),t.subVectors(o.a,s),e.subVectors(o.b,s),r.subVectors(o.c,s),i.subVectors(e,t),n.subVectors(r,e),a.subVectors(t,r);var h=[0,-i.z,i.y,0,-n.z,n.y,0,-a.z,a.y,i.z,0,-i.x,n.z,0,-n.x,a.z,0,-a.x,-i.y,i.x,0,-n.y,n.x,0,-a.y,a.x,0];return!!c(h)&&(!!c(h=[1,0,0,0,1,0,0,0,1])&&(u.crossVectors(i,n),c(h=[u.x,u.y,u.z])))}}(),clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Mi),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Mi;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new Mi;return function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(Li=[new Mi,new Mi,new Mi,new Mi,new Mi,new Mi,new Mi,new Mi],function(t){return this.isEmpty()?this:(Li[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Li[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Li[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Li[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Li[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Li[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Li[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Li[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Li),this)}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign($i.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:(Ri=new Ji,function(t,e){var r=this.center;void 0!==e?r.copy(e):Ri.setFromPoints(t).getCenter(r);for(var i=0,n=0,a=t.length;n<a;n++)i=Math.max(i,r.distanceToSquared(t[n]));return this.radius=Math.sqrt(i),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var r=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Mi),e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Ji),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(tn.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,i){return this.normal.set(t,e,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new Mi,e=new Mi;return function(r,i,n){var a=t.subVectors(n,i).cross(e.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(a,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Mi),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new Mi;return function(e,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new Mi);var i=e.delta(t),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?r.copy(e.start):void 0;var a=-(e.start.dot(this.normal)+this.constant)/n;return a<0||a>1?void 0:r.copy(i).multiplyScalar(a).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Mi),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new Mi,e=new Oi;return function(r,i){var n=i||e.getNormalMatrix(r),a=this.coplanarPoint(t).applyMatrix4(r),o=this.normal.applyMatrix3(n).normalize();return this.constant=-a.dot(o),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(en.prototype,{set:function(t,e,r,i,n,a){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(r),o[3].copy(i),o[4].copy(n),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,r=0;r<6;r++)e[r].copy(t.planes[r]);return this},setFromMatrix:function(t){var e=this.planes,r=t.elements,i=r[0],n=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],c=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],g=r[13],v=r[14],b=r[15];return e[0].setComponents(o-i,c-s,f-h,b-m).normalize(),e[1].setComponents(o+i,c+s,f+h,b+m).normalize(),e[2].setComponents(o+n,c+l,f+d,b+g).normalize(),e[3].setComponents(o-n,c-l,f-d,b-g).normalize(),e[4].setComponents(o-a,c-u,f-p,b-v).normalize(),e[5].setComponents(o+a,c+u,f+p,b+v).normalize(),this},intersectsObject:(Fi=new $i,function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Fi.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Fi)}),intersectsSprite:function(){var t=new $i;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,r=t.center,i=-t.radius,n=0;n<6;n++){if(e[n].distanceToPoint(r)<i)return!1}return!0},intersectsBox:(Di=new Mi,function(t){for(var e=this.planes,r=0;r<6;r++){var i=e[r];if(Di.x=i.normal.x>0?t.max.x:t.min.x,Di.y=i.normal.y>0?t.max.y:t.min.y,Di.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(Di)<0)return!1}return!0}),containsPoint:function(t){for(var e=this.planes,r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}}),Object.assign(rn.prototype,{isMatrix4:!0,set:function(t,e,r,i,n,a,o,s,l,u,c,h,d,p,f,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=r,g[12]=i,g[1]=n,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new rn).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(){var t=new Mi;return function(e){var r=this.elements,i=e.elements,n=1/t.setFromMatrixColumn(e,0).length(),a=1/t.setFromMatrixColumn(e,1).length(),o=1/t.setFromMatrixColumn(e,2).length();return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[3]=0,r[4]=i[4]*a,r[5]=i[5]*a,r[6]=i[6]*a,r[7]=0,r[8]=i[8]*o,r[9]=i[9]*o,r[10]=i[10]*o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,i=t.y,n=t.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(i),l=Math.sin(i),u=Math.cos(n),c=Math.sin(n);if("XYZ"===t.order){var h=a*u,d=a*c,p=o*u,f=o*c;e[0]=s*u,e[4]=-s*c,e[8]=l,e[1]=d+p*l,e[5]=h-f*l,e[9]=-o*s,e[2]=f-h*l,e[6]=p+d*l,e[10]=a*s}else if("YXZ"===t.order){var m=s*u,g=s*c,v=l*u,b=l*c;e[0]=m+b*o,e[4]=v*o-g,e[8]=a*l,e[1]=a*c,e[5]=a*u,e[9]=-o,e[2]=g*o-v,e[6]=b+m*o,e[10]=a*s}else if("ZXY"===t.order){m=s*u,g=s*c,v=l*u,b=l*c;e[0]=m-b*o,e[4]=-a*c,e[8]=v+g*o,e[1]=g+v*o,e[5]=a*u,e[9]=b-m*o,e[2]=-a*l,e[6]=o,e[10]=a*s}else if("ZYX"===t.order){h=a*u,d=a*c,p=o*u,f=o*c;e[0]=s*u,e[4]=p*l-d,e[8]=h*l+f,e[1]=s*c,e[5]=f*l+h,e[9]=d*l-p,e[2]=-l,e[6]=o*s,e[10]=a*s}else if("YZX"===t.order){var y=a*s,A=a*l,T=o*s,C=o*l;e[0]=s*u,e[4]=C-y*c,e[8]=T*c+A,e[1]=c,e[5]=a*u,e[9]=-o*u,e[2]=-l*u,e[6]=A*c+T,e[10]=y-C*c}else if("XZY"===t.order){y=a*s,A=a*l,T=o*s,C=o*l;e[0]=s*u,e[4]=-c,e[8]=l*u,e[1]=y*c+C,e[5]=a*u,e[9]=A*c-T,e[2]=T*c-A,e[6]=o*u,e[10]=C*c+y}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:(Wi=new Mi(0,0,0),Hi=new Mi(1,1,1),function(t){return this.compose(Wi,t,Hi)}),lookAt:(Gi=new Mi,Ui=new Mi,zi=new Mi,function(t,e,r){var i=this.elements;return zi.subVectors(t,e),0===zi.lengthSq()&&(zi.z=1),zi.normalize(),Gi.crossVectors(r,zi),0===Gi.lengthSq()&&(1===Math.abs(r.z)?zi.x+=1e-4:zi.z+=1e-4,zi.normalize(),Gi.crossVectors(r,zi)),Gi.normalize(),Ui.crossVectors(zi,Gi),i[0]=Gi.x,i[4]=Ui.x,i[8]=zi.x,i[1]=Gi.y,i[5]=Ui.y,i[9]=zi.y,i[2]=Gi.z,i[6]=Ui.z,i[10]=zi.z,this}),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,i=e.elements,n=this.elements,a=r[0],o=r[4],s=r[8],l=r[12],u=r[1],c=r[5],h=r[9],d=r[13],p=r[2],f=r[6],m=r[10],g=r[14],v=r[3],b=r[7],y=r[11],A=r[15],T=i[0],C=i[4],S=i[8],E=i[12],w=i[1],k=i[5],x=i[9],M=i[13],O=i[2],I=i[6],_=i[10],L=i[14],P=i[3],R=i[7],D=i[11],F=i[15];return n[0]=a*T+o*w+s*O+l*P,n[4]=a*C+o*k+s*I+l*R,n[8]=a*S+o*x+s*_+l*D,n[12]=a*E+o*M+s*L+l*F,n[1]=u*T+c*w+h*O+d*P,n[5]=u*C+c*k+h*I+d*R,n[9]=u*S+c*x+h*_+d*D,n[13]=u*E+c*M+h*L+d*F,n[2]=p*T+f*w+m*O+g*P,n[6]=p*C+f*k+m*I+g*R,n[10]=p*S+f*x+m*_+g*D,n[14]=p*E+f*M+m*L+g*F,n[3]=v*T+b*w+y*O+A*P,n[7]=v*C+b*k+y*I+A*R,n[11]=v*S+b*x+y*_+A*D,n[15]=v*E+b*M+y*L+A*F,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new Mi;return function(e){for(var r=0,i=e.count;r<i;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix4(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],r=t[4],i=t[8],n=t[12],a=t[1],o=t[5],s=t[9],l=t[13],u=t[2],c=t[6],h=t[10],d=t[14];return t[3]*(+n*s*c-i*l*c-n*o*h+r*l*h+i*o*d-r*s*d)+t[7]*(+e*s*d-e*l*h+n*a*h-i*a*d+i*l*u-n*s*u)+t[11]*(+e*l*c-e*o*d-n*a*c+r*a*d+n*o*u-r*l*u)+t[15]*(-i*o*u-e*s*c+e*o*h+i*a*c-r*a*h+r*s*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var r=this.elements,i=t.elements,n=i[0],a=i[1],o=i[2],s=i[3],l=i[4],u=i[5],c=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],b=i[14],y=i[15],A=p*b*h-v*f*h+v*c*m-u*b*m-p*c*y+u*f*y,T=g*f*h-d*b*h-g*c*m+l*b*m+d*c*y-l*f*y,C=d*v*h-g*p*h+g*u*m-l*v*m-d*u*y+l*p*y,S=g*p*c-d*v*c-g*u*f+l*v*f+d*u*b-l*p*b,E=n*A+a*T+o*C+s*S;if(0===E){var w="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(w);return console.warn(w),this.identity()}var k=1/E;return r[0]=A*k,r[1]=(v*f*s-p*b*s-v*o*m+a*b*m+p*o*y-a*f*y)*k,r[2]=(u*b*s-v*c*s+v*o*h-a*b*h-u*o*y+a*c*y)*k,r[3]=(p*c*s-u*f*s-p*o*h+a*f*h+u*o*m-a*c*m)*k,r[4]=T*k,r[5]=(d*b*s-g*f*s+g*o*m-n*b*m-d*o*y+n*f*y)*k,r[6]=(g*c*s-l*b*s-g*o*h+n*b*h+l*o*y-n*c*y)*k,r[7]=(l*f*s-d*c*s+d*o*h-n*f*h-l*o*m+n*c*m)*k,r[8]=C*k,r[9]=(g*p*s-d*v*s-g*a*m+n*v*m+d*a*y-n*p*y)*k,r[10]=(l*v*s-g*u*s+g*a*h-n*v*h-l*a*y+n*u*y)*k,r[11]=(d*u*s-l*p*s-d*a*h+n*p*h+l*a*m-n*u*m)*k,r[12]=S*k,r[13]=(d*v*o-g*p*o+g*a*f-n*v*f-d*a*b+n*p*b)*k,r[14]=(g*u*o-l*v*o-g*a*c+n*v*c+l*a*b-n*u*b)*k,r[15]=(l*p*o-d*u*o+d*a*c-n*p*c-l*a*f+n*u*f)*k,this},scale:function(t){var e=this.elements,r=t.x,i=t.y,n=t.z;return e[0]*=r,e[4]*=i,e[8]*=n,e[1]*=r,e[5]*=i,e[9]*=n,e[2]*=r,e[6]*=i,e[10]*=n,e[3]*=r,e[7]*=i,e[11]*=n,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),i=Math.sin(e),n=1-r,a=t.x,o=t.y,s=t.z,l=n*a,u=n*o;return this.set(l*a+r,l*o-i*s,l*s+i*o,0,l*o+i*s,u*o+r,u*s-i*a,0,l*s-i*o,u*s+i*a,n*s*s+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){var i=this.elements,n=e._x,a=e._y,o=e._z,s=e._w,l=n+n,u=a+a,c=o+o,h=n*l,d=n*u,p=n*c,f=a*u,m=a*c,g=o*c,v=s*l,b=s*u,y=s*c,A=r.x,T=r.y,C=r.z;return i[0]=(1-(f+g))*A,i[1]=(d+y)*A,i[2]=(p-b)*A,i[3]=0,i[4]=(d-y)*T,i[5]=(1-(h+g))*T,i[6]=(m+v)*T,i[7]=0,i[8]=(p+b)*C,i[9]=(m-v)*C,i[10]=(1-(h+f))*C,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this},decompose:(Ni=new Mi,Bi=new rn,function(t,e,r){var i=this.elements,n=Ni.set(i[0],i[1],i[2]).length(),a=Ni.set(i[4],i[5],i[6]).length(),o=Ni.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],Bi.copy(this);var s=1/n,l=1/a,u=1/o;return Bi.elements[0]*=s,Bi.elements[1]*=s,Bi.elements[2]*=s,Bi.elements[4]*=l,Bi.elements[5]*=l,Bi.elements[6]*=l,Bi.elements[8]*=u,Bi.elements[9]*=u,Bi.elements[10]*=u,e.setFromRotationMatrix(Bi),r.x=n,r.y=a,r.z=o,this}),makePerspective:function(t,e,r,i,n,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*n/(e-t),l=2*n/(r-i),u=(e+t)/(e-t),c=(r+i)/(r-i),h=-(a+n)/(a-n),d=-2*a*n/(a-n);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,r,i,n,a){var o=this.elements,s=1/(e-t),l=1/(r-i),u=1/(a-n),c=(e+t)*s,h=(r+i)*l,d=(a+n)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,i=0;i<16;i++)if(e[i]!==r[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}});var nn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick( specularColor, dotNV );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#endif\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\tfloat clearCoatInv = 1.0 - clearCoatDHR;\n\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec3 singleScattering = vec3( 0.0 );\n\t\tvec3 multiScattering = vec3( 0.0 );\n\t\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\t\tvec3 diffuse = material.diffuseColor;\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;\n\t\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\t\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\t#else\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#endif\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\t#ifdef USE_TANGENT\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy = normalScale * mapN.xy;\n\t\t\tnormal = normalize( vTBN * mapN );\n\t\t#else\n\t\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t\t#endif\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"};function an(t){var e={};for(var r in t)for(var i in e[r]={},t[r]){var n=t[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?e[r][i]=n.clone():Array.isArray(n)?e[r][i]=n.slice():e[r][i]=n}return e}function on(t){for(var e={},r=0;r<t.length;r++){var i=an(t[r]);for(var n in i)e[n]=i[n]}return e}var sn,ln,un,cn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function hn(t,e,r){return void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}Object.assign(hn.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(){function t(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}return function(e,r,i){if(e=wi.euclideanModulo(e,1),r=wi.clamp(r,0,1),i=wi.clamp(i,0,1),0===r)this.r=this.g=this.b=i;else{var n=i<=.5?i*(1+r):i+r-i*r,a=2*i-n;this.r=t(a,n,e+1/3),this.g=t(a,n,e),this.b=t(a,n,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var i,n=r[1],a=r[2];switch(n){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,e(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,e(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,l=parseInt(i[3],10)/100;return e(i[5]),this.setHSL(o,s,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var u,c=(u=r[1]).length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}t&&t.length>0&&(void 0!==(u=cn[t])?this.setHex(u):console.warn("THREE.Color: Unknown color "+t));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(){function t(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}return function(e){return this.r=t(e.r),this.g=t(e.g),this.b=t(e.b),this}}(),copyLinearToSRGB:function(){function t(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}return function(e){return this.r=t(e.r),this.g=t(e.g),this.b=t(e.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,r,i=this.r,n=this.g,a=this.b,o=Math.max(i,n,a),s=Math.min(i,n,a),l=(s+o)/2;if(s===o)e=0,r=0;else{var u=o-s;switch(r=l<=.5?u/(o+s):u/(2-o-s),o){case i:e=(n-a)/u+(n<a?6:0);break;case n:e=(a-i)/u+2;break;case a:e=(i-n)/u+4}e/=6}return t.h=e,t.s=r,t.l=l,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(un={},function(t,e,r){return this.getHSL(un),un.h+=t,un.s+=e,un.l+=r,this.setHSL(un.h,un.s,un.l),this}),add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:(sn={h:0,s:0,l:0},ln={h:0,s:0,l:0},function(t,e){this.getHSL(sn),t.getHSL(ln);var r=wi.lerp(sn.h,ln.h,e),i=wi.lerp(sn.s,ln.s,e),n=wi.lerp(sn.l,ln.l,e);return this.setHSL(r,i,n),this}),equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var dn,pn={common:{diffuse:{value:new hn(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Oi},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ki(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new hn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new hn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Oi}},sprite:{diffuse:{value:new hn(15658734)},opacity:{value:1},center:{value:new ki(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Oi}}},fn={basic:{uniforms:on([pn.common,pn.specularmap,pn.envmap,pn.aomap,pn.lightmap,pn.fog]),vertexShader:nn.meshbasic_vert,fragmentShader:nn.meshbasic_frag},lambert:{uniforms:on([pn.common,pn.specularmap,pn.envmap,pn.aomap,pn.lightmap,pn.emissivemap,pn.fog,pn.lights,{emissive:{value:new hn(0)}}]),vertexShader:nn.meshlambert_vert,fragmentShader:nn.meshlambert_frag},phong:{uniforms:on([pn.common,pn.specularmap,pn.envmap,pn.aomap,pn.lightmap,pn.emissivemap,pn.bumpmap,pn.normalmap,pn.displacementmap,pn.gradientmap,pn.fog,pn.lights,{emissive:{value:new hn(0)},specular:{value:new hn(1118481)},shininess:{value:30}}]),vertexShader:nn.meshphong_vert,fragmentShader:nn.meshphong_frag},standard:{uniforms:on([pn.common,pn.envmap,pn.aomap,pn.lightmap,pn.emissivemap,pn.bumpmap,pn.normalmap,pn.displacementmap,pn.roughnessmap,pn.metalnessmap,pn.fog,pn.lights,{emissive:{value:new hn(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:nn.meshphysical_vert,fragmentShader:nn.meshphysical_frag},matcap:{uniforms:on([pn.common,pn.bumpmap,pn.normalmap,pn.displacementmap,pn.fog,{matcap:{value:null}}]),vertexShader:nn.meshmatcap_vert,fragmentShader:nn.meshmatcap_frag},points:{uniforms:on([pn.points,pn.fog]),vertexShader:nn.points_vert,fragmentShader:nn.points_frag},dashed:{uniforms:on([pn.common,pn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:nn.linedashed_vert,fragmentShader:nn.linedashed_frag},depth:{uniforms:on([pn.common,pn.displacementmap]),vertexShader:nn.depth_vert,fragmentShader:nn.depth_frag},normal:{uniforms:on([pn.common,pn.bumpmap,pn.normalmap,pn.displacementmap,{opacity:{value:1}}]),vertexShader:nn.normal_vert,fragmentShader:nn.normal_frag},sprite:{uniforms:on([pn.sprite,pn.fog]),vertexShader:nn.sprite_vert,fragmentShader:nn.sprite_frag},background:{uniforms:{uvTransform:{value:new Oi},t2D:{value:null}},vertexShader:nn.background_vert,fragmentShader:nn.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:nn.cube_vert,fragmentShader:nn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:nn.equirect_vert,fragmentShader:nn.equirect_frag},distanceRGBA:{uniforms:on([pn.common,pn.displacementmap,{referencePosition:{value:new Mi},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:nn.distanceRGBA_vert,fragmentShader:nn.distanceRGBA_frag},shadow:{uniforms:on([pn.lights,pn.fog,{color:{value:new hn(0)},opacity:{value:1}}]),vertexShader:nn.shadow_vert,fragmentShader:nn.shadow_frag}};function mn(){var t=null,e=!1,r=null;function i(n,a){!1!==e&&(r(n,a),t.requestAnimationFrame(i))}return{start:function(){!0!==e&&null!==r&&(t.requestAnimationFrame(i),e=!0)},stop:function(){e=!1},setAnimationLoop:function(t){r=t},setContext:function(e){t=e}}}function gn(t){var e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var i=e.get(r);i&&(t.deleteBuffer(i.buffer),e.delete(r))},update:function(r,i){r.isInterleavedBufferAttribute&&(r=r.data);var n=e.get(r);void 0===n?e.set(r,function(e,r){var i=e.array,n=e.dynamic?35048:35044,a=t.createBuffer();t.bindBuffer(r,a),t.bufferData(r,i,n),e.onUploadCallback();var o=5126;return i instanceof Float32Array?o=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?o=5123:i instanceof Int16Array?o=5122:i instanceof Uint32Array?o=5125:i instanceof Int32Array?o=5124:i instanceof Int8Array?o=5120:i instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(r,i)):n.version<r.version&&(function(e,r,i){var n=r.array,a=r.updateRange;t.bindBuffer(i,e),!1===r.dynamic?t.bufferData(i,n,35044):-1===a.count?t.bufferSubData(i,0,n):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(i,a.offset*n.BYTES_PER_ELEMENT,n.subarray(a.offset,a.offset+a.count)),a.count=-1)}(n.buffer,r,i),n.version=r.version)}}}function vn(t,e,r,i,n,a){this.a=t,this.b=e,this.c=r,this.normal=i&&i.isVector3?i:new Mi,this.vertexNormals=Array.isArray(i)?i:[],this.color=n&&n.isColor?n:new hn,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==a?a:0}function bn(t,e,r,i){this._x=t||0,this._y=e||0,this._z=r||0,this._order=i||bn.DefaultOrder}function yn(){this.mask=1}fn.physical={uniforms:on([fn.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:nn.meshphysical_vert,fragmentShader:nn.meshphysical_frag},Object.assign(vn.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;e<r;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,r=t.vertexColors.length;e<r;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}),bn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],bn.DefaultOrder="XYZ",Object.defineProperties(bn.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(bn.prototype,{isEuler:!0,set:function(t,e,r,i){return this._x=t,this._y=e,this._z=r,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var i=wi.clamp,n=t.elements,a=n[0],o=n[4],s=n[8],l=n[1],u=n[5],c=n[9],h=n[2],d=n[6],p=n[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-i(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===e?(this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,u))):"YZX"===e?(this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===e?(this._z=Math.asin(-i(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new rn;return function(e,r,i){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,r,i)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:(dn=new xi,function(t){return dn.setFromEuler(this),this.setFromQuaternion(dn,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Mi(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(yn.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}});var An,Tn,Cn,Sn,En=0;function wn(){Object.defineProperty(this,"id",{value:En++}),this.uuid=wi.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=wn.DefaultUp.clone();var t=new Mi,e=new bn,r=new xi,i=new Mi(1,1,1);e.onChange(function(){r.setFromEuler(e,!1)}),r.onChange(function(){e.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new rn},normalMatrix:{value:new Oi}}),this.matrix=new rn,this.matrixWorld=new rn,this.matrixAutoUpdate=wn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new yn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}wn.DefaultUp=new Mi(0,1,0),wn.DefaultMatrixAutoUpdate=!0,wn.prototype=Object.assign(Object.create(te.prototype),{constructor:wn,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:(Sn=new xi,function(t,e){return Sn.setFromAxisAngle(t,e),this.quaternion.multiply(Sn),this}),rotateOnWorldAxis:function(){var t=new xi;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.premultiply(t),this}}(),rotateX:function(){var t=new Mi(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new Mi(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new Mi(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new Mi;return function(e,r){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(r)),this}}(),translateX:function(){var t=new Mi(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new Mi(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new Mi(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:(Cn=new rn,function(t){return t.applyMatrix4(Cn.getInverse(this.matrixWorld))}),lookAt:function(){var t=new xi,e=new rn,r=new Mi,i=new Mi;return function(n,a,o){n.isVector3?r.copy(n):r.set(n,a,o);var s=this.parent;this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?e.lookAt(i,r,this.up):e.lookAt(r,i,this.up),this.quaternion.setFromRotationMatrix(e),s&&(e.extractRotation(s.matrixWorld),t.setFromRotationMatrix(e),this.quaternion.premultiply(t.inverse()))}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r].getObjectByProperty(t,e);if(void 0!==n)return n}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Mi),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(An=new Mi,Tn=new Mi,function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new xi),this.updateMatrixWorld(!0),this.matrixWorld.decompose(An,t,Tn),t}),getWorldScale:function(){var t=new Mi,e=new xi;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),r=new Mi),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,r),r}}(),getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Mi),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,i=e.length;r<i;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,i=e.length;r<i;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,i=e.length;r<i;r++)e[r].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var i=this.children,n=0,a=i.length;n<a;n++)i[n].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function n(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==hi&&(i.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var u=o[s];n(t.shapes,u)}else n(t.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,l=this.material.length;s<l;s++)c.push(n(t.materials,this.material[s]));i.material=c}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(s=0;s<this.children.length;s++)i.children.push(this.children[s].toJSON(t).object)}if(e){var h=m(t.geometries),d=m(t.materials),p=m(t.textures),f=m(t.images);o=m(t.shapes);h.length>0&&(r.geometries=h),d.length>0&&(r.materials=d),p.length>0&&(r.textures=p),f.length>0&&(r.images=f),o.length>0&&(r.shapes=o)}return r.object=i,r;function m(t){var e=[];for(var r in t){var i=t[r];delete i.metadata,e.push(i)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var r=0;r<t.children.length;r++){var i=t.children[r];this.add(i.clone())}return this}});var kn,xn,Mn=0;function On(){Object.defineProperty(this,"id",{value:Mn+=2}),this.uuid=wi.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function In(t,e,r){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function _n(t,e,r){In.call(this,new Int8Array(t),e,r)}function Ln(t,e,r){In.call(this,new Uint8Array(t),e,r)}function Pn(t,e,r){In.call(this,new Uint8ClampedArray(t),e,r)}function Rn(t,e,r){In.call(this,new Int16Array(t),e,r)}function Dn(t,e,r){In.call(this,new Uint16Array(t),e,r)}function Fn(t,e,r){In.call(this,new Int32Array(t),e,r)}function Nn(t,e,r){In.call(this,new Uint32Array(t),e,r)}function Bn(t,e,r){In.call(this,new Float32Array(t),e,r)}function Gn(t,e,r){In.call(this,new Float64Array(t),e,r)}function Un(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function zn(t){if(0===t.length)return-1/0;for(var e=t[0],r=1,i=t.length;r<i;++r)t[r]>e&&(e=t[r]);return e}On.prototype=Object.assign(Object.create(te.prototype),{constructor:On,isGeometry:!0,applyMatrix:function(t){for(var e=(new Oi).getNormalMatrix(t),r=0,i=this.vertices.length;r<i;r++){this.vertices[r].applyMatrix4(t)}for(r=0,i=this.faces.length;r<i;r++){var n=this.faces[r];n.normal.applyMatrix3(e).normalize();for(var a=0,o=n.vertexNormals.length;a<o;a++)n.vertexNormals[a].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new rn;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new rn;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new rn;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new rn;return function(e,r,i){return t.makeTranslation(e,r,i),this.applyMatrix(t),this}}(),scale:function(){var t=new rn;return function(e,r,i){return t.makeScale(e,r,i),this.applyMatrix(t),this}}(),lookAt:(xn=new wn,function(t){xn.lookAt(t),xn.updateMatrix(),this.applyMatrix(xn.matrix)}),fromBufferGeometry:function(t){var e=this,r=null!==t.index?t.index.array:void 0,i=t.attributes,n=i.position.array,a=void 0!==i.normal?i.normal.array:void 0,o=void 0!==i.color?i.color.array:void 0,s=void 0!==i.uv?i.uv.array:void 0,l=void 0!==i.uv2?i.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var u=0,c=0;u<n.length;u+=3,c+=2)e.vertices.push((new Mi).fromArray(n,u)),void 0!==o&&e.colors.push((new hn).fromArray(o,u));function h(t,r,i,n){var u=void 0===o?[]:[e.colors[t].clone(),e.colors[r].clone(),e.colors[i].clone()],c=new vn(t,r,i,void 0===a?[]:[(new Mi).fromArray(a,3*t),(new Mi).fromArray(a,3*r),(new Mi).fromArray(a,3*i)],u,n);e.faces.push(c),void 0!==s&&e.faceVertexUvs[0].push([(new ki).fromArray(s,2*t),(new ki).fromArray(s,2*r),(new ki).fromArray(s,2*i)]),void 0!==l&&e.faceVertexUvs[1].push([(new ki).fromArray(l,2*t),(new ki).fromArray(l,2*r),(new ki).fromArray(l,2*i)])}var d=t.groups;if(d.length>0)for(u=0;u<d.length;u++)for(var p=d[u],f=p.start,m=(c=f,f+p.count);c<m;c+=3)void 0!==r?h(r[c],r[c+1],r[c+2],p.materialIndex):h(c,c+1,c+2,p.materialIndex);else if(void 0!==r)for(u=0;u<r.length;u+=3)h(r[u],r[u+1],r[u+2]);else for(u=0;u<n.length/3;u+=3)h(u,u+1,u+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:(kn=new Mi,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(kn).negate(),this.translate(kn.x,kn.y,kn.z),this}),normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,r=0===e?1:1/e,i=new rn;return i.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var t=new Mi,e=new Mi,r=0,i=this.faces.length;r<i;r++){var n=this.faces[r],a=this.vertices[n.a],o=this.vertices[n.b],s=this.vertices[n.c];t.subVectors(s,o),e.subVectors(a,o),t.cross(e),t.normalize(),n.normal.copy(t)}},computeVertexNormals:function(t){var e,r,i,n,a,o;for(void 0===t&&(t=!0),o=new Array(this.vertices.length),e=0,r=this.vertices.length;e<r;e++)o[e]=new Mi;if(t){var s,l,u,c=new Mi,h=new Mi;for(i=0,n=this.faces.length;i<n;i++)a=this.faces[i],s=this.vertices[a.a],l=this.vertices[a.b],u=this.vertices[a.c],c.subVectors(u,l),h.subVectors(s,l),c.cross(h),o[a.a].add(c),o[a.b].add(c),o[a.c].add(c)}else for(this.computeFaceNormals(),i=0,n=this.faces.length;i<n;i++)o[(a=this.faces[i]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(e=0,r=this.vertices.length;e<r;e++)o[e].normalize();for(i=0,n=this.faces.length;i<n;i++){var d=(a=this.faces[i]).vertexNormals;3===d.length?(d[0].copy(o[a.a]),d[1].copy(o[a.b]),d[2].copy(o[a.c])):(d[0]=o[a.a].clone(),d[1]=o[a.b].clone(),d[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,r;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var i=(r=this.faces[t]).vertexNormals;3===i.length?(i[0].copy(r.normal),i[1].copy(r.normal),i[2].copy(r.normal)):(i[0]=r.normal.clone(),i[1]=r.normal.clone(),i[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,r,i,n;for(r=0,i=this.faces.length;r<i;r++)for((n=this.faces[r]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),t=0,e=n.vertexNormals.length;t<e;t++)n.__originalVertexNormals[t]?n.__originalVertexNormals[t].copy(n.vertexNormals[t]):n.__originalVertexNormals[t]=n.vertexNormals[t].clone();var a=new On;for(a.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var o=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(r=0,i=this.faces.length;r<i;r++)l=new Mi,u={a:new Mi,b:new Mi,c:new Mi},o.push(l),s.push(u)}var l,u,c=this.morphNormals[t];for(a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals(),r=0,i=this.faces.length;r<i;r++)n=this.faces[r],l=c.faceNormals[r],u=c.vertexNormals[r],l.copy(n.normal),u.a.copy(n.vertexNormals[0]),u.b.copy(n.vertexNormals[1]),u.c.copy(n.vertexNormals[2])}for(r=0,i=this.faces.length;r<i;r++)(n=this.faces[r]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ji),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new $i),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t&&t.isGeometry){var i,n=this.vertices.length,a=this.vertices,o=t.vertices,s=this.faces,l=t.faces,u=this.faceVertexUvs[0],c=t.faceVertexUvs[0],h=this.colors,d=t.colors;void 0===r&&(r=0),void 0!==e&&(i=(new Oi).getNormalMatrix(e));for(var p=0,f=o.length;p<f;p++){var m=o[p].clone();void 0!==e&&m.applyMatrix4(e),a.push(m)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var g,v,b,y=l[p],A=y.vertexNormals,T=y.vertexColors;(g=new vn(y.a+n,y.b+n,y.c+n)).normal.copy(y.normal),void 0!==i&&g.normal.applyMatrix3(i).normalize();for(var C=0,S=A.length;C<S;C++)v=A[C].clone(),void 0!==i&&v.applyMatrix3(i).normalize(),g.vertexNormals.push(v);g.color.copy(y.color);for(C=0,S=T.length;C<S;C++)b=T[C],g.vertexColors.push(b.clone());g.materialIndex=y.materialIndex+r,s.push(g)}for(p=0,f=c.length;p<f;p++){var E=c[p],w=[];if(void 0!==E){for(C=0,S=E.length;C<S;C++)w.push(E[C].clone());u.push(w)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,r,i,n,a,o,s,l={},u=[],c=[],h=Math.pow(10,4);for(r=0,i=this.vertices.length;r<i;r++)t=this.vertices[r],void 0===l[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(l[e]=r,u.push(this.vertices[r]),c[r]=u.length-1):c[r]=c[l[e]];var d=[];for(r=0,i=this.faces.length;r<i;r++){(n=this.faces[r]).a=c[n.a],n.b=c[n.b],n.c=c[n.c],a=[n.a,n.b,n.c];for(var p=0;p<3;p++)if(a[p]===a[(p+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var f=d[r];for(this.faces.splice(f,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(f,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(t){this.vertices=[];for(var e=0,r=t.length;e<r;e++){var i=t[e];this.vertices.push(new Mi(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,r=0;r<e;r++)t[r]._id=r;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var i,n,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===e&&(i=[]),o&&o.length===e&&(n=[]);for(r=0;r<e;r++){var s=t[r]._id;i&&i.push(a[s]),n&&n.push(o[s])}i&&(this.faceVertexUvs[0]=i),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}for(var i=[],n=0;n<this.vertices.length;n++){var a=this.vertices[n];i.push(a.x,a.y,a.z)}var o=[],s=[],l={},u=[],c={},h=[],d={};for(n=0;n<this.faces.length;n++){var p=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=p.normal.length()>0,g=p.vertexNormals.length>0,v=1!==p.color.r||1!==p.color.g||1!==p.color.b,b=p.vertexColors.length>0,y=0;if(y=S(y,0,0),y=S(y,1,!0),y=S(y,2,!1),y=S(y,3,f),y=S(y,4,m),y=S(y,5,g),y=S(y,6,v),y=S(y,7,b),o.push(y),o.push(p.a,p.b,p.c),o.push(p.materialIndex),f){var A=this.faceVertexUvs[0][n];o.push(k(A[0]),k(A[1]),k(A[2]))}if(m&&o.push(E(p.normal)),g){var T=p.vertexNormals;o.push(E(T[0]),E(T[1]),E(T[2]))}if(v&&o.push(w(p.color)),b){var C=p.vertexColors;o.push(w(C[0]),w(C[1]),w(C[2]))}}function S(t,e,r){return r?t|1<<e:t&~(1<<e)}function E(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==l[e]?l[e]:(l[e]=s.length/3,s.push(t.x,t.y,t.z),l[e])}function w(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==c[e]?c[e]:(c[e]=u.length,u.push(t.getHex()),c[e])}function k(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]?d[e]:(d[e]=h.length/2,h.push(t.x,t.y),d[e])}return t.data={},t.data.vertices=i,t.data.normals=s,u.length>0&&(t.data.colors=u),h.length>0&&(t.data.uvs=[h]),t.data.faces=o,t},clone:function(){return(new On).copy(this)},copy:function(t){var e,r,i,n,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,r=s.length;e<r;e++)this.vertices.push(s[e].clone());var l=t.colors;for(e=0,r=l.length;e<r;e++)this.colors.push(l[e].clone());var u=t.faces;for(e=0,r=u.length;e<r;e++)this.faces.push(u[e].clone());for(e=0,r=t.faceVertexUvs.length;e<r;e++){var c=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),i=0,n=c.length;i<n;i++){var h=c[i],d=[];for(a=0,o=h.length;a<o;a++){var p=h[a];d.push(p.clone())}this.faceVertexUvs[e].push(d)}}var f=t.morphTargets;for(e=0,r=f.length;e<r;e++){var m={};if(m.name=f[e].name,void 0!==f[e].vertices)for(m.vertices=[],i=0,n=f[e].vertices.length;i<n;i++)m.vertices.push(f[e].vertices[i].clone());if(void 0!==f[e].normals)for(m.normals=[],i=0,n=f[e].normals.length;i<n;i++)m.normals.push(f[e].normals[i].clone());this.morphTargets.push(m)}var g=t.morphNormals;for(e=0,r=g.length;e<r;e++){var v={};if(void 0!==g[e].vertexNormals)for(v.vertexNormals=[],i=0,n=g[e].vertexNormals.length;i<n;i++){var b=g[e].vertexNormals[i],y={};y.a=b.a.clone(),y.b=b.b.clone(),y.c=b.c.clone(),v.vertexNormals.push(y)}if(void 0!==g[e].faceNormals)for(v.faceNormals=[],i=0,n=g[e].faceNormals.length;i<n;i++)v.faceNormals.push(g[e].faceNormals[i].clone());this.morphNormals.push(v)}var A=t.skinWeights;for(e=0,r=A.length;e<r;e++)this.skinWeights.push(A[e].clone());var T=t.skinIndices;for(e=0,r=T.length;e<r;e++)this.skinIndices.push(T[e].clone());var C=t.lineDistances;for(e=0,r=C.length;e<r;e++)this.lineDistances.push(C[e]);var S=t.boundingBox;null!==S&&(this.boundingBox=S.clone());var E=t.boundingSphere;return null!==E&&(this.boundingSphere=E.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(In.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(In.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==t?t.length/this.itemSize:0,this.array=t,this},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[r+i];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,i=0,n=t.length;i<n;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new hn),e[r++]=a.r,e[r++]=a.g,e[r++]=a.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,i=0,n=t.length;i<n;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new ki),e[r++]=a.x,e[r++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,r=0,i=0,n=t.length;i<n;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new Mi),e[r++]=a.x,e[r++]=a.y,e[r++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,i=0,n=t.length;i<n;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new Xi),e[r++]=a.x,e[r++]=a.y,e[r++]=a.z,e[r++]=a.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this},setXYZW:function(t,e,r,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this.array[t+3]=n,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),_n.prototype=Object.create(In.prototype),_n.prototype.constructor=_n,Ln.prototype=Object.create(In.prototype),Ln.prototype.constructor=Ln,Pn.prototype=Object.create(In.prototype),Pn.prototype.constructor=Pn,Rn.prototype=Object.create(In.prototype),Rn.prototype.constructor=Rn,Dn.prototype=Object.create(In.prototype),Dn.prototype.constructor=Dn,Fn.prototype=Object.create(In.prototype),Fn.prototype.constructor=Fn,Nn.prototype=Object.create(In.prototype),Nn.prototype.constructor=Nn,Bn.prototype=Object.create(In.prototype),Bn.prototype.constructor=Bn,Gn.prototype=Object.create(In.prototype),Gn.prototype.constructor=Gn,Object.assign(Un.prototype,{computeGroups:function(t){for(var e,r=[],i=void 0,n=t.faces,a=0;a<n.length;a++){var o=n[a];o.materialIndex!==i&&(i=o.materialIndex,void 0!==e&&(e.count=3*a-e.start,r.push(e)),e={start:3*a,materialIndex:i})}void 0!==e&&(e.count=3*a-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var e,r=t.faces,i=t.vertices,n=t.faceVertexUvs,a=n[0]&&n[0].length>0,o=n[1]&&n[1].length>0,s=t.morphTargets,l=s.length;if(l>0){e=[];for(var u=0;u<l;u++)e[u]={name:s[u].name,data:[]};this.morphTargets.position=e}var c,h=t.morphNormals,d=h.length;if(d>0){c=[];for(u=0;u<d;u++)c[u]={name:h[u].name,data:[]};this.morphTargets.normal=c}var p=t.skinIndices,f=t.skinWeights,m=p.length===i.length,g=f.length===i.length;i.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(u=0;u<r.length;u++){var v=r[u];this.vertices.push(i[v.a],i[v.b],i[v.c]);var b=v.vertexNormals;if(3===b.length)this.normals.push(b[0],b[1],b[2]);else{var y=v.normal;this.normals.push(y,y,y)}var A,T=v.vertexColors;if(3===T.length)this.colors.push(T[0],T[1],T[2]);else{var C=v.color;this.colors.push(C,C,C)}if(!0===a)void 0!==(A=n[0][u])?this.uvs.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new ki,new ki,new ki));if(!0===o)void 0!==(A=n[1][u])?this.uvs2.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new ki,new ki,new ki));for(var S=0;S<l;S++){var E=s[S].vertices;e[S].data.push(E[v.a],E[v.b],E[v.c])}for(S=0;S<d;S++){var w=h[S].vertexNormals[u];c[S].data.push(w.a,w.b,w.c)}m&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var Wn=1;function Hn(){Object.defineProperty(this,"id",{value:Wn+=2}),this.uuid=wi.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function Vn(t,e,r,i,n,a){On.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:i,heightSegments:n,depthSegments:a},this.fromBufferGeometry(new Yn(t,e,r,i,n,a)),this.mergeVertices()}function Yn(t,e,r,i,n,a){Hn.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:i,heightSegments:n,depthSegments:a};var o=this;t=t||1,e=e||1,r=r||1,i=Math.floor(i)||1,n=Math.floor(n)||1,a=Math.floor(a)||1;var s=[],l=[],u=[],c=[],h=0,d=0;function p(t,e,r,i,n,a,p,f,m,g,v){var b,y,A=a/m,T=p/g,C=a/2,S=p/2,E=f/2,w=m+1,k=g+1,x=0,M=0,O=new Mi;for(y=0;y<k;y++){var I=y*T-S;for(b=0;b<w;b++){var _=b*A-C;O[t]=_*i,O[e]=I*n,O[r]=E,l.push(O.x,O.y,O.z),O[t]=0,O[e]=0,O[r]=f>0?1:-1,u.push(O.x,O.y,O.z),c.push(b/m),c.push(1-y/g),x+=1}}for(y=0;y<g;y++)for(b=0;b<m;b++){var L=h+b+w*y,P=h+b+w*(y+1),R=h+(b+1)+w*(y+1),D=h+(b+1)+w*y;s.push(L,P,D),s.push(P,R,D),M+=6}o.addGroup(d,M,v),d+=M,h+=x}p("z","y","x",-1,-1,r,e,t,a,n,0),p("z","y","x",1,-1,r,e,-t,a,n,1),p("x","z","y",1,1,t,r,e,i,a,2),p("x","z","y",1,-1,t,r,-e,i,a,3),p("x","y","z",1,-1,t,e,r,i,n,4),p("x","y","z",-1,-1,t,e,-r,i,n,5),this.setIndex(s),this.addAttribute("position",new Bn(l,3)),this.addAttribute("normal",new Bn(u,3)),this.addAttribute("uv",new Bn(c,2))}function jn(t,e,r,i){On.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new Xn(t,e,r,i)),this.mergeVertices()}function Xn(t,e,r,i){Hn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:i};var n,a,o=(t=t||1)/2,s=(e=e||1)/2,l=Math.floor(r)||1,u=Math.floor(i)||1,c=l+1,h=u+1,d=t/l,p=e/u,f=[],m=[],g=[],v=[];for(a=0;a<h;a++){var b=a*p-s;for(n=0;n<c;n++){var y=n*d-o;m.push(y,-b,0),g.push(0,0,1),v.push(n/l),v.push(1-a/u)}}for(a=0;a<u;a++)for(n=0;n<l;n++){var A=n+c*a,T=n+c*(a+1),C=n+1+c*(a+1),S=n+1+c*a;f.push(A,T,S),f.push(T,C,S)}this.setIndex(f),this.addAttribute("position",new Bn(m,3)),this.addAttribute("normal",new Bn(g,3)),this.addAttribute("uv",new Bn(v,2))}Hn.prototype=Object.assign(Object.create(te.prototype),{constructor:Hn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(zn(t)>65535?Nn:Dn)(t,1):this.index=t},addAttribute:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):(this.attributes[t]=e,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(t,new In(arguments[1],arguments[2])))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new Oi).getNormalMatrix(t).applyToBufferAttribute(r),r.needsUpdate=!0);var i=this.attributes.tangent;void 0!==i&&((new Oi).getNormalMatrix(t).applyToBufferAttribute(i),i.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new rn;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new rn;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new rn;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new rn;return function(e,r,i){return t.makeTranslation(e,r,i),this.applyMatrix(t),this}}(),scale:function(){var t=new rn;return function(e,r,i){return t.makeScale(e,r,i),this.applyMatrix(t),this}}(),lookAt:function(){var t=new wn;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){var t=new Mi;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var r=new Bn(3*e.vertices.length,3),i=new Bn(3*e.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(e.vertices)),this.addAttribute("color",i.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var n=new Bn(e.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],r=0,i=t.length;r<i;r++){var n=t[r];e.push(n.x,n.y,n.z||0)}return this.addAttribute("position",new Bn(e,3)),this},updateFromObject:function(t){var e,r=t.geometry;if(t.isMesh){var i=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(i=void 0,r.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(r);i.verticesNeedUpdate=r.verticesNeedUpdate,i.normalsNeedUpdate=r.normalsNeedUpdate,i.colorsNeedUpdate=r.colorsNeedUpdate,i.uvsNeedUpdate=r.uvsNeedUpdate,i.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=i}return!0===r.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(r.vertices),e.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(r.normals),e.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(r.colors),e.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(r.uvs),e.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(r.lineDistances),e.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(t.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Un).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new In(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var r=new Float32Array(3*t.normals.length);this.addAttribute("normal",new In(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var i=new Float32Array(3*t.colors.length);this.addAttribute("color",new In(i,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var n=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new In(n,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var a=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new In(a,2).copyVector2sArray(t.uvs2))}for(var o in this.groups=t.groups,t.morphTargets){for(var s=[],l=t.morphTargets[o],u=0,c=l.length;u<c;u++){var h=l[u],d=new Bn(3*h.data.length,3);d.name=h.name,s.push(d.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(t.skinIndices.length>0){var p=new Bn(4*t.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var f=new Bn(4*t.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){var t=new Ji;return function(){null===this.boundingBox&&(this.boundingBox=new Ji);var e=this.attributes.position,r=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),r)for(var i=0,n=r.length;i<n;i++){var a=r[i];t.setFromBufferAttribute(a),this.boundingBox.expandByPoint(t.min),this.boundingBox.expandByPoint(t.max)}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var t=new Ji,e=new Ji,r=new Mi;return function(){null===this.boundingSphere&&(this.boundingSphere=new $i);var i=this.attributes.position,n=this.morphAttributes.position;if(i){var a=this.boundingSphere.center;if(t.setFromBufferAttribute(i),n)for(var o=0,s=n.length;o<s;o++){var l=n[o];e.setFromBufferAttribute(l),t.expandByPoint(e.min),t.expandByPoint(e.max)}t.getCenter(a);var u=0;for(o=0,s=i.count;o<s;o++)r.fromBufferAttribute(i,o),u=Math.max(u,a.distanceToSquared(r));if(n)for(o=0,s=n.length;o<s;o++)for(var c=0,h=(l=n[o]).count;c<h;c++)r.fromBufferAttribute(l,c),u=Math.max(u,a.distanceToSquared(r));this.boundingSphere.radius=Math.sqrt(u),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var r=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new In(new Float32Array(r.length),3));else for(var i=e.normal.array,n=0,a=i.length;n<a;n++)i[n]=0;var o,s,l,u=e.normal.array,c=new Mi,h=new Mi,d=new Mi,p=new Mi,f=new Mi;if(t){var m=t.array;for(n=0,a=t.count;n<a;n+=3)o=3*m[n+0],s=3*m[n+1],l=3*m[n+2],c.fromArray(r,o),h.fromArray(r,s),d.fromArray(r,l),p.subVectors(d,h),f.subVectors(c,h),p.cross(f),u[o]+=p.x,u[o+1]+=p.y,u[o+2]+=p.z,u[s]+=p.x,u[s+1]+=p.y,u[s+2]+=p.z,u[l]+=p.x,u[l+1]+=p.y,u[l+2]+=p.z}else for(n=0,a=r.length;n<a;n+=9)c.fromArray(r,n),h.fromArray(r,n+3),d.fromArray(r,n+6),p.subVectors(d,h),f.subVectors(c,h),p.cross(f),u[n]=p.x,u[n+1]=p.y,u[n+2]=p.z,u[n+3]=p.x,u[n+4]=p.y,u[n+5]=p.z,u[n+6]=p.x,u[n+7]=p.y,u[n+8]=p.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var i in r)if(void 0!==t.attributes[i])for(var n=r[i].array,a=t.attributes[i],o=a.array,s=a.itemSize*e,l=Math.min(o.length,n.length-s),u=0,c=s;u<l;u++,c++)n[c]=o[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){var t=new Mi;return function(){for(var e=this.attributes.normal,r=0,i=e.count;r<i;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.normalize(),e.setXYZ(r,t.x,t.y,t.z)}}(),toNonIndexed:function(){function t(t,e){for(var r=t.array,i=t.itemSize,n=new r.constructor(e.length*i),a=0,o=0,s=0,l=e.length;s<l;s++){a=e[s]*i;for(var u=0;u<i;u++)n[o++]=r[a++]}return new In(n,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new Hn,r=this.index.array,i=this.attributes;for(var n in i){var a=t(i[n],r);e.addAttribute(n,a)}var o=this.morphAttributes;for(n in o){for(var s=[],l=o[n],u=0,c=l.length;u<c;u++){a=t(l[u],r);s.push(a)}e.morphAttributes[n]=s}for(var h=this.groups,d=(u=0,h.length);u<d;u++){var p=h[u];e.addGroup(p.start,p.count,p.materialIndex)}return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};var i=this.index;null!==i&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var n=this.attributes;for(var r in n){var a={itemSize:(d=n[r]).itemSize,type:d.array.constructor.name,array:Array.prototype.slice.call(d.array),normalized:d.normalized};""!==d.name&&(a.name=d.name),t.data.attributes[r]=a}var o={},s=!1;for(var r in this.morphAttributes){for(var l=this.morphAttributes[r],u=[],c=0,h=l.length;c<h;c++){var d;a={itemSize:(d=l[c]).itemSize,type:d.array.constructor.name,array:Array.prototype.slice.call(d.array),normalized:d.normalized};""!==d.name&&(a.name=d.name),u.push(a)}u.length>0&&(o[r]=u,s=!0)}s&&(t.data.morphAttributes=o);var p=this.groups;p.length>0&&(t.data.groups=JSON.parse(JSON.stringify(p)));var f=this.boundingSphere;return null!==f&&(t.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),t},clone:function(){return(new Hn).copy(this)},copy:function(t){var e,r,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var n=t.index;null!==n&&this.setIndex(n.clone());var a=t.attributes;for(e in a){var o=a[e];this.addAttribute(e,o.clone())}var s=t.morphAttributes;for(e in s){var l=[],u=s[e];for(r=0,i=u.length;r<i;r++)l.push(u[r].clone());this.morphAttributes[e]=l}var c=t.groups;for(r=0,i=c.length;r<i;r++){var h=c[r];this.addGroup(h.start,h.count,h.materialIndex)}var d=t.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=t.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Vn.prototype=Object.create(On.prototype),Vn.prototype.constructor=Vn,Yn.prototype=Object.create(Hn.prototype),Yn.prototype.constructor=Yn,jn.prototype=Object.create(On.prototype),jn.prototype.constructor=jn,Xn.prototype=Object.create(Hn.prototype),Xn.prototype.constructor=Xn;var qn=0;function Zn(){Object.defineProperty(this,"id",{value:qn++}),this.uuid=wi.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=Ae,this.side=pe,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=ge,this.opacity=1,this.transparent=!1,this.blendSrc=Re,this.blendDst=De,this.blendEquation=we,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ve,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}Zn.prototype=Object.assign(Object.create(te.prototype),{constructor:Zn,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var r=t[e];if(void 0!==r)if("shading"!==e){var i=this[e];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[e]=r:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){var e=[];for(var r in t){var i=t[r];delete i.metadata,e.push(i)}return e}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Ae&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==pe&&(r.side=this.side),this.vertexColors!==ge&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e){var n=i(t.textures),a=i(t.images);n.length>0&&(r.textures=n),a.length>0&&(r.images=a)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,r=null;if(null!==e){var i=e.length;r=new Array(i);for(var n=0;n!==i;++n)r[n]=e[n].clone()}return this.clippingPlanes=r,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Kn,Qn,Jn,$n,ta,ea,ra,ia,na,aa,oa,sa,la="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",ua="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ca(t){Zn.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=la,this.fragmentShader=ua,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function ha(t,e){this.origin=void 0!==t?t:new Mi,this.direction=void 0!==e?e:new Mi}function da(t,e,r){this.a=void 0!==t?t:new Mi,this.b=void 0!==e?e:new Mi,this.c=void 0!==r?r:new Mi}function pa(t){Zn.call(this),this.type="MeshBasicMaterial",this.color=new hn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ze,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function fa(t,e){wn.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Hn,this.material=void 0!==e?e:new pa({color:16777215*Math.random()}),this.drawMode=hi,this.updateMorphTargets()}function ma(t,e,r,i){var n,a,o=new hn(0),s=0,l=null,u=0;function c(t,r){e.buffers.color.setClear(t.r,t.g,t.b,r,i)}return{getClearColor:function(){return o},setClearColor:function(t,e){o.set(t),c(o,s=void 0!==e?e:1)},getClearAlpha:function(){return s},setClearAlpha:function(t){c(o,s=t)},render:function(e,i,h,d){var p=i.background,f=t.vr,m=f.getSession&&f.getSession();if(m&&"additive"===m.environmentBlendMode&&(p=null),null===p?(c(o,s),l=null,u=0):p&&p.isColor&&(c(p,1),d=!0,l=null,u=0),(t.autoClear||d)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),p&&(p.isCubeTexture||p.isWebGLRenderTargetCube)){void 0===a&&((a=new fa(new Yn(1,1,1),new ca({type:"BackgroundCubeMaterial",uniforms:an(fn.cube.uniforms),vertexShader:fn.cube.vertexShader,fragmentShader:fn.cube.fragmentShader,side:fe,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(t,e,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.tCube.value}}),r.update(a));var g=p.isWebGLRenderTargetCube?p.texture:p;a.material.uniforms.tCube.value=g,a.material.uniforms.tFlip.value=p.isWebGLRenderTargetCube?1:-1,l===p&&u===g.version||(a.material.needsUpdate=!0,l=p,u=g.version),e.unshift(a,a.geometry,a.material,0,0,null)}else p&&p.isTexture&&(void 0===n&&((n=new fa(new Xn(2,2),new ca({type:"BackgroundMaterial",uniforms:an(fn.background.uniforms),vertexShader:fn.background.vertexShader,fragmentShader:fn.background.fragmentShader,side:pe,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(n.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(n)),n.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),n.material.uniforms.uvTransform.value.copy(p.matrix),l===p&&u===p.version||(n.material.needsUpdate=!0,l=p,u=p.version),e.unshift(n,n.geometry,n.material,0,0,null))}}}function ga(t,e,r,i){var n;this.setMode=function(t){n=t},this.render=function(e,i){t.drawArrays(n,e,i),r.update(i,n)},this.renderInstances=function(a,o,s){var l;if(i.isWebGL2)l=t;else if(null===(l=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[i.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](n,o,s,a.maxInstancedCount),r.update(s,n,a.maxInstancedCount)}}function va(t,e,r){var i;function n(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,o=void 0!==r.precision?r.precision:"highp",s=n(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===r.logarithmicDepthBuffer,u=t.getParameter(34930),c=t.getParameter(35660),h=t.getParameter(3379),d=t.getParameter(34076),p=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),v=c>0,b=a||!!e.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==i)return i;var r=e.get("EXT_texture_filter_anisotropic");return i=null!==r?t.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:b,floatVertexTextures:v&&b,maxSamples:a?t.getParameter(36183):0}}function ba(){var t=this,e=null,r=0,i=!1,n=!1,a=new tn,o=new Oi,s={value:null,needsUpdate:!1};function l(){s.value!==e&&(s.value=e,s.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(e,r,i,n){var l=null!==e?e.length:0,u=null;if(0!==l){if(u=s.value,!0!==n||null===u){var c=i+4*l,h=r.matrixWorldInverse;o.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var d=0,p=i;d!==l;++d,p+=4)a.copy(e[d]).applyMatrix4(h,o),a.normal.toArray(u,p),u[p+3]=a.constant}s.value=u,s.needsUpdate=!0}return t.numPlanes=l,u}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(t,n,a){var o=0!==t.length||n||0!==r||i;return i=n,e=u(t,a,0),r=t.length,o},this.beginShadows=function(){n=!0,u(null)},this.endShadows=function(){n=!1,l()},this.setState=function(t,a,o,c,h,d){if(!i||null===t||0===t.length||n&&!o)n?u(null):l();else{var p=n?0:r,f=4*p,m=h.clippingState||null;s.value=m,m=u(t,c,f,d);for(var g=0;g!==f;++g)m[g]=e[g];h.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=p}}}function ya(t){var e={};return{get:function(r){if(void 0!==e[r])return e[r];var i;switch(r){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(r)}return null===i&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),e[r]=i,i}}}function Aa(t,e,r){var i={},n={};function a(t){var o=t.target,s=i[o.id];for(var l in null!==s.index&&e.remove(s.index),s.attributes)e.remove(s.attributes[l]);o.removeEventListener("dispose",a),delete i[o.id];var u=n[s.id];u&&(e.remove(u),delete n[s.id]),r.memory.geometries--}return{get:function(t,e){var n=i[e.id];return n||(e.addEventListener("dispose",a),e.isBufferGeometry?n=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Hn).setFromObject(t)),n=e._bufferGeometry),i[e.id]=n,r.memory.geometries++,n)},update:function(t){var r=t.index,i=t.attributes;for(var n in null!==r&&e.update(r,34963),i)e.update(i[n],34962);var a=t.morphAttributes;for(var n in a)for(var o=a[n],s=0,l=o.length;s<l;s++)e.update(o[s],34962)},getWireframeAttribute:function(t){var r=n[t.id];if(r)return r;var i,a=[],o=t.index,s=t.attributes;if(null!==o)for(var l=0,u=(i=o.array).length;l<u;l+=3){var c=i[l+0],h=i[l+1],d=i[l+2];a.push(c,h,h,d,d,c)}else for(l=0,u=(i=s.position.array).length/3-1;l<u;l+=3)c=l+0,h=l+1,d=l+2,a.push(c,h,h,d,d,c);return r=new(zn(a)>65535?Nn:Dn)(a,1),e.update(r,34963),n[t.id]=r,r}}}function Ta(t,e,r,i){var n,a,o;this.setMode=function(t){n=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,i){t.drawElements(n,i,a,e*o),r.update(i,n)},this.renderInstances=function(s,l,u){var c;if(i.isWebGL2)c=t;else if(null===(c=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[i.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](n,u,a,l*o,s.maxInstancedCount),r.update(u,n,s.maxInstancedCount)}}function Ca(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,r,i){switch(i=i||1,e.calls++,r){case 4:e.triangles+=i*(t/3);break;case 5:case 6:e.triangles+=i*(t-2);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Sa(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Ea(t){var e={},r=new Float32Array(8);return{update:function(i,n,a,o){var s=i.morphTargetInfluences,l=s.length,u=e[n.id];if(void 0===u){u=[];for(var c=0;c<l;c++)u[c]=[c,0];e[n.id]=u}var h=a.morphTargets&&n.morphAttributes.position,d=a.morphNormals&&n.morphAttributes.normal;for(c=0;c<l;c++)0!==(p=u[c])[1]&&(h&&n.removeAttribute("morphTarget"+c),d&&n.removeAttribute("morphNormal"+c));for(c=0;c<l;c++)(p=u[c])[0]=c,p[1]=s[c];for(u.sort(Sa),c=0;c<8;c++){var p;if(p=u[c]){var f=p[0],m=p[1];if(m){h&&n.addAttribute("morphTarget"+c,h[f]),d&&n.addAttribute("morphNormal"+c,d[f]),r[c]=m;continue}}r[c]=0}o.getUniforms().setValue(t,"morphTargetInfluences",r)}}}function wa(t,e){var r={};return{update:function(i){var n=e.render.frame,a=i.geometry,o=t.get(i,a);return r[o.id]!==n&&(a.isGeometry&&o.updateFromObject(i),t.update(o),r[o.id]=n),o},dispose:function(){r={}}}}function ka(t,e,r,i,n,a,o,s,l,u){t=void 0!==t?t:[],e=void 0!==e?e:nr,o=void 0!==o?o:Pr,ji.call(this,t,e,r,i,n,a,o,s,l,u),this.flipY=!1}function xa(t,e,r,i){ji.call(this,null),this.image={data:t,width:e,height:r,depth:i},this.magFilter=fr,this.minFilter=fr,this.wrapR=dr,this.generateMipmaps=!1,this.flipY=!1}function Ma(t,e,r,i){ji.call(this,null),this.image={data:t,width:e,height:r,depth:i},this.magFilter=fr,this.minFilter=fr,this.wrapR=dr,this.generateMipmaps=!1,this.flipY=!1}ca.prototype=Object.create(Zn.prototype),ca.prototype.constructor=ca,ca.prototype.isShaderMaterial=!0,ca.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=an(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},ca.prototype.toJSON=function(t){var e=Zn.prototype.toJSON.call(this,t);for(var r in e.uniforms={},this.uniforms){var i=this.uniforms[r].value;i&&i.isTexture?e.uniforms[r]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[r]={type:"m4",value:i.toArray()}:e.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;var n={};for(var a in this.extensions)!0===this.extensions[a]&&(n[a]=!0);return Object.keys(n).length>0&&(e.extensions=n),e},Object.assign(ha.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Mi),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new Mi;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Mi),e.subVectors(t,this.origin);var r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new Mi;return function(e){var r=t.subVectors(e,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(r).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:(Qn=new Mi,Jn=new Mi,$n=new Mi,function(t,e,r,i){Qn.copy(t).add(e).multiplyScalar(.5),Jn.copy(e).sub(t).normalize(),$n.copy(this.origin).sub(Qn);var n,a,o,s,l=.5*t.distanceTo(e),u=-this.direction.dot(Jn),c=$n.dot(this.direction),h=-$n.dot(Jn),d=$n.lengthSq(),p=Math.abs(1-u*u);if(p>0)if(a=u*c-h,s=l*p,(n=u*h-c)>=0)if(a>=-s)if(a<=s){var f=1/p;o=(n*=f)*(n+u*(a*=f)+2*c)+a*(u*n+a+2*h)+d}else a=l,o=-(n=Math.max(0,-(u*a+c)))*n+a*(a+2*h)+d;else a=-l,o=-(n=Math.max(0,-(u*a+c)))*n+a*(a+2*h)+d;else a<=-s?o=-(n=Math.max(0,-(-u*l+c)))*n+(a=n>0?-l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d:a<=s?(n=0,o=(a=Math.min(Math.max(-l,-h),l))*(a+2*h)+d):o=-(n=Math.max(0,-(u*l+c)))*n+(a=n>0?l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d;else a=u>0?-l:l,o=-(n=Math.max(0,-(u*a+c)))*n+a*(a+2*h)+d;return r&&r.copy(this.direction).multiplyScalar(n).add(this.origin),i&&i.copy(Jn).multiplyScalar(a).add(Qn),o}),intersectSphere:function(){var t=new Mi;return function(e,r){t.subVectors(e.center,this.origin);var i=t.dot(this.direction),n=t.dot(t)-i*i,a=e.radius*e.radius;if(n>a)return null;var o=Math.sqrt(a-n),s=i-o,l=i+o;return s<0&&l<0?null:s<0?this.at(l,r):this.at(s,r)}}(),intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var r,i,n,a,o,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(r=(t.min.x-h.x)*l,i=(t.max.x-h.x)*l):(r=(t.max.x-h.x)*l,i=(t.min.x-h.x)*l),u>=0?(n=(t.min.y-h.y)*u,a=(t.max.y-h.y)*u):(n=(t.max.y-h.y)*u,a=(t.min.y-h.y)*u),r>a||n>i?null:((n>r||r!=r)&&(r=n),(a<i||i!=i)&&(i=a),c>=0?(o=(t.min.z-h.z)*c,s=(t.max.z-h.z)*c):(o=(t.max.z-h.z)*c,s=(t.min.z-h.z)*c),r>s||o>i?null:((o>r||r!=r)&&(r=o),(s<i||i!=i)&&(i=s),i<0?null:this.at(r>=0?r:i,e)))},intersectsBox:(Kn=new Mi,function(t){return null!==this.intersectBox(t,Kn)}),intersectTriangle:function(){var t=new Mi,e=new Mi,r=new Mi,i=new Mi;return function(n,a,o,s,l){e.subVectors(a,n),r.subVectors(o,n),i.crossVectors(e,r);var u,c=this.direction.dot(i);if(c>0){if(s)return null;u=1}else{if(!(c<0))return null;u=-1,c=-c}t.subVectors(this.origin,n);var h=u*this.direction.dot(r.crossVectors(t,r));if(h<0)return null;var d=u*this.direction.dot(e.cross(t));if(d<0)return null;if(h+d>c)return null;var p=-u*t.dot(i);return p<0?null:this.at(p/c,l)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(da,{getNormal:(ea=new Mi,function(t,e,r,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Mi),i.subVectors(r,e),ea.subVectors(t,e),i.cross(ea);var n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}),getBarycoord:function(){var t=new Mi,e=new Mi,r=new Mi;return function(i,n,a,o,s){t.subVectors(o,n),e.subVectors(a,n),r.subVectors(i,n);var l=t.dot(t),u=t.dot(e),c=t.dot(r),h=e.dot(e),d=e.dot(r),p=l*h-u*u;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Mi),0===p)return s.set(-2,-1,-1);var f=1/p,m=(h*c-u*d)*f,g=(l*d-u*c)*f;return s.set(1-m-g,g,m)}}(),containsPoint:function(){var t=new Mi;return function(e,r,i,n){return da.getBarycoord(e,r,i,n,t),t.x>=0&&t.y>=0&&t.x+t.y<=1}}(),getUV:(ta=new Mi,function(t,e,r,i,n,a,o,s){return this.getBarycoord(t,e,r,i,ta),s.set(0,0),s.addScaledVector(n,ta.x),s.addScaledVector(a,ta.y),s.addScaledVector(o,ta.z),s})}),Object.assign(da.prototype,{set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,i){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){var t=new Mi,e=new Mi;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Mi),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return da.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Mi),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return da.getBarycoord(t,this.a,this.b,this.c,e)},containsPoint:function(t){return da.containsPoint(t,this.a,this.b,this.c)},getUV:function(t,e,r,i,n){return da.getUV(t,this.a,this.b,this.c,e,r,i,n)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:(ra=new Mi,ia=new Mi,na=new Mi,aa=new Mi,oa=new Mi,sa=new Mi,function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Mi);var r,i,n=this.a,a=this.b,o=this.c;ra.subVectors(a,n),ia.subVectors(o,n),aa.subVectors(t,n);var s=ra.dot(aa),l=ia.dot(aa);if(s<=0&&l<=0)return e.copy(n);oa.subVectors(t,a);var u=ra.dot(oa),c=ia.dot(oa);if(u>=0&&c<=u)return e.copy(a);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return r=s/(s-u),e.copy(n).addScaledVector(ra,r);sa.subVectors(t,o);var d=ra.dot(sa),p=ia.dot(sa);if(p>=0&&d<=p)return e.copy(o);var f=d*l-s*p;if(f<=0&&l>=0&&p<=0)return i=l/(l-p),e.copy(n).addScaledVector(ia,i);var m=u*p-d*c;if(m<=0&&c-u>=0&&d-p>=0)return na.subVectors(o,a),i=(c-u)/(c-u+(d-p)),e.copy(a).addScaledVector(na,i);var g=1/(m+f+h);return r=f*g,i=h*g,e.copy(n).addScaledVector(ra,r).addScaledVector(ia,i)}),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),pa.prototype=Object.create(Zn.prototype),pa.prototype.constructor=pa,pa.prototype.isMeshBasicMaterial=!0,pa.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},fa.prototype=Object.assign(Object.create(wn.prototype),{constructor:fa,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return wn.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,r,i=this.geometry;if(i.isBufferGeometry){var n=i.morphAttributes,a=Object.keys(n);if(a.length>0){var o=n[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)r=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=i.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(){var t=new rn,e=new ha,r=new $i,i=new Mi,n=new Mi,a=new Mi,o=new Mi,s=new Mi,l=new Mi,u=new Mi,c=new Mi,h=new Mi,d=new ki,p=new ki,f=new ki,m=new Mi,g=new Mi;function v(t,e,r,i,n,a,o,s){if(null===(e.side===fe?i.intersectTriangle(o,a,n,!0,s):i.intersectTriangle(n,a,o,e.side!==me,s)))return null;g.copy(s),g.applyMatrix4(t.matrixWorld);var l=r.ray.origin.distanceTo(g);return l<r.near||l>r.far?null:{distance:l,point:g.clone(),object:t}}function b(t,e,r,g,b,y,A,T,C,S){i.fromBufferAttribute(b,T),n.fromBufferAttribute(b,C),a.fromBufferAttribute(b,S);var E=t.morphTargetInfluences;if(e.morphTargets&&y&&E){u.set(0,0,0),c.set(0,0,0),h.set(0,0,0);for(var w=0,k=y.length;w<k;w++){var x=E[w],M=y[w];0!==x&&(o.fromBufferAttribute(M,T),s.fromBufferAttribute(M,C),l.fromBufferAttribute(M,S),u.addScaledVector(o.sub(i),x),c.addScaledVector(s.sub(n),x),h.addScaledVector(l.sub(a),x))}i.add(u),n.add(c),a.add(h)}var O=v(t,e,r,g,i,n,a,m);if(O){A&&(d.fromBufferAttribute(A,T),p.fromBufferAttribute(A,C),f.fromBufferAttribute(A,S),O.uv=da.getUV(m,i,n,a,d,p,f,new ki));var I=new vn(T,C,S);da.getNormal(i,n,a,I.normal),O.face=I}return O}return function(i,n){var a,o=this.geometry,s=this.material,l=this.matrixWorld;if(void 0!==s&&(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(l),!1!==i.ray.intersectsSphere(r)&&(t.getInverse(l),e.copy(i.ray).applyMatrix4(t),null===o.boundingBox||!1!==e.intersectsBox(o.boundingBox))))if(o.isBufferGeometry){var u,c,h,g,y,A,T,C,S,E=o.index,w=o.attributes.position,k=o.morphAttributes.position,x=o.attributes.uv,M=o.groups,O=o.drawRange;if(null!==E)if(Array.isArray(s))for(g=0,A=M.length;g<A;g++)for(S=s[(C=M[g]).materialIndex],y=Math.max(C.start,O.start),T=Math.min(C.start+C.count,O.start+O.count);y<T;y+=3)u=E.getX(y),c=E.getX(y+1),h=E.getX(y+2),(a=b(this,S,i,e,w,k,x,u,c,h))&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=C.materialIndex,n.push(a));else for(g=Math.max(0,O.start),A=Math.min(E.count,O.start+O.count);g<A;g+=3)u=E.getX(g),c=E.getX(g+1),h=E.getX(g+2),(a=b(this,s,i,e,w,k,x,u,c,h))&&(a.faceIndex=Math.floor(g/3),n.push(a));else if(void 0!==w)if(Array.isArray(s))for(g=0,A=M.length;g<A;g++)for(S=s[(C=M[g]).materialIndex],y=Math.max(C.start,O.start),T=Math.min(C.start+C.count,O.start+O.count);y<T;y+=3)(a=b(this,S,i,e,w,k,x,u=y,c=y+1,h=y+2))&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=C.materialIndex,n.push(a));else for(g=Math.max(0,O.start),A=Math.min(w.count,O.start+O.count);g<A;g+=3)(a=b(this,s,i,e,w,k,x,u=g,c=g+1,h=g+2))&&(a.faceIndex=Math.floor(g/3),n.push(a))}else if(o.isGeometry){var I,_,L,P,R=Array.isArray(s),D=o.vertices,F=o.faces,N=o.faceVertexUvs[0];N.length>0&&(P=N);for(var B=0,G=F.length;B<G;B++){var U=F[B],z=R?s[U.materialIndex]:s;if(void 0!==z&&(I=D[U.a],_=D[U.b],L=D[U.c],a=v(this,z,i,e,I,_,L,m))){if(P&&P[B]){var W=P[B];d.copy(W[0]),p.copy(W[1]),f.copy(W[2]),a.uv=da.getUV(m,I,_,L,d,p,f,new ki)}a.face=U,a.faceIndex=B,n.push(a)}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ka.prototype=Object.create(ji.prototype),ka.prototype.constructor=ka,ka.prototype.isCubeTexture=!0,Object.defineProperty(ka.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),xa.prototype=Object.create(ji.prototype),xa.prototype.constructor=xa,xa.prototype.isDataTexture2DArray=!0,Ma.prototype=Object.create(ji.prototype),Ma.prototype.constructor=Ma,Ma.prototype.isDataTexture3D=!0;var Oa=new ji,Ia=new xa,_a=new Ma,La=new ka,Pa=[],Ra=[],Da=new Float32Array(16),Fa=new Float32Array(9),Na=new Float32Array(4);function Ba(t,e,r){var i=t[0];if(i<=0||i>0)return t;var n=e*r,a=Pa[n];if(void 0===a&&(a=new Float32Array(n),Pa[n]=a),0!==e){i.toArray(a,0);for(var o=1,s=0;o!==e;++o)s+=r,t[o].toArray(a,s)}return a}function Ga(t,e){if(t.length!==e.length)return!1;for(var r=0,i=t.length;r<i;r++)if(t[r]!==e[r])return!1;return!0}function Ua(t,e){for(var r=0,i=e.length;r<i;r++)t[r]=e[r]}function za(t,e){var r=Ra[e];void 0===r&&(r=new Int32Array(e),Ra[e]=r);for(var i=0;i!==e;++i)r[i]=t.allocateTextureUnit();return r}function Wa(t,e){var r=this.cache;r[0]!==e&&(t.uniform1f(this.addr,e),r[0]=e)}function Ha(t,e){var r=this.cache;r[0]!==e&&(t.uniform1i(this.addr,e),r[0]=e)}function Va(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),r[0]=e.x,r[1]=e.y);else{if(Ga(r,e))return;t.uniform2fv(this.addr,e),Ua(r,e)}}function Ya(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),r[0]=e.x,r[1]=e.y,r[2]=e.z);else if(void 0!==e.r)r[0]===e.r&&r[1]===e.g&&r[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),r[0]=e.r,r[1]=e.g,r[2]=e.b);else{if(Ga(r,e))return;t.uniform3fv(this.addr,e),Ua(r,e)}}function ja(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z&&r[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=e.w);else{if(Ga(r,e))return;t.uniform4fv(this.addr,e),Ua(r,e)}}function Xa(t,e){var r=this.cache,i=e.elements;if(void 0===i){if(Ga(r,e))return;t.uniformMatrix2fv(this.addr,!1,e),Ua(r,e)}else{if(Ga(r,i))return;Na.set(i),t.uniformMatrix2fv(this.addr,!1,Na),Ua(r,i)}}function qa(t,e){var r=this.cache,i=e.elements;if(void 0===i){if(Ga(r,e))return;t.uniformMatrix3fv(this.addr,!1,e),Ua(r,e)}else{if(Ga(r,i))return;Fa.set(i),t.uniformMatrix3fv(this.addr,!1,Fa),Ua(r,i)}}function Za(t,e){var r=this.cache,i=e.elements;if(void 0===i){if(Ga(r,e))return;t.uniformMatrix4fv(this.addr,!1,e),Ua(r,e)}else{if(Ga(r,i))return;Da.set(i),t.uniformMatrix4fv(this.addr,!1,Da),Ua(r,i)}}function Ka(t,e,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(t.uniform1i(this.addr,n),i[0]=n),r.safeSetTexture2D(e||Oa,n)}function Qa(t,e,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(t.uniform1i(this.addr,n),i[0]=n),r.setTexture2DArray(e||Ia,n)}function Ja(t,e,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(t.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(e||_a,n)}function $a(t,e,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(t.uniform1i(this.addr,n),i[0]=n),r.safeSetTextureCube(e||La,n)}function to(t,e){var r=this.cache;Ga(r,e)||(t.uniform2iv(this.addr,e),Ua(r,e))}function eo(t,e){var r=this.cache;Ga(r,e)||(t.uniform3iv(this.addr,e),Ua(r,e))}function ro(t,e){var r=this.cache;Ga(r,e)||(t.uniform4iv(this.addr,e),Ua(r,e))}function io(t,e){var r=this.cache;Ga(r,e)||(t.uniform1fv(this.addr,e),Ua(r,e))}function no(t,e){var r=this.cache;Ga(r,e)||(t.uniform1iv(this.addr,e),Ua(r,e))}function ao(t,e){var r=this.cache,i=Ba(e,this.size,2);Ga(r,i)||(t.uniform2fv(this.addr,i),this.updateCache(i))}function oo(t,e){var r=this.cache,i=Ba(e,this.size,3);Ga(r,i)||(t.uniform3fv(this.addr,i),this.updateCache(i))}function so(t,e){var r=this.cache,i=Ba(e,this.size,4);Ga(r,i)||(t.uniform4fv(this.addr,i),this.updateCache(i))}function lo(t,e){var r=this.cache,i=Ba(e,this.size,4);Ga(r,i)||(t.uniformMatrix2fv(this.addr,!1,i),this.updateCache(i))}function uo(t,e){var r=this.cache,i=Ba(e,this.size,9);Ga(r,i)||(t.uniformMatrix3fv(this.addr,!1,i),this.updateCache(i))}function co(t,e){var r=this.cache,i=Ba(e,this.size,16);Ga(r,i)||(t.uniformMatrix4fv(this.addr,!1,i),this.updateCache(i))}function ho(t,e,r){var i=this.cache,n=e.length,a=za(r,n);!1===Ga(i,a)&&(t.uniform1iv(this.addr,a),Ua(i,a));for(var o=0;o!==n;++o)r.safeSetTexture2D(e[o]||Oa,a[o])}function po(t,e,r){var i=this.cache,n=e.length,a=za(r,n);!1===Ga(i,a)&&(t.uniform1iv(this.addr,a),Ua(i,a));for(var o=0;o!==n;++o)r.safeSetTextureCube(e[o]||La,a[o])}function fo(t,e,r){this.id=t,this.addr=r,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Wa;case 35664:return Va;case 35665:return Ya;case 35666:return ja;case 35674:return Xa;case 35675:return qa;case 35676:return Za;case 35678:case 36198:return Ka;case 35679:return Ja;case 35680:return $a;case 36289:return Qa;case 5124:case 35670:return Ha;case 35667:case 35671:return to;case 35668:case 35672:return eo;case 35669:case 35673:return ro}}(e.type)}function mo(t,e,r){this.id=t,this.addr=r,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return io;case 35664:return ao;case 35665:return oo;case 35666:return so;case 35674:return lo;case 35675:return uo;case 35676:return co;case 35678:return ho;case 35680:return po;case 5124:case 35670:return no;case 35667:case 35671:return to;case 35668:case 35672:return eo;case 35669:case 35673:return ro}}(e.type)}function go(t){this.id=t,this.seq=[],this.map={}}mo.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Ua(e,t)},go.prototype.setValue=function(t,e,r){for(var i=this.seq,n=0,a=i.length;n!==a;++n){var o=i[n];o.setValue(t,e[o.id],r)}};var vo=/([\w\d_]+)(\])?(\[|\.)?/g;function bo(t,e){t.seq.push(e),t.map[e.id]=e}function yo(t,e,r){var i=t.name,n=i.length;for(vo.lastIndex=0;;){var a=vo.exec(i),o=vo.lastIndex,s=a[1],l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===n){bo(r,void 0===u?new fo(s,t,e):new mo(s,t,e));break}var c=r.map[s];void 0===c&&bo(r,c=new go(s)),r=c}}function Ao(t,e){this.seq=[],this.map={};for(var r=t.getProgramParameter(e,35718),i=0;i<r;++i){var n=t.getActiveUniform(e,i);yo(n,t.getUniformLocation(e,n.name),this)}}function To(t,e,r,i){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),!0===i&&(!1===t.getShaderParameter(n,35713)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",35633===e?"vertex":"fragment",t.getShaderInfoLog(n),function(t){for(var e=t.split("\n"),r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join("\n")}(r))),n}Ao.prototype.setValue=function(t,e,r,i){var n=this.map[e];void 0!==n&&n.setValue(t,r,i)},Ao.prototype.setOptional=function(t,e,r){var i=e[r];void 0!==i&&this.setValue(t,r,i)},Ao.upload=function(t,e,r,i){for(var n=0,a=e.length;n!==a;++n){var o=e[n],s=r[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,i)}},Ao.seqWithValue=function(t,e){for(var r=[],i=0,n=t.length;i!==n;++i){var a=t[i];a.id in e&&r.push(a)}return r};var Co=0;function So(t){switch(t){case fi:return["Linear","( value )"];case mi:return["sRGB","( value )"];case vi:return["RGBE","( value )"];case bi:return["RGBM","( value, 7.0 )"];case yi:return["RGBM","( value, 16.0 )"];case Ai:return["RGBD","( value, 256.0 )"];case gi:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function Eo(t,e){var r=So(e);return"vec4 "+t+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function wo(t,e){var r;switch(e){case $e:r="Linear";break;case tr:r="Reinhard";break;case er:r="Uncharted2";break;case rr:r="OptimizedCineon";break;case ir:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function ko(t){return""!==t}function xo(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function Mo(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function Oo(t){return t.replace(/^[ \t]*#include +<([\w\d.\/]+)>/gm,function(t,e){var r=nn[e];if(void 0===r)throw new Error("Can not resolve #include <"+e+">");return Oo(r)})}function Io(t){return t.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,r,i){for(var n="",a=parseInt(e);a<parseInt(r);a++)n+=i.replace(/\[ i \]/g,"[ "+a+" ]");return n})}function _o(t,e,r,i,n,a,o,s){var l=t.context,u=i.defines,c=n.vertexShader,h=n.fragmentShader,d="SHADOWMAP_TYPE_BASIC";a.shadowMapType===he?d="SHADOWMAP_TYPE_PCF":a.shadowMapType===de&&(d="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",f="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(i.envMap.mapping){case nr:case ar:p="ENVMAP_TYPE_CUBE";break;case ur:case cr:p="ENVMAP_TYPE_CUBE_UV";break;case or:case sr:p="ENVMAP_TYPE_EQUIREC";break;case lr:p="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case ar:case sr:f="ENVMAP_MODE_REFRACTION"}switch(i.combine){case Ze:m="ENVMAP_BLENDING_MULTIPLY";break;case Ke:m="ENVMAP_BLENDING_MIX";break;case Qe:m="ENVMAP_BLENDING_ADD"}}var g,v,b,y,A,T=t.gammaFactor>0?t.gammaFactor:1,C=o.isWebGL2?"":function(t,e,r){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap&&!e.objectSpaceNormalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ko).join("\n")}(i.extensions,a,e),S=function(t){var e=[];for(var r in t){var i=t[r];!1!==i&&e.push("#define "+r+" "+i)}return e.join("\n")}(u),E=l.createProgram();if(i.isRawShaderMaterial?((g=[S].filter(ko).join("\n")).length>0&&(g+="\n"),(v=[C,S].filter(ko).join("\n")).length>0&&(v+="\n")):(g=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,S,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+T,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+f:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+d:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ko).join("\n"),v=[C,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,S,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+T,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+p:"",a.envMap?"#define "+f:"",a.envMap?"#define "+m:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+d:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&(o.isWebGL2||e.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==Je?"#define TONE_MAPPING":"",a.toneMapping!==Je?nn.tonemapping_pars_fragment:"",a.toneMapping!==Je?wo("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?nn.encodings_pars_fragment:"",a.mapEncoding?Eo("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?Eo("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?Eo("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?Eo("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?(b="linearToOutputTexel",y=a.outputEncoding,A=So(y),"vec4 "+b+"( vec4 value ) { return LinearTo"+A[0]+A[1]+"; }"):"",a.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(ko).join("\n")),c=Mo(c=xo(c=Oo(c),a),a),h=Mo(h=xo(h=Oo(h),a),a),c=Io(c),h=Io(h),o.isWebGL2&&!i.isRawShaderMaterial){var w=!1,k=/^\s*#version\s+300\s+es\s*\n/;i.isShaderMaterial&&null!==c.match(k)&&null!==h.match(k)&&(w=!0,c=c.replace(k,""),h=h.replace(k,"")),g=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#version 300 es\n","#define varying in",w?"":"out highp vec4 pc_fragColor;",w?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v}var x,M,O=v+h,I=To(l,35633,g+c,t.debug.checkShaderErrors),_=To(l,35632,O,t.debug.checkShaderErrors);if(l.attachShader(E,I),l.attachShader(E,_),void 0!==i.index0AttributeName?l.bindAttribLocation(E,0,i.index0AttributeName):!0===a.morphTargets&&l.bindAttribLocation(E,0,"position"),l.linkProgram(E),t.debug.checkShaderErrors){var L=l.getProgramInfoLog(E).trim(),P=l.getShaderInfoLog(I).trim(),R=l.getShaderInfoLog(_).trim(),D=!0,F=!0;!1===l.getProgramParameter(E,35714)?(D=!1,console.error("THREE.WebGLProgram: shader error: ",l.getError(),"35715",l.getProgramParameter(E,35715),"gl.getProgramInfoLog",L,P,R)):""!==L?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",L):""!==P&&""!==R||(F=!1),F&&(this.diagnostics={runnable:D,material:i,programLog:L,vertexShader:{log:P,prefix:g},fragmentShader:{log:R,prefix:v}})}return l.deleteShader(I),l.deleteShader(_),this.getUniforms=function(){return void 0===x&&(x=new Ao(l,E,s)),x},this.getAttributes=function(){return void 0===M&&(M=function(t,e){for(var r={},i=t.getProgramParameter(e,35721),n=0;n<i;n++){var a=t.getActiveAttrib(e,n).name;r[a]=t.getAttribLocation(e,a)}return r}(l,E)),M},this.destroy=function(){l.deleteProgram(E),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=n.name,this.id=Co++,this.code=r,this.usedTimes=1,this.program=E,this.vertexShader=I,this.fragmentShader=_,this}function Lo(t,e,r,i){var n=[],a={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},o=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function s(t,e){var r;return t?t.isTexture?r=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=t.texture.encoding):r=fi,r===fi&&e&&(r=gi),r}this.getParameters=function(e,i,n,o,l,u,c){var h=a[e.type],d=c.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(r.floatVertexTextures)return 1024;var i=r.maxVertexUniforms,n=Math.floor((i-20)/4),a=Math.min(n,e.length);return a<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+a+"."),0):a}(c):0,p=r.precision;null!==e.precision&&(p=r.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",p,"instead.");var f=t.getRenderTarget();return{shaderID:h,precision:p,supportsVertexTextures:r.vertexTextures,outputEncoding:s(f?f.texture:null,t.gammaOutput),map:!!e.map,mapEncoding:s(e.map,t.gammaInput),matcap:!!e.matcap,matcapEncoding:s(e.matcap,t.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:s(e.envMap,t.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===ur||e.envMap.mapping===cr),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:s(e.emissiveMap,t.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:e.normalMapType===Ei,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,combine:e.combine,vertexTangents:e.normalMap&&e.vertexTangents,vertexColors:e.vertexColors,fog:!!o,useFog:e.fog,fogExp:o&&o.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:e.skinning&&d>0,maxBones:d,useVertexTexture:r.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:i.directional.length,numPointLights:i.point.length,numSpotLights:i.spot.length,numRectAreaLights:i.rectArea.length,numHemiLights:i.hemi.length,numClippingPlanes:l,numClipIntersection:u,dithering:e.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.receiveShadow&&n.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===me,flipSided:e.side===fe,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCode=function(e,r){var i=[];if(r.shaderID?i.push(r.shaderID):(i.push(e.fragmentShader),i.push(e.vertexShader)),void 0!==e.defines)for(var n in e.defines)i.push(n),i.push(e.defines[n]);for(var a=0;a<o.length;a++)i.push(r[o[a]]);return i.push(e.onBeforeCompile.toString()),i.push(t.gammaOutput),i.push(t.gammaFactor),i.join()},this.acquireProgram=function(a,o,s,l){for(var u,c=0,h=n.length;c<h;c++){var d=n[c];if(d.code===l){++(u=d).usedTimes;break}}return void 0===u&&(u=new _o(t,e,l,a,o,s,r,i),n.push(u)),u},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}function Po(){var t=new WeakMap;return{get:function(e){var r=t.get(e);return void 0===r&&(r={},t.set(e,r)),r},remove:function(e){t.delete(e)},update:function(e,r,i){t.get(e)[r]=i},dispose:function(){t=new WeakMap}}}function Ro(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Do(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Fo(){var t=[],e=0,r=[],i=[],n={id:-1};function a(r,i,a,o,s,l){var u=t[e];return void 0===u?(u={id:r.id,object:r,geometry:i,material:a,program:a.program||n,groupOrder:o,renderOrder:r.renderOrder,z:s,group:l},t[e]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=a,u.program=a.program||n,u.groupOrder=o,u.renderOrder=r.renderOrder,u.z=s,u.group=l),e++,u}return{opaque:r,transparent:i,init:function(){e=0,r.length=0,i.length=0},push:function(t,e,n,o,s,l){var u=a(t,e,n,o,s,l);(!0===n.transparent?i:r).push(u)},unshift:function(t,e,n,o,s,l){var u=a(t,e,n,o,s,l);(!0===n.transparent?i:r).unshift(u)},sort:function(){r.length>1&&r.sort(Ro),i.length>1&&i.sort(Do)}}}function No(){var t={};function e(r){var i=r.target;i.removeEventListener("dispose",e),delete t[i.id]}return{get:function(r,i){var n,a=t[r.id];return void 0===a?(n=new Fo,t[r.id]={},t[r.id][i.id]=n,r.addEventListener("dispose",e)):void 0===(n=a[i.id])&&(n=new Fo,a[i.id]=n),n},dispose:function(){t={}}}}function Bo(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var r;switch(e.type){case"DirectionalLight":r={direction:new Mi,color:new hn,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ki};break;case"SpotLight":r={position:new Mi,direction:new Mi,color:new hn,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ki};break;case"PointLight":r={position:new Mi,color:new hn,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ki,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new Mi,skyColor:new hn,groundColor:new hn};break;case"RectAreaLight":r={color:new hn,position:new Mi,halfWidth:new Mi,halfHeight:new Mi}}return t[e.id]=r,r}}}var Go=0;function Uo(){for(var t=new Bo,e={id:Go++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=0;r<9;r++)e.probe.push(new Mi);var i=new Mi,n=new rn,a=new rn;return{setup:function(r,o,s){for(var l=0,u=0,c=0,h=0;h<9;h++)e.probe[h].set(0,0,0);for(var d=0,p=0,f=0,m=0,g=0,v=s.matrixWorldInverse,b=(h=0,r.length);h<b;h++){var y=r[h],A=y.color,T=y.intensity,C=y.distance,S=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)l+=A.r*T,u+=A.g*T,c+=A.b*T;else if(y.isLightProbe)for(var E=0;E<9;E++)e.probe[E].addScaledVector(y.sh.coefficients[E],T);else if(y.isDirectionalLight){if((k=t.get(y)).color.copy(y.color).multiplyScalar(y.intensity),k.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),k.direction.sub(i),k.direction.transformDirection(v),k.shadow=y.castShadow,y.castShadow){var w=y.shadow;k.shadowBias=w.bias,k.shadowRadius=w.radius,k.shadowMapSize=w.mapSize}e.directionalShadowMap[d]=S,e.directionalShadowMatrix[d]=y.shadow.matrix,e.directional[d]=k,d++}else if(y.isSpotLight)(k=t.get(y)).position.setFromMatrixPosition(y.matrixWorld),k.position.applyMatrix4(v),k.color.copy(A).multiplyScalar(T),k.distance=C,k.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),k.direction.sub(i),k.direction.transformDirection(v),k.coneCos=Math.cos(y.angle),k.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),k.decay=y.decay,k.shadow=y.castShadow,y.castShadow&&(w=y.shadow,k.shadowBias=w.bias,k.shadowRadius=w.radius,k.shadowMapSize=w.mapSize),e.spotShadowMap[f]=S,e.spotShadowMatrix[f]=y.shadow.matrix,e.spot[f]=k,f++;else if(y.isRectAreaLight)(k=t.get(y)).color.copy(A).multiplyScalar(T),k.position.setFromMatrixPosition(y.matrixWorld),k.position.applyMatrix4(v),a.identity(),n.copy(y.matrixWorld),n.premultiply(v),a.extractRotation(n),k.halfWidth.set(.5*y.width,0,0),k.halfHeight.set(0,.5*y.height,0),k.halfWidth.applyMatrix4(a),k.halfHeight.applyMatrix4(a),e.rectArea[m]=k,m++;else if(y.isPointLight)(k=t.get(y)).position.setFromMatrixPosition(y.matrixWorld),k.position.applyMatrix4(v),k.color.copy(y.color).multiplyScalar(y.intensity),k.distance=y.distance,k.decay=y.decay,k.shadow=y.castShadow,y.castShadow&&(w=y.shadow,k.shadowBias=w.bias,k.shadowRadius=w.radius,k.shadowMapSize=w.mapSize,k.shadowCameraNear=w.camera.near,k.shadowCameraFar=w.camera.far),e.pointShadowMap[p]=S,e.pointShadowMatrix[p]=y.shadow.matrix,e.point[p]=k,p++;else if(y.isHemisphereLight){var k;(k=t.get(y)).direction.setFromMatrixPosition(y.matrixWorld),k.direction.transformDirection(v),k.direction.normalize(),k.skyColor.copy(y.color).multiplyScalar(T),k.groundColor.copy(y.groundColor).multiplyScalar(T),e.hemi[g]=k,g++}}e.ambient[0]=l,e.ambient[1]=u,e.ambient[2]=c,e.directional.length=d,e.spot.length=f,e.rectArea.length=m,e.point.length=p,e.hemi.length=g,e.hash.stateID=e.id,e.hash.directionalLength=d,e.hash.pointLength=p,e.hash.spotLength=f,e.hash.rectAreaLength=m,e.hash.hemiLength=g,e.hash.shadowsLength=o.length},state:e}}function zo(){var t=new Uo,e=[],r=[];return{init:function(){e.length=0,r.length=0},state:{lightsArray:e,shadowsArray:r,lights:t},setupLights:function(i){t.setup(e,r,i)},pushLight:function(t){e.push(t)},pushShadow:function(t){r.push(t)}}}function Wo(){var t={};function e(r){var i=r.target;i.removeEventListener("dispose",e),delete t[i.id]}return{get:function(r,i){var n;return void 0===t[r.id]?(n=new zo,t[r.id]={},t[r.id][i.id]=n,r.addEventListener("dispose",e)):void 0===t[r.id][i.id]?(n=new zo,t[r.id][i.id]=n):n=t[r.id][i.id],n},dispose:function(){t={}}}}function Ho(t){Zn.call(this),this.type="MeshDepthMaterial",this.depthPacking=Ti,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function Vo(t){Zn.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Mi,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}function Yo(t,e,r){for(var i=new en,n=new rn,a=new ki,o=new ki(r,r),s=new Mi,l=new Mi,u=1,c=2,h=1+(u|c),d=new Array(h),p=new Array(h),f={},m={0:fe,1:pe,2:me},g=[new Mi(1,0,0),new Mi(-1,0,0),new Mi(0,0,1),new Mi(0,0,-1),new Mi(0,1,0),new Mi(0,-1,0)],v=[new Mi(0,1,0),new Mi(0,1,0),new Mi(0,1,0),new Mi(0,1,0),new Mi(0,0,1),new Mi(0,0,-1)],b=[new Xi,new Xi,new Xi,new Xi,new Xi,new Xi],y=0;y!==h;++y){var A=0!=(y&u),T=0!=(y&c),C=new Ho({depthPacking:Ci,morphTargets:A,skinning:T});d[y]=C;var S=new Vo({morphTargets:A,skinning:T});p[y]=S}var E=this;function w(e,r,i,n,a,o){var s=e.geometry,l=null,h=d,g=e.customDepthMaterial;if(i&&(h=p,g=e.customDistanceMaterial),g)l=g;else{var v=!1;r.morphTargets&&(s&&s.isBufferGeometry?v=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(v=s.morphTargets&&s.morphTargets.length>0)),e.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e);var b=e.isSkinnedMesh&&r.skinning,y=0;v&&(y|=u),b&&(y|=c),l=h[y]}if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var A=l.uuid,T=r.uuid,C=f[A];void 0===C&&(C={},f[A]=C);var S=C[T];void 0===S&&(S=l.clone(),C[T]=S),l=S}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=null!=r.shadowSide?r.shadowSide:m[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,i&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(n),l.nearDistance=a,l.farDistance=o),l}function k(r,n,a,o){if(!1!==r.visible){if(r.layers.test(n.layers)&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||i.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);var s=e.update(r),u=r.material;if(Array.isArray(u))for(var c=s.groups,h=0,d=c.length;h<d;h++){var p=c[h],f=u[p.materialIndex];if(f&&f.visible){var m=w(r,f,o,l,a.near,a.far);t.renderBufferDirect(a,null,s,m,r,p)}}else if(u.visible){m=w(r,u,o,l,a.near,a.far);t.renderBufferDirect(a,null,s,m,r,null)}}for(var g=r.children,v=0,b=g.length;v<b;v++)k(g[v],n,a,o)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=he,this.render=function(e,r,u){if(!1!==E.enabled&&(!1!==E.autoUpdate||!1!==E.needsUpdate)&&0!==e.length){var c,h=t.getRenderTarget(),d=t.state;d.setBlending(ye),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var p=0,f=e.length;p<f;p++){var m=e[p],y=m.shadow,A=m&&m.isPointLight;if(void 0!==y){var T=y.camera;if(a.copy(y.mapSize),a.min(o),A){var C=a.x,S=a.y;b[0].set(2*C,S,C,S),b[1].set(0,S,C,S),b[2].set(3*C,S,C,S),b[3].set(C,S,C,S),b[4].set(3*C,0,C,S),b[5].set(C,0,C,S),a.x*=4,a.y*=2}if(null===y.map){var w={minFilter:fr,magFilter:fr,format:Rr};y.map=new qi(a.x,a.y,w),y.map.texture.name=m.name+".shadowMap",T.updateProjectionMatrix()}y.isSpotLightShadow&&y.update(m);var x=y.map,M=y.matrix;l.setFromMatrixPosition(m.matrixWorld),T.position.copy(l),A?(c=6,M.makeTranslation(-l.x,-l.y,-l.z)):(c=1,s.setFromMatrixPosition(m.target.matrixWorld),T.lookAt(s),T.updateMatrixWorld(),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(T.projectionMatrix),M.multiply(T.matrixWorldInverse)),t.setRenderTarget(x),t.clear();for(var O=0;O<c;O++){if(A){s.copy(T.position),s.add(g[O]),T.up.copy(v[O]),T.lookAt(s),T.updateMatrixWorld();var I=b[O];d.viewport(I)}n.multiplyMatrices(T.projectionMatrix,T.matrixWorldInverse),i.setFromMatrix(n),k(r,u,T,A)}}else console.warn("THREE.WebGLShadowMap:",m,"has no shadow.")}E.needsUpdate=!1,t.setRenderTarget(h)}}}function jo(t,e,r,i){var n=new function(){var e=!1,r=new Xi,i=null,n=new Xi(0,0,0,0);return{setMask:function(r){i===r||e||(t.colorMask(r,r,r,r),i=r)},setLocked:function(t){e=t},setClear:function(e,i,a,o,s){!0===s&&(e*=o,i*=o,a*=o),r.set(e,i,a,o),!1===n.equals(r)&&(t.clearColor(e,i,a,o),n.copy(r))},reset:function(){e=!1,i=null,n.set(-1,0,0,0)}}},a=new function(){var e=!1,r=null,i=null,n=null;return{setTest:function(t){t?G(2929):U(2929)},setMask:function(i){r===i||e||(t.depthMask(i),r=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case ze:t.depthFunc(512);break;case We:t.depthFunc(519);break;case He:t.depthFunc(513);break;case Ve:t.depthFunc(515);break;case Ye:t.depthFunc(514);break;case je:t.depthFunc(518);break;case Xe:t.depthFunc(516);break;case qe:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){n!==e&&(t.clearDepth(e),n=e)},reset:function(){e=!1,r=null,i=null,n=null}}},o=new function(){var e=!1,r=null,i=null,n=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(t){t?G(2960):U(2960)},setMask:function(i){r===i||e||(t.stencilMask(i),r=i)},setFunc:function(e,r,o){i===e&&n===r&&a===o||(t.stencilFunc(e,r,o),i=e,n=r,a=o)},setOp:function(e,r,i){o===e&&s===r&&l===i||(t.stencilOp(e,r,i),o=e,s=r,l=i)},setLocked:function(t){e=t},setClear:function(e){u!==e&&(t.clearStencil(e),u=e)},reset:function(){e=!1,r=null,i=null,n=null,a=null,o=null,s=null,l=null,u=null}}},s=t.getParameter(34921),l=new Uint8Array(s),u=new Uint8Array(s),c=new Uint8Array(s),h={},d=null,p=null,f=null,m=null,g=null,v=null,b=null,y=null,A=null,T=null,C=!1,S=null,E=null,w=null,k=null,x=null,M=t.getParameter(35661),O=!1,I=0,_=t.getParameter(7938);-1!==_.indexOf("WebGL")?(I=parseFloat(/^WebGL\ ([0-9])/.exec(_)[1]),O=I>=1):-1!==_.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(_)[1]),O=I>=2);var L=null,P={},R=new Xi,D=new Xi;function F(e,r,i){var n=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(var o=0;o<i;o++)t.texImage2D(r+o,0,6408,1,1,0,6408,5121,n);return a}var N={};function B(r,n){(l[r]=1,0===u[r]&&(t.enableVertexAttribArray(r),u[r]=1),c[r]!==n)&&((i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,n),c[r]=n)}function G(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function U(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}function z(e,i,n,a,o,s,l,u){if(e!==ye){if(f||(G(3042),f=!0),e===Ee)o=o||i,s=s||n,l=l||a,i===g&&o===y||(t.blendEquationSeparate(r.convert(i),r.convert(o)),g=i,y=o),n===v&&a===b&&s===A&&l===T||(t.blendFuncSeparate(r.convert(n),r.convert(a),r.convert(s),r.convert(l)),v=n,b=a,A=s,T=l),m=e,C=null;else if(e!==m||u!==C){if(g===we&&y===we||(t.blendEquation(32774),g=we,y=we),u)switch(e){case Ae:t.blendFuncSeparate(1,771,1,771);break;case Te:t.blendFunc(1,1);break;case Ce:t.blendFuncSeparate(0,0,769,771);break;case Se:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case Ae:t.blendFuncSeparate(770,771,1,771);break;case Te:t.blendFunc(770,1);break;case Ce:t.blendFunc(0,769);break;case Se:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}v=null,b=null,A=null,T=null,m=e,C=u}}else f&&(U(3042),f=!1)}function W(e){S!==e&&(e?t.frontFace(2304):t.frontFace(2305),S=e)}function H(e){e!==le?(G(2884),e!==E&&(e===ue?t.cullFace(1029):e===ce?t.cullFace(1028):t.cullFace(1032))):U(2884),E=e}function V(e,r,i){e?(G(32823),k===r&&x===i||(t.polygonOffset(r,i),k=r,x=i)):U(32823)}function Y(e){void 0===e&&(e=33984+M-1),L!==e&&(t.activeTexture(e),L=e)}return N[3553]=F(3553,3553,1),N[34067]=F(34067,34069,6),n.setClear(0,0,0,1),a.setClear(1),o.setClear(0),G(2929),a.setFunc(Ve),W(!1),H(ue),G(2884),z(ye),{buffers:{color:n,depth:a,stencil:o},initAttributes:function(){for(var t=0,e=l.length;t<e;t++)l[t]=0},enableAttribute:function(t){B(t,0)},enableAttributeAndDivisor:B,disableUnusedAttributes:function(){for(var e=0,r=u.length;e!==r;++e)u[e]!==l[e]&&(t.disableVertexAttribArray(e),u[e]=0)},enable:G,disable:U,getCompressedTextureFormats:function(){if(null===d&&(d=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")||e.get("WEBGL_compressed_texture_astc")))for(var r=t.getParameter(34467),i=0;i<r.length;i++)d.push(r[i]);return d},useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:z,setMaterial:function(t,e){t.side===me?U(2884):G(2884);var r=t.side===fe;e&&(r=!r),W(r),t.blending===Ae&&!1===t.transparent?z(ye):z(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),n.setMask(t.colorWrite),V(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:W,setCullFace:H,setLineWidth:function(e){e!==w&&(O&&t.lineWidth(e),w=e)},setPolygonOffset:V,setScissorTest:function(t){t?G(3089):U(3089)},activeTexture:Y,bindTexture:function(e,r){null===L&&Y();var i=P[L];void 0===i&&(i={type:void 0,texture:void 0},P[L]=i),i.type===e&&i.texture===r||(t.bindTexture(e,r||N[e]),i.type=e,i.texture=r)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===R.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),R.copy(e))},viewport:function(e){!1===D.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),D.copy(e))},reset:function(){for(var e=0;e<u.length;e++)1===u[e]&&(t.disableVertexAttribArray(e),u[e]=0);h={},d=null,L=null,P={},p=null,m=null,S=null,E=null,n.reset(),a.reset(),o.reset()}}}function Xo(t,e,r,i,n,a,o){var s,l={},u="undefined"!=typeof OffscreenCanvas;function c(t,e){return u?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function h(t,e,r,i){var n=1;if((t.width>i||t.height>i)&&(n=i/Math.max(t.width,t.height)),n<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var a=e?wi.floorPowerOfTwo:Math.floor,o=a(n*t.width),l=a(n*t.height);void 0===s&&(s=c(o,l));var u=r?c(o,l):s;return u.width=o,u.height=l,u.getContext("2d").drawImage(t,0,0,o,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+l+")."),u}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function d(t){return wi.isPowerOfTwo(t.width)&&wi.isPowerOfTwo(t.height)}function p(t,e){return t.generateMipmaps&&e&&t.minFilter!==fr&&t.minFilter!==vr}function f(e,r,n,a){t.generateMipmap(e),i.get(r).__maxMipLevel=Math.log(Math.max(n,a))*Math.LOG2E}function m(t,r){if(!n.isWebGL2)return t;var i=t;return 6403===t&&(5126===r&&(i=33326),5131===r&&(i=33325),5121===r&&(i=33321)),6407===t&&(5126===r&&(i=34837),5131===r&&(i=34843),5121===r&&(i=32849)),6408===t&&(5126===r&&(i=34836),5131===r&&(i=34842),5121===r&&(i=32856)),33325===i||33326===i||34842===i||34836===i?e.get("EXT_color_buffer_float"):34843!==i&&34837!==i||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),i}function g(t){return t===fr||t===mr||t===gr?9728:9729}function v(e){var r=e.target;r.removeEventListener("dispose",v),function(e){var r=i.get(e);if(void 0===r.__webglInit)return;t.deleteTexture(r.__webglTexture),i.remove(e)}(r),r.isVideoTexture&&delete l[r.id],o.memory.textures--}function b(e){var r=e.target;r.removeEventListener("dispose",b),function(e){var r=i.get(e),n=i.get(e.texture);if(!e)return;void 0!==n.__webglTexture&&t.deleteTexture(n.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLRenderTargetCube)for(var a=0;a<6;a++)t.deleteFramebuffer(r.__webglFramebuffer[a]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[a]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer);i.remove(e.texture),i.remove(e)}(r),o.memory.textures--}var y=0;function A(t,e){var n=i.get(t);if(t.isVideoTexture&&function(t){var e=t.id,r=o.render.frame;l[e]!==r&&(l[e]=r,t.update())}(t),t.version>0&&n.__version!==t.version){var a=t.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void w(n,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+e),r.bindTexture(3553,n.__webglTexture)}function T(e,o){var s=i.get(e);if(6===e.image.length)if(e.version>0&&s.__version!==e.version){E(s,e),r.activeTexture(33984+o),r.bindTexture(34067,s.__webglTexture),t.pixelStorei(37440,e.flipY);for(var l=e&&e.isCompressedTexture,u=e.image[0]&&e.image[0].isDataTexture,c=[],g=0;g<6;g++)c[g]=l||u?u?e.image[g].image:e.image[g]:h(e.image[g],!1,!0,n.maxCubemapSize);var v=c[0],b=d(v)||n.isWebGL2,y=a.convert(e.format),A=a.convert(e.type),T=m(y,A);S(34067,e,b);for(g=0;g<6;g++)if(l)for(var C,w=c[g].mipmaps,k=0,x=w.length;k<x;k++)C=w[k],e.format!==Rr&&e.format!==Pr?r.getCompressedTextureFormats().indexOf(y)>-1?r.compressedTexImage2D(34069+g,k,T,C.width,C.height,0,C.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+g,k,T,C.width,C.height,0,y,A,C.data);else u?r.texImage2D(34069+g,0,T,c[g].width,c[g].height,0,y,A,c[g].data):r.texImage2D(34069+g,0,T,y,A,c[g]);s.__maxMipLevel=l?w.length-1:0,p(e,b)&&f(34067,e,v.width,v.height),s.__version=e.version,e.onUpdate&&e.onUpdate(e)}else r.activeTexture(33984+o),r.bindTexture(34067,s.__webglTexture)}function C(t,e){r.activeTexture(33984+e),r.bindTexture(34067,i.get(t).__webglTexture)}function S(r,o,s){var l;if(s?(t.texParameteri(r,10242,a.convert(o.wrapS)),t.texParameteri(r,10243,a.convert(o.wrapT)),32879!==r&&35866!==r||t.texParameteri(r,32882,a.convert(o.wrapR)),t.texParameteri(r,10240,a.convert(o.magFilter)),t.texParameteri(r,10241,a.convert(o.minFilter))):(t.texParameteri(r,10242,33071),t.texParameteri(r,10243,33071),32879!==r&&35866!==r||t.texParameteri(r,32882,33071),o.wrapS===dr&&o.wrapT===dr||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(r,10240,g(o.magFilter)),t.texParameteri(r,10241,g(o.minFilter)),o.minFilter!==fr&&o.minFilter!==vr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),l=e.get("EXT_texture_filter_anisotropic")){if(o.type===kr&&null===e.get("OES_texture_float_linear"))return;if(o.type===xr&&null===(n.isWebGL2||e.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(t.texParameterf(r,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,n.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function E(e,r){void 0===e.__webglInit&&(e.__webglInit=!0,r.addEventListener("dispose",v),e.__webglTexture=t.createTexture(),o.memory.textures++)}function w(e,i,o){var s=3553;i.isDataTexture2DArray&&(s=35866),i.isDataTexture3D&&(s=32879),E(e,i),r.activeTexture(33984+o),r.bindTexture(s,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment);var l=function(t){return!n.isWebGL2&&(t.wrapS!==dr||t.wrapT!==dr||t.minFilter!==fr&&t.minFilter!==vr)}(i)&&!1===d(i.image),u=h(i.image,l,!1,n.maxTextureSize),c=d(u)||n.isWebGL2,g=a.convert(i.format),v=a.convert(i.type),b=m(g,v);S(s,i,c);var y,A=i.mipmaps;if(i.isDepthTexture){if(b=6402,i.type===kr){if(!n.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");b=36012}else n.isWebGL2&&(b=33189);i.format===Nr&&6402===b&&i.type!==Sr&&i.type!==wr&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Sr,v=a.convert(i.type)),i.format===Br&&(b=34041,i.type!==_r&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=_r,v=a.convert(i.type))),r.texImage2D(3553,0,b,u.width,u.height,0,g,v,null)}else if(i.isDataTexture)if(A.length>0&&c){for(var T=0,C=A.length;T<C;T++)y=A[T],r.texImage2D(3553,T,b,y.width,y.height,0,g,v,y.data);i.generateMipmaps=!1,e.__maxMipLevel=A.length-1}else r.texImage2D(3553,0,b,u.width,u.height,0,g,v,u.data),e.__maxMipLevel=0;else if(i.isCompressedTexture){for(T=0,C=A.length;T<C;T++)y=A[T],i.format!==Rr&&i.format!==Pr?r.getCompressedTextureFormats().indexOf(g)>-1?r.compressedTexImage2D(3553,T,b,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,T,b,y.width,y.height,0,g,v,y.data);e.__maxMipLevel=A.length-1}else if(i.isDataTexture2DArray)r.texImage3D(35866,0,b,u.width,u.height,u.depth,0,g,v,u.data),e.__maxMipLevel=0;else if(i.isDataTexture3D)r.texImage3D(32879,0,b,u.width,u.height,u.depth,0,g,v,u.data),e.__maxMipLevel=0;else if(A.length>0&&c){for(T=0,C=A.length;T<C;T++)y=A[T],r.texImage2D(3553,T,b,g,v,y);i.generateMipmaps=!1,e.__maxMipLevel=A.length-1}else r.texImage2D(3553,0,b,g,v,u),e.__maxMipLevel=0;p(i,c)&&f(3553,i,u.width,u.height),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}function k(e,n,o,s){var l=a.convert(n.texture.format),u=a.convert(n.texture.type),c=m(l,u);r.texImage2D(s,0,c,n.width,n.height,0,l,u,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,o,s,i.get(n.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function x(e,r,i){if(t.bindRenderbuffer(36161,e),r.depthBuffer&&!r.stencilBuffer){if(i){var n=O(r);t.renderbufferStorageMultisample(36161,n,33189,r.width,r.height)}else t.renderbufferStorage(36161,33189,r.width,r.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(r.depthBuffer&&r.stencilBuffer){if(i){n=O(r);t.renderbufferStorageMultisample(36161,n,34041,r.width,r.height)}else t.renderbufferStorage(36161,34041,r.width,r.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{var o=m(a.convert(r.texture.format),a.convert(r.texture.type));if(i){n=O(r);t.renderbufferStorageMultisample(36161,n,o,r.width,r.height)}else t.renderbufferStorage(36161,o,r.width,r.height)}t.bindRenderbuffer(36161,null)}function M(e){var r=i.get(e),n=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),A(r.depthTexture,0);var n=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Nr)t.framebufferTexture2D(36160,36096,3553,n,0);else{if(r.depthTexture.format!==Br)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,n,0)}}(r.__webglFramebuffer,e)}else if(n){r.__webglDepthbuffer=[];for(var a=0;a<6;a++)t.bindFramebuffer(36160,r.__webglFramebuffer[a]),r.__webglDepthbuffer[a]=t.createRenderbuffer(),x(r.__webglDepthbuffer[a],e)}else t.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),x(r.__webglDepthbuffer,e);t.bindFramebuffer(36160,null)}function O(t){return n.isWebGL2&&t.isWebGLMultisampleRenderTarget?Math.min(n.maxSamples,t.samples):0}var I=!1,_=!1;this.allocateTextureUnit=function(){var t=y;return t>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+n.maxTextures),y+=1,t},this.resetTextureUnits=function(){y=0},this.setTexture2D=A,this.setTexture2DArray=function(t,e){var n=i.get(t);t.version>0&&n.__version!==t.version?w(n,t,e):(r.activeTexture(33984+e),r.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(t,e){var n=i.get(t);t.version>0&&n.__version!==t.version?w(n,t,e):(r.activeTexture(33984+e),r.bindTexture(32879,n.__webglTexture))},this.setTextureCube=T,this.setTextureCubeDynamic=C,this.setupRenderTarget=function(e){var s=i.get(e),l=i.get(e.texture);e.addEventListener("dispose",b),l.__webglTexture=t.createTexture(),o.memory.textures++;var u=!0===e.isWebGLRenderTargetCube,c=!0===e.isWebGLMultisampleRenderTarget,h=d(e)||n.isWebGL2;if(u){s.__webglFramebuffer=[];for(var g=0;g<6;g++)s.__webglFramebuffer[g]=t.createFramebuffer()}else if(s.__webglFramebuffer=t.createFramebuffer(),c)if(n.isWebGL2){s.__webglMultisampledFramebuffer=t.createFramebuffer(),s.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var v=m(a.convert(e.texture.format),a.convert(e.texture.type)),y=O(e);t.renderbufferStorageMultisample(36161,y,v,e.width,e.height),t.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(s.__webglDepthRenderbuffer=t.createRenderbuffer(),x(s.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){for(r.bindTexture(34067,l.__webglTexture),S(34067,e.texture,h),g=0;g<6;g++)k(s.__webglFramebuffer[g],e,36064,34069+g);p(e.texture,h)&&f(34067,e.texture,e.width,e.height),r.bindTexture(34067,null)}else r.bindTexture(3553,l.__webglTexture),S(3553,e.texture,h),k(s.__webglFramebuffer,e,36064,3553),p(e.texture,h)&&f(3553,e.texture,e.width,e.height),r.bindTexture(3553,null);e.depthBuffer&&M(e)},this.updateRenderTargetMipmap=function(t){var e=t.texture;if(p(e,d(t)||n.isWebGL2)){var a=t.isWebGLRenderTargetCube?34067:3553,o=i.get(e).__webglTexture;r.bindTexture(a,o),f(a,e,t.width,t.height),r.bindTexture(a,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(n.isWebGL2){var r=i.get(e);t.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,r.__webglFramebuffer);var a=e.width,o=e.height,s=16384;e.depthBuffer&&(s|=256),e.stencilBuffer&&(s|=1024),t.blitFramebuffer(0,0,a,o,0,0,a,o,s,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===I&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),I=!0),t=t.texture),A(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLRenderTargetCube&&(!1===_&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),_=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?T(t,e):C(t,e)}}function qo(t,e,r){return{convert:function(t){var i;if(t===hr)return 10497;if(t===dr)return 33071;if(t===pr)return 33648;if(t===fr)return 9728;if(t===mr)return 9984;if(t===gr)return 9986;if(t===vr)return 9729;if(t===br)return 9985;if(t===yr)return 9987;if(t===Ar)return 5121;if(t===Mr)return 32819;if(t===Or)return 32820;if(t===Ir)return 33635;if(t===Tr)return 5120;if(t===Cr)return 5122;if(t===Sr)return 5123;if(t===Er)return 5124;if(t===wr)return 5125;if(t===kr)return 5126;if(t===xr){if(r.isWebGL2)return 5131;if(null!==(i=e.get("OES_texture_half_float")))return i.HALF_FLOAT_OES}if(t===Lr)return 6406;if(t===Pr)return 6407;if(t===Rr)return 6408;if(t===Dr)return 6409;if(t===Fr)return 6410;if(t===Nr)return 6402;if(t===Br)return 34041;if(t===Gr)return 6403;if(t===we)return 32774;if(t===ke)return 32778;if(t===xe)return 32779;if(t===Ie)return 0;if(t===_e)return 1;if(t===Le)return 768;if(t===Pe)return 769;if(t===Re)return 770;if(t===De)return 771;if(t===Fe)return 772;if(t===Ne)return 773;if(t===Be)return 774;if(t===Ge)return 775;if(t===Ue)return 776;if((t===Ur||t===zr||t===Wr||t===Hr)&&null!==(i=e.get("WEBGL_compressed_texture_s3tc"))){if(t===Ur)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===zr)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Wr)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Hr)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((t===Vr||t===Yr||t===jr||t===Xr)&&null!==(i=e.get("WEBGL_compressed_texture_pvrtc"))){if(t===Vr)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Yr)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===jr)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Xr)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===qr&&null!==(i=e.get("WEBGL_compressed_texture_etc1")))return i.COMPRESSED_RGB_ETC1_WEBGL;if((t===Zr||t===Kr||t===Qr||t===Jr||t===$r||t===ti||t===ei||t===ri||t===ii||t===ni||t===ai||t===oi||t===si||t===li)&&null!==(i=e.get("WEBGL_compressed_texture_astc")))return t;if(t===Me||t===Oe){if(r.isWebGL2){if(t===Me)return 32775;if(t===Oe)return 32776}if(null!==(i=e.get("EXT_blend_minmax"))){if(t===Me)return i.MIN_EXT;if(t===Oe)return i.MAX_EXT}}if(t===_r){if(r.isWebGL2)return 34042;if(null!==(i=e.get("WEBGL_depth_texture")))return i.UNSIGNED_INT_24_8_WEBGL}return 0}}}function Zo(){wn.call(this),this.type="Group"}function Ko(){wn.call(this),this.type="Camera",this.matrixWorldInverse=new rn,this.projectionMatrix=new rn,this.projectionMatrixInverse=new rn}function Qo(t,e,r,i){Ko.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Jo(t){Qo.call(this),this.cameras=t||[]}Ho.prototype=Object.create(Zn.prototype),Ho.prototype.constructor=Ho,Ho.prototype.isMeshDepthMaterial=!0,Ho.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Vo.prototype=Object.create(Zn.prototype),Vo.prototype.constructor=Vo,Vo.prototype.isMeshDistanceMaterial=!0,Vo.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},Zo.prototype=Object.assign(Object.create(wn.prototype),{constructor:Zo,isGroup:!0}),Ko.prototype=Object.assign(Object.create(wn.prototype),{constructor:Ko,isCamera:!0,copy:function(t,e){return wn.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Mi),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){wn.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Qo.prototype=Object.assign(Object.create(Ko.prototype),{constructor:Qo,isPerspectiveCamera:!0,copy:function(t,e){return Ko.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*wi.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*wi.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*wi.RAD2DEG*Math.atan(Math.tan(.5*wi.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,r,i,n,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*wi.DEG2RAD*this.fov)/this.zoom,r=2*e,i=this.aspect*r,n=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;n+=a.offsetX*i/o,e-=a.offsetY*r/s,i*=a.width/o,r*=a.height/s}var l=this.filmOffset;0!==l&&(n+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,e,e-r,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=wn.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),Jo.prototype=Object.assign(Object.create(Qo.prototype),{constructor:Jo,isArrayCamera:!0});var $o,ts,es,rs,is,ns,as=new Mi,os=new Mi;function ss(t,e,r){as.setFromMatrixPosition(e.matrixWorld),os.setFromMatrixPosition(r.matrixWorld);var i=as.distanceTo(os),n=e.projectionMatrix.elements,a=r.projectionMatrix.elements,o=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],u=(n[9]-1)/n[5],c=(n[8]-1)/n[0],h=(a[8]+1)/a[0],d=o*c,p=o*h,f=i/(-c+h),m=f*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);var g=o+f,v=s+f,b=d-m,y=p+(i-m),A=l*s/v*g,T=u*s/v*g;t.projectionMatrix.makePerspective(b,y,A,T,g,v)}function ls(t){var e=this,r=null,i=null,n=null,a=[],o=new rn,s=new rn,l=1,u="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(i=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",y,!1));var c=new rn,h=new xi,d=new Mi,p=new Qo;p.bounds=new Xi(0,0,.5,1),p.layers.enable(1);var f=new Qo;f.bounds=new Xi(.5,0,.5,1),f.layers.enable(2);var m=new Jo([p,f]);function g(){return null!==r&&!0===r.isPresenting}m.layers.enable(1),m.layers.enable(2);var v,b=new ki;function y(){if(g()){var i=r.getEyeParameters("left"),n=i.renderWidth*l,a=i.renderHeight*l;v=t.getPixelRatio(),t.getSize(b),t.setDrawingBufferSize(2*n,a,1),C.start()}else e.enabled&&t.setDrawingBufferSize(b.width,b.height,v),C.stop()}var A=[];function T(t){for(var e=navigator.getGamepads&&navigator.getGamepads(),r=0,i=0,n=e.length;r<n;r++){var a=e[r];if(a&&("Daydream Controller"===a.id||"Gear VR Controller"===a.id||"Oculus Go Controller"===a.id||"OpenVR Gamepad"===a.id||a.id.startsWith("Oculus Touch")||a.id.startsWith("Spatial Controller"))){if(i===t)return a;i++}}}this.enabled=!1,this.getController=function(t){var e=a[t];return void 0===e&&((e=new Zo).matrixAutoUpdate=!1,e.visible=!1,a[t]=e),e},this.getDevice=function(){return r},this.setDevice=function(t){void 0!==t&&(r=t),C.setContext(t)},this.setFramebufferScaleFactor=function(t){l=t},this.setFrameOfReferenceType=function(t){u=t},this.setPoseTarget=function(t){void 0!==t&&(n=t)},this.getCamera=function(t){var e="stage"===u?1.6:0;if(!1===g())return t.position.set(0,e,0),t.rotation.set(0,0,0),t;if(r.depthNear=t.near,r.depthFar=t.far,r.getFrameData(i),"stage"===u){var l=r.stageParameters;l?o.fromArray(l.sittingToStandingTransform):o.makeTranslation(0,e,0)}var v=i.pose,b=null!==n?n:t;b.matrix.copy(o),b.matrix.decompose(b.position,b.quaternion,b.scale),null!==v.orientation&&(h.fromArray(v.orientation),b.quaternion.multiply(h)),null!==v.position&&(h.setFromRotationMatrix(o),d.fromArray(v.position),d.applyQuaternion(h),b.position.add(d)),b.updateMatrixWorld(),p.near=t.near,f.near=t.near,p.far=t.far,f.far=t.far,p.matrixWorldInverse.fromArray(i.leftViewMatrix),f.matrixWorldInverse.fromArray(i.rightViewMatrix),s.getInverse(o),"stage"===u&&(p.matrixWorldInverse.multiply(s),f.matrixWorldInverse.multiply(s));var y=b.parent;null!==y&&(c.getInverse(y.matrixWorld),p.matrixWorldInverse.multiply(c),f.matrixWorldInverse.multiply(c)),p.matrixWorld.getInverse(p.matrixWorldInverse),f.matrixWorld.getInverse(f.matrixWorldInverse),p.projectionMatrix.fromArray(i.leftProjectionMatrix),f.projectionMatrix.fromArray(i.rightProjectionMatrix),ss(m,p,f);var C=r.getLayers();if(C.length){var S=C[0];null!==S.leftBounds&&4===S.leftBounds.length&&p.bounds.fromArray(S.leftBounds),null!==S.rightBounds&&4===S.rightBounds.length&&f.bounds.fromArray(S.rightBounds)}return function(){for(var t=0;t<a.length;t++){var e=a[t],r=T(t);if(void 0!==r&&void 0!==r.pose){if(null===r.pose)return;var i=r.pose;!1===i.hasPosition&&e.position.set(.2,-.6,-.05),null!==i.position&&e.position.fromArray(i.position),null!==i.orientation&&e.quaternion.fromArray(i.orientation),e.matrix.compose(e.position,e.quaternion,e.scale),e.matrix.premultiply(o),e.matrix.decompose(e.position,e.quaternion,e.scale),e.matrixWorldNeedsUpdate=!0,e.visible=!0;var n="Daydream Controller"===r.id?0:1;A[t]!==r.buttons[n].pressed&&(A[t]=r.buttons[n].pressed,!0===A[t]?e.dispatchEvent({type:"selectstart"}):(e.dispatchEvent({type:"selectend"}),e.dispatchEvent({type:"select"})))}else e.visible=!1}}(),m},this.getStandingMatrix=function(){return o},this.isPresenting=g;var C=new mn;this.setAnimationLoop=function(t){C.setAnimationLoop(t),g()&&C.start()},this.submitFrame=function(){g()&&r.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",y)}}function us(t){var e=t.context,r=null,i=null,n=1,a=null,o="stage",s=null,l=[],u=[];function c(){return null!==i&&null!==a}var h=new Qo;h.layers.enable(1),h.viewport=new Xi;var d=new Qo;d.layers.enable(2),d.viewport=new Xi;var p=new Jo([h,d]);function f(t){var e=l[u.indexOf(t.inputSource)];e&&e.dispatchEvent({type:t.type})}function m(){t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),b.stop()}function g(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}p.layers.enable(1),p.layers.enable(2),this.enabled=!1,this.getController=function(t){var e=l[t];return void 0===e&&((e=new Zo).matrixAutoUpdate=!1,e.visible=!1,l[t]=e),e},this.getDevice=function(){return r},this.setDevice=function(t){void 0!==t&&(r=t),t instanceof XRDevice&&e.setCompatibleXRDevice(t)},this.setFramebufferScaleFactor=function(t){n=t},this.setFrameOfReferenceType=function(t){o=t},this.setSession=function(r){null!==(i=r)&&(i.addEventListener("select",f),i.addEventListener("selectstart",f),i.addEventListener("selectend",f),i.addEventListener("end",m),i.baseLayer=new XRWebGLLayer(i,e,{framebufferScaleFactor:n}),i.requestFrameOfReference(o).then(function(e){a=e,t.setFramebuffer(i.baseLayer.framebuffer),b.setContext(i),b.start()}),u=i.getInputSources(),i.addEventListener("inputsourceschange",function(){u=i.getInputSources(),console.log(u);for(var t=0;t<l.length;t++){l[t].userData.inputSource=u[t]}}))},this.getCamera=function(t){if(c()){var e=t.parent,r=p.cameras;g(p,e);for(var i=0;i<r.length;i++)g(r[i],e);t.matrixWorld.copy(p.matrixWorld);for(var n=t.children,a=(i=0,n.length);i<a;i++)n[i].updateMatrixWorld(!0);return ss(p,h,d),p}return t},this.isPresenting=c;var v=null;var b=new mn;b.setAnimationLoop(function(t,e){if(null!==(s=e.getDevicePose(a)))for(var r=i.baseLayer,n=e.views,o=0;o<n.length;o++){var c=n[o],h=r.getViewport(c),d=s.getViewMatrix(c),f=p.cameras[o];f.matrix.fromArray(d).getInverse(f.matrix),f.projectionMatrix.fromArray(c.projectionMatrix),f.viewport.set(h.x,h.y,h.width,h.height),0===o&&p.matrix.copy(f.matrix)}for(o=0;o<l.length;o++){var m=l[o],g=u[o];if(g){var b=e.getInputPose(g,a);if(null!==b){"targetRay"in b?m.matrix.elements=b.targetRay.transformMatrix:"pointerMatrix"in b&&(m.matrix.elements=b.pointerMatrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.visible=!0;continue}}m.visible=!1}v&&v(t)}),this.setAnimationLoop=function(t){v=t},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new rn},this.submitFrame=function(){}}function cs(t){console.log("THREE.WebGLRenderer",ne);var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,n=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,u=void 0!==t.powerPreference?t.powerPreference:"default",c=null,h=null;this.domElement=e,this.context=null,this.debug={checkShaderErrors:!1},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=$e,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d,p,f,m,g,v,b,y,A,T,C,S,E,w,k,x,M,O,I=this,_=!1,L=null,P=null,R=null,D=-1,F={geometry:null,program:null,wireframe:!1},N=null,B=null,G=new Xi,U=new Xi,z=null,W=e.width,H=e.height,V=1,Y=new Xi(0,0,W,H),j=new Xi(0,0,W,H),X=!1,q=new en,Z=new ba,K=!1,Q=!1,J=new rn,$=new Mi;function tt(){return null===P?V:1}try{var et={alpha:i,depth:n,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u};if(e.addEventListener("webglcontextlost",at,!1),e.addEventListener("webglcontextrestored",ot,!1),null===(d=r||e.getContext("webgl",et)||e.getContext("experimental-webgl",et)))throw null!==e.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===d.getShaderPrecisionFormat&&(d.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function rt(){p=new ya(d),(f=new va(d,p,t)).isWebGL2||(p.get("WEBGL_depth_texture"),p.get("OES_texture_float"),p.get("OES_texture_half_float"),p.get("OES_texture_half_float_linear"),p.get("OES_standard_derivatives"),p.get("OES_element_index_uint"),p.get("ANGLE_instanced_arrays")),p.get("OES_texture_float_linear"),O=new qo(d,p,f),(m=new jo(d,p,O,f)).scissor(U.copy(j).multiplyScalar(V)),m.viewport(G.copy(Y).multiplyScalar(V)),g=new Ca(d),v=new Po,b=new Xo(d,p,m,v,f,O,g),y=new gn(d),A=new Aa(d,y,g),T=new wa(A,g),k=new Ea(d),C=new Lo(I,p,f,b),S=new No,E=new Wo,w=new ma(I,m,T,s),x=new ga(d,p,g,f),M=new Ta(d,p,g,f),g.programs=C.programs,I.context=d,I.capabilities=f,I.extensions=p,I.properties=v,I.renderLists=S,I.state=m,I.info=g}rt();var it="undefined"!=typeof navigator&&"xr"in navigator?new us(I):new ls(I);this.vr=it;var nt=new Yo(I,T,f.maxTextureSize);function at(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function ot(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1,rt()}function st(t){var e=t.target;e.removeEventListener("dispose",st),function(t){lt(t),v.remove(t)}(e)}function lt(t){var e=v.get(t).program;t.program=void 0,void 0!==e&&C.releaseProgram(e)}this.shadowMap=nt,this.getContext=function(){return d},this.getContextAttributes=function(){return d.getContextAttributes()},this.forceContextLoss=function(){var t=p.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=p.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return V},this.setPixelRatio=function(t){void 0!==t&&(V=t,this.setSize(W,H,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new ki),t.set(W,H)},this.setSize=function(t,r,i){it.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(W=t,H=r,e.width=t*V,e.height=r*V,!1!==i&&(e.style.width=t+"px",e.style.height=r+"px"),this.setViewport(0,0,t,r))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new ki),t.set(W*V,H*V)},this.setDrawingBufferSize=function(t,r,i){W=t,H=r,V=i,e.width=t*i,e.height=r*i,this.setViewport(0,0,t,r)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Xi),t.copy(G)},this.getViewport=function(t){return t.copy(Y)},this.setViewport=function(t,e,r,i){t.isVector4?Y.set(t.x,t.y,t.z,t.w):Y.set(t,e,r,i),m.viewport(G.copy(Y).multiplyScalar(V))},this.getScissor=function(t){return t.copy(j)},this.setScissor=function(t,e,r,i){t.isVector4?j.set(t.x,t.y,t.z,t.w):j.set(t,e,r,i),m.scissor(U.copy(j).multiplyScalar(V))},this.getScissorTest=function(){return X},this.setScissorTest=function(t){m.setScissorTest(X=t)},this.getClearColor=function(){return w.getClearColor()},this.setClearColor=function(){w.setClearColor.apply(w,arguments)},this.getClearAlpha=function(){return w.getClearAlpha()},this.setClearAlpha=function(){w.setClearAlpha.apply(w,arguments)},this.clear=function(t,e,r){var i=0;(void 0===t||t)&&(i|=16384),(void 0===e||e)&&(i|=256),(void 0===r||r)&&(i|=1024),d.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",at,!1),e.removeEventListener("webglcontextrestored",ot,!1),S.dispose(),E.dispose(),v.dispose(),T.dispose(),it.dispose(),ct.stop()},this.renderBufferImmediate=function(t,e){m.initAttributes();var r=v.get(t);t.hasPositions&&!r.position&&(r.position=d.createBuffer()),t.hasNormals&&!r.normal&&(r.normal=d.createBuffer()),t.hasUvs&&!r.uv&&(r.uv=d.createBuffer()),t.hasColors&&!r.color&&(r.color=d.createBuffer());var i=e.getAttributes();t.hasPositions&&(d.bindBuffer(34962,r.position),d.bufferData(34962,t.positionArray,35048),m.enableAttribute(i.position),d.vertexAttribPointer(i.position,3,5126,!1,0,0)),t.hasNormals&&(d.bindBuffer(34962,r.normal),d.bufferData(34962,t.normalArray,35048),m.enableAttribute(i.normal),d.vertexAttribPointer(i.normal,3,5126,!1,0,0)),t.hasUvs&&(d.bindBuffer(34962,r.uv),d.bufferData(34962,t.uvArray,35048),m.enableAttribute(i.uv),d.vertexAttribPointer(i.uv,2,5126,!1,0,0)),t.hasColors&&(d.bindBuffer(34962,r.color),d.bufferData(34962,t.colorArray,35048),m.enableAttribute(i.color),d.vertexAttribPointer(i.color,3,5126,!1,0,0)),m.disableUnusedAttributes(),d.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,r,i,n,a){var o=n.isMesh&&n.matrixWorld.determinant()<0;m.setMaterial(i,o);var s=ft(t,e,i,n),l=!1;F.geometry===r.id&&F.program===s.id&&F.wireframe===(!0===i.wireframe)||(F.geometry=r.id,F.program=s.id,F.wireframe=!0===i.wireframe,l=!0),n.morphTargetInfluences&&(k.update(n,r,i,s),l=!0);var u,c=r.index,h=r.attributes.position,g=1;!0===i.wireframe&&(c=A.getWireframeAttribute(r),g=2);var v=x;null!==c&&(u=y.get(c),(v=M).setIndex(u)),l&&(!function(t,e,r){if(r&&r.isInstancedBufferGeometry&&!f.isWebGL2&&null===p.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");m.initAttributes();var i=r.attributes,n=e.getAttributes(),a=t.defaultAttributeValues;for(var o in n){var s=n[o];if(s>=0){var l=i[o];if(void 0!==l){var u=l.normalized,c=l.itemSize,h=y.get(l);if(void 0===h)continue;var g=h.buffer,v=h.type,b=h.bytesPerElement;if(l.isInterleavedBufferAttribute){var A=l.data,T=A.stride,C=l.offset;A&&A.isInstancedInterleavedBuffer?(m.enableAttributeAndDivisor(s,A.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=A.meshPerAttribute*A.count)):m.enableAttribute(s),d.bindBuffer(34962,g),d.vertexAttribPointer(s,c,v,u,T*b,C*b)}else l.isInstancedBufferAttribute?(m.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=l.meshPerAttribute*l.count)):m.enableAttribute(s),d.bindBuffer(34962,g),d.vertexAttribPointer(s,c,v,u,0,0)}else if(void 0!==a){var S=a[o];if(void 0!==S)switch(S.length){case 2:d.vertexAttrib2fv(s,S);break;case 3:d.vertexAttrib3fv(s,S);break;case 4:d.vertexAttrib4fv(s,S);break;default:d.vertexAttrib1fv(s,S)}}}}m.disableUnusedAttributes()}(i,s,r),null!==c&&d.bindBuffer(34963,u.buffer));var b=1/0;null!==c?b=c.count:void 0!==h&&(b=h.count);var T=r.drawRange.start*g,C=r.drawRange.count*g,S=null!==a?a.start*g:0,E=null!==a?a.count*g:1/0,w=Math.max(T,S),O=Math.min(b,T+C,S+E)-1,I=Math.max(0,O-w+1);if(0!==I){if(n.isMesh)if(!0===i.wireframe)m.setLineWidth(i.wireframeLinewidth*tt()),v.setMode(1);else switch(n.drawMode){case hi:v.setMode(4);break;case di:v.setMode(5);break;case pi:v.setMode(6)}else if(n.isLine){var _=i.linewidth;void 0===_&&(_=1),m.setLineWidth(_*tt()),n.isLineSegments?v.setMode(1):n.isLineLoop?v.setMode(2):v.setMode(3)}else n.isPoints?v.setMode(0):n.isSprite&&v.setMode(4);r&&r.isInstancedBufferGeometry?r.maxInstancedCount>0&&v.renderInstances(r,w,I):v.render(w,I)}},this.compile=function(t,e){(h=E.get(t,e)).init(),t.traverse(function(t){t.isLight&&(h.pushLight(t),t.castShadow&&h.pushShadow(t))}),h.setupLights(e),t.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var r=0;r<e.material.length;r++)pt(e.material[r],t.fog,e);else pt(e.material,t.fog,e)})};var ut=null;var ct=new mn;function ht(t,e,r,i){for(var n=0,a=t.length;n<a;n++){var o=t[n],s=o.object,l=o.geometry,u=void 0===i?o.material:i,c=o.group;if(r.isArrayCamera){B=r;for(var d=r.cameras,p=0,f=d.length;p<f;p++){var g=d[p];if(s.layers.test(g.layers)){if("viewport"in g)m.viewport(G.copy(g.viewport));else{var v=g.bounds,b=v.x*W,y=v.y*H,A=v.z*W,T=v.w*H;m.viewport(G.set(b,y,A,T).multiplyScalar(V))}h.setupLights(g),dt(s,e,g,l,u,c)}}}else B=null,dt(s,e,r,l,u,c)}}function dt(t,e,r,i,n,a){if(t.onBeforeRender(I,e,r,i,n,a),h=E.get(e,B||r),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){m.setMaterial(n);var o=ft(r,e.fog,n,t);F.geometry=null,F.program=null,F.wireframe=!1,function(t,e){t.render(function(t){I.renderBufferImmediate(t,e)})}(t,o)}else I.renderBufferDirect(r,e.fog,i,n,t,a);t.onAfterRender(I,e,r,i,n,a),h=E.get(e,B||r)}function pt(t,e,r){var i=v.get(t),n=h.state.lights,a=h.state.shadowsArray,o=i.lightsHash,s=n.state.hash,l=C.getParameters(t,n.state,a,e,Z.numPlanes,Z.numIntersection,r),u=C.getProgramCode(t,l),c=i.program,d=!0;if(void 0===c)t.addEventListener("dispose",st);else if(c.code!==u)lt(t);else if(o.stateID!==s.stateID||o.directionalLength!==s.directionalLength||o.pointLength!==s.pointLength||o.spotLength!==s.spotLength||o.rectAreaLength!==s.rectAreaLength||o.hemiLength!==s.hemiLength||o.shadowsLength!==s.shadowsLength)o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,d=!1;else{if(void 0!==l.shaderID)return;d=!1}if(d){if(l.shaderID){var p=fn[l.shaderID];i.shader={name:t.type,uniforms:an(p.uniforms),vertexShader:p.vertexShader,fragmentShader:p.fragmentShader}}else i.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(i.shader,I),u=C.getProgramCode(t,l),c=C.acquireProgram(t,i.shader,l,u),i.program=c,t.program=c}var f=c.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var m=0;m<I.maxMorphTargets;m++)f["morphTarget"+m]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(m=0;m<I.maxMorphNormals;m++)f["morphNormal"+m]>=0&&t.numSupportedMorphNormals++}var g=i.shader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(i.numClippingPlanes=Z.numPlanes,i.numIntersection=Z.numIntersection,g.clippingPlanes=Z.uniform),i.fog=e,void 0===o&&(i.lightsHash=o={}),o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,t.lights&&(g.ambientLightColor.value=n.state.ambient,g.lightProbe.value=n.state.probe,g.directionalLights.value=n.state.directional,g.spotLights.value=n.state.spot,g.rectAreaLights.value=n.state.rectArea,g.pointLights.value=n.state.point,g.hemisphereLights.value=n.state.hemi,g.directionalShadowMap.value=n.state.directionalShadowMap,g.directionalShadowMatrix.value=n.state.directionalShadowMatrix,g.spotShadowMap.value=n.state.spotShadowMap,g.spotShadowMatrix.value=n.state.spotShadowMatrix,g.pointShadowMap.value=n.state.pointShadowMap,g.pointShadowMatrix.value=n.state.pointShadowMatrix);var b=i.program.getUniforms(),y=Ao.seqWithValue(b.seq,g);i.uniformsList=y}function ft(t,e,r,i){b.resetTextureUnits();var n=v.get(r),a=h.state.lights,o=n.lightsHash,s=a.state.hash;if(K&&(Q||t!==N)){var l=t===N&&r.id===D;Z.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,t,n,l)}!1===r.needsUpdate&&(void 0===n.program?r.needsUpdate=!0:r.fog&&n.fog!==e?r.needsUpdate=!0:(!r.lights||o.stateID===s.stateID&&o.directionalLength===s.directionalLength&&o.pointLength===s.pointLength&&o.spotLength===s.spotLength&&o.rectAreaLength===s.rectAreaLength&&o.hemiLength===s.hemiLength&&o.shadowsLength===s.shadowsLength)&&(void 0===n.numClippingPlanes||n.numClippingPlanes===Z.numPlanes&&n.numIntersection===Z.numIntersection)||(r.needsUpdate=!0)),r.needsUpdate&&(pt(r,e,i),r.needsUpdate=!1);var u,c,p=!1,g=!1,y=!1,A=n.program,T=A.getUniforms(),C=n.shader.uniforms;if(m.useProgram(A.program)&&(p=!0,g=!0,y=!0),r.id!==D&&(D=r.id,g=!0),p||N!==t){if(T.setValue(d,"projectionMatrix",t.projectionMatrix),f.logarithmicDepthBuffer&&T.setValue(d,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),N!==t&&(N=t,g=!0,y=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var S=T.map.cameraPosition;void 0!==S&&S.setValue(d,$.setFromMatrixPosition(t.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&T.setValue(d,"viewMatrix",t.matrixWorldInverse)}if(r.skinning){T.setOptional(d,i,"bindMatrix"),T.setOptional(d,i,"bindMatrixInverse");var E=i.skeleton;if(E){var w=E.bones;if(f.floatVertexTextures){if(void 0===E.boneTexture){var k=Math.sqrt(4*w.length);k=wi.ceilPowerOfTwo(k),k=Math.max(k,4);var x=new Float32Array(k*k*4);x.set(E.boneMatrices);var M=new Qi(x,k,k,Rr,kr);M.needsUpdate=!0,E.boneMatrices=x,E.boneTexture=M,E.boneTextureSize=k}T.setValue(d,"boneTexture",E.boneTexture,b),T.setValue(d,"boneTextureSize",E.boneTextureSize)}else T.setOptional(d,E,"boneMatrices")}}return g&&(T.setValue(d,"toneMappingExposure",I.toneMappingExposure),T.setValue(d,"toneMappingWhitePoint",I.toneMappingWhitePoint),r.lights&&(c=y,(u=C).ambientLightColor.needsUpdate=c,u.lightProbe.needsUpdate=c,u.directionalLights.needsUpdate=c,u.pointLights.needsUpdate=c,u.spotLights.needsUpdate=c,u.rectAreaLights.needsUpdate=c,u.hemisphereLights.needsUpdate=c),e&&r.fog&&function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}(C,e),r.isMeshBasicMaterial?mt(C,r):r.isMeshLambertMaterial?(mt(C,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(C,r)):r.isMeshPhongMaterial?(mt(C,r),r.isMeshToonMaterial?function(t,e){gt(t,e),e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(C,r):gt(C,r)):r.isMeshStandardMaterial?(mt(C,r),r.isMeshPhysicalMaterial?function(t,e){vt(t,e),t.reflectivity.value=e.reflectivity,t.clearCoat.value=e.clearCoat,t.clearCoatRoughness.value=e.clearCoatRoughness}(C,r):vt(C,r)):r.isMeshMatcapMaterial?(mt(C,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===fe&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===fe&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(C,r)):r.isMeshDepthMaterial?(mt(C,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(C,r)):r.isMeshDistanceMaterial?(mt(C,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(C,r)):r.isMeshNormalMaterial?(mt(C,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===fe&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===fe&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(C,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(C,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(C,r)):r.isPointsMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*V,t.scale.value=.5*H,t.map.value=e.map,null!==e.map&&(!0===e.map.matrixAutoUpdate&&e.map.updateMatrix(),t.uvTransform.value.copy(e.map.matrix))}(C,r):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,t.map.value=e.map,null!==e.map&&(!0===e.map.matrixAutoUpdate&&e.map.updateMatrix(),t.uvTransform.value.copy(e.map.matrix))}(C,r):r.isShadowMaterial&&(C.color.value.copy(r.color),C.opacity.value=r.opacity),void 0!==C.ltc_1&&(C.ltc_1.value=pn.LTC_1),void 0!==C.ltc_2&&(C.ltc_2.value=pn.LTC_2),Ao.upload(d,n.uniformsList,C,b)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ao.upload(d,n.uniformsList,C,b),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&T.setValue(d,"center",i.center),T.setValue(d,"modelViewMatrix",i.modelViewMatrix),T.setValue(d,"normalMatrix",i.normalMatrix),T.setValue(d,"modelMatrix",i.matrixWorld),A}function mt(t,e){var r;t.opacity.value=e.opacity,e.color&&t.diffuse.value.copy(e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),e.envMap&&(t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio,t.maxMipLevel.value=v.get(e.envMap).__maxMipLevel),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?r=e.map:e.specularMap?r=e.specularMap:e.displacementMap?r=e.displacementMap:e.normalMap?r=e.normalMap:e.bumpMap?r=e.bumpMap:e.roughnessMap?r=e.roughnessMap:e.metalnessMap?r=e.metalnessMap:e.alphaMap?r=e.alphaMap:e.emissiveMap&&(r=e.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}function gt(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===fe&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===fe&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function vt(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===fe&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===fe&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}ct.setAnimationLoop(function(t){it.isPresenting()||ut&&ut(t)}),"undefined"!=typeof window&&ct.setContext(window),this.setAnimationLoop=function(t){ut=t,it.setAnimationLoop(t),ct.start()},this.render=function(t,e){var r,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),e&&e.isCamera){if(!_){F.geometry=null,F.program=null,F.wireframe=!1,D=-1,N=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),it.enabled&&(e=it.getCamera(e)),(h=E.get(t,e)).init(),t.onBeforeRender(I,t,e,r||P),J.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),q.setFromMatrix(J),Q=this.localClippingEnabled,K=Z.init(this.clippingPlanes,Q,e),(c=S.get(t,e)).init(),function t(e,r,i,n){if(!1===e.visible)return;var a=e.layers.test(r.layers);if(a)if(e.isGroup)i=e.renderOrder;else if(e.isLight)h.pushLight(e),e.castShadow&&h.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||q.intersectsSprite(e)){n&&$.setFromMatrixPosition(e.matrixWorld).applyMatrix4(J);var o=T.update(e),s=e.material;s.visible&&c.push(e,o,s,i,$.z,null)}}else if(e.isImmediateRenderObject)n&&$.setFromMatrixPosition(e.matrixWorld).applyMatrix4(J),c.push(e,null,e.material,i,$.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||q.intersectsObject(e))){n&&$.setFromMatrixPosition(e.matrixWorld).applyMatrix4(J);var o=T.update(e),s=e.material;if(Array.isArray(s))for(var l=o.groups,u=0,d=l.length;u<d;u++){var p=l[u],f=s[p.materialIndex];f&&f.visible&&c.push(e,o,f,i,$.z,p)}else s.visible&&c.push(e,o,s,i,$.z,null)}var m=e.children;for(var u=0,d=m.length;u<d;u++)t(m[u],r,i,n)}(t,e,0,I.sortObjects),!0===I.sortObjects&&c.sort(),K&&Z.beginShadows();var n=h.state.shadowsArray;nt.render(n,t,e),h.setupLights(e),K&&Z.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),w.render(c,t,e,i);var a=c.opaque,o=c.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;a.length&&ht(a,t,e,s),o.length&&ht(o,t,e,s)}else a.length&&ht(a,t,e),o.length&&ht(o,t,e);t.onAfterRender(I,t,e),null!==P&&(b.updateRenderTargetMipmap(P),b.updateMultisampleRenderTarget(P)),m.buffers.depth.setTest(!0),m.buffers.depth.setMask(!0),m.buffers.color.setMask(!0),m.setPolygonOffset(!1),it.enabled&&it.submitFrame(),c=null,h=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(t){L=t},this.getRenderTarget=function(){return P},this.setRenderTarget=function(t,e,r){P=t,t&&void 0===v.get(t).__webglFramebuffer&&b.setupRenderTarget(t);var i=L,n=!1;if(t){var a=v.get(t).__webglFramebuffer;t.isWebGLRenderTargetCube?(i=a[e||0],n=!0):i=t.isWebGLMultisampleRenderTarget?v.get(t).__webglMultisampledFramebuffer:a,G.copy(t.viewport),U.copy(t.scissor),z=t.scissorTest}else G.copy(Y).multiplyScalar(V),U.copy(j).multiplyScalar(V),z=X;if(R!==i&&(d.bindFramebuffer(36160,i),R=i),m.viewport(G),m.scissor(U),m.setScissorTest(z),n){var o=v.get(t.texture);d.framebufferTexture2D(36160,36064,34069+(e||0),o.__webglTexture,r||0)}},this.readRenderTargetPixels=function(t,e,r,i,n,a){if(t&&t.isWebGLRenderTarget){var o=v.get(t).__webglFramebuffer;if(o){var s=!1;o!==R&&(d.bindFramebuffer(36160,o),s=!0);try{var l=t.texture,u=l.format,c=l.type;if(u!==Rr&&O.convert(u)!==d.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===Ar||O.convert(c)===d.getParameter(35738)||c===kr&&(f.isWebGL2||p.get("OES_texture_float")||p.get("WEBGL_color_buffer_float"))||c===xr&&(f.isWebGL2?p.get("EXT_color_buffer_float"):p.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===d.checkFramebufferStatus(36160)?e>=0&&e<=t.width-i&&r>=0&&r<=t.height-n&&d.readPixels(e,r,i,n,O.convert(u),O.convert(c),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&d.bindFramebuffer(36160,R)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,r){var i=e.image.width,n=e.image.height,a=O.convert(e.format);b.setTexture2D(e,0),d.copyTexImage2D(3553,r||0,a,t.x,t.y,i,n,0)},this.copyTextureToTexture=function(t,e,r,i){var n=e.image.width,a=e.image.height,o=O.convert(r.format),s=O.convert(r.type);b.setTexture2D(r,0),e.isDataTexture?d.texSubImage2D(3553,i||0,t.x,t.y,n,a,o,s,e.image.data):d.texSubImage2D(3553,i||0,t.x,t.y,o,s,e.image)}}function hs(t,e){this.name="",this.color=new hn(t),this.density=void 0!==e?e:25e-5}function ds(t,e,r){this.name="",this.color=new hn(t),this.near=void 0!==e?e:1,this.far=void 0!==r?r:1e3}function ps(){wn.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function fs(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function ms(t,e,r,i){this.data=t,this.itemSize=e,this.offset=r,this.normalized=!0===i}function gs(t){Zn.call(this),this.type="SpriteMaterial",this.color=new hn(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(t)}function vs(t){if(wn.call(this),this.type="Sprite",void 0===$o){$o=new Hn;var e=new fs(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);$o.setIndex([0,1,2,0,2,3]),$o.addAttribute("position",new ms(e,3,0,!1)),$o.addAttribute("uv",new ms(e,2,3,!1))}this.geometry=$o,this.material=void 0!==t?t:new gs,this.center=new ki(.5,.5)}function bs(){wn.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function ys(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),fa.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new rn,this.bindMatrixInverse=new rn}function As(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new rn)}}function Ts(){wn.call(this),this.type="Bone"}function Cs(t){Zn.call(this),this.type="LineBasicMaterial",this.color=new hn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function Ss(t,e,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),wn.call(this),this.type="Line",this.geometry=void 0!==t?t:new Hn,this.material=void 0!==e?e:new Cs({color:16777215*Math.random()})}function Es(t,e){Ss.call(this,t,e),this.type="LineSegments"}function ws(t,e){Ss.call(this,t,e),this.type="LineLoop"}function ks(t){Zn.call(this),this.type="PointsMaterial",this.color=new hn(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function xs(t,e){wn.call(this),this.type="Points",this.geometry=void 0!==t?t:new Hn,this.material=void 0!==e?e:new ks({color:16777215*Math.random()})}function Ms(t,e,r,i,n,a,o,s,l){ji.call(this,t,e,r,i,n,a,o,s,l),this.format=void 0!==o?o:Pr,this.minFilter=void 0!==a?a:vr,this.magFilter=void 0!==n?n:vr,this.generateMipmaps=!1}function Os(t,e,r,i,n,a,o,s,l,u,c,h){ji.call(this,null,a,o,s,l,u,i,n,c,h),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function Is(t,e,r,i,n,a,o,s,l){ji.call(this,t,e,r,i,n,a,o,s,l),this.needsUpdate=!0}function _s(t,e,r,i,n,a,o,s,l,u){if((u=void 0!==u?u:Nr)!==Nr&&u!==Br)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&u===Nr&&(r=Sr),void 0===r&&u===Br&&(r=_r),ji.call(this,null,i,n,a,o,s,u,r,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:fr,this.minFilter=void 0!==s?s:fr,this.flipY=!1,this.generateMipmaps=!1}function Ls(t){Hn.call(this),this.type="WireframeGeometry";var e,r,i,n,a,o,s,l,u,c,h=[],d=[0,0],p={},f=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,i=m.length;e<i;e++){var g=m[e];for(r=0;r<3;r++)s=g[f[r]],l=g[f[(r+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[u=d[0]+","+d[1]]&&(p[u]={index1:d[0],index2:d[1]})}for(u in p)o=p[u],c=t.vertices[o.index1],h.push(c.x,c.y,c.z),c=t.vertices[o.index2],h.push(c.x,c.y,c.z)}else if(t&&t.isBufferGeometry){var v,b,y,A,T,C,S;if(c=new Mi,null!==t.index){for(v=t.attributes.position,b=t.index,0===(y=t.groups).length&&(y=[{start:0,count:b.count,materialIndex:0}]),n=0,a=y.length;n<a;++n)for(e=T=(A=y[n]).start,i=T+A.count;e<i;e+=3)for(r=0;r<3;r++)s=b.getX(e+r),l=b.getX(e+(r+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[u=d[0]+","+d[1]]&&(p[u]={index1:d[0],index2:d[1]});for(u in p)o=p[u],c.fromBufferAttribute(v,o.index1),h.push(c.x,c.y,c.z),c.fromBufferAttribute(v,o.index2),h.push(c.x,c.y,c.z)}else for(e=0,i=(v=t.attributes.position).count/3;e<i;e++)for(r=0;r<3;r++)C=3*e+r,c.fromBufferAttribute(v,C),h.push(c.x,c.y,c.z),S=3*e+(r+1)%3,c.fromBufferAttribute(v,S),h.push(c.x,c.y,c.z)}this.addAttribute("position",new Bn(h,3))}function Ps(t,e,r){On.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r},this.fromBufferGeometry(new Rs(t,e,r)),this.mergeVertices()}function Rs(t,e,r){Hn.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:r};var i,n,a=[],o=[],s=[],l=[],u=new Mi,c=new Mi,h=new Mi,d=new Mi,p=new Mi;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var f=e+1;for(i=0;i<=r;i++){var m=i/r;for(n=0;n<=e;n++){var g=n/e;t(g,m,c),o.push(c.x,c.y,c.z),g-1e-5>=0?(t(g-1e-5,m,h),d.subVectors(c,h)):(t(g+1e-5,m,h),d.subVectors(h,c)),m-1e-5>=0?(t(g,m-1e-5,h),p.subVectors(c,h)):(t(g,m+1e-5,h),p.subVectors(h,c)),u.crossVectors(d,p).normalize(),s.push(u.x,u.y,u.z),l.push(g,m)}}for(i=0;i<r;i++)for(n=0;n<e;n++){var v=i*f+n,b=i*f+n+1,y=(i+1)*f+n+1,A=(i+1)*f+n;a.push(v,b,A),a.push(b,y,A)}this.setIndex(a),this.addAttribute("position",new Bn(o,3)),this.addAttribute("normal",new Bn(s,3)),this.addAttribute("uv",new Bn(l,2))}function Ds(t,e,r,i){On.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:i},this.fromBufferGeometry(new Fs(t,e,r,i)),this.mergeVertices()}function Fs(t,e,r,i){Hn.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:i},r=r||1;var n=[],a=[];function o(t,e,r,i){var n,a,o=Math.pow(2,i),l=[];for(n=0;n<=o;n++){l[n]=[];var u=t.clone().lerp(r,n/o),c=e.clone().lerp(r,n/o),h=o-n;for(a=0;a<=h;a++)l[n][a]=0===a&&n===o?u:u.clone().lerp(c,a/h)}for(n=0;n<o;n++)for(a=0;a<2*(o-n)-1;a++){var d=Math.floor(a/2);a%2==0?(s(l[n][d+1]),s(l[n+1][d]),s(l[n][d])):(s(l[n][d+1]),s(l[n+1][d+1]),s(l[n+1][d]))}}function s(t){n.push(t.x,t.y,t.z)}function l(e,r){var i=3*e;r.x=t[i+0],r.y=t[i+1],r.z=t[i+2]}function u(t,e,r,i){i<0&&1===t.x&&(a[e]=t.x-1),0===r.x&&0===r.z&&(a[e]=i/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){for(var r=new Mi,i=new Mi,n=new Mi,a=0;a<e.length;a+=3)l(e[a+0],r),l(e[a+1],i),l(e[a+2],n),o(r,i,n,t)}(i=i||0),function(t){for(var e=new Mi,r=0;r<n.length;r+=3)e.x=n[r+0],e.y=n[r+1],e.z=n[r+2],e.normalize().multiplyScalar(t),n[r+0]=e.x,n[r+1]=e.y,n[r+2]=e.z}(r),function(){for(var t=new Mi,e=0;e<n.length;e+=3){t.x=n[e+0],t.y=n[e+1],t.z=n[e+2];var r=c(t)/2/Math.PI+.5,i=(o=t,Math.atan2(-o.y,Math.sqrt(o.x*o.x+o.z*o.z))/Math.PI+.5);a.push(r,1-i)}var o;(function(){for(var t=new Mi,e=new Mi,r=new Mi,i=new Mi,o=new ki,s=new ki,l=new ki,h=0,d=0;h<n.length;h+=9,d+=6){t.set(n[h+0],n[h+1],n[h+2]),e.set(n[h+3],n[h+4],n[h+5]),r.set(n[h+6],n[h+7],n[h+8]),o.set(a[d+0],a[d+1]),s.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),i.copy(t).add(e).add(r).divideScalar(3);var p=c(i);u(o,d+0,t,p),u(s,d+2,e,p),u(l,d+4,r,p)}})(),function(){for(var t=0;t<a.length;t+=6){var e=a[t+0],r=a[t+2],i=a[t+4],n=Math.max(e,r,i),o=Math.min(e,r,i);n>.9&&o<.1&&(e<.2&&(a[t+0]+=1),r<.2&&(a[t+2]+=1),i<.2&&(a[t+4]+=1))}}()}(),this.addAttribute("position",new Bn(n,3)),this.addAttribute("normal",new Bn(n.slice(),3)),this.addAttribute("uv",new Bn(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}function Ns(t,e){On.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Bs(t,e)),this.mergeVertices()}function Bs(t,e){Fs.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Gs(t,e){On.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Us(t,e)),this.mergeVertices()}function Us(t,e){Fs.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function zs(t,e){On.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ws(t,e)),this.mergeVertices()}function Ws(t,e){var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];Fs.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Hs(t,e){On.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Vs(t,e)),this.mergeVertices()}function Vs(t,e){var r=(1+Math.sqrt(5))/2,i=1/r,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i];Fs.call(this,n,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ys(t,e,r,i,n,a){On.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:i,closed:n},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new js(t,e,r,i,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function js(t,e,r,i,n){Hn.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:i,closed:n},e=e||64,r=r||1,i=i||8,n=n||!1;var a=t.computeFrenetFrames(e,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o,s,l=new Mi,u=new Mi,c=new ki,h=new Mi,d=[],p=[],f=[],m=[];function g(n){h=t.getPointAt(n/e,h);var o=a.normals[n],c=a.binormals[n];for(s=0;s<=i;s++){var f=s/i*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);u.x=g*o.x+m*c.x,u.y=g*o.y+m*c.y,u.z=g*o.z+m*c.z,u.normalize(),p.push(u.x,u.y,u.z),l.x=h.x+r*u.x,l.y=h.y+r*u.y,l.z=h.z+r*u.z,d.push(l.x,l.y,l.z)}}!function(){for(o=0;o<e;o++)g(o);g(!1===n?e:0),function(){for(o=0;o<=e;o++)for(s=0;s<=i;s++)c.x=o/e,c.y=s/i,f.push(c.x,c.y)}(),function(){for(s=1;s<=e;s++)for(o=1;o<=i;o++){var t=(i+1)*(s-1)+(o-1),r=(i+1)*s+(o-1),n=(i+1)*s+o,a=(i+1)*(s-1)+o;m.push(t,r,a),m.push(r,n,a)}}()}(),this.setIndex(m),this.addAttribute("position",new Bn(d,3)),this.addAttribute("normal",new Bn(p,3)),this.addAttribute("uv",new Bn(f,2))}function Xs(t,e,r,i,n,a,o){On.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:i,p:n,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new qs(t,e,r,i,n,a)),this.mergeVertices()}function qs(t,e,r,i,n,a){Hn.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:i,p:n,q:a},t=t||1,e=e||.4,r=Math.floor(r)||64,i=Math.floor(i)||8,n=n||2,a=a||3;var o,s,l=[],u=[],c=[],h=[],d=new Mi,p=new Mi,f=new Mi,m=new Mi,g=new Mi,v=new Mi,b=new Mi;for(o=0;o<=r;++o){var y=o/r*n*Math.PI*2;for(x(y,n,a,t,f),x(y+.01,n,a,t,m),v.subVectors(m,f),b.addVectors(m,f),g.crossVectors(v,b),b.crossVectors(g,v),g.normalize(),b.normalize(),s=0;s<=i;++s){var A=s/i*Math.PI*2,T=-e*Math.cos(A),C=e*Math.sin(A);d.x=f.x+(T*b.x+C*g.x),d.y=f.y+(T*b.y+C*g.y),d.z=f.z+(T*b.z+C*g.z),u.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),c.push(p.x,p.y,p.z),h.push(o/r),h.push(s/i)}}for(s=1;s<=r;s++)for(o=1;o<=i;o++){var S=(i+1)*(s-1)+(o-1),E=(i+1)*s+(o-1),w=(i+1)*s+o,k=(i+1)*(s-1)+o;l.push(S,E,k),l.push(E,w,k)}function x(t,e,r,i,n){var a=Math.cos(t),o=Math.sin(t),s=r/e*t,l=Math.cos(s);n.x=i*(2+l)*.5*a,n.y=i*(2+l)*o*.5,n.z=i*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new Bn(u,3)),this.addAttribute("normal",new Bn(c,3)),this.addAttribute("uv",new Bn(h,2))}function Zs(t,e,r,i,n){On.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:i,arc:n},this.fromBufferGeometry(new Ks(t,e,r,i,n)),this.mergeVertices()}function Ks(t,e,r,i,n){Hn.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:i,arc:n},t=t||1,e=e||.4,r=Math.floor(r)||8,i=Math.floor(i)||6,n=n||2*Math.PI;var a,o,s=[],l=[],u=[],c=[],h=new Mi,d=new Mi,p=new Mi;for(a=0;a<=r;a++)for(o=0;o<=i;o++){var f=o/i*n,m=a/r*Math.PI*2;d.x=(t+e*Math.cos(m))*Math.cos(f),d.y=(t+e*Math.cos(m))*Math.sin(f),d.z=e*Math.sin(m),l.push(d.x,d.y,d.z),h.x=t*Math.cos(f),h.y=t*Math.sin(f),p.subVectors(d,h).normalize(),u.push(p.x,p.y,p.z),c.push(o/i),c.push(a/r)}for(a=1;a<=r;a++)for(o=1;o<=i;o++){var g=(i+1)*a+o-1,v=(i+1)*(a-1)+o-1,b=(i+1)*(a-1)+o,y=(i+1)*a+o;s.push(g,v,y),s.push(v,b,y)}this.setIndex(s),this.addAttribute("position",new Bn(l,3)),this.addAttribute("normal",new Bn(u,3)),this.addAttribute("uv",new Bn(c,2))}Object.assign(hs.prototype,{isFogExp2:!0,clone:function(){return new hs(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(ds.prototype,{isFog:!0,clone:function(){return new ds(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),ps.prototype=Object.assign(Object.create(wn.prototype),{constructor:ps,isScene:!0,copy:function(t,e){return wn.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=wn.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(fs.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(fs.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==t?t.length/this.stride:0,this.array=t,this},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var i=0,n=this.stride;i<n;i++)this.array[t+i]=e.array[r+i];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),Object.defineProperties(ms.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(ms.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=i,this},setXYZW:function(t,e,r,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=i,this.data.array[t+3]=n,this}}),gs.prototype=Object.create(Zn.prototype),gs.prototype.constructor=gs,gs.prototype.isSpriteMaterial=!0,gs.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this},vs.prototype=Object.assign(Object.create(wn.prototype),{constructor:vs,isSprite:!0,raycast:function(){var t=new Mi,e=new Mi,r=new Mi,i=new ki,n=new ki,a=new rn,o=new Mi,s=new Mi,l=new Mi,u=new ki,c=new ki,h=new ki;function d(t,e,r,o,s,l){i.subVectors(t,r).addScalar(.5).multiply(o),void 0!==s?(n.x=l*i.x-s*i.y,n.y=s*i.x+l*i.y):n.copy(i),t.copy(e),t.x+=n.x,t.y+=n.y,t.applyMatrix4(a)}return function(i,n){e.setFromMatrixScale(this.matrixWorld),a.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),r.setFromMatrixPosition(this.modelViewMatrix);var p,f,m=this.material.rotation;0!==m&&(f=Math.cos(m),p=Math.sin(m));var g=this.center;d(o.set(-.5,-.5,0),r,g,e,p,f),d(s.set(.5,-.5,0),r,g,e,p,f),d(l.set(.5,.5,0),r,g,e,p,f),u.set(0,0),c.set(1,0),h.set(1,1);var v=i.ray.intersectTriangle(o,s,l,!1,t);if(null!==v||(d(s.set(-.5,.5,0),r,g,e,p,f),c.set(0,1),null!==(v=i.ray.intersectTriangle(o,l,s,!1,t)))){var b=i.ray.origin.distanceTo(t);b<i.near||b>i.far||n.push({distance:b,point:t.clone(),uv:da.getUV(t,o,s,l,u,c,h,new ki),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return wn.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}}),bs.prototype=Object.assign(Object.create(wn.prototype),{constructor:bs,isLOD:!0,copy:function(t){wn.prototype.copy.call(this,t,!1);for(var e=t.levels,r=0,i=e.length;r<i;r++){var n=e[r];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var r=this.levels,i=0;i<r.length&&!(e<r[i].distance);i++);return r.splice(i,0,{distance:e,object:t}),this.add(t),this},getObjectForDistance:function(t){for(var e=this.levels,r=1,i=e.length;r<i&&!(t<e[r].distance);r++);return e[r-1].object},raycast:(ts=new Mi,function(t,e){ts.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(ts);this.getObjectForDistance(r).raycast(t,e)}),update:function(){var t=new Mi,e=new Mi;return function(r){var i=this.levels;if(i.length>1){t.setFromMatrixPosition(r.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var n=t.distanceTo(e);i[0].object.visible=!0;for(var a=1,o=i.length;a<o&&n>=i[a].distance;a++)i[a-1].object.visible=!1,i[a].object.visible=!0;for(;a<o;a++)i[a].object.visible=!1}}}(),toJSON:function(t){var e=wn.prototype.toJSON.call(this,t);e.object.levels=[];for(var r=this.levels,i=0,n=r.length;i<n;i++){var a=r[i];e.object.levels.push({object:a.object.uuid,distance:a.distance})}return e}}),ys.prototype=Object.assign(Object.create(fa.prototype),{constructor:ys,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new Xi,e=this.geometry.attributes.skinWeight,r=0,i=e.count;r<i;r++){t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.w=e.getW(r);var n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(r,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){fa.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(As.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new rn;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:(es=new rn,rs=new rn,function(){for(var t=this.bones,e=this.boneInverses,r=this.boneMatrices,i=this.boneTexture,n=0,a=t.length;n<a;n++){var o=t[n]?t[n].matrixWorld:rs;es.multiplyMatrices(o,e[n]),es.toArray(r,16*n)}void 0!==i&&(i.needsUpdate=!0)}),clone:function(){return new As(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var i=this.bones[e];if(i.name===t)return i}}}),Ts.prototype=Object.assign(Object.create(wn.prototype),{constructor:Ts,isBone:!0}),Cs.prototype=Object.create(Zn.prototype),Cs.prototype.constructor=Cs,Cs.prototype.isLineBasicMaterial=!0,Cs.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},Ss.prototype=Object.assign(Object.create(wn.prototype),{constructor:Ss,isLine:!0,computeLineDistances:(is=new Mi,ns=new Mi,function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,r=[0],i=1,n=e.count;i<n;i++)is.fromBufferAttribute(e,i-1),ns.fromBufferAttribute(e,i),r[i]=r[i-1],r[i]+=is.distanceTo(ns);t.addAttribute("lineDistance",new Bn(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var a=t.vertices;for((r=t.lineDistances)[0]=0,i=1,n=a.length;i<n;i++)r[i]=r[i-1],r[i]+=a[i-1].distanceTo(a[i])}return this}),raycast:function(){var t=new rn,e=new ha,r=new $i;return function(i,n){var a=i.linePrecision,o=this.geometry,s=this.matrixWorld;if(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=a,!1!==i.ray.intersectsSphere(r)){t.getInverse(s),e.copy(i.ray).applyMatrix4(t);var l=a/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,c=new Mi,h=new Mi,d=new Mi,p=new Mi,f=this&&this.isLineSegments?2:1;if(o.isBufferGeometry){var m=o.index,g=o.attributes.position.array;if(null!==m)for(var v=m.array,b=0,y=v.length-1;b<y;b+=f){var A=v[b],T=v[b+1];if(c.fromArray(g,3*A),h.fromArray(g,3*T),!(e.distanceSqToSegment(c,h,p,d)>u))p.applyMatrix4(this.matrixWorld),(E=i.ray.origin.distanceTo(p))<i.near||E>i.far||n.push({distance:E,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}else for(b=0,y=g.length/3-1;b<y;b+=f){if(c.fromArray(g,3*b),h.fromArray(g,3*b+3),!(e.distanceSqToSegment(c,h,p,d)>u))p.applyMatrix4(this.matrixWorld),(E=i.ray.origin.distanceTo(p))<i.near||E>i.far||n.push({distance:E,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else if(o.isGeometry){var C=o.vertices,S=C.length;for(b=0;b<S-1;b+=f){var E;if(!(e.distanceSqToSegment(C[b],C[b+1],p,d)>u))p.applyMatrix4(this.matrixWorld),(E=i.ray.origin.distanceTo(p))<i.near||E>i.far||n.push({distance:E,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Es.prototype=Object.assign(Object.create(Ss.prototype),{constructor:Es,isLineSegments:!0,computeLineDistances:function(){var t=new Mi,e=new Mi;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var i=r.attributes.position,n=[],a=0,o=i.count;a<o;a+=2)t.fromBufferAttribute(i,a),e.fromBufferAttribute(i,a+1),n[a]=0===a?0:n[a-1],n[a+1]=n[a]+t.distanceTo(e);r.addAttribute("lineDistance",new Bn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var s=r.vertices;for(n=r.lineDistances,a=0,o=s.length;a<o;a+=2)t.copy(s[a]),e.copy(s[a+1]),n[a]=0===a?0:n[a-1],n[a+1]=n[a]+t.distanceTo(e)}return this}}()}),ws.prototype=Object.assign(Object.create(Ss.prototype),{constructor:ws,isLineLoop:!0}),ks.prototype=Object.create(Zn.prototype),ks.prototype.constructor=ks,ks.prototype.isPointsMaterial=!0,ks.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this},xs.prototype=Object.assign(Object.create(wn.prototype),{constructor:xs,isPoints:!0,raycast:function(){var t=new rn,e=new ha,r=new $i;return function(i,n){var a=this,o=this.geometry,s=this.matrixWorld,l=i.params.Points.threshold;if(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=l,!1!==i.ray.intersectsSphere(r)){t.getInverse(s),e.copy(i.ray).applyMatrix4(t);var u=l/((this.scale.x+this.scale.y+this.scale.z)/3),c=u*u,h=new Mi,d=new Mi;if(o.isBufferGeometry){var p=o.index,f=o.attributes.position.array;if(null!==p)for(var m=p.array,g=0,v=m.length;g<v;g++){var b=m[g];h.fromArray(f,3*b),T(h,b)}else{g=0;for(var y=f.length/3;g<y;g++)h.fromArray(f,3*g),T(h,g)}}else{var A=o.vertices;for(g=0,y=A.length;g<y;g++)T(A[g],g)}}function T(t,r){var o=e.distanceSqToPoint(t);if(o<c){e.closestPointToPoint(t,d),d.applyMatrix4(s);var l=i.ray.origin.distanceTo(d);if(l<i.near||l>i.far)return;n.push({distance:l,distanceToRay:Math.sqrt(o),point:d.clone(),index:r,face:null,object:a})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ms.prototype=Object.assign(Object.create(ji.prototype),{constructor:Ms,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Os.prototype=Object.create(ji.prototype),Os.prototype.constructor=Os,Os.prototype.isCompressedTexture=!0,Is.prototype=Object.create(ji.prototype),Is.prototype.constructor=Is,Is.prototype.isCanvasTexture=!0,_s.prototype=Object.create(ji.prototype),_s.prototype.constructor=_s,_s.prototype.isDepthTexture=!0,Ls.prototype=Object.create(Hn.prototype),Ls.prototype.constructor=Ls,Ps.prototype=Object.create(On.prototype),Ps.prototype.constructor=Ps,Rs.prototype=Object.create(Hn.prototype),Rs.prototype.constructor=Rs,Ds.prototype=Object.create(On.prototype),Ds.prototype.constructor=Ds,Fs.prototype=Object.create(Hn.prototype),Fs.prototype.constructor=Fs,Ns.prototype=Object.create(On.prototype),Ns.prototype.constructor=Ns,Bs.prototype=Object.create(Fs.prototype),Bs.prototype.constructor=Bs,Gs.prototype=Object.create(On.prototype),Gs.prototype.constructor=Gs,Us.prototype=Object.create(Fs.prototype),Us.prototype.constructor=Us,zs.prototype=Object.create(On.prototype),zs.prototype.constructor=zs,Ws.prototype=Object.create(Fs.prototype),Ws.prototype.constructor=Ws,Hs.prototype=Object.create(On.prototype),Hs.prototype.constructor=Hs,Vs.prototype=Object.create(Fs.prototype),Vs.prototype.constructor=Vs,Ys.prototype=Object.create(On.prototype),Ys.prototype.constructor=Ys,js.prototype=Object.create(Hn.prototype),js.prototype.constructor=js,js.prototype.toJSON=function(){var t=Hn.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},Xs.prototype=Object.create(On.prototype),Xs.prototype.constructor=Xs,qs.prototype=Object.create(Hn.prototype),qs.prototype.constructor=qs,Zs.prototype=Object.create(On.prototype),Zs.prototype.constructor=Zs,Ks.prototype=Object.create(Hn.prototype),Ks.prototype.constructor=Ks;var Qs=function(t,e,r){r=r||2;var i,n,a,o,s,l,u,c=e&&e.length,h=c?e[0]*r:t.length,d=Js(t,0,h,r,!0),p=[];if(!d)return p;if(c&&(d=function(t,e,r,i){var n,a,o,s,l,u=[];for(n=0,a=e.length;n<a;n++)o=e[n]*i,s=n<a-1?e[n+1]*i:t.length,(l=Js(t,o,s,i,!1))===l.next&&(l.steiner=!0),u.push(ll(l));for(u.sort(al),n=0;n<u.length;n++)ol(u[n],r),r=$s(r,r.next);return r}(t,e,d,r)),t.length>80*r){i=a=t[0],n=o=t[1];for(var f=r;f<h;f+=r)(s=t[f])<i&&(i=s),(l=t[f+1])<n&&(n=l),s>a&&(a=s),l>o&&(o=l);u=0!==(u=Math.max(a-i,o-n))?1/u:0}return tl(d,p,r,i,n,u),p};function Js(t,e,r,i,n){var a,o;if(n===function(t,e,r,i){for(var n=0,a=e,o=r-i;a<r;a+=i)n+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return n}(t,e,r,i)>0)for(a=e;a<r;a+=i)o=gl(a,t[a],t[a+1],o);else for(a=r-i;a>=e;a-=i)o=gl(a,t[a],t[a+1],o);return o&&dl(o,o.next)&&(vl(o),o=o.next),o}function $s(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!dl(i,i.next)&&0!==hl(i.prev,i,i.next))i=i.next;else{if(vl(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function tl(t,e,r,i,n,a,o){if(t){!o&&a&&function(t,e,r,i){var n=t;do{null===n.z&&(n.z=sl(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,r,i,n,a,o,s,l,u=1;do{for(r=t,t=null,a=null,o=0;r;){for(o++,i=r,s=0,e=0;e<u&&(s++,i=i.nextZ);e++);for(l=u;s>0||l>0&&i;)0!==s&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,l--),a?a.nextZ=n:t=n,n.prevZ=a,a=n;r=i}a.nextZ=null,u*=2}while(o>1)}(n)}(t,i,n,a);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,a?rl(t,i,n,a):el(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),vl(t),t=l.next,u=l.next;else if((t=l)===u){o?1===o?tl(t=il(t,e,r),e,r,i,n,a,2):2===o&&nl(t,e,r,i,n,a):tl($s(t),e,r,i,n,a,1);break}}}function el(t){var e=t.prev,r=t,i=t.next;if(hl(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(ul(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&hl(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function rl(t,e,r,i){var n=t.prev,a=t,o=t.next;if(hl(n,a,o)>=0)return!1;for(var s=n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,l=n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,u=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,c=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y,h=sl(s,l,e,r,i),d=sl(u,c,e,r,i),p=t.nextZ;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&ul(n.x,n.y,a.x,a.y,o.x,o.y,p.x,p.y)&&hl(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&ul(n.x,n.y,a.x,a.y,o.x,o.y,p.x,p.y)&&hl(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function il(t,e,r){var i=t;do{var n=i.prev,a=i.next.next;!dl(n,a)&&pl(n,i,i.next,a)&&fl(n,a)&&fl(a,n)&&(e.push(n.i/r),e.push(i.i/r),e.push(a.i/r),vl(i),vl(i.next),i=t=a),i=i.next}while(i!==t);return i}function nl(t,e,r,i,n,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&cl(o,s)){var l=ml(o,s);return o=$s(o,o.next),l=$s(l,l.next),tl(o,e,r,i,n,a),void tl(l,e,r,i,n,a)}s=s.next}o=o.next}while(o!==t)}function al(t,e){return t.x-e.x}function ol(t,e){if(e=function(t,e){var r,i=e,n=t.x,a=t.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>o){if(o=s,s===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===o)return r.prev;var l,u=r,c=r.x,h=r.y,d=1/0;i=r.next;for(;i!==u;)n>=i.x&&i.x>=c&&n!==i.x&&ul(a<h?n:o,a,c,h,a<h?o:n,a,i.x,i.y)&&((l=Math.abs(a-i.y)/(n-i.x))<d||l===d&&i.x>r.x)&&fl(i,t)&&(r=i,d=l),i=i.next;return r}(t,e)){var r=ml(e,t);$s(r,r.next)}}function sl(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ll(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function ul(t,e,r,i,n,a,o,s){return(n-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(r-o)*(e-s)>=0&&(r-o)*(a-s)-(n-o)*(i-s)>=0}function cl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&pl(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&fl(t,e)&&fl(e,t)&&function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,a=(t.y+e.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)}function hl(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function dl(t,e){return t.x===e.x&&t.y===e.y}function pl(t,e,r,i){return!!(dl(t,e)&&dl(r,i)||dl(t,i)&&dl(r,e))||hl(t,e,r)>0!=hl(t,e,i)>0&&hl(r,i,t)>0!=hl(r,i,e)>0}function fl(t,e){return hl(t.prev,t,t.next)<0?hl(t,e,t.next)>=0&&hl(t,t.prev,e)>=0:hl(t,e,t.prev)<0||hl(t,t.next,e)<0}function ml(t,e){var r=new bl(t.i,t.x,t.y),i=new bl(e.i,e.x,e.y),n=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function gl(t,e,r,i){var n=new bl(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function vl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bl(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var yl={area:function(t){for(var e=t.length,r=0,i=e-1,n=0;n<e;i=n++)r+=t[i].x*t[n].y-t[n].x*t[i].y;return.5*r},isClockWise:function(t){return yl.area(t)<0},triangulateShape:function(t,e){var r=[],i=[],n=[];Al(t),Tl(r,t);var a=t.length;e.forEach(Al);for(var o=0;o<e.length;o++)i.push(a),a+=e[o].length,Tl(r,e[o]);var s=Qs(r,i);for(o=0;o<s.length;o+=3)n.push(s.slice(o,o+3));return n}};function Al(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Tl(t,e){for(var r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}function Cl(t,e){On.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Sl(t,e)),this.mergeVertices()}function Sl(t,e){Hn.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var r=this,i=[],n=[],a=0,o=t.length;a<o;a++){s(t[a])}function s(t){var a=[],o=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:100,u=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:c-2,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3,f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:El;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);var g,v,b,y,A,T,C,S,E=!1;f&&(g=f.getSpacedPoints(s),E=!0,u=!1,v=f.computeFrenetFrames(s,!1),b=new Mi,y=new Mi,A=new Mi),u||(p=0,c=0,h=0,d=0);var w=t.extractPoints(o),k=w.shape,x=w.holes;if(!yl.isClockWise(k))for(k=k.reverse(),C=0,S=x.length;C<S;C++)T=x[C],yl.isClockWise(T)&&(x[C]=T.reverse());var M=yl.triangulateShape(k,x),O=k;for(C=0,S=x.length;C<S;C++)T=x[C],k=k.concat(T);function I(t,e,r){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}var _,L,P,R,D,F,N=k.length,B=M.length;function G(t,e,r){var i,n,a,o=t.x-e.x,s=t.y-e.y,l=r.x-t.x,u=r.y-t.y,c=o*o+s*s,h=o*u-s*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(c),p=Math.sqrt(l*l+u*u),f=e.x-s/d,m=e.y+o/d,g=((r.x-u/p-f)*u-(r.y+l/p-m)*l)/(o*u-s*l),v=(i=f+o*g-t.x)*i+(n=m+s*g-t.y)*n;if(v<=2)return new ki(i,n);a=Math.sqrt(v/2)}else{var b=!1;o>Number.EPSILON?l>Number.EPSILON&&(b=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(b=!0):Math.sign(s)===Math.sign(u)&&(b=!0),b?(i=-s,n=o,a=Math.sqrt(c)):(i=o,n=s,a=Math.sqrt(c/2))}return new ki(i/a,n/a)}for(var U=[],z=0,W=O.length,H=W-1,V=z+1;z<W;z++,H++,V++)H===W&&(H=0),V===W&&(V=0),U[z]=G(O[z],O[H],O[V]);var Y,j,X=[],q=U.concat();for(C=0,S=x.length;C<S;C++){for(T=x[C],Y=[],z=0,H=(W=T.length)-1,V=z+1;z<W;z++,H++,V++)H===W&&(H=0),V===W&&(V=0),Y[z]=G(T[z],T[H],T[V]);X.push(Y),q=q.concat(Y)}for(_=0;_<p;_++){for(P=_/p,R=c*Math.cos(P*Math.PI/2),L=h*Math.sin(P*Math.PI/2)+d,z=0,W=O.length;z<W;z++)K((D=I(O[z],U[z],L)).x,D.y,-R);for(C=0,S=x.length;C<S;C++)for(T=x[C],Y=X[C],z=0,W=T.length;z<W;z++)K((D=I(T[z],Y[z],L)).x,D.y,-R)}for(L=h+d,z=0;z<N;z++)D=u?I(k[z],q[z],L):k[z],E?(y.copy(v.normals[0]).multiplyScalar(D.x),b.copy(v.binormals[0]).multiplyScalar(D.y),A.copy(g[0]).add(y).add(b),K(A.x,A.y,A.z)):K(D.x,D.y,0);for(j=1;j<=s;j++)for(z=0;z<N;z++)D=u?I(k[z],q[z],L):k[z],E?(y.copy(v.normals[j]).multiplyScalar(D.x),b.copy(v.binormals[j]).multiplyScalar(D.y),A.copy(g[j]).add(y).add(b),K(A.x,A.y,A.z)):K(D.x,D.y,l/s*j);for(_=p-1;_>=0;_--){for(P=_/p,R=c*Math.cos(P*Math.PI/2),L=h*Math.sin(P*Math.PI/2)+d,z=0,W=O.length;z<W;z++)K((D=I(O[z],U[z],L)).x,D.y,l+R);for(C=0,S=x.length;C<S;C++)for(T=x[C],Y=X[C],z=0,W=T.length;z<W;z++)D=I(T[z],Y[z],L),E?K(D.x,D.y+g[s-1].y,g[s-1].x+R):K(D.x,D.y,l+R)}function Z(t,e){var r,i;for(z=t.length;--z>=0;){r=z,(i=z-1)<0&&(i=t.length-1);var n=0,a=s+2*p;for(n=0;n<a;n++){var o=N*n,l=N*(n+1);J(e+r+o,e+i+o,e+i+l,e+r+l)}}}function K(t,e,r){a.push(t),a.push(e),a.push(r)}function Q(t,e,n){$(t),$(e),$(n);var a=i.length/3,o=m.generateTopUV(r,i,a-3,a-2,a-1);tt(o[0]),tt(o[1]),tt(o[2])}function J(t,e,n,a){$(t),$(e),$(a),$(e),$(n),$(a);var o=i.length/3,s=m.generateSideWallUV(r,i,o-6,o-3,o-2,o-1);tt(s[0]),tt(s[1]),tt(s[3]),tt(s[1]),tt(s[2]),tt(s[3])}function $(t){i.push(a[3*t+0]),i.push(a[3*t+1]),i.push(a[3*t+2])}function tt(t){n.push(t.x),n.push(t.y)}!function(){var t=i.length/3;if(u){var e=0,n=N*e;for(z=0;z<B;z++)Q((F=M[z])[2]+n,F[1]+n,F[0]+n);for(n=N*(e=s+2*p),z=0;z<B;z++)Q((F=M[z])[0]+n,F[1]+n,F[2]+n)}else{for(z=0;z<B;z++)Q((F=M[z])[2],F[1],F[0]);for(z=0;z<B;z++)Q((F=M[z])[0]+N*s,F[1]+N*s,F[2]+N*s)}r.addGroup(t,i.length/3-t,0)}(),function(){var t=i.length/3,e=0;for(Z(O,e),e+=O.length,C=0,S=x.length;C<S;C++)Z(T=x[C],e),e+=T.length;r.addGroup(t,i.length/3-t,1)}()}this.addAttribute("position",new Bn(i,3)),this.addAttribute("uv",new Bn(n,2)),this.computeVertexNormals()}Cl.prototype=Object.create(On.prototype),Cl.prototype.constructor=Cl,Cl.prototype.toJSON=function(){var t=On.prototype.toJSON.call(this);return wl(this.parameters.shapes,this.parameters.options,t)},Sl.prototype=Object.create(Hn.prototype),Sl.prototype.constructor=Sl,Sl.prototype.toJSON=function(){var t=Hn.prototype.toJSON.call(this);return wl(this.parameters.shapes,this.parameters.options,t)};var El={generateTopUV:function(t,e,r,i,n){var a=e[3*r],o=e[3*r+1],s=e[3*i],l=e[3*i+1],u=e[3*n],c=e[3*n+1];return[new ki(a,o),new ki(s,l),new ki(u,c)]},generateSideWallUV:function(t,e,r,i,n,a){var o=e[3*r],s=e[3*r+1],l=e[3*r+2],u=e[3*i],c=e[3*i+1],h=e[3*i+2],d=e[3*n],p=e[3*n+1],f=e[3*n+2],m=e[3*a],g=e[3*a+1],v=e[3*a+2];return Math.abs(s-c)<.01?[new ki(o,1-l),new ki(u,1-h),new ki(d,1-f),new ki(m,1-v)]:[new ki(s,1-l),new ki(c,1-h),new ki(p,1-f),new ki(g,1-v)]}};function wl(t,e,r){if(r.shapes=[],Array.isArray(t))for(var i=0,n=t.length;i<n;i++){var a=t[i];r.shapes.push(a.uuid)}else r.shapes.push(t.uuid);return void 0!==e.extrudePath&&(r.options.extrudePath=e.extrudePath.toJSON()),r}function kl(t,e){On.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new xl(t,e)),this.mergeVertices()}function xl(t,e){var r=(e=e||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new On;var i=r.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),Sl.call(this,i,e),this.type="TextBufferGeometry"}function Ml(t,e,r,i,n,a,o){On.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Ol(t,e,r,i,n,a,o)),this.mergeVertices()}function Ol(t,e,r,i,n,a,o){Hn.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:o},t=t||1,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var s,l,u=(a=void 0!==a?a:0)+(o=void 0!==o?o:Math.PI),c=0,h=[],d=new Mi,p=new Mi,f=[],m=[],g=[],v=[];for(l=0;l<=r;l++){var b=[],y=l/r,A=0==l?.5/e:l==r?-.5/e:0;for(s=0;s<=e;s++){var T=s/e;d.x=-t*Math.cos(i+T*n)*Math.sin(a+y*o),d.y=t*Math.cos(a+y*o),d.z=t*Math.sin(i+T*n)*Math.sin(a+y*o),m.push(d.x,d.y,d.z),p.copy(d).normalize(),g.push(p.x,p.y,p.z),v.push(T+A,1-y),b.push(c++)}h.push(b)}for(l=0;l<r;l++)for(s=0;s<e;s++){var C=h[l][s+1],S=h[l][s],E=h[l+1][s],w=h[l+1][s+1];(0!==l||a>0)&&f.push(C,S,w),(l!==r-1||u<Math.PI)&&f.push(S,E,w)}this.setIndex(f),this.addAttribute("position",new Bn(m,3)),this.addAttribute("normal",new Bn(g,3)),this.addAttribute("uv",new Bn(v,2))}function Il(t,e,r,i,n,a){On.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},this.fromBufferGeometry(new _l(t,e,r,i,n,a)),this.mergeVertices()}function _l(t,e,r,i,n,a){Hn.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},t=t||.5,e=e||1,n=void 0!==n?n:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var o,s,l,u=[],c=[],h=[],d=[],p=t,f=(e-t)/(i=void 0!==i?Math.max(1,i):1),m=new Mi,g=new ki;for(s=0;s<=i;s++){for(l=0;l<=r;l++)o=n+l/r*a,m.x=p*Math.cos(o),m.y=p*Math.sin(o),c.push(m.x,m.y,m.z),h.push(0,0,1),g.x=(m.x/e+1)/2,g.y=(m.y/e+1)/2,d.push(g.x,g.y);p+=f}for(s=0;s<i;s++){var v=s*(r+1);for(l=0;l<r;l++){var b=o=l+v,y=o+r+1,A=o+r+2,T=o+1;u.push(b,y,T),u.push(y,A,T)}}this.setIndex(u),this.addAttribute("position",new Bn(c,3)),this.addAttribute("normal",new Bn(h,3)),this.addAttribute("uv",new Bn(d,2))}function Ll(t,e,r,i){On.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:i},this.fromBufferGeometry(new Pl(t,e,r,i)),this.mergeVertices()}function Pl(t,e,r,i){Hn.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:i},e=Math.floor(e)||12,r=r||0,i=i||2*Math.PI,i=wi.clamp(i,0,2*Math.PI);var n,a,o,s=[],l=[],u=[],c=1/e,h=new Mi,d=new ki;for(a=0;a<=e;a++){var p=r+a*c*i,f=Math.sin(p),m=Math.cos(p);for(o=0;o<=t.length-1;o++)h.x=t[o].x*f,h.y=t[o].y,h.z=t[o].x*m,l.push(h.x,h.y,h.z),d.x=a/e,d.y=o/(t.length-1),u.push(d.x,d.y)}for(a=0;a<e;a++)for(o=0;o<t.length-1;o++){var g=n=o+a*t.length,v=n+t.length,b=n+t.length+1,y=n+1;s.push(g,v,y),s.push(v,b,y)}if(this.setIndex(s),this.addAttribute("position",new Bn(l,3)),this.addAttribute("uv",new Bn(u,2)),this.computeVertexNormals(),i===2*Math.PI){var A=this.attributes.normal.array,T=new Mi,C=new Mi,S=new Mi;for(n=e*t.length*3,a=0,o=0;a<t.length;a++,o+=3)T.x=A[o+0],T.y=A[o+1],T.z=A[o+2],C.x=A[n+o+0],C.y=A[n+o+1],C.z=A[n+o+2],S.addVectors(T,C).normalize(),A[o+0]=A[n+o+0]=S.x,A[o+1]=A[n+o+1]=S.y,A[o+2]=A[n+o+2]=S.z}}function Rl(t,e){On.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Dl(t,e)),this.mergeVertices()}function Dl(t,e){Hn.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],i=[],n=[],a=[],o=0,s=0;if(!1===Array.isArray(t))u(t);else for(var l=0;l<t.length;l++)u(t[l]),this.addGroup(o,s,l),o+=s,s=0;function u(t){var o,l,u,c=i.length/3,h=t.extractPoints(e),d=h.shape,p=h.holes;for(!1===yl.isClockWise(d)&&(d=d.reverse()),o=0,l=p.length;o<l;o++)u=p[o],!0===yl.isClockWise(u)&&(p[o]=u.reverse());var f=yl.triangulateShape(d,p);for(o=0,l=p.length;o<l;o++)u=p[o],d=d.concat(u);for(o=0,l=d.length;o<l;o++){var m=d[o];i.push(m.x,m.y,0),n.push(0,0,1),a.push(m.x,m.y)}for(o=0,l=f.length;o<l;o++){var g=f[o],v=g[0]+c,b=g[1]+c,y=g[2]+c;r.push(v,b,y),s+=3}}this.setIndex(r),this.addAttribute("position",new Bn(i,3)),this.addAttribute("normal",new Bn(n,3)),this.addAttribute("uv",new Bn(a,2))}function Fl(t,e){if(e.shapes=[],Array.isArray(t))for(var r=0,i=t.length;r<i;r++){var n=t[r];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}function Nl(t,e){Hn.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var r,i,n,a,o=[],s=Math.cos(wi.DEG2RAD*e),l=[0,0],u={},c=["a","b","c"];t.isBufferGeometry?(a=new On).fromBufferGeometry(t):a=t.clone(),a.mergeVertices(),a.computeFaceNormals();for(var h=a.vertices,d=a.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],g=0;g<3;g++)r=m[c[g]],i=m[c[(g+1)%3]],l[0]=Math.min(r,i),l[1]=Math.max(r,i),void 0===u[n=l[0]+","+l[1]]?u[n]={index1:l[0],index2:l[1],face1:p,face2:void 0}:u[n].face2=p;for(n in u){var v=u[n];if(void 0===v.face2||d[v.face1].normal.dot(d[v.face2].normal)<=s){var b=h[v.index1];o.push(b.x,b.y,b.z),b=h[v.index2],o.push(b.x,b.y,b.z)}}this.addAttribute("position",new Bn(o,3))}function Bl(t,e,r,i,n,a,o,s){On.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Gl(t,e,r,i,n,a,o,s)),this.mergeVertices()}function Gl(t,e,r,i,n,a,o,s){Hn.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s};var l=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,i=Math.floor(i)||8,n=Math.floor(n)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var u=[],c=[],h=[],d=[],p=0,f=[],m=r/2,g=0;function v(r){var n,a,f,v=new ki,b=new Mi,y=0,A=!0===r?t:e,T=!0===r?1:-1;for(a=p,n=1;n<=i;n++)c.push(0,m*T,0),h.push(0,T,0),d.push(.5,.5),p++;for(f=p,n=0;n<=i;n++){var C=n/i*s+o,S=Math.cos(C),E=Math.sin(C);b.x=A*E,b.y=m*T,b.z=A*S,c.push(b.x,b.y,b.z),h.push(0,T,0),v.x=.5*S+.5,v.y=.5*E*T+.5,d.push(v.x,v.y),p++}for(n=0;n<i;n++){var w=a+n,k=f+n;!0===r?u.push(k,k+1,w):u.push(k+1,k,w),y+=3}l.addGroup(g,y,!0===r?1:2),g+=y}!function(){var a,v,b=new Mi,y=new Mi,A=0,T=(e-t)/r;for(v=0;v<=n;v++){var C=[],S=v/n,E=S*(e-t)+t;for(a=0;a<=i;a++){var w=a/i,k=w*s+o,x=Math.sin(k),M=Math.cos(k);y.x=E*x,y.y=-S*r+m,y.z=E*M,c.push(y.x,y.y,y.z),b.set(x,T,M).normalize(),h.push(b.x,b.y,b.z),d.push(w,1-S),C.push(p++)}f.push(C)}for(a=0;a<i;a++)for(v=0;v<n;v++){var O=f[v][a],I=f[v+1][a],_=f[v+1][a+1],L=f[v][a+1];u.push(O,I,L),u.push(I,_,L),A+=6}l.addGroup(g,A,0),g+=A}(),!1===a&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(u),this.addAttribute("position",new Bn(c,3)),this.addAttribute("normal",new Bn(h,3)),this.addAttribute("uv",new Bn(d,2))}function Ul(t,e,r,i,n,a,o){Bl.call(this,0,t,e,r,i,n,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:o}}function zl(t,e,r,i,n,a,o){Gl.call(this,0,t,e,r,i,n,a,o),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:o}}function Wl(t,e,r,i){On.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new Hl(t,e,r,i)),this.mergeVertices()}function Hl(t,e,r,i){Hn.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:i},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var n,a,o=[],s=[],l=[],u=[],c=new Mi,h=new ki;for(s.push(0,0,0),l.push(0,0,1),u.push(.5,.5),a=0,n=3;a<=e;a++,n+=3){var d=r+a/e*i;c.x=t*Math.cos(d),c.y=t*Math.sin(d),s.push(c.x,c.y,c.z),l.push(0,0,1),h.x=(s[n]/t+1)/2,h.y=(s[n+1]/t+1)/2,u.push(h.x,h.y)}for(n=1;n<=e;n++)o.push(n,n+1,0);this.setIndex(o),this.addAttribute("position",new Bn(s,3)),this.addAttribute("normal",new Bn(l,3)),this.addAttribute("uv",new Bn(u,2))}kl.prototype=Object.create(On.prototype),kl.prototype.constructor=kl,xl.prototype=Object.create(Sl.prototype),xl.prototype.constructor=xl,Ml.prototype=Object.create(On.prototype),Ml.prototype.constructor=Ml,Ol.prototype=Object.create(Hn.prototype),Ol.prototype.constructor=Ol,Il.prototype=Object.create(On.prototype),Il.prototype.constructor=Il,_l.prototype=Object.create(Hn.prototype),_l.prototype.constructor=_l,Ll.prototype=Object.create(On.prototype),Ll.prototype.constructor=Ll,Pl.prototype=Object.create(Hn.prototype),Pl.prototype.constructor=Pl,Rl.prototype=Object.create(On.prototype),Rl.prototype.constructor=Rl,Rl.prototype.toJSON=function(){var t=On.prototype.toJSON.call(this);return Fl(this.parameters.shapes,t)},Dl.prototype=Object.create(Hn.prototype),Dl.prototype.constructor=Dl,Dl.prototype.toJSON=function(){var t=Hn.prototype.toJSON.call(this);return Fl(this.parameters.shapes,t)},Nl.prototype=Object.create(Hn.prototype),Nl.prototype.constructor=Nl,Bl.prototype=Object.create(On.prototype),Bl.prototype.constructor=Bl,Gl.prototype=Object.create(Hn.prototype),Gl.prototype.constructor=Gl,Ul.prototype=Object.create(Bl.prototype),Ul.prototype.constructor=Ul,zl.prototype=Object.create(Gl.prototype),zl.prototype.constructor=zl,Wl.prototype=Object.create(On.prototype),Wl.prototype.constructor=Wl,Hl.prototype=Object.create(Hn.prototype),Hl.prototype.constructor=Hl;var Vl=Object.freeze({WireframeGeometry:Ls,ParametricGeometry:Ps,ParametricBufferGeometry:Rs,TetrahedronGeometry:Ns,TetrahedronBufferGeometry:Bs,OctahedronGeometry:Gs,OctahedronBufferGeometry:Us,IcosahedronGeometry:zs,IcosahedronBufferGeometry:Ws,DodecahedronGeometry:Hs,DodecahedronBufferGeometry:Vs,PolyhedronGeometry:Ds,PolyhedronBufferGeometry:Fs,TubeGeometry:Ys,TubeBufferGeometry:js,TorusKnotGeometry:Xs,TorusKnotBufferGeometry:qs,TorusGeometry:Zs,TorusBufferGeometry:Ks,TextGeometry:kl,TextBufferGeometry:xl,SphereGeometry:Ml,SphereBufferGeometry:Ol,RingGeometry:Il,RingBufferGeometry:_l,PlaneGeometry:jn,PlaneBufferGeometry:Xn,LatheGeometry:Ll,LatheBufferGeometry:Pl,ShapeGeometry:Rl,ShapeBufferGeometry:Dl,ExtrudeGeometry:Cl,ExtrudeBufferGeometry:Sl,EdgesGeometry:Nl,ConeGeometry:Ul,ConeBufferGeometry:zl,CylinderGeometry:Bl,CylinderBufferGeometry:Gl,CircleGeometry:Wl,CircleBufferGeometry:Hl,BoxGeometry:Vn,BoxBufferGeometry:Yn});function Yl(t){Zn.call(this),this.type="ShadowMaterial",this.color=new hn(0),this.transparent=!0,this.setValues(t)}function jl(t){ca.call(this,t),this.type="RawShaderMaterial"}function Xl(t){Zn.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new hn(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new hn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Si,this.normalScale=new ki(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function ql(t){Xl.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function Zl(t){Zn.call(this),this.type="MeshPhongMaterial",this.color=new hn(16777215),this.specular=new hn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new hn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Si,this.normalScale=new ki(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ze,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Kl(t){Zl.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function Ql(t){Zn.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Si,this.normalScale=new ki(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Jl(t){Zn.call(this),this.type="MeshLambertMaterial",this.color=new hn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new hn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ze,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function $l(t){Zn.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new hn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Si,this.normalScale=new ki(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(t)}function tu(t){Cs.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}Yl.prototype=Object.create(Zn.prototype),Yl.prototype.constructor=Yl,Yl.prototype.isShadowMaterial=!0,Yl.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.color.copy(t.color),this},jl.prototype=Object.create(ca.prototype),jl.prototype.constructor=jl,jl.prototype.isRawShaderMaterial=!0,Xl.prototype=Object.create(Zn.prototype),Xl.prototype.constructor=Xl,Xl.prototype.isMeshStandardMaterial=!0,Xl.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},ql.prototype=Object.create(Xl.prototype),ql.prototype.constructor=ql,ql.prototype.isMeshPhysicalMaterial=!0,ql.prototype.copy=function(t){return Xl.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},Zl.prototype=Object.create(Zn.prototype),Zl.prototype.constructor=Zl,Zl.prototype.isMeshPhongMaterial=!0,Zl.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Kl.prototype=Object.create(Zl.prototype),Kl.prototype.constructor=Kl,Kl.prototype.isMeshToonMaterial=!0,Kl.prototype.copy=function(t){return Zl.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},Ql.prototype=Object.create(Zn.prototype),Ql.prototype.constructor=Ql,Ql.prototype.isMeshNormalMaterial=!0,Ql.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Jl.prototype=Object.create(Zn.prototype),Jl.prototype.constructor=Jl,Jl.prototype.isMeshLambertMaterial=!0,Jl.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},$l.prototype=Object.create(Zn.prototype),$l.prototype.constructor=$l,$l.prototype.isMeshMatcapMaterial=!0,$l.prototype.copy=function(t){return Zn.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},tu.prototype=Object.create(Cs.prototype),tu.prototype.constructor=tu,tu.prototype.isLineDashedMaterial=!0,tu.prototype.copy=function(t){return Cs.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var eu=Object.freeze({ShadowMaterial:Yl,SpriteMaterial:gs,RawShaderMaterial:jl,ShaderMaterial:ca,PointsMaterial:ks,MeshPhysicalMaterial:ql,MeshStandardMaterial:Xl,MeshPhongMaterial:Zl,MeshToonMaterial:Kl,MeshNormalMaterial:Ql,MeshLambertMaterial:Jl,MeshDepthMaterial:Ho,MeshDistanceMaterial:Vo,MeshBasicMaterial:pa,MeshMatcapMaterial:$l,LineDashedMaterial:tu,LineBasicMaterial:Cs,Material:Zn}),ru={arraySlice:function(t,e,r){return ru.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),i=0;i!==e;++i)r[i]=i;return r.sort(function(e,r){return t[e]-t[r]}),r},sortedArray:function(t,e,r){for(var i=t.length,n=new t.constructor(i),a=0,o=0;o!==i;++a)for(var s=r[a]*e,l=0;l!==e;++l)n[o++]=t[s+l];return n},flattenJSON:function(t,e,r,i){for(var n=1,a=t[0];void 0!==a&&void 0===a[i];)a=t[n++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(e.push(a.time),r.push.apply(r,o)),a=t[n++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(e.push(a.time),o.toArray(r,r.length)),a=t[n++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(e.push(a.time),r.push(o)),a=t[n++]}while(void 0!==a)}}};function iu(t,e,r,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function nu(t,e,r,i){iu.call(this,t,e,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function au(t,e,r,i){iu.call(this,t,e,r,i)}function ou(t,e,r,i){iu.call(this,t,e,r,i)}function su(t,e,r,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ru.convertArray(e,this.TimeBufferType),this.values=ru.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function lu(t,e,r){su.call(this,t,e,r)}function uu(t,e,r,i){su.call(this,t,e,r,i)}function cu(t,e,r,i){su.call(this,t,e,r,i)}function hu(t,e,r,i){iu.call(this,t,e,r,i)}function du(t,e,r,i){su.call(this,t,e,r,i)}function pu(t,e,r,i){su.call(this,t,e,r,i)}function fu(t,e,r,i){su.call(this,t,e,r,i)}function mu(t,e,r){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.uuid=wi.generateUUID(),this.duration<0&&this.resetDuration()}function gu(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return cu;case"vector":case"vector2":case"vector3":case"vector4":return fu;case"color":return uu;case"quaternion":return du;case"bool":case"boolean":return lu;case"string":return pu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var r=[],i=[];ru.flattenJSON(t.keys,r,i,"value"),t.times=r,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(iu.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,i=e[r],n=e[r-1];t:{e:{var a;r:{i:if(!(t<i)){for(var o=r+2;;){if(void 0===i){if(t<n)break i;return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,t,n)}if(r===o)break;if(n=i,t<(i=e[++r]))break e}a=e.length;break r}if(t>=n)break t;var s=e[1];t<s&&(r=2,n=s);for(o=r-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(r===o)break;if(i=n,t>=(n=e[--r-1]))break e}a=r,r=0}for(;r<a;){var l=r+a>>>1;t<e[l]?a=l:r=l+1}if(i=e[r],void 0===(n=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,n,t)}this._cachedIndex=r,this.intervalChanged_(r,n,i)}return this.interpolate_(r,n,t,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=t*i,a=0;a!==i;++a)e[a]=r[n+a];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(iu.prototype,{beforeStart_:iu.prototype.copySampleValue_,afterEnd_:iu.prototype.copySampleValue_}),nu.prototype=Object.assign(Object.create(iu.prototype),{constructor:nu,DefaultSettings_:{endingStart:ci,endingEnd:ci},intervalChanged_:function(t,e,r){var i=this.parameterPositions,n=t-2,a=t+1,o=i[n],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:n=t,o=2*e-r;break;case 2402:o=e+i[n=i.length-2]-i[n+1];break;default:n=t,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=t,s=2*r-e;break;case 2402:a=1,s=r+i[1]-i[0];break;default:a=t-1,s=e}var l=.5*(r-e),u=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(s-r),this._offsetPrev=n*u,this._offsetNext=a*u},interpolate_:function(t,e,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(r-e)/(i-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,b=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f,A=0;A!==o;++A)n[A]=g*a[u+A]+v*a[l+A]+b*a[s+A]+y*a[c+A];return n}}),au.prototype=Object.assign(Object.create(iu.prototype),{constructor:au,interpolate_:function(t,e,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,u=(r-e)/(i-e),c=1-u,h=0;h!==o;++h)n[h]=a[l+h]*c+a[s+h]*u;return n}}),ou.prototype=Object.assign(Object.create(iu.prototype),{constructor:ou,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(su,{toJSON:function(t){var e,r=t.constructor;if(void 0!==r.toJSON)e=r.toJSON(t);else{e={name:t.name,times:ru.convertArray(t.times,Array),values:ru.convertArray(t.values,Array)};var i=t.getInterpolation();i!==t.DefaultInterpolation&&(e.interpolation=i)}return e.type=t.ValueTypeName,e}}),Object.assign(su.prototype,{constructor:su,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new ou(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new au(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new nu(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,i=e.length;r!==i;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,i=e.length;r!==i;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,i=r.length,n=0,a=i-1;n!==i&&r[n]<t;)++n;for(;-1!==a&&r[a]>e;)--a;if(++a,0!==n||a!==i){n>=a&&(n=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=ru.arraySlice(r,n,a),this.values=ru.arraySlice(this.values,n*o,a*o)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,i=this.values,n=r.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var a=null,o=0;o!==n;o++){var s=r[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),t=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),t=!1;break}a=s}if(void 0!==i&&ru.isTypedArray(i)){o=0;for(var l=i.length;o!==l;++o){var u=i[o];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,u),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,r=this.getValueSize(),i=2302===this.getInterpolation(),n=1,a=t.length-1,o=1;o<a;++o){var s=!1,l=t[o];if(l!==t[o+1]&&(1!==o||l!==l[0]))if(i)s=!0;else for(var u=o*r,c=u-r,h=u+r,d=0;d!==r;++d){var p=e[u+d];if(p!==e[c+d]||p!==e[h+d]){s=!0;break}}if(s){if(o!==n){t[n]=t[o];var f=o*r,m=n*r;for(d=0;d!==r;++d)e[m+d]=e[f+d]}++n}}if(a>0){t[n]=t[a];for(f=a*r,m=n*r,d=0;d!==r;++d)e[m+d]=e[f+d];++n}return n!==t.length&&(this.times=ru.arraySlice(t,0,n),this.values=ru.arraySlice(e,0,n*r)),this},clone:function(){var t=ru.arraySlice(this.times,0),e=ru.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}),lu.prototype=Object.assign(Object.create(su.prototype),{constructor:lu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),uu.prototype=Object.assign(Object.create(su.prototype),{constructor:uu,ValueTypeName:"color"}),cu.prototype=Object.assign(Object.create(su.prototype),{constructor:cu,ValueTypeName:"number"}),hu.prototype=Object.assign(Object.create(iu.prototype),{constructor:hu,interpolate_:function(t,e,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=(r-e)/(i-e),u=s+o;s!==u;s+=4)xi.slerpFlat(n,0,a,s-o,a,s,l);return n}}),du.prototype=Object.assign(Object.create(su.prototype),{constructor:du,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new hu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),pu.prototype=Object.assign(Object.create(su.prototype),{constructor:pu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),fu.prototype=Object.assign(Object.create(su.prototype),{constructor:fu,ValueTypeName:"vector"}),Object.assign(mu,{parse:function(t){for(var e=[],r=t.tracks,i=1/(t.fps||1),n=0,a=r.length;n!==a;++n)e.push(gu(r[n]).scale(i));return new mu(t.name,t.duration,e)},toJSON:function(t){for(var e=[],r=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid},n=0,a=r.length;n!==a;++n)e.push(su.toJSON(r[n]));return i},CreateFromMorphTargetSequence:function(t,e,r,i){for(var n=e.length,a=[],o=0;o<n;o++){var s=[],l=[];s.push((o+n-1)%n,o,(o+1)%n),l.push(0,1,0);var u=ru.getKeyframeOrder(s);s=ru.sortedArray(s,1,u),l=ru.sortedArray(l,1,u),i||0!==s[0]||(s.push(n),l.push(l[0])),a.push(new cu(".morphTargetInfluences["+e[o].name+"]",s,l).scale(1/r))}return new mu(t,-1,a)},findByName:function(t,e){var r=t;if(!Array.isArray(t)){var i=t;r=i.geometry&&i.geometry.animations||i.animations}for(var n=0;n<r.length;n++)if(r[n].name===e)return r[n];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var i={},n=/^([\w-]*?)([\d]+)$/,a=0,o=t.length;a<o;a++){var s=t[a],l=s.name.match(n);if(l&&l.length>1){var u=i[h=l[1]];u||(i[h]=u=[]),u.push(s)}}var c=[];for(var h in i)c.push(mu.CreateFromMorphTargetSequence(h,i[h],e,r));return c},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(t,e,r,i,n){if(0!==r.length){var a=[],o=[];ru.flattenJSON(r,a,o,i),0!==a.length&&n.push(new t(e,a,o))}},i=[],n=t.name||"default",a=t.length||-1,o=t.fps||30,s=t.hierarchy||[],l=0;l<s.length;l++){var u=s[l].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var c={},h=0;h<u.length;h++)if(u[h].morphTargets)for(var d=0;d<u[h].morphTargets.length;d++)c[u[h].morphTargets[d]]=-1;for(var p in c){var f=[],m=[];for(d=0;d!==u[h].morphTargets.length;++d){var g=u[h];f.push(g.time),m.push(g.morphTarget===p?1:0)}i.push(new cu(".morphTargetInfluence["+p+"]",f,m))}a=c.length*(o||1)}else{var v=".bones["+e[l].name+"]";r(fu,v+".position",u,"pos",i),r(du,v+".quaternion",u,"rot",i),r(fu,v+".scale",u,"scl",i)}}return 0===i.length?null:new mu(n,a,i)}}),Object.assign(mu.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new mu(this.name,this.duration,t)}});var vu={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function bu(t,e,r){var i=this,n=!1,a=0,o=0,s=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){o++,!1===n&&void 0!==i.onStart&&i.onStart(t,a,o),n=!0},this.itemEnd=function(t){a++,void 0!==i.onProgress&&i.onProgress(t,a,o),a===o&&(n=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this}}var yu=new bu,Au={};function Tu(t){this.manager=void 0!==t?t:yu}function Cu(t){this.manager=void 0!==t?t:yu,this._parser=null}function Su(t){this.manager=void 0!==t?t:yu}function Eu(t){this.manager=void 0!==t?t:yu}function wu(t){this.manager=void 0!==t?t:yu}function ku(){this.type="Curve",this.arcLengthDivisions=200}function xu(t,e,r,i,n,a,o,s){ku.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=r||1,this.yRadius=i||1,this.aStartAngle=n||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function Mu(t,e,r,i,n,a){xu.call(this,t,e,r,r,i,n,a),this.type="ArcCurve"}function Ou(){var t=0,e=0,r=0,i=0;function n(n,a,o,s){t=n,e=o,r=-3*n+3*a-2*o-s,i=2*n-2*a+o+s}return{initCatmullRom:function(t,e,r,i,a){n(e,r,a*(r-t),a*(i-e))},initNonuniformCatmullRom:function(t,e,r,i,a,o,s){var l=(e-t)/a-(r-t)/(a+o)+(r-e)/o,u=(r-e)/o-(i-e)/(o+s)+(i-r)/s;n(e,r,l*=o,u*=o)},calc:function(n){var a=n*n;return t+e*n+r*a+i*(a*n)}}}Object.assign(Tu.prototype,{load:function(t,e,r,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,a=vu.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;if(void 0===Au[t]){var o=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],l=!!o[2],u=o[3];u=decodeURIComponent(u),l&&(u=atob(u));try{var c,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(u.length),p=0;p<u.length;p++)d[p]=u.charCodeAt(p);c="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var f=new DOMParser;c=f.parseFromString(u,s);break;case"json":c=JSON.parse(u);break;default:c=u}setTimeout(function(){e&&e(c),n.manager.itemEnd(t)},0)}catch(e){setTimeout(function(){i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)},0)}}else{Au[t]=[],Au[t].push({onLoad:e,onProgress:r,onError:i});var m=new XMLHttpRequest;for(var g in m.open("GET",t,!0),m.addEventListener("load",function(e){var r=this.response;vu.add(t,r);var i=Au[t];if(delete Au[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var a=0,o=i.length;a<o;a++){(s=i[a]).onLoad&&s.onLoad(r)}n.manager.itemEnd(t)}else{for(a=0,o=i.length;a<o;a++){var s;(s=i[a]).onError&&s.onError(e)}n.manager.itemError(t),n.manager.itemEnd(t)}},!1),m.addEventListener("progress",function(e){for(var r=Au[t],i=0,n=r.length;i<n;i++){var a=r[i];a.onProgress&&a.onProgress(e)}},!1),m.addEventListener("error",function(e){var r=Au[t];delete Au[t];for(var i=0,a=r.length;i<a;i++){var o=r[i];o.onError&&o.onError(e)}n.manager.itemError(t),n.manager.itemEnd(t)},!1),m.addEventListener("abort",function(e){var r=Au[t];delete Au[t];for(var i=0,a=r.length;i<a;i++){var o=r[i];o.onError&&o.onError(e)}n.manager.itemError(t),n.manager.itemEnd(t)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return n.manager.itemStart(t),m}Au[t].push({onLoad:e,onProgress:r,onError:i})},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Object.assign(function(t){this.manager=void 0!==t?t:yu}.prototype,{load:function(t,e,r,i){var n=this,a=new Tu(n.manager);a.setPath(n.path),a.load(t,function(t){e(n.parse(JSON.parse(t)))},r,i)},parse:function(t){for(var e=[],r=0;r<t.length;r++){var i=mu.parse(t[r]);e.push(i)}return e},setPath:function(t){return this.path=t,this}}),Object.assign(function(t){this.manager=void 0!==t?t:yu,this._parser=null}.prototype,{load:function(t,e,r,i){var n=this,a=[],o=new Os;o.image=a;var s=new Tu(this.manager);function l(l){s.load(t[l],function(t){var r=n._parser(t,!0);a[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(u+=1)&&(1===r.mipmapCount&&(o.minFilter=vr),o.format=r.format,o.needsUpdate=!0,e&&e(o))},r,i)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(t))for(var u=0,c=0,h=t.length;c<h;++c)l(c);else s.load(t,function(t){var r=n._parser(t,!0);if(r.isCubemap)for(var i=r.mipmaps.length/r.mipmapCount,s=0;s<i;s++){a[s]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)a[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+l]),a[s].format=r.format,a[s].width=r.width,a[s].height=r.height}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=vr),o.format=r.format,o.needsUpdate=!0,e&&e(o)},r,i);return o},setPath:function(t){return this.path=t,this}}),Object.assign(Cu.prototype,{load:function(t,e,r,i){var n=this,a=new Qi,o=new Tu(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(t,function(t){var r=n._parser(t);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:dr,a.wrapT=void 0!==r.wrapT?r.wrapT:dr,a.magFilter=void 0!==r.magFilter?r.magFilter:vr,a.minFilter=void 0!==r.minFilter?r.minFilter:yr,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps),1===r.mipmapCount&&(a.minFilter=vr),a.needsUpdate=!0,e&&e(a,r))},r,i),a},setPath:function(t){return this.path=t,this}}),Object.assign(Su.prototype,{crossOrigin:"anonymous",load:function(t,e,r,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,a=vu.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),vu.add(t,this),e&&e(this),n.manager.itemEnd(t)}function l(e){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),n.manager.itemStart(t),o.src=t,o},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Eu.prototype,{crossOrigin:"anonymous",load:function(t,e,r,i){var n=new ka,a=new Su(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(r){a.load(t[r],function(t){n.images[r]=t,6===++o&&(n.needsUpdate=!0,e&&e(n))},void 0,i)}for(var l=0;l<t.length;++l)s(l);return n},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(wu.prototype,{crossOrigin:"anonymous",load:function(t,e,r,i){var n=new ji,a=new Su(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(r){n.image=r;var i=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);n.format=i?Pr:Rr,n.needsUpdate=!0,void 0!==e&&e(n)},r,i),n},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(ku.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var r=this.getUtoTmapping(t);return this.getPoint(r,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r,i=[],n=this.getPoint(0),a=0;for(i.push(0),r=1;r<=t;r++)a+=(e=this.getPoint(r/t)).distanceTo(n),i.push(a),n=e;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var r,i=this.getLengths(),n=0,a=i.length;r=e||t*i[a-1];for(var o,s=0,l=a-1;s<=l;)if((o=i[n=Math.floor(s+(l-s)/2)]-r)<0)s=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(i[n=l]===r)return n/(a-1);var u=i[n];return(n+(r-u)/(i[n+1]-u))/(a-1)},getTangent:function(t){var e=t-1e-4,r=t+1e-4;e<0&&(e=0),r>1&&(r=1);var i=this.getPoint(e);return this.getPoint(r).clone().sub(i).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var r,i,n,a=new Mi,o=[],s=[],l=[],u=new Mi,c=new rn;for(r=0;r<=t;r++)i=r/t,o[r]=this.getTangentAt(i),o[r].normalize();s[0]=new Mi,l[0]=new Mi;var h=Number.MAX_VALUE,d=Math.abs(o[0].x),p=Math.abs(o[0].y),f=Math.abs(o[0].z);for(d<=h&&(h=d,a.set(1,0,0)),p<=h&&(h=p,a.set(0,1,0)),f<=h&&a.set(0,0,1),u.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],u),l[0].crossVectors(o[0],s[0]),r=1;r<=t;r++)s[r]=s[r-1].clone(),l[r]=l[r-1].clone(),u.crossVectors(o[r-1],o[r]),u.length()>Number.EPSILON&&(u.normalize(),n=Math.acos(wi.clamp(o[r-1].dot(o[r]),-1,1)),s[r].applyMatrix4(c.makeRotationAxis(u,n))),l[r].crossVectors(o[r],s[r]);if(!0===e)for(n=Math.acos(wi.clamp(s[0].dot(s[t]),-1,1)),n/=t,o[0].dot(u.crossVectors(s[0],s[t]))>0&&(n=-n),r=1;r<=t;r++)s[r].applyMatrix4(c.makeRotationAxis(o[r],n*r)),l[r].crossVectors(o[r],s[r]);return{tangents:o,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),xu.prototype=Object.create(ku.prototype),xu.prototype.constructor=xu,xu.prototype.isEllipseCurve=!0,xu.prototype.getPoint=function(t,e){for(var r=e||new ki,i=2*Math.PI,n=this.aEndAngle-this.aStartAngle,a=Math.abs(n)<Number.EPSILON;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(n=a?0:i),!0!==this.aClockwise||a||(n===i?n=-i:n-=i);var o=this.aStartAngle+t*n,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*u-d*c+this.aX,l=h*c+d*u+this.aY}return r.set(s,l)},xu.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},xu.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},xu.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Mu.prototype=Object.create(xu.prototype),Mu.prototype.constructor=Mu,Mu.prototype.isArcCurve=!0;var Iu=new Mi,_u=new Ou,Lu=new Ou,Pu=new Ou;function Ru(t,e,r,i){ku.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=r||"centripetal",this.tension=i||.5}function Du(t,e,r,i,n){var a=.5*(i-e),o=.5*(n-r),s=t*t;return(2*r-2*i+a+o)*(t*s)+(-3*r+3*i-2*a-o)*s+a*t+r}function Fu(t,e,r,i){return function(t,e){var r=1-t;return r*r*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,r)+function(t,e){return t*t*e}(t,i)}function Nu(t,e,r,i,n){return function(t,e){var r=1-t;return r*r*r*e}(t,e)+function(t,e){var r=1-t;return 3*r*r*t*e}(t,r)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,n)}function Bu(t,e,r,i){ku.call(this),this.type="CubicBezierCurve",this.v0=t||new ki,this.v1=e||new ki,this.v2=r||new ki,this.v3=i||new ki}function Gu(t,e,r,i){ku.call(this),this.type="CubicBezierCurve3",this.v0=t||new Mi,this.v1=e||new Mi,this.v2=r||new Mi,this.v3=i||new Mi}function Uu(t,e){ku.call(this),this.type="LineCurve",this.v1=t||new ki,this.v2=e||new ki}function zu(t,e){ku.call(this),this.type="LineCurve3",this.v1=t||new Mi,this.v2=e||new Mi}function Wu(t,e,r){ku.call(this),this.type="QuadraticBezierCurve",this.v0=t||new ki,this.v1=e||new ki,this.v2=r||new ki}function Hu(t,e,r){ku.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Mi,this.v1=e||new Mi,this.v2=r||new Mi}function Vu(t){ku.call(this),this.type="SplineCurve",this.points=t||[]}Ru.prototype=Object.create(ku.prototype),Ru.prototype.constructor=Ru,Ru.prototype.isCatmullRomCurve3=!0,Ru.prototype.getPoint=function(t,e){var r,i,n,a,o=e||new Mi,s=this.points,l=s.length,u=(l-(this.closed?0:1))*t,c=Math.floor(u),h=u-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/l)+1)*l:0===h&&c===l-1&&(c=l-2,h=1),this.closed||c>0?r=s[(c-1)%l]:(Iu.subVectors(s[0],s[1]).add(s[0]),r=Iu),i=s[c%l],n=s[(c+1)%l],this.closed||c+2<l?a=s[(c+2)%l]:(Iu.subVectors(s[l-1],s[l-2]).add(s[l-1]),a=Iu),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(r.distanceToSquared(i),d),f=Math.pow(i.distanceToSquared(n),d),m=Math.pow(n.distanceToSquared(a),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),_u.initNonuniformCatmullRom(r.x,i.x,n.x,a.x,p,f,m),Lu.initNonuniformCatmullRom(r.y,i.y,n.y,a.y,p,f,m),Pu.initNonuniformCatmullRom(r.z,i.z,n.z,a.z,p,f,m)}else"catmullrom"===this.curveType&&(_u.initCatmullRom(r.x,i.x,n.x,a.x,this.tension),Lu.initCatmullRom(r.y,i.y,n.y,a.y,this.tension),Pu.initCatmullRom(r.z,i.z,n.z,a.z,this.tension));return o.set(_u.calc(h),Lu.calc(h),Pu.calc(h)),o},Ru.prototype.copy=function(t){ku.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Ru.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++){var i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Ru.prototype.fromJSON=function(t){ku.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var i=t.points[e];this.points.push((new Mi).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Bu.prototype=Object.create(ku.prototype),Bu.prototype.constructor=Bu,Bu.prototype.isCubicBezierCurve=!0,Bu.prototype.getPoint=function(t,e){var r=e||new ki,i=this.v0,n=this.v1,a=this.v2,o=this.v3;return r.set(Nu(t,i.x,n.x,a.x,o.x),Nu(t,i.y,n.y,a.y,o.y)),r},Bu.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Bu.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Bu.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Gu.prototype=Object.create(ku.prototype),Gu.prototype.constructor=Gu,Gu.prototype.isCubicBezierCurve3=!0,Gu.prototype.getPoint=function(t,e){var r=e||new Mi,i=this.v0,n=this.v1,a=this.v2,o=this.v3;return r.set(Nu(t,i.x,n.x,a.x,o.x),Nu(t,i.y,n.y,a.y,o.y),Nu(t,i.z,n.z,a.z,o.z)),r},Gu.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Gu.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Gu.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Uu.prototype=Object.create(ku.prototype),Uu.prototype.constructor=Uu,Uu.prototype.isLineCurve=!0,Uu.prototype.getPoint=function(t,e){var r=e||new ki;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},Uu.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Uu.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Uu.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Uu.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Uu.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},zu.prototype=Object.create(ku.prototype),zu.prototype.constructor=zu,zu.prototype.isLineCurve3=!0,zu.prototype.getPoint=function(t,e){var r=e||new Mi;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},zu.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},zu.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},zu.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},zu.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Wu.prototype=Object.create(ku.prototype),Wu.prototype.constructor=Wu,Wu.prototype.isQuadraticBezierCurve=!0,Wu.prototype.getPoint=function(t,e){var r=e||new ki,i=this.v0,n=this.v1,a=this.v2;return r.set(Fu(t,i.x,n.x,a.x),Fu(t,i.y,n.y,a.y)),r},Wu.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Wu.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Wu.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Hu.prototype=Object.create(ku.prototype),Hu.prototype.constructor=Hu,Hu.prototype.isQuadraticBezierCurve3=!0,Hu.prototype.getPoint=function(t,e){var r=e||new Mi,i=this.v0,n=this.v1,a=this.v2;return r.set(Fu(t,i.x,n.x,a.x),Fu(t,i.y,n.y,a.y),Fu(t,i.z,n.z,a.z)),r},Hu.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Hu.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Hu.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Vu.prototype=Object.create(ku.prototype),Vu.prototype.constructor=Vu,Vu.prototype.isSplineCurve=!0,Vu.prototype.getPoint=function(t,e){var r=e||new ki,i=this.points,n=(i.length-1)*t,a=Math.floor(n),o=n-a,s=i[0===a?a:a-1],l=i[a],u=i[a>i.length-2?i.length-1:a+1],c=i[a>i.length-3?i.length-1:a+2];return r.set(Du(o,s.x,l.x,u.x,c.x),Du(o,s.y,l.y,u.y,c.y)),r},Vu.prototype.copy=function(t){ku.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var i=t.points[e];this.points.push(i.clone())}return this},Vu.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++){var i=this.points[e];t.points.push(i.toArray())}return t},Vu.prototype.fromJSON=function(t){ku.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var i=t.points[e];this.points.push((new ki).fromArray(i))}return this};var Yu=Object.freeze({ArcCurve:Mu,CatmullRomCurve3:Ru,CubicBezierCurve:Bu,CubicBezierCurve3:Gu,EllipseCurve:xu,LineCurve:Uu,LineCurve3:zu,QuadraticBezierCurve:Wu,QuadraticBezierCurve3:Hu,SplineCurve:Vu});function ju(){ku.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Xu(t){ju.call(this),this.type="Path",this.currentPoint=new ki,t&&this.setFromPoints(t)}function qu(t){Xu.call(this,t),this.uuid=wi.generateUUID(),this.type="Shape",this.holes=[]}function Zu(t,e){wn.call(this),this.type="Light",this.color=new hn(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function Ku(t,e,r){Zu.call(this,t,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(wn.DefaultUp),this.updateMatrix(),this.groundColor=new hn(e)}function Qu(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new ki(512,512),this.map=null,this.matrix=new rn}function Ju(){Qu.call(this,new Qo(50,1,.5,500))}function $u(t,e,r,i,n,a){Zu.call(this,t,e),this.type="SpotLight",this.position.copy(wn.DefaultUp),this.updateMatrix(),this.target=new wn,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==a?a:1,this.shadow=new Ju}function tc(t,e,r,i){Zu.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==i?i:1,this.shadow=new Qu(new Qo(90,1,.5,500))}function ec(t,e,r,i,n,a){Ko.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==r?r:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==n?n:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function rc(){Qu.call(this,new ec(-5,5,5,-5,.5,500))}function ic(t,e){Zu.call(this,t,e),this.type="DirectionalLight",this.position.copy(wn.DefaultUp),this.updateMatrix(),this.target=new wn,this.shadow=new rc}function nc(t,e){Zu.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function ac(t,e,r,i){Zu.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==i?i:10}function oc(t){this.manager=void 0!==t?t:yu,this.textures={}}ju.prototype=Object.assign(Object.create(ku.prototype),{constructor:ju,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Uu(e,t))},getPoint:function(t){for(var e=t*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=e){var n=r[i]-e,a=this.curves[i],o=a.getLength(),s=0===o?0:1-n/o;return a.getPointAt(s)}i++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,r=0,i=this.curves.length;r<i;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,r=[],i=0,n=this.curves;i<n.length;i++)for(var a=n[i],o=a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),l=0;l<s.length;l++){var u=s[l];e&&e.equals(u)||(r.push(u),e=u)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){ku.prototype.copy.call(this,t),this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=ku.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,r=this.curves.length;e<r;e++){var i=this.curves[e];t.curves.push(i.toJSON())}return t},fromJSON:function(t){ku.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var i=t.curves[e];this.curves.push((new Yu[i.type]).fromJSON(i))}return this}}),Xu.prototype=Object.assign(Object.create(ju.prototype),{constructor:Xu,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var r=new Uu(this.currentPoint.clone(),new ki(t,e));this.curves.push(r),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,r,i){var n=new Wu(this.currentPoint.clone(),new ki(t,e),new ki(r,i));this.curves.push(n),this.currentPoint.set(r,i)},bezierCurveTo:function(t,e,r,i,n,a){var o=new Bu(this.currentPoint.clone(),new ki(t,e),new ki(r,i),new ki(n,a));this.curves.push(o),this.currentPoint.set(n,a)},splineThru:function(t){var e=new Vu([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,r,i,n,a){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(t+o,e+s,r,i,n,a)},absarc:function(t,e,r,i,n,a){this.absellipse(t,e,r,r,i,n,a)},ellipse:function(t,e,r,i,n,a,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;this.absellipse(t+l,e+u,r,i,n,a,o,s)},absellipse:function(t,e,r,i,n,a,o,s){var l=new xu(t,e,r,i,n,a,o,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);this.currentPoint.copy(c)},copy:function(t){return ju.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=ju.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return ju.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),qu.prototype=Object.assign(Object.create(Xu.prototype),{constructor:qu,getPointsHoles:function(t){for(var e=[],r=0,i=this.holes.length;r<i;r++)e[r]=this.holes[r].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Xu.prototype.copy.call(this,t),this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var i=t.holes[e];this.holes.push(i.clone())}return this},toJSON:function(){var t=Xu.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,r=this.holes.length;e<r;e++){var i=this.holes[e];t.holes.push(i.toJSON())}return t},fromJSON:function(t){Xu.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var i=t.holes[e];this.holes.push((new Xu).fromJSON(i))}return this}}),Zu.prototype=Object.assign(Object.create(wn.prototype),{constructor:Zu,isLight:!0,copy:function(t){return wn.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=wn.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Ku.prototype=Object.assign(Object.create(Zu.prototype),{constructor:Ku,isHemisphereLight:!0,copy:function(t){return Zu.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Qu.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Ju.prototype=Object.assign(Object.create(Qu.prototype),{constructor:Ju,isSpotLightShadow:!0,update:function(t){var e=this.camera,r=2*wi.RAD2DEG*t.angle,i=this.mapSize.width/this.mapSize.height,n=t.distance||e.far;r===e.fov&&i===e.aspect&&n===e.far||(e.fov=r,e.aspect=i,e.far=n,e.updateProjectionMatrix())}}),$u.prototype=Object.assign(Object.create(Zu.prototype),{constructor:$u,isSpotLight:!0,copy:function(t){return Zu.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),tc.prototype=Object.assign(Object.create(Zu.prototype),{constructor:tc,isPointLight:!0,copy:function(t){return Zu.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),ec.prototype=Object.assign(Object.create(Ko.prototype),{constructor:ec,isOrthographicCamera:!0,copy:function(t,e){return Ko.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,r,i,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,n=r-t,a=r+t,o=i+e,s=i-e;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;a=(n+=c*(this.view.offsetX/l))+c*(this.view.width/l),s=(o-=h*(this.view.offsetY/u))-h*(this.view.height/u)}this.projectionMatrix.makeOrthographic(n,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=wn.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),rc.prototype=Object.assign(Object.create(Qu.prototype),{constructor:rc}),ic.prototype=Object.assign(Object.create(Zu.prototype),{constructor:ic,isDirectionalLight:!0,copy:function(t){return Zu.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),nc.prototype=Object.assign(Object.create(Zu.prototype),{constructor:nc,isAmbientLight:!0}),ac.prototype=Object.assign(Object.create(Zu.prototype),{constructor:ac,isRectAreaLight:!0,copy:function(t){return Zu.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=Zu.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Object.assign(oc.prototype,{load:function(t,e,r,i){var n=this,a=new Tu(n.manager);a.setPath(n.path),a.load(t,function(t){e(n.parse(JSON.parse(t)))},r,i)},parse:function(t){var e=this.textures;function r(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var i=new eu[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearCoat&&(i.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(i.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.vertexColors&&(i.vertexColors=t.vertexColors),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.uniforms)for(var n in t.uniforms){var a=t.uniforms[n];switch(i.uniforms[n]={},a.type){case"t":i.uniforms[n].value=r(a.value);break;case"c":i.uniforms[n].value=(new hn).setHex(a.value);break;case"v2":i.uniforms[n].value=(new ki).fromArray(a.value);break;case"v3":i.uniforms[n].value=(new Mi).fromArray(a.value);break;case"v4":i.uniforms[n].value=(new Xi).fromArray(a.value);break;case"m3":i.uniforms[n].value=(new Oi).fromArray(a.value);case"m4":i.uniforms[n].value=(new rn).fromArray(a.value);break;default:i.uniforms[n].value=a.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var o in t.extensions)i.extensions[o]=t.extensions[o];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=r(t.map)),void 0!==t.matcap&&(i.matcap=r(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=r(t.alphaMap),i.transparent=!0),void 0!==t.bumpMap&&(i.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=r(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){var s=t.normalScale;!1===Array.isArray(s)&&(s=[s,s]),i.normalScale=(new ki).fromArray(s)}return void 0!==t.displacementMap&&(i.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=r(t.specularMap)),void 0!==t.envMap&&(i.envMap=r(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.lightMap&&(i.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=r(t.gradientMap)),i},setPath:function(t){return this.path=t,this},setTextures:function(t){return this.textures=t,this}});var sc=function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)};function lc(t){this.manager=void 0!==t?t:yu}Object.assign(lc.prototype,{load:function(t,e,r,i){var n=this,a=new Tu(n.manager);a.setPath(n.path),a.load(t,function(t){e(n.parse(JSON.parse(t)))},r,i)},parse:function(t){var e=new Hn,r=t.data.index;if(void 0!==r){var i=new uc[r.type](r.array);e.setIndex(new In(i,1))}var n=t.data.attributes;for(var a in n){var o=n[a],s=new In(i=new uc[o.type](o.array),o.itemSize,o.normalized);void 0!==o.name&&(s.name=o.name),e.addAttribute(a,s)}var l=t.data.morphAttributes;if(l)for(var a in l){for(var u=l[a],c=[],h=0,d=u.length;h<d;h++){o=u[h],s=new In(i=new uc[o.type](o.array),o.itemSize,o.normalized);void 0!==o.name&&(s.name=o.name),c.push(s)}e.morphAttributes[a]=c}var p=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==p){h=0;for(var f=p.length;h!==f;++h){var m=p[h];e.addGroup(m.start,m.count,m.materialIndex)}}var g=t.data.boundingSphere;if(void 0!==g){var v=new Mi;void 0!==g.center&&v.fromArray(g.center),e.boundingSphere=new $i(v,g.radius)}return t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e},setPath:function(t){return this.path=t,this}});var uc={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function cc(t){this.manager=void 0!==t?t:yu,this.resourcePath=""}Object.assign(cc.prototype,{crossOrigin:"anonymous",load:function(t,e,r,i){var n=this,a=void 0===this.path?sc(t):this.path;this.resourcePath=this.resourcePath||a;var o=new Tu(n.manager);o.setPath(this.path),o.load(t,function(r){var a=null;try{a=JSON.parse(r)}catch(e){return void 0!==i&&i(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?n.parse(a,e):console.error("THREE.ObjectLoader: Can't load "+t)},r,i)},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setCrossOrigin:function(t){return this.crossOrigin=t,this},parse:function(t,e){var r=this.parseShape(t.shapes),i=this.parseGeometries(t.geometries,r),n=this.parseImages(t.images,function(){void 0!==e&&e(s)}),a=this.parseTextures(t.textures,n),o=this.parseMaterials(t.materials,a),s=this.parseObject(t.object,i,o);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseShape:function(t){var e={};if(void 0!==t)for(var r=0,i=t.length;r<i;r++){var n=(new qu).fromJSON(t[r]);e[n.uuid]=n}return e},parseGeometries:function(t,e){var r={};if(void 0!==t)for(var i=new lc,n=0,a=t.length;n<a;n++){var o,s=t[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Vl[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Vl[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Vl[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Vl[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Vl[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Vl[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Vl[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Vl[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Vl[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Vl[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new Vl[s.type]((new Yu[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Vl[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Vl[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],u=0,c=s.shapes.length;u<c;u++){var h=e[s.shapes[u]];l.push(h)}o=new Vl[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],u=0,c=s.shapes.length;u<c;u++){h=e[s.shapes[u]];l.push(h)}var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new Yu[d.type]).fromJSON(d)),o=new Vl[s.type](l,s.options);break;case"BufferGeometry":o=i.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)o=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),r[s.uuid]=o}return r},parseMaterials:function(t,e){var r={},i={};if(void 0!==t){var n=new oc;n.setTextures(e);for(var a=0,o=t.length;a<o;a++){var s=t[a];if("MultiMaterial"===s.type){for(var l=[],u=0;u<s.materials.length;u++){var c=s.materials[u];void 0===r[c.uuid]&&(r[c.uuid]=n.parse(c)),l.push(r[c.uuid])}i[s.uuid]=l}else void 0===r[s.uuid]&&(r[s.uuid]=n.parse(s)),i[s.uuid]=r[s.uuid]}}return i},parseAnimations:function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r],n=mu.parse(i);void 0!==i.uuid&&(n.uuid=i.uuid),e.push(n)}return e},parseImages:function(t,e){var r=this,i={};function n(t){return r.manager.itemStart(t),a.load(t,function(){r.manager.itemEnd(t)},void 0,function(){r.manager.itemError(t),r.manager.itemEnd(t)})}if(void 0!==t&&t.length>0){var a=new Su(new bu(e));a.setCrossOrigin(this.crossOrigin);for(var o=0,s=t.length;o<s;o++){var l=t[o],u=l.url;if(Array.isArray(u)){i[l.uuid]=[];for(var c=0,h=u.length;c<h;c++){var d=u[c],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:r.resourcePath+d;i[l.uuid].push(n(p))}}else{p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.resourcePath+l.url;i[l.uuid]=n(p)}}}return i},parseTextures:function(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var i={};if(void 0!==t)for(var n=0,a=t.length;n<a;n++){var o,s=t[n];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=Array.isArray(e[s.image])?new ka(e[s.image]):new ji(e[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=r(s.mapping,gc)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=r(s.wrap[0],vc),o.wrapT=r(s.wrap[1],vc)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=r(s.minFilter,bc)),void 0!==s.magFilter&&(o.magFilter=r(s.magFilter,bc)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),i[s.uuid]=o}return i},parseObject:function(t,e,r){var i;function n(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function a(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],i=0,n=t.length;i<n;i++){var a=t[i];void 0===r[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),e.push(r[a])}return e}return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),r[t]}}switch(t.type){case"Scene":i=new ps,void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new hn(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new ds(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new hs(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new Qo(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new ec(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new nc(t.color,t.intensity);break;case"DirectionalLight":i=new ic(t.color,t.intensity);break;case"PointLight":i=new tc(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new ac(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new $u(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new Ku(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=n(t.geometry),s=a(t.material);i=o.bones&&o.bones.length>0?new ys(o,s):new fa(o,s),void 0!==t.drawMode&&i.setDrawMode(t.drawMode);break;case"LOD":i=new bs;break;case"Line":i=new Ss(n(t.geometry),a(t.material),t.mode);break;case"LineLoop":i=new ws(n(t.geometry),a(t.material));break;case"LineSegments":i=new Es(n(t.geometry),a(t.material));break;case"PointCloud":case"Points":i=new xs(n(t.geometry),a(t.material));break;case"Sprite":i=new vs(a(t.material));break;case"Group":i=new Zo;break;default:i=new wn}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children)for(var l=t.children,u=0;u<l.length;u++)i.add(this.parseObject(l[u],e,r));if("LOD"===t.type)for(var c=t.levels,h=0;h<c.length;h++){var d=c[h],p=i.getObjectByProperty("uuid",d.object);void 0!==p&&i.addLevel(p,d.distance)}return i}});var hc,dc,pc,fc,mc,gc={UVMapping:300,CubeReflectionMapping:nr,CubeRefractionMapping:ar,EquirectangularReflectionMapping:or,EquirectangularRefractionMapping:sr,SphericalReflectionMapping:lr,CubeUVReflectionMapping:ur,CubeUVRefractionMapping:cr},vc={RepeatWrapping:hr,ClampToEdgeWrapping:dr,MirroredRepeatWrapping:pr},bc={NearestFilter:fr,NearestMipMapNearestFilter:mr,NearestMipMapLinearFilter:gr,LinearFilter:vr,LinearMipMapNearestFilter:br,LinearMipMapLinearFilter:yr};function yc(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==t?t:yu,this.options=void 0}function Ac(){this.type="ShapePath",this.color=new hn,this.subPaths=[],this.currentPath=null}function Tc(t){this.type="Font",this.data=t}function Cc(t,e,r,i,n){var a=n.glyphs[t]||n.glyphs["?"];if(a){var o,s,l,u,c,h,d,p,f=new Ac;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":o=m[g++]*e+r,s=m[g++]*e+i,f.moveTo(o,s);break;case"l":o=m[g++]*e+r,s=m[g++]*e+i,f.lineTo(o,s);break;case"q":l=m[g++]*e+r,u=m[g++]*e+i,c=m[g++]*e+r,h=m[g++]*e+i,f.quadraticCurveTo(c,h,l,u);break;case"b":l=m[g++]*e+r,u=m[g++]*e+i,c=m[g++]*e+r,h=m[g++]*e+i,d=m[g++]*e+r,p=m[g++]*e+i,f.bezierCurveTo(c,h,d,p,l,u)}}return{offsetX:a.ha*e,path:f}}}function Sc(){}yc.prototype={constructor:yc,setOptions:function(t){return this.options=t,this},load:function(t,e,r,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,a=vu.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;fetch(t).then(function(t){return t.blob()}).then(function(t){return void 0===n.options?createImageBitmap(t):createImageBitmap(t,n.options)}).then(function(r){vu.add(t,r),e&&e(r),n.manager.itemEnd(t)}).catch(function(e){i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}),n.manager.itemStart(t)},setCrossOrigin:function(){return this},setPath:function(t){return this.path=t,this}},Object.assign(Ac.prototype,{moveTo:function(t,e){this.currentPath=new Xu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,r,i){this.currentPath.quadraticCurveTo(t,e,r,i)},bezierCurveTo:function(t,e,r,i,n,a){this.currentPath.bezierCurveTo(t,e,r,i,n,a)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function r(t){for(var e=[],r=0,i=t.length;r<i;r++){var n=t[r],a=new qu;a.curves=n.curves,e.push(a)}return e}function i(t,e){for(var r=e.length,i=!1,n=r-1,a=0;a<r;n=a++){var o=e[n],s=e[a],l=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(o=e[a],l=-l,s=e[n],u=-u),t.y<o.y||t.y>s.y)continue;if(t.y===o.y){if(t.x===o.x)return!0}else{var c=u*(t.x-o.x)-l*(t.y-o.y);if(0===c)return!0;if(c<0)continue;i=!i}}else{if(t.y!==o.y)continue;if(s.x<=t.x&&t.x<=o.x||o.x<=t.x&&t.x<=s.x)return!0}}return i}var n=yl.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===e)return r(a);var o,s,l,u=[];if(1===a.length)return s=a[0],(l=new qu).curves=s.curves,u.push(l),u;var c=!n(a[0].getPoints());c=t?!c:c;var h,d,p=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,b=a.length;v<b;v++)o=n(h=(s=a[v]).getPoints()),(o=t?!o:o)?(!c&&f[g]&&g++,f[g]={s:new qu,p:h},f[g].s.curves=s.curves,c&&g++,m[g]=[]):m[g].push({h:s,p:h[0]});if(!f[0])return r(a);if(f.length>1){for(var y=!1,A=[],T=0,C=f.length;T<C;T++)p[T]=[];for(T=0,C=f.length;T<C;T++)for(var S=m[T],E=0;E<S.length;E++){for(var w=S[E],k=!0,x=0;x<f.length;x++)i(w.p,f[x].p)&&(T!==x&&A.push({froms:T,tos:x,hole:E}),k?(k=!1,p[x].push(w)):y=!0);k&&p[T].push(w)}A.length>0&&(y||(m=p))}v=0;for(var M=f.length;v<M;v++){l=f[v].s,u.push(l);for(var O=0,I=(d=m[v]).length;O<I;O++)l.holes.push(d[O].h)}return u}}),Object.assign(Tc.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);for(var r=[],i=function(t,e,r){for(var i=Array.from?Array.from(t):String(t).split(""),n=e/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*n,o=[],s=0,l=0,u=0;u<i.length;u++){var c=i[u];if("\n"===c)s=0,l-=a;else{var h=Cc(c,n,s,l,r);s+=h.offsetX,o.push(h.path)}}return o}(t,e,this.data),n=0,a=i.length;n<a;n++)Array.prototype.push.apply(r,i[n].toShapes());return r}}),Object.assign(function(t){this.manager=void 0!==t?t:yu}.prototype,{load:function(t,e,r,i){var n=this,a=new Tu(this.manager);a.setPath(this.path),a.load(t,function(t){var r;try{r=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}var i=n.parse(r);e&&e(i)},r,i)},parse:function(t){return new Tc(t)},setPath:function(t){return this.path=t,this}}),Sc.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,r=0,i=e.length;r<i;r+=2){var n=e[r],a=e[r+1];if(n.test(t))return a}return null}},Object.assign(Sc.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,e,r){for(var i=[],n=0;n<t.length;++n)i[n]=this.createMaterial(t[n],e,r);return i},createMaterial:(hc={NoBlending:ye,NormalBlending:Ae,AdditiveBlending:Te,SubtractiveBlending:Ce,MultiplyBlending:Se,CustomBlending:Ee},dc=new hn,pc=new wu,fc=new oc,function(t,e,r){var i={};function n(t,n,a,o,s){var l,u=e+t,c=Sc.Handlers.get(u);null!==c?l=c.load(u):(pc.setCrossOrigin(r),l=pc.load(u)),void 0!==n&&(l.repeat.fromArray(n),1!==n[0]&&(l.wrapS=hr),1!==n[1]&&(l.wrapT=hr)),void 0!==a&&l.offset.fromArray(a),void 0!==o&&("repeat"===o[0]&&(l.wrapS=hr),"mirror"===o[0]&&(l.wrapS=pr),"repeat"===o[1]&&(l.wrapT=hr),"mirror"===o[1]&&(l.wrapT=pr)),void 0!==s&&(l.anisotropy=s);var h=wi.generateUUID();return i[h]=l,h}var a={uuid:wi.generateUUID(),type:"MeshLambertMaterial"};for(var o in t){var s=t[o];switch(o){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":a.name=s;break;case"blending":a.blending=hc[s];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",o,"is no longer supported.");break;case"colorDiffuse":a.color=dc.fromArray(s).getHex();break;case"colorSpecular":a.specular=dc.fromArray(s).getHex();break;case"colorEmissive":a.emissive=dc.fromArray(s).getHex();break;case"specularCoef":a.shininess=s;break;case"shading":"basic"===s.toLowerCase()&&(a.type="MeshBasicMaterial"),"phong"===s.toLowerCase()&&(a.type="MeshPhongMaterial"),"standard"===s.toLowerCase()&&(a.type="MeshStandardMaterial");break;case"mapDiffuse":a.map=n(s,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":a.emissiveMap=n(s,t.mapEmissiveRepeat,t.mapEmissiveOffset,t.mapEmissiveWrap,t.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":a.lightMap=n(s,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":a.aoMap=n(s,t.mapAORepeat,t.mapAOOffset,t.mapAOWrap,t.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":a.bumpMap=n(s,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy);break;case"mapBumpScale":a.bumpScale=s;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":a.normalMap=n(s,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy);break;case"mapNormalFactor":a.normalScale=s;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":a.specularMap=n(s,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":a.metalnessMap=n(s,t.mapMetalnessRepeat,t.mapMetalnessOffset,t.mapMetalnessWrap,t.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":a.roughnessMap=n(s,t.mapRoughnessRepeat,t.mapRoughnessOffset,t.mapRoughnessWrap,t.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":a.alphaMap=n(s,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":a.side=fe;break;case"doubleSided":a.side=me;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),a.opacity=s;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":a[o]=s;break;case"vertexColors":!0===s&&(a.vertexColors=be),"face"===s&&(a.vertexColors=ve);break;default:console.error("THREE.Loader.createMaterial: Unsupported",o,s)}}return"MeshBasicMaterial"===a.type&&delete a.emissive,"MeshPhongMaterial"!==a.type&&delete a.specular,a.opacity<1&&(a.transparent=!0),fc.setTextures(i),fc.parse(a)})});var Ec={getContext:function(){return void 0===mc&&(mc=new(window.AudioContext||window.webkitAudioContext)),mc},setContext:function(t){mc=t}};function wc(t){this.manager=void 0!==t?t:yu}function kc(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Mi)}function xc(t,e){Zu.call(this,void 0,e),this.sh=void 0!==t?t:new kc}function Mc(t,e,r){xc.call(this,void 0,r);var i=(new hn).set(t),n=(new hn).set(e),a=new Mi(i.r,i.g,i.b),o=new Mi(n.r,n.g,n.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}function Oc(t,e){xc.call(this,void 0,e);var r=(new hn).set(t);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}Object.assign(wc.prototype,{load:function(t,e,r,i){var n=new Tu(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),n.load(t,function(t){var r=t.slice(0);Ec.getContext().decodeAudioData(r,function(t){e(t)})},r,i)},setPath:function(t){return this.path=t,this}}),Object.assign(kc.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var r=t.x,i=t.y,n=t.z,a=this.coefficients;return e=.282095*a[0],e+=.488603*a[1]*i,e+=.488603*a[2]*n,e+=.488603*a[3]*r,e+=1.092548*a[4]*(r*i),e+=1.092548*a[5]*(i*n),e+=.315392*a[6]*(3*n*n-1),e+=1.092548*a[7]*(r*n),e+=.546274*a[8]*(r*r-i*i)},getIrradianceAt:function(t,e){var r=t.x,i=t.y,n=t.z,a=this.coefficients;return e=.886227*a[0],e+=2*a[1]*.511664*i,e+=2*a[2]*.511664*n,e+=2*a[3]*.511664*r,e+=2*a[4]*.429043*r*i,e+=2*a[5]*.429043*i*n,e+=a[6]*(.743125*n*n-.247708),e+=2*a[7]*.429043*r*n,e+=.429043*a[8]*(r*r-i*i)},add:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},scale:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],e);return this},equals:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t){for(var e=this.coefficients,r=0;r<9;r++)e[r].fromArray(t,3*r);return this},toArray:function(){for(var t=[],e=this.coefficients,r=0;r<9;r++)e[r].toArray(t,3*r);return t}}),Object.assign(kc,{getBasisAt:function(t,e){var r=t.x,i=t.y,n=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*n,e[3]=.488603*r,e[4]=1.092548*r*i,e[5]=1.092548*i*n,e[6]=.315392*(3*n*n-1),e[7]=1.092548*r*n,e[8]=.546274*(r*r-i*i)}}),xc.prototype=Object.assign(Object.create(Zu.prototype),{constructor:xc,isLightProbe:!0,copy:function(t){return Zu.prototype.copy.call(this,t),this.sh.copy(t.sh),this.intensity=t.intensity,this},toJSON:function(t){return Zu.prototype.toJSON.call(this,t)}}),Mc.prototype=Object.assign(Object.create(xc.prototype),{constructor:Mc,isHemisphereLightProbe:!0,copy:function(t){return xc.prototype.copy.call(this,t),this},toJSON:function(t){return xc.prototype.toJSON.call(this,t)}}),Oc.prototype=Object.assign(Object.create(xc.prototype),{constructor:Oc,isAmbientLightProbe:!0,copy:function(t){return xc.prototype.copy.call(this,t),this},toJSON:function(t){return xc.prototype.toJSON.call(this,t)}}),Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Qo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Qo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}.prototype,{update:function(){var t,e,r,i,n,a,o,s,l=new rn,u=new rn;return function(c){if(t!==this||e!==c.focus||r!==c.fov||i!==c.aspect*this.aspect||n!==c.near||a!==c.far||o!==c.zoom||s!==this.eyeSep){t=this,e=c.focus,r=c.fov,i=c.aspect*this.aspect,n=c.near,a=c.far,o=c.zoom;var h,d,p=c.projectionMatrix.clone(),f=(s=this.eyeSep/2)*n/e,m=n*Math.tan(wi.DEG2RAD*r*.5)/o;u.elements[12]=-s,l.elements[12]=s,h=-m*i+f,d=m*i+f,p.elements[0]=2*n/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraL.projectionMatrix.copy(p),h=-m*i-f,d=m*i-f,p.elements[0]=2*n/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(c.matrixWorld).multiply(u),this.cameraR.matrixWorld.copy(c.matrixWorld).multiply(l)}}()});var Ic=90,_c=1;function Lc(t,e,r,i){wn.call(this),this.type="CubeCamera";var n=new Qo(Ic,_c,t,e);n.up.set(0,-1,0),n.lookAt(new Mi(1,0,0)),this.add(n);var a=new Qo(Ic,_c,t,e);a.up.set(0,-1,0),a.lookAt(new Mi(-1,0,0)),this.add(a);var o=new Qo(Ic,_c,t,e);o.up.set(0,0,1),o.lookAt(new Mi(0,1,0)),this.add(o);var s=new Qo(Ic,_c,t,e);s.up.set(0,0,-1),s.lookAt(new Mi(0,-1,0)),this.add(s);var l=new Qo(Ic,_c,t,e);l.up.set(0,-1,0),l.lookAt(new Mi(0,0,1)),this.add(l);var u=new Qo(Ic,_c,t,e);u.up.set(0,-1,0),u.lookAt(new Mi(0,0,-1)),this.add(u),i=i||{format:Pr,magFilter:vr,minFilter:vr},this.renderTarget=new Ki(r,r,i),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var r=t.getRenderTarget(),i=this.renderTarget,c=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,a),t.setRenderTarget(i,2),t.render(e,o),t.setRenderTarget(i,3),t.render(e,s),t.setRenderTarget(i,4),t.render(e,l),i.texture.generateMipmaps=c,t.setRenderTarget(i,5),t.render(e,u),t.setRenderTarget(r)},this.clear=function(t,e,r,i){for(var n=t.getRenderTarget(),a=this.renderTarget,o=0;o<6;o++)t.setRenderTarget(a,o),t.clear(e,r,i);t.setRenderTarget(n)}}function Pc(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Rc(){wn.call(this),this.type="AudioListener",this.context=Ec.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function Dc(t){wn.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Fc(t){Dc.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function Nc(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function Bc(t,e,r){this.binding=t,this.valueSize=r;var i,n=Float64Array;switch(e){case"quaternion":i=this._slerp;break;case"string":case"bool":n=Array,i=this._select;break;default:i=this._lerp}this.buffer=new n(4*r),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Lc.prototype=Object.create(wn.prototype),Lc.prototype.constructor=Lc,Object.assign(Pc.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),Rc.prototype=Object.assign(Object.create(wn.prototype),{constructor:Rc,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(){var t=new Mi,e=new xi,r=new Mi,i=new Mi,n=new Pc;return function(a){wn.prototype.updateMatrixWorld.call(this,a);var o=this.context.listener,s=this.up;if(this.timeDelta=n.getDelta(),this.matrixWorld.decompose(t,e,r),i.set(0,0,-1).applyQuaternion(e),o.positionX){var l=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(t.x,l),o.positionY.linearRampToValueAtTime(t.y,l),o.positionZ.linearRampToValueAtTime(t.z,l),o.forwardX.linearRampToValueAtTime(i.x,l),o.forwardY.linearRampToValueAtTime(i.y,l),o.forwardZ.linearRampToValueAtTime(i.z,l),o.upX.linearRampToValueAtTime(s.x,l),o.upY.linearRampToValueAtTime(s.y,l),o.upZ.linearRampToValueAtTime(s.z,l)}else o.setPosition(t.x,t.y,t.z),o.setOrientation(i.x,i.y,i.z,s.x,s.y,s.z)}}()}),Dc.prototype=Object.assign(Object.create(wn.prototype),{constructor:Dc,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,t.start(this.startTime,this.offset),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}),Fc.prototype=Object.assign(Object.create(Dc.prototype),{constructor:Fc,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(){var t=new Mi,e=new xi,r=new Mi,i=new Mi;return function(n){if(wn.prototype.updateMatrixWorld.call(this,n),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(t,e,r),i.set(0,0,1).applyQuaternion(e);var a=this.panner;if(a.positionX){var o=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(t.x,o),a.positionY.linearRampToValueAtTime(t.y,o),a.positionZ.linearRampToValueAtTime(t.z,o),a.orientationX.linearRampToValueAtTime(i.x,o),a.orientationY.linearRampToValueAtTime(i.y,o),a.orientationZ.linearRampToValueAtTime(i.z,o)}else a.setPosition(t.x,t.y,t.z),a.setOrientation(i.x,i.y,i.z)}}}()}),Object.assign(Nc.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),r=0;r<e.length;r++)t+=e[r];return t/e.length}}),Object.assign(Bc.prototype,{accumulate:function(t,e){var r=this.buffer,i=this.valueSize,n=t*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)r[n+o]=r[o];a=e}else{var s=e/(a+=e);this._mixBufferRegion(r,n,0,s,i)}this.cumulativeWeight=a},apply:function(t){var e=this.valueSize,r=this.buffer,i=t*e+e,n=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,n<1){var o=3*e;this._mixBufferRegion(r,i,o,1-n,e)}for(var s=e,l=e+e;s!==l;++s)if(r[s]!==r[s+e]){a.setValue(r,i);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,r=this.valueSize,i=3*r;t.getValue(e,i);for(var n=r,a=i;n!==a;++n)e[n]=e[i+n%r];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,e,r,i,n){if(i>=.5)for(var a=0;a!==n;++a)t[e+a]=t[r+a]},_slerp:function(t,e,r,i){xi.slerpFlat(t,e,t,e,t,r,i)},_lerp:function(t,e,r,i,n){for(var a=1-i,o=0;o!==n;++o){var s=e+o;t[s]=t[s]*a+t[r+o]*i}}});var Gc,Uc,zc,Wc,Hc,Vc,Yc,jc,Xc,qc,Zc,Kc,Qc,Jc,$c;function th(t,e,r){var i=r||eh.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}function eh(t,e,r){this.path=e,this.parsedPath=r||eh.parseTrackName(e),this.node=eh.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function rh(t,e,r){this._mixer=t,this._clip=e,this._localRoot=r||null;for(var i=e.tracks,n=i.length,a=new Array(n),o={endingStart:ci,endingEnd:ci},s=0;s!==n;++s){var l=i[s].createInterpolant(null);a[s]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ui,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function ih(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function nh(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function ah(){Hn.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function oh(t,e,r){fs.call(this,t,e),this.meshPerAttribute=r||1}function sh(t,e,r,i){"number"==typeof r&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),In.call(this,t,e,r),this.meshPerAttribute=i||1}function lh(t,e){return t.distance-e.distance}function uh(t,e,r,i){if(!1!==t.visible&&(t.raycast(e,r),!0===i))for(var n=t.children,a=0,o=n.length;a<o;a++)uh(n[a],e,r,!0)}function ch(t,e,r){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==r?r:0,this}function hh(t,e){this.min=void 0!==t?t:new ki(1/0,1/0),this.max=void 0!==e?e:new ki(-1/0,-1/0)}function dh(t,e){this.start=void 0!==t?t:new Mi,this.end=void 0!==e?e:new Mi}function ph(t){wn.call(this),this.material=t,this.render=function(){}}function fh(t,e,r,i){this.object=t,this.size=void 0!==e?e:1;var n=void 0!==r?r:16711680,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=3*s.faces.length:s&&s.isBufferGeometry&&(o=s.attributes.normal.count);var l=new Hn,u=new Bn(2*o*3,3);l.addAttribute("position",u),Es.call(this,l,new Cs({color:n,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function mh(t,e){wn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var r=new Hn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,a=1;n<32;n++,a++){var o=n/32*Math.PI*2,s=a/32*Math.PI*2;i.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new Bn(i,3));var l=new Cs({fog:!1});this.cone=new Es(r,l),this.add(this.cone),this.update()}function gh(t){for(var e=function t(e){var r=[];e&&e.isBone&&r.push(e);for(var i=0;i<e.children.length;i++)r.push.apply(r,t(e.children[i]));return r}(t),r=new Hn,i=[],n=[],a=new hn(0,0,1),o=new hn(0,1,0),s=0;s<e.length;s++){var l=e[s];l.parent&&l.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(a.r,a.g,a.b),n.push(o.r,o.g,o.b))}r.addAttribute("position",new Bn(i,3)),r.addAttribute("color",new Bn(n,3));var u=new Cs({vertexColors:be,depthTest:!1,depthWrite:!1,transparent:!0});Es.call(this,r,u),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function vh(t,e,r){this.light=t,this.light.updateMatrixWorld(),this.color=r;var i=new Ol(e,4,2),n=new pa({wireframe:!0,fog:!1});fa.call(this,i,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function bh(t,e){this.type="RectAreaLightHelper",this.light=t,this.color=e;var r=new Hn;r.addAttribute("position",new Bn([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere();var i=new Cs({fog:!1});Ss.call(this,r,i);var n=new Hn;n.addAttribute("position",new Bn([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new fa(n,new pa({side:fe,fog:!1}))),this.update()}function yh(t,e,r){wn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var i=new Us(e);i.rotateY(.5*Math.PI),this.material=new pa({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=be);var n=i.getAttribute("position"),a=new Float32Array(3*n.count);i.addAttribute("color",new In(a,3)),this.add(new fa(i,this.material)),this.update()}function Ah(t,e){this.lightProbe=t,this.size=e;var r={GAMMA_OUTPUT:""},i=new ca({defines:r,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),n=new Ol(1,32,16);fa.call(this,n,i),this.onBeforeRender()}function Th(t,e,r,i){t=t||10,e=e||10,r=new hn(void 0!==r?r:4473924),i=new hn(void 0!==i?i:8947848);for(var n=e/2,a=t/e,o=t/2,s=[],l=[],u=0,c=0,h=-o;u<=e;u++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var d=u===n?r:i;d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3}var p=new Hn;p.addAttribute("position",new Bn(s,3)),p.addAttribute("color",new Bn(l,3));var f=new Cs({vertexColors:be});Es.call(this,p,f)}function Ch(t,e,r,i,n,a){t=t||10,e=e||16,r=r||8,i=i||64,n=new hn(void 0!==n?n:4473924),a=new hn(void 0!==a?a:8947848);var o,s,l,u,c,h,d,p=[],f=[];for(u=0;u<=e;u++)l=u/e*(2*Math.PI),o=Math.sin(l)*t,s=Math.cos(l)*t,p.push(0,0,0),p.push(o,0,s),d=1&u?n:a,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);for(u=0;u<=r;u++)for(d=1&u?n:a,h=t-t/r*u,c=0;c<i;c++)l=c/i*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,p.push(o,0,s),f.push(d.r,d.g,d.b),l=(c+1)/i*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,p.push(o,0,s),f.push(d.r,d.g,d.b);var m=new Hn;m.addAttribute("position",new Bn(p,3)),m.addAttribute("color",new Bn(f,3));var g=new Cs({vertexColors:be});Es.call(this,m,g)}function Sh(t,e,r,i){this.audio=t,this.range=e||1,this.divisionsInnerAngle=r||16,this.divisionsOuterAngle=i||2;var n=new Hn,a=this.divisionsInnerAngle+2*this.divisionsOuterAngle,o=new Float32Array(3*(3*a+3));n.addAttribute("position",new In(o,3));var s=new Cs({color:65280}),l=new Cs({color:16776960});Ss.call(this,n,[l,s]),this.update()}function Eh(t,e,r,i){this.object=t,this.size=void 0!==e?e:1;var n=void 0!==r?r:16776960,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new Hn,u=new Bn(2*o*3,3);l.addAttribute("position",u),Es.call(this,l,new Cs({color:n,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function wh(t,e,r){wn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===e&&(e=1);var i=new Hn;i.addAttribute("position",new Bn([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var n=new Cs({fog:!1});this.lightPlane=new Ss(i,n),this.add(this.lightPlane),(i=new Hn).addAttribute("position",new Bn([0,0,0,0,0,1],3)),this.targetLine=new Ss(i,n),this.add(this.targetLine),this.update()}function kh(t){var e=new Hn,r=new Cs({color:16777215,vertexColors:ve}),i=[],n=[],a={},o=new hn(16755200),s=new hn(16711680),l=new hn(43775),u=new hn(16777215),c=new hn(3355443);function h(t,e,r){d(t,r),d(e,r)}function d(t,e){i.push(0,0,0),n.push(e.r,e.g,e.b),void 0===a[t]&&(a[t]=[]),a[t].push(i.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",u),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),e.addAttribute("position",new Bn(i,3)),e.addAttribute("color",new Bn(n,3)),Es.call(this,e,r),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function xh(t,e){this.object=t,void 0===e&&(e=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),n=new Hn;n.setIndex(new In(r,1)),n.addAttribute("position",new In(i,3)),Es.call(this,n,new Cs({color:e})),this.matrixAutoUpdate=!1,this.update()}function Mh(t,e){this.type="Box3Helper",this.box=t;var r=void 0!==e?e:16776960,i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Hn;n.setIndex(new In(i,1)),n.addAttribute("position",new Bn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Es.call(this,n,new Cs({color:r})),this.geometry.computeBoundingSphere()}function Oh(t,e,r){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var i=void 0!==r?r:16776960,n=new Hn;n.addAttribute("position",new Bn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),Ss.call(this,n,new Cs({color:i}));var a=new Hn;a.addAttribute("position",new Bn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new fa(a,new pa({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}function Ih(t,e,r,i,n,a){wn.call(this),void 0===t&&(t=new Mi(0,0,1)),void 0===e&&(e=new Mi(0,0,0)),void 0===r&&(r=1),void 0===i&&(i=16776960),void 0===n&&(n=.2*r),void 0===a&&(a=.2*n),void 0===Kc&&((Kc=new Hn).addAttribute("position",new Bn([0,0,0,0,1,0],3)),(Qc=new Gl(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Ss(Kc,new Cs({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new fa(Qc,new pa({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,n,a)}function _h(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new Hn;r.addAttribute("position",new Bn(e,3)),r.addAttribute("color",new Bn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new Cs({vertexColors:be});Es.call(this,r,i)}Object.assign(th.prototype,{getValue:function(t,e){this.bind();var r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(eh,{Composite:th,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new eh.Composite(t,e,r):new eh(t,e,r)},sanitizeNodeName:(Xc=new RegExp("[\\[\\]\\.:\\/]","g"),function(t){return t.replace(/\s/g,"_").replace(Xc,"")}),parseTrackName:(Gc="[^\\[\\]\\.:\\/]",Uc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",zc=/((?:WC+[\/:])*)/.source.replace("WC",Gc),Wc=/(WCOD+)?/.source.replace("WCOD",Uc),Hc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Gc),Vc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Gc),Yc=new RegExp("^"+zc+Wc+Hc+Vc+"$"),jc=["material","materials","bones"],function(t){var e=Yc.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var n=r.nodeName.substring(i+1);-1!==jc.indexOf(n)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=n)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}),findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){var i=function(t){for(var r=0;r<t.length;r++){var n=t[r];if(n.name===e||n.uuid===e)return n;var a=i(n.children);if(a)return a}return null},n=i(t.children);if(n)return n}return null}}),Object.assign(eh.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)t[e++]=r[i]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=t[e++]},function(t,e){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,i=e.propertyName,n=e.propertyIndex;if(t||(t=eh.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var a=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var o=0;o<t.length;o++)if(t[o].name===a){a=o;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==a){if(void 0===t[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[a]}}var s=t[i];if(void 0!==s){var l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(t.geometry.morphAttributes.position[o].name===n){n=o;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(t.geometry.morphTargets[o].name===n){n=o;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(eh.prototype,{_getValue_unbound:eh.prototype.getValue,_setValue_unbound:eh.prototype.setValue}),Object.assign(function(){this.uuid=wi.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,r=arguments.length;e!==r;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=void 0,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],d=h.uuid,p=i[d];if(void 0===p){p=e++,i[d]=p,t.push(h);for(var f=0,m=s;f!==m;++f)o[f].push(new eh(h,n[f],a[f]))}else if(p<r){l=t[p];var g=--r,v=t[g];i[v.uuid]=p,t[p]=v,i[d]=g,t[g]=h;for(f=0,m=s;f!==m;++f){var b=o[f],y=b[g],A=b[p];b[p]=y,void 0===A&&(A=new eh(h,n[f],a[f])),b[g]=A}}else t[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,n=i.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,u=r[l];if(void 0!==u&&u>=e){var c=e++,h=t[c];r[h.uuid]=u,t[u]=h,r[l]=c,t[c]=s;for(var d=0,p=n;d!==p;++d){var f=i[d],m=f[c],g=f[u];f[u]=m,f[c]=g}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,a=n.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o].uuid,u=i[l];if(void 0!==u)if(delete i[l],u<r){var c=--r,h=t[c],d=t[v=--e];i[h.uuid]=u,t[u]=h,i[d.uuid]=c,t[c]=d,t.pop();for(var p=0,f=a;p!==f;++p){var m=(b=n[p])[c],g=b[v];b[u]=m,b[c]=g,b.pop()}}else{var v;i[(d=t[v=--e]).uuid]=u,t[u]=d,t.pop();for(p=0,f=a;p!==f;++p){var b;(b=n[p])[u]=b[v],b.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){var r=this._bindingsIndicesByPath,i=r[t],n=this._bindings;if(void 0!==i)return n[i];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);i=n.length,r[t]=i,a.push(t),o.push(e),n.push(c);for(var h=u,d=s.length;h!==d;++h){var p=s[h];c[h]=new eh(p,t,e)}return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){var i=this._paths,n=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];e[t[o]]=r,a[r]=s,a.pop(),n[r]=n[o],n.pop(),i[r]=i[o],i.pop()}}}),Object.assign(rh.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var i=this._clip.duration,n=t._clip.duration,a=n/i,o=i/n;t.warp(1,a,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var i=this._mixer,n=i.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=n,s[1]=n+r,l[0]=t/o,l[1]=e/o,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,i){if(this.enabled){var n=this._startTime;if(null!==n){var a=(t-n)*r;if(a<0||0===r)return;this._startTime=null,e=r*a}e*=this._updateTimeScale(t);var o=this._updateTime(e),s=this._updateWeight(t);if(s>0)for(var l=this._interpolants,u=this._propertyBindings,c=0,h=l.length;c!==h;++c)l[c].evaluate(o),u[c].accumulate(i,s)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var i=r.evaluate(t)[0];e*=i,t>r.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,r=this._clip.duration,i=this.loop,n=this._loopCount,a=2202===i;if(0===t)return-1===n?e:a&&1==(1&n)?r-e:e;if(2200===i){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===n&&(t>=0?(n=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),e>=r||e<0){var o=Math.floor(e/r);e-=r*o,n+=Math.abs(o);var s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var l=t<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}if(a&&1==(1&n))return this.time=e,r-e}return this.time=e,e},_setEndings:function(t,e,r){var i=this._interpolantSettings;r?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=t?this.zeroSlopeAtStart?2401:ci:2402,i.endingEnd=e?this.zeroSlopeAtEnd?2401:ci:2402)},_scheduleFading:function(t,e,r){var i=this._mixer,n=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=n,s[0]=e,o[1]=n+t,s[1]=r,this}}),ih.prototype=Object.assign(Object.create(te.prototype),{constructor:ih,_bindAction:function(t,e){var r=t._localRoot||this._root,i=t._clip.tracks,n=i.length,a=t._propertyBindings,o=t._interpolants,s=r.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==n;++c){var h=i[c],d=h.name,p=u[d];if(void 0!==p)a[c]=p;else{if(void 0!==(p=a[c])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var f=e&&e._propertyBindings[c].binding.parsedPath;++(p=new Bc(eh.create(r,d,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),a[c]=p}o[c].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,i=this._actionsByClip[r];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,r,e)}for(var n=t._propertyBindings,a=0,o=n.length;a!==o;++a){var s=n[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,i=e.length;r!==i;++r){var n=e[r];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var i=this._actions,n=this._actionsByClip,a=n[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[e]=a;else{var o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=i.length,i.push(t),a.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],i=t._cacheIndex;r._cacheIndex=i,e[i]=r,e.pop(),t._cacheIndex=null;var n=t._clip.uuid,a=this._actionsByClip,o=a[n],s=o.knownActions,l=s[s.length-1],u=t._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete a[n],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,i=e.length;r!==i;++r){var n=e[r];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,i=this._nActiveActions++,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=r,e[r]=n},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,i=--this._nActiveActions,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=r,e[r]=n},_addInactiveBinding:function(t,e,r){var i=this._bindingsByRootAndName,n=i[e],a=this._bindings;void 0===n&&(n={},i[e]=n),n[r]=t,t._cacheIndex=a.length,a.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,i=r.rootNode.uuid,n=r.path,a=this._bindingsByRootAndName,o=a[i],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete o[n];t:{for(var u in o)break t;delete a[i]}},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,i=this._nActiveBindings++,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=r,e[r]=n},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,i=--this._nActiveBindings,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=r,e[r]=n},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&((r=new au(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,i=--this._nActiveControlInterpolants,n=e[i];t.__cacheIndex=i,e[i]=t,n.__cacheIndex=r,e[r]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var r=e||this._root,i=r.uuid,n="string"==typeof t?mu.findByName(r,t):t,a=null!==n?n.uuid:t,o=this._actionsByClip[a],s=null;if(void 0!==o){var l=o.actionByRoot[i];if(void 0!==l)return l;s=o.knownActions[0],null===n&&(n=s._clip)}if(null===n)return null;var u=new rh(this,n,e);return this._bindAction(u,s),this._addInactiveAction(u,a,i),u},existingAction:function(t,e){var r=e||this._root,i=r.uuid,n="string"==typeof t?mu.findByName(r,t):t,a=n?n.uuid:t,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,r=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var n=0;n!==e;++n)t[n].reset();for(n=0;n!==i;++n)r[n].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,r=this._nActiveActions,i=this.time+=t,n=Math.sign(t),a=this._accuIndex^=1,o=0;o!==r;++o){e[o]._update(i,t,n,a)}var s=this._bindings,l=this._nActiveBindings;for(o=0;o!==l;++o)s[o].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,i=this._actionsByClip,n=i[r];if(void 0!==n){for(var a=n.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var u=l._cacheIndex,c=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,e[u]=c,e.pop(),this._removeInactiveBindingsForAction(l)}delete i[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var i in r){var n=r[i].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var a=this._bindingsByRootAndName[e];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),nh.prototype.clone=function(){return new nh(void 0===this.value.clone?this.value:this.value.clone())},ah.prototype=Object.assign(Object.create(Hn.prototype),{constructor:ah,isInstancedBufferGeometry:!0,copy:function(t){return Hn.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),oh.prototype=Object.assign(Object.create(fs.prototype),{constructor:oh,isInstancedInterleavedBuffer:!0,copy:function(t){return fs.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),sh.prototype=Object.assign(Object.create(In.prototype),{constructor:sh,isInstancedBufferAttribute:!0,copy:function(t){return In.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(function(t,e,r,i){this.ray=new ha(t,e),this.near=r||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,r){var i=r||[];return uh(t,this,i,e),i.sort(lh),i},intersectObjects:function(t,e,r){var i=r||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,a=t.length;n<a;n++)uh(t[n],this,i,e);return i.sort(lh),i}}),Object.assign(ch.prototype,{set:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+e*e+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(wi.clamp(e/this.radius,-1,1))),this}}),Object.assign(function(t,e,r){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==r?r:0,this}.prototype,{set:function(t,e,r){return this.radius=t,this.theta=e,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=e,this}}),Object.assign(hh.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new ki;return function(e,r){var i=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new ki),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new ki),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new ki),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new ki),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new ki;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(dh.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Mi),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Mi),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Mi),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(qc=new Mi,Zc=new Mi,function(t,e){qc.subVectors(t,this.start),Zc.subVectors(this.end,this.start);var r=Zc.dot(Zc),i=Zc.dot(qc)/r;return e&&(i=wi.clamp(i,0,1)),i}),closestPointToPoint:function(t,e,r){var i=this.closestPointToPointParameter(t,e);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Mi),this.delta(r).multiplyScalar(i).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),ph.prototype=Object.create(wn.prototype),ph.prototype.constructor=ph,ph.prototype.isImmediateRenderObject=!0,fh.prototype=Object.create(Es.prototype),fh.prototype.constructor=fh,fh.prototype.update=function(){var t=new Mi,e=new Mi,r=new Oi;return function(){var i=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var s=o.vertices,l=o.faces,u=0,c=0,h=l.length;c<h;c++)for(var d=l[c],p=0,f=d.vertexNormals.length;p<f;p++){var m=s[d[i[p]]],g=d.vertexNormals[p];t.copy(m).applyMatrix4(n),e.copy(g).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),a.setXYZ(u,t.x,t.y,t.z),u+=1,a.setXYZ(u,e.x,e.y,e.z),u+=1}else if(o&&o.isBufferGeometry){var v=o.attributes.position,b=o.attributes.normal;for(u=0,p=0,f=v.count;p<f;p++)t.set(v.getX(p),v.getY(p),v.getZ(p)).applyMatrix4(n),e.set(b.getX(p),b.getY(p),b.getZ(p)),e.applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),a.setXYZ(u,t.x,t.y,t.z),u+=1,a.setXYZ(u,e.x,e.y,e.z),u+=1}a.needsUpdate=!0}}(),mh.prototype=Object.create(wn.prototype),mh.prototype.constructor=mh,mh.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},mh.prototype.update=function(){var t=new Mi;return function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,r=e*Math.tan(this.light.angle);this.cone.scale.set(r,r,e),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),gh.prototype=Object.create(Es.prototype),gh.prototype.constructor=gh,gh.prototype.updateMatrixWorld=function(){var t=new Mi,e=new rn,r=new rn;return function(i){var n=this.bones,a=this.geometry,o=a.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<n.length;s++){var u=n[s];u.parent&&u.parent.isBone&&(e.multiplyMatrices(r,u.matrixWorld),t.setFromMatrixPosition(e),o.setXYZ(l,t.x,t.y,t.z),e.multiplyMatrices(r,u.parent.matrixWorld),t.setFromMatrixPosition(e),o.setXYZ(l+1,t.x,t.y,t.z),l+=2)}a.getAttribute("position").needsUpdate=!0,wn.prototype.updateMatrixWorld.call(this,i)}}(),vh.prototype=Object.create(fa.prototype),vh.prototype.constructor=vh,vh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},vh.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},bh.prototype=Object.create(Ss.prototype),bh.prototype.constructor=bh,bh.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var t=this.material.color,e=Math.max(t.r,t.g,t.b);e>1&&t.multiplyScalar(1/e),this.children[0].material.color.copy(this.material.color)}},bh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},yh.prototype=Object.create(wn.prototype),yh.prototype.constructor=yh,yh.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},yh.prototype.update=function(){var t=new Mi,e=new hn,r=new hn;return function(){var i=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var n=i.geometry.getAttribute("color");e.copy(this.light.color),r.copy(this.light.groundColor);for(var a=0,o=n.count;a<o;a++){var s=a<o/2?e:r;n.setXYZ(a,s.r,s.g,s.b)}n.needsUpdate=!0}i.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),Ah.prototype=Object.create(fa.prototype),Ah.prototype.constructor=Ah,Ah.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Ah.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},Th.prototype=Object.assign(Object.create(Es.prototype),{constructor:Th,copy:function(t){return Es.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),Ch.prototype=Object.create(Es.prototype),Ch.prototype.constructor=Ch,Sh.prototype=Object.create(Ss.prototype),Sh.prototype.constructor=Sh,Sh.prototype.update=function(){var t,e,r=this.audio,i=this.range,n=this.divisionsInnerAngle,a=this.divisionsOuterAngle,o=wi.degToRad(r.panner.coneInnerAngle),s=wi.degToRad(r.panner.coneOuterAngle),l=o/2,u=s/2,c=0,h=0,d=this.geometry,p=d.attributes.position;function f(r,n,a,o){var s=(n-r)/a;for(p.setXYZ(c,0,0,0),h++,t=r;t<n;t+=s)e=c+h,p.setXYZ(e,Math.sin(t)*i,0,Math.cos(t)*i),p.setXYZ(e+1,Math.sin(Math.min(t+s,n))*i,0,Math.cos(Math.min(t+s,n))*i),p.setXYZ(e+2,0,0,0),h+=3;d.addGroup(c,h,o),c+=h,h=0}d.clearGroups(),f(-u,-l,a,0),f(-l,l,n,1),f(l,u,a,0),p.needsUpdate=!0,o===s&&(this.material[0].visible=!1)},Sh.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()},Eh.prototype=Object.create(Es.prototype),Eh.prototype.constructor=Eh,Eh.prototype.update=function(){var t=new Mi,e=new Mi,r=new Oi;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var i=this.object.matrixWorld,n=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,s=a.faces,l=0,u=0,c=s.length;u<c;u++){var h=s[u],d=h.normal;t.copy(o[h.a]).add(o[h.b]).add(o[h.c]).divideScalar(3).applyMatrix4(i),e.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),n.setXYZ(l,t.x,t.y,t.z),l+=1,n.setXYZ(l,e.x,e.y,e.z),l+=1}n.needsUpdate=!0}}(),wh.prototype=Object.create(wn.prototype),wh.prototype.constructor=wh,wh.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},wh.prototype.update=function(){var t=new Mi,e=new Mi,r=new Mi;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(e,t),this.lightPlane.lookAt(e),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(e),this.targetLine.scale.z=r.length()}}(),kh.prototype=Object.create(Es.prototype),kh.prototype.constructor=kh,kh.prototype.update=function(){var t,e,r=new Mi,i=new Ko;function n(n,a,o,s){r.set(a,o,s).unproject(i);var l=e[n];if(void 0!==l)for(var u=t.getAttribute("position"),c=0,h=l.length;c<h;c++)u.setXYZ(l[c],r.x,r.y,r.z)}return function(){t=this.geometry,e=this.pointMap;i.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),n("c",0,0,-1),n("t",0,0,1),n("n1",-1,-1,-1),n("n2",1,-1,-1),n("n3",-1,1,-1),n("n4",1,1,-1),n("f1",-1,-1,1),n("f2",1,-1,1),n("f3",-1,1,1),n("f4",1,1,1),n("u1",.7,1.1,-1),n("u2",-.7,1.1,-1),n("u3",0,2,-1),n("cf1",-1,0,1),n("cf2",1,0,1),n("cf3",0,-1,1),n("cf4",0,1,1),n("cn1",-1,0,-1),n("cn2",1,0,-1),n("cn3",0,-1,-1),n("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),xh.prototype=Object.create(Es.prototype),xh.prototype.constructor=xh,xh.prototype.update=function(){var t=new Ji;return function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){var r=t.min,i=t.max,n=this.geometry.attributes.position,a=n.array;a[0]=i.x,a[1]=i.y,a[2]=i.z,a[3]=r.x,a[4]=i.y,a[5]=i.z,a[6]=r.x,a[7]=r.y,a[8]=i.z,a[9]=i.x,a[10]=r.y,a[11]=i.z,a[12]=i.x,a[13]=i.y,a[14]=r.z,a[15]=r.x,a[16]=i.y,a[17]=r.z,a[18]=r.x,a[19]=r.y,a[20]=r.z,a[21]=i.x,a[22]=r.y,a[23]=r.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),xh.prototype.setFromObject=function(t){return this.object=t,this.update(),this},xh.prototype.copy=function(t){return Es.prototype.copy.call(this,t),this.object=t.object,this},xh.prototype.clone=function(){return(new this.constructor).copy(this)},Mh.prototype=Object.create(Es.prototype),Mh.prototype.constructor=Mh,Mh.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),wn.prototype.updateMatrixWorld.call(this,t))},Oh.prototype=Object.create(Ss.prototype),Oh.prototype.constructor=Oh,Oh.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?fe:pe,this.lookAt(this.plane.normal),wn.prototype.updateMatrixWorld.call(this,t)},Ih.prototype=Object.create(wn.prototype),Ih.prototype.constructor=Ih,Ih.prototype.setDirection=($c=new Mi,function(t){t.y>.99999?this.quaternion.set(0,0,0,1):t.y<-.99999?this.quaternion.set(1,0,0,0):($c.set(t.z,0,-t.x).normalize(),Jc=Math.acos(t.y),this.quaternion.setFromAxisAngle($c,Jc))}),Ih.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t),void 0===r&&(r=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},Ih.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},Ih.prototype.copy=function(t){return wn.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},Ih.prototype.clone=function(){return(new this.constructor).copy(this)},_h.prototype=Object.create(Es.prototype),_h.prototype.constructor=_h;function Lh(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Ru.call(this,t),this.type="catmullrom"}ku.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(ku.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(ju.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new On,r=0,i=t.length;r<i;r++){var n=t[r];e.vertices.push(new Mi(n.x,n.y,n.z||0))}return e}}),Object.assign(Xu.prototype,{fromPoints:function(t){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),Object.create(Ru.prototype),Object.create(Ru.prototype),Lh.prototype=Object.create(Ru.prototype),Object.assign(Lh.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Th.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},gh.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Sc.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),sc(t)}}),Object.assign(cc.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(hh.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Ji.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),dh.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(wi,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),wi.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),wi.ceilPowerOfTwo(t)}}),Object.assign(Oi.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(rn.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){var t;return function(){return void 0===t&&(t=new Mi),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),t.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,r,i,n,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,r,n,a)}}),tn.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},xi.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(ha.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(da.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(da,{barycoordFromPoint:function(t,e,r,i,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),da.getBarycoord(t,e,r,i,n)},normal:function(t,e,r,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),da.getNormal(t,e,r,i)}}),Object.assign(qu.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Cl(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Rl(this,t)}}),Object.assign(ki.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Mi.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Xi.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(On.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(wn.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(wn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(bs.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(As.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),ys.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(ku.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),Qo.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Zu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(In.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(Hn.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addDrawCall:function(t,e,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Hn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(Sl.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(nh.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Zn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new hn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}}}),Object.defineProperties(Zl.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ca.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(cs.prototype,{clearTarget:function(t,e,r,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,r,i)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")}}),Object.defineProperties(cs.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Yo.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ki.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(qi.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(ls.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),Dc.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new wc).load(t,function(t){e.setBuffer(t)}),this},Nc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Lc.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};Vi.crossOrigin=void 0,Vi.loadTexture=function(t,e,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new wu;n.setCrossOrigin(this.crossOrigin);var a=n.load(t,r,void 0,i);return e&&(a.mapping=e),a},Vi.loadTextureCube=function(t,e,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new Eu;n.setCrossOrigin(this.crossOrigin);var a=n.load(t,r,void 0,i);return e&&(a.mapping=e),a},Vi.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Vi.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var Ph=function(t,e){return(Ph=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Rh(t,e){function r(){this.constructor=t}Ph(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Dh=function(){function t(){this.red=0,this.green=0,this.blue=0,this.opacity=1}return t.of=function(e,r,i){var n=new t;return n.blue=i,n.red=e,n.green=r,n},t.parseRGB=function(e){if(null==e||""===e||"none"===e)return t.NULL;var r=new t;e=e.replace(/ /g,"");var i=Bh.parseParamList(e);if(1==i.length){var n=i[0].replace("#","");r.texture=n}else r.red=parseInt(i[0]),r.green=parseInt(i[1]),r.blue=parseInt(i[2]),r.opacity=4==i.length?parseFloat(i[3]):1;return r},t.prototype.toInt=function(){return 65536*this.red+256*this.green+this.blue},t.prototype.toThreeColor=function(){return new hn(this.toInt())},t.prototype.getId=function(){return null!=this.texture?this.texture:"rgba("+this.red+","+this.green+","+this.blue+","+this.opacity+")"},t.prototype.isTexture=function(){return null!=this.texture},t.prototype.isTransparent=function(){return 1!==this.opacity},t.prototype.cacheMaterial=function(e){(this.isTexture()||t.materials.size<100)&&(t.cache[this.getId()]=e,t.materials.set(e,!0))},t.prototype.createTextureMaterial=function(){var e=this,r="assets/3d/textures/"+t.textureFiles[this.texture],i="assets/3d/normals/"+t.textureFiles[this.texture],n=new wu,a=n.load(r),o=n.load(i,function(t){s.normalMap=t},function(){},function(t){console.log("Color: Normal map not found:",e.texture)});a.wrapS=a.wrapT=hr,o.wrapS=o.wrapT=hr;var s=new Zl({map:a,depthTest:!0});return s},t.prototype.createColorMaterial=function(){var t=Bh.createDefaultMaterial();return this.setupColorMaterial(t),t},t.prototype.setupColorMaterial=function(t){return t.color=this.toThreeColor(),t.transparent=this.isTransparent(),t.opacity=this.opacity,t},t.prototype.getMaterial=function(){var e=t.cache[this.getId()];return null==e&&(e=this.isTexture()?this.createTextureMaterial():this.createColorMaterial(),this.cacheMaterial(e)),e},t.prototype.applyToMaterial=function(t){var e=!this.isNull();e&&(Bh.disposeMaterial(t.material),t.material=this.getMaterial()),t.visible!=e&&(t.visible=e)},t.prototype.isNull=function(){return this===t.NULL},t.textureFiles=[],t.cache=[],t.materials=new Map,t.GRAY=t.of(128,128,128),t.BLACK=t.of(0,0,0),t.SIENNA=t.of(160,82,45),t.WHITE=t.of(255,255,255),t.NULL=new t,t._init=(t.textureFiles.brickRedTexture="brick-red.jpg",t.textureFiles.brickWhiteTexture="brick-white.jpg",t.textureFiles.concreteTexture="concrete.jpg",t.textureFiles.earthTexture="earth.jpg",t.textureFiles.floorCarpetTexture="floor-carpet.jpg",t.textureFiles.floorLinoTexture="floor-lino.jpg",t.textureFiles.floorMetalTexture="floor-metal.jpg",t.textureFiles.floorWoodTexture="floor-wood.jpg",t.textureFiles.grassTexture="grass.jpg",t.textureFiles.gravelTexture="gravel.jpg",t.textureFiles.roofCeramicTexture="roof-ceramic.jpg",t.textureFiles.roofMetalTexture="roof-metal.jpg",t.textureFiles.sandTexture="sand.jpg",t.textureFiles.snowTexture="snow.jpg",t.textureFiles.tarmacTexture="tarmac.jpg",void(t.textureFiles.waterTexture="water.jpg")),t}(),Fh=function(){function t(t){this._planes=t}return t.of=function(e){return new t(e)},Object.defineProperty(t.prototype,"planes",{get:function(){return this._planes},enumerable:!0,configurable:!0}),t.prototype.contains=function(t){return 0!=(this.planes&t)},t.prototype.intersection=function(e){return new t(this.planes&e)},t.prototype.getFaceCount=function(){for(var e=0,r=t.PLANE_ARRAY,i=0;i<r.length;i++)this.contains(r[i])&&(e+=2);return this.contains(t.DOUBLE_SIDE)&&(e*=2),e},t.TOP=1,t.BOTTOM=2,t.LEFT=4,t.RIGHT=8,t.BACK=16,t.FRONT=32,t.DOUBLE_SIDE=1024,t.SIDES=t.TOP|t.BOTTOM|t.LEFT|t.RIGHT,t.ALL=t.TOP|t.BOTTOM|t.LEFT|t.RIGHT|t.FRONT|t.BACK,t.PLANE_ARRAY=[t.TOP,t.BOTTOM,t.LEFT,t.RIGHT,t.FRONT,t.BACK],t.top=t.of(t.TOP),t.all=t.of(t.ALL),t.sides=t.of(t.SIDES),t.none=t.of(0),t}(),Nh=function(){function t(){this.l1=new Mi,this.l2=new Mi,this.r1=new Mi,this.r2=new Mi,this.l1t=new Mi,this.l2t=new Mi,this.r1t=new Mi,this.r2t=new Mi,this.leftNormal=new Mi,this.rightNormal=new Mi,this.backNormal=new Mi,this.frontNormal=new Mi,this.topNormal=new Mi,this.bottomNormal=new Mi,this.UVS=[new ki(0,0),new ki(1,0),new ki(1,1),new ki(0,1)],this.LEFT=[this.l1,this.l2,this.l2t,this.l1t],this.RIGHT=[this.r1,this.r1t,this.r2t,this.r2],this.BACK=[this.l1,this.l1t,this.r1t,this.r1],this.FRONT=[this.r2,this.r2t,this.l2t,this.l2],this.BOTTOM=[this.l2,this.l1,this.r1,this.r2],this.TOP=[this.l1t,this.l2t,this.r2t,this.r1t],this.LEFT_NORMALS=[new Mi,new Mi,new Mi,new Mi],this.RIGHT_NORMALS=[new Mi,new Mi,new Mi,new Mi],this.BACK_NORMALS=[new Mi,new Mi,new Mi,new Mi],this.FRONT_NORMALS=[new Mi,new Mi,new Mi,new Mi],this.BOTTOM_NORMALS=[new Mi,new Mi,new Mi,new Mi],this.TOP_NORMALS=[new Mi,new Mi,new Mi,new Mi],this.VERTICES=this.BOTTOM.concat(this.TOP)}return Object.defineProperty(t,"BOX",{get:function(){return this._box||(this._box=new t),this._box},enumerable:!0,configurable:!0}),t.prototype.getNormal=function(t,e,r){return Bh.isZeroDouble(t.distanceTo(e))?r:Bh.getNormal(t,e)},t.prototype.addPlanes=function(e,r,i){void 0===r&&(r=Fh.all);var n=0;return r.contains(Fh.LEFT)&&(n+=t.addSideVerts(e,r,this.LEFT,this.leftNormals,null!=i?i+n:null)),r.contains(Fh.RIGHT)&&(n+=t.addSideVerts(e,r,this.RIGHT,this.rightNormals,null!=i?i+n:null)),r.contains(Fh.TOP)&&(n+=t.addSideVerts(e,r,this.TOP,this.topNormals,null!=i?i+n:null)),r.contains(Fh.BOTTOM)&&(n+=t.addSideVerts(e,r,this.BOTTOM,this.bottomNormals,null!=i?i+n:null)),r.contains(Fh.BACK)&&(n+=t.addSideVerts(e,r,this.BACK,this.backNormals,null!=i?i+n:null)),r.contains(Fh.FRONT)&&(n+=t.addSideVerts(e,r,this.FRONT,this.frontNormals,null!=i?i+n:null)),n},t.prototype.setupStraitSegment=function(t,e,r,i){var n=this;Bh.getLeftNormal(t,e,this.leftNormal),this.rightNormal.copy(this.leftNormal),this.rightNormal.multiplyScalar(-1),Bh.getNormal(t,e,this.frontNormal),Bh.getNormal(e,t,this.backNormal),this.BACK.forEach(function(e){return e.copy(t)}),this.FRONT.forEach(function(t){return t.copy(e)}),this.LEFT.forEach(function(t){return Bh.translateScaled(t,n.leftNormal,i)}),this.RIGHT.forEach(function(t){return Bh.translateScaled(t,n.leftNormal,-i)}),this.TOP.forEach(function(t){return t.z+=r}),this.topNormal.set(0,0,1),this.bottomNormal.set(0,0,-1),this.setSingleNormals()},t.prototype.setSingleNormals=function(){this.topNormals=[this.topNormal],this.bottomNormals=[this.bottomNormal],this.leftNormals=[this.leftNormal],this.rightNormals=[this.rightNormal],this.frontNormals=[this.frontNormal],this.backNormals=[this.backNormal]},t.prototype.setupTrianglePrism=function(t,e,r,i){this.r1.copy(r),this.r2.copy(r),this.l1.copy(t),this.l2.copy(e),this.updateTopPlane(i),this.topNormal.set(0,0,1),this.bottomNormal.set(0,0,-1),Bh.getNormal(t,r,this.rightNormal),Bh.getLeftNormal(r,t,this.backNormal),Bh.getLeftNormal(e,r,this.frontNormal),this.setSingleNormals(),Bh.getNormal(r,t,this.LEFT_NORMALS[0]),Bh.getNormal(r,e,this.LEFT_NORMALS[1]),Bh.getNormal(r,e,this.LEFT_NORMALS[2]),Bh.getNormal(r,t,this.LEFT_NORMALS[3]),this.leftNormals=this.LEFT_NORMALS},t.prototype.setupPrism=function(t,e,r,i,n,a){this.r1.copy(r),this.r2.copy(i),this.l1.copy(t),this.l2.copy(e),this.updateTopPlane(0),this.TOP.forEach(function(t){return Bh.translateScaled(t,n,a)}),this.topNormal.copy(n),this.bottomNormal.copy(this.topNormal).multiplyScalar(-1);var o=Bh.getNormal(r,t),s=Bh.getNormal(i,e);this.backNormal.crossVectors(n,o),this.frontNormal.crossVectors(s,n),this.setSingleNormals(),Bh.getNormal(r,t,this.LEFT_NORMALS[0]),Bh.getNormal(i,e,this.LEFT_NORMALS[1]),Bh.getNormal(i,e,this.LEFT_NORMALS[2]),Bh.getNormal(r,t,this.LEFT_NORMALS[3]),this.leftNormals=this.LEFT_NORMALS,Bh.getNormal(t,r,this.RIGHT_NORMALS[0]),Bh.getNormal(t,r,this.RIGHT_NORMALS[1]),Bh.getNormal(e,i,this.RIGHT_NORMALS[2]),Bh.getNormal(e,i,this.RIGHT_NORMALS[3]),this.rightNormals=this.RIGHT_NORMALS},t.prototype.setupBox=function(t,e,r,i,n){var a=this;Bh.getLeftNormal(t,e,this.leftNormal),0==this.leftNormal.length()&&null!=n&&this.leftNormal.copy(n),this.rightNormal.copy(this.leftNormal).multiplyScalar(-1),Bh.getNormal(t,e,this.frontNormal),Bh.getNormal(e,t,this.backNormal),this.topNormal.crossVectors(this.rightNormal,this.frontNormal),this.bottomNormal.copy(this.topNormal).multiplyScalar(-1),this.setSingleNormals(),this.BACK.forEach(function(e){return e.copy(t)}),this.FRONT.forEach(function(t){return t.copy(e)}),this.LEFT.forEach(function(t){return Bh.translateScaled(t,a.leftNormal,r/2)}),this.RIGHT.forEach(function(t){return Bh.translateScaled(t,a.leftNormal,-r/2)}),this.TOP.forEach(function(t){return Bh.translateScaled(t,a.topNormal,i/2)}),this.BOTTOM.forEach(function(t){return Bh.translateScaled(t,a.topNormal,-i/2)})},t.prototype.setupParallel=function(t,e,r,i,n,a){var o=this;this.rightNormal.copy(e),this.frontNormal.copy(r),this.topNormal.crossVectors(e,r),this.leftNormal.copy(this.rightNormal).multiplyScalar(-1),this.backNormal.copy(this.frontNormal).multiplyScalar(-1),this.bottomNormal.copy(this.topNormal).multiplyScalar(-1),this.setSingleNormals(),this.VERTICES.forEach(function(e){return e.copy(t)}),this.LEFT.forEach(function(t){return Bh.translateScaled(t,o.leftNormal,i/2)}),this.RIGHT.forEach(function(t){return Bh.translateScaled(t,o.rightNormal,i/2)}),this.BACK.forEach(function(t){return Bh.translateScaled(t,o.backNormal,a/2)}),this.FRONT.forEach(function(t){return Bh.translateScaled(t,o.frontNormal,a/2)}),this.TOP.forEach(function(t){return Bh.translateScaled(t,o.topNormal,n/2)}),this.BOTTOM.forEach(function(t){return Bh.translateScaled(t,o.bottomNormal,n/2)})},t.prototype.updateTopPlane=function(t){this.l1t.copy(this.l1),this.l2t.copy(this.l2),this.r1t.copy(this.r1),this.r2t.copy(this.r2),this.TOP.forEach(function(e){return e.z+=t})},t.prototype.setupArc=function(t,e,r,i,n,a,o,s,l,u,c){var h=this,d=Math.cos(a),p=Math.sin(a),f=Math.cos(a+o),m=Math.sin(a+o),g=o>0,v=g?this.r1:this.l1,b=g?this.r2:this.l2,y=g?this.l1:this.r1,A=g?this.l2:this.r2,T=this.backNormal,C=this.frontNormal;v.set(t*d+s,e*p+l,u),b.set(t*f+s,e*m+l,c),y.set(r*d+s,i*p+l,u),A.set(r*f+s,i*m+l,c),this.updateTopPlane(n),this.topNormal.set(0,0,1),this.bottomNormal.set(0,0,-1),Bh.getLeftNormal(y,v,T),Bh.getLeftNormal(b,A,C),this.setSingleNormals(),Bh.getNormal(y,v,this.LEFT_NORMALS[0]),Bh.getNormal(A,b,this.LEFT_NORMALS[1]),Bh.getNormal(A,b,this.LEFT_NORMALS[2]),Bh.getNormal(y,v,this.LEFT_NORMALS[3]),this.leftNormals=this.LEFT_NORMALS,Bh.getNormal(v,y,this.RIGHT_NORMALS[0]),Bh.getNormal(v,y,this.RIGHT_NORMALS[1]),Bh.getNormal(b,A,this.RIGHT_NORMALS[2]),Bh.getNormal(b,A,this.RIGHT_NORMALS[3]),this.rightNormals=this.RIGHT_NORMALS,this.TOP_NORMALS.forEach(function(t){return t.copy(h.topNormal)}),this.topNormals=this.TOP_NORMALS,this.BOTTOM_NORMALS.forEach(function(t){return t.copy(h.bottomNormal)}),this.bottomNormals=this.BOTTOM_NORMALS},t.prototype.updateTopNormals=function(t,e){var r=Bh.getNormal(t,e),i=Bh.getLeftNormal(t,e);r.cross(i),this.topNormal.copy(r),this.bottomNormal.copy(this.topNormal),this.bottomNormal.multiplyScalar(-1)},t.addSideVerts=function(e,r,i,n,a){var o=r.contains(Fh.DOUBLE_SIDE),s=t.addVerts(e,i,n,!1,a);return o&&(s+=t.addVerts(e,i,n,!0,null!=a?a+s:null)),s},t.addVerts=function(t,e,r,i,n){var a,o,s;void 0===i&&(i=!1);var l=e.length>3,u=i?-1:1;if(null==r||1==r.length){var c=null!=r?r[0].clone():Bh.getPlaneNormal(new Mi,e);c.multiplyScalar(u),o=c,s=c.clone()}else{var h=r[0].clone(),d=r[1].clone(),p=r[2].clone();if((o=[h,p,d]).forEach(function(t){return t.multiplyScalar(u)}),l){var f=r[3].clone();s=[h,f,p],f.multiplyScalar(u)}}if(null!=n){var m=t.faces[n],g=i?m.a-2:m.a;m.normal=o,l&&(t.faces[n+1].normal=s);for(var v=0;v<e.length;v++)t.vertices[g+v].copy(e[v])}else{var b=g=t.vertices.length,y=g+2;i&&(b=(a=[y,b])[0],y=a[1]),t.faces.push(new vn(b,y,g+1,o)),l&&t.faces.push(new vn(b,g+3,y,s)),e.forEach(function(e){return t.vertices.push(e.clone())})}return l?2:1},t.prototype.pushFaces=function(t,e){var r=new vn(e,e+3,e+2),i=new vn(e,e+2,e+1);t.push(r,i)},t.prototype.createGeometry=function(t){var e=new On;return this.addPlanes(e,t),Bh.calculateTextureUVS(e),e},t}(),Bh=function(){function t(){}return t.getSharedMaterial=function(){return null==t.SHARED_MATERIAL&&(t.SHARED_MATERIAL=new Jl),t.SHARED_MATERIAL},t.getSharedGeometry=function(){return null==t.SHARED_GEOMETRY&&(t.SHARED_GEOMETRY=new Hn),t.SHARED_GEOMETRY},t.getSpecularColor=function(){return null==t.SPECULAR_COLOR&&(t.SPECULAR_COLOR=new hn(1118481)),t.SPECULAR_COLOR},t.createDefaultMaterial=function(){return new Zl({shininess:50})},t.createMesh=function(){return new fa(t.getSharedGeometry(),t.getSharedMaterial())},t.applyMatrix=function(t,e){t.matrix=new rn,t.applyMatrix(e)},t.applyTransform=function(e,r,i){t.applyMatrix(e,t.parseMatrix(r,i))},t.parseParamList=function(t){return t.replace(/[^()]+\(([^()]+)\)/,function(t,e){return e}).split(",")},t.parseMatrix=function(t,e){var r=new rn;return t.replace(/ /g,"").replace(/matrix\(([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+)\)/,function(t,i,n,a,o,s,l){var u=Number.parseFloat(i),c=Number.parseFloat(n),h=Number.parseFloat(a),d=Number.parseFloat(o),p=Number.parseFloat(s),f=-Number.parseFloat(l);return r.set(u,c,0,p,h,d,0,f,0,0,1,e,0,0,0,1),""}),r},t.setCell=function(t,e,r,i){t.elements[4*e+r]=i},t.getAttributeValue=function(t,e){var r=t.att.indexOf(e);return r<0?null:t.val[r]},t.getShapeType=function(e){return t.getAttributeValue(e,"shape-type")},t.cross2D=function(t,e,r){var i=e.x-t.x,n=r.x-t.x,a=e.y-t.y;return i*(r.y-t.y)-a*n},t.dot2D=function(t,e,r){return(e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y)},t.isRightOriented=function(e,r,i){return t.cross2D(e,r,i)>0},t.isZeroDouble=function(t){return Math.abs(t)<1e-6},t.greaterDouble=function(e,r){return!t.isZeroDouble(Math.abs(e-r))&&e>r},t.greaterEqualsDouble=function(e,r){return t.equalsDouble(e,r)||e>r},t.equalsDouble=function(e,r){return t.isZeroDouble(Math.abs(e-r))},t.getNormal=function(e,r,i){return null==i&&(i=new Mi),i.set(r.x,r.y,r.z),i.sub(e),t.normalize(i)},t.normalize=function(e){return t.isZeroDouble(e.length())?e.set(0,0,0):e.normalize(),e},t.getPlaneNormal=function(e,r){var i=r[0],n=r[1],a=r[2],o=t.getNormal(n,i),s=t.getNormal(a,i);if(e.crossVectors(o,s),r.length>3&&t.isZeroDouble(e.length())){var l=r[3];t.getNormal(a,l,o),t.getNormal(n,l,s),e.crossVectors(o,s)}return e},t.getLeftNormal=function(e,r,i){return null==i&&(i=new Mi),i.set(-(r.y-e.y),r.x-e.x,0),t.normalize(i)},t.getTranslated=function(e,r,i){return t.translateScaled(e.clone(),r,i)},t.translateScaled=function(t,e,r){return t.x+=e.x*r,t.y+=e.y*r,t.z+=e.z*r,t},t.getPointOnLine=function(e,r,i,n){void 0===n&&(n=!1);var a=n?i:i*e.distanceTo(r);return t.translateScaled(e.clone(),t.getNormal(e,r),a)},t.setSum=function(t,e,r){return t.copy(e),t.add(r),t},t.crossProduct=function(t,e,r,i,n,a){return(r-t)*(a-e)-(i-e)*(n-t)},t.genUVS=function(e,r,i,n,a){r.forEach(function(r){var o=[];a.push(o);var s,l,u=e[r.a],c=e[r.b],h=e[r.c],d=[u,c,h];if(u.x==c.x&&u.y==c.y?(s=h.x-u.x,l=h.y-u.y):(u.x==h.x&&u.y==h.y||c.x==h.x&&c.y==h.y)&&(s=c.x-u.x,l=c.y-u.y),null!=s)for(var p=Math.hypot(s,l),f=(s/=p)*i,m=(l/=p)*n,g=0;g<d.length;g++){var v=(d[g].x-u.x)*f+(d[g].y-u.y)*m,b=(d[g].z-u.z)*n;o.push(new ki(v,b))}else{var y=t.crossProduct(u.x,u.y,c.x,c.y,h.x,h.y)>0?n:-n;for(g=0;g<d.length;g++){v=d[g].x*i,b=d[g].y*y;o.push(new ki(v,b))}}})},t.calculateTextureUVS=function(e){var r=e.faceVertexUvs[0];e.computeFaceNormals();t.genUVS(e.vertices,e.faces,8/256,8/256,r)},t.getFaceCount=function(e,r,i,n,a,o,s){void 0===r&&(r=t.TAU),void 0===i&&(i=0),void 0===n&&(n=3),void 0===a&&(a=4),void 0===o&&(o=32),void 0===s&&(s=!1);var l=Math.hypot(r*e,i)/n,u=Math.ceil(l);return s&&(u=4*Math.ceil(l/4)),u=Math.min(o,Math.max(a,u))},t.disposeMesh=function(e){null!=e&&(t.disposeMaterial(e.material),t.disposeGeometry(e.geometry))},t.disposeGeometry=function(e){null!=e&&e!==t.getSharedGeometry()&&e.dispose()},t.disposeMaterial=function(e){[].concat(e).forEach(function(e){return t.disposeSingleMaterial(e)})},t.disposeSingleMaterial=function(e){null!=e&&(Dh.materials.get(e)||e===t.getSharedMaterial()||e.dispose())},t.wipeObject3D=function(e){var r=[];e.traverse(function(t){return r.push(t)}),r.forEach(function(e){return t.wipeObject(e)})},t.wipeObject=function(t){for(var e in t){var r=Object.getOwnPropertyDescriptor(t,e);r&&r.writable&&"children"!=e&&"parent"!=e&&delete t[e]}},t.getDistincColor=function(t){var e=new Dh;e.opacity=t.opacity;var r=Math.round((t.red+t.green+t.blue)/3);return r=(r+87)%256,e.red=r,e.green=r,e.blue=r,e},t.round=function(t,e){var r=Math.pow(10,e);return Math.round(t*r)/r},t.getPointOnSpere=function(e,r){var i=Math.abs(e);e<0&&(r+=Math.PI),(i%=t.TAU)>Math.PI&&(i=t.TAU-i,r+=Math.PI);var n=new ch(1,i,r%=t.TAU);n.makeSafe();var a=(new Mi).setFromSpherical(n);return new Mi(a.z,a.x,a.y)},t.createDefaultLight=function(t){void 0===t&&(t=.4);var e=new Zo;e.position.set(0,0,500);var r=new ic(16777215,t);r.position.set(0,1e3,0),e.add(r);var i=new ic(16777215,t);i.position.set(0,-1e3,0),e.add(i);var n=new ic(16777215,t);n.position.set(1e3,0,0),e.add(n);var a=new ic(16777215,t);return a.position.set(-1e3,0,0),e.add(a),e},t.addBulks=function(e,r,i){for(var n=0;n<r.length/2;n++){var a=r[2*n],o=r[2*n+1];Nh.BOX.setupBox(a,o,i,i,t.LEFT),Nh.BOX.addPlanes(e)}},t.getSize=function(e,r,i){if(null==e)return[0,0];if(r+=1,e instanceof fa&&(i+=1),e.children.length>0)for(var n=0;n<e.children.length;n++){var a=t.getSize(e.children[n],0,0);r+=a[0],i+=a[1]}return[r,i]},t.hash=function(t){for(var e=5381,r=t.length;r;)e=33*e^t.charCodeAt(--r);return e>>>0},t.debugServer=!1,t.debugInfo=!1,t.imageCache=[],t.TAU=2*Math.PI,t.LEFT=new Mi(0,-1,0),t.RIGHT=new Mi(0,1,0),t.FRONT=new Mi(1,0,0),t.DX=[-1,1,1,-1],t.DY=[1,1,-1,-1],t}(),Gh=function(){return function(t){var e;this.x=0,this.y=0,this.horizontalAngle=0,this.verticalAngle=0,e=t.split(":").map(Number),this.x=e[0],this.y=e[1],this.horizontalAngle=e[2],this.verticalAngle=e[3]}}(),Uh=function(){function t(t){this._visible=!0,this._x=0,this._y=0,this._z=0,this._rotation=0,this._rotationX=0,this._rotationY=0,this._scaleX=1,this._scaleY=1,this._scaleZ=1,this.id=t.id}return Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible=e,this.setDirty3D(t.DIRTY_3D_VISIBILITY)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleX",{get:function(){return this._scaleX},set:function(e){this._scaleX=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleY",{get:function(){return this._scaleY},set:function(e){this._scaleY=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleZ",{get:function(){return this._scaleZ},set:function(e){this._scaleZ=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationX",{get:function(){return this._rotationX},set:function(e){this._rotationX=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),t.prototype.create3D=function(){this.element=new wn,this.element.name=this.constructor.name+":"+this.id},t.prototype.updateParameters=function(t){for(var e=0;e<t.att.length;e++)this.updateParameter(t.att[e],t.val[e])},t.prototype.updateParameter=function(e,r){if("pos"===e){var i=r.split(":");this.x=parseFloat(i[0]),this.y=-parseFloat(i[1]),this.rotation=-parseFloat(i[2])}if("scale"===e){i=r.split(":");this.scaleX=parseFloat(i[0]),this.scaleY=parseFloat(i[1])}if("3d-rot"===e){i=r.split(":");this.rotationX=parseFloat(i[0]),this.rotationY=parseFloat(i[1])}"3d-z"==e&&(this.z=parseFloat(r)),"3d-scale-z"==e&&(this.scaleZ=parseFloat(r)),"visibility"==e&&(this.visible="inherit"==r),"3d-slope"===e&&(this.slope=new Gh(r),this.setDirty3D(t.DIRTY_3D_TRANSFORM))},t.prototype.setRotationMatrix=function(){t.mZ.makeRotationAxis(t.oZ,this.rotation);var e=0,r=0,i=0,n=0,a=0,o=0,s=0,l=0,u=0;if(0==this.rotationY)a=u=Math.cos(this.rotationX),l=-(o=Math.sin(this.rotationX)),e=1,r=i=n=s=0;else if(0==this.rotationX)e=u=Math.cos(this.rotationY),s=-(i=Math.sin(this.rotationY)),a=1,r=n=o=l=0;else{var c=Math.cos(this.rotationX),h=Math.sin(this.rotationX),d=Math.cos(this.rotationY),p=Math.sin(this.rotationY);e=d,r=0,i=p,n=h*-p,a=c,o=h*d,s=c*-p,l=-h,u=c*d}t.mXY.set(e,r,i,0,n,a,o,0,s,l,u,0,0,0,0,1);var f=t.mZ.multiply(t.mXY);this.element.setRotationFromMatrix(f),this.element.updateMatrixWorld(!1)},t.prototype.transformSlope=function(t){var e=t.horizontalAngle,r=t.verticalAngle,i=t.x,n=t.y,a=Math.abs(Math.cos(e))>Math.abs(Math.sin(e)),o=new rn;o.set(1,0,0,i,0,1,0,-n,0,0,1,0,0,0,0,1);var s=new rn;s.set(1,0,0,-i,0,1,0,n,0,0,1,0,0,0,0,1);var l=new rn,u=Math.cos(r),c=Math.sin(r),h=0==u?1:1/u,d=a?h:1,p=a?1:h;l.set(d,0,0,0,0,p,0,0,0,0,1,0,0,0,0,1);var f=new rn;return f.identity(),a?(Bh.setCell(f,0,0,u),Bh.setCell(f,0,2,c),Bh.setCell(f,2,0,-c)):(Bh.setCell(f,1,1,u),Bh.setCell(f,1,2,-c),Bh.setCell(f,2,1,c)),Bh.setCell(f,2,2,u),o.multiply(f).multiply(l).multiply(s)},t.prototype.update3D=function(){if(this.isDirty3DSet(t.DIRTY_3D_TRANSFORM)&&(0==this.rotationX&&0==this.rotationY?this.element.rotation.set(this.rotationX,this.rotationY,this.rotation):this.setRotationMatrix(),this.element.position.set(this.x,this.y,this.z),this.element.scale.set(this.scaleX,this.scaleY,this.scaleZ),null!=this.slope)){this.element.updateMatrixWorld(!0);var e=this.transformSlope(this.slope),r=this.element.matrix.clone(),i=(new rn).getInverse(r);this.element.applyMatrix(i),this.element.applyMatrix(e),this.element.applyMatrix(r)}this.isDirty3DSet(t.DIRTY_3D_VISIBILITY)&&(this.element.visible=this.visible)},t.prototype.updateElement=function(t){this.updateParameters(t);try{this.update3D()}catch(t){console.error("ShapeBase3D:",this.id,t)}this.dirtyState3D=0},t.prototype.isDirty3DSet=function(t){return(this.dirtyState3D&t)===t},t.prototype.setDirty3D=function(t){this.dirtyState3D|=t},t.prototype.dispose=function(){var t=this.element.parent;null!=t&&t.remove(this.element),null!=this.element&&(this.element.traverse(function(t){t instanceof fa&&Bh.disposeMesh(t)}),Bh.wipeObject3D(this.element)),Bh.wipeObject(this)},t.prototype.createMesh=function(t){void 0===t&&(t=!1);var e=Bh.createMesh();return t&&(e.material=Bh.createDefaultMaterial()),this.element.add(e),e},t.mZ=new rn,t.mXY=new rn,t.oZ=new Mi(0,0,1),t.DIRTY_3D_NOT_CREATED=1,t.DIRTY_3D_VISIBILITY=2,t.DIRTY_3D_OWNER=4,t.DIRTY_3D_TRANSFORM=8,t.DIRTY_3D_VERTICAL_ROTATION=16,t.DIRTY_3D_FONT=32,t.DIRTY_3D_TEXT=64,t.DIRTY_3D_COLOR=128,t.DIRTY_3D_LINE_COLOR=256,t.DIRTY_3D_FILL_COLOR=512,t.DIRTY_3D_SHAPE=1024,t.DIRTY_3D_IMAGE=2048,t.DIRTY_3D_REFERENCE=4096,t.DIRTY_3D_CAMERA=8192,t.DIRTY_3D_CLIP_DISTANCE=16384,t}(),zh=function(t,e){var r,i,n,a,o;this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.target=new Mi,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:ae,MIDDLE:oe,RIGHT:se},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),d=h.NONE},this.update=(r=new Mi,i=(new xi).setFromUnitVectors(t.up,new Mi(0,1,0)),n=i.clone().inverse(),a=new Mi,o=new xi,function(){var t=s.object.position;return r.copy(t).sub(s.target),r.applyQuaternion(i),f.setFromVector3(r),s.autoRotate&&d===h.NONE&&O(2*Math.PI/60/60*s.autoRotateSpeed),f.theta+=m.theta,f.phi+=m.phi,f.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,f.theta)),f.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=g,f.radius=Math.max(s.minDistance,Math.min(s.maxDistance,f.radius)),s.target.add(v),r.setFromSpherical(f),r.applyQuaternion(n),t.copy(s.target).add(r),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,v.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),v.set(0,0,0)),g=1,!!(b||a.distanceToSquared(s.object.position)>p||8*(1-o.dot(s.object.quaternion))>p)&&(s.dispatchEvent(l),a.copy(s.object.position),o.copy(s.object.quaternion),b=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",j,!1),s.domElement.removeEventListener("mousedown",B,!1),s.domElement.removeEventListener("wheel",z,!1),s.domElement.removeEventListener("touchstart",H,!1),s.domElement.removeEventListener("touchend",Y,!1),s.domElement.removeEventListener("touchmove",V,!1),document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",U,!1),window.removeEventListener("keydown",W,!1)};var s=this,l={type:"change"},u={type:"start"},c={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},d=h.NONE,p=1e-6,f=new ch,m=new ch,g=1,v=new Mi,b=!1,y=new ki,A=new ki,T=new ki,C=new ki,S=new ki,E=new ki,w=new ki,k=new ki,x=new ki;function M(){return Math.pow(.95,s.zoomSpeed)}function O(t){m.theta-=t}function I(t){m.phi-=t}var _,L=(_=new Mi,function(t,e){_.setFromMatrixColumn(e,0),_.multiplyScalar(-t),v.add(_)}),P=function(){var t=new Mi;return function(e,r){!0===s.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(s.object.up,t)),t.multiplyScalar(e),v.add(t)}}(),R=function(){var t=new Mi;return function(e,r){var i=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var n=s.object.position;t.copy(n).sub(s.target);var a=t.length();a*=Math.tan(s.object.fov/2*Math.PI/180),L(2*e*a/i.clientHeight,s.object.matrix),P(2*r*a/i.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(L(e*(s.object.right-s.object.left)/s.object.zoom/i.clientWidth,s.object.matrix),P(r*(s.object.top-s.object.bottom)/s.object.zoom/i.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function D(t){s.object.isPerspectiveCamera?g/=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*t)),s.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function F(t){s.object.isPerspectiveCamera?g*=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/t)),s.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function N(t){C.set(t.clientX,t.clientY)}function B(t){if(!1!==s.enabled){switch(t.preventDefault(),s.domElement.focus?s.domElement.focus():window.focus(),t.button){case s.mouseButtons.LEFT:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===s.enablePan)return;N(t),d=h.PAN}else{if(!1===s.enableRotate)return;!function(t){y.set(t.clientX,t.clientY)}(t),d=h.ROTATE}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;!function(t){w.set(t.clientX,t.clientY)}(t),d=h.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enablePan)return;N(t),d=h.PAN}d!==h.NONE&&(document.addEventListener("mousemove",G,!1),document.addEventListener("mouseup",U,!1),s.dispatchEvent(u))}}function G(t){if(!1!==s.enabled)switch(t.preventDefault(),d){case h.ROTATE:if(!1===s.enableRotate)return;!function(t){A.set(t.clientX,t.clientY),T.subVectors(A,y).multiplyScalar(s.rotateSpeed);var e=s.domElement===document?s.domElement.body:s.domElement;O(2*Math.PI*T.x/e.clientHeight),I(2*Math.PI*T.y/e.clientHeight),y.copy(A),s.update()}(t);break;case h.DOLLY:if(!1===s.enableZoom)return;!function(t){k.set(t.clientX,t.clientY),x.subVectors(k,w),x.y>0?D(M()):x.y<0&&F(M()),w.copy(k),s.update()}(t);break;case h.PAN:if(!1===s.enablePan)return;!function(t){S.set(t.clientX,t.clientY),E.subVectors(S,C).multiplyScalar(s.panSpeed),R(E.x,E.y),C.copy(S),s.update()}(t)}}function U(t){!1!==s.enabled&&(document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",U,!1),s.dispatchEvent(c),d=h.NONE)}function z(t){!1===s.enabled||!1===s.enableZoom||d!==h.NONE&&d!==h.ROTATE||(t.preventDefault(),t.stopPropagation(),s.dispatchEvent(u),function(t){t.deltaY<0?F(M()):t.deltaY>0&&D(M()),s.update()}(t),s.dispatchEvent(c))}function W(t){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(t){var e=!1;switch(t.keyCode){case s.keys.UP:R(0,s.keyPanSpeed),e=!0;break;case s.keys.BOTTOM:R(0,-s.keyPanSpeed),e=!0;break;case s.keys.LEFT:R(s.keyPanSpeed,0),e=!0;break;case s.keys.RIGHT:R(-s.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),s.update())}(t)}function H(t){if(!1!==s.enabled){switch(t.preventDefault(),t.touches.length){case 1:if(!1===s.enableRotate)return;!function(t){y.set(t.touches[0].pageX,t.touches[0].pageY)}(t),d=h.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(t){if(s.enableZoom){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+r*r);w.set(0,i)}if(s.enablePan){var n=.5*(t.touches[0].pageX+t.touches[1].pageX),a=.5*(t.touches[0].pageY+t.touches[1].pageY);C.set(n,a)}}(t),d=h.TOUCH_DOLLY_PAN;break;default:d=h.NONE}d!==h.NONE&&s.dispatchEvent(u)}}function V(t){if(!1!==s.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===s.enableRotate)return;if(d!==h.TOUCH_ROTATE)return;!function(t){A.set(t.touches[0].pageX,t.touches[0].pageY),T.subVectors(A,y).multiplyScalar(s.rotateSpeed);var e=s.domElement===document?s.domElement.body:s.domElement;O(2*Math.PI*T.x/e.clientHeight),I(2*Math.PI*T.y/e.clientHeight),y.copy(A),s.update()}(t);break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(d!==h.TOUCH_DOLLY_PAN)return;!function(t){if(s.enableZoom){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+r*r);k.set(0,i),x.set(0,Math.pow(k.y/w.y,s.zoomSpeed)),D(x.y),w.copy(k)}if(s.enablePan){var n=.5*(t.touches[0].pageX+t.touches[1].pageX),a=.5*(t.touches[0].pageY+t.touches[1].pageY);S.set(n,a),E.subVectors(S,C).multiplyScalar(s.panSpeed),R(E.x,E.y),C.copy(S)}s.update()}(t);break;default:d=h.NONE}}function Y(t){!1!==s.enabled&&(s.dispatchEvent(c),d=h.NONE)}function j(t){!1!==s.enabled&&t.preventDefault()}s.domElement.addEventListener("contextmenu",j,!1),s.domElement.addEventListener("mousedown",B,!1),s.domElement.addEventListener("wheel",z,!1),s.domElement.addEventListener("touchstart",H,!1),s.domElement.addEventListener("touchend",Y,!1),s.domElement.addEventListener("touchmove",V,!1),window.addEventListener("keydown",W,!1),this.update()};(zh.prototype=Object.create(te.prototype)).constructor=zh,Object.defineProperties(zh.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}});var Wh=function(t){function e(r){var i=t.call(this,r)||this;return i.farClippingDistance=4e4,i.showStats=!1,i.active=!0,i.controlsActive=!0,i.renderActive=!0,i.smoothFrame=0,i.smootCamera=!0,i.transitionTimeout=-1,i.navigationMode=e.NAVIGATION_FULL,i.cameraX=0,i.cameraY=0,i.cameraZ=0,i.cameraRotX=0,i.cameraRotZ=0,i.cameraPositionInit=!1,i.backgroundColor=e.DEFAULT_COLOR,i.look=new Mi,i.times=new Array(20).fill(0),i.timesCnt=0,i.runCallback=function(){return i.run()},i}return Rh(e,t),e.prototype.showCamera=function(){this.cameraDebug&&this.scene.remove(this.cameraDebug),this.cameraDebug=new wn,this.scene.add(this.cameraDebug);var t=new Cs({color:255}),e=new On,r=this.camera.position.clone();e.vertices.push(r,this.look);var i=new Ss(e,t),n=new fa(new Ml(2,10,10),new Zl({color:16755404}));n.position.copy(r),this.cameraDebug.add(n),this.cameraDebug.add(i)},e.prototype.create3D=function(){this.createCamera()},e.prototype.updateParameter=function(t,e){if("3d-camera"===t){var r=e.split(",").map(Number);this.cameraX=r[0],this.cameraY=r[1],this.cameraZ=r[2],this.cameraRotX=r[3],this.cameraRotZ=r[4],this.cameraY=-this.cameraY,this.cameraRotX=Math.PI/2+this.cameraRotX,this.cameraRotZ=-this.cameraRotZ,this.setDirty3D(Uh.DIRTY_3D_CAMERA)}"3d-camera-smooth"===t&&(this.smootCamera="true"===e,this.setDirty3D(Uh.DIRTY_3D_CAMERA)),"3d-transition-timeout"===t&&(this.transitionTimeout=parseFloat(e),this.setDirty3D(Uh.DIRTY_3D_CAMERA)),"3d-far-clipping-distance"===t&&(this.farClippingDistance=parseFloat(e),this.setDirty3D(Uh.DIRTY_3D_CLIP_DISTANCE)),"3d-navigation-mode"===t&&(this.navigationMode=e)},e.prototype.update3D=function(){if(this.isDirty3DSet(Uh.DIRTY_3D_CAMERA)){this.transitionTimeout>0?this.smoothFrame=Math.round(this.transitionTimeout/1e3*30):this.smoothFrame=this.cameraPositionInit&&this.smootCamera?30:1,this.transitionTimeout=-1}this.isDirty3DSet(Uh.DIRTY_3D_CLIP_DISTANCE)&&null!=this.camera&&(this.camera.far=this.farClippingDistance,this.camera.updateProjectionMatrix())},e.prototype.updateCameraSmooth=function(t){var e=new Mi(this.cameraX,this.cameraY,this.cameraZ),r=new Mi,i=Bh.getPointOnSpere(this.cameraRotX,this.cameraRotZ),n=Math.abs(i.z),a=n>.001?Math.abs(e.z)/n:100;i.multiplyScalar(a);var o=new Mi;this.camera.getWorldDirection(o);var s=new Mi;s.copy(this.camera.position),Bh.translateScaled(s,o,a),r.copy(e),r.add(i);var l=Bh.getNormal(s,r),u=s.distanceTo(r);r.copy(s),Bh.translateScaled(r,l,u/t);var c=Bh.getNormal(this.camera.position,e),h=this.camera.position.distanceTo(e);e.copy(this.camera.position),Bh.translateScaled(e,c,h/t),this.camera.position.copy(e),this.controls&&this.controls.target.copy(r),this.camera.lookAt(r),this.camera.updateProjectionMatrix(),this.cameraPositionInit=!0},e.prototype.updateCamera=function(){this.camera.position.set(this.cameraX,this.cameraY,this.cameraZ);var t=new ch(1,this.cameraRotX,this.cameraRotZ);t.makeSafe();var e=(new Mi).setFromSpherical(t),r=new Mi(e.z,e.x,e.y),i=Math.abs(r.z),n=i>.001?this.camera.position.z/i:100;r.multiplyScalar(n),this.look.copy(this.camera.position),this.look.add(r),this.controls&&this.controls.target.copy(this.look),this.camera.lookAt(this.look),this.camera.updateProjectionMatrix()},e.prototype.dispose=function(){this.active=!1},e.prototype.setup=function(t,e){return this.scene=t.scene,this.backgroundColor=t.backgroundColor,this._canvas=e,this},Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),e.prototype.init=function(){var t=this;window.cwindow=this,window.showStats=function(){t.showStats=!0,t.createStats()},this.width=this._canvas.offsetWidth,this.height=this._canvas.offsetHeight,this.renderer=new cs({antialias:!0,canvas:this._canvas,logarithmicDepthBuffer:!1}),this.renderer.setSize(this.width,this.height),this.renderer.setClearColor(this.backgroundColor,1),this.createCamera(),this.scene.add(this.camera),this.createOrbitControls(),this.showStats&&this.createStats(),this.run()},e.prototype.createCamera=function(){if(null==this.camera){this.camera=new Qo(45,this.width/this.height,.3,this.farClippingDistance);var t=this.camera;t.position.set(150,-400,350),t.rotation.set(.85,.17,0),t.up.set(0,0,1)}},e.prototype.createStats=function(){this.stats=new Stats;var t=this.stats;t.domElement.style.position="absolute",t.domElement.style.top="0px",t.domElement.style.right="0px",t.domElement.style.zIndex=(parseInt(this._canvas.style.zIndex)+10).toString(),this.statsInfoElement=document.createElement("p"),this.statsInfoElement.style.fontFamily="Helvetica, Arial, sans-serif",this.statsInfoElement.style.fontSize="9px;",t.domElement.appendChild(this.statsInfoElement),this._canvas.parentElement.appendChild(t.domElement)},e.prototype.updateStats=function(){this.stats.update(),this.statsInfoElement.textContent=this.getPerformanceInfo()},e.prototype.updateSize=function(){var t=this._canvas.offsetWidth,e=this._canvas.offsetHeight;if(this.width!=t||this.height!=e){this.width=t,this.height=e;var r=this.camera;r.aspect=t/e,r.updateProjectionMatrix(),this.renderer.setSize(t,e)}},e.prototype.createOrbitControls=function(){var t=new zh(this.camera,this.renderer.domElement);this.controls=t,t.enableDamping=!0,t.dampingFactor=.7,t.rotateSpeed=.7,t.autoRotate=!1,t.autoRotateSpeed=2,t.mouseButtons={ORBIT:oe,PAN:ae,ZOOM:-1},t.enablePan=!0,t.enableZoom=!0,t.enableKeys=this.navigationMode==e.NAVIGATION_FULL,t.enableRotate=this.navigationMode!=e.NAVIGATION_NONE,this.navigationMode!=e.NAVIGATION_ROTATION_ONLY&&this.navigationMode!=e.NAVIGATION_NONE||(t.enablePan=!1,t.enableZoom=!1),this.navigationMode==e.NAVIGATION_ABOVE_ZERO&&(t.maxPolarAngle=Math.PI/2),this.navigationMode==e.NAVIGATION_ROTATION_ONLY&&(t.mouseButtons={ORBIT:ae,PAN:-1,ZOOM:-1})},e.prototype.render=function(){this.renderer.render(this.scene,this.camera)},e.prototype.run=function(){var t=window.performance.now();this.active&&(this.stats&&this.updateStats(),this.controls&&this.controlsActive,0!=this.smoothFrame&&(this.updateCameraSmooth(this.smoothFrame),this.smoothFrame--),this.renderActive&&this.render(),this.times[this.timesCnt]=window.performance.now()-t,this.timesCnt=(this.timesCnt+1)%this.times.length,window.requestAnimationFrame(this.runCallback))},e.prototype.getRendererInfo=function(){var t=this.renderer.info;return"Renderer info: Geometries:"+t.memory.geometries+", Textures: "+t.memory.textures+", Programs: "+t.programs.length},e.prototype.getPerformanceInfo=function(){for(var t=this.times,e=0,r=0;r<t.length;r++)e+=t[r];e/=t.length;var i=Math.min(60,1e3/e);return"T:"+(e=Math.round(e))+" ms, fps:"+(i=Math.round(i))},e.prototype.getCameraData=function(){var t=this.camera.position.x,e=-this.camera.position.y,r=this.camera.position.z,i=new Mi;this.camera.getWorldDirection(i);var n=180*-Math.atan2(i.y,i.x)/Math.PI,a=[t,e,r,180*-Math.asin(i.z)/Math.PI,n];return"Camera:"+(a=a.map(function(t){return Bh.round(t,2)})).join(",")},e.NAVIGATION_FULL="WINDOW_3D_NAVIGATION_FULL",e.NAVIGATION_NONE="WINDOW_3D_NAVIGATION_NONE",e.NAVIGATION_ABOVE_ZERO="WINDOW_3D_NAVIGATION_LIMITED_TO_Z_ABOVE_ZERO",e.NAVIGATION_ROTATION_ONLY="WINDOW_3D_NAVIGATION_ROTATION_ONLY",e.DEFAULT_COLOR=new hn(11184810),e}(Uh),Hh=function(t){function e(e){var r=t.call(this,e)||this;return r._zHeight=0,r}return Rh(e,t),Object.defineProperty(e.prototype,"lineMesh",{get:function(){return null==this._lineMesh&&(this._lineMesh=this.createMesh()),this._lineMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineColor",{get:function(){return this._lineColor},set:function(t){this._lineColor=t,this.setDirty3D(Uh.DIRTY_3D_LINE_COLOR)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zHeight",{get:function(){return this._zHeight},set:function(t){this._zHeight=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.create3D=function(){t.prototype.create3D.call(this)},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"stroke"!==e&&"color"!==e||(this.lineColor="none"===r?null:Dh.parseRGB(r)),"stroke-width"===e&&(this.lineWidth=parseFloat(r)),"3d-z-height"!==e&&"zHeight"!==e||(this.zHeight=parseFloat(r))},e.prototype.update3D=function(){t.prototype.update3D.call(this),null!=this.lineColor&&this.isDirty3DSet(Uh.DIRTY_3D_LINE_COLOR)&&this.lineColor.applyToMaterial(this.lineMesh)},e.prototype.dispose=function(){null!=this._lineMesh&&(this.element.remove(this.lineMesh),Bh.disposeMesh(this.lineMesh),this._lineMesh=null),this.lineColor=null,t.prototype.dispose.call(this)},e}(Uh),Vh=function(t){function e(e){return t.call(this,e)||this}return Rh(e,t),Object.defineProperty(e.prototype,"fillMesh",{get:function(){return null==this._fillMesh&&(this._fillMesh=this.createMesh()),this._fillMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillColor",{get:function(){return this._fillColor},set:function(t){this._fillColor=t,this.setDirty3D(Uh.DIRTY_3D_FILL_COLOR)},enumerable:!0,configurable:!0}),e.prototype.create3D=function(){t.prototype.create3D.call(this)},e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"fill"===e)switch(r){case"none":this.fillColor=null;break;case"solid":case"hatching":this.fillColor=this.lineColor;break;default:this.fillColor=Dh.parseRGB(r)}},e.prototype.update3D=function(){t.prototype.update3D.call(this),null!=this.fillColor&&this.isDirty3DSet(Uh.DIRTY_3D_FILL_COLOR)&&this.fillColor.applyToMaterial(this.fillMesh)},e.prototype.dispose=function(){null!=this._fillMesh&&(this.element.remove(this.fillMesh),Bh.disposeMesh(this.fillMesh),this._fillMesh=null),this.fillColor=null,t.prototype.dispose.call(this)},e}(Hh),Yh=function(){function t(){}return t.prototype.fillPlanes=function(t,e,r,i){},t.prototype.getPoints=function(){return[]},t.prototype.getEnd=function(){return null},t.prototype.getStart=function(){return null},t.prototype.getCap=function(t,e,r){return[]},t.prototype.shiftZ=function(t){},t.prototype.translate=function(t,e,r){},t.prototype.length=function(){return 0},t.prototype.getPoint=function(t){return this.getStart()},t.prototype.getNormal=function(t){return new Mi(1,0,0)},t.prototype.getShifted=function(t){return this},t.prototype.getCut=function(t,e){return this},t.prototype.clone=function(){return this},t}(),jh=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.x=0,e.y=0,e.z1=0,e.z2=0,e.rx=0,e.ry=0,e.startAngle=0,e.arcAngle=-Bh.TAU,e.autoFacecount=!0,e.faceCount=30,e}return Rh(e,t),Object.defineProperty(e,"ARC",{get:function(){return this._arc||(this._arc=new e),this._arc},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.x=this.y=this.z2=this.z1=this.rx=this.ry=this.startAngle=0,this.arcAngle=-Bh.TAU,this.autoFacecount=!0,this.faceCount=30},e.prototype.setup=function(t){this.x=this.y=this.z1=0,this.rx=t.rx,this.ry=t.ry,this.arcAngle=t.arcAngle,this.startAngle=t.startAngle,this.z2=t.dz},e.prototype.fillPlanes=function(t,e,r,i){this.addPlanes(t,e,!1,r,i)},e.prototype.addPlanes=function(t,e,r,i,n){var a=e.intersection(Fh.SIDES),o=e.intersection(Fh.BACK),s=e.intersection(Fh.FRONT);Bh.isZeroDouble(Math.abs(this.arcAngle)-Bh.TAU)&&(s=o=Fh.none);var l=this.autoFacecount?Bh.getFaceCount(Math.max(this.rx,this.ry)+n,this.arcAngle,this.z1-this.z2,3,4,32,!1):this.faceCount,u=this.arcAngle/l,c=(this.z2-this.z1)/l,h=this.rx+n,d=this.rx-n,p=this.ry+n,f=this.ry-n;d=Math.max(0,d),f=Math.max(0,f),r&&(h=d,p=f,d=0,f=0);for(var m=0;m<l;m++){var g=this.z1+c*m,v=g+c,b=this.startAngle+u*m;Nh.BOX.setupArc(h,p,d,f,i,b,u,this.x,this.y,g,v),Nh.BOX.addPlanes(t,a),0==m&&Nh.BOX.addPlanes(t,o),m==l-1&&Nh.BOX.addPlanes(t,s)}},e.prototype.getPoints=function(){var t=[];if(!Bh.isZeroDouble(this.rx*this.arcAngle))for(var e=this.faceCount,r=0;r<e;r++){var i=r/e,n=this.getRelativePoint(i);t.push(n)}return t},e.prototype.getRelativePoint=function(t){var e=this.startAngle+t*this.arcAngle;return new Mi(this.rx*Math.cos(e)+this.x,this.ry*Math.sin(e)+this.y,this.z1+t*(this.z2-this.z1))},e.prototype.getPoint=function(t){var e=this.length();return this.getRelativePoint(t/e)},e.prototype.getNormal=function(t){var e=this.length(),r=t,i=t+.001;i>e&&(r=(i=e)-.001);var n=this.getPoint(r),a=this.getPoint(i);return Bh.getNormal(n,a)},e.prototype.getArcPoint=function(t,e){return new Mi(this.rx*Math.cos(t)+this.x,this.ry*Math.sin(t)+this.y,e)},e.prototype.getEnd=function(){return this.getArcPoint(this.startAngle+this.arcAngle,this.z2)},e.prototype.getStart=function(){return this.getArcPoint(this.startAngle,this.z1)},e.prototype.shiftZ=function(t){this.z1+=t,this.z2+=t},e.prototype.translate=function(t,e,r){this.x+=t,this.y+=e,this.z1+=r,this.z2+=r},e.prototype.getCap=function(t,e,r){var i=this.z2-this.z1,n=.001*this.arcAngle,a=this.startAngle,o=this.z1;t||(a=this.startAngle+.999*this.arcAngle,o=this.z1+.999*i);var s=o+.001*i,l=this.rx+r,u=this.rx-r,c=this.ry+r,h=this.ry-r;u=Math.max(0,u),h=Math.max(0,h),Nh.BOX.setupArc(l,c,u,h,e,a,n,this.x,this.y,o,s);var d=Nh.BOX;return t?[d.backNormal.clone(),d.l1.clone(),d.r1.clone()]:[d.frontNormal.clone(),d.l2.clone(),d.r2.clone()]},e.prototype.length=function(){var t=(this.rx+this.ry)/2*Math.abs(this.arcAngle);return Math.hypot(t,this.z2-this.z1)},e.prototype.clone=function(){var t=new e;for(var r in t)t[r]=this[r];return t},e.prototype.getShifted=function(t){this.arcAngle>0&&(t*=-1);var e=this.clone();return e.rx=Math.max(0,e.rx+t),e.ry=Math.max(0,e.ry+t),e},e.prototype.getCut=function(t,e){var r=this.length();t>=r?(e=0,t=r):t+e>r&&(e=r-t);var i=this.clone();if(!Bh.isZeroDouble(r)){var n=t/r,a=e/r,o=this.z2-this.z1;i.z1=this.z1+n*o,i.z2=this.z1+(n+a)*o,i.startAngle+=this.arcAngle*n,i.arcAngle=this.arcAngle*a}return i},e}(Yh),Xh=function(t){function e(e){var r=t.call(this,e)||this;return r._rx=0,r._ry=0,r._dz=0,r._startAngle=0,r._arcAngle=0,r}return Rh(e,t),Object.defineProperty(e.prototype,"dz",{get:function(){return this._dz},set:function(t){this._dz=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startAngle",{get:function(){return this._startAngle},set:function(t){this._startAngle=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"arcAngle",{get:function(){return this._arcAngle},set:function(t){this._arcAngle=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rx",{get:function(){return this._rx},set:function(t){this._rx=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ry",{get:function(){return this._ry},set:function(t){this._ry=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"3d-dz"===e&&(this.dz=parseFloat(r)),"3d-arc"===e){var i=[];r.split(",").forEach(function(t){return i.push(parseFloat(t))}),this.rx=i[0],this.ry=i[1],this.startAngle=i[2],this.arcAngle=i[3],Math.abs(this.arcAngle)>Bh.TAU+1e-10&&(this.arcAngle=this.arcAngle%Bh.TAU)}},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var e=Fh.of(Fh.ALL);if(null!=this.lineColor){var r=new On;this.lineMesh.geometry=r,this.lineMesh.matrixWorldNeedsUpdate=!0,jh.ARC.setup(this),jh.ARC.addPlanes(r,e,!1,this.zHeight,this.lineWidth/2),Bh.calculateTextureUVS(r)}if(null!=this.fillColor){var i=new On;this.fillMesh.geometry=i,this.fillMesh.matrixWorldNeedsUpdate=!0,jh.ARC.setup(this),jh.ARC.addPlanes(i,e,!0,this.zHeight,this.lineWidth/2),Bh.calculateTextureUVS(i)}}},e}(Vh),qh=function(t){function e(){return t.call(this)||this}return Rh(e,t),e.prototype.setup=function(t,e){return this.start=t,this.end=e,this},e.prototype.fillPlanes=function(t,e,r,i){Nh.BOX.setupStraitSegment(this.start,this.end,r,i),Nh.BOX.addPlanes(t,e)},e.prototype.fillCylinder=function(t,e,r){e.setup(this.start,this.end,e.radius),e.fillPlanes(t,r)},e.prototype.getPoints=function(){var t=[];return t.push(this.start.clone()),t},e.prototype.getCap=function(t,e,r){var i=Nh.BOX;return Nh.BOX.setupStraitSegment(this.start,this.end,e,r),t?[i.backNormal.clone(),i.l1.clone(),i.r1.clone()]:[i.frontNormal.clone(),i.l2.clone(),i.r2.clone()]},e.prototype.getEnd=function(){return this.end.clone()},e.prototype.getStart=function(){return this.start.clone()},e.prototype.shiftZ=function(t){this.start.z+=t,this.end.z+=t},e.prototype.translate=function(t,e,r){this.start.x+=t,this.start.y+=e,this.start.z+=r,this.end.x+=t,this.end.y+=e,this.end.z+=r},e.prototype.length=function(){return this.start.distanceTo(this.end)},e.prototype.getPoint=function(t){var e=Bh.getNormal(this.start,this.end),r=new Mi;return r.copy(this.start),Bh.translateScaled(r,e,t)},e.prototype.getNormal=function(t){return Bh.getNormal(this.start,this.end)},e.prototype.clone=function(){var t=new e,r=this.start.clone(),i=this.end.clone();return t.setup(r,i),t},e.prototype.getShifted=function(t){var e=this.clone(),r=Bh.getLeftNormal(this.start,this.end);return Bh.translateScaled(e.start,r,t),Bh.translateScaled(e.end,r,t),e},e.prototype.getCut=function(t,r){t=Math.max(0,t);var i=this.length(),n=Math.min(t,i),a=Math.min(t+r,i),o=new e;return o.setup(this.getPoint(n),this.getPoint(a)),o},e}(Yh),Zh=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.joinType=1,e.closed=!1,e.planes=Fh.all,e.zHeight=0,e.halfWidth=0,e.segments=[],e.dzFill=0,e.continuous=!0,e}return Rh(e,t),e.prototype.fillPlanes=function(t){var r=this.planes,i=r.intersection(Fh.SIDES),n=this.segments.length;if(0!=n){for(var a=0;a<n;a++){this.segments[a].fillPlanes(t,i,this.zHeight,this.halfWidth)}r.contains(Fh.BACK)&&this.segments[0].fillPlanes(t,r.intersection(Fh.BACK),this.zHeight,this.halfWidth),r.contains(Fh.FRONT)&&this.segments[n-1].fillPlanes(t,r.intersection(Fh.FRONT),this.zHeight,this.halfWidth);var o=0;this.joinType!=e.JOIN_NONE&&this.continuous&&(o=this.closed?n:n-1);for(a=0;a<o;a++){var s=this.segments[a],l=this.segments[(a+1)%n];this.addJoin(s,l,t)}}},e.prototype.parseSegments=function(t){var e=this;return this.segments=[],t.split(":").forEach(function(t){var r=Bh.parseParamList(t).map(Number),i=null;if(6==r.length){var n=new qh;i=n,n.start=new Mi(r[0],r[1],r[2]),n.end=new Mi(r[3],r[4],r[5])}else{var a=new jh;i=a,a.x=r[0],a.y=r[1],a.rx=a.ry=r[2],a.z1=r[3],a.z2=r[4],a.startAngle=r[5],a.arcAngle=r[6]}e.segments.push(i)}),this},e.prototype.addJoin=function(t,e,r){var i=t.getCap(!1,this.zHeight,this.halfWidth),n=(i[0],i[1]),a=i[2],o=e.getCap(!0,this.zHeight,this.halfWidth),s=(o[0],o[1]),l=o[2],u=new Mi;u.copy(n),u.add(a),u.multiplyScalar(.5),Bh.isRightOriented(u,a,l)?Nh.BOX.setupTrianglePrism(l,a,u,this.zHeight):Nh.BOX.setupTrianglePrism(n,s,u,this.zHeight),Nh.BOX.addPlanes(r,Fh.sides)},e.prototype.fillInner=function(t){if(this.planes.contains(Fh.SIDES)){var e=[];this.segments.forEach(function(t){return e.push.apply(e,t.getPoints())});var r=null;if(!this.closed){var i=this.segments[this.segments.length-1].getEnd(),n=this.segments[0].getStart();r=(new qh).setup(i,n),e.push(i)}for(var a=e.length,o=0,s=0;s<a;s++){var l=e[s];o+=((b=e[(s+1)%a]).x-l.x)*(b.y+l.y)}o=-o;for(var u=new Set,c=new Mi,h=new Mi,d=new Mi,p=!0,f=[];e.length>2;){a=e.length,u.clear();var m=p?a-2:a-1,g=!1;for(s=0;s<a&&!g;s++){var v=s+m,b=(l=e[v%a],e[(v+1)%a]),y=e[(v+2)%a];if(!u.has(l)){var A=Bh.cross2D(l,b,y);c.crossVectors(Bh.getNormal(l,b,h),Bh.getNormal(l,y,d)),Bh.isZeroDouble(c.length())?Bh.dot2D(l,b,y)<=0&&(u.add(l),p=!p):Math.sign(A)==Math.sign(o)&&this.isTriangleEmpty(e,l,b,y)&&(u.add(b),o>0?f.push([l,b,y]):f.push([l,y,b]),p=!p,g=!0)}}if(u.forEach(function(t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}),a==e.length){console.error("CurverLine: ERROR: n = ",a);break}}var T=this.dzFill,C=this.zHeight+T,S=0;if(this.planes.contains(Fh.TOP))for(var E=0,w=f;E<w.length;E++){var k=w[E];for(s=0;s<k.length;s++){(I=k[s].clone()).z+=C,t.vertices.push(I)}var x=new vn(3*S,3*S+1,3*S+2,_=Bh.getPlaneNormal(new Mi,k));t.faces.push(x),S++}if(this.planes.contains(Fh.BOTTOM))for(var M=0,O=f;M<O.length;M++){for(k=O[M],s=0;s<k.length;s++){var I;(I=k[s].clone()).z-=T,t.vertices.push(I)}var _;(_=Bh.getPlaneNormal(new Mi,k)).multiplyScalar(-1);x=new vn(3*S,3*S+2,3*S+1,_);t.faces.push(x),S++}var L=this.planes.intersection(Fh.LEFT|Fh.RIGHT);this.segments.forEach(function(e){return e.fillPlanes(t,L,C,0)}),null!=r&&r.fillPlanes(t,L,C,0)}},e.prototype.isTriangleEmpty=function(t,e,r,i){for(var n=0,a=t;n<a.length;n++){var o=a[n];if(o!=e&&o!=r&&o!=i&&this.triangleContains(e,r,i,o))return!1}return!0},e.prototype.triangleContains=function(t,e,r,i){var n=Bh.cross2D(t,e,i),a=Bh.cross2D(e,r,i),o=Bh.cross2D(r,t,i);return n>=0&&a>=0&&o>=0||n<=0&&a<=0&&o<=0},e.prototype.length=function(){var t=0;return this.segments.forEach(function(e){return t+=e.length()}),t},e.prototype.getPoint=function(t){for(var e=0,r=0;r<this.segments.length;r++){var i=this.segments[r],n=i.length();if(e+n>=t)return i.getPoint(t-e);e+=n}return this.getEnd()},e.prototype.getEnd=function(){return this.segments[this.segments.length-1].getEnd()},e.prototype.getNormal=function(t){for(var e=0,r=0;r<this.segments.length;r++){var i=this.segments[r],n=i.length();if(e+n>=t)return i.getNormal(t-e);e+=n}var a=this.segments[this.segments.length-1];return a.getNormal(a.length())},e.prototype.getHeadLength=function(t){for(var e=0,r=0;r<t;r++)e+=this.segments[r].length();return e},e.prototype.findSegment=function(t){for(var e=0,r=0;r<this.segments.length;r++){var i=this.segments[r].length();if(e+i>=t)return r;e+=i}return this.segments.length-1},e.prototype.shiftZ=function(t){this.segments.forEach(function(e){return e.shiftZ(t)})},e.prototype.translate=function(t,e,r){this.segments.forEach(function(i){return i.translate(t,e,r)})},e.prototype.clone=function(){var t=new e;for(var r in t)t[r]=this[r];return t},e.prototype.cloneSegments=function(t){var e=this;this.segments=[],t.segments.forEach(function(t){return e.segments.push(t.clone())})},e.prototype.getShifted=function(t){var e=this.clone();return e.segments=[],this.segments.forEach(function(r){return e.segments.push(r.getShifted(t))}),e},e.prototype.getCut=function(t,e){var r=this.clone();r.segments=[];var i=this.length();if(0==this.segments.length||Bh.greaterEqualsDouble(t,i))return r;for(var n=Math.min(i,t+e),a=0,o=!1,s=this.segments.length-1,l=0,u=0;u<this.segments.length;u++){var c=this.segments[u],h=l+c.length();Bh.greaterDouble(h,t)&&!o&&(a=u,o=!0),Bh.greaterDouble(n,l)&&(s=u),l+=c.length()}var d=0;for(u=a;u<=s;u++)d+=this.segments[u].length();var p=0;for(u=0;u<=a-1;u++)p+=this.segments[u].length();var f=t-p,m=this.segments[s].length()-(p+d-n);for(u=a;u<=s;u++)r.segments.push(this.segments[u].clone());var g=r.segments.length;if(g>0){var v=r.segments[g-1];r.segments[g-1]=v.getCut(0,m);var b=r.segments[0];r.segments[0]=b.getCut(f,b.length()-f)}return r},e.JOIN_NONE=0,e.JOIN_MITER=1,e.JOIN_BEVEL=2,e}(Yh),Kh=function(){function t(){this.faceCount=30,this.radius=0,this.startAngle=0,this.start=new Mi,this.end=new Mi,this.direction=new Mi,this.directionOposite=new Mi,this.v=new Mi,this.u=new Mi,this.u1=new Mi,this.v1=new Mi,this.l1=new Mi,this.l2=new Mi,this.r1=new Mi,this.r2=new Mi,this.normalLeft1=new Mi,this.normalRight1=new Mi,this.normalLeft2=new Mi,this.normalRight2=new Mi}return t.prototype.setup=function(t,e,r){this.radius=r,this.start.copy(t),this.end.copy(e),Bh.getNormal(this.start,this.end,this.direction);var i=this.u,n=this.v,a=this.u1,o=this.v1,s=this.direction,l=this.directionOposite;if(Bh.isZeroDouble(this.direction.length()))i.set(0,0,0),n.copy(i),a.copy(i),o.copy(i);else{l.copy(s),l.multiplyScalar(-1);var u=Math.acos(s.z),c=Math.atan2(s.y,s.x),h=Math.cos(c),d=Math.cos(u),p=Math.sin(c),f=Math.sin(u);i.set(h*d,p*d,-f),n.set(-p,h,0),a.copy(i),o.copy(n)}},t.prototype.setupTorSegment=function(t,e,r,i){this.radius=i,this.start.copy(t),this.end.copy(e),Bh.getNormal(this.start,this.end,this.direction),this.directionOposite.copy(this.direction),this.directionOposite.multiplyScalar(-1),Bh.getNormal(this.start,r,this.u),Bh.getNormal(this.end,r,this.u1),this.v.crossVectors(this.direction,this.u),Bh.normalize(this.v),this.v1.crossVectors(this.direction,this.u1),Bh.normalize(this.v1)},t.calcRadiusVector=function(t,e,r,i){var n=Math.cos(i),a=Math.sin(i);return t.set(n*e.x+a*r.x,n*e.y+a*r.y,n*e.z+a*r.z),t},t.prototype.fillPlanes=function(e,r){var i=this;void 0===r&&(r=Fh.all);for(var n=this.u,a=this.v,o=this.u1,s=this.v1,l=this.normalRight1,u=this.normalRight2,c=this.normalLeft1,h=this.normalLeft2,d=0,p=Bh.TAU/this.faceCount,f=0;f<this.faceCount;f++){var m=this.startAngle+d;t.calcRadiusVector(c,n,a,m),t.calcRadiusVector(h,o,s,m),t.calcRadiusVector(l,n,a,m+p),t.calcRadiusVector(u,o,s,m+p),this.l1.copy(this.start),this.r1.copy(this.start),this.l2.copy(this.end),this.r2.copy(this.end),Bh.translateScaled(this.l1,c,this.radius),Bh.translateScaled(this.l2,h,this.radius),Bh.translateScaled(this.r1,l,this.radius),Bh.translateScaled(this.r2,u,this.radius),d+=p,r.contains(Fh.SIDES)&&(Nh.addVerts(e,[this.l1,this.l2,this.r2,this.r1],[this.normalLeft1,h,this.normalRight2,this.normalRight1]),r.contains(Fh.DOUBLE_SIDE)&&([this.normalLeft1,this.normalLeft2,this.normalRight2,this.normalRight1].forEach(function(t){return t.multiplyScalar(-i.radius)}),Nh.addVerts(e,[this.l2,this.l1,this.r1,this.r2],[this.normalLeft2,this.normalLeft1,this.normalRight1,this.normalRight2]))),r.contains(Fh.BACK)&&Nh.addVerts(e,[this.start,this.l1,this.r1],[this.directionOposite]),r.contains(Fh.FRONT)&&Nh.addVerts(e,[this.end,this.r2,this.l2],[this.direction])}},t}(),Qh=function(){return function(t){this.index=0,this.offset=0,this.fraction=0,this.density=5;var e=t.split(" ");this.index=parseFloat(e[0]),this.offset=parseFloat(e[1]),this.fraction=parseFloat(e[2]);var r=e[3];this.color=null!=r&&"none"!=r?Dh.parseRGB(r):null,e.length>=5&&(this.density=parseFloat(e[4]))}}(),Jh=function(){function t(){this.updateBatches=!0,this.newbatches=0,this.batches=[]}return t.prototype.create3D=function(t){this.batchGroup=new Zo,t.add(this.batchGroup)},t.prototype.updateParameter=function(t,e){"batch"===t&&this.batches.push(new Qh(e)),"newbatches"===t&&(this.updateBatches=!0,this.newbatches=parseInt(e))},t.prototype.update3D=function(){var t=this;this.updateBatches&&(this.batchGroup.children.forEach(function(t){return Bh.disposeMesh(t)}),this.batchGroup.children=[],this.updateBatches=!1),this.batches.length>0&&(this.batches.forEach(function(e){if(null!=e.color){var r=new On,i=Bh.createMesh();i.geometry=r,t.batchGroup.add(i),e.color.applyToMaterial(i),t.updateBatch(e,r)}}),this.batches=[])},t.prototype.updateBatch=function(t,e){},t}(),$h=function(t){function e(r){var i=t.call(this,r)||this;return i.type=e.CONVEYOR_TYPE_BELT,i.width=0,i.color=Dh.GRAY,i.stripeColor=Dh.GRAY,i.offset=0,i.offsetChanged=!0,i.cellSize=-1,i.gapSize=-1,i.standsZ=0,i.standsEnabled=!1,i.batchHelper=new Jh,i.curve=new Zh,i.cylinder=new Kh,i.stripeGeometry=null,i.cylinders=[],i.setDirty3D(Uh.DIRTY_3D_LINE_COLOR),i}return Rh(e,t),e.prototype.create3D=function(){var e=this;t.prototype.create3D.call(this),this.lineMesh=this.createMesh(),this.stripeMesh=this.createMesh(),this.frameMesh=this.createMesh(),this.standsMesh=this.createMesh(),this.batchHelper.create3D(this.element),this.batchHelper.updateBatch=function(t,r){var i=e.curve.length(),n=e.batchCurve.getCut(t.offset*i,t.fraction*i);n.planes=Fh.all,n.zHeight=t.density,n.fillPlanes(r)}},e.prototype.testAnimate=function(){var t=this,e=5e3,r=function(){e>0&&(e--,t.offset+=.1,t.offsetChanged=!0,t.update3D(),setTimeout(r,16))};r()},e.prototype.updateParameter=function(e,r){var i;t.prototype.updateParameter.call(this,e,r),this.batchHelper.updateParameter(e,r),"color"!==e&&"stroke"!==e||(this.color="none"===r?null:Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_LINE_COLOR)),"width"!==e&&"stroke-width"!==e||(this.width=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-d"==e&&(this.curve.parseSegments(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-type"==e&&(this.type=r,this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-offset"===e&&(this.offset=parseFloat(r),this.offsetChanged=!0),"stroke-dasharray"===e&&(i=r.split(" ").map(function(t){return parseFloat(t)}),this.gapSize=i[0],this.cellSize=i[1]),"3d-stands-z"===e&&(this.standsZ=parseInt(r),this.standsEnabled=!0,this.setDirty3D(Uh.DIRTY_3D_SHAPE))},e.prototype.createStands=function(t,e,r,i){var n=this.standsMesh.geometry,a=this.curve.length(),o=0;this.standsEnabled&&(i?e=a/((o=Math.max(2,Math.round(a/e)+1))-1):o=Math.floor(a/e)+2);for(var s=0;s<o;s++){var l=s*e,u=this.curve.getPoint(l),c=this.curve.getNormal(l).clone(),h=new Mi(0,0,1);c.set(-c.y,c.x,0),c.normalize();var d=(new Mi).copy(u),p=(new Mi).copy(u);Bh.translateScaled(d,c,t),Bh.translateScaled(p,c,-t);var f=u.z-this.standsZ;f>0&&(Bh.translateScaled(d,h,-f/2),Bh.translateScaled(p,h,-f/2),Nh.BOX.setupParallel(d,c,h,r,r,f),Nh.BOX.addPlanes(n),Nh.BOX.setupParallel(p,c,h,r,r,f),Nh.BOX.addPlanes(n),i&&(Bh.translateScaled(d,c,r/2),Bh.translateScaled(p,c,-r/2),d.z+=f/2,p.z+=f/2,Nh.BOX.setupStraitSegment(p,d,r,r/2),Nh.BOX.addPlanes(n)))}},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),null!=this.color){switch(this.isDirty3DSet(Uh.DIRTY_3D_LINE_COLOR)&&(this.stripeColor=Bh.getDistincColor(this.color),this.color.applyToMaterial(this.lineMesh),this.stripeColor.applyToMaterial(this.stripeMesh),this.stripeColor.applyToMaterial(this.frameMesh),Dh.GRAY.applyToMaterial(this.standsMesh)),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)&&(this.batchCurve=this.curve.clone(),this.batchCurve.cloneSegments(this.curve),this.batchCurve.halfWidth=.6*this.width/2,this.batchCurve.zHeight=5,this.batchCurve.planes=Fh.all,this.lineMesh.geometry=new On,this.frameMesh.geometry=new On,this.standsMesh.geometry=new On),this.type){case e.CONVEYOR_TYPE_BELT:case e.CONVEYOR_TYPE_CELL:case e.CONVEYOR_TYPE_ROLLER:this.updateFlatConveyor();break;case e.CONVEYOR_TYPE_MONORAIL:this.updateMonorailConveyor()}this.batchHelper.update3D()}},e.prototype.updateMonorailConveyor=function(){var t,e=this.width/6,r=2*e,i=1.2*r;if(this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var n=this.lineMesh.geometry,a=e/6,o=a,s=1.5*e-2*o;this.curve.shiftZ(i+0),this.curve.zHeight=o,this.curve.halfWidth=e/2,this.curve.fillPlanes(n),this.curve.shiftZ(o),this.curve.zHeight=s,this.curve.halfWidth=a/2,this.curve.fillPlanes(n),this.curve.shiftZ(s),this.curve.zHeight=o,this.curve.halfWidth=e/2,this.curve.fillPlanes(n);var l=this.width/2;this.createStands(l,4*this.width,this.width/20,!0),this.curve.shiftZ(-s-o)}if(this.offsetChanged){this.offsetChanged=!1,Bh.disposeGeometry(this.stripeMesh.geometry);var u=new On;this.stripeMesh.geometry=u;var c=1.5*e,h=this.width,d=this.curve.length();h=this.gapSize+this.cellSize,2*(c=this.gapSize/3);for(var p=Math.floor(this.curve.length()/h)+1,f=(Math.max(0,this.gapSize/2),new Mi),m=new Mi,g=new Mi,v=new Mi,b=new Mi,y=new Mi,A=new Mi,T=.4*i,C=e/4,S=new Mi,E=0;E<p;E++){var w=this.offset%h-h/2+E*h;if(w<=d-c/2){var k=this.curve.getPoint(w),x=this.curve.getNormal(w);S.set(0,0,1),Bh.translateScaled(S,x,.001),Bh.normalize(S),t=[-x.y,x.x],x.x=t[0],x.y=t[1],f.copy(k),m.copy(k),b.copy(k),Bh.translateScaled(f,x,-r/2),Bh.translateScaled(m,x,r/2),g.copy(f),v.copy(m),Bh.translateScaled(g,S,-i),Bh.translateScaled(v,S,-i),Bh.translateScaled(f,S,-T),Bh.translateScaled(m,S,-T),Bh.translateScaled(b,S,-T),y.copy(f),A.copy(m),Bh.translateScaled(y,x,-C/2),Bh.translateScaled(A,x,C/2),Bh.addBulks(u,[k,b,y,A,f,g,m,v],C)}}}},e.prototype.updateFlatConveyor=function(){var t=this.lineMesh.geometry,r=this.frameMesh.geometry,i=this.type!=e.CONVEYOR_TYPE_ROLLER,n=this.type==e.CONVEYOR_TYPE_ROLLER,a=this.curve.length(),o=this.width/8,s=o/10,l=this.width/2,u=n?1.5*o:this.width,c=Math.max(Math.round(a/u)+1,2),h=u*(n?4:2),d=Math.max(Math.round(a/h)+1,2),p=this.cylinder;if(p.faceCount=8,this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){this.curve.shiftZ(-o/2),this.rollerCurve=this.curve.clone(),this.rollerCurve.cloneSegments(this.curve);for(var f=new Mi,m=new Mi,g=0;g<c;g++){var v=g==c-1?a:g*u,b=this.curve.getPoint(v);(U=this.curve.getNormal(v).clone()).set(-U.y,U.x,0),U.normalize(),f.copy(b),m.copy(b),Bh.translateScaled(f,U,l),Bh.translateScaled(m,U,-l),p.setup(f,m,o/2),p.fillPlanes(t,Fh.all)}if(this.createStands(l,2*this.width,this.width/20,!1),!i){this.curve.shiftZ(-this.curve.zHeight/2-s/2),this.curve.zHeight=s,this.curve.halfWidth=s/2;var y=this.curve.getShifted(l),A=this.curve.getShifted(-l);y.fillPlanes(r),A.fillPlanes(r),this.curve.shiftZ(this.curve.zHeight/2+s/2)}i&&(this.curve.shiftZ(o/2-s),this.curve.halfWidth=this.width/2,this.curve.zHeight=s,this.curve.fillPlanes(t),this.curve.shiftZ(-o+s),this.curve.fillPlanes(t),this.curve.shiftZ(o-s)),Bh.calculateTextureUVS(t)}if(this.offsetChanged&&!window.cancelOffset){this.offsetChanged=!1;var T=!0;if(null==this.stripeGeometry){Bh.disposeGeometry(this.stripeMesh.geometry);var C=new On;this.stripeMesh.geometry=C,this.stripeGeometry=C,T=!1}var S=0,E=void 0,w=Fh.all.getFaceCount();if(i){var k=this.width/2+.1,x=this.width/2,M=2*s,O=s+.1;if(this.type==e.CONVEYOR_TYPE_CELL)x=this.gapSize+this.cellSize,O=2*(M=this.gapSize/3);S=Math.floor(this.curve.length()/x)+1;var I=Math.max(0,this.gapSize/2);for(g=0;g<S;g++){E=T?g*w:null,(v=this.offset%x+I+g*x)<=a?this.drawStroke(v,M,O,k,E):this.drawStroke(a,0,0,0,E)}}var _=o/2,L=.8*o,P=(f=new Mi,m=new Mi,new Mi),R=_*Bh.TAU,D=-(this.offset%R)/R*Bh.TAU,F=Fh.of(Fh.FRONT|Fh.BACK),N=F.getFaceCount(),B=new Mi;for(g=0;g<d;g++){v=g==d-1?a:g*h;var G=this.cylinders[g];if(null==G){var U;b=this.rollerCurve.getPoint(v);(U=this.rollerCurve.getNormal(v).clone()).set(-U.y,U.x,0),U.normalize(),f.copy(b),m.copy(b),Bh.translateScaled(f,U,l),Bh.translateScaled(m,U,-l),(G=new Kh).setup(f,m,_),this.cylinders[g]=G}var z=G.direction;B.copy(G.start),Bh.translateScaled(B,z,l),Kh.calcRadiusVector(P,G.u,G.v,D),E=T?g*N+S*w:null,Nh.BOX.setupParallel(B,P,z,L,L/10,this.width+L/20),Nh.BOX.addPlanes(this.stripeGeometry,F,E)}this.stripeGeometry.verticesNeedUpdate=!0,this.stripeGeometry.normalsNeedUpdate=!0}},e.prototype.drawStroke=function(t,e,r,i,n){var a=this.curve.getPoint(t),o=this.curve.getNormal(t),s=a.clone();Bh.translateScaled(s,o,e),Nh.BOX.setupStraitSegment(a,s,r,i),Nh.BOX.addPlanes(this.stripeGeometry,Fh.all,n)},e.CONVEYOR_TYPE_BELT="CONVEYOR_TYPE_BELT",e.CONVEYOR_TYPE_ROLLER="CONVEYOR_TYPE_ROLLER",e.CONVEYOR_TYPE_CELL="CONVEYOR_TYPE_CELL",e.CONVEYOR_TYPE_MONORAIL="CONVEYOR_TYPE_MONORAIL",e}(Uh),td=function(){function t(){}return t.group="g",t.replicated="use",t.circle="circle",t.ellipse="ellipse",t.image="image",t.line="line",t.rect="rect",t.polygon="polygon",t.polyline="polyline",t.stopLine="MarkupStopLine",t.road="MarkupRoad",t.busStop="MarkupBusStop",t.parkingLot="MarkupParkingLot",t.intersection="MarkupIntersection",t.conveyorPath="MarkupConveyorPath",t.conveyorStation="MarkupConveyorStation",t.conveyorCustomStation="MarkupConveyorCustomStation",t.conveyorTurntable="MarkupConveyorTurntable",t.conveyorTurnStation="MarkupConveyorTurnStation",t.conveyorTransferTable="MarkupConveyorTransferTable",t.conveyorSplit="MarkupConveyorSplitMerge",t.palletRack="MarkupPalletRack",t.escalator="MarkupEscalatorGroup",t.serviceWithLines="MarkupServiceWithLines",t.towerCrane="MarkupTowerCrane",t.lift="MarkupLift",t.pathConveyor="MarkupPathConveyor",t.pathDashline="MarkupPathDashline",t.pathLine="MarkupPathLine",t.pathRailroad="MarkupPathRailroad",t.pathRoad="MarkupPathRoad",t.pathWall="MarkupPathWall",t.pipe="MarkupPipe",t.bulkConveyorBelt="MarkupBulkConveyorBelt",t.storageTank="MarkupStorageTank",t.pointNode="MarkupPointNode",t.polygonalNode="MarkupPolygonalNode",t.rectangularNode="MarkupRectangularNode",t.circularWall="MarkupCircularWall",t.rectangularWall="MarkupRectangularWall",t.shapeArc="ShapeArc",t.shapeImage="ShapeImage",t.shapeModelElementsGroup="ShapeModelElementsGroup",t.shapeText="ShapeText",t.light3D="Light3D",t.window3D="Window3D",t}(),ed=function(t){function e(e){var r=t.call(this,e)||this;return r.markingCurve=new Zh,r.fillingCurve=new Zh,r.type="",r.radius=0,r.type=Bh.getShapeType(e),r.type!==td.pathRailroad&&r.type!==td.pathRoad&&r.type!==td.pathConveyor||(r.lineColor=Dh.GRAY),r}return Rh(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"3d-d"!==e&&"3d-marking"!==e||(this.markingCurve.parseSegments(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-area"===e&&(this.fillingCurve.parseSegments(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-line-width"===e&&(this.lineWidth=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"radius"===e&&(this.radius=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var e=this.zHeight;this.fillingCurve.halfWidth=0,this.fillingCurve.zHeight=e,this.fillingCurve.shiftZ(-e),this.type===td.conveyorStation&&(this.fillingCurve.dzFill=.01);var r=null;null!=this.fillColor&&(r=new On,this.fillMesh.geometry=r,this.fillingCurve.fillInner(r));var i=null;if(null!=this.lineColor&&0!=this.radius){var n=e+.2,a=e+.1;i=new On,this.lineMesh.geometry=i;var o=new jh;o.autoFacecount=!1,o.faceCount=40,o.shiftZ(-e),o.rx=o.ry=this.radius;o.addPlanes(i,Fh.all,!1,n,.5),null!=r&&o.addPlanes(r,Fh.all,!0,a,0)}this.type===td.conveyorStation&&(this.lineWidth=1),null!=this.lineColor&&this.lineWidth>0&&(null==i&&(i=new On,this.lineMesh.geometry=i),this.markingCurve.halfWidth=this.lineWidth/2,this.markingCurve.zHeight=this.zHeight+.1,this.markingCurve.shiftZ(-e),this.markingCurve.closed=!0,this.markingCurve.fillPlanes(i)),null!=i&&Bh.calculateTextureUVS(i),null!=r&&Bh.calculateTextureUVS(r)}},e}(Vh),rd=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bigRadius=0,e.arcAngle=0,e}return Rh(e,t),e.prototype.setupPipe=function(t,e,r){return this.start=t,this.end=e,this.center=r,this.n1=Bh.getNormal(r,t),this.n2=Bh.getNormal(r,e),this.arcAngle=Math.acos(this.n1.dot(this.n2)),this.bigRadius=t.distanceTo(r),this.vertical=(new Mi).crossVectors(this.n1,this.n2),Bh.normalize(this.vertical),this.n1Ort=(new Mi).crossVectors(this.vertical,this.n1),Bh.normalize(this.n1Ort),this},e.prototype.fillCylinder=function(t,e,r){for(var i=0;i<20;i++){var n=this.torVector(i/20),a=this.torVector((i+1)/20),o=this.center.clone().add(n),s=this.center.clone().add(a);e.setupTorSegment(o,s,this.center,e.radius),e.fillPlanes(t,r)}e.startAngle=0},e.prototype.torVector=function(t){var e=Kh.calcRadiusVector(new Mi,this.n1,this.n1Ort,t*this.arcAngle);return e.multiplyScalar(this.bigRadius),e},e.prototype.length=function(){return this.bigRadius*this.arcAngle},e.prototype.getRatio=function(t){t=Math.max(0,t);var e=this.length();return 0==e?0:Math.min(1,t/e)},e.prototype.getPoint=function(t){var e=this.getRatio(t);return this.center.clone().add(this.torVector(e))},e.prototype.getNormal=function(t){var e=this.getRatio(t),r=this.torVector(e),i=(new Mi).crossVectors(r,this.vertical);return Bh.normalize(i)},e.prototype.clone=function(){var t=new e,r=this.start.clone(),i=this.end.clone(),n=this.center.clone();return t.setupPipe(r,i,n),t},e.prototype.getCut=function(t,r){var i=this.length(),n=Math.min(t,i),a=Math.min(t+r,i),o=new e;return o.setupPipe(this.getPoint(n),this.getPoint(a),this.center.clone()),o},e}(qh),id=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.roundness=10,e.smallFaceCount=20,e}return Rh(e,t),e.prototype.parseSegments=function(t){var e=[];return t.split(":").forEach(function(t){var r=Bh.parseParamList(t).map(Number);if(6==r.length){var i=new qh;i.start=new Mi(r[0],r[1],r[2]),i.end=new Mi(r[3],r[4],r[5]),e.push(i)}}),this.convertSegments(e)},e.prototype.setupSegments=function(t){for(var e=[],r=t.length,i=0;i<r-1;i++){var n=t[i],a=t[i+1];e.push((new qh).setup(n,a))}return this.convertSegments(e)},e.prototype.convertSegments=function(t){var e=t.length;if(e<=1)return this.segments=t,this;for(var r=t[0].start,i=1;i<e;i++){var n=t[i-1],a=t[i],o=n.start,s=n.end,l=a.end,u=s.distanceTo(l),c=s.distanceTo(o),h=Math.min(c/2,Math.min(u/2,this.roundness)),d=Bh.getNormal(s,o),p=Bh.getNormal(s,l),f=d.dot(p);d.multiplyScalar(h),p.multiplyScalar(h);var m=new Mi;if(m.crossVectors(d,p),Bh.isZeroDouble(m.length()))Bh.isZeroDouble(u)||(this.segments.push((new qh).setup(r,s)),r=s);else{var g=.5*Math.acos(f),v=h/Math.cos(g);if(v<500){var b=s.clone();b.add(d);var y=s.clone().add(p),A=d.clone().add(p);Bh.normalize(A),A.multiplyScalar(v);var T=s.clone();T.add(A),this.segments.push((new qh).setup(r,b)),this.segments.push((new rd).setupPipe(b,y,T)),r=y}else this.segments.push((new qh).setup(r,s)),r=s}i==e-1&&this.segments.push((new qh).setup(r,l))}return this},e.prototype.fillPlanes=function(t){var e=this.segments.length;if(0!=e){var r=this.planes,i=new Kh;i.radius=this.halfWidth,i.faceCount=this.smallFaceCount;for(var n=0;n<e;n++){this.segments[n].fillCylinder(t,i,r)}}},e.prototype.clone=function(){var t=new e;for(var r in t)t[r]=this[r];return t},e}(Zh),nd=function(){function t(t){this.crane=t}return t.prototype.createAnimation=function(){},t.prototype.createTroley=function(t,e,r){var i=new On;this.crane.trolleyMesh.geometry=i,Dh.GRAY.applyToMaterial(this.crane.trolleyMesh);var n=new Mi(-t,0,r),a=new Mi(t,0,r);Nh.BOX.setupStraitSegment(n,a,e,t),Nh.BOX.addPlanes(i)},t.prototype.createHook=function(){var t=this.crane.hookSize,e=new On;this.crane.hookBlockMesh.geometry=e,this.crane.craneColor.applyToMaterial(this.crane.hookBlockMesh);var r=new Mi(-t/2,0,0),i=new Mi(t/2,0,0);Nh.BOX.setupStraitSegment(r,i,2*t,t/6),Nh.BOX.TOP.forEach(function(t){return t.x*=2}),Nh.BOX.addPlanes(e);var n=Dh.GRAY,a=new On;this.crane.hookMesh.geometry=a,n.applyToMaterial(this.crane.hookMesh);var o=new id,s=t/1.5,l=[new Mi(0,0,s),new Mi(0,0,0),new Mi(-s,0,-s),new Mi(0,0,-2*s),new Mi(s/1.1,0,-s/1.1),new Mi(s/1.1,0,-s/1.1)];o.setupSegments(l),o.halfWidth=s/8,o.roundness=s,o.fillPlanes(a)},t}(),ad=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Rh(e,t),e.prototype.createAnimation=function(){var t=this.crane.halfWidth-this.crane.beamBig/2,e=t/5;this.createMast(),this.createBase(),this.createJib(),this.createTroley(t,e,-e),this.createCabin(),this.createHook()},e.prototype.createMast=function(){var t=this.crane.halfWidth,e=this.crane.beamBig,r=this.crane.beamSmall,i=this.crane.cabinColor.isNull()?2*t:2*this.crane.cabinWidth,n=this.crane.height-i-e,a=new On;this.crane.mastMesh.geometry=a,this.crane.craneColor.applyToMaterial(this.crane.mastMesh);for(var o=Bh.DX,s=Bh.DY,l=new Mi(0,0,0),u=new Mi(0,0,n),c=0;c<o.length;c++){var h=o[c]*t,d=s[c]*t;l.set(h,d,0),u.copy(l),u.z=n,Nh.BOX.setupBox(l,u,e,e,Bh.LEFT),Nh.BOX.addPlanes(a,Fh.all)}var p=2*t,f=Math.round(n/p);p=n/f;for(var m=[],g=0;g<f;g++)for(c=0;c<o.length;c++){var v=o[c]*t,b=s[c]*t,y=g*p,A=g%2==0?1:3,T=o[(c+A)%4]*t,C=s[(c+A)%4]*t,S=y+p;m.push(new Mi(v,b,y)),m.push(new Mi(T,C,S)),m.push(new Mi(v,b,y)),m.push(new Mi(T,C,y))}Bh.addBulks(a,m,r);var E=new Mi(0,0,n);Nh.BOX.setupParallel(E,Bh.RIGHT,Bh.FRONT,2*t,e,2*t),Nh.BOX.addPlanes(a);var w=new Kh;w.setup(E,new Mi(0,0,this.crane.height),t),w.fillPlanes(a)},e.prototype.createJib=function(){var t=new On;this.crane.jibMesh.geometry=t,this.crane.craneColor.applyToMaterial(this.crane.jibMesh);var e=this.crane.jibLength+this.crane.halfWidth,r=e/2;this.crane.type===sd.TYPE_BIG?(this.addJibPart(t,-r,-this.crane.halfWidth),this.addJibPart(t,this.crane.halfWidth,e),this.addJibTop(t)):this.addJibPart(t,-r,e),this.addJibBox(t)},e.prototype.addJibBox=function(t){var e=this.crane.height,r=this.crane.halfWidth,i=this.crane.halfWidth;Nh.BOX.setupParallel(new Mi(0,0,e-r/2),Bh.RIGHT,Bh.FRONT,2*i,r,2*i),Nh.BOX.addPlanes(t)},e.prototype.addJibTop=function(t){var e=this.crane.height,r=this.crane.beamSmall,i=Bh.DX,n=Bh.DY,a=this.crane.halfWidth,o=new Mi,s=new Mi,l=9*a;o.set(0,0,e+l);for(var u=0;u<4;u++)s.set(i[u]*a,n[u]*a,e),Nh.BOX.setupBox(o,s,r,r),Nh.BOX.addPlanes(t);var c=this.crane.jibLength,h=c/2,d=1.5*this.crane.halfWidth,p=[new Mi(-h/2,0,e+d),o,new Mi(c/3,0,e+d),o,new Mi(2*c/3,0,e+d),o];Bh.addBulks(t,p,2*this.crane.cableRadius);for(var f=l/8,m=[],g=0;g<8;g++)for(u=0;u<i.length;u++){var v=1-g/8,b=1-(g+1)/8,y=i[u]*a*v,A=n[u]*a*v,T=e+g*f,C=g%2==0?1:3,S=i[(u+C)%4]*a*b,E=n[(u+C)%4]*a*b,w=T+f;m.push(new Mi(y,A,T)),m.push(new Mi(S,E,w))}Bh.addBulks(t,m,r/2)},e.prototype.addJibPart=function(t,e,r){var i=this.crane.halfWidth,n=this.crane.beamBig,a=this.crane.beamSmall,o=Bh.DX,s=Bh.DY,l=this.crane.height,u=new Mi(0,0,0),c=new Mi(0,0,0),h=r-e,d=2*i,p=Math.round(h/d);d=h/p;var f=1.5*i;u.set(e,i,l),c.set(r,i,l),Nh.BOX.setupBox(u,c,n,n),Nh.BOX.addPlanes(t),u.set(e,-i,l),c.set(r,-i,l),Nh.BOX.setupBox(u,c,n,n),Nh.BOX.addPlanes(t),u.set(e+d/2,0,l+f),c.set(r-d/2,0,l+f),Nh.BOX.setupBox(u,c,n,n),Nh.BOX.addPlanes(t);for(var m=new Mi,g=new Mi,v=0;v<p;v++){var b=e+d/2+v*d;m.set(b,0,l+f);for(var y=0;y<4;y++)g.set(b+o[y]*d/2,s[y]*i,l),Nh.BOX.setupBox(m,g,a,a),Nh.BOX.addPlanes(t,Fh.all)}for(v=0;v<p+1;v++){b=e+v*d;u.set(b,i,l),c.set(b,-i,l),Nh.BOX.setupBox(u,c,a,a),Nh.BOX.addPlanes(t,Fh.all)}},e.prototype.createCabin=function(){var t=this.crane.cabinWidth,e=t/2,r=1.6*t,i=1.9*t,n=2*t,a=t/20;this.crane.cabinMesh.position.set(-i/2,1.1*-(this.crane.halfWidth+e),this.crane.height-n),this.crane.element.remove(this.crane.cabinMesh);var o=new On;this.crane.cabinMesh.geometry=o,this.crane.cabinColor.applyToMaterial(this.crane.cabinMesh);var s=new Mi(r/2,0,0),l=new Mi(0,0,0),u=new Mi(0,0,n),c=new Mi(0,-e,n/2),h=new Mi(0,e,n/2),d=new Mi(r,0,0),p=new Mi(i,0,n),f=Bh.getPointOnLine(d,p,.5),m=Bh.getPointOnLine(d,p,.5);f.y=-e,m.y=e;var g=new Nh;g.setupStraitSegment(l,d,n,e),g.l2t.x=i,g.r2t.x=i,g.addPlanes(o,Fh.of(Fh.TOP|Fh.BACK|Fh.BOTTOM|Fh.DOUBLE_SIDE));var v=new Nh;v.setupStraitSegment(l,s,n,e),v.addPlanes(o,Fh.of(Fh.LEFT|Fh.RIGHT|Fh.DOUBLE_SIDE)),Nh.BOX.setupBox(l,d,t+a,a,Bh.LEFT),Nh.BOX.addPlanes(o),Nh.BOX.setupBox(u,p,t+a,a,Bh.LEFT),Nh.BOX.addPlanes(o);var b=[];b.push((new qh).setup(c,f)),b.push((new qh).setup(h,m)),b.push((new qh).setup(f,m)),b.push((new qh).setup(g.r2,g.r2t)),b.push((new qh).setup(g.l2,g.l2t)),b.forEach(function(t){Nh.BOX.setupBox(t.start,t.end,a,a,Bh.LEFT),Nh.BOX.addPlanes(o)})},e.prototype.createBase=function(){var t=new On;Dh.GRAY.applyToMaterial(this.crane.baseMesh),this.crane.baseMesh.geometry=t;for(var e=4*this.crane.halfWidth,r=e/8,i=new Mi,n=0;n<3;n++)i.set(0,0,1.2*r*n+r/2),Nh.BOX.setupParallel(i,Bh.RIGHT,Bh.FRONT,e,r,e),Nh.BOX.addPlanes(t)},e}(nd),od=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Rh(e,t),e.prototype.createAnimation=function(){this.crane.cabinMesh.visible=!1;var t=e.COEF_WIDTH*this.crane.halfWidth+this.crane.beamBig,r=2*t;this.createRoundMast(),this.createRoundBase(),this.createRailJib(),this.createTroley(t,r,-r/2),this.createHook()},e.prototype.createRoundBase=function(){var t=new On;Dh.GRAY.applyToMaterial(this.crane.baseMesh),this.crane.baseMesh.geometry=t;var e=2*this.crane.halfWidth,r=e/8,i=new Mi,n=new Mi(0,0,r),a=new Kh;a.setup(i,n,e),a.fillPlanes(t)},e.prototype.createRoundMast=function(){var t=new On;this.crane.craneColor.applyToMaterial(this.crane.mastMesh),this.crane.mastMesh.geometry=t;var r=this.crane.jibLength/5,i=new Mi,n=new Mi(0,0,this.crane.height+r),a=new Kh;a.setup(i,n,this.crane.halfWidth),a.fillPlanes(t),i.set(0,0,this.crane.height),n.set(0,0,this.crane.height+e.COEF_HEIGHT*this.crane.halfWidth),a.setup(i,n,this.crane.halfWidth+2*this.crane.beamBig),a.fillPlanes(t),n.set(0,0,this.crane.height+r-2*this.crane.beamBig),i.copy(n),i.z-=3*this.crane.beamBig,a.setup(i,n,this.crane.halfWidth+2*this.crane.beamBig),a.fillPlanes(t)},e.prototype.createRailJib=function(){var t=new On;this.crane.jibMesh.geometry=t,this.crane.craneColor.applyToMaterial(this.crane.jibMesh);var r=this.crane.jibLength+this.crane.halfWidth,i=r,n=e.COEF_WIDTH*this.crane.halfWidth,a=e.COEF_HEIGHT*this.crane.halfWidth,o=this.crane.beamBig,s=this.crane.height,l=new Mi(0,0,0),u=new Mi(0,0,0);l.set(0,0,s),u.set(i,0,s),Nh.BOX.setupStraitSegment(l,u,o,n),Nh.BOX.addPlanes(t),Nh.BOX.setupStraitSegment(l,u,a,o/2),Nh.BOX.addPlanes(t);var c=s+a-o;l.set(0,0,c),u.set(i,0,c),Nh.BOX.setupStraitSegment(l,u,o,n),Nh.BOX.addPlanes(t);var h=this.crane.jibLength/5;l.set(0,0,s+h-o),u.set(r/2,0,c),Nh.BOX.setupBox(l,u,2*o,2*o),Nh.BOX.addPlanes(t)},e.COEF_WIDTH=.6,e.COEF_HEIGHT=1.8,e}(nd),sd=function(t){function e(r){var i=t.call(this,r)||this;return i.craneColor=Dh.of(191,181,0),i.cabinColor=Dh.GRAY,i.type=e.TYPE_BIG,i.height=170,i.jibLength=110,i.halfWidth=10,i.hookSize=2,i.beamBig=1,i.beamSmall=.5,i.cableRadius=.1,i.cabinWidth=1.2*i.halfWidth,i.toPixels=10,i.jibAngle=0,i.hookOffset=i.jibLength/2,i.hookHeight=i.height/2,i.cableUpdated=!1,i}return Rh(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.mastMesh=this.createMesh(),this.jibMesh=this.createMesh(),this.hookMesh=this.createMesh(),this.hookBlockMesh=this.createMesh(),this.cableMesh=this.createMesh(),this.cabinMesh=this.createMesh(),this.trolleyMesh=this.createMesh(),this.baseMesh=this.createMesh(),this.jibMesh.add(this.cabinMesh),this.jibMesh.add(this.trolleyMesh),this.trolleyMesh.add(this.cableMesh),this.trolleyMesh.add(this.hookMesh),this.hookMesh.add(this.hookBlockMesh)},e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"jib-length"===e&&(this.jibLength=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"crane-height"===e&&(this.height=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"cabin-width"===e&&(this.cabinWidth=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"crane-width"===e&&(this.halfWidth=parseFloat(r)/2,this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"crane-color"===e&&(this.craneColor=Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"cabin-color"===e&&(this.cabinColor=Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-to-pixels"===e&&(this.toPixels=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"jib-angle"===e&&(this.jibAngle=-parseFloat(r)),"caret-distance"===e&&(this.hookOffset=parseFloat(r)),"hook-z"===e){var i=this.height-parseFloat(r);i!=this.hookHeight&&(this.hookHeight=i,this.cableUpdated=!1)}"3d-type"==e&&(this.type=r,this.setDirty3D(Uh.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var r=null;switch(this.type){case e.TYPE_BIG:case e.TYPE_MEDIUM:r=new ad(this);break;case e.TYPE_JIB:r=new od(this)}this.hookSize=this.halfWidth/2,this.beamBig=this.halfWidth/8,this.beamSmall=this.beamBig/2,this.cableRadius=this.beamSmall/2,this.hookOffset=this.jibLength/2,this.hookHeight=this.height/2,r.createAnimation()}this.cableUpdated||this.updateCables(),this.jibMesh.rotation.z=this.jibAngle,this.trolleyMesh.position.set(this.hookOffset,0,this.height),this.hookMesh.position.set(0,0,-this.hookHeight)},e.prototype.testAnimate=function(){var t=this,e=0,r=400,i=.4,n=.5,a=.004,o=function(){e>10||(r>0?(r--,(t.hookHeight<30||t.hookHeight>t.height-20)&&(n*=-1),t.hookHeight+=n,t.cableUpdated=!1,t.updateCables(),t.hookMesh.position.z=-t.hookHeight,setTimeout(o,15)):(e++,r=400,Math.random()>.5&&(a*=-1),l()))},s=function(){r>100?(r--,t.trolleyMesh.position.x+=i,(t.trolleyMesh.position.x<20||t.trolleyMesh.position.x>100)&&(i*=-1),setTimeout(s,15)):o()},l=function(){r>200?(r--,t.jibMesh.rotation.z+=a,setTimeout(l,15)):s()};l()},e.prototype.updateCables=function(){var t=this.hookSize;Dh.GRAY.applyToMaterial(this.cableMesh),null==this.cable&&(this.cable=new Kh,this.cable.faceCount=4);var e=new On;this.cableMesh.geometry=e;var r=this.cable,i=new Mi(-t/2,0,0),n=new Mi(-t/2,0,-this.hookHeight);r.setup(i,n,this.cableRadius),r.fillPlanes(e),n.x+=t,i.x+=t,r.setup(i,n,this.cableRadius),r.fillPlanes(e),this.cableUpdated=!0},e.TYPE_BIG="JIB_CRANE_CAT_HEAD",e.TYPE_MEDIUM="JIB_CRANE_FLAT_TOP",e.TYPE_JIB="JIB_CRANE_INDUSTRIAL",e}(Uh),ld=function(t){function e(e){var r=t.call(this,e)||this;return r.number=0,r.length=100,r.width=20,r.leftBalustradeWidth=15,r.rightBalustradeWidth=15,r.internalBalustradeWidth=10,r.lowerLandingLength=15,r.upperLandingLength=15,r.solidBalustrade=!0,r.dimensionsCompleted=null,r.angle=.524,r.offsets=[],r.offsetChanged=!0,r.toPixels=10,r.uppperLevelZ=0,r.handholdWidth=0,r.handholdHeight=0,r.escalatorHeight=0,r.stepWidth=5,r.stairsCount=0,r.stairLength=0,r.stairHeight=0,r.start=new Mi,r.low=new Mi,r.high=new Mi,r.end=new Mi,r}return Rh(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.handholdMesh=this.createMesh(),this.sideMesh=this.createMesh(),this.balustradeMesh=this.createMesh(),this.stairMesh=this.createMesh()},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"number-of-escalators"===e&&(this.number=parseInt(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"length"===e&&(this.length=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"width"===e&&(this.width=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"left-balustrade-width"===e&&(this.leftBalustradeWidth=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"right-balustrade-width"===e&&(this.rightBalustradeWidth=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"internal-balustrade-width"===e&&(this.internalBalustradeWidth=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"lower-landing-length"===e&&(this.lowerLandingLength=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"upper-landing-length"===e&&(this.upperLandingLength=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"balustrade-color"===e&&(this.balustradeColor=Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"solid-balustrade"===e&&(this.solidBalustrade="true"==r,this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-angle"===e&&(this.angle=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"offsets"===e&&(this.offsets=r.split(" ").map(function(t){return parseFloat(t)}),this.offsetChanged=!0),"step-width"===e&&(this.stepWidth=parseFloat(r)),"3d-to-pixels"===e&&(this.toPixels=parseFloat(r))},e.prototype.update3D=function(){if((t.prototype.update3D.call(this),this.escalatorHeight=.9*this.toPixels,this.handholdWidth=.1*this.toPixels,this.handholdHeight=this.handholdWidth/3,this.uppperLevelZ=Math.tan(this.angle)*this.length,this.stairsCount=Math.floor(this.length/this.stepWidth),this.stairLength=this.length/this.stairsCount,this.stairHeight=this.uppperLevelZ/this.stairsCount,this.isDirty3DSet(Uh.DIRTY_3D_SHAPE))&&(Dh.BLACK.applyToMaterial(this.handholdMesh),Dh.GRAY.applyToMaterial(this.stairMesh),null!=this.balustradeColor&&this.balustradeColor.applyToMaterial(this.balustradeMesh),this.handholdMesh.geometry=new On,this.balustradeMesh.geometry=new On,this.solidBalustrade&&null!=this.balustradeColor)){var e=this.leftBalustradeWidth/2,r=this.width+this.internalBalustradeWidth,i=-((this.number-1)*r+this.width+this.rightBalustradeWidth/2);this.addSide(e,this.leftBalustradeWidth),this.addSide(i,this.rightBalustradeWidth);for(var n=0;n<this.number-1;n++){var a=-(n*r+this.width+this.internalBalustradeWidth/2);this.addSide(a,this.internalBalustradeWidth)}}this.offsetChanged&&(Bh.disposeGeometry(this.stairMesh.geometry),this.stairMesh.geometry=new On);for(n=0;n<this.number;n++)this.addEscalator(n);this.offsetChanged=!1},e.prototype.addHalfCircle=function(t,e,r,i,n,a,o,s){for(var l=new Mi,u=new Mi,c=Math.PI/20,h=e.clone(),d=e.clone(),p=e.clone(),f=e.clone(),m=[h,d,p,f],g=0;g<20;g++)m.forEach(function(t){return t.copy(e)}),Kh.calcRadiusVector(u,r,i,c*g),Kh.calcRadiusVector(l,r,i,c*(g+1)),Bh.translateScaled(h,u,a),Bh.translateScaled(d,l,a),Bh.translateScaled(p,u,o),Bh.translateScaled(f,l,o),m.forEach(function(t){return Bh.translateScaled(t,n,-s/2)}),Nh.BOX.setupPrism(h,d,p,f,n,s),Nh.BOX.addPlanes(t,Fh.sides)},e.prototype.addPart=function(t){var e=this.handholdMesh.geometry;this.setPoints(t,0);var r=new Zh;r.segments=[(new qh).setup(this.start.clone(),this.low.clone()),(new qh).setup(this.low.clone(),this.high.clone()),(new qh).setup(this.high.clone(),this.end.clone())],r.halfWidth=this.handholdWidth/2,r.zHeight=this.handholdHeight,r.planes=Fh.all,r.fillPlanes(e),r.shiftZ(this.escalatorHeight-this.handholdHeight),r.fillPlanes(e);this.escalatorHeight,this.handholdHeight;var i=this.handholdWidth/3;r.translate(0,0,-this.escalatorHeight+2*this.handholdHeight),r.halfWidth=i/2,this.setPoints(t,this.escalatorHeight/2);var n=new Mi(0,0,1),a=new Mi(-1,0,0),o=new Mi(0,-1,0),s=this.handholdWidth,l=this.escalatorHeight/2-this.handholdHeight,u=this.escalatorHeight/2;this.addHalfCircle(e,this.start,n,a,o,l,u,s),a.negate(),o.negate(),this.addHalfCircle(e,this.end,n,a,o,l,u,s),this.addSide(t,i)},e.prototype.addSide=function(t,e){var r=this.balustradeMesh.geometry;this.setPoints(t,0);var i=new Zh;i.segments=[(new qh).setup(this.start.clone(),this.low.clone()),(new qh).setup(this.low.clone(),this.high.clone()),(new qh).setup(this.high.clone(),this.end.clone())],i.halfWidth=this.handholdWidth/2,i.planes=Fh.sides;var n=this.escalatorHeight-2*this.handholdHeight;i.translate(0,0,this.handholdHeight),i.halfWidth=e/2,i.zHeight=n,i.fillPlanes(r),this.setPoints(t,this.escalatorHeight/2);var a=new Mi(0,0,1),o=new Mi(-1,0,0),s=new Mi(0,-1,0),l=(this.handholdWidth,this.escalatorHeight/2-this.handholdHeight);this.escalatorHeight;this.addHalfCircle(r,this.start,a,o,s,0,l,e),o.negate(),s.negate(),this.addHalfCircle(r,this.end,a,o,s,0,l,e)},e.prototype.setPoints=function(t,e){this.start.set(0,t,e),this.low.set(this.lowerLandingLength,t,e),this.high.set(this.lowerLandingLength+this.length,t,this.uppperLevelZ+e),this.end.set(this.lowerLandingLength+this.length+this.upperLandingLength,t,this.uppperLevelZ+e)},e.prototype.addStairs=function(t,e){var r=this.stairMesh.geometry,i=(this.width-this.handholdWidth)/2;(e%=this.stairLength)<0&&(e+=this.stairLength);var n=this.low.x+e,a=e/this.stairLength*this.stairHeight,o=this.stairHeight-a,s=.11+a,l=new Mi,u=new Mi;l.set(n-this.stairLength,t,.11),u.set(n,t,.11);var c=Nh.BOX;Nh.BOX.setupStraitSegment(l,u,a,i);var h=Fh.of(Fh.FRONT|Fh.BOTTOM|Fh.DOUBLE_SIDE),d=Fh.of(Fh.BACK|Fh.TOP|Fh.DOUBLE_SIDE);c.addPlanes(r,h);for(var p=0;p<this.stairsCount;p++){var f=s+.1+p*this.stairHeight,m=p==this.stairsCount-1?o:this.stairHeight;l.set(n+this.stairLength*p,t,f),u.set(n+this.stairLength*(p+1),t,f),c.setupStraitSegment(l,u,m,i),this.uppperLevelZ>0?c.addPlanes(r,h):c.addPlanes(r,d)}this.setPoints(t,.11);var g=Fh.of(Fh.BOTTOM|Fh.DOUBLE_SIDE);c.setupStraitSegment(this.start,this.low,this.stairHeight,i),c.addPlanes(r,g),this.high.x=this.high.x+e,c.setupStraitSegment(this.high,this.end,this.stairHeight,i),c.addPlanes(r,g),Bh.calculateTextureUVS(r)},e.prototype.addEscalator=function(t){var e=-t*(this.width+this.internalBalustradeWidth),r=e-this.width,i=e-this.width/2;this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)&&(this.addPart(e),this.addPart(r)),this.offsetChanged&&(this.addStairs(i,this.offsets[t]),this.addBottom(i))},e.prototype.addBottom=function(t){this.setPoints(t,0);var e=this.stairMesh.geometry,r=Math.sign(this.uppperLevelZ)*this.stairLength*2,i=this.width,n=this.low.x,a=this.high.x,o=new Mi(n,t,-.01),s=new Mi(n+r,t,-.01),l=new Mi(a,t,-.01+this.uppperLevelZ),u=new Mi(a+r,t,-.01+this.uppperLevelZ),c=new Mi(0,-1,0);[o,l,s,u].forEach(function(t){return Bh.translateScaled(t,c,-i/2)}),Nh.BOX.setupPrism(o,l,s,u,c,i),Nh.BOX.addPlanes(e,Fh.of(Fh.BOTTOM|Fh.TOP|Fh.BACK|Fh.RIGHT|Fh.DOUBLE_SIDE))},e}(Uh),ud=function(t){function e(e){var r=t.call(this,e)||this;return r.toPixels=10,r.fences=[],r}return Rh(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this)},e.prototype.updateParameter=function(e,r){var i=this;if(t.prototype.updateParameter.call(this,e,r),"3d-queue"===e&&(r.split("|").forEach(function(t){for(var e=[],r=t.split(":"),n=1;n<r.length;n++){var a=Bh.parseParamList(r[n]).map(Number),o=new Mi(a[0],a[1],a[2]);if(e.push(o),n==r.length-1){var s=new Mi(a[3],a[4],a[5]);e.push(s)}}i.fences.push(e)}),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"queue"===e){var n=r.split(":"),a=n[n.length-1];this.fenceColor=Dh.parseRGB(a)}"3d-to-pixels"===e&&(this.toPixels=parseFloat(r))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var e=new qh,r=new jh;r.autoFacecount=!1,r.faceCount=25;var i=new On,n=new On,a=.1*this.toPixels,o=1*this.toPixels,s=.04*this.toPixels,l=.01*this.toPixels,u=.15*this.toPixels,c=o-1.2*a;this.fences.forEach(function(t){for(var h=t.length,d=0;d<h-1;d++)e.setup(t[d].clone(),t[d+1].clone()),e.shiftZ(c),e.fillPlanes(i,Fh.all,a,a/20);for(d=0;d<h;d++){var p=s,f=u,m=t[d];r.x=m.x,r.y=m.y,r.rx=r.ry=p,r.z1=r.z2=m.z,r.addPlanes(n,Fh.all,!0,o,0),r.rx=r.ry=f,r.addPlanes(n,Fh.all,!0,l,0)}}),this.standsMesh=this.createMesh(),this.ribbonMesh=this.createMesh(),this.ribbonMesh.geometry=i,this.fenceColor.applyToMaterial(this.ribbonMesh),this.standsMesh.geometry=n,Dh.GRAY.applyToMaterial(this.standsMesh)}},e}(Uh),cd=function(t){function e(e){var r=t.call(this,e)||this;return r._children=[],r}return Rh(e,t),e.prototype.create3D=function(){this.element=new Zo,this.element.name=this.constructor.name+":"+this.id},Object.defineProperty(e.prototype,"children",{get:function(){return this._children},set:function(t){this._children=t},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r)},e.prototype.add=function(t){this._children.push(t),t.parent=this,this.element.add(t.element)},e.prototype.remove=function(t){var e=this._children.indexOf(t);e>-1&&(this._children.splice(e,1),this.element.remove(t.element),t.parent=null)},e.prototype.dispose=function(){this.children.forEach(function(t){return t.dispose()}),this.children=[],t.prototype.dispose.call(this)},e}(Uh),hd=function(t){function e(e){var r=t.call(this,e)||this;return r.global=!1,r.enabled=!0,r.attenuationConst=0,r.attenuationLinear=0,r.attenuationQuad=0,r.cutoffAngle=0,r.dropoffRate=0,r.lightRotationX=0,r.lightRotationZ=0,r.type="",r.type=Bh.getAttributeValue(e,"3d-type"),r}return Rh(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.createLight()},e.prototype.createLight=function(){switch(this.type){case e.DIRECTIONAL:this.light=new ic;break;case e.POINT:case e.POINT_STREET:this.light=new tc;break;case e.SPOT:case e.SPOT_CAR:this.light=new $u;break;case e.AMBIENT:this.light=new nc;break;case e.AMBIENT_DAY:case e.AMBIENT_MOON:this.lightGroup=Bh.createDefaultLight()}null!=this.light&&this.element.add(this.light),null!=this.lightGroup&&this.element.add(this.lightGroup),(this.light instanceof $u||this.light instanceof ic)&&(this.target=this.light.target,this.element.add(this.target)),this.element.name=this.constructor.name+":"+this.type+":"+this.id,this.enabled&&(window.light=this,window.lighte=this.element.children[0])},e.prototype.updateParameter=function(e,r){var i;if("pos"===e){var n=r.split(":");return this.x=parseFloat(n[0]),this.y=-parseFloat(n[1]),void(this.lightRotationZ=-parseFloat(n[2]))}if("3d-rot"===e){n=r.split(":");return this.lightRotationX=parseFloat(n[0]),void this.setDirty3D(Uh.DIRTY_3D_TRANSFORM)}t.prototype.updateParameter.call(this,e,r),"3d-diffuse"===e&&(this.diffuse="none"===r?null:Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_COLOR)),"3d-specular"===e&&(this.specular="none"===r?null:Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_COLOR)),"3d-ambient"===e&&(this.ambient="none"===r?null:Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_COLOR)),"3d-global"===e&&(this.global="true"===r,this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"enabled"===e&&(this.visible="true"===r,this.setDirty3D(Uh.DIRTY_3D_VISIBILITY)),"3d-attenuation"===e&&(i=r.split(":").map(function(t){return parseFloat(t)}),this.attenuationConst=i[0],this.attenuationLinear=i[1],this.attenuationQuad=i[2],this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-cutoff-angle"===e&&(this.cutoffAngle=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-dropoff-rate"===e&&(this.dropoffRate=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-type"===e&&(this.type=r,this.setDirty3D(Uh.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){var e=this;if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_TRANSFORM)&&null!=this.target){var r=this.lightRotationX,i=this.lightRotationZ,n=Bh.getPointOnSpere(r+Math.PI/2,i);n.multiplyScalar(50),this.target.position.set(0,0,0),this.target.position.add(n)}if(this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){if(null!=this.light&&(this.light.intensity=1),this.light instanceof $u){var a=this.light;a.angle=this.cutoffAngle,a.penumbra=this.dropoffRate,this.applyAttenuation(this.light)}this.light instanceof tc&&this.applyAttenuation(this.light)}this.isDirty3DSet(Uh.DIRTY_3D_COLOR)&&(null!=this.light?this.light.color=this.getColor():null!=this.lightGroup&&this.lightGroup.children.forEach(function(t){t.color=e.getColor()}))},e.prototype.getColor=function(){return(null!=this.diffuse?this.diffuse:Dh.BLACK).toThreeColor()},e.prototype.applyAttenuation=function(t){t.intensity=6.25/(this.attenuationConst+6.25);var e=Math.min(this.attenuationLinear,.5);0==this.attenuationLinear?(t.decay=1,t.distance=0):(t.distance=1e4*(.5-e)+100,t.decay=50*Math.sqrt(1-(e-.5)*(e-.5)/.25))},e.prototype.dispose=function(){this.target,t.prototype.dispose.call(this)},e.DIRECTIONAL="Light3DDirectional",e.POINT="Light3DPoint",e.POINT_STREET="StreetLight",e.AMBIENT="Light3DAmbient",e.AMBIENT_DAY="Daylight",e.AMBIENT_MOON="Moonlight",e.SPOT="Light3DSpot",e.SPOT_CAR="CarHeadlight",e}(Uh),dd=function(t){function e(e){return t.call(this,e)||this}return Rh(e,t),Object.defineProperty(e.prototype,"dy",{get:function(){return this._dy},set:function(t){this._dy=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dx",{get:function(){return this._dx},set:function(t){this._dx=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dz",{get:function(){return this._dz},set:function(t){this._dz=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"x2"===e&&(this.dx=Number.parseFloat(r)),"y2"===e&&(this.dy=-Number.parseFloat(r)),"3d-dz"===e&&(this.dz=Number.parseFloat(r))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var e=new qu,r=new Mi(0,0,0),i=new Mi(this.dx,this.dy,this.dz),n=new Mi(i.x-r.x,i.y-r.y,0).normalize(),a=new Mi(-n.y,n.x,0),o=this.lineWidth/2;e.moveTo(r.x-o*a.x,r.y-o*a.y),e.lineTo(r.x+o*a.x,r.y+o*a.y),e.lineTo(i.x+o*a.x,i.y+o*a.y),e.lineTo(i.x-o*a.x,i.y-o*a.y),Nh.BOX.setupStraitSegment(r,i,this.zHeight,this.lineWidth/2),Bh.disposeGeometry(this.lineMesh.geometry),this.lineMesh.geometry=Nh.BOX.createGeometry(Fh.all)}},e.prototype.geom=function(){var t=new Mi(0,0,0),e=new Mi(this.dx,this.dy,this.dz),r=Bh.getLeftNormal(t,e),i=this.lineWidth/2,n=new On;n.vertices.push(Bh.getTranslated(t,r,i)),n.vertices.push(Bh.getTranslated(e,r,i)),n.vertices.push(Bh.getTranslated(e,r,-i)),n.vertices.push(Bh.getTranslated(t,r,-i));var a=new vn(0,3,1),o=new vn(1,3,2);return n.faces.push(a,o),n.computeFaceNormals(),n.computeVertexNormals(),n},e}(Hh),pd=function(t){this.manager=void 0!==t?t:yu};pd.prototype={constructor:void 0,crossOrigin:"Anonymous",load:function(t,e,r,i){var n=this,a=void 0===n.path?sc(t):n.path,o=new Tu(n.manager);o.setPath(n.path),o.load(t,function(t){e(n.parse(t,a))},r,i)},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},options:{set convertUpAxis(t){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(t){return this.crossOrigin=t,this},parse:function(t,e){function r(t,e){for(var r=[],i=t.childNodes,n=0,a=i.length;n<a;n++){var o=i[n];o.nodeName===e&&r.push(o)}return r}function i(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),i=0,n=e.length;i<n;i++)r[i]=e[i];return r}function n(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),i=0,n=e.length;i<n;i++)r[i]=parseFloat(e[i]);return r}function a(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),i=0,n=e.length;i<n;i++)r[i]=parseInt(e[i]);return r}function o(t){return t.substring(1)}function s(t){return 0===Object.keys(t).length}function l(t){return void 0!==t&&!0===t.hasAttribute("meter")?parseFloat(t.getAttribute("meter")):1}function u(t){return void 0!==t?t.textContent:"Y_UP"}function c(t,e,i,n){var a=r(t,e)[0];if(void 0!==a)for(var o=r(a,i),s=0;s<o.length;s++)n(o[s])}function h(t,e){for(var r in t){t[r].build=e(t[r])}}function d(t,e){return void 0!==t.build?t.build:(t.build=e(t),t.build)}function p(t){for(var e={inputs:{}},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var a=o(n.getAttribute("source")),s=n.getAttribute("semantic");e.inputs[s]=a}}return e}function f(t){var e={},r=t.getAttribute("target").split("/"),i=r.shift(),n=r.shift(),a=-1!==n.indexOf("("),s=-1!==n.indexOf(".");if(s)r=n.split("."),n=r.shift(),e.member=r.shift();else if(a){var l=n.split("(");n=l.shift();for(var u=0;u<l.length;u++)l[u]=parseInt(l[u].replace(/\)/,""));e.indices=l}return e.id=i,e.sid=n,e.arraySyntax=a,e.memberSyntax=s,e.sampler=o(t.getAttribute("source")),e}function m(t){var e=[],r=t.channels,i=t.samplers,n=t.sources;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a],s=i[o.sampler],l=s.inputs.INPUT,u=s.inputs.OUTPUT;T(v(o,n[l],n[u]),e)}return e}function g(t){return d(jt.animations[t],m)}function v(t,e,r){var i,n,a,o,s,l,u=jt.nodes[t.id],c=Dt(u.id),h=u.transforms[t.sid],d=u.matrix.clone().transpose(),p={};switch(h){case"matrix":for(a=0,o=e.array.length;a<o;a++)if(i=e.array[a],n=a*r.stride,void 0===p[i]&&(p[i]={}),!0===t.arraySyntax){var f=r.array[n],m=t.indices[0]+4*t.indices[1];p[i][m]=f}else for(s=0,l=r.stride;s<l;s++)p[i][s]=r.array[n+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var g=function(t,e){var r=[];for(var i in t)r.push({time:parseFloat(i),value:t[i]});r.sort(function(t,e){return t.time-e.time});for(var n=0;n<16;n++)C(r,n,e.elements[n]);return r}(p,d);return{name:c.uuid,keyframes:g}}var b=new Mi,y=new Mi,A=new xi;function T(t,e){for(var r=t.keyframes,i=t.name,n=[],a=[],o=[],s=[],l=0,u=r.length;l<u;l++){var c=r[l],h=c.time,d=c.value;Et.fromArray(d).transpose(),Et.decompose(b,A,y),n.push(h),a.push(b.x,b.y,b.z),o.push(A.x,A.y,A.z,A.w),s.push(y.x,y.y,y.z)}return a.length>0&&e.push(new fu(i+".position",n,a,null)),o.length>0&&e.push(new du(i+".quaternion",n,o,null)),s.length>0&&e.push(new fu(i+".scale",n,s,null)),e}function C(t,e,r){var i,n,a,o=!0;for(n=0,a=t.length;n<a;n++)void 0===(i=t[n]).value[e]?i.value[e]=null:o=!1;if(!0===o)for(n=0,a=t.length;n<a;n++)(i=t[n]).value[e]=r;else!function(t,e){for(var r,i,n=0,a=t.length;n<a;n++){var o=t[n];if(null===o.value[e]){if(r=S(t,n,e),i=E(t,n,e),null===r){o.value[e]=i.value[e];continue}if(null===i){o.value[e]=r.value[e];continue}w(o,r,i,e)}}}(t,e)}function S(t,e,r){for(;e>=0;){var i=t[e];if(null!==i.value[r])return i;e--}return null}function E(t,e,r){for(;e<t.length;){var i=t[e];if(null!==i.value[r])return i;e++}return null}function w(t,e,r,i){r.time-e.time!=0?t.value[i]=(t.time-e.time)*(r.value[i]-e.value[i])/(r.time-e.time)+e.value[i]:t.value[i]=e.value[i]}function k(t){for(var e=[],r=t.name,i=t.end-t.start||-1,n=t.animations,a=0,o=n.length;a<o;a++)for(var s=g(n[a]),l=0,u=s.length;l<u;l++)e.push(s[l]);return new mu(r,i,e)}function x(t){return d(jt.clips[t],k)}function M(t){for(var e={sources:{}},r=0,i=t.childNodes.length;r<i;r++){var a=t.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=n(a.textContent);break;case"source":var o=a.getAttribute("id");e.sources[o]=nt(a);break;case"joints":e.joints=O(a);break;case"vertex_weights":e.vertexWeights=I(a)}}return e}function O(t){for(var e={inputs:{}},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var a=n.getAttribute("semantic"),s=o(n.getAttribute("source"));e.inputs[a]=s}}return e}function I(t){for(var e={inputs:{}},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var s=n.getAttribute("semantic"),l=o(n.getAttribute("source")),u=parseInt(n.getAttribute("offset"));e.inputs[s]={id:l,offset:u};break;case"vcount":e.vcount=a(n.textContent);break;case"v":e.v=a(n.textContent)}}return e}function _(t){var e={id:t.id},r=jt.geometries[e.id];return void 0!==t.skin&&(e.skin=function(t){var e,r,i,n={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},a=t.sources,o=t.vertexWeights,s=o.vcount,l=o.v,u=o.inputs.JOINT.offset,c=o.inputs.WEIGHT.offset,h=t.sources[t.joints.inputs.JOINT],d=t.sources[t.joints.inputs.INV_BIND_MATRIX],p=a[o.inputs.WEIGHT.id].array,f=0;for(e=0,i=s.length;e<i;e++){var m=s[e],g=[];for(r=0;r<m;r++){var v=l[f+u],b=l[f+c],y=p[b];g.push({index:v,weight:y}),f+=2}for(g.sort(S),r=0;r<4;r++){var A=g[r];void 0!==A?(n.indices.array.push(A.index),n.weights.array.push(A.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}t.bindShapeMatrix?n.bindMatrix=(new rn).fromArray(t.bindShapeMatrix).transpose():n.bindMatrix=(new rn).identity();for(e=0,i=h.array.length;e<i;e++){var T=h.array[e],C=(new rn).fromArray(d.array,e*d.stride).transpose();n.joints.push({name:T,boneInverse:C})}return n;function S(t,e){return e.weight-t.weight}}(t.skin),r.sources.skinIndices=e.skin.indices,r.sources.skinWeights=e.skin.weights),e}function L(t){return void 0!==t.build?t.build:t.init_from}function P(t){var e=jt.images[t];return void 0!==e?d(e,L):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",t),null)}function R(t){for(var e={surfaces:{},samplers:{}},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"newparam":D(n,e);break;case"technique":e.technique=B(n);break;case"extra":e.extra=V(n)}}return e}function D(t,e){for(var r=t.getAttribute("sid"),i=0,n=t.childNodes.length;i<n;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"surface":e.surfaces[r]=F(a);break;case"sampler2D":e.samplers[r]=N(a)}}}function F(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"init_from":e.init_from=n.textContent}}return e}function N(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"source":e.source=n.textContent}}return e}function B(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=n.nodeName,e.parameters=G(n)}}return e}function G(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":e[n.nodeName]=U(n);break;case"transparent":e[n.nodeName]={opaque:n.getAttribute("opaque"),data:U(n)}}}return e}function U(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var a=t.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":e[a.nodeName]=n(a.textContent);break;case"float":e[a.nodeName]=parseFloat(a.textContent);break;case"texture":e[a.nodeName]={id:a.getAttribute("texture"),extra:z(a)}}}return e}function z(t){for(var e={technique:{}},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"extra":W(n,e)}}return e}function W(t,e){for(var r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":H(n,e)}}}function H(t,e){for(var r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?e.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?e.technique[n.nodeName]=0:e.technique[n.nodeName]=parseInt(n.textContent)}}}function V(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":e.technique=Y(n)}}return e}function Y(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"double_sided":e[n.nodeName]=parseInt(n.textContent)}}return e}function j(t){return t}function X(t){var e,r,i=(e=t.url,d(jt.effects[e],j)),n=i.profile.technique,a=i.profile.extra;switch(n.type){case"phong":case"blinn":r=new Zl;break;case"lambert":r=new Jl;break;default:r=new pa}function o(t){var e=i.profile.samplers[t.id],r=null;void 0!==e?r=P(i.profile.surfaces[e.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=P(t.id));if(null!==r){var n=function(t){var e,r=t.slice(2+(t.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase()){case"tga":e=Ut;break;default:e=Wt}return e}(r);if(void 0!==n){var a=n.load(r),o=t.extra;if(void 0!==o&&void 0!==o.technique&&!1===s(o.technique)){var l=o.technique;a.wrapS=l.wrapU?hr:dr,a.wrapT=l.wrapV?hr:dr,a.offset.set(l.offsetU||0,l.offsetV||0),a.repeat.set(l.repeatU||1,l.repeatV||1)}else a.wrapS=hr,a.wrapT=hr;return a}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",t.id),null}r.name=t.name;var l=n.parameters;for(var u in l){var c=l[u];switch(u){case"diffuse":c.color&&r.color.fromArray(c.color),c.texture&&(r.map=o(c.texture));break;case"specular":c.color&&r.specular&&r.specular.fromArray(c.color),c.texture&&(r.specularMap=o(c.texture));break;case"bump":c.texture&&(r.normalMap=o(c.texture));break;case"ambient":c.texture&&(r.lightMap=o(c.texture));break;case"shininess":c.float&&r.shininess&&(r.shininess=c.float);break;case"emission":c.color&&r.emissive&&r.emissive.fromArray(c.color),c.texture&&(r.emissiveMap=o(c.texture))}}var h=l.transparent,p=l.transparency;if(void 0===p&&h&&(p={float:1}),void 0===h&&p&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&p)if(h.data.texture)r.transparent=!0;else{var f=h.data.color;switch(h.opaque){case"A_ONE":r.opacity=f[3]*p.float;break;case"RGB_ZERO":r.opacity=1-f[0]*p.float;break;case"A_ZERO":r.opacity=1-f[3]*p.float;break;case"RGB_ONE":r.opacity=f[0]*p.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}r.opacity<1&&(r.transparent=!0)}return void 0!==a&&void 0!==a.technique&&1===a.technique.double_sided&&(r.side=me),r}function q(t){return d(jt.materials[t],X)}function Z(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"technique_common":return K(r)}}return{}}function K(t){for(var e={},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];switch(i.nodeName){case"perspective":case"orthographic":e.technique=i.nodeName,e.parameters=Q(i)}}return e}function Q(t){for(var e={},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];switch(i.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[i.nodeName]=parseFloat(i.textContent)}}return e}function J(t){var e;switch(t.optics.technique){case"perspective":e=new Qo(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":var r=t.optics.parameters.ymag,i=t.optics.parameters.xmag,n=t.optics.parameters.aspect_ratio;i=void 0===i?r*n:i,r=void 0===r?i/n:r,e=new ec(-(i*=.5),i,r*=.5,-r,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new Qo}return e.name=t.name,e}function $(t){var e=jt.cameras[t];return void 0!==e?d(e,J):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",t),null)}function tt(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=n.nodeName,e.parameters=et(n)}}return e}function et(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var a=t.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":var o=n(a.textContent);e.color=(new hn).fromArray(o);break;case"falloff_angle":e.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":var s=parseFloat(a.textContent);e.distance=s?Math.sqrt(1/s):0}}return e}function rt(t){var e;switch(t.technique){case"directional":e=new ic;break;case"point":e=new tc;break;case"spot":e=new $u;break;case"ambient":e=new nc}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function it(t){var e=jt.lights[t];return void 0!==e?d(e,rt):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",t),null)}function nt(t){for(var e={array:[],stride:3},a=0;a<t.childNodes.length;a++){var o=t.childNodes[a];if(1===o.nodeType)switch(o.nodeName){case"float_array":e.array=n(o.textContent);break;case"Name_array":e.array=i(o.textContent);break;case"technique_common":var s=r(o,"accessor")[0];void 0!==s&&(e.stride=parseInt(s.getAttribute("stride")))}}return e}function at(t){for(var e={},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];1===i.nodeType&&(e[i.getAttribute("semantic")]=o(i.getAttribute("source")))}return e}function ot(t){for(var e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var s=o(n.getAttribute("source")),l=n.getAttribute("semantic"),u=parseInt(n.getAttribute("offset")),c=parseInt(n.getAttribute("set")),h=c>0?l+c:l;e.inputs[h]={id:s,offset:u},e.stride=Math.max(e.stride,u+1),"TEXCOORD"===l&&(e.hasUV=!0);break;case"vcount":e.vcount=a(n.textContent);break;case"p":e.p=a(n.textContent)}}return e}function st(t){for(var e=0,r=0,i=t.length;r<i;r++){!0===t[r].hasUV&&e++}e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function lt(t){var e={},r=t.sources,i=t.vertices,n=t.primitives;if(0===n.length)return{};var a=function(t){for(var e={},r=0;r<t.length;r++){var i=t[r];void 0===e[i.type]&&(e[i.type]=[]),e[i.type].push(i)}return e}(n);for(var o in a){var s=a[o];st(s),e[o]=ut(s,r,i)}return e}function ut(t,e,r){for(var i={},n={array:[],stride:0},a={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},u=[],c=4,h=[],d=4,p=new Hn,f=[],m=0,g=0;g<t.length;g++){var v=t[g],b=v.inputs,y=0;switch(v.type){case"lines":case"linestrips":y=2*v.count;break;case"triangles":y=3*v.count;break;case"polylist":for(var A=0;A<v.count;A++){var T=v.vcount[A];switch(T){case 3:y+=3;break;case 4:y+=6;break;default:y+=3*(T-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",v.type)}for(var C in p.addGroup(m,y,g),m+=y,v.material&&f.push(v.material),b){var S=b[C];switch(C){case"VERTEX":for(var E in r){var w=r[E];switch(E){case"POSITION":var k=n.array.length;if(ct(v,e[w],S.offset,n.array),n.stride=e[w].stride,e.skinWeights&&e.skinIndices&&(ct(v,e.skinIndices,S.offset,u),ct(v,e.skinWeights,S.offset,h)),!1===v.hasUV&&!0===t.uvsNeedsFix){y=(n.array.length-k)/n.stride;for(var x=0;x<y;x++)o.array.push(0,0)}break;case"NORMAL":ct(v,e[w],S.offset,a.array),a.stride=e[w].stride;break;case"COLOR":ct(v,e[w],S.offset,l.array),l.stride=e[w].stride;break;case"TEXCOORD":ct(v,e[w],S.offset,o.array),o.stride=e[w].stride;break;case"TEXCOORD1":ct(v,e[w],S.offset,s.array),o.stride=e[w].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',E)}}break;case"NORMAL":ct(v,e[S.id],S.offset,a.array),a.stride=e[S.id].stride;break;case"COLOR":ct(v,e[S.id],S.offset,l.array),l.stride=e[S.id].stride;break;case"TEXCOORD":ct(v,e[S.id],S.offset,o.array),o.stride=e[S.id].stride;break;case"TEXCOORD1":ct(v,e[S.id],S.offset,s.array),s.stride=e[S.id].stride}}}return n.array.length>0&&p.addAttribute("position",new Bn(n.array,n.stride)),a.array.length>0&&p.addAttribute("normal",new Bn(a.array,a.stride)),l.array.length>0&&p.addAttribute("color",new Bn(l.array,l.stride)),o.array.length>0&&p.addAttribute("uv",new Bn(o.array,o.stride)),s.array.length>0&&p.addAttribute("uv2",new Bn(s.array,s.stride)),u.length>0&&p.addAttribute("skinIndex",new Bn(u,c)),h.length>0&&p.addAttribute("skinWeight",new Bn(h,d)),i.data=p,i.type=t[0].type,i.materialKeys=f,i}function ct(t,e,r,i){var n=t.p,a=t.stride,o=t.vcount;function s(t){for(var e=n[t+r]*u,a=e+u;e<a;e++)i.push(l[e])}var l=e.array,u=e.stride;if(void 0!==t.vcount)for(var c=0,h=0,d=o.length;h<d;h++){var p=o[h];if(4===p){var f=c+0*a,m=c+1*a,g=c+2*a,v=c+3*a;s(f),s(m),s(v),s(m),s(g),s(v)}else if(3===p)m=c+1*a,g=c+2*a,s(f=c+0*a),s(m),s(g);else if(p>4)for(var b=1,y=p-2;b<=y;b++)m=c+a*b,g=c+a*(b+1),s(f=c+0*a),s(m),s(g);c+=a*p}else for(h=0,d=n.length;h<d;h+=a)s(h)}function ht(t){return d(jt.geometries[t],lt)}function dt(t){return void 0!==t.build?t.build:t}function pt(t,e){for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"joint":e.joints[i.getAttribute("sid")]=ft(i);break;case"link":e.links.push(gt(i))}}}function ft(t){for(var e,r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"prismatic":case"revolute":e=mt(i,null)}}return e}function mt(t,e){e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new Mi,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"axis":var a=n(i.textContent);e.axis.fromArray(a);break;case"limits":var o=i.getElementsByTagName("max")[0],s=i.getElementsByTagName("min")[0];e.limits.max=parseFloat(o.textContent),e.limits.min=parseFloat(s.textContent)}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function gt(t){for(var e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"attachment_full":e.attachments.push(vt(i));break;case"matrix":case"translate":case"rotate":e.transforms.push(bt(i))}}return e}function vt(t){for(var e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"link":e.links.push(gt(i));break;case"matrix":case"translate":case"rotate":e.transforms.push(bt(i))}}return e}function bt(t){var e={type:t.nodeName},r=n(t.textContent);switch(e.type){case"matrix":e.obj=new rn,e.obj.fromArray(r).transpose();break;case"translate":e.obj=new Mi,e.obj.fromArray(r);break;case"rotate":e.obj=new Mi,e.obj.fromArray(r),e.angle=wi.degToRad(r[3])}return e}function yt(t,e){for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":At(i,e)}}}function At(t,e){for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"inertia":e.inertia=n(i.textContent);break;case"mass":e.mass=n(i.textContent)[0]}}}function Tt(t){for(var e={target:t.getAttribute("target").split("/").pop()},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"axis":var n=i.getElementsByTagName("param")[0];e.axis=n.textContent;var a=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=a.substr(0,a.length-1)}}return e}function Ct(t){return void 0!==t.build?t.build:t}function St(t){for(var e=[],r=Bt.querySelector('[id="'+t.id+'"]'),i=0;i<r.childNodes.length;i++){var a=r.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"matrix":var o=n(a.textContent),s=(new rn).fromArray(o).transpose();e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:s});break;case"translate":case"scale":o=n(a.textContent);var l=(new Mi).fromArray(o);e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l});break;case"rotate":o=n(a.textContent),l=(new Mi).fromArray(o);var u=wi.degToRad(o[3]);e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l,angle:u})}}return e}var Et=new rn,wt=new Mi;function kt(t){for(var e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new rn,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"node":e.nodes.push(i.getAttribute("id")),kt(i);break;case"instance_camera":e.instanceCameras.push(o(i.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(xt(i));break;case"instance_light":e.instanceLights.push(o(i.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(xt(i));break;case"instance_node":e.instanceNodes.push(o(i.getAttribute("url")));break;case"matrix":var a=n(i.textContent);e.matrix.multiply(Et.fromArray(a).transpose()),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"translate":a=n(i.textContent),wt.fromArray(a),e.matrix.multiply(Et.makeTranslation(wt.x,wt.y,wt.z)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"rotate":a=n(i.textContent);var s=wi.degToRad(a[3]);e.matrix.multiply(Et.makeRotationAxis(wt.fromArray(a),s)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"scale":a=n(i.textContent),e.matrix.scale(wt.fromArray(a)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"extra":break;default:console.log(i)}}return Rt(e.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",e.id):jt.nodes[e.id]=e,e}function xt(t){for(var e={id:o(t.getAttribute("url")),materials:{},skeletons:[]},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];switch(i.nodeName){case"bind_material":for(var n=i.getElementsByTagName("instance_material"),a=0;a<n.length;a++){var s=n[a],l=s.getAttribute("symbol"),u=s.getAttribute("target");e.materials[l]=o(u)}break;case"skeleton":e.skeletons.push(o(i.textContent))}}return e}function Mt(t,e){var r,i,n,a,o=[],s=[];for(r=0;r<t.length;r++){var l=t[r];if(Rt(l))Ot(Dt(l),e,o);else if(a=l,void 0!==jt.visualScenes[a]){var u=jt.visualScenes[l].children;for(i=0;i<u.length;i++){var c=u[i];"JOINT"===c.type&&Ot(Dt(c.id),e,o)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",l)}for(r=0;r<e.length;r++)for(i=0;i<o.length;i++)if((n=o[i]).bone.name===e[r].name){s[r]=n,n.processed=!0;break}for(r=0;r<o.length;r++)!1===(n=o[r]).processed&&(s.push(n),n.processed=!0);var h=[],d=[];for(r=0;r<s.length;r++)n=s[r],h.push(n.bone),d.push(n.boneInverse);return new As(h,d)}function Ot(t,e,r){t.traverse(function(t){if(!0===t.isBone){for(var i,n=0;n<e.length;n++){var a=e[n];if(a.name===t.name){i=a.boneInverse;break}}void 0===i&&(i=new rn),r.push({bone:t,boneInverse:i,processed:!1})}})}function It(t){for(var e,r=[],i=t.matrix,n=t.nodes,a=t.type,o=t.instanceCameras,s=t.instanceControllers,l=t.instanceLights,u=t.instanceGeometries,c=t.instanceNodes,h=0,p=n.length;h<p;h++)r.push(Dt(n[h]));for(h=0,p=o.length;h<p;h++){var f=$(o[h]);null!==f&&r.push(f.clone())}for(h=0,p=s.length;h<p;h++)for(var m=s[h],g=(e=m.id,d(jt.controllers[e],_)),v=ht(g.id),b=Pt(v,m.materials),y=Mt(m.skeletons,g.skin.joints),A=0,T=b.length;A<T;A++){var C=b[A];C.isSkinnedMesh&&(C.bind(y,g.skin.bindMatrix),C.normalizeSkinWeights()),r.push(C)}for(h=0,p=l.length;h<p;h++){var S=it(l[h]);null!==S&&r.push(S.clone())}for(h=0,p=u.length;h<p;h++)for(A=0,T=(b=Pt(v=ht((m=u[h]).id),m.materials)).length;A<T;A++)r.push(b[A]);for(h=0,p=c.length;h<p;h++)r.push(Dt(c[h]).clone());if(0===n.length&&1===r.length)C=r[0];else for(C="JOINT"===a?new Ts:new Zo,h=0;h<r.length;h++)C.add(r[h]);return""===C.name&&(C.name="JOINT"===a?t.sid:t.name),C.matrix.copy(i),C.matrix.decompose(C.position,C.quaternion,C.scale),C}var _t=new pa({color:16711935});function Lt(t,e){for(var r=[],i=0,n=t.length;i<n;i++){var a=e[t[i]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",t[i]),r.push(_t)):r.push(q(a))}return r}function Pt(t,e){var r=[];for(var i in t){var n=t[i],a=Lt(n.materialKeys,e);0===a.length&&("lines"===i||"linestrips"===i?a.push(new Cs):a.push(new Zl));var o=void 0!==n.data.attributes.skinIndex;if(o)for(var s=0,l=a.length;s<l;s++)a[s].skinning=!0;var u,c=1===a.length?a[0]:a;switch(i){case"lines":u=new Es(n.data,c);break;case"linestrips":u=new Ss(n.data,c);break;case"triangles":case"polylist":u=o?new ys(n.data,c):new fa(n.data,c)}r.push(u)}return r}function Rt(t){return void 0!==jt.nodes[t]}function Dt(t){return d(jt.nodes[t],It)}function Ft(t){var e=new Zo;e.name=t.name;for(var r=t.children,i=0;i<r.length;i++){var n=r[i];e.add(Dt(n.id))}return e}function Nt(t){return d(jt.visualScenes[t],Ft)}if(0===t.length)return{scene:new ps};var Bt=r((new DOMParser).parseFromString(t,"application/xml"),"COLLADA")[0],Gt=Bt.getAttribute("version");console.log("THREE.ColladaLoader: File version",Gt);var Ut,zt=function(t){return{unit:l(r(t,"unit")[0]),upAxis:u(r(t,"up_axis")[0])}}(r(Bt,"asset")[0]),Wt=new wu(this.manager);Wt.setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);var Ht=[],Vt={},Yt=0,jt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};c(Bt,"library_animations","animation",function(t){for(var e={sources:{},samplers:{},channels:{}},r=0,i=t.childNodes.length;r<i;r++){var n,a=t.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"source":n=a.getAttribute("id"),e.sources[n]=nt(a);break;case"sampler":n=a.getAttribute("id"),e.samplers[n]=p(a);break;case"channel":n=a.getAttribute("target"),e.channels[n]=f(a);break;default:console.log(a)}}jt.animations[t.getAttribute("id")]=e}),c(Bt,"library_animation_clips","animation_clip",function(t){for(var e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_animation":e.animations.push(o(n.getAttribute("url")))}}jt.clips[t.getAttribute("id")]=e}),c(Bt,"library_controllers","controller",function(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"skin":e.id=o(n.getAttribute("source")),e.skin=M(n);break;case"morph":e.id=o(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}jt.controllers[t.getAttribute("id")]=e}),c(Bt,"library_images","image",function(t){var e={init_from:r(t,"init_from")[0].textContent};jt.images[t.getAttribute("id")]=e}),c(Bt,"library_effects","effect",function(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"profile_COMMON":e.profile=R(n)}}jt.effects[t.getAttribute("id")]=e}),c(Bt,"library_materials","material",function(t){for(var e={name:t.getAttribute("name")},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_effect":e.url=o(n.getAttribute("url"))}}jt.materials[t.getAttribute("id")]=e}),c(Bt,"library_cameras","camera",function(t){for(var e={name:t.getAttribute("name")},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"optics":e.optics=Z(n)}}jt.cameras[t.getAttribute("id")]=e}),c(Bt,"library_lights","light",function(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":e=tt(n)}}jt.lights[t.getAttribute("id")]=e}),c(Bt,"library_geometries","geometry",function(t){var e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},i=r(t,"mesh")[0];if(void 0!==i){for(var n=0;n<i.childNodes.length;n++){var a=i.childNodes[n];if(1===a.nodeType){var o=a.getAttribute("id");switch(a.nodeName){case"source":e.sources[o]=nt(a);break;case"vertices":e.vertices=at(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(ot(a));break;default:console.log(a)}}}jt.geometries[t.getAttribute("id")]=e}}),c(Bt,"library_nodes","node",kt),c(Bt,"library_visual_scenes","visual_scene",function(t){var e={name:t.getAttribute("name"),children:[]};!function(t){for(var e=t.getElementsByTagName("node"),r=0;r<e.length;r++){var i=e[r];!1===i.hasAttribute("id")&&i.setAttribute("id","three_default_"+Yt++)}}(t);for(var i=r(t,"node"),n=0;n<i.length;n++)e.children.push(kt(i[n]));jt.visualScenes[t.getAttribute("id")]=e}),c(Bt,"library_kinematics_models","kinematics_model",function(t){for(var e={name:t.getAttribute("name")||"",joints:{},links:[]},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":pt(i,e)}}jt.kinematicsModels[t.getAttribute("id")]=e}),c(Bt,"library_physics_models","physics_model",function(t){for(var e={name:t.getAttribute("name")||"",rigidBodies:{}},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"rigid_body":e.rigidBodies[i.getAttribute("name")]={},yt(i,e.rigidBodies[i.getAttribute("name")])}}jt.physicsModels[t.getAttribute("id")]=e}),c(Bt,"scene","instance_kinematics_scene",function(t){for(var e={bindJointAxis:[]},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"bind_joint_axis":e.bindJointAxis.push(Tt(i))}}jt.kinematicsScenes[o(t.getAttribute("url"))]=e}),h(jt.animations,m),h(jt.clips,k),h(jt.controllers,_),h(jt.images,L),h(jt.effects,j),h(jt.materials,X),h(jt.cameras,J),h(jt.lights,rt),h(jt.geometries,lt),h(jt.visualScenes,Ft),function(){var t=jt.clips;if(!0===s(t)){if(!1===s(jt.animations)){var e=[];for(var r in jt.animations)for(var i=g(r),n=0,a=i.length;n<a;n++)e.push(i[n]);Ht.push(new mu("default",-1,e))}}else for(r in t)Ht.push(x(r))}(),function(){var t=Object.keys(jt.kinematicsModels)[0],e=Object.keys(jt.kinematicsScenes)[0],r=Object.keys(jt.visualScenes)[0];if(void 0!==t&&void 0!==e){for(var i,n=(i=t,d(jt.kinematicsModels[i],dt)),a=function(t){return d(jt.kinematicsScenes[t],Ct)}(e),o=Nt(r),s=a.bindJointAxis,l={},u=0,c=s.length;u<c;u++){var h=s[u],p=Bt.querySelector('[sid="'+h.target+'"]');if(p){var f=p.parentElement;g(h.jointIndex,f)}}var m=new rn;Vt={joints:n&&n.joints,getJointValue:function(t){var e=l[t];if(e)return e.position;console.warn("THREE.ColladaLoader: Joint "+t+" doesn't exist.")},setJointValue:function(t,e){var r=l[t];if(r){var i=r.joint;if(e>i.limits.max||e<i.limits.min)console.warn("THREE.ColladaLoader: Joint "+t+" value "+e+" outside of limits (min: "+i.limits.min+", max: "+i.limits.max+").");else if(i.static)console.warn("THREE.ColladaLoader: Joint "+t+" is static.");else{var n=r.object,a=i.axis,o=r.transforms;Et.identity();for(var s=0;s<o.length;s++){var u=o[s];if(u.sid&&-1!==u.sid.indexOf(t))switch(i.type){case"revolute":Et.multiply(m.makeRotationAxis(a,wi.degToRad(e)));break;case"prismatic":Et.multiply(m.makeTranslation(a.x*e,a.y*e,a.z*e));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+i.type)}else switch(u.type){case"matrix":Et.multiply(u.obj);break;case"translate":Et.multiply(m.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"scale":Et.scale(u.obj);break;case"rotate":Et.multiply(m.makeRotationAxis(u.obj,u.angle))}}n.matrix.copy(Et),n.matrix.decompose(n.position,n.quaternion,n.scale),l[t].position=e}}else console.log("THREE.ColladaLoader: "+t+" does not exist.")}}}function g(t,e){var r=e.getAttribute("name"),i=n.joints[t];o.traverse(function(n){n.name===r&&(l[t]={object:n,transforms:St(e),joint:i,position:i.zeroPosition})})}}();var Xt=function(t){return Nt(o(r(t,"instance_visual_scene")[0].getAttribute("url")))}(r(Bt,"scene")[0]);return"Z_UP"===zt.upAxis&&Xt.quaternion.setFromEuler(new bn(-Math.PI/2,0,0)),Xt.scale.multiplyScalar(zt.unit),{animations:Ht,kinematics:Vt,library:jt,scene:Xt}}};var fd=function(){function t(t){this.url=t,this.mergedObjects=new Map,this.listeners=new Map,this.errorCallbacks=new Map,this.loadedObject=null,this.supportMerge=!0,this.errorLoading=!1}return t.getManager=function(e){var r=t.managers[e];return r||(r=new t(e),t.managers[e]=r,r.loadCollada()),r},t.prototype.addListener=function(t){this.listeners.set(t,!0)},t.prototype.removeListener=function(t){this.listeners.delete(t)},t.prototype.addErrorCallback=function(t){this.errorCallbacks.set(t,!0)},t.prototype.removeErrorCallback=function(t){this.errorCallbacks.delete(t)},t.prototype.loadCollada=function(){var t=this.url;this.doLoadCollada(t)},t.copy=function(t,e){e.name=t.name,e.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),e.scale.set(t.scale.x,t.scale.y,t.scale.z),e.position.set(t.position.x,t.position.y,t.position.z),e.matrix.copy(t.matrix)},t.shallowCloneChildren=function(e,r){e.children.forEach(function(e){var i=t.getShallowClone(e);null!=i&&r.add(i)})},t.getShallowClone=function(e){var r=null;return e instanceof Zo||e.children.length>0?(r=new Zo,t.shallowCloneChildren(e,r)):e instanceof fa&&(r=new fa(e.geometry,e.material)),null!=r&&t.copy(e,r),r},t.prototype.applyMergedColorMapping=function(t,e){t.traverse(function(t){if(t instanceof fa){var r=t.userData.colors;if(null!=r){var i=t.geometry;for(var n in e){var a=r[n];if(null!=a){var o=Dh.parseRGB(e[n]),s=i.faces.length;if(!o.isNull())for(var l=a[0];l<a[0]+a[1];l++)l<s&&(i.faces[l].color=o.toThreeColor())}}return i.elementsNeedUpdate=!0,void(i.colorsNeedUpdate=!0)}}})},t.prototype.applyColorMapping=function(e,r){if(null!=e&&!r.isEmpty()){if(e instanceof fa){var i=this.mergedObjects.get(r.id);if(null==i){var n=t.getShallowClone(this.loadedObject);this.applyColorMapping(n,r),i=t.createMergedObject(n),this.mergedObjects.set(r.id,i)}return e.geometry=i.geometry,void(e.material=i.material)}e.traverse(function(t){if(t instanceof fa){var e=t.material;if(r.colors.has(e.name)){var i=r.colors.get(e.name);if(null!=i&&!i.isNull()){var n=e.map;if(null!=n){var a=Bh.createDefaultMaterial();a.depthTest=e.depthTest,a.map=n,i.setupColorMaterial(a),t.material=a}else t.material=i.getMaterial()}}}})}},t.prototype.getObject=function(e){if(window.mergeDisabled)return t.getShallowClone(this.loadedObject);if(this.supportMerge){var r=this.mergedObjects.get(e.id);if(null!=r)return t.getShallowClone(r);var i=null;e.isEmpty()||e.isDefault()?i=this.loadedObject:(i=t.getShallowClone(this.loadedObject),this.applyColorMapping(i,e));var n=t.createMergedObject(i);if(null!=n)return this.mergedObjects.set(e.id,n),n;this.supportMerge=!1,console.error("Mesh merge failed:",this.url,this.loadedObject)}var a=t.getShallowClone(this.loadedObject);return this.applyColorMapping(a,e),a},t.prototype.getShallowClone=function(){return t.getShallowClone(this.loadedObject)},t.createMergedObject=function(e){var r=[],i=[t.FACE_COLOR_MATERIAL],n=!0,a=new On;if(e.traverse(function(t){if(n&&t instanceof fa){var o=new On,s=t.geometry;o.fromBufferGeometry(s);for(var l=t;null!=l&&l!=e;)o.applyMatrix(l.matrix),l=l.parent;var u=t.material,c=u.opacity<.9999||null!=u.map;c&&i.push(u);var h=s.getAttribute("color"),d=0;o.faces.forEach(function(t){if(t.materialIndex=c?i.length-1:0,t.color=u.color,h)for(var e=0;e<t.vertexColors.length;e++){var r=3*d;t.vertexColors[e]=new hn(h.getX(r),h.getY(r),h.getZ(r))}d++}),r[u.name]=[a.faces.length,o.faces.length];try{a.merge(o)}catch(t){n=!1,console.error(t)}}}),!n)return null;var o=new fa((new Hn).fromGeometry(a),1==i.length?t.FACE_COLOR_MATERIAL:i);return t.copy(e,o),o.name="Merged mesh",o},t.prototype.doLoadCollada=function(t){var e=this;if(null==this.loadedObject&&!this.errorLoading){(new pd).load(t,function(t){var r=t.scene;r.traverse(function(t){if(t instanceof fa){var e,r=t.geometry;r.getAttribute("normal")||(r.computeVertexNormals(),(e=t.material).flatShading=!1,e.needsUpdate=!0),r.getAttribute("color")&&((e=t.material).vertexColors=ve),t.material instanceof Zl&&((e=t.material).transparent=1!=e.opacity,e.shininess=10,e.specular=Bh.getSpecularColor())}}),e.loadedObject=r,e.listeners.forEach(function(t,r){return r.call(e.loadedObject)})},function(t){},function(t){console.error("Object3DManger: Error loading collada: "+e.url),e.errorLoading=!0,e.errorCallbacks.forEach(function(t,e){e.call(null)})})}},t.FACE_COLOR_MATERIAL=new Zl({vertexColors:ve}),t.managers=[],t}(),md=function(){function t(){this.id=t.EMPTY_ID,this.colors=new Map}return t.prototype.parse=function(e){this.colors.clear();var r=JSON.parse(e);for(var i in r)this.colors.set(i,Dh.parseRGB(r[i]));this.id=t.EMPTY_ID,this.isEmpty()||this.isDefault()||(this.id=Bh.hash(e))},t.prototype.hasTransparent=function(){var t=!1;return this.colors.forEach(function(e,r){e.isTransparent()&&(t=!0)}),t},t.prototype.isEmpty=function(){return 0==this.colors.size},t.prototype.isDefault=function(){var t=!0;return this.colors.forEach(function(e,r){e.isNull()||(t=!1)}),t},t.EMPTY_ID=Bh.hash("{}"),t}(),gd=function(t){function e(e){var r=t.call(this,e)||this;return r._hrefPath="",r._fileName="",r._width=0,r._height=0,r._axisOrder="",r.scalingFactor=1,r.baseScale2D=1,r.baseScale2DSet=!1,r.x3d=!1,r.pos3dSet=!1,r.pos3dX=0,r.pos3dY=0,r.colorMapping=new md,r.errorLoading=!1,r.loaded=!1,r.replicatedCallbacks=[],r.errorCallback=function(){r.errorLoading=!0,r.createBox(),r.manager.removeErrorCallback(r.errorCallback)},r.x3d=td.image===Bh.getShapeType(e),r}return Rh(e,t),Object.defineProperty(e.prototype,"axisOrder",{get:function(){return this._axisOrder},set:function(t){this._axisOrder=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hrefPath",{get:function(){return this._hrefPath},set:function(t){this._hrefPath=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fileName",{get:function(){return this._fileName},set:function(t){this._fileName=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.create3D=function(){t.prototype.create3D.call(this);var r=new Zo;r.name="Rotation group",this.rotationGroup=r,this.element.add(r),null==e.textureLoader&&(e.textureLoader=new wu)},e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"width"===e&&(this.width=parseFloat(r)),"height"===e&&(this.height=parseFloat(r)),"href-path"!==e&&"add"!==e||(this.hrefPath=r),"3d-axis-order"===e&&(this.axisOrder=r),"3d-scaling-factor"===e&&(this.scalingFactor=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_TRANSFORM)),"3d-file-name"===e&&(this.fileName=r),"3d-pos"===e){var i=r.split(":");this.pos3dX=parseFloat(i[0]),this.pos3dY=-parseFloat(i[1]),this.pos3dSet=!0,this.setDirty3D(Uh.DIRTY_3D_TRANSFORM)}"3d-custom-colors"===e&&(this.colorMapping.parse(r),this.setDirty3D(Uh.DIRTY_3D_COLOR)),"3d-base-scale-2d"===e&&(this.baseScale2D=parseFloat(r),this.baseScale2DSet=!0)},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_TRANSFORM)&&this.pos3dSet&&!this.errorLoading&&(this.element.position.set(this.pos3dX,this.pos3dY,this.z),this.applyScale()),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){switch(this.applyScale(),this.rotationGroup.children=[],this._axisOrder){case"OBJECT_3D_YZX_AXIS_ORDER":this.rotationGroup.rotation.set(Math.PI/2,-3*Math.PI/2,0);break;case"OBJECT_3D_XYZ_AXIS_ORDER":this.rotationGroup.rotation.set(0,0,0);break;case"OBJECT_3D_ZXY_AXIS_ORDER":this.rotationGroup.rotation.set(-Math.PI/2,0,-Math.PI/2)}if(this.x3d){this.pos3dSet||this.rotationGroup.position.set(this.width/2,-this.height/2,0);var e="";if(this.fileName)e=this.fileName.replace(/.x3d$/,".dae");else e=this.hrefPath.match("(.*?)/(x3d_.+?)\\.x3d")[2].replace(/_/,"/");if(e="./"+e.replace(/\\/g,"/"),Bh.debugServer){var r=e.split("/");e=r[r.length-1];this.loadCollada("assets/3d/dae/"+e)}else{var i=this.getResource(e);this.loadCollada(i)}return}this.createImage(0)}else this.isDirty3DSet(Uh.DIRTY_3D_COLOR)&&this.manager.applyColorMapping(this.loadedObject,this.colorMapping)},e.prototype.applyScale=function(){if(this.baseScale2DSet){var t=this.scalingFactor,e=this.baseScale2D;this.element.scale.set(t*e*this.scaleX,t*e*this.scaleY,t*this.scaleZ)}else{var r=this.scaleZ*this.scalingFactor;this.element.scale.set(r,r,r)}},e.prototype.getInternalResource=function(t){var e=this.networkManager;return e.getJarResourceURL?e.getJarResourceURL(t):e.getInternalResource(t)},e.prototype.getResource=function(t){var e=this.networkManager;return e.getResourceURL?e.getResourceURL(t):e.getRestRoot()+"resources?path="+t},e.prototype.createBox=function(){this.element.position.set(this.x,this.y,this.z),this.element.scale.set(1,1,1);var t=Math.min(this.width,this.height),e=.5+Math.random()/2;null==this.cubeMesh&&(this.cubeMesh=this.createMesh(!0));var r=new Vn(this.width,this.height,t);this.cubeMesh.geometry=r,this.cubeMesh.position.set(this.width/2,-this.height/2,t/2),this.createImage(t+e)},e.prototype.createImage=function(t){var r=null;Bh.debugServer?r="assets/3d/images/"+this.hrefPath:this.networkManager&&(r=this.getInternalResource(this.hrefPath)),null==this.imageMesh&&(this.imageMesh=this.createMesh());var i=new jn(this.width,this.height);this.imageMesh.geometry=i,this.imageMesh.position.set(this.width/2,-this.height/2,t);var n=Bh.imageCache[r];if(null==n){var a=e.textureLoader.load(r),o=new Zl({map:a,depthTest:!0,transparent:!0});a.wrapS=dr,a.wrapT=dr,a.format=Rr,this.imageMesh.material=o,Bh.imageCache[r]=o,Dh.materials.set(o,!0)}else this.imageMesh.material=n},e.prototype.loadCallback=function(){this.loadedObject=this.manager.getObject(this.colorMapping),this.rotationGroup.add(this.loadedObject),this.replicatedCallbacks.forEach(function(t){return t.call(null)}),this.loaded=!0},e.prototype.loadCollada=function(t){var e=this;this.errorLoading=!1;var r=fd.getManager(t);if(this.manager=r,r.loadedObject)this.loadCallback();else{var i=function(t){null!=e.manager&&(e.loadCallback(),r.removeListener(i))};r.addListener(i)}return r.errorLoading?(this.errorLoading=!0,this.createBox()):r.addErrorCallback(this.errorCallback),this.rotationGroup},e.prototype.dispose=function(){null!=this.manager&&this.manager.removeErrorCallback(this.errorCallback),null!=this.imageMesh&&(this.rotationGroup.remove(this.imageMesh),Bh.disposeMesh(this.imageMesh),this.imageMesh=null),null!=this.cubeMesh&&(this.rotationGroup.remove(this.cubeMesh),Bh.disposeMesh(this.cubeMesh),this.cubeMesh=null),this.manager=null;var t=this.element.parent;null!=t&&t.remove(this.element),Bh.wipeObject(this)},e}(Uh),vd=function(t){function e(e){var r=t.call(this,e)||this;return r._rx=0,r._ry=0,r}return Rh(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"rx"===e&&(this.rx=Number.parseFloat(r)),"ry"===e&&(this.ry=Number.parseFloat(r)),"r"===e&&(this.rx=this.ry=Number.parseFloat(r)),"cx"===e&&(this.x=Number.parseFloat(r)),"cy"===e&&(this.y=-Number.parseFloat(r))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var e=jh.ARC;e.rx=this.rx,e.ry=this.ry,e.x=e.y=e.z1=e.z2=e.startAngle=0,e.arcAngle=-Bh.TAU;var r=this.lineWidth/2,i=Fh.all;if(null!=this.lineColor){var n=new On;Bh.disposeGeometry(this.lineMesh.geometry),e.addPlanes(n,i,!1,this.zHeight,r),this.lineMesh.geometry=n,this.lineMesh.matrixWorldNeedsUpdate=!0,Bh.calculateTextureUVS(n)}if(null!=this.fillColor){null==this.lineColor&&(r=0);var a=new On;Bh.disposeGeometry(this.fillMesh.geometry),e.addPlanes(a,i,!0,this.zHeight,r),this.fillMesh.geometry=a,this.fillMesh.matrixWorldNeedsUpdate=!0,Bh.calculateTextureUVS(a)}}},Object.defineProperty(e.prototype,"rx",{get:function(){return this._rx},set:function(t){this._rx=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ry",{get:function(){return this._ry},set:function(t){this._ry=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e}(Vh),bd=function(t){function e(e){var r=t.call(this,e)||this;return r.levelHeight=20,r.nLevels=1,r.nPositions=5,r.cellWidth=10,r.nRacks=1,r.nDeep=1,r.length=1,r.depth=1,r.aisleDepth=1,r.depthR=1,r.cellsBetweenLegs=2,r.colorToCells=new Map,r.faceIndex=[],r.center=new Mi,r}return Rh(e,t),Object.defineProperty(e.prototype,"cellsMesh",{get:function(){if(null==this._cellsMesh){var t=new On,e=new Zl({vertexColors:ve}),r=new Zl({vertexColors:ve});r.opacity=0,r.transparent=!0,this._cellsMesh=new fa(t,[e,r]),this.element.add(this._cellsMesh)}return this._cellsMesh},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){var i;if(t.prototype.updateParameter.call(this,e,r),"rack-data"===e&&(i=r.split(" ").map(function(t){return parseFloat(t)}),this.nRacks=i[0],this.nPositions=i[1],this.length=i[2],this.depth=i[3],this.cellWidth=i[4],this.aisleDepth=i[5],this.depthR=i[6],this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-n-levels"===e&&(this.nLevels=parseInt(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-n-deep"===e&&(this.nDeep=parseInt(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-level-height"===e&&(this.levelHeight=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-cells-between-legs"===e&&(this.cellsBetweenLegs=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-cells"===e){var n=r.split(":"),a=n[1].split(",").map(parseFloat);this.colorToCells.set(n[0],a)}},e.prototype.createCell=function(t){var e=this.cellsMesh.geometry;this.faceIndex[t]=e.faces.length;var r=this.nRacks*this.nDeep*this.nPositions,i=this.nDeep*this.nPositions,n=Math.floor(t/r);t%=r;var a=Math.floor(t/i);t%=i;var o=Math.floor(t/this.nDeep),s=t%this.nDeep,l=.8*this.cellWidth,u=.7*this.levelHeight,c=0==a?this.depth:this.depthR,h=c/this.nDeep;c=.8*c/this.nDeep;var d=0==a?0:this.depth/2+this.aisleDepth+this.depthR/2,p=this.cellWidth/2+o*this.cellWidth,f=-this.depth/2-d+(h/2+h*(s-this.nDeep/2)),m=u/2+this.levelHeight*n;this.center.set(p,f,m),Nh.BOX.setupParallel(this.center,Bh.RIGHT,Bh.FRONT,c,u,l),Nh.BOX.addPlanes(e)},e.prototype.setColor=function(t,e){var r=Dh.parseRGB(e),i=this.cellsMesh.geometry;null==this.faceIndex[t]&&this.createCell(t);for(var n=this.faceIndex[t],a=r.toThreeColor(),o=0;o<12;o++)i.faces[n+o].materialIndex=r.isNull()?1:0,i.faces[n+o].color=a;i.elementsNeedUpdate=!0},e.prototype.createCells=function(){for(var t=new On,e=.8*this.cellWidth,r=.7*this.levelHeight,i=new Mi,n=0;n<this.nLevels;n++)for(var a=r/2+this.levelHeight*n,o=0;o<this.nRacks;o++){var s=0==o?this.depth:this.depthR;s*=.8;for(var l=0==o?0:this.depth/2+this.aisleDepth+this.depthR/2,u=-this.depth/2-l,c=0;c<this.nPositions;c++){var h=this.cellWidth/2+c*this.cellWidth;i.set(h,u,a),Nh.BOX.setupParallel(i,Bh.RIGHT,Bh.FRONT,s,r,e),Nh.BOX.addPlanes(t)}}this.cellsMesh.geometry=t,Dh.GRAY.applyToMaterial(this.cellsMesh)},e.prototype.update3D=function(){var e=this;if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){Bh.disposeGeometry(this.lineMesh.geometry),Bh.disposeGeometry(this.fillMesh.geometry);for(var r=this.nPositions*this.cellWidth,i=this.depth,n=this.depthR,a=0,o=new On,s=new On,l=-i/2,u=-(n/2+this.aisleDepth+i),c=0;c<this.nLevels;c++){var h=new Vn(r,i,.1);h.translate(r/2,l,a),s.merge(h),2==this.nRacks&&((h=new Vn(r,n,.1)).translate(r/2,u,a),s.merge(h));for(var d=0;d<this.nPositions+1;d++){var p=this.cellWidth*d;if((v=new Vn(.5,i,.5)).translate(p,l,a),o.merge(v),2==this.nRacks){var f=new Vn(.5,n,.5);f.translate(p,u,a),o.merge(f)}}a+=this.levelHeight}if(this.nLevels>1&&this.cellsBetweenLegs>0){var m=this.levelHeight*(this.nLevels-1),g=[0,i];2==this.nRacks&&(g.push(i+this.aisleDepth),g.push(i+this.aisleDepth+n));for(c=0;c<this.nPositions+1;c++)for(d=0;d<g.length;d++){var v;p=this.cellWidth*c;if(c%this.cellsBetweenLegs==0||c==this.nPositions)(v=new Vn(1,1,m)).translate(p,-g[d],m/2),o.merge(v)}}this.fillMesh.geometry=s,this.lineMesh.geometry=o}null!=this.colorToCells&&this.colorToCells.size>0&&(this.colorToCells.forEach(function(t,r){t.forEach(function(t){return e.setColor(t,r)})}),this.colorToCells.clear())},e}(Vh),yd=function(t){function e(e){var r=t.call(this,e)||this;r.curve=new Zh,r.type="";var i=Bh.getShapeType(e);return i!==td.pathRailroad&&i!==td.pathRoad&&i!==td.pathConveyor||(r.lineColor=Dh.GRAY),r.type=i,r}return Rh(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"3d-d"==e&&(this.curve.parseSegments(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){if(this.curve.halfWidth=this.lineWidth/2,this.curve.zHeight=this.zHeight,this.type===td.pathConveyor){var e=this.lineWidth/6;this.curve.zHeight=e,this.curve.segments.forEach(function(t){return t.shiftZ(-e)})}if(null!=this.lineColor){var r=new On;Bh.disposeGeometry(this.lineMesh.geometry),this.lineMesh.geometry=r,this.lineMesh.matrixWorldNeedsUpdate=!0,this.curve.fillPlanes(r),Bh.calculateTextureUVS(r)}if(null!=this.fillColor){var i=new On;Bh.disposeGeometry(this.fillMesh.geometry),this.fillMesh.geometry=i,this.fillMesh.matrixWorldNeedsUpdate=!0,this.curve.fillInner(i),Bh.calculateTextureUVS(i)}}},e}(Vh),Ad=function(t){function e(e){var r=t.call(this,e)||this;return r.curve=new Zh,r.width=0,r}return Rh(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.roadMesh=this.createMesh(),this.markingMesh=this.createMesh()},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"width"!==e&&"stroke-width"!==e||(this.width=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-d"==e&&(this.curve.parseSegments(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var e=new On;this.roadMesh.geometry=e,Dh.GRAY.applyToMaterial(this.roadMesh);var r=new On;this.markingMesh.geometry=r,Dh.WHITE.applyToMaterial(this.markingMesh);var i=this.width/2;this.curve.zHeight=.01,this.curve.halfWidth=i,this.curve.fillPlanes(e);var n=this.curve.length(),a=i/20,o=20*a,s=o+10*a,l=Math.floor(n/s);this.curve.shiftZ(.01),this.curve.halfWidth=a,this.curve.zHeight=.1,this.curve.planes=Fh.top;for(var u=0;u<l;u++){var c=s/2+s*u;this.curve.getCut(c,o).fillPlanes(r)}}},e}(Uh),Td=function(t){function e(e){var r=t.call(this,e)||this;return r.curve=new id,r.segmentsStr="",r.batchHelper=new Jh,r.diameter=0,r.offset=-1,r}return Rh(e,t),e.prototype.create3D=function(){var e=this;t.prototype.create3D.call(this),this.lineMesh=this.createMesh(),this.markMesh=this.createMesh(),this.batchHelper.create3D(this.element),this.batchHelper.updateBatch=function(t,r){var i=e.curve.length(),n=e.curve.getCut(t.offset*i,t.fraction*i);n.halfWidth-=.3,n.planes=Fh.all,n.fillPlanes(r)}},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),this.batchHelper.updateParameter(e,r),"color"===e&&(this.color=Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_LINE_COLOR)),"width"===e&&(this.diameter=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-d"==e&&(this.segmentsStr=r,this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"phase"===e&&(this.offset=parseFloat(r))},e.prototype.update3D=function(){t.prototype.update3D.call(this),null!=this.color&&this.isDirty3DSet(Uh.DIRTY_3D_LINE_COLOR)&&this.color.applyToMaterial(this.lineMesh);var e=this.diameter/2;if(this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){if(this.curve.halfWidth=e,this.curve.zHeight=this.diameter,this.curve.planes=Fh.sides,this.curve.roundness=2*this.diameter,this.curve.smallFaceCount=Bh.getFaceCount(e),this.curve.parseSegments(this.segmentsStr),null!=this.color){var r=new On;this.lineMesh.geometry=r,this.lineMesh.matrixWorldNeedsUpdate=!0,this.curve.fillPlanes(r),Bh.calculateTextureUVS(r)}var i=Dh.of(0,0,0);i.opacity=.3,i.applyToMaterial(this.markMesh)}this.offset>=0&&this.updateRings(e),this.batchHelper.update3D()},e.prototype.updateRings=function(t){Bh.disposeGeometry(this.markMesh.geometry);var e=new On;this.markMesh.geometry=e;var r=this.curve.length(),i=Math.floor(r/12),n=new Kh;n.faceCount=this.curve.smallFaceCount,n.radius=t+.2;for(var a=this.offset/12*12,o=0;o<i;o++){var s=a%12+6+12*o,l=this.curve.getPoint(s),u=this.curve.getNormal(s).clone(),c=l.clone(),h=l.clone();Bh.translateScaled(c,u,-.5),Bh.translateScaled(h,u,.5),n.setup(c,h,n.radius),n.fillPlanes(e,Fh.sides)}},e}(Uh),Cd=function(t){function e(e){var r=t.call(this,e)||this;return r.radius=0,r.lineWidth=1,r.connectors=new Array,r.shapeZ=0,r.drawCircle=!1,r}return Rh(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.lineMesh=this.createMesh()},e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"fill"===e&&(this.color=Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_LINE_COLOR)),"radius"===e&&(this.radius=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-connector"===e){var i=(new Zh).parseSegments(r);this.connectors.push(i),this.setDirty3D(Uh.DIRTY_3D_SHAPE)}"3d-shape-z"===e&&(this.shapeZ=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"draw-circle"===e&&(this.drawCircle=!0,this.setDirty3D(Uh.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){var e=this;if(t.prototype.update3D.call(this),null!=this.color&&this.isDirty3DSet(Uh.DIRTY_3D_LINE_COLOR)&&this.color.applyToMaterial(this.lineMesh),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var r=new On;if(0!=this.radius){var i=jh.ARC;i.reset(),i.x=0,i.y=0,i.z1=i.z2=0,i.rx=i.ry=this.radius,i.autoFacecount=!1,i.addPlanes(r,Fh.all,!1,0,this.lineWidth/2),this.drawCircle||i.addPlanes(r,Fh.all,!0,0,this.lineWidth/2)}this.connectors.forEach(function(t){t.halfWidth=e.lineWidth/2,t.zHeight=0,t.translate(-e.x,-e.y,-e.shapeZ),t.fillPlanes(r)}),Bh.disposeGeometry(this.lineMesh.geometry),this.lineMesh.matrixWorldNeedsUpdate=!0,Bh.calculateTextureUVS(r),this.lineMesh.geometry=r}},e}(Uh),Sd=function(t){function e(e){var r=t.call(this,e)||this;r.curve=new Zh,r._points=[],r._pointsZ=[],r.closed=!1;var i=Bh.getShapeType(e);return i!=td.polygon&&i!=td.polygonalNode&&i!=td.conveyorCustomStation||(r.closed=!0),i==td.conveyorCustomStation&&(r.lineWidth=.5),r}return Rh(e,t),Object.defineProperty(e.prototype,"points",{get:function(){return this._points},set:function(t){this._points=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointsZ",{get:function(){return this._pointsZ},set:function(t){this._pointsZ=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closed",{get:function(){return this._closed},set:function(t){this._closed=t},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"points"===e){var i=[];r.split(" ").forEach(function(t,e){if(t){var r=t.split(","),n=r[0],a=r[1],o=Number.parseFloat(n),s=Number.parseFloat(a);i.push(new ki(o,-s))}}),this.points=i}if("3d-points-z"===e){var n=[];r.split(" ").forEach(function(t){""!=t&&n.push(parseFloat(t))}),this.pointsZ=n}},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){this.curve.segments=[];var e=this.points.length,r=this.closed?e:e-1;this.pointsZ.length!=e&&(0!=this.pointsZ.length&&console.error("Polyline3D: z coordinates mismatch: ",this.id,this.points,this.pointsZ),this.pointsZ=new Array(e).fill(0));for(var i=0;i<r;i++){var n=this.points[i%e],a=this.points[(i+1)%e],o=this._pointsZ[i%e],s=this._pointsZ[(i+1)%e],l=new Mi(n.x,n.y,o),u=new Mi(a.x,a.y,s);this.curve.segments.push((new qh).setup(l,u))}if(this.curve.zHeight=this.zHeight,this.curve.halfWidth=this.lineWidth/2,this.curve.closed=this.closed,this.curve.dzFill=-.0095,null!=this.lineColor){Bh.disposeGeometry(this.lineMesh.geometry);var c=new On;this.lineMesh.geometry=c,this.lineMesh.matrixWorldNeedsUpdate=!0,this.curve.fillPlanes(c),Bh.calculateTextureUVS(c)}if(null!=this.fillColor){Bh.disposeGeometry(this.fillMesh.geometry);var h=new On;this.fillMesh.geometry=h,this.fillMesh.matrixWorldNeedsUpdate=!0,this.curve.fillInner(h),Bh.calculateTextureUVS(h)}}},e}(Vh),Ed=function(t){function e(e){var r=t.call(this,e)||this;return r.curve=new Zh,r.width=0,r}return Rh(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.railMesh=this.createMesh(),this.tieMesh=this.createMesh()},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"width"!==e&&"stroke-width"!==e||(this.width=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-d"==e&&(this.curve.parseSegments(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var e=this.width/2,r=e/2,i=r/12,n=r+i,a=3*i,o=e/20,s=o,l=4*o,u=e,c=Math.floor(this.curve.length()/u);this.curve.zHeight=a,this.curve.halfWidth=i;var h=this.curve.getShifted(-n),d=this.curve.getShifted(n),p=new On;h.fillPlanes(p),d.fillPlanes(p),this.railMesh.geometry=p,Dh.GRAY.applyToMaterial(this.railMesh);var f=new On;this.tieMesh.geometry=f,Dh.SIENNA.applyToMaterial(this.tieMesh);for(var m=0;m<c;m++){var g=u/2+m*u,v=this.curve.getPoint(g),b=this.curve.getNormal(g),y=v.clone();Bh.translateScaled(y,b,l),Nh.BOX.setupStraitSegment(v,y,s,e),Nh.BOX.addPlanes(f,Fh.all)}}},e}(Uh),wd=function(t){function e(e){var r=t.call(this,e)||this;return r._width=0,r._height=0,r}return Rh(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"width"==e&&(this.width=Number.parseFloat(r)),"height"==e&&(this.height=Number.parseFloat(r))},e.prototype.dispose=function(){t.prototype.dispose.call(this)},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var e=this.width,r=this.height,i=null==this.lineColor?0:this.lineWidth/2,n=[new ki(-i,i),new ki(e+i,i),new ki(e+i,-r-i),new ki(-i,-r-i)],a=[new ki(i,-i),new ki(i,-r+i),new ki(e-i,-r+i),new ki(e-i,-i)],o=new qu(n);o.holes=[new Xu(a)];var s=new qu(a),l={steps:2,depth:Math.max(this.zHeight,.01),bevelEnabled:!1};if(null!=this.lineColor){Bh.disposeGeometry(this.lineMesh.geometry);var u=new Cl(o,l);this.lineMesh.geometry=u,this.lineMesh.matrixWorldNeedsUpdate=!0,u.faceVertexUvs[0].forEach(function(t){return t.forEach(function(t){return t.multiplyScalar(.05)})})}if(null!=this.fillColor&&e/2>i&&r/2>i){Bh.disposeGeometry(this.fillMesh.geometry);var c=new Cl(s,l);this.fillMesh.geometry=c,this.fillMesh.matrixWorldNeedsUpdate=!0,c.faceVertexUvs[0].forEach(function(t){return t.forEach(function(t){return t.multiplyScalar(.05)})})}}},e}(Vh),kd=function(t){function e(e){var r=t.call(this,e)||this;return r.originId="",r.setup=!1,r.copied=!1,r}return Rh(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"href"===e&&(this.originId=r.substring(1))},e.prototype.findObject3D=function(t,e){var r=this;t instanceof gd?e.push(t):t instanceof cd&&t.children.forEach(function(t){return r.findObject3D(t,e)})},e.prototype.update3D=function(){var e=this;if(!this.setup&&null!=this.animation){this.origin=this.animation.shapes.get(this.originId);var r=[];if(this.findObject3D(this.origin,r),r.length>0){var i=0,n=function(){++i==r.length&&e.doShallowCopy()};r.forEach(function(t){t.loaded||t.errorLoading?n():t.replicatedCallbacks.push(n)})}else this.doShallowCopy();this.setup=!0}t.prototype.update3D.call(this)},e.prototype.doShallowCopy=function(){if(!this.copied){var t=new wn;fd.shallowCloneChildren(this.origin.element,t),fd.copy(this.origin.element,t),this.element.add(t),this.copied=!0}},e}(Uh),xd=function(t){function e(e){var r=t.call(this,e)||this;return r.laneWidth=0,r.medianWidth=0,r.delimiterWidth=0,r.lanes=[],r.delimiters=[],r.median=new Zh,r}return Rh(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"lane-color"===e&&(this.laneColor=Dh.parseRGB(r)),"lane-width"===e&&(this.laneWidth=parseFloat(r)),"3d-forward-lane"!==e&&"3d-backward-lane"!==e||this.lanes.push((new Zh).parseSegments(r)),"lane-delimiter-color"===e&&(this.delimiterColor=Dh.parseRGB(r)),"lane-delimiter-width"===e&&(this.delimiterWidth=parseFloat(r)),"3d-lane-delimiter"===e&&this.delimiters.push((new Zh).parseSegments(r)),"median-color"===e&&(this.medianColor=Dh.parseRGB(r)),"median-width"===e&&(this.medianWidth=parseFloat(r)),"3d-median"===e&&this.median.parseSegments(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)},e.prototype.create3D=function(){t.prototype.create3D.call(this),this.laneMesh=this.createMesh(),this.delimiterMesh=this.createMesh(),this.medianMesh=this.createMesh()},e.prototype.update3D=function(){var e=this;if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){if(null!=this.laneColor){this.laneColor.applyToMaterial(this.laneMesh);var r=new On;this.laneMesh.geometry=r,this.laneMesh.matrixWorldNeedsUpdate=!0,this.lanes.forEach(function(t){t.halfWidth=e.laneWidth/2,t.zHeight=0,t.fillPlanes(r),Bh.calculateTextureUVS(r)})}if(null!=this.delimiterColor){this.delimiterColor.applyToMaterial(this.delimiterMesh);var i=new On;this.delimiterMesh.geometry=i,this.delimiterMesh.matrixWorldNeedsUpdate=!0,this.delimiters.forEach(function(t){t.halfWidth=e.delimiterWidth/2,t.zHeight=.1,t.continuous=!1,t.fillPlanes(i),Bh.calculateTextureUVS(i)})}if(null!=this.medianColor){this.medianColor.applyToMaterial(this.medianMesh);var n=new On;this.medianMesh.geometry=n,this.medianMesh.matrixWorldNeedsUpdate=!0,this.median.halfWidth=this.medianWidth/2,this.median.zHeight=.1,this.median.continuous=!1,this.median.fillPlanes(n),Bh.calculateTextureUVS(n)}}},e}(Uh),Md=function(t){function e(e){var r=t.call(this,e)||this;return r.markingCurve=new Zh,r.fillingCurve=new Zh,r.type="",r.type=Bh.getShapeType(e),r}return Rh(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"3d-d"!==e&&"3d-marking"!==e||(this.markingCurve.parseSegments(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-area"===e&&(this.fillingCurve.parseSegments(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-line-width"===e&&(this.lineWidth=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){if(this.markingCurve.halfWidth=this.lineWidth/2,this.markingCurve.zHeight=this.zHeight+.1,this.markingCurve.continuous=!1,this.fillingCurve.halfWidth=0,this.fillingCurve.zHeight=this.zHeight,this.type===td.conveyorStation&&(this.fillingCurve.dzFill=.01),null!=this.lineColor){var e=new On;this.lineMesh.geometry=e,this.lineMesh.matrixWorldNeedsUpdate=!0,this.markingCurve.fillPlanes(e),Bh.calculateTextureUVS(e)}if(null!=this.fillColor){var r=new On;this.fillMesh.geometry=r,this.fillMesh.matrixWorldNeedsUpdate=!0,this.fillingCurve.fillInner(r),Bh.calculateTextureUVS(r)}}},e}(Vh),Od=function(t){function e(e){var r=t.call(this,e)||this;return r.progress=0,r.radius=0,r._zHeight=0,r.batchHelper=new Jh,r.cylinder=new Kh,r.p1=new Mi,r.p2=new Mi,r}return Rh(e,t),Object.defineProperty(e.prototype,"zHeight",{get:function(){return this._zHeight},set:function(t){this._zHeight=t,this.setDirty3D(Uh.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.create3D=function(){var e=this;t.prototype.create3D.call(this),this.lineMesh=this.createMesh(),this.progressMesh=this.createMesh(),this.progressColor=Dh.of(0,0,0),this.progressColor.opacity=.4,this.batchHelper.create3D(this.element),this.batchHelper.updateBatch=function(t,r){var i=Math.max(.01,e.zHeight*t.offset),n=i+Math.max(0,e.zHeight*t.fraction-.2),a=e.radius-.5;e.p1.set(0,0,i),e.p2.set(0,0,n),e.cylinder.setup(e.p1,e.p2,a),e.cylinder.fillPlanes(r,Fh.all)}},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),this.batchHelper.updateParameter(e,r),"color"===e&&(this.color=Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_LINE_COLOR)),"radius"===e&&(this.radius=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-z-height"===e&&(this.zHeight=parseFloat(r)),"progress"===e&&(this.progress=parseFloat(r))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),null!=this.color&&this.isDirty3DSet(Uh.DIRTY_3D_LINE_COLOR)&&this.color.applyToMaterial(this.lineMesh),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){this.cylinder.faceCount=Bh.getFaceCount(this.radius);var e={depth:this.zHeight,bevelEnabled:!1},r=this.radius,i=new xu(0,0,r,r,0,2*Math.PI,!1,0);if(null!=this.color){var n=new Cl(new qu(i.getPoints(100)),e);this.lineMesh.geometry=n,this.lineMesh.matrixWorldNeedsUpdate=!0,n.faceVertexUvs[0].forEach(function(t){return t.forEach(function(t){return t.multiplyScalar(.05)})})}}if(0==this.progress)this.progressMesh.geometry=Bh.getSharedGeometry();else{var a=jh.ARC,o=new On,s=this.radius/20;a.x=a.y=0,a.z1=a.z2=this.zHeight+.1,a.rx=a.ry=this.radius-s,a.startAngle=Bh.TAU/4,a.arcAngle=-Bh.TAU*this.progress,a.fillPlanes(o,Fh.top,0,s),Bh.disposeGeometry(this.progressMesh.geometry),this.progressMesh.geometry=o,this.progressColor.applyToMaterial(this.progressMesh),this.progress=0}this.batchHelper.update3D()},e}(Uh),Id=function(t){function e(e){var r=t.call(this,e)||this;return r.lineHeight=0,r}return Rh(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.mesh=this.createMesh()},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"fill"===e&&(this.fillColor=r,this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"text-content"===e&&(this.text=r,this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"font"===e&&(this.font=r,this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"text-anchor"===e&&(this.textAnchor=r,this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"line-height"===e&&(this.lineHeight=Math.round(parseFloat(r)),this.setDirty3D(Uh.DIRTY_3D_SHAPE))},e.prototype.nextPower=function(t){for(var e=1;t>e;)e*=2;return e},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)){var e=document.createElement("canvas");e.width=200,e.height=200;var r=e.getContext("2d");r.fillStyle=this.fillColor,r.font=this.font,r.textBaseline="top";for(var i=.01,n=this.text.split(/\r\n/),a=n.length,o=0;o<a;o++){var s=r.measureText(n[o]);i=Math.max(i,s.width)}var l=i,u=this.lineHeight*a,c=64/this.lineHeight,h=this.nextPower(c*l),d=this.nextPower(c*u);e.width=h,e.height=d,(r=e.getContext("2d")).fillStyle=this.fillColor,r.font=this.font,r.textBaseline="top";var p=0;"middle"===this.textAnchor&&(r.textAlign="center",p=l/2),"end"===this.textAnchor&&(r.textAlign="end",p=l),r.scale(h/l,d/u);for(o=0;o<a;o++)r.fillText(n[o],p,0+o*this.lineHeight);var f=new Zl;f.map=new ji(e),f.transparent=!0,f.map.needsUpdate=!0;var m=new jn(l,u);this.mesh.geometry=m,this.mesh.material=f,this.mesh.position.set(l/2-p,-u/2,0)}},e}(Uh),_d=function(t){function e(r){var i=t.call(this,r)||this;return i.width=50,i.height=50,i.zHeight=100,i.platformHeight=10,i.platformZ=50,i.platformVisible=!0,i.type=e.PLATFORM_ROLLER,i.platformColor=Dh.GRAY,i.frameColor=Dh.SIENNA,i}return Rh(e,t),e.prototype.testAnimate=function(){var t=this,e=.3,r=1e4,i=function(){r>0&&(r--,(t.platformMesh.position.z>t.zHeight||t.platformMesh.position.z<0)&&(e*=-1),t.platformMesh.position.z+=e,setTimeout(i,16))};i()},e.prototype.create3D=function(){t.prototype.create3D.call(this),this.platformMesh=this.createMesh(),this.frameMesh=this.createMesh(),this.platformInnerMesh=this.createMesh(),this.platformMesh.add(this.platformInnerMesh)},e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"width"===e&&(this.width=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"height"===e&&(this.height=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-z-height"===e&&(this.zHeight=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"fill"===e&&(this.platformColor=Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"stroke"===e&&(this.frameColor=Dh.parseRGB(r),this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-type"===e&&(this.type=r,this.setDirty3D(Uh.DIRTY_3D_SHAPE)),"3d-platform-visible"===e){var i="true"==r;this.platformVisible!=i&&(this.platformVisible=i,this.setDirty3D(Uh.DIRTY_3D_VISIBILITY))}"3d-platform-z"===e&&(this.platformZ=parseFloat(r),this.setDirty3D(Uh.DIRTY_3D_VISIBILITY))},e.prototype.update3D=function(){t.prototype.update3D.call(this),this.isDirty3DSet(Uh.DIRTY_3D_SHAPE)&&(this.createFrame(),this.createPlatform()),this.isDirty3DSet(Uh.DIRTY_3D_VISIBILITY)&&(this.platformMesh.visible=this.platformVisible),this.platformMesh.position.z=this.platformZ},e.prototype.createPlatform=function(){switch(this.platformHeight=this.width/8,this.platformMesh.geometry=new On,this.platformColor.applyToMaterial(this.platformMesh),this.platformInnerMesh.geometry=new On,this.frameColor.applyToMaterial(this.platformInnerMesh),this.type){case e.PLATFORM_FLAT:this.createFlatPlatform(this.platformHeight);break;case e.PLATFORM_ROLLER:this.createRollerPlatform(this.platformHeight)}},e.prototype.createRollerPlatform=function(t){var e=-t/2,r=1.3*t,i=Math.round(this.height/r)+1;i=Math.max(2,i);var n=this.height/(i-1),a=new Kh;a.faceCount=8;for(var o=new Mi,s=new Mi,l=0;l<i;l++){var u=-this.height/2+n*l;o.set(-this.width/2,u,e),s.set(this.width/2,u,e),a.setup(o,s,t/2),a.fillPlanes(this.platformMesh.geometry)}var c=[],h=Bh.DX,d=Bh.DY;for(l=0;l<4;l++){var p=(l+1)%4,f=this.width/2*h[p];u=this.height/2*d[p];c.push(new Mi(f,u,e))}var m=.5*t;Bh.addBulks(this.platformInnerMesh.geometry,c,m)},e.prototype.createFlatPlatform=function(t){var e=new Mi(0,0,-t/2);Nh.BOX.setupParallel(e,Bh.RIGHT,Bh.FRONT,this.height,t,this.width),Nh.BOX.addPlanes(this.platformMesh.geometry);var r=1.005*this.width,i=.5*t,n=1.005*this.height;Nh.BOX.setupParallel(e,Bh.RIGHT,Bh.FRONT,n,i,r),Nh.BOX.addPlanes(this.platformInnerMesh.geometry)},e.prototype.createFrame=function(){var t=new On;this.frameMesh.geometry=t,this.frameColor.applyToMaterial(this.frameMesh);var e=this.width/30,r=this.width+e,i=this.height+e,n=Bh.DX,a=Bh.DY,o=[],s=[0];if(0!=this.zHeight){for(var l=0;l<4;l++){var u=r/2*n[l],c=i/2*a[l],h=new Mi(u,c,0),d=new Mi(u,c,this.zHeight);o.push(h,d)}s.push(this.zHeight)}var p=function(t){var e=r/2*n[t],l=i/2*a[t],u=(t+1)%4,c=r/2*n[u],h=i/2*a[u];s.forEach(function(t){var r=new Mi(e,l,t),i=new Mi(c,h,t);o.push(r,i)})};for(l=0;l<4;l++)p(l);Bh.addBulks(t,o,e)},e.PLATFORM_FLAT="LIFT_PLATFORM_FLAT",e.PLATFORM_ROLLER="LIFT_PLATFORM_ROLLER",e}(Uh),Ld=function(){function t(t){this.world=t,this.lastFrameNumber=-1,this.requestInterval=500,this.frameInterval=40,this.frameDelayInput=document.getElementById("frameDelay"),this.requestDelayInput=document.getElementById("requestDelay"),this.loopInfo=document.getElementById("loopInfo"),this.requestInfo=document.getElementById("requestInfo"),this.requestHandle=0,this.frameLoopHandle=0,this.shapes=new Map,this.frameBuffer=[],this.lastTime=new Date,this.lastRender=new Date,this.rootGroup=t.rootGroup}return t.prototype.doRequest=function(t){var e=this,r="http://10.0.103.56:4567/http/update?fullFrame="+t;window.fetch(r).then(function(t){return t.json()}).then(function(r){var i=r.frames;if(i.forEach(function(t){return e.frameBuffer.push(t)}),console.log(i.length),e.requestInfo){var n=new Date;e.requestInfo.textContent="Last request ("+t+"):  "+n+":"+n.getMilliseconds()+" "}})},t.prototype.startLoopRequest=function(){var t=this;this.requestDelayInput&&(this.requestInterval=Number.parseFloat(this.requestDelayInput.value)),this.doRequest(!1),this.requestHandle=window.setTimeout(function(){return t.startLoopRequest()},this.requestInterval)},t.prototype.stopLoopRequest=function(){window.clearTimeout(this.requestHandle)},t.prototype.requestFullFrame=function(){this.doRequest(!0)},t.prototype.applyCommand=function(t){switch(t.cmd){case"C":this.create3DElement(t);break;case"U":this.updateElement(t);break;case"D":this.deleteElement(t.id)}},t.prototype.applyFrame=function(t){var e=this;this.lastFrameNumber=t.number,t.commands.forEach(function(t){e.applyCommand(t)})},t.prototype.gotoFrame=function(t){for(var e=0;e<=t;e++)this.applyFrame(this.frameBuffer[e])},t.prototype.frameLoop=function(){var t=this,e=new Date,r=e.valueOf()-this.lastTime.valueOf();if(this.lastTime=e,this.frameDelayInput&&(this.frameInterval=Number.parseFloat(this.frameDelayInput.value)),this.loopInfo&&(this.loopInfo.textContent=e+":"+r),this.frameBuffer.length>0){var i=this.frameBuffer.shift();this.applyFrame(i)}this.frameLoopHandle=setTimeout(function(){return t.frameLoop()},this.frameInterval)},t.prototype.stopFrameLoop=function(){window.clearTimeout(this.frameLoopHandle)},t.prototype.create3DElement=function(t){var e=null,r=Bh.getShapeType(t),i=Bh.getAttributeValue(t,"owner-id"),n=Bh.getAttributeValue(t,"draw-mode");if(r===td.window3D&&(i=null,n="3D",this.world.canvases3d.forEach(function(r){"canvas3d-1"==r.canvas.id&&((e=r).id=t.id,n="2D")})),"3D"===n||"2D3D"===n)switch(r){case td.ellipse:case td.circle:case td.circularWall:e=new vd(t);break;case td.rect:case td.rectangularNode:case td.rectangularWall:e=new wd(t);break;case td.line:e=new dd(t);break;case td.polyline:case td.polygon:case td.conveyorCustomStation:case td.polygonalNode:e=new Sd(t);break;case td.group:case td.shapeModelElementsGroup:e=new cd(t);break;case td.image:case td.shapeImage:var a=new gd(t);a.networkManager=this.world.networkManager,e=a;break;case td.shapeArc:e=new Xh(t);break;case td.shapeText:e=new Id(t);break;case td.pathLine:case td.pathDashline:case td.pathWall:e=new yd(t);break;case td.pathRailroad:e=new Ed(t);break;case td.pathRoad:e=new Ad(t);break;case td.pointNode:e=new Cd(t);break;case td.road:e=new xd(t);break;case td.parkingLot:case td.stopLine:case td.busStop:case td.intersection:e=new Md(t);break;case td.conveyorStation:case td.conveyorTurntable:case td.conveyorTurnStation:case td.conveyorTransferTable:case td.conveyorSplit:e=new ed(t);break;case td.serviceWithLines:e=new ud(t);break;case td.window3D:e=new Wh(t);break;case td.pipe:e=new Td(t);break;case td.storageTank:e=new Od(t);break;case td.bulkConveyorBelt:case td.pathConveyor:case td.conveyorPath:e=new $h(t);break;case td.palletRack:e=new bd(t);break;case td.escalator:e=new ld(t);break;case td.light3D:var o=new hd(t);null!=o.type&&(o.scene=this.world.scene,e=o,this.world.defaultLights.visible=!1);break;case td.replicated:var s=new kd(t);s.animation=this,e=s;break;case td.towerCrane:e=new sd(t);break;case td.lift:e=new _d(t)}if(null!=e)if(e.create3D(),e.updateElement(t),this.shapes.set(t.id,e),i&&"null"!=i){var l=this.shapes.get(i);l instanceof cd?l.add(e):console.log("Group "+i+" not found")}else null!=e.element&&this.rootGroup.add(e.element);return e},t.prototype.updateElement=function(t){if(this.shapes){var e=this.shapes.get(t.id);null!=e&&e.updateElement(t)}},t.prototype.deleteElement=function(t){var e=this,r=this.shapes.get(t);null!=r&&(r instanceof cd&&r.children.slice(0).forEach(function(t){e.deleteElement(t.id)}),null!=r.parent&&r.parent.remove(r),this.shapes.delete(t),r.dispose())},t.prototype.cleanRoot=function(){var t=this,e=[];this.shapes.forEach(function(t,r){null!=t.parent||t instanceof Wh||(e.push(r),console.log("AnimationClient: Root group to remove:",r))}),e.forEach(function(e){return t.deleteElement(e)});for(var r=this.rootGroup.children.length,i=0;i<r;i++){var n=this.rootGroup.children[0];this.rootGroup.remove(n),Bh.wipeObject3D(n)}this.shapes.clear(),this.world.defaultLights.visible=!0},t.prototype.cleanAll=function(){this.cleanRoot(),this.frameBuffer=[],this.lastFrameNumber=-1},t.prototype.printTreeId=function(t){window.ptree="",this.printTree(this.shapes.get(t+""))},t.prototype.printElements=function(){this.shapes.forEach(function(t,e){return console.log(e+": "+t.constructor.name,t)})},t.prototype.printTree=function(t,e){var r=this;void 0===e&&(e="");var i=e+t.constructor.name+": "+t.id;window.ptree+=i+"\n",t instanceof cd&&t.children.forEach(function(t){r.printTree(t,e+"\t")})},t.prototype.getShapesInfo=function(){var t=Bh.getSize(this.world.rootGroup,0,0),e=t[0],r=t[1],i="Shapes: "+this.shapes.size+" (Elements: "+e+", Meshes: "+r+" )\n",n=new Map,a=new Map,o=new Map;return this.shapes.forEach(function(t,e){var r=t.constructor.name,i=n.get(r),s=Bh.getSize(t.element,0,0),l=s[0],u=s[1];n.set(r,null==i?1:i+1);var c=a.get(r);a.set(r,null==c?l:c+l);var h=o.get(r);o.set(r,null==h?u:h+u)}),n.forEach(function(t,e){i+=e+" : "+t+" ("+a.get(e)+", "+o.get(e)+")\n"}),i},t.prototype.findElements=function(t){var e=[];return this.shapes.forEach(function(r){null==r.element?console.log(r.id,r):r.element.name.match(t)&&e.push(r.element)}),e},t}(),Pd=function(){function t(){this.canvases3d=[],this.active=!1,this.initialized=!1,this.backgroundColor=Wh.DEFAULT_COLOR,this.gridColor=null,this.skybox=""}return t.getWorld=function(){return null==t._world&&(t._world=new t),t._world},t.prototype.activate=function(){te&&(this.init(),this.active=!0)},t.prototype.deactivate=function(){this.clean(),this.active=!1},t.prototype.updateGrid=function(){var t=this.gridColor;if(null!=this.grid&&(this.scene.remove(this.grid),this.grid=null),null!=t){var e=new Th(5e3,50,t,t);e.rotation.x=Math.PI/2,this.scene.add(e),this.grid=e}},t.prototype.init=function(){if(this.initialized)this.clean();else{this.scene=new ps,this.rootGroup=new Zo,this.rootGroup.name="Root Group",this.scene.add(this.rootGroup);var t=Bh.createDefaultLight(),e=new nc(5263440);if(t.name="Lights",Bh.debugServer){this.gridColor=new hn(6710886);var r=new _h(200);this.scene.add(r),window.lights=t,window.ambientLight=e}if(this.scene.add(t),this.scene.add(e),this.defaultLights=t,""!=this.skybox){var i=(new Eu).setPath("assets/3d/skyboxes/"+this.skybox+"/").load(["xn.jpg","xp.jpg","yp.jpg","yn.jpg","zp.jpg","zn.jpg"]);this.scene.background=i}this.animation=new Ld(this),this.initialized=!0}this.updateGrid()},t.prototype.createCanvas3D=function(t,e){if(this.initialized){var r=this.animation.shapes.get(t),i=void 0;return i=r instanceof Wh?r:new Wh({cmd:"C",id:t,att:[],val:[]}),0==this.canvases3d.length&&Bh.debugInfo&&(i.showStats=!0,window.Object3DManager=fd),i.setup(this,e),i.init(),this.canvases3d.push(i),i}console.warn("Wordl3d.createCanvas: not initialized")},t.prototype.clean=function(){this.initialized&&(this.canvases3d.forEach(function(t){return t.dispose()}),this.canvases3d=[],this.animation.cleanRoot(),this.cleanCache())},t.prototype.cleanCache=function(){for(var t in Bh.imageCache)Bh.imageCache[t].dispose();Bh.imageCache=[];for(var e=0,r=Dh.cache;e<r.length;e++){t=r[e];Dh.cache[t].dispose()}Dh.cache=[],Dh.materials.clear()},t.prototype.updateCanvasSize=function(t,e){this.canvases3d.forEach(function(r){r.canvas===t&&(r.updateSize(),r.renderActive=e)})},t.prototype.applyFrame=function(e,r){if(void 0===r&&(r=!1),e.fullFrame||r){for(var i=!1,n=0,a=e.commands;n<a.length;n++){var o=a[n];if("C"===o.cmd&&"Window3D"===Bh.getShapeType(o)){i=!0;break}if("N"===o.cmd){for(var s=t.DEFAULT_COLOR,l=null,u="",c=0;c<o.att.length;c++){var h=o.att[c],d=o.val[c];null!=d&&"none"!=d&&("3d-background-color"===h&&(s=Dh.parseRGB(d).toThreeColor()),"3d-grid-color"===h&&(l=Dh.parseRGB(d).toThreeColor()),"3d-skybox"===h&&(u=d))}this.backgroundColor=s,this.gridColor=l,this.skybox=u}}i?this.activate():this.deactivate()}this.active&&this.animation.applyFrame(e)},t.prototype.gotoFrame=function(t){t==this.animation.lastFrameNumber+1?this.animation.applyFrame(this.animation.frameBuffer[t]):(this.animation.cleanRoot(),this.canvases3d.forEach(function(t){return t.active=!1}),this.animation.gotoFrame(t),this.canvases3d.forEach(function(t){return t.active=!0}))},t.prototype.getInfo=function(){for(var t=0,e=0,r=0;r<fd.managers.length;r++){var i=fd.managers[r];t+=i.listeners.size,e+=i.errorCallbacks.size}var n=Dh.materials.size;console.log("Object3DManager: listeners: "+t+", ErrorCallbacks: "+e+", Colors: "+n)},t.DEFAULT_COLOR=new hn(11184810),t}(),Rd=function(){function t(){}return t.create=function(t){var e=qt.createSvgElement("rect"),r=qt.createCanvas(t,"canvas-group-3d");return e.setAttribute("stroke","none"),e.setAttribute("fill","gray"),Pd.getWorld().createCanvas3D(t,r),e},t.update=function(e,r,i){for(var n=e,a=document.getElementById(e.id+"canvas"),o=0;o<r.length;o++)switch(r[o]){case"width":case"height":n.setAttribute(r[o],i[o]),t.syncCanvas3DPosition(a);break;default:Jd.filterAndSetAttribute(e,r[o],i[o]),"pos"!=r[o]&&"scale"!=r[o]||t.syncCanvas3DPosition(a)}},t.syncCanvas3DPosition=function(t){var e=parseInt(t.id),r=document.getElementById(e.toString());if(null!=r.getAttribute("height")&&null!=r.getAttribute("width")){var i=r.getBoundingClientRect(),n=t.parentNode.getBoundingClientRect(),a=i.left-n.left,o=i.top-n.top;t.style.left=a+"px",t.style.top=o+"px";var s=Math.round(i.width),l=Math.round(i.height);if((s!=t.width||l!=t.height)&&(t.width=s,t.height=l,t.style.width=s+"px",t.style.height=l+"px",!Pd.getWorld().active)){var u=t.getContext("2d");u.fillStyle="rgba(255,0,0,0.2)",u.fillRect(0,0,t.width,t.height)}Pd.getWorld().updateCanvasSize(t,!0)}},t.syncAllCanvas3DPositions=function(){for(var e=document.getElementById("canvas-group-3d").children,r=0,i=[].slice.call(e);r<i.length;r++){var n=i[r];n instanceof HTMLCanvasElement&&t.syncCanvas3DPosition(n)}},t}(),Dd=function(){function t(t){var e=this;this.client=t,this.onWindowResizeEventClosure=function(t){return e.applyNavigationSettings()},this.onSVGPointingEventClosure=function(t){return e.onSVGPointingEvent(t)}}return t.prototype.initSVGNavigation=function(){window.addEventListener("resize",this.onWindowResizeEventClosure,!1),E.addFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.oncontextmenu=function(){return!1},t.addEventListener("mousedown",this.onSVGPointingEventClosure),t.addEventListener("mousemove",this.onSVGPointingEventClosure),t.addEventListener("mouseup",this.onSVGPointingEventClosure),t.addEventListener("mouseout",this.onSVGPointingEventClosure),t.addEventListener("wheel",this.onSVGPointingEventClosure),t.addEventListener("touchstart",this.onSVGPointingEventClosure),t.addEventListener("touchmove",this.onSVGPointingEventClosure),t.addEventListener("touchend",this.onSVGPointingEventClosure),this.buttonDown=0,this.prevPtrCoords=[],this.presentationCoords=[0,0],this.zoom=1},t.prototype.clearSVGNavigation=function(){if(this.client.svg){window.removeEventListener("resize",this.onWindowResizeEventClosure),E.removeFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.removeEventListener("mousedown",this.onSVGPointingEventClosure),t.removeEventListener("mousemove",this.onSVGPointingEventClosure),t.removeEventListener("mouseup",this.onSVGPointingEventClosure),t.removeEventListener("mouseout",this.onSVGPointingEventClosure),t.removeEventListener("wheel",this.onSVGPointingEventClosure),t.removeEventListener("touchstart",this.onSVGPointingEventClosure),t.removeEventListener("touchmove",this.onSVGPointingEventClosure),t.removeEventListener("touchend",this.onSVGPointingEventClosure)}},t.prototype.onSVGPointingEvent=function(e){if(e.target instanceof HTMLCanvasElement&&"canvas-group-3d"==e.target.parentElement.id)return;e.stopPropagation();var r=Zt.offsetPage(this.client.svg);if(e.type.startsWith("mouse")||"wheel"==e.type){var i=e,n=i.pageX-r.left,a=i.pageY-r.top;switch(i.type){case"mousedown":this.buttonDown=i.which,this.prevPtrCoords=[n,a],1==this.buttonDown||this.buttonDown;break;case"mousemove":if(1==this.buttonDown)i.preventDefault();else if(3==this.buttonDown){var o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];this.applyPanning(o,s),this.prevPtrCoords=[n,a]}break;case"mouseup":case"mouseout":if(this.client.svg.parentNode.contains(i.relatedTarget))return;var l=this.buttonDown;if(this.buttonDown=0,1==l){o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];Math.abs(o)<=t.clickTolerance&&Math.abs(s)<=t.clickTolerance&&this.onPresentationClick(i,n,a)}this.prevPtrCoords=[];break;case"wheel":var u=e;u.altKey?this.onWheelZooming(0<u.deltaY,n,a):(e.preventDefault(),0<u.deltaY?this.applyPanning(0,-50):this.applyPanning(0,50))}}else if(e.type.startsWith("touch")){var c=e,h=void 0,d=void 0,p=void 0,f=void 0;switch(c.touches.length>0&&(h=c.touches[0].pageX-r.left,d=c.touches[0].pageY-r.top),c.touches.length>1&&(p=c.touches[1].pageX-r.left,f=c.touches[1].pageY-r.top),c.type){case"touchstart":this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchmove":if(c.preventDefault(),c.touches.length>1&&4==this.prevPtrCoords.length){var m=(h+p)/2,g=(d+f)/2,v=Math.hypot(this.prevPtrCoords[2]-this.prevPtrCoords[0],this.prevPtrCoords[3]-this.prevPtrCoords[1]),b=Math.hypot(p-h,f-d)/v*this.zoom;b=Math.max(b,t.zooms[0]),b=Math.min(b,t.zooms[t.zooms.length-1]),this.applyZoom(b,m,g)}else if(this.prevPtrCoords.length>=2){o=h-this.prevPtrCoords[0],s=d-this.prevPtrCoords[1];if(4==this.prevPtrCoords.length){var y=Math.hypot(o,s),A=h-this.prevPtrCoords[2],T=d-this.prevPtrCoords[3];Math.hypot(A,T)<y&&(o=A,s=T)}this.applyPanning(o,s)}this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchend":this.prevPtrCoords=[]}}},t.prototype.applyPresentationTransform=function(){var t=this.client.frameDrawing.navigationSettings;if(!t.zoomAndPanningEnabled){var e=this.zoom,r=this.presentationCoords[0],i=this.presentationCoords[1],n=this.client.svg.getBoundingClientRect(),a=n.width,o=n.height;e=Math.max(e,a/t.width),e=Math.max(e,o/t.height),r=Math.min(r,-t.x*e),r=Math.max(r,a-(t.x+t.width)*e),i=Math.min(i,-t.y*e),i=Math.max(i,o-(t.y+t.height)*e),this.presentationCoords=[r,i],this.zoom=e}var s="translate("+Zt.fixedPrecision(this.presentationCoords[0],1)+","+Zt.fixedPrecision(this.presentationCoords[1],1)+") scale("+Zt.reducePrecision(this.zoom)+")";s!=this.client.presentation.getAttribute("transform")&&(this.client.presentation.setAttribute("transform",s),Rd.syncAllCanvas3DPositions())},t.prototype.applyZoom=function(t,e,r){if(t!=this.zoom){var i=this.client.frameDrawing.navigationSettings;if(!i.zoomAndPanningEnabled){var n=this.client.svg,a=n.getBoundingClientRect(),o=a.width,s=a.height,l=i.width,u=i.height,c=n.parentNode.getBoundingClientRect(),h=c.width,d=c.height;if((t=l/u>h/d?Math.max(t,h/l):Math.max(t,d/u))==this.zoom)return;var p=Math.min(l*t,h),f=Math.min(u*t,d),m=!1;if(p!=o&&(n.setAttribute("width",p.toString()),m=!0),f!=s&&(n.setAttribute("height",f.toString()),m=!0),m){var g=document.getElementById("canvas-group-3d");g.style.width=p+"px",g.style.height=f+"px"}}var v=t/this.zoom,b=e-(e-this.presentationCoords[0])*v,y=r-(r-this.presentationCoords[1])*v;this.presentationCoords=[b,y],this.zoom=t,this.applyPresentationTransform()}},t.prototype.applyPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform()},t.prototype.navigateTo=function(t,e,r){this.zoom=r,this.presentationCoords=[-t*this.zoom,-e*this.zoom],this.applyPresentationTransform()},t.prototype.onWheelZooming=function(e,r,i){var n=this.zoom;if(e){for(var a=t.zooms.length-1;a>=0;a--)if(t.zooms[a]<this.zoom){n=t.zooms[a];break}}else for(a=0;a<t.zooms.length;a++)if(this.zoom<t.zooms[a]){n=t.zooms[a];break}this.applyZoom(n,r,i)},t.prototype.onPresentationClick=function(t,e,r){var i=e-this.presentationCoords[0],n=r-this.presentationCoords[1];i/=this.zoom,n/=this.zoom,this.client.frameDrawing.onUserClick(t.target,i,n)},t.prototype.applyNavigationSettings=function(){var t,e,r,i=this.client.svg,n=this.client.frameDrawing.navigationSettings,a=n.width,o=n.height,s=n.zoomAndPanningEnabled,l=n.width/n.height,u=i.parentNode.getBoundingClientRect(),c=u.width,h=u.height,d=c/h,p=n.x,f=n.y;l>d?(r=c/a,t=c,s?f-=((e=h)/r-o)/2:e=c/l):(r=h/o,s?p-=((t=c)/r-a)/2:t=h*l,e=h),Zt.setMultipleAttributes(i,["width","height"],[t,e]);var m=document.getElementById("canvas-group-3d");m.style.width=t+"px",m.style.height=e+"px",this.navigateTo(p,f,r)},t.clickTolerance=1,t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t}(),Fd=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return qt.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return qt.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return qt.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)Jd.filterAndSetAttribute(e,r[n],i[n]);t.updateGISMarkupPosition(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=qt.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=Zt.getFloatAttribute(t,"lon"),n=Zt.getFloatAttribute(t,"lat"),a=Nd.lonLatToXY(r,i,n);Zt.setMultipleAttributes(t,["cx","cy"],[a[0],a[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var o=t.getAttribute("lonlatpoints"),s=Nd.lonLatPointsToXYPoints(r,o);t.setAttribute("points",s)}},t}(),Nd=function(){function t(t){this.frameDrawing=t}return t.prototype.createShapeGISMap=function(){var t=this,e=qt.cloneElementWithId("shape-gis-map"),r=function(e){return t.onGISEvent(e)};e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r);var i=qt.findChildOfType(e,"map").firstElementChild;return qt.findChildOfType(i,"agents").addEventListener("click",function(e){return t.onGISAgentLayerClick(e)}),e},t.prototype.updateShapeGISMap=function(t,e,r){for(var i=qt.findChildOfType(t,"background"),n=qt.findChildOfType(t,"map"),a=qt.findChildOfType(t,"shadow"),o=qt.findChildOfType(t,"border"),s=0;s<e.length;s++)switch(e[s]){case"width":case"height":i.setAttribute(e[s],r[s]),n.setAttribute(e[s],r[s]),a.setAttribute(e[s],r[s]),o.setAttribute(e[s],r[s]);break;case"size-completed":t.getAttribute("zoom")&&this.redrawGISMap(t);break;case"background-color":i.setAttribute("fill",r[s]);break;case"border-color":o.setAttribute("stroke",r[s]);break;case"map-completed":this.redrawGISMap(t);break;default:Jd.filterAndSetAttribute(t,e[s],r[s])}},t.prototype.redrawGISMap=function(e){this.redrawGISTiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.prototype.redrawGISTiles=function(e){var r=qt.findChildOfType(e,"background"),i=Zt.getFloatAttribute(r,"width"),n=Zt.getFloatAttribute(r,"height"),a=t.minGISZoom(i,n),o=qt.findChildOfType(e,"map").firstElementChild;o.setAttribute("transform","translate(0,0)");var s=Zt.getIntAttribute(e,"zoom"),l=Zt.getFloatAttribute(e,"center-lon"),u=Zt.getFloatAttribute(e,"center-lat");s<a&&(s=a,e.setAttribute("zoom",s.toString()));var c,h=Math.pow(2,s),d=t.latToTileYFloat(u,s),p=n/2/t.tileImageSize;d-p<0?c=p:h<d+p&&(c=h-p),c&&(u=t.tileYToLat(c,s),e.setAttribute("center-lat",u.toString()));var f=qt.findChildOfType(o,"tiles");qt.removeAllChildren(f),this.updateGISTiles(f,s,u,l,0,0,i,n,h)},t.prototype.updateGISTiles=function(e,r,i,n,a,o,s,l,u){for(var c=t.lonToTileXInt(n,r),h=t.latToTileYInt(i,r),d=a+s/2-t.lonToXOffsetWithinTile(n,r),p=o+l/2-t.latToYOffsetWithinTile(i,r);d>0;)d-=t.tileImageSize,c--;for(;p>0;)p-=t.tileImageSize,h--;c=Zt.modulo(c,u),h=Zt.modulo(h,u);for(var f=[],m=qt.childElements(e),g=0;g<m.length;g++)f.push(m[g]);for(var v=c,b=d;b<s;b+=t.tileImageSize){for(var y=h,A=p;A<l;A+=t.tileImageSize){var T=r+"/"+v+"/"+y,C=null;for(g=0;g<f.length;g++)if(f[g].getAttribute("tileid")==T){C=f[g];break}null==C&&(C=this.addGISTile(e,r,v,y)),C.setAttribute("x",(b-a).toString()),C.setAttribute("y",(A-o).toString()),y=Zt.modulo(y+1,u)}v=Zt.modulo(v+1,u)}},t.prototype.addGISTile=function(e,r,i,n){var a=qt.findParentOfType(e,"ShapeGISMap"),o=this.tileURL(a,r,i,n),s=qt.createSvgElement("image");return s.setAttribute("width",t.tileImageSize.toString()),s.setAttribute("height",t.tileImageSize.toString()),s.setAttributeNS(qt.xlinkns,"href",o),s.setAttribute("tileid",r+"/"+i+"/"+n),e.appendChild(s),s},t.redrawGISMarkup=function(t){for(var e=qt.findChildOfType(t,"map").firstElementChild,r=qt.findChildOfType(e,"markup"),i=qt.childElements(r),n=0;n<i.length;n++)Fd.updateGISMarkupPosition(i[n])},t.redrawGISAgents=function(e){for(var r=qt.findChildOfType(e,"map").firstElementChild,i=qt.findChildOfType(r,"agents"),n=qt.childElements(i),a=0;a<n.length;a++)t.updateGISObjectScale(n[a]),"hidden"!=n[a].getAttribute("visibility")&&t.updateGISObjectPosition(n[a])},t.updateGISObjectPosition=function(e){var r=qt.findParentOfType(e,"ShapeGISMap"),i=Zt.getFloatAttribute(e,"lon"),n=Zt.getFloatAttribute(e,"lat"),a=Zt.getFloatAttribute(e,"heading"),o=t.lonLatToXY(r,i,n),s="translate("+o[0]+","+o[1]+") rotate("+a+")",l=e.getAttribute("scale");l&&(s+=" scale("+l+")"),e.setAttribute("transform",s)},t.updateGISObjectScale=function(e){var r=qt.findParentOfType(e,"ShapeGISMap"),i=Zt.getIntAttribute(e,"fixed-scale-zoom");if(i){var n=Zt.getIntAttribute(r,"zoom");if(n<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var a=1;if(Zt.getIntAttribute(e,"real-scale-zoom")<=n){var o=Zt.getFloatAttribute(e,"pixels-per-meter"),s=Zt.getFloatAttribute(e,"lat");a=t.pixelsPerGISMeter(n,s)/o}e.setAttribute("scale",a.toString())}},t.prototype.panGIS=function(e,r,i){var n=qt.findChildOfType(e,"map").firstElementChild,a=Zt.parseTranslateTransform(n.getAttribute("transform")),o=a[0]+r,s=a[1]+i,l=Zt.getIntAttribute(e,"zoom"),u=Math.pow(2,l),c=Zt.getFloatAttribute(e,"center-lon"),h=Zt.getFloatAttribute(e,"center-lat"),d=t.latToTileYFloat(h,l),p=qt.findChildOfType(e,"background"),f=Zt.getFloatAttribute(p,"width"),m=Zt.getFloatAttribute(p,"height"),g=m/2/t.tileImageSize;d-g-s/t.tileImageSize<0?s=(d-g)*t.tileImageSize:u<d+g-s/t.tileImageSize&&(s=(d+g-u)*t.tileImageSize),o=t.normalizedGISX(o,l),o=Math.round(o),s=Math.round(s),n.setAttribute("transform","translate("+o+","+s+")");var v=qt.findChildOfType(n,"tiles");this.updateGISTiles(v,l,h,c,o,s,f,m,u)},t.prototype.zoomOutGIS=function(e,r,i){var n=qt.findChildOfType(e,"background"),a=Zt.getFloatAttribute(n,"width"),o=Zt.getFloatAttribute(n,"height"),s=Zt.getIntAttribute(e,"zoom");t.minGISZoom(a,o)<s&&this.setGISZoom(e,r,i,s-1)},t.prototype.zoomInGIS=function(t,e,r){var i=Zt.getIntAttribute(t,"zoom");i<19&&this.setGISZoom(t,e,r,i+1)},t.prototype.setGISZoom=function(e,r,i,n){var a=qt.findChildOfType(e,"background"),o=Zt.getFloatAttribute(a,"width"),s=Zt.getFloatAttribute(a,"height"),l=qt.findChildOfType(e,"map").firstElementChild,u=Zt.parseTranslateTransform(l.getAttribute("transform")),c=t.xyToLonLat(e,r-u[0],i-u[1]),h=t.lonToTileXFloat(c[0],n),d=t.latToTileYFloat(c[1],n),p=Math.pow(2,n);h=Zt.remainderPositive(h-(r-o/2)/t.tileImageSize,p),d=Zt.remainderPositive(d-(i-s/2)/t.tileImageSize,p);var f=t.tileXToLon(h,n),m=t.tileYToLat(d,n);Zt.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[n,f,m]),this.redrawGISMap(e)},t.prototype.onGISClick=function(e,r,i){var n=qt.findChildOfType(e,"map").firstElementChild,a=Zt.parseTranslateTransform(n.getAttribute("transform")),o=t.xyToLonLat(e,r-a[0],i-a[1]);this.frameDrawing.client.network.postUserAction(e.id,o[0]+" "+o[1])},t.prototype.onGISEvent=function(e){var r=e.currentTarget;if("true"==r.getAttribute("navigation-enabled")){var i=qt.findChildOfType(r,"background"),n=Zt.getFloatAttribute(i,"width"),a=Zt.getFloatAttribute(i,"height"),o=i.getBoundingClientRect(),s=o.width/n,l=o.height/a,u=Zt.offsetPage(i);if(e.type.startsWith("mouse")||"wheel"==e.type){var c=e,h=(c.pageX-u.left)/s,d=(c.pageY-u.top)/l;switch(e.type){case"mousedown":t.buttonDown=c.which,1==t.buttonDown&&(e.stopPropagation(),t.prevPtrCoords=[h,d]);break;case"mousemove":if(1==t.buttonDown){e.stopPropagation(),e.preventDefault();var p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];t.prevPtrCoords=[h,d],this.panGIS(r,p,f)}break;case"mouseup":case"mouseout":if(r.contains(c.relatedTarget))return;if(1==t.buttonDown){e.stopPropagation();p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];Math.abs(p)<=Dd.clickTolerance&&Math.abs(f)<=Dd.clickTolerance&&this.onGISClick(r,h,d)}t.buttonDown=0;break;case"wheel":if(!c.altKey&&!c.ctrlKey){var m=e;e.stopPropagation(),e.preventDefault(),0<m.deltaY?this.zoomOutGIS(r,h,d):this.zoomInGIS(r,h,d)}}}else if(e.type.startsWith("touch")){var g=e;if(g.touches.length>2)return;var v=void 0,b=void 0,y=void 0,A=void 0;switch(g.touches.length>0&&(v=(g.touches[0].pageX-u.left)/s,b=(g.touches[0].pageY-u.top)/l),g.touches.length>1&&(y=(g.touches[1].pageX-u.left)/s,A=(g.touches[1].pageY-u.top)/l),e.type){case"touchstart":e.stopPropagation(),t.prevPtrCoords=g.touches.length>1?[v,b,y,A]:[v,b];break;case"touchmove":if(e.stopPropagation(),e.preventDefault(),g.touches.length>1&&4==t.prevPtrCoords.length){var T=(v+y)/2,C=(b+A)/2,S=Math.hypot(t.prevPtrCoords[2]-t.prevPtrCoords[0],t.prevPtrCoords[3]-t.prevPtrCoords[1]),E=Math.hypot(y-v,A-b);(E<.8*S||1.2*S<E)&&(E<S?this.zoomOutGIS(r,T,C):this.zoomInGIS(r,T,C),t.prevPtrCoords=[v,b,y,A])}else if(t.prevPtrCoords.length>=2){p=v-t.prevPtrCoords[0],f=b-t.prevPtrCoords[1];if(4==t.prevPtrCoords.length){var w=Math.hypot(p,f),k=v-t.prevPtrCoords[2],x=b-t.prevPtrCoords[3];Math.hypot(k,x)<w&&(p=k,f=x)}this.panGIS(r,p,f),t.prevPtrCoords=g.touches.length>1?[v,b,y,A]:[v,b]}else t.prevPtrCoords=g.touches.length>1?[v,b,y,A]:[v,b];break;case"touchend":e.stopPropagation(),t.prevPtrCoords=[]}}}},t.prototype.onGISAgentLayerClick=function(t){t.stopPropagation(),t.preventDefault();for(var e=t.currentTarget,r=t.target;r.parentNode!=e;)r=r.parentNode;this.frameDrawing.client.network.postUserAction(r.id,"0 0")},t.xyToLonLat=function(e,r,i){var n=qt.findChildOfType(e,"background"),a=Zt.getFloatAttribute(n,"width"),o=Zt.getFloatAttribute(n,"height"),s=Zt.getIntAttribute(e,"zoom"),l=Math.pow(2,s),u=t.lonToTileXFloat(Zt.getFloatAttribute(e,"center-lon"),s),c=t.latToTileYFloat(Zt.getFloatAttribute(e,"center-lat"),s),h=(r-a/2)/t.tileImageSize,d=(i-o/2)/t.tileImageSize,p=Zt.remainderPositive(u+h,l),f=Zt.remainderPositive(c+d,l);return[t.tileXToLon(p,s),t.tileYToLat(f,s)]},t.lonLatToXY=function(e,r,i){var n=qt.findChildOfType(e,"background"),a=Zt.getFloatAttribute(n,"width"),o=Zt.getFloatAttribute(n,"height"),s=Zt.getIntAttribute(e,"zoom"),l=t.lonToTileXFloat(Zt.getFloatAttribute(e,"center-lon"),s),u=t.latToTileYFloat(Zt.getFloatAttribute(e,"center-lat"),s),c=t.lonToTileXFloat(r,s),h=t.latToTileYFloat(i,s);return[a/2+(c-l)*t.tileImageSize,o/2+(h-u)*t.tileImageSize]},t.lonLatPointsToXYPoints=function(e,r){var i=qt.findChildOfType(e,"background"),n=Zt.getFloatAttribute(i,"width"),a=Zt.getFloatAttribute(i,"height"),o=Zt.getIntAttribute(e,"zoom"),s=t.lonToTileXFloat(Zt.getFloatAttribute(e,"center-lon"),o),l=t.latToTileYFloat(Zt.getFloatAttribute(e,"center-lat"),o),u=void 0,c=void 0,h="";r=Zt.splitSkipEmpty(r," ");for(var d=0;d<r.length;d++){var p=r[d].split(","),f=t.lonToTileXFloat(parseFloat(p[0]),o),m=t.latToTileYFloat(parseFloat(p[1]),o),g=n/2+(f-s)*t.tileImageSize,v=a/2+(m-l)*t.tileImageSize;null!=u&&Math.abs(g-u)<t.gisTolerance&&Math.abs(v-c)<t.gisTolerance||(h+=(g=Zt.reducePrecision(g))+","+(v=Zt.reducePrecision(v))+" ",u=g,c=v)}return h},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.prototype.tileURL=function(e,r,i,n){var a;switch(e.getAttribute("tile-url-provider-type")){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":a=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":a=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":a=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":a=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":a=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":a=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":a=Zt.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}return a[Math.floor(Math.random()*a.length)].replace("[zoom]",r.toString()).replace("[x]",i.toString()).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=Zt.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=Zt.stringToByteArray(t+"/"+e+"/"+r+".png"),a=0;a<n.length;a++)n[a]^=i[a%n.length];return btoa(Zt.byteArrayToString(n))},t.buttonDown=0,t.prevPtrCoords=[0,0],t.gisTolerance=2,t.tileImageSize=256,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),Bd=function(){function t(){}return t.createMarkupPipe=function(t){var e=qt.cloneElementWithId("markup-pipe"),r=t+"basepath";qt.findChildOfType(e,"basepath").firstElementChild.id=r;var i=qt.findChildOfType(e,"pipe"),n=qt.findChildOfType(e,"inner-pipe"),a=qt.findChildOfType(e,"bubbles"),o="#"+r;return i.setAttributeNS(qt.xlinkns,"href",o),n.setAttributeNS(qt.xlinkns,"href",o),a.setAttributeNS(qt.xlinkns,"href",o),e},t.updateMarkupPipe=function(t,e,r){for(var i,n=qt.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=qt.findChildOfType(t,"batches"),s=qt.findChildOfType(t,"bubbles"),l=0;l<e.length;l++)switch(e[l]){case"phase":s.setAttribute("stroke-dashoffset",(12-parseFloat(r[l])).toString());break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=qt.childElements(o)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=o.childElementCount,m=p;m<f;m++)qt.removeElement(o,o.lastElementChild);for(m=f;m<p;m++)d=qt.createUseElement(a),o.appendChild(d);break;case"d":var g=parseFloat(qt.findChildOfType(t,"pipe").getAttribute("stroke-width")),v=Zt.roundPathCorners(r[l],2*g,!1);n.setAttribute("d",v);break;case"width":var b=parseFloat(r[l]);qt.findChildOfType(t,"pipe").setAttribute("stroke-width",b.toString()),qt.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*b).toString()),o.setAttribute("stroke-width",(.6*b).toString());var y=Math.min(5,.2*b);s.setAttribute("stroke-width",y.toString()),s.setAttribute("stroke-dasharray",y+","+(12-y));break;case"color":qt.findChildOfType(t,"pipe").setAttribute("stroke",r[l]);break;case"inner-color":qt.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[l]);break;default:Jd.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupStorageTank=function(){return qt.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=qt.findChildOfType(t,"square"),n=qt.findChildOfType(t,"batches"),a=parseFloat(i.getAttribute("width")),o=0;o<e.length;o++)switch(e[o]){case"batch":var s=r[o].split(" "),l=parseFloat(s[1])*a,u=parseFloat(s[2])*a,c=qt.childElements(n)[parseInt(s[0])];Zt.setMultipleAttributes(c,["y","height","fill"],[a/2-l-u,u,s[3]]);break;case"newbatches":for(var h=parseInt(r[o]),d=n.childElementCount,p=h;p<d;p++)qt.removeElement(n,n.lastElementChild);for(p=d;p<h;p++)c=qt.createSvgElement("rect"),Zt.setMultipleAttributes(c,["stroke","width","x"],["none",a,-a/2]),n.appendChild(c);break;case"progress":var f=parseFloat(r[o])*Math.PI*2,m=parseFloat(qt.findChildOfType(t,"circle").getAttribute("r"))-2,g=m*Math.sin(f),v=-m*Math.cos(f),b="M 0 "+-m+" ";b+="A "+m+" "+m+" 0 "+(f>Math.PI?"1":"0")+" 1 "+g+" "+v,qt.findChildOfType(t,"arc").setAttribute("d",b);break;case"radius":qt.findChildOfType(t,"circle").setAttribute("r",r[o]),a=Math.max(10,2*parseFloat(r[o])/Math.sqrt(2)-8),Zt.setMultipleAttributes(i,["width","height","x","y"],[a,a,-a/2,-a/2]);break;case"color":qt.findChildOfType(t,"circle").setAttribute("fill",r[o]);break;case"stroke-color":qt.findChildOfType(t,"circle").setAttribute("stroke",r[o]),qt.findChildOfType(t,"square").setAttribute("stroke",r[o]);break;default:Jd.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupBulkConveyorBelt=function(t){var e=qt.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";qt.findChildOfType(e,"basepath").firstElementChild.id=r;var i=qt.findChildOfType(e,"belt"),n=qt.findChildOfType(e,"belt-sections"),a="#"+r;return i.setAttributeNS(qt.xlinkns,"href",a),n.setAttributeNS(qt.xlinkns,"href",a),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,n=qt.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=qt.findChildOfType(t,"belt-sections"),s=qt.findChildOfType(t,"batches"),l=0;l<e.length;l++)switch(e[l]){case"phase":o.setAttribute("stroke-dashoffset",r[l]);break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=qt.childElements(s)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=s.childElementCount,m=p;m<f;m++)qt.removeElement(s,s.lastElementChild);for(m=f;m<p;m++)d=qt.createUseElement(a),s.appendChild(d);break;case"d":n.setAttribute("d",r[l]);break;case"width":var g=r[l];qt.findChildOfType(t,"belt").setAttribute("stroke-width",g),o.setAttribute("stroke-width",g),o.setAttribute("stroke-dasharray","2, 10"),s.setAttribute("stroke-width",(.4*parseFloat(g)).toString());break;case"color":qt.findChildOfType(t,"belt").setAttribute("stroke",r[l]);break;case"sections-color":o.setAttribute("stroke",r[l]);break;default:Jd.filterAndSetAttribute(t,e[l],r[l])}},t}(),Gd=function(){function t(){}return t.createMarkupPath=function(t,e){var r=qt.cloneElementWithId("markup-path"),i=e+"basepath";qt.findChildOfType(r,"basepath").firstElementChild.id=i;var n=qt.findChildOfType(r,"paths"),a=1;"MarkupPathRoad"==t&&(a=2),"MarkupPathRailroad"==t&&(a=4);for(var o=0;o<a;o++){var s=qt.createUseElement(i);n.appendChild(s)}var l=qt.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(n.firstElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","white")):"MarkupPathRoad"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","white"),l.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(n.firstElementChild.setAttribute("stroke","gray"),qt.childElements(n)[1].setAttribute("stroke","black"),qt.childElements(n)[2].setAttribute("stroke","white"),n.lastElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),n=qt.findChildOfType(t,"basepath").firstElementChild,a=qt.findChildOfType(t,"paths"),o=a.firstElementChild,s=qt.findChildOfType(t,"arrows"),l=0;l<e.length;l++)switch(e[l]){case"d":n.setAttribute("d",r[l]);break;case"bidirectional":qt.removeAllChildren(s),"false"==r[l]&&Zt.addPathArrows(n,"arrowhead",1.7,s,50,100);break;case"stroke-width":var u=parseFloat(r[l]);switch(i){case"MarkupPathLine":o.setAttribute("stroke-width",u.toString());break;case"MarkupPathDashline":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",4*u+" "+u);break;case"MarkupPathConveyor":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",u/2+" "+u/10);break;case"MarkupPathRoad":o.setAttribute("stroke-width",u.toString());var c=a.lastElementChild;c.setAttribute("stroke-width",(u/12).toString()),c.setAttribute("stroke-dasharray",u/2+" "+u/5);break;case"MarkupPathRailroad":var h=u/10+" "+u/2.5;o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",h),qt.childElements(a)[1].setAttribute("stroke-width",(u/2+u/12).toString()),qt.childElements(a)[2].setAttribute("stroke-width",(u/2).toString());var d=a.lastElementChild;d.setAttribute("stroke-width",(u/2).toString()),d.setAttribute("stroke-dasharray",h)}break;case"stroke":o.setAttribute("stroke",r[l]),u=parseFloat(o.getAttribute("stroke-width")),s.setAttribute("stroke",u>4?"white":r[l]);break;default:Jd.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupAreaNode=function(t){var e,r=qt.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=qt.createSvgElement("rect");break;case"MarkupPolygonalNode":e=qt.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:Jd.filterAndSetAttribute(i,e[n],r[n])}},t.createMarkupPalletRack=function(){return qt.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"stroke":n.setAttribute(e[a],r[a]);break;case"fill":i.setAttribute(e[a],r[a]);break;case"rack-data":qt.removeAllChildren(i),qt.removeAllChildren(n);var o=r[a].split(" "),s=parseInt(o[0]),l=parseInt(o[1]),u=parseFloat(o[2]),c=parseFloat(o[3]),h=parseFloat(o[4]),d=void 0,p=void 0,f=void 0;s>1&&(d=parseFloat(o[5]),p=parseFloat(o[6]),f=c+d);var m=qt.createSvgElement("rect");if(m.setAttribute("width",u.toString()),m.setAttribute("height",c.toString()),i.appendChild(m),s>1){var g=qt.createSvgElement("rect");g.setAttribute("width",u.toString()),g.setAttribute("height",p.toString()),g.setAttribute("transform","translate( 0 "+f+")"),i.appendChild(g)}for(var v=h,b=0;b<l-1;b++){var y=qt.createSvgElement("line");Zt.setMultipleAttributes(y,["x1","x2","y1","y2"],[v,v,"0",c]),n.appendChild(y),v+=h}if(s>1){var A=f+p;v=h;for(b=0;b<l-1;b++){y=qt.createSvgElement("line");Zt.setMultipleAttributes(y,["x1","x2","y1","y2"],[v,v,f,A]),n.appendChild(y),v+=h}}break;default:Jd.filterAndSetAttribute(t,e[a],r[a])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),Ud=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=qt.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=qt.createSvgElement("path");break;case"MarkupCircularWall":r=qt.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=qt.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:Jd.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupTargetLine=function(){return qt.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var n=qt.findChildOfType(e,"polyline"),a=qt.findChildOfType(e,"serif-start"),o=qt.findChildOfType(e,"serif-end"),s=0;s<r.length;s++)switch(r[s]){case"color":e.setAttribute("stroke",i[s]);break;case"points":n.setAttribute(r[s],i[s]);var l=i[s].split(" "),u=l.length;l[u-1].includes(",")||u--,t.setSerif(l[0],l[1],a),t.setSerif(l[u-1],l[u-2],o);break;default:Jd.filterAndSetAttribute(e,r[s],i[s])}},t.createMarkupPathway=function(){return qt.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=qt.findChildOfType(t,"polygon"),n=qt.findChildOfType(t,"polyline"),a=qt.findChildOfType(t,"ties"),o=0;o<e.length;o++)switch(e[o]){case"color":a.setAttribute("stroke",r[o]);break;case"points":var s=r[o].split(" "),l="",u="",c="";qt.removeAllChildren(a);for(var h=0;h<s.length;h++){var d=Zt.splitToFloats(s[h],",");if(4==d.length){l+=d[0]+","+d[1]+" ",u=d[2]+","+d[3]+" "+u,c+=(d[0]+d[2])/2+","+(d[1]+d[3])/2+" ";var p=qt.createSvgElement("line");Zt.setMultipleAttributes(p,["x1","y1","x2","y2"],[d[0],d[1],d[2],d[3]]),a.appendChild(p)}}i.setAttribute("points",l+u),n.setAttribute("points",c);break;default:Jd.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupPedFlowStatistics=function(){return qt.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=qt.findChildOfType(t,"line"),n=qt.findChildOfType(t,"serif-end"),a=qt.findChildOfType(t,"direction"),o=qt.findChildOfType(t,"arrow-right"),s=qt.findChildOfType(t,"arrow-left"),l=0;l<e.length;l++)switch(e[l]){case"color":t.setAttribute("stroke",r[l]);break;case"length":i.setAttribute("x2",r[l]),n.setAttribute("x1",r[l]),n.setAttribute("x2",r[l]);var u=parseInt(r[l])/2;a.setAttribute("x1",u.toString()),a.setAttribute("x2",u.toString()),o.setAttribute("transform","translate("+u+" 13) rotate(90)"),s.setAttribute("transform","translate("+u+" -13) rotate(-90)");break;case"direction":switch(o.setAttribute("visibility","inherit"),s.setAttribute("visibility","inherit"),r[l]){case"right":s.setAttribute("visibility","hidden");break;case"left":o.setAttribute("visibility","hidden")}break;default:Jd.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupServiceWithLines=function(){return qt.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var n=qt.findChildOfType(e,"queues"),a=qt.findChildOfType(e,"services"),o=qt.findChildOfType(e,"reverse-queues"),s=qt.findChildOfType(e,"area"),l=0;l<r.length;l++)switch(r[l]){case"queue-color":n.setAttribute("stroke",i[l]);break;case"reverse-queue-color":o.setAttribute("stroke",i[l]);break;case"service-color":a.setAttribute("stroke",i[l]);break;case"clear-all-queues":qt.removeAllChildren(n),qt.removeAllChildren(o);break;case"queue":t.addQueue(n,i[l]);break;case"reverse-queue":t.addQueue(o,i[l]);break;case"clear-services":qt.removeAllChildren(a);break;case"service":t.addService(a,i[l]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":s.setAttribute(r[l],i[l]);break;case"pos":case"scale":var u=Jd.posOrScaleToTransform(s,r[l],i[l]);s.setAttribute("transform",u);break;default:Jd.filterAndSetAttribute(e,r[l],i[l])}},t.createMarkupServiceWithArea=function(){return qt.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var n=qt.findChildOfType(e,"services"),a=0;a<r.length;a++)switch(r[a]){case"service-color":n.setAttribute("stroke",i[a]);break;case"clear-services":qt.removeAllChildren(n);break;case"service":t.addService(n,i[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":case"pos":case"scale":break;default:Jd.filterAndSetAttribute(e,r[a],i[a])}},t.createMarkupEscalatorGroup=function(){return qt.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=qt.findChildOfType(t,"background"),n=qt.findChildOfType(t,"escalators"),a=0;a<e.length;a++)switch(e[a]){case"balustrade-color":i.setAttribute("fill",r[a]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[a]?"inherit":"hidden");break;case"dimensions-completed":var o=Zt.getIntAttribute(t,"number-of-escalators"),s=Zt.getFloatAttribute(t,"width"),l=Zt.getFloatAttribute(t,"length"),u=Zt.getFloatAttribute(t,"left-balustrade-width"),c=Zt.getFloatAttribute(t,"right-balustrade-width"),h=Zt.getFloatAttribute(t,"internal-balustrade-width"),d=Zt.getFloatAttribute(t,"lower-landing-length"),p=u+c+o*s+(o-1)*h,f=d+l+Zt.getFloatAttribute(t,"upper-landing-length");Zt.setMultipleAttributes(i,["y","width","height"],[-u,f,p]);for(var m=0;m<o;m++){var g=m*(s+h),v=qt.cloneElementWithId("escalator"),b=qt.findChildOfType(v,"background");Zt.setMultipleAttributes(b,["y","width","height"],[g,f,s]);var y=qt.findChildOfType(v,"handrail-left"),A=qt.findChildOfType(v,"handrail-right");Zt.setMultipleAttributes(y,["x2","y1","y2"],[f,g,g]),Zt.setMultipleAttributes(A,["x2","y1","y2"],[f,g+s,g+s]);var T=qt.findChildOfType(v,"lower-landing-end"),C=qt.findChildOfType(v,"upper-landing-end");Zt.setMultipleAttributes(T,["x1","x2","y1","y2"],[d,d,g,g+s]),Zt.setMultipleAttributes(C,["x1","x2","y1","y2"],[d+l,d+l,g,g+s]);var S=qt.findChildOfType(v,"stairs");Zt.setMultipleAttributes(S,["x1","x2","y1","y2","stroke-width"],[d,d+l,g+s/2,g+s/2,s]),n.appendChild(v)}break;case"offsets":var E=Zt.splitToFloats(r[a]," "),w=qt.childElements(n);for(m=0;m<w.length;m++)qt.findChildOfType(w[m],"stairs").setAttribute("stroke-dashoffset",(-E[m]).toString());break;default:Jd.filterAndSetAttribute(t,e[a],r[a])}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),a=parseFloat(i[0]),o=parseFloat(i[1]),s=parseFloat(n[0])-a,l=parseFloat(n[1])-o,u=Math.hypot(s,l),c=3*l/u,h=3*s/u;Zt.setMultipleAttributes(r,["x1","x2","y1","y2"],[a+c,a-c,o-h,o+h])},t.addService=function(t,e){var r,i=e.split(" "),n=parseFloat(Zt.getSubAttribute(i,"x")),a=parseFloat(Zt.getSubAttribute(i,"y")),o=Zt.radiansToDegrees(parseFloat(Zt.getSubAttribute(i,"orientation")));if("point"==Zt.getSubAttribute(i,"type")){(r=qt.createUseElement("service-point")).setAttribute("transform","translate("+n+" "+a+")");var s=qt.createUseElement("arrowhead-small");s.setAttribute("transform","translate("+(n-11)+" "+a+") rotate("+o+" 11 0)"),t.appendChild(s)}else{(r=qt.cloneElementWithId("service-line")).setAttribute("transform","translate("+n+" "+a+") rotate("+o+")");var l=r.firstElementChild.nextElementSibling,u=parseFloat(Zt.getSubAttribute(i,"length"));if(l.setAttribute("x2",u),"true"==Zt.getSubAttribute(i,"bidirectional")){var c=r.lastElementChild;c.setAttribute("visibility","inherit"),c.setAttribute("transform","translate("+(u+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=Zt.splitSkipEmpty(e,"|"),i=Zt.getSubAttribute(r,"queue-path"),n=qt.createSvgElement("path");n.setAttribute("d",i),t.appendChild(n),Zt.addPathArrows(n,"arrowhead-small",.7,t,50,100);var a=Zt.getSubAttribute(r,"fence-color");if(a)for(var o=[Zt.getSubAttribute(r,"fence-path-left"),Zt.getSubAttribute(r,"fence-path-right")],s=0;s<o.length;s++){var l=qt.createSvgElement("path");Zt.setMultipleAttributes(l,["d","stroke","stroke-width","stroke-dasharray"],[o[s],a,"2","none"]),t.appendChild(l)}},t}(),zd=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return qt.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:Jd.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return qt.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)Jd.filterAndSetAttribute(t,e[i],r[i])},t}(),Wd=function(){function t(){}return t.createMarkupIntersection=function(){return qt.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,n=qt.findChildOfType(t,"lane-connectors"),a=0;a<e.length;a++)switch(e[a]){case"fill":case"d":i.setAttribute(e[a],r[a]);break;case"lane-connector":var o=qt.createSvgElement("g"),s=qt.createSvgElement("path");s.setAttribute("d",r[a]),o.appendChild(s),Zt.addPathArrows(s,"arrowhead-tiny",.5,o,20,40),n.appendChild(o);break;case"lane-connector-colors":for(var l=Zt.splitSkipEmpty(r[a]," "),u=qt.childElements(n),c=0;c<u.length;c++)u[c].setAttribute("stroke",l[c]);break;default:Jd.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupRoad=function(){return qt.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var n=qt.findChildOfType(e,"lanes"),a=qt.findChildOfType(e,"delimiters"),o=qt.findChildOfType(e,"median"),s=0;s<r.length;s++)switch(r[s]){case"lane-width":n.setAttribute("stroke-width",i[s]);break;case"lane-color":n.setAttribute("stroke",i[s]);break;case"forward-lane":case"backward-lane":var l=qt.createSvgElement("path");l.setAttribute("d",i[s]),n.appendChild(l);break;case"lane-delimiter-color":a.setAttribute("stroke",i[s]);break;case"lane-delimiter-width":case"lane-delimiter-style":a.setAttribute(r[s],i[s]);break;case"lane-delimiter":var u=Zt.getFloatAttribute(a,"lane-delimiter-width"),c=a.getAttribute("lane-delimiter-style");t.addDelimiter(a,u,c,i[s],n.getAttribute("stroke"));break;case"median-color":o.setAttribute("stroke",i[s]);break;case"median-width":case"median-style":o.setAttribute(r[s],i[s]);break;case"median":u=Zt.getFloatAttribute(o,"median-width"),c=o.getAttribute("median-style"),t.addDelimiter(o,u,c,i[s],n.getAttribute("stroke"));break;default:Jd.filterAndSetAttribute(e,r[s],i[s])}},t.addDelimiter=function(t,e,r,i,n){var a=r.includes("DASHED"),o=r.includes("DOUBLE"),s=qt.createSvgElement("path");if(s.setAttribute("d",i),s.setAttribute("stroke-width",(o?3*e:e).toString()),a&&s.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(s),o){var l=qt.createSvgElement("path");Zt.setMultipleAttributes(l,["d","stroke-width","stroke"],[i,e,n]),t.appendChild(l)}},t.createMarkupStopLine=function(){return qt.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:Jd.filterAndSetAttribute(t,e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return qt.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:Jd.filterAndSetAttribute(t,e[a],r[a])}},t}(),Hd=function(){function t(t,e){this.frameDrawing=t,this.control=e}return t.createControlList=function(e){var r=qt.cloneElementWithId("control-list"),i=function(e){return t.onControlListMouseEvent(e)};r.addEventListener("mouseover",i),r.addEventListener("mouseout",i),r.addEventListener("wheel",i);var n=qt.findChildOfType(r,"svg"),a=qt.findChildOfType(n,"scrollbargroup"),o=function(e){return t.onControlListScrollbarMouseEvent(e)};return a.addEventListener("mouseout",o),a.addEventListener("mousedown",o),a.addEventListener("mouseup",o),a.addEventListener("mousemove",o),a.addEventListener("click",o),e&&t.onGotFocus(r),r.setAttribute("always-focused",e.toString()),r},t.prototype.updateControlList=function(e,r,i){for(var n=qt.findChildOfType(e,"svg"),a=qt.findChildOfType(e,"border"),o=qt.findChildOfType(n,"background"),s=qt.findChildOfType(n,"itemgroup"),l=(qt.findChildOfType(n,"scrollbargroup"),0);l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);for(var u="true"==i[l],c=qt.childElements(s),h=0;h<c.length;h++)t.updateControlListItemLook(c[h],!1,!1);a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"text-array":qt.removeAllChildren(s),s.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var d=Zt.splitSkipEmpty(i[l],"\n"),p=0,f=0;for(h=0;h<d.length;h++){var m=qt.cloneElementWithId("list-item");qt.findChildOfType(m,"background").setAttribute("fill",o.getAttribute("fill")),(A=qt.findChildOfType(m,"text")).firstChild.textContent=d[h],e.hasAttribute("text-color")&&A.setAttribute("fill",e.getAttribute("text-color")),s.appendChild(m);var g=A.getBBox();p<g.width&&(p=g.width),f<g.height&&(f=g.height)}c=qt.childElements(s);var v=Math.max(p+4,Zt.getFloatAttribute(n,"width")),b=Math.max(20,1.35*f);e.setAttribute("item-height",b.toString());for(h=0;h<c.length;h++)this.setupControlListItem(c[h],b*h,v,b,f);t.updateControlListScrollbar(e);break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":e.setAttribute(r[l],i[l]);break;case"font-style":e.style.font=i[l];break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),n.hasAttribute("width")&&n.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[l],i[l]);break;case"value":var y=Zt.splitSkipEmpty(i[l],"\n");c=qt.childElements(s),e.setAttribute("last-clicked","0");for(h=0;h<c.length;h++){m=c[h];var A=qt.findChildOfType(m,"text"),T=y.indexOf(A.firstChild.textContent)>=0;m.setAttribute("selected",T),t.updateControlListItemLook(m,!1,!1),T&&e.setAttribute("last-clicked",h.toString())}break;default:Jd.filterAndSetAttribute(e,r[l],i[l])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=qt.findChildOfType(t,"svg"),i=qt.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var n=i*Zt.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[n.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled"))switch(e.type){case"mouseover":t.onGotFocus(r);break;case"mouseout":if(r.contains(e.relatedTarget))return;t.onLostFocus(r);break;case"wheel":e.altKey||e.ctrlKey||(e.stopPropagation(),e.preventDefault(),t.scrollControlList(r,e.deltaY<0?1:-1))}},t.onGotFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=qt.findChildOfType(e,"border"),i=qt.findChildOfType(e,"svg"),n=qt.findChildOfType(i,"itemgroup"),a=qt.findChildOfType(i,"scrollbargroup"),o=qt.childElements(n);if("control-border-hover"!=r.getAttribute("class")){r.setAttribute("class","control-border-hover"),a.setAttribute("class","control-opaque1");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!0,!1)}}},t.onLostFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=qt.findChildOfType(e,"border"),i=qt.findChildOfType(e,"svg"),n=qt.findChildOfType(i,"itemgroup"),a=qt.findChildOfType(i,"scrollbargroup"),o=qt.childElements(n);r.setAttribute("class","control-border"),a.setAttribute("class","control-opaque0");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!1,!1)}},t.scrollControlList=function(t,e){var r=qt.findChildOfType(t,"svg"),i=qt.findChildOfType(r,"itemgroup"),n=i.childElementCount;if(0!=n){var a=Zt.getFloatAttribute(r,"height"),o=Zt.getFloatAttribute(t,"item-height"),s=n*o,l=i.getAttribute("transform"),u=Zt.parseTranslateTransform(l)[1];u+=e*o,u=Math.max(-s+a,u),u=Math.min(u,0),u=Math.round(u),i.setAttribute("transform","translate(0,"+u+")");var c=qt.findChildOfType(r,"scrollbargroup"),h=qt.findChildOfType(c,"handle"),d=Zt.getFloatAttribute(h,"height"),p=(a/2-u)/s,f=Math.max(2,a*p-d/2);f=Math.min(a-d-2,f),h.setAttribute("y",f.toString())}},t.prototype.setupControlListItem=function(t,e,r,i,n){var a=this,o=qt.findChildOfType(t,"background"),s=qt.findChildOfType(t,"text");t.setAttribute("transform","translate(0,"+e+")"),Zt.setMultipleAttributes(o,["width","height"],[r,i]),Zt.setMultipleAttributes(s,["x","y"],[2,i/2+.3*n]);var l=function(t){return a.onControlListItemMouseEvent(t)};t.addEventListener("mouseover",l),t.addEventListener("mouseout",l),t.addEventListener("click",l)},t.prototype.onControlListItemMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode,n=i.parentNode.parentNode;if("false"!=n.getAttribute("enabled"))switch(e.type){case"mouseover":t.updateControlListItemLook(r,!0,!0);break;case"mouseout":t.updateControlListItemLook(r,!0,!1);break;case"click":e.stopPropagation(),e.preventDefault();var a="true"==n.getAttribute("multiple"),o=qt.childElements(i),s=Zt.indexInParent(r),l="true"==r.getAttribute("selected");if(a)if(e.ctrlKey)r.setAttribute("selected",String(!l)),t.updateControlListItemLook(r,!0,!0);else if(e.shiftKey){var u=Zt.getIntAttribute(n,"last-clicked");for(c=0;c<o.length;c++)l=u<=s?u<=c&&c<=s:s<=c&&c<=u,o[c].setAttribute("selected",l),t.updateControlListItemLook(o[c],!0,c==s)}else for(c=0;c<o.length;c++)o[c].setAttribute("selected",c==s),t.updateControlListItemLook(o[c],!0,c==s);else{l=!e.ctrlKey||!l;for(var c=0;c<o.length;c++)o[c].setAttribute("selected",c==s&&l),t.updateControlListItemLook(o[c],!0,c==s)}n.setAttribute("last-clicked",s.toString());var h="";for(c=0;c<o.length;c++){if("true"==o[c].getAttribute("selected"))h+=qt.findChildOfType(o[c],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(n,h)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,n=qt.findChildOfType(t,"background"),a=qt.findChildOfType(t,"text"),o="true"==i.getAttribute("enabled"),s="true"==t.getAttribute("selected");if(!o)return n.setAttribute("class",s?"control-background-selected-disabled":""),void a.setAttribute("class","control-text-disabled");e?(r?n.setAttribute("class",s?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):n.setAttribute("class",s?"control-list-background-selected-hover":""),a.setAttribute("class",s?"control-text-selected-hover":"")):(n.setAttribute("class",s?"control-list-background-selected":""),a.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=qt.findChildOfType(e,"svg"),i=qt.findChildOfType(r,"scrollbargroup"),n=qt.findChildOfType(i,"scrollbar"),a=qt.findChildOfType(i,"handle"),o=Zt.getFloatAttribute(r,"width"),s=Zt.getFloatAttribute(r,"height"),l=o-Zt.getFloatAttribute(n,"width");n.setAttribute("x",l.toString()),n.setAttribute("height",s.toString()),a.setAttribute("x",(l+2).toString()),a.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=qt.findChildOfType(t,"svg"),i=qt.findChildOfType(r,"scrollbargroup"),n=(qt.findChildOfType(i,"scrollbar"),qt.findChildOfType(i,"handle")),a=Zt.getFloatAttribute(r,"height"),o=qt.findChildOfType(r,"itemgroup").childElementCount,s=0;e=o>0&&a<(s=o*Zt.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e&&n.setAttribute("height",Math.max(a*(a/s)-4,7).toString())},t.onControlListScrollbarMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode.parentNode;if("false"!=i.getAttribute("enabled")){var n=qt.findChildOfType(r,"scrollbar"),a=Zt.getFloatAttribute(n,"height"),o=n.getBoundingClientRect().height/a,s=Zt.offsetPage(n),l=(e.pageY-s.top)/o,u=qt.findChildOfType(r,"handle"),c=Zt.getFloatAttribute(u,"y");switch(e.type){case"mouseout":case"mouseup":t.controlListScrollbarButtonDown=0;break;case"mousedown":1==e.which&&e.target==u&&(e.stopPropagation(),t.controlListScrollbarButtonDown=1,t.controlListScrollbarMousePos=l);break;case"mousemove":if(1==t.controlListScrollbarButtonDown){e.stopPropagation();var h=l-t.controlListScrollbarMousePos,d=qt.findChildOfType(i,"svg"),p=qt.findChildOfType(d,"itemgroup").childElementCount,f=Zt.getFloatAttribute(i,"item-height"),m=h*(p*f/a)/f;t.scrollControlList(i,-m),t.controlListScrollbarMousePos=l}break;case"click":if(e.stopPropagation(),e.preventDefault(),e.target==n){m=Math.floor(a/Zt.getFloatAttribute(i,"item-height"));t.scrollControlList(i,l<c?m:-m)}}}},t.controlListScrollbarButtonDown=0,t}(),Vd=function(){function t(t){this.frameDrawing=t,this.controlList=new Hd(t,this)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return Kt.createUnsupportedObject("File chooser is not supported in the Cloud mode");case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":t.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":Kt.updateUnsupportedObject(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=qt.cloneElementWithId("control-button");return new f(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var n=qt.findChildOfType(e,"background"),a=qt.findChildOfType(e,"text"),o=0;o<r.length;o++)switch(r[o]){case"enabled":e.setAttribute(r[o],i[o]);var s="true"==i[o];n.setAttribute("class",s?"control-background":"control-background-disabled"),a.setAttribute("class",s?"control-button-text":"control-text-disabled");break;case"text":a.firstChild.textContent=i[o];break;case"background-color":break;case"text-color":a.setAttribute("fill",i[o]);break;case"font-style":a.style.font=i[o],t.centerControlText(a,n,!0,!0);break;case"width":case"height":var l=parseFloat(i[o])-2;n.setAttribute(r[o],l.toString()),t.centerControlText(a,n,!0,!0);break;default:Jd.filterAndSetAttribute(e,r[o],i[o])}},t.onButtonOver=function(t){var e=qt.findChildOfType(t,"background"),r=qt.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=qt.findChildOfType(t,"background"),r=qt.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=qt.findChildOfType(t,"background"),r=qt.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.onControlAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=qt.cloneElementWithId("control-checkbox");return new f(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var n=qt.findChildOfType(e,"background"),a=qt.findChildOfType(e,"box"),o=qt.findChildOfType(e,"check"),s=qt.findChildOfType(e,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-checkbox-box":"control-checkbox-box-disabled"),o.setAttribute("class",u?"control-checkbox-check":"control-checkbox-check-disabled"),s.setAttribute("class",u?"":"control-text-disabled");break;case"text":s.firstChild.textContent=i[l];break;case"background-color":n.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":s.style.font=i[l],t.centerControlText(s,n,!1,!0);break;case"width":n.setAttribute(r[l],i[l]);break;case"height":n.setAttribute(r[l],i[l]);var c=parseFloat(i[l]);a.setAttribute("y",(c/2-8).toString()),o.setAttribute("transform","translate(0,"+(c/2-8)+")"),t.centerControlText(s,n,!1,!0);break;case"value":o.setAttribute("visibility","true"==i[l]?"inherit":"hidden");break;default:Jd.filterAndSetAttribute(e,r[l],i[l])}},t.onCheckboxOver=function(t){var e=qt.findChildOfType(t,"box"),r=qt.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=qt.findChildOfType(t,"box"),r=qt.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=qt.findChildOfType(t,"box"),r=qt.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=qt.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.onControlAction(t.id,r)},t.prototype.createSlider=function(){var t=this,e=qt.cloneElementWithId("control-slider"),r=function(e){return t.onSliderEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r),e},t.updateSlider=function(e,r,i){for(var n=qt.findChildOfType(e,"sensor"),a=qt.findChildOfType(e,"background"),o=qt.findChildOfType(e,"line"),s=qt.findChildOfType(e,"progress"),l=qt.findChildOfType(e,"handle"),u=(qt.findChildOfType(e,"value"),0);u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];o.setAttribute("class",c?"control-background":"control-background-disabled"),s.setAttribute("class",c?"control-slider-progress":"control-background-selected-disabled"),l.setAttribute("class",c?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":a.setAttribute("fill",i[u]);break;case"width":case"height":a.setAttribute(r[u],i[u]);break;case"vertical":e.setAttribute(r[u],i[u]);var h=Zt.getFloatAttribute(a,"width"),d=Zt.getFloatAttribute(a,"height");Zt.setMultipleAttributes(n,["x","y","width","height"],[String(-1e3),String(-1e3),String(h+2e3),String(d+2e3)]);var p=void 0,f=void 0,m=void 0,g=void 0,v=void 0,b=void 0,y=void 0,A=void 0,T=void 0,C=void 0;"false"==i[u]?(v=p=0,b=f=d/2-2,m=h,y=0,A=g=4,T=0,C=d/2):(v=p=h/2-2,f=0,b=d,y=m=4,g=d,A=0,T=h/2,C=d),Zt.setMultipleAttributes(o,["x","y","width","height"],[p,f,m,g]),Zt.setMultipleAttributes(s,["x","y","width","height"],[v,b,y,A]),Zt.setMultipleAttributes(l,["cx","cy"],[T,C]);break;case"value":var S=Zt.getFloatAttribute(e,"min"),E=Zt.getFloatAttribute(e,"max");h=Zt.getFloatAttribute(a,"width"),d=Zt.getFloatAttribute(a,"height");var w="true"==e.getAttribute("vertical")?d:h,k=(parseFloat(i[u])-S)/(E-S)*w;t.setSliderHandlePosition(e,k);break;default:Jd.filterAndSetAttribute(e,r[u],i[u])}},t.prototype.onSliderEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=qt.findChildOfType(r,"background"),n=qt.findChildOfType(r,"progress"),a=Zt.getFloatAttribute(i,"width"),o=Zt.getFloatAttribute(i,"height"),s=i.getBoundingClientRect(),l=s.width/a,u=s.height/o,c=Zt.offsetPage(i),h="true"==r.getAttribute("vertical");if(e.type.startsWith("mouse")||"wheel"==e.type){var d=e,p=(d.pageX-c.left)/l,f=(d.pageY-c.top)/u,m=h?o-f:p;switch(e.type){case"mouseover":e.stopPropagation(),t.onSliderOver(r);break;case"mouseout":if(r.contains(d.relatedTarget))return;1==t.sliderButtonDown&&(t.setSliderHandlePosition(r,m),this.confirmSliderValue(r)),t.sliderButtonDown=0,t.onSliderOut(r);break;case"mousedown":t.sliderButtonDown=d.which,1==t.sliderButtonDown&&(e.stopPropagation(),t.onSliderHandleGrabbed(r,m));break;case"mousemove":1==t.sliderButtonDown&&(e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m));break;case"mouseup":1==t.sliderButtonDown&&(e.stopPropagation(),this.onSliderHandleReleased(r)),t.sliderButtonDown=0;break;case"wheel":if(!d.altKey&&!d.ctrlKey){var g=e;e.stopPropagation(),e.preventDefault();var v=Zt.getFloatAttribute(n,h?"height":"width");t.setSliderHandlePosition(r,v+(g.deltaY<0?1:-1)),this.confirmSliderValue(r)}}}else if(e.type.startsWith("touch")){var b=e;if(b.touches.length>1)return void this.onSliderHandleReleased(r);var y="touchend"==e.type?b.changedTouches[0]:b.touches[0];p=void 0,f=void 0;p=(y.pageX-c.left)/l,f=(y.pageY-c.top)/u;m=h?o-f:p;switch(e.type){case"touchstart":e.stopPropagation(),t.onSliderOver(r),t.onSliderHandleGrabbed(r,m);break;case"touchmove":e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m);break;case"touchend":e.stopPropagation(),this.onSliderHandleReleased(r),t.onSliderOut(r)}}}},t.onSliderOver=function(e){var r=qt.findChildOfType(e,"line"),i=qt.findChildOfType(e,"progress"),n=qt.findChildOfType(e,"handle"),a=qt.findChildOfType(e,"value");r.setAttribute("class","control-slider-line-hover"),i.setAttribute("class","control-fill-color-transition"),n.setAttribute("class",1==t.sliderButtonDown?"control-slider-handle-pressed":"control-slider-handle-hover"),a.setAttribute("class","control-opaque1")},t.onSliderOut=function(t){var e=qt.findChildOfType(t,"sensor"),r=qt.findChildOfType(t,"line"),i=qt.findChildOfType(t,"progress"),n=qt.findChildOfType(t,"handle"),a=qt.findChildOfType(t,"value");e.setAttribute("visibility","hidden"),r.setAttribute("class","control-background"),i.setAttribute("class","control-slider-progress"),n.setAttribute("r","8"),n.setAttribute("class","control-slider-handle"),a.setAttribute("class","control-opaque0")},t.onSliderHandleGrabbed=function(e,r){var i=qt.findChildOfType(e,"sensor"),n=qt.findChildOfType(e,"handle");qt.bringElementToFront(e),n.setAttribute("r","7"),n.setAttribute("class","control-slider-handle-pressed"),i.setAttribute("visibility","inherit"),t.setSliderHandlePosition(e,r)},t.prototype.onSliderHandleReleased=function(t){var e=qt.findChildOfType(t,"sensor"),r=qt.findChildOfType(t,"handle");r.setAttribute("r","8"),r.setAttribute("class","control-slider-handle-hover"),e.setAttribute("visibility","hidden"),this.confirmSliderValue(t)},t.setSliderHandlePosition=function(t,e){var r=qt.findChildOfType(t,"background"),i=qt.findChildOfType(t,"progress"),n=qt.findChildOfType(t,"handle"),a=qt.findChildOfType(t,"value"),o=Zt.getFloatAttribute(r,"width"),s=Zt.getFloatAttribute(r,"height"),l="true"==t.getAttribute("vertical"),u=l?s:o;e=Math.min(u,Math.max(e,0));var c,h=Zt.getFloatAttribute(t,"min"),d=Zt.getFloatAttribute(t,"max"),p=Zt.getFloatAttribute(t,"step");c=p>0?h+Math.round(e/u*(d-h)/p)*p:h+e/u*(d-h),e=((c=Math.min(c,d))-h)/(d-h)*u,l?(i.setAttribute("y",(u-e).toString()),i.setAttribute("height",e.toString()),n.setAttribute("cy",(u-e).toString())):(i.setAttribute("width",e.toString()),n.setAttribute("cx",e.toString()));var f=a.firstElementChild,m=a.lastElementChild;m.firstChild.textContent=Zt.formatNumber(c,void 0);var g=m.getComputedTextLength()+10;f.setAttribute("width",g.toString()),f.setAttribute("x",(5-g).toString());var v=l?o/2-9:e-14,b=l?s-e-15-10:s/2-15-4;a.setAttribute("transform","translate("+v+","+b+")"),t.setAttribute("current-value",c)},t.prototype.confirmSliderValue=function(t){var e=Zt.getFloatAttribute(t,"current-value");e!=Zt.getFloatAttribute(t,"last-value")&&(this.frameDrawing.onControlAction(t.id,e),t.setAttribute("last-value",e.toString()))},t.createRadioButtonGroup=function(){return qt.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"enabled":e.setAttribute(r[a],i[a]);for(var o="true"==i[a],s=qt.childElements(e),l=0;l<s.length;l++){var u=s[l],c=qt.findChildOfType(u,"circle"),h=qt.findChildOfType(u,"check"),d=qt.findChildOfType(u,"text");c.setAttribute("class",o?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),h.setAttribute("class",o?"control-radiobutton-check":"control-text-disabled"),d.setAttribute("class",o?"":"control-text-disabled")}break;case"text-array":var p=i[a].split("\n"),m=function(r){var i=qt.cloneElementWithId("radio-button"),a=qt.findChildOfType(i,"background");e.hasAttribute("background-color")&&a.setAttribute("fill",e.getAttribute("background-color"));var o=qt.findChildOfType(i,"text");o.firstChild.textContent=p[r],e.hasAttribute("text-color")&&o.setAttribute("fill",e.getAttribute("text-color")),new f(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return n.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(l=0;l<p.length;l++)m(l);break;case"background-color":case"text-color":e.setAttribute(r[a],i[a]);break;case"font-style":e.style.font=i[a];break;case"width":case"height":e.setAttribute(r[a],i[a]);break;case"vertical":var g=Zt.getFloatAttribute(e,"width"),v=Zt.getFloatAttribute(e,"height"),b=0;s=qt.childElements(e);for(l=0;l<s.length;l++){u=s[l];var y=qt.findChildOfType(u,"background"),A=(d=qt.findChildOfType(u,"text")).getBBox();if("true"==i[a]){var T=Math.max(25,1.5*A.height);u.setAttribute("transform","translate(0,"+T*l+")"),Zt.setMultipleAttributes(y,["width","height"],[g,T])}else{var C=20+A.width+10;u.setAttribute("transform","translate("+b+",0)"),Zt.setMultipleAttributes(y,["width","height"],[C,v]),b+=C}t.centerRadioButton(u)}break;case"value":var S=parseInt(i[a]);s=qt.childElements(e);for(l=0;l<s.length;l++){u=s[l];(h=qt.findChildOfType(u,"check")).setAttribute("visibility",S==l?"inherit":"hidden")}break;default:Jd.filterAndSetAttribute(e,r[a],i[a])}},t.onRadioButtonOver=function(t){var e=qt.findChildOfType(t,"circle"),r=qt.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=qt.findChildOfType(t,"circle"),r=qt.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=qt.findChildOfType(t,"circle"),r=qt.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=qt.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=qt.childElements(r),n=0;n<i.length;n++){var a=i[n];qt.findChildOfType(a,"check").setAttribute("visibility",a==t?"inherit":"hidden"),a==t&&(e=n)}this.frameDrawing.onControlAction(r.id,e)}},t.centerRadioButton=function(e){var r=qt.findChildOfType(e,"background"),i=qt.findChildOfType(e,"circle"),n=qt.findChildOfType(e,"check"),a=qt.findChildOfType(e,"text"),o=Zt.getFloatAttribute(r,"height");i.setAttribute("cy",(o/2).toString()),n.setAttribute("cy",(o/2).toString()),t.centerControlText(a,r,!1,!0)},t.createListBox=function(){return Hd.createControlList(!1)},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var t=this,e=qt.cloneElementWithId("control-combobox"),r=function(e){return t.onComboBoxEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("click",r);var i=Hd.createControlList(!0);return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),e.appendChild(i),e},t.prototype.updateComboBox=function(e,r,i){for(var n=qt.findChildOfType(e,"svg"),a=qt.findChildOfType(e,"border"),o=qt.findChildOfType(e,"dropdown"),s=qt.findChildOfType(n,"background"),l=qt.findChildOfType(n,"text"),u=qt.findChildOfType(n,"arrowback"),c=qt.findChildOfType(n,"arrow"),h=0;h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var d="true"==i[h];l.setAttribute("class",d?"":"control-text-disabled"),a.setAttribute("class",d?"control-border":"control-border-disabled"),d||o.setAttribute("visibility","hidden"),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-array":var p=Zt.splitSkipEmpty(i[h],"\n"),f=p.length>0?p[0]:"";l.firstChild.textContent=f,this.controlList.updateControlList(o,[r[h]],[i[h]]),this.controlList.adjustControlListHeightToItems(o,5),this.controlList.updateControlList(o,["value"],[f]);break;case"background-color":s.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-color":l.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"font-style":e.style.font=i[h],t.centerControlText(l,s,!1,!0),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"width":case"height":var m=parseFloat(i[h]);if(n.setAttribute(r[h],i[h]),s.setAttribute(r[h],i[h]),a.setAttribute(r[h],i[h]),"width"==r[h])u.setAttribute("x",(m-20).toString()),this.controlList.updateControlList(o,[r[h]],[i[h]]);else{t.centerControlText(l,s,!1,!0),u.setAttribute("height",m.toString()),o.setAttribute("transform","translate(0,"+i[h]+")");var g=5*parseFloat(i[h]);this.controlList.updateControlList(o,["height"],[g.toString()])}if(n.hasAttribute("width")&&n.hasAttribute("height")){var v=Zt.getFloatAttribute(n,"width")-10,b=Zt.getFloatAttribute(n,"height")/2;c.setAttribute("transform","translate("+v+","+b+")")}break;case"editable":e.setAttribute(r[h],i[h]);break;case"value":l.firstChild.textContent=i[h],this.controlList.updateControlList(o,[r[h]],[i[h]]);break;default:Jd.filterAndSetAttribute(e,r[h],i[h])}},t.prototype.onComboBoxEvent=function(t){var e=t.currentTarget;if("false"!=e.getAttribute("enabled")){var r=qt.findChildOfType(e,"svg"),i=qt.findChildOfType(e,"border"),n=qt.findChildOfType(e,"dropdown"),a=qt.findChildOfType(r,"background"),o=qt.findChildOfType(r,"text"),s=qt.findChildOfType(r,"arrowback"),l=qt.findChildOfType(r,"arrow"),u="true"==e.getAttribute("editable");switch(t.type){case"mouseover":i.setAttribute("class","control-border-hover"),s.setAttribute("class","control-combobox-arrow-background-hover"),l.setAttribute("class","control-fill-color-transition");break;case"mouseout":if(e.contains(t.relatedTarget))return;i.setAttribute("class","control-border"),s.setAttribute("class","control-fill-transparent-transition"),l.setAttribute("class","control-fill-transparent-transition"),n.setAttribute("visibility","hidden");break;case"mousedown":1!=t.which||!u||t.target!=a&&t.target!=o||(t.stopPropagation(),this.displayTextInputForSVG(e,"left"));break;case"click":if(!u||t.target==s||t.target==l){t.stopPropagation(),t.preventDefault(),qt.bringElementToFront(e);var c="inherit"==n.getAttribute("visibility");n.setAttribute("visibility",c?"hidden":"inherit")}}}},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=qt.findChildOfType(t,"svg"),i=qt.findChildOfType(t,"dropdown"),n=qt.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var a=e.split("\n")[0];n.firstChild.textContent=a,this.frameDrawing.onControlAction(t.id,a)},t.prototype.createTextField=function(){var e=this,r=qt.cloneElementWithId("control-textfield");return new f(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r)},function(t){return e.onTextFieldDown(r)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var n=qt.findChildOfType(e,"svg"),a=qt.findChildOfType(e,"border"),o=qt.findChildOfType(n,"background"),s=qt.findChildOfType(n,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];s.setAttribute("class",u?"":"control-text-disabled"),a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":e.style.font=i[l],t.centerControlText(s,o,!1,!0);break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),"width"==r[l]&&s.setAttribute("x",(parseFloat(i[l])-2).toString()),t.centerControlText(s,o,!1,!0);break;case"value":s.firstChild.textContent=i[l];break;default:Jd.filterAndSetAttribute(e,r[l],i[l])}},t.onTextFieldOver=function(t){qt.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){qt.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t){this.displayTextInputForSVG(t,"right")},t.createProgressBar=function(){return qt.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var n=e.firstElementChild,a=qt.findChildOfType(n,"background"),o=qt.findChildOfType(n,"progress"),s=qt.findChildOfType(n,"text"),l=qt.findChildOfType(n,"border"),u=0;u<r.length;u++)switch(r[u]){case"background-color":a.setAttribute("fill",i[u]);break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":e.style.font=i[u],t.centerControlText(s,a,!1,!0);break;case"width":case"height":e.setAttribute(r[u],i[u]);break;case"vertical":var c="true"==i[u],h=e.getAttribute(c?"height":"width"),d=e.getAttribute(c?"width":"height");a.setAttribute("width",h),a.setAttribute("height",d),o.setAttribute("height",d),t.centerControlText(s,a,!0,!0),l.setAttribute("width",h),l.setAttribute("height",d),c&&n.setAttribute("transform","translate(0,"+h+") rotate(-90)");break;case"text":s.firstChild.textContent="null"==i[u]?"":i[u];break;case"value":var p=Zt.getFloatAttribute(a,"width");"null"==i[u]?(o.setAttribute("class","control-progressbar-indeterminate"),o.setAttribute("width",p.toString())):(o.setAttribute("class","control-slider-progress"),o.setAttribute("width",(parseFloat(i[u])*p).toString()));break;default:Jd.filterAndSetAttribute(e,r[u],i[u])}},t.prototype.displayTextInputForSVG=function(t,e){var r=this,i=qt.findChildOfType(t,"svg"),n=qt.findChildOfType(i,"text"),a=document.getElementById("text-input-for-svg-container");a.style.display="block";var o=i.getBoundingClientRect(),s=Zt.getFloatAttribute(i,"width"),l=Zt.getFloatAttribute(i,"height"),u=o.width/s,c=a.firstElementChild;c.style.left=o.left+"px",c.style.top=o.top+"px",c.style.width=s+"px",c.style.height=l+"px",c.style.transform="scale("+u+")",c.style.font=t.style.font,c.style.textAlign=e,c.value=n.firstChild.textContent,a.setAttribute("control-id",t.id);var h=function(t){return r.onTextInputForSVGEvent(t)};a.onmousedown=h,a.onwheel=h,a.onkeypress=h,a.ontouchstart=h,window.setTimeout(function(){c.focus(),c.select()},0)},t.prototype.onTextInputForSVGEvent=function(t){var e=t.currentTarget,r=e.firstElementChild,i=e.getAttribute("control-id"),n=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=r&&(n=!0);break;case"wheel":n=!0;break;case"keypress":"Enter"==t.code&&(n=!0)}n&&(e.style.display="none",this.onTextInputForSVGChanged(i,r.value))},t.prototype.onTextInputForSVGChanged=function(t,e){var r=document.getElementById(t),i=qt.findChildOfType(r,"svg");if(qt.findChildOfType(i,"text").firstChild.textContent=e,this.frameDrawing.onControlAction(t,e),"ControlComboBox"==r.getAttribute("type")){var n=qt.findChildOfType(r,"dropdown");this.controlList.updateControlList(n,["value"],[e])}},t.centerControlText=function(t,e,r,i){var n=Zt.getFloatAttribute(e,"width"),a=Zt.getFloatAttribute(e,"height"),o=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&a&&t.setAttribute("y",(1+a/2+.3*o.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.onControlAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t.sliderButtonDown=0,t}(),Yd=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){for(var e=qt.findChildOfType(t,"picture"),r=qt.findChildOfType(t,"pictureback"),i=qt.childElements(qt.findChildOfType(t,"legend")),n=i.length,a="true"==t.getAttribute("show-pdf"),o="true"==t.getAttribute("show-cdf"),s="true"==t.getAttribute("show-mean"),l=(Zt.getFloatAttribute(r,"x"),Zt.getFloatAttribute(r,"y")),u=(Zt.getFloatAttribute(r,"width"),Zt.getFloatAttribute(r,"height")),c=0;c<n;c++){var h=qt.createSvgElement("g");if(a){var d=qt.createSvgElement("g");h.appendChild(d)}if(o){var p=qt.createSvgElement("polyline");Zt.setMultipleAttributes(p,["fill","stroke-width","stroke"],["none",i[c].getAttribute("cdf-line-width"),i[c].getAttribute("cdf-color")]),h.appendChild(p)}if(s){var f=qt.createSvgElement("line");Zt.setMultipleAttributes(f,["stroke-width","stroke","y1","y2"],[i[c].getAttribute("cdf-line-width"),i[c].getAttribute("mean-color"),l.toString(),(l+u).toString()]),h.appendChild(f)}e.appendChild(h),Qd.addClickTapHandlerToChartItem(h)}},t.prototype.draw=function(t,e){for(var r=qt.findChildOfType(t,"pictureback"),i=qt.findChildOfType(t,"picture"),n=qt.findChildOfType(t,"grid"),a=qt.childElements(qt.findChildOfType(t,"legend")),o="true"==t.getAttribute("show-pdf"),s="true"==t.getAttribute("show-cdf"),l="true"==t.getAttribute("show-mean"),u=Zt.getFloatAttribute(t,"bar-width"),c=Zt.getFloatAttribute(r,"x"),h=Zt.getFloatAttribute(r,"y"),d=Zt.getFloatAttribute(r,"width"),p=Zt.getFloatAttribute(r,"height"),f=Zt.splitSkipEmpty(e," "),m=f.length,g=1/0,v=-1/0,b=1/0,y=-1/0,A=[],T=[],C=[],S=[],E=[],w=[],k=[],x=[],M=[],O=0;O<m;O++)if("empty"!=f[O]){f[O]=Zt.splitSkipEmpty(f[O],":"),A[O]="true"==f[O][0],T[O]="true"==f[O][1],C[O]=parseFloat(f[O][2]),S[O]=parseFloat(f[O][3]),E[O]=parseFloat(f[O][4]),w[O]=parseInt(f[O][5]),k[O]=parseInt(f[O][6]),x[O]=Zt.splitToFloats(f[O][7],"|");for(var I=0;I<x[O].length;I++)x[O][I]<b&&(b=x[O][I]),y<x[O][I]&&(y=x[O][I]);A[O]&&(M[O]=Zt.splitToFloats(f[O][8],"|")),C[O]<g&&(g=C[O]),v<S[O]&&(v=S[O])}g==1/0&&(g=0,v=0),b==1/0&&(b=0,y=1),this.chartScaleAndGrid.recalcChartScale(t,g,v,!1,!1),this.chartScaleAndGrid.recalcChartScale(t,0,y,!0,!1);var _=Zt.getFloatAttribute(n,"min-x"),L=Zt.getFloatAttribute(n,"max-x"),P=Zt.getFloatAttribute(n,"min-y"),R=Zt.getFloatAttribute(n,"max-y"),D=d/(L-_),F=p/(R-P),N=qt.childElements(i);for(O=0;O<m;O++)if("empty"!=f[O]){"hidden"==N[O].getAttribute("visibility")&&N[O].setAttribute("visibility","inherit");var B=x[O].length,G=(S[O]-C[O])/B,U=a[O].getAttribute("original-color"),z=void 0,W=void 0;if(T[O]&&(z=a[O].getAttribute("low-color"),W=a[O].getAttribute("high-color")),o){var H=N[O].firstElementChild,V=u*G*D,Y=G*(1-u)/2;for(I=0;I<B;I++){var j=c+(C[O]+I*G+Y-_)*D,X=h+(R-x[O][I])*F,q=x[O][I]*F,Z=qt.childElements(H)[I];Z?Z.setAttribute("visibility","inherit"):(Z=qt.createSvgElement("rect"),H.appendChild(Z)),Zt.setMultipleAttributes(Z,["x","y","width","height"],[Zt.reducePrecision(j),Zt.reducePrecision(X),Zt.reducePrecision(V),Zt.reducePrecision(q)]),A[O]&&T[O]&&I<w[O]?Z.setAttribute("fill",z):A[O]&&T[O]&&k[O]<I?Z.setAttribute("fill",W):Z.setAttribute("fill",U)}var K=qt.childElements(H);for(I=B;I<K.length;I++)K[I].setAttribute("visibility","hidden")}if(s){var Q=o?N[O].firstElementChild.nextElementSibling:N[O].firstElementChild,J="";if(J+=c+(C[O]-_)*D+" "+(h+p)+" ",A[O])for(I=0;I<B;I++){J+=Zt.reducePrecision(c+(C[O]+(I+1)*G-_)*D)+","+Zt.reducePrecision(h+(1-M[O][I])*p)+" "}Q.setAttribute("points",J)}if(l){var $=N[O].lastElementChild,tt=c+(E[O]-_)*D;$.setAttribute("x1",tt),$.setAttribute("x2",tt)}if("NONE"!=t.getAttribute("leg-pos")){var et=qt.findChildOfType(a[O],"value");et.firstChild.textContent=Zt.formatNumber(E[O],void 0),et.setAttribute("fill",a[O].getAttribute("mean-color"))}}else N[O].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&Qd.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var n=qt.findChildOfType(t,"picture"),a=qt.childElements(n),o=qt.childElements(a[e]),s=0;s<o.length;s++)o[s].setAttribute("visibility",r?"hidden":"inherit")},t}(),jd=function(){function t(t){this.frameDrawing=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",n=t.getAttribute("scale-type-"+i),a=qt.findChildOfType(t,"grid"),o=qt.findChildOfType(t,"pictureback"),s=qt.findChildOfType(t,e?"pictureborderh":"pictureborderw"),l=a.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=l){var u=Zt.getFloatAttribute(o,"x"),c=Zt.getFloatAttribute(o,"y"),h=Zt.getFloatAttribute(o,"width"),d=Zt.getFloatAttribute(o,"height"),p="GRID_DEFAULT"==l,f="ChartBar"==r||"ChartStack"==r,m=t.getAttribute("bar-dir");e?f&&(!f||"NORTH"!=m&&"SOUTH"!=m)||Zt.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c,u,c+d]:[u+h,c,u+h,c+d]):f&&(!f||"EAST"!=m&&"WEST"!=m)||Zt.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c+d,u+h,c+d]:[u,c,u+h,c])}var g=a.getAttribute("grid-line-color");switch(a.setAttribute("grid-line-color",Zt.increaseTransparency(g,.5)),n){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var v=Zt.getFloatAttribute(t,"scale-min-"+i),b=Zt.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(v="ChartStack"==r?0:Math.min(0,v),b=Math.max(0,b)),this.recalcChartScale(t,v,b,e,!0);break;case"SCALE_TIME_WINDOW":b=Math.max(0,Zt.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,b,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,n){var a=qt.findChildOfType(t,"grid"),o=i?"min-y":"min-x",s=i?"max-y":"max-x";if(e!=Zt.getFloatAttribute(a,o)||r!=Zt.getFloatAttribute(a,s)){var l=e,u=r;if(l==u){if(n)return;l-=1,u+=1}var c=qt.findChildOfType(t,"pictureback"),h=Zt.getFloatAttribute(c,i?"height":"width"),d=i?25:45,p=(u-l)/Math.floor(h/d),f=Math.pow(10,Math.ceil(Math.log(u-l)/Math.log(10))-1),m=f/5;m<p&&(m=f/2)<p&&(m=f)<p&&(m=2*f)<p&&(m=5*f),n?(l=Math.ceil(l/m)*m,u=Math.floor(u/m)*m):(l=Math.floor(l/m)*m,u=Math.ceil(u/m)*m);var g=n?e:l,v=n?r:u;Zt.setMultipleAttributes(a,[o,s],[g,v]),this.drawChartGrid(t,l,u,m,g,v,i)}},t.prototype.drawChartGrid=function(t,e,r,i,n,a,o){var s=t.getAttribute("type"),l=qt.findChildOfType(t,"grid"),u=l.getAttribute(o?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=u){var c=o?l.lastElementChild:l.firstElementChild,h=qt.findChildOfType(t,"pictureback"),d=l.getAttribute("grid-text-color"),p=l.getAttribute("grid-line-color"),f=o?"scale-type-y":"scale-type-x",m="SCALE_100_PERCENT"==t.getAttribute(f),g="SCALE_TIME_WINDOW"==t.getAttribute(f)?t.getAttribute("date-format-pattern"):"null",v=Math.round((r-e)/i)+1,b="GRID_DEFAULT"==u,y=!0;if("ChartBar"==s||"ChartStack"==s){var A=t.getAttribute("bar-dir");"SOUTH"!=A&&"WEST"!=A||(y=!1)}for(var T=Zt.getFloatAttribute(h,"x"),C=Zt.getFloatAttribute(h,"y"),S=Zt.getFloatAttribute(h,"width"),E=Zt.getFloatAttribute(h,"height"),w=a-n,k=(o?E:S)/w,x=i*k;c.childElementCount<v;){var M=qt.cloneElementWithId("grid-item");c.appendChild(M)}for(var O=qt.childElements(c),I=e,_=o?y?C+(a-e)*k:C+(e-n)*k:y?T+(e-n)*k:T+(a-e)*k,L=0;L<v;L++){var P=o?b?T-4:T:_,R=o?_:b?C+E+4:C+E,D=o?b?T+S:T+S+4:_,F=o?_:b?C:C-4,N=o?b?P-3:D+3:P,B=o?R+3:b?R+11:F-3,G=o?b?"end":"start":"middle";(M=O[L]).setAttribute("visibility","inherit");var U=M.lastElementChild;Zt.setMultipleAttributes(U,["x1","x2","y1","y2","stroke"],[P,D,R,F,p]);var z=M.firstElementChild;Zt.setMultipleAttributes(z,["x","y","text-anchor","fill"],[N,B,G,d]);var W=void 0;W=m?Zt.formatPercent(I):"null"!=g?this.gridFormattedDate(I,w,g):Zt.formatNumber(I,void 0),z.firstChild.textContent=W,I+=i,_+=o?y?-x:+x:y?+x:-x}for(L=v;L<O.length;L++)O[L].setAttribute("visibility","hidden")}},t.prototype.gridFormattedDate=function(t,e,r){var i=Zt.toDate(this.frameDrawing,t),n=Zt.toMilliseconds(this.frameDrawing,e);return n>5*Zt.YEAR?Zt.formatDate(i,"YYYY"):n>5*Zt.MONTH?Zt.formatDate(i,"MMMYYYY"):n>5*Zt.DAY?Zt.formatDate(i,"DDMMM"):n>5*Zt.HOUR?Zt.formatDate(i,"DDMMHH"):n>5*Zt.MINUTE?Zt.formatDate(i,"HHmm"):Zt.formatDate(i,"mmss")},t}(),Xd=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e,r,i=t.getAttribute("type"),n=qt.findChildOfType(t,"pictureback"),a=qt.findChildOfType(t,"picture"),o=qt.childElements(qt.findChildOfType(t,"legend")),s=o.length,l=Zt.getFloatAttribute(n,"x"),u=Zt.getFloatAttribute(n,"y"),c=Zt.getFloatAttribute(n,"width"),h=Zt.getFloatAttribute(n,"height");if("ChartBar"==i||"ChartStack"==i){var d=t.getAttribute("bar-dir");e="NORTH"==d||"SOUTH"==d;var p=Zt.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?c/s:h/s)*p:(e?c:h)*p}for(var f=0;f<s;f++){var m=void 0,g=o[f].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(m=qt.createSvgElement("rect")).setAttribute("stroke","none"),m.setAttribute("fill",g);var v=void 0;e?(v=c/s,m.setAttribute("x","ChartBar"==i?l+v*f+(v-r)/2:l+(c-r)/2),m.setAttribute("width",r)):(v=h/s,m.setAttribute("y","ChartBar"==i?u+v*f+(v-r)/2:u+(h-r)/2),m.setAttribute("height",r)),a.appendChild(m);break;case"ChartPie":(m=qt.createSvgElement("path")).setAttribute("stroke","none"),m.setAttribute("fill",g),a.appendChild(m)}Qd.addClickTapHandlerToChartItem(m)}},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=qt.findChildOfType(t,"pictureback"),n=qt.findChildOfType(t,"picture"),a=qt.childElements(n),o=qt.findChildOfType(t,"grid"),s=Zt.getFloatAttribute(i,"x"),l=Zt.getFloatAttribute(i,"y"),u=Zt.getFloatAttribute(i,"width"),c=Zt.getFloatAttribute(i,"height"),h=Zt.splitSkipEmpty(e," "),d=h.length,p=1/0,f=-1/0,m=!1,g=0,v=0;v<d;v++)h[v]=parseFloat(h[v]),h[v]<p&&(p=h[v]),f<h[v]&&(f=h[v]),h[v]<0&&(m=!0),g+=h[v];var b=!1;if("ChartBar"==r||"ChartStack"==r){var y=t.getAttribute("bar-dir"),A="NORTH"==y||"SOUTH"==y;"ChartBar"==r?(p=Math.min(0,p),f=Math.max(0,f)):(p=0,f=Math.max(0,g));var T=t.getAttribute(A?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=T&&"SCALE_AUTO_FROM_0"!=T||this.chartScaleAndGrid.recalcChartScale(t,p,f,A,!1),b="SCALE_100_PERCENT"==T;var C=Zt.getFloatAttribute(o,A?"min-y":"min-x"),S=Zt.getFloatAttribute(o,A?"max-y":"max-x"),E=(A?c:u)/(S-C),w=0;for(v=0;v<d;v++)if("ChartStack"==r&&(m||0==g)||"ChartBar"==r&&b&&(m||0==g))a[v].setAttribute(A?"height":"width",0);else{var k=b?h[v]/g:h[v],x=Math.abs(k),M=void 0;if("ChartBar"==r)switch(y){case"NORTH":case"WEST":M=k>0?S-k:S;break;case"SOUTH":case"EAST":M=k<0?k-C:-C}else{switch(y){case"NORTH":case"WEST":M=S-(k+w);break;case"SOUTH":case"EAST":M=-C+w}w+=k}x*=E;var O=A?c:u;(M*=E)<0?(x-=-M,M=0):M+x>O&&(x-=M+x-O),x<0&&(x=0),A?(a[v].setAttribute("y",l+M),a[v].setAttribute("height",x)):(a[v].setAttribute("x",s+M),a[v].setAttribute("width",x))}}else{var I=-Math.PI/2;for(v=0;v<d;v++){var _=g<=0||m?0:2*Math.PI*(h[v]/g),L=u/2,P=c/2,R=Zt.sectorData(s+L,l+P,L,P,I,_);a[v].setAttribute("d",R),I+=_}}if(("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&b)&&m?Qd.showChartWarning(t,"Neg!"):Qd.hideChartWarning(t),"NONE"!=t.getAttribute("leg-pos")){var D=qt.childElements(qt.findChildOfType(t,"legend"));for(v=0;v<d;v++){var F=qt.findChildOfType(D[v],"value"),N=Zt.formatNumber(h[v],void 0);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&b)&&g>0&&!m&&(N+=" ("+Zt.formatPercent(h[v]/g)+")"),F.firstChild.textContent=N,F.setAttribute("fill",h[v]>=0?"royalBlue":"fireBrick")}Qd.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){qt.childElements(qt.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t}(),qd=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(e){for(var r=e.getAttribute("type"),i=qt.findChildOfType(e,"picture"),n=qt.childElements(qt.findChildOfType(e,"legend")),a=n.length,o=0;o<a;o++){var s=n[o].getAttribute("original-color"),l=qt.createSvgElement("g");switch(n[o].setAttribute("data","empty"),r){case"ChartPlot":case"ChartTimePlot":if("true"==n[o].getAttribute("draw-line")){var u=qt.createSvgElement("polyline");if(u.setAttribute("fill","none"),u.setAttribute("stroke",s),u.setAttribute("stroke-width",n[o].getAttribute("line-width")),l.appendChild(u),"ChartTimePlot"==r){var c=qt.createSvgElement("polyline");c.setAttribute("stroke","none"),c.setAttribute("fill",Zt.increaseTransparency(s,t.timePlotAlpha)),l.appendChild(c)}}if("POINT_NONE"!=n[o].getAttribute("point-style")){var h=qt.createSvgElement("g");h.setAttribute("fill",s),l.appendChild(h)}break;case"ChartTimeStack":var d=qt.createSvgElement("polyline");d.setAttribute("stroke-width","1"),d.setAttribute("stroke",s),d.setAttribute("fill","none"),l.appendChild(d);var p=qt.createSvgElement("polyline");p.setAttribute("stroke","none"),p.setAttribute("fill",Zt.increaseTransparency(s,t.stackChartAlpha)),l.appendChild(p)}i.appendChild(l),Qd.addClickTapHandlerToChartItem(l)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),n=qt.findChildOfType(e,"pictureback"),a=qt.findChildOfType(e,"picture"),o=qt.findChildOfType(e,"grid"),s=qt.childElements(qt.findChildOfType(e,"legend")),l=Zt.getFloatAttribute(n,"x"),u=Zt.getFloatAttribute(n,"y"),c=Zt.getFloatAttribute(n,"width"),h=Zt.getFloatAttribute(n,"height"),d=u+h,p=t.mergeData(e,r),f=p.length,m=t.parseDataAndFindMinMax(p),g=m.datasets,v=m.minx,b=m.maxx,y=m.miny,A=m.maxy;if("ChartTimeStack"==i&&y<0)Qd.showChartWarning(e,"Neg!");else{Qd.hideChartWarning(e),"ChartTimeStack"==i&&(y=0,A=t.prepareChartTimeStackData(g));var T,C=e.getAttribute("scale-type-x"),S=e.getAttribute("scale-type-y"),E="SCALE_100_PERCENT"==S;if("SCALE_AUTO"==C)this.chartScaleAndGrid.recalcChartScale(e,v,b,!1,!1);else if("SCALE_TIME_WINDOW"==C){T=Zt.getFloatAttribute(e,"scale-max-x");var w=void 0;w="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(b,T):Math.max(b,T,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,w-T,w,!1,!0)}"SCALE_AUTO"==S&&this.chartScaleAndGrid.recalcChartScale(e,y,A,!0,!1);for(var k=Zt.getFloatAttribute(o,"min-x"),x=Zt.getFloatAttribute(o,"max-x"),M=Zt.getFloatAttribute(o,"min-y"),O=Zt.getFloatAttribute(o,"max-y"),I=c/(x-k),_=h/(O-M),L=qt.childElements(a),P="",R=0;R<f;R++){var D=void 0,F=void 0,N=void 0,B=void 0,G=void 0,U=void 0,z=void 0,W=void 0,H=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(D="true"==s[R].getAttribute("draw-line"),F=s[R].getAttribute("point-style"),N="INTERPOLATION_STEP"==s[R].getAttribute("interpolation")),(D||"ChartTimeStack"==i)&&(G=(B=L[R].firstElementChild).nextElementSibling),F&&"POINT_NONE"!=F)switch(U=L[R].lastElementChild,F){case"POINT_CIRCLE":z="plot-point-circle",W=0,H=0;break;case"POINT_SQUARE":z="plot-point-square",W=-1.5,H=-1.5;break;case"POINT_TRIANGLE":z="plot-point-triangle",W=0,H=0}for(var V=void 0,Y=void 0,j="",X="",q=void 0,Z=void 0,K=0,Q=0;Q<g[R].length;Q++){var J=l+(g[R][Q][0]-k)*I,$=void 0;if(E){var tt=g[f-1][Q][1];$=tt<=0?0:g[R][Q][1]/tt}else $=g[R][Q][1];var et=u+(-$+O)*_;if(J<l&&(J=l),l+c<J&&(J=l+c),et<u&&(et=u),u+h<et&&(et=u+h),!(null!=V&&Math.abs(J-V)<Qd.chartTolerance&&Math.abs(et-Y)<Qd.chartTolerance)){if(J=Zt.reducePrecision(J),et=Zt.reducePrecision(et),0==Q&&(q=J),Z=J,B&&(N&&null!=V&&(j+=J+","+Y+" "),j+=J+","+et+" ",G&&(0==R&&(P=J+","+d+" "+P),X=J+","+et+" "+X)),U){var rt=qt.childElements(U)[K];rt?rt.setAttribute("visibility","inherit"):(rt=qt.createUseElement(z),U.appendChild(rt)),rt.setAttribute("x",W+J),rt.setAttribute("y",H+et)}K++,V=J,Y=et}}if(B&&(B.setAttribute("points",j),G))if("ChartTimePlot"==i){var it="";if(""!=j){var nt=u+O*_;nt<u&&(nt=u),u+h<nt&&(nt=u+h),it=Z+","+nt+" "+q+","+nt}G.setAttribute("points",j+it)}else G.setAttribute("points",j+P),P=X;if(U){var at=qt.childElements(U);for(Q=K;Q<at.length;Q++)at[Q].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,n){var a=e.getAttribute("type"),o=qt.childElements(qt.findChildOfType(e,"legend")),s=qt.childElements(qt.findChildOfType(e,"picture"));if("ChartTimeStack"==a)s[r].firstElementChild.setAttribute("stroke",n),s[r].lastElementChild.setAttribute("fill",Zt.increaseTransparency(n,t.stackChartAlpha));else{if("true"==o[r].getAttribute("draw-line")){var l=s[r].firstElementChild;l.setAttribute("stroke",n),"ChartTimePlot"==a&&l.nextElementSibling.setAttribute("fill",Zt.increaseTransparency(n,t.timePlotAlpha))}"POINT_NONE"!=o[r].getAttribute("point-style")&&s[r].lastElementChild.setAttribute("fill",n)}},t.mergeData=function(e,r){for(var i=qt.childElements(qt.findChildOfType(e,"legend")),n=Zt.splitSkipEmpty(r," "),a=n.length,o=[],s=0;s<a;s++){var l=i[s].getAttribute("data"),u=t.mergeDataset(l,n[s]);i[s].setAttribute("data",u),o.push(u)}return o},t.mergeDataset=function(t,e){var r=Zt.splitSkipEmpty(e,"#"),i=parseInt(r[0]),n=parseInt(r[1]),a=r[2];if("empty"==t||0==n)return a;var o=Zt.splitSkipEmpty(t,"|");o.splice(0,i),o.splice(n);var s=o.join("|")+"|";return"empty"==a?s:s+a},t.parseDataAndFindMinMax=function(t){for(var e=t,r=e.length,i=1/0,n=-1/0,a=1/0,o=-1/0,s=0;s<r;s++)if("empty"==e[s])e[s]=[];else{e[s]=Zt.splitSkipEmpty(e[s],"|");for(var l=0;l<e[s].length;l++){e[s][l]=e[s][l].split(":");var u=e[s][l][0]=parseFloat(e[s][l][0]),c=e[s][l][1]=parseFloat(e[s][l][1]);u<i&&(i=u),n<u&&(n=u),c<a&&(a=c),o<c&&(o=c)}}return i==1/0&&(i=0,n=0),a==1/0&&(a=0,o=0),{datasets:e,minx:i,maxx:n,miny:a,maxy:o}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a].length<=i||t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),Zd=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=qt.findChildOfType(t,"picture"),r=qt.findChildOfType(t,"pictureback"),i=Zt.getFloatAttribute(r,"x"),n=Zt.getFloatAttribute(r,"y"),a=Zt.getFloatAttribute(r,"width"),o=Zt.getFloatAttribute(r,"height"),s=qt.cloneElementWithId("normal-text");s.setAttribute("fill","grey"),s.setAttribute("text-anchor","middle"),s.setAttribute("x",(i+a/2).toString()),s.setAttribute("y",(n+o/2+3).toString()),s.firstChild.textContent="Not supported at the moment",e.appendChild(s)},t.draw=function(t,e){},t.setItemLook=function(t,e,r,i){},t}(),Kd=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=qt.findChildOfType(t,"picture"),r=qt.findChildOfType(t,"pictureback"),i=Zt.getFloatAttribute(r,"x"),n=Zt.getFloatAttribute(r,"y"),a=Zt.getFloatAttribute(r,"height"),o=qt.childElements(qt.findChildOfType(t,"legend")),s=o.length,l=a/s,u=l*Zt.getFloatAttribute(t,"bar-width"),c=(l-u)/2;t.setAttribute("rect-height",Zt.reducePrecision(u).toString());for(var h=0;h<s;h++){o[h].setAttribute("data","empty");var d=qt.createSvgElement("g");d.setAttribute("transform","translate("+i+","+(n+h*l+c)+")"),e.appendChild(d),Qd.addClickTapHandlerToChartItem(d)}},t.prototype.draw=function(e,r){for(var i=qt.findChildOfType(e,"pictureback"),n=qt.findChildOfType(e,"picture"),a=qt.findChildOfType(e,"grid"),o=(Zt.getFloatAttribute(i,"x"),Zt.getFloatAttribute(i,"width")),s=qd.mergeData(e,r),l=s.length,u=-1/0,c=0;c<l;c++)if("empty"==s[c])s[c]=[];else{s[c]=Zt.splitSkipEmpty(s[c],"|");for(var h=0;h<s[c].length;h++)s[c][h]=s[c][h].split(":"),s[c][h][0]=parseFloat(s[c][h][0]),s[c][h][1]=parseFloat(s[c][h][1]);var d=s[c][s[c].length-1][0];u<d&&(u=d)}u==1/0&&(u=0);for(c=0;c<l;c++)0!=s[c].length&&s[c][s[c].length-1][0]<u&&s[c].push([u,s[c][s[c].length-1][1]]);var p,f=Zt.getFloatAttribute(e,"scale-max-x");p="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(u,f):Math.max(u,f,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,p-f,p,!1,!0);var m=Zt.getFloatAttribute(a,"min-x"),g=o/(Zt.getFloatAttribute(a,"max-x")-m),v=qt.childElements(n),b=Zt.getFloatAttribute(e,"rect-height"),y=t.colorMapping(e);for(c=0;c<l;c++){var A=v[c],T=qt.childElements(A),C=T.length,S=0,E="",w=null;for(h=0;h<s[c].length;h++){var k=s[c][h][0],x=s[c][h][1];if(k<m)w=0,E=y(x);else if(null==w)w=(k-m)*g,E=y(x);else{var M=y(x);if(M!=E||h==s[c].length-1){var O=(k-m)*g,I=void 0;S<C?(I=T[S],S++,I.setAttribute("visibility","inherit")):(I=qt.createSvgElement("rect"),A.appendChild(I)),Zt.setMultipleAttributes(I,["x","width","height","fill"],[Zt.reducePrecision(w),Zt.reducePrecision(O-w),b,E]),w=O,E=M}}}for(var _=S;_<C;_++)T[_].setAttribute("visibility","hidden")}},t.colorMapping=function(t){var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color");e=Zt.splitSkipEmpty(e," ");for(var i=[],n=[],a=function(t){var r=e[t].split(":"),a=void 0,o=parseFloat(r[1]);switch(r[0]){case"GREATER":a=function(t){return t>o};break;case"GREATER_OR_EQUALS":a=function(t){return t>=o};break;case"LESS":a=function(t){return t<o};break;case"LESS_OR_EQUALS":a=function(t){return t<=o};break;case"EQUALS":a=function(t){return t==o};break;case"NOT_EQUALS":a=function(t){return t!=o}}i[t]=a,n[t]=r[2]},o=0;o<e.length;o++)a(o);return function(t){for(var e=0;e<i.length;e++)if(i[e](t))return n[e];return r}},t.setItemLook=function(t,e,r,i){var n=qt.findChildOfType(t,"picture");qt.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),Qd=function(){function t(t){this.frameDrawing=t,this.chartScaleAndGrid=new jd(t),this.chart1D=new Xd(t,this.chartScaleAndGrid),this.chart2D=new qd(t,this.chartScaleAndGrid),this.chartHistogram=new Yd(t,this.chartScaleAndGrid),this.chartHistogram2D=new Zd(t,this.chartScaleAndGrid),this.chartTimeColor=new Kd(t,this.chartScaleAndGrid)}return t.create=function(){return qt.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var n=e.getAttribute("type"),a=qt.findChildOfType(e,"background"),o=qt.findChildOfType(e,"pictureback"),s=qt.findChildOfType(e,"pictureselect"),l=qt.findChildOfType(e,"pictureborderh"),u=qt.findChildOfType(e,"pictureborderw"),c=qt.findChildOfType(e,"grid"),h=0;h<r.length;h++)switch(r[h]){case"width":case"height":case"fill":case"stroke":a.setAttribute(r[h],i[h]);break;case"pic-width":case"pic-height":o.setAttribute(r[h].substring(4),i[h]),s.setAttribute(r[h].substring(4),i[h]);break;case"pic-fill":o.setAttribute(r[h].substring(4),i[h]);break;case"pic-stroke":l.setAttribute(r[h].substring(4),i[h]),u.setAttribute(r[h].substring(4),i[h]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":c.setAttribute(r[h],i[h]);break;case"grid-completed":"ChartPie"!=n&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":t.addItem(e,i[h]);break;case"items-completed":t.setupLegendItemsLayout(e),t.setupPicture(e);break;case"data":this.drawPicture(e,i[h]);break;default:Jd.filterAndSetAttribute(e,r[h],i[h])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=qt.findChildOfType(e,"background"),n=qt.findChildOfType(e,"pictureback"),a=qt.findChildOfType(e,"pictureselect"),o=qt.findChildOfType(e,"pictureborderh"),s=qt.findChildOfType(e,"pictureborderw"),l=qt.findChildOfType(e,"warning"),u=qt.findChildOfType(e,"legend"),c=e.getAttribute("leg-pos"),h=Zt.getFloatAttribute(i,"width"),d=Zt.getFloatAttribute(i,"height"),p=Zt.getFloatAttribute(e,"pic-offset-x"),f=Zt.getFloatAttribute(e,"pic-offset-y"),m=Zt.getFloatAttribute(n,"width"),g=Zt.getFloatAttribute(n,"height"),v=Zt.getFloatAttribute(e,"leg-size"),b=0,y=0,A=0,T=0;switch(c){case"SOUTH":b=p,y=d-v,A=h-p,T=v;break;case"WEST":p+=v,b=0,y=f,A=v,T=d-f;break;case"EAST":b=h-v,y=f,A=v,T=d-f;break;case"NORTH":f+=v,b=p,y=0,A=h-p,T=v}if(Zt.setMultipleAttributes(n,["x","y"],[p,f]),Zt.setMultipleAttributes(a,["x","y"],[p,f]),Zt.setMultipleAttributes(l,["x","y"],[p+m/2,f+g/2+3]),"NONE"==c?u.setAttribute("visibility","hidden"):(u.setAttribute("transform","translate("+b+","+y+")"),Zt.setMultipleAttributes(u,["width","height"],[A,T])),"ChartPie"==r){var C=m/2,S=g/2,E=qt.createSvgElement("ellipse");Zt.setMultipleAttributes(E,["cx","cy","rx","ry","stroke","fill","visibility"],[p+C,f+S,C,S,"none",n.getAttribute("fill"),"hidden"]),e.insertBefore(E,n);var w=qt.createSvgElement("ellipse");Zt.setMultipleAttributes(w,["cx","cy","rx","ry","stroke","fill"],[p+C,f+S,C,S,o.getAttribute("stroke"),"none"]),e.insertBefore(w,o),qt.removeElement(e,o),qt.removeElement(e,s)}e.onmouseover=function(e){return t.selectChart(e,!0)},e.onmouseout=function(e){return t.selectChart(e,!1)}},t.setupLegendItemsLayout=function(t){for(var e=qt.findChildOfType(t,"legend"),r=qt.childElements(e),i=Zt.getFloatAttribute(e,"width"),n=0,a=0,o=0;o<r.length;o++){var s=r[o],l=qt.findChildOfType(s,"back"),u=Zt.getFloatAttribute(l,"width"),c=qt.findChildOfType(s,"value"),h=c.getComputedTextLength(),d=Math.max(u,Zt.getFloatAttribute(c,"x")+h);l.setAttribute("width",d.toString()),0<n&&i<n+d&&(n=0,a+=20),s.setAttribute("transform","translate("+n+","+a+")"),n+=d+5}},t.showChartWarning=function(t,e){var r=qt.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=qt.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=qt.findChildOfType(t,"picture"),r=qt.findChildOfType(t,"legend");qt.removeAllChildren(r),qt.removeAllChildren(e)},t.addItem=function(e,r){var i=e.getAttribute("type"),n=qt.findChildOfType(e,"legend"),a=r.split("\n"),o=a[0],s=a[1],l=qt.cloneElementWithId("legend-item"),u=qt.findChildOfType(l,"color"),c=qt.findChildOfType(l,"name"),h=qt.findChildOfType(l,"value");u.setAttribute("fill",o),l.setAttribute("original-color",o),c.setAttribute("fill",e.getAttribute("leg-text-color")),c.appendChild(qt.createTextNode(s)),h.appendChild(qt.createTextNode("")),n.appendChild(l);var d=c.getComputedTextLength();h.setAttribute("x",(Zt.getFloatAttribute(c,"x")+d+4).toString()),"ChartPlot"==i||"ChartTimePlot"==i?Zt.setMultipleAttributes(l,["draw-line","line-width","interpolation","point-style"],[a[2],a[3],a[4],a[5]]):"ChartHistogram"==i&&Zt.setMultipleAttributes(l,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[a[2],a[3],a[4],a[5],a[6]]),t.addClickTapHandlerToChartItem(l)},t.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":Xd.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":qd.setup(t);break;case"ChartTimeColor":Kd.setup(t);break;case"ChartHistogram":Yd.setup(t);break;case"ChartHistogram2D":Zd.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":Zd.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.selectChart=function(t,e){var r=t.currentTarget;qt.findChildOfType(r,"pictureselect").setAttribute("visibility",e?"inherit":"hidden")},t.addClickTapHandlerToChartItem=function(e){new f(e,function(r){return t.selectChartItem(e,!0,!1)},function(r){return t.selectChartItem(e,!1,!1)},null,function(r){return t.selectChartItem(e,!0,!0)},function(t){return!1})},t.selectChartItem=function(e,r,i){for(var n=t.getChartShape(e),a=Zt.indexInParent(e),o=qt.childElements(qt.findChildOfType(n,"legend")),s=o[a],l="true"==s.getAttribute("selected"),u=!1,c=0;c<o.length;c++)if(c!=a&&"true"==o[c].getAttribute("selected")){u=!0;break}if(i)return l=!l,s.setAttribute("selected",l?"true":"false"),void t.setChartItemLook(n,a,!1,l);if(l||u){if(l)return;t.setChartItemLook(n,a,!r,r)}else{t.setChartItemLook(n,a,!1,r);for(c=0;c<o.length;c++)c!=a&&t.setChartItemLook(n,c,r,!1)}},t.setChartItemLook=function(e,r,i,n){var a=qt.childElements(qt.findChildOfType(e,"legend")),o=qt.findChildOfType(a[r],"back"),s=qt.findChildOfType(a[r],"color");o.setAttribute("class",n?"legend-item-background-selected":"legend-item-background");var l=i?t.colorItemGrayed:a[r].getAttribute("original-color");switch(s.setAttribute("fill",l),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":Xd.setItemLook(e,r,i,l);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":qd.setItemLook(e,r,i,l);break;case"ChartTimeColor":Kd.setItemLook(e,r,i,l);break;case"ChartHistogram":Yd.setItemLook(e,r,i,l);break;case"ChartHistogram2D":Zd.setItemLook(e,r,i,l)}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),Jd=function(){function t(e){this.serverFPS=t.MAX_FPS,this.client=e,this.chart=new Qd(this),this.control=new Vd(this),this.shapeComposite=new Kt(this),this.shapeGISMap=new Nd(this),this.world3d=Pd.getWorld()}return t.prototype.start=function(){this.frameDrawStartTime=Date.now(),this.catchingUp=!1,this.frameCount=0,this.fpsMeasureStartTime=null,this.actualFPS=0,this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.fullFrame=!1,this.packetFPS=t.MAX_FPS,this.desiredFPS=t.MAX_FPS,this.frameBuffer=[],this.sleepTimeStatistics=new Array(t.SLEEP_TIME_STATISTICS_SIZE),this.sleepTimeStatistics.fill(1e3/t.MAX_FPS),this.startMeasureInterval(),this.startFrameDrawingTimeout(this.desiredFPS),this.world3d.networkManager=this.client.network},t.prototype.stop=function(){this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.frameBuffer=[],this.stopMeasureInterval(),this.stopFrameDrawingTimeout(),this.world3d.deactivate()},t.prototype.startMeasureInterval=function(){var t=this;this.fpsMeasureIntervalId=setInterval(function(){return t.measureFPS()},1e3)},t.prototype.stopMeasureInterval=function(){this.fpsMeasureIntervalId&&(clearInterval(this.fpsMeasureIntervalId),this.fpsMeasureIntervalId=void 0)},t.prototype.startFrameDrawingTimeout=function(t){var e=this;this.frameDrawingTimeoutId=setTimeout(function(){var t=Date.now();e.drawFrame();var r=1e3/e.desiredFPS-(Date.now()-t);r<0&&(r=0),e.sleepTimeStatistics.push(r),e.sleepTimeStatistics.shift(),e.startFrameDrawingTimeout(r)},t)},t.prototype.stopFrameDrawingTimeout=function(){this.frameDrawingTimeoutId&&(clearTimeout(this.frameDrawingTimeoutId),this.frameDrawingTimeoutId=void 0)},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.totalFrameCount=function(){var t=this.frameBuffer.length;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.findOrRequestFullFrame=function(){if(this.fullFrame)console.log("Found a full frame in the local buffer, starting from there");else{for(var t=0;t<this.packetBuffer.length;t++){if(this.packetBuffer[t].fullFrame)return console.log("Found a full frame in the local buffer, starting from there"),void this.packetBuffer.splice(0,t)}this.packetBuffer=[],console.log("Cleared local frame buffer, requesting full frame from the server"),this.client.network.requestAndWaitFullFrame()}},t.prototype.switchToNextFrame=function(){if(0==this.frameBuffer.length){if(0==this.packetBuffer.length)return this.fullFrame=!1,this.packetFPS=t.MAX_FPS,void(this.desiredFPS=t.MAX_FPS);var e=this.packetBuffer.shift();this.frameBuffer=e.frames,this.fullFrame=e.fullFrame,this.packetFPS=e.fps,this.desiredFPS=e.fps,this.updateServerFpsIfNeeded()}return this.frameBuffer.shift()},t.prototype.updateServerFpsIfNeeded=function(){var e=this.actualFPS/this.packetFPS,r=this.measureSleepTime();if(e>=.9&&r>50&&this.serverFPS<t.MAX_FPS)return this.serverFPS++,void this.client.network.postMaxFPS(this.serverFPS);e<.9&&r<50&&this.serverFPS>1&&(this.serverFPS--,e<.7&&this.serverFPS>1&&this.serverFPS--,e<.6&&this.serverFPS>1&&this.serverFPS--,this.client.network.postMaxFPS(this.serverFPS))},t.prototype.measureSleepTime=function(){for(var t=0,e=0;e<this.sleepTimeStatistics.length;e++)t+=this.sleepTimeStatistics[e];return t/=this.sleepTimeStatistics.length},t.prototype.drawFrame=function(){var e=this.switchToNextFrame();if(e){this.client.updateExperimentState(e),this.world3d.applyFrame(e),this.fullFrame&&(this.fullFrame=!1,qt.removeAllChildren(this.client.presentation)),this.frameDrawStartTime=Date.now(),this.client.svg.suspendRedraw(5e3),this.time=e.time;var r,i,n,a=e.commands;if(a.length>0&&"white"!=this.client.svg.style.backgroundColor&&(this.client.svg.style.backgroundColor="white"),np.DEBUG_MODE){var o=this.totalFrameCount();this.client.debugger.timeInfo.innerHTML=Zt.formatNumber(this.time,2),this.client.debugger.serverQueueInfo.innerHTML=this.client.network.serverQueue,this.client.debugger.browserQueueInfo.innerHTML=o+":"+this.client.network.packetManager.totalFrameCount(),r=0,i=0,n=0}for(var s=0;s<a.length;s++){var l=a[s],u=void 0,c=l.att,h=l.val,d=void 0;switch(l.cmd){case"C":var p=Zt.getAttributeValue(c,h,"shape-type"),f=Zt.getAttributeValue(c,h,"owner-id"),m=Zt.getAttributeValue(c,h,"add-after");if(Zt.getAttributeValue(c,h,"draw-mode").includes("2D")||(p="Shape3DOnly"),d=this.createShape(p,l.id),"null"==f)this.client.presentation.appendChild(d);else{if(null==(u=document.getElementById(f)))return console.log("Can't find container to add a shape to, container id = "+f,l),void this.findOrRequestFullFrame();if("ShapeGISMap"==u.getAttribute("type")){var g=qt.findChildOfType(u,"map").firstElementChild;u=p.startsWith("MarkupGIS")?qt.findChildOfType(g,"markup"):qt.findChildOfType(g,"agents")}if("null"==m){var v=u.firstElementChild;null==v?u.appendChild(d):u.insertBefore(d,v)}else{if(u.lastElementChild.id==m)u.appendChild(d);else{var b=document.getElementById(m);if(null==b)return console.log("Can't find element to add after, el id = "+m,l),void this.findOrRequestFullFrame();if(!u.contains(b))return console.log("the element to add after not found in group, el id = "+m,l),void this.findOrRequestFullFrame();var y=b.nextElementSibling;u.insertBefore(d,y)}}}this.updateShape(d,c,h),r++;break;case"U":if(null==(d=document.getElementById(l.id)))return console.log("Can't find shape to be updated, shape id = "+l.id,l),void this.findOrRequestFullFrame();this.updateShape(d,c,h),i++;break;case"D":if(null==(d=document.getElementById(l.id)))return console.log("Can't find shape to be deleted, shape id = "+l.id,l),void this.findOrRequestFullFrame();qt.removeElement(d.parentNode,d),n++;break;case"S":this.applySettings(c,h);break;case"N":this.applyNavigation(c,h);break;case"M":t.showMessage(c,h);break;case"W":t.openURL(c,h);break;default:return void this.client.stopAndAlert("Unknown command: "+l.cmd,null)}}this.client.svg.unsuspendRedrawAll(),this.frameCount++,np.DEBUG_MODE&&(this.client.debugger.cudCountInfo.innerHTML=r+"/"+i+"/"+n,this.client.debugger.drawTimeInfo.innerHTML=Date.now()-this.frameDrawStartTime,this.client.debugger.shapeCountInfo.innerHTML=Xt.elementcount),!this.catchingUp&&this.packetBuffer.length>1?(this.catchingUp=!0,this.desiredFPS=1e3/this.packetFPS*.8):this.catchingUp&&(this.catchingUp=!1,this.desiredFPS=1e3/this.packetFPS)}},t.prototype.createShape=function(t,e){var r;if(qt.isPrimitiveSVGElement(t))r=qt.createSvgElement(t);else switch(t){case"Shape3DOnly":r=qt.cloneElementWithId("3d-only-shape");break;case"ShapeArc":r=Kt.createShapeArc();break;case"ShapeText":r=Kt.createShapeText();break;case"ShapeImage":r=Kt.createShapeImage();break;case"ShapeCanvas":r=Kt.createShapeCanvas(e);break;case"ShapeModelElementsGroup":r=$t.create();break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=Gd.createMarkupPath(t,e);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=Gd.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=Gd.createMarkupPalletRack();break;case"MarkupRailwaySwitch":r=zd.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=zd.createMarkupPositionOnTrack();break;case"MarkupPipe":r=Bd.createMarkupPipe(e);break;case"MarkupStorageTank":r=Bd.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=Bd.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=Ud.createMarkupWall(t,e);break;case"MarkupTargetLine":r=Ud.createMarkupTargetLine();break;case"MarkupPathway":r=Ud.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=Ud.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=Ud.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=Ud.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=Ud.createMarkupEscalatorGroup();break;case"MarkupIntersection":r=Wd.createMarkupIntersection();break;case"MarkupRoad":r=Wd.createMarkupRoad();break;case"MarkupStopLine":r=Wd.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=Wd.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=Fd.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=Qd.create();break;case"Window3D":r=Rd.create(e);break;default:return this.client.stopAndAlert("Can't create: unknown object type: "+t,void 0),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(e,r,i){var n=e.getAttribute("type");if("Shape3DOnly"!=n)if(qt.isPrimitiveSVGElement(n))for(var a=0;a<r.length;a++)switch(r[a]){case"href":e.setAttributeNS(qt.xlinkns,"href",i[a]);break;case"href-path":e.setAttributeNS(qt.xlinkns,"href",this.client.network.getJarResourceURL(i[a]));break;case"geo":var o=i[a].split("|");e.setAttribute("lon",o[0]),e.setAttribute("lat",o[1]),e.setAttribute("heading",o[2]),Nd.updateGISObjectPosition(e);break;default:t.filterAndSetAttribute(e,r[a],i[a])}else switch(n){case"ShapeArc":Kt.updateShapeArc(e,r,i);break;case"ShapeText":Kt.updateShapeText(e,r,i);break;case"ShapeImage":this.shapeComposite.updateShapeImage(e,r,i);break;case"ShapeCanvas":Kt.updateShapeCanvas(e,r,i);break;case"ShapeModelElementsGroup":$t.update(e,r,i);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(e,r,i);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(e,r,i);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":Gd.updateMarkupPath(e,r,i);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":Gd.updateMarkupAreaNode(e,r,i);break;case"MarkupPalletRack":Gd.updateMarkupPalletRack(e,r,i);break;case"MarkupRailwaySwitch":zd.updateMarkupRailwaySwitch(e,r,i);break;case"MarkupPositionOnTrack":zd.updateMarkupPositionOnTrack(e,r,i);break;case"MarkupPipe":Bd.updateMarkupPipe(e,r,i);break;case"MarkupStorageTank":Bd.updateMarkupStorageTank(e,r,i);break;case"MarkupBulkConveyorBelt":Bd.updateMarkupBulkConveyorBelt(e,r,i);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":Ud.updateMarkupWall(e,r,i);break;case"MarkupTargetLine":Ud.updateMarkupTargetLine(e,r,i);break;case"MarkupPathway":Ud.updateMarkupPathway(e,r,i);break;case"MarkupPedFlowStatistics":Ud.updateMarkupPedFlowStatistics(e,r,i);break;case"MarkupServiceWithLines":Ud.updateMarkupServiceWithLines(e,r,i);break;case"MarkupServiceWithArea":Ud.updateMarkupServiceWithArea(e,r,i);break;case"MarkupEscalatorGroup":Ud.updateMarkupEscalatorGroup(e,r,i);break;case"MarkupIntersection":Wd.updateMarkupIntersection(e,r,i);break;case"MarkupRoad":Wd.updateMarkupRoad(e,r,i);break;case"MarkupStopLine":Wd.updateMarkupStopLine(e,r,i);break;case"MarkupBusStop":case"MarkupParkingLot":Wd.updateMarkupBusStopOrParkingLot(e,r,i);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":Fd.updateGISMarkup(e,r,i);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(e,r,i);break;case"Window3D":Rd.update(e,r,i)}},t.filterAndSetAttribute=function(e,r,i){if(!(["shape-type","owner-id","add-after"].indexOf(r)>=0||r.startsWith("3d")))if("pos"==r||"scale"==r){var n=t.posOrScaleToTransform(e,r,i);""==n?e.removeAttribute("transform"):e.setAttribute("transform",n)}else e.setAttribute(r,i)},t.posOrScaleToTransform=function(t,e,r){var i="",n="",a=t.getAttribute("transform"),o=null==a?-1:a.indexOf("scale");if("pos"==e){var s=Zt.splitToFloats(r,":"),l=s[0],u=s[1],c=Zt.radiansToDegrees(s[2]);0==l&&0==u||(i="translate("+l+" "+u+") "),0!=c&&(i+="rotate("+c+") "),n=o>=0?a.substring(o):""}else{var h=Zt.splitToFloats(r,":"),d=h[0],p=h[1];1==d&&1==p||(n="scale("+d+" "+p+")"),i=null==a||0==o?"":o<0?a:a.substring(0,o)}return i+n},t.prototype.measureFPS=function(){var t=Date.now();null!=this.fpsMeasureStartTime&&(this.actualFPS=Math.round(1e3*this.frameCount/(t-this.fpsMeasureStartTime))),np.DEBUG_MODE&&(this.client.debugger.fpsInfo.innerHTML=this.actualFPS+":"+this.packetFPS),this.fpsMeasureStartTime=t,this.frameCount=0},t.prototype.onControlAction=function(t,e){this.client.network.postUserAction(t,e)},t.prototype.onUserClick=function(t,e,r){qt.isContainedInElementOfType(t,Vd.controlTypes)||qt.isContainedInElementOfType(t,Qd.chartTypes)||qt.isContainedInElementOfType(t,["Window3D"])||qt.isContainedInElementOfType(t,["ShapeGISMap"])||this.client.network.postUserAction(0,e+" "+r)},t.prototype.applySettings=function(t,e){for(var r=0;r<t.length;r++)this.modelSettings[Zt.hyphenToCameLCase(t[r])]=e[r];this.modelSettings.startTime=parseInt(this.modelSettings.startTime),this.modelSettings.startDate=parseInt(this.modelSettings.startDate),this.modelSettings.stopTime&&(this.modelSettings.stopTime=parseInt(this.modelSettings.startTime),this.modelSettings.stopDate=parseInt(this.modelSettings.startDate))},t.prototype.applyNavigation=function(t,e){for(var r=0;r<t.length;r++)this.navigationSettings[Zt.hyphenToCameLCase(t[r])]=e[r];this.navigationSettings.x=parseFloat(this.navigationSettings.x),this.navigationSettings.y=parseFloat(this.navigationSettings.y),this.navigationSettings.width=parseFloat(this.navigationSettings.width),this.navigationSettings.height=parseFloat(this.navigationSettings.height),this.navigationSettings.zoomAndPanningEnabled="true"==this.navigationSettings.zoomAndPanningEnabled,this.client.setNavigationSettings(this.navigationSettings.width,this.navigationSettings.height),this.client.navigation.applyNavigationSettings()},t.showMessage=function(t,e){for(var r={},i=0;i<t.length;i++)r[Zt.hyphenToCameLCase(t[i])]=e[i];var n=document.getElementById("svg-message-background"),a=document.getElementById("svg-message-box-title"),o=document.getElementById("svg-message-box-text"),s=document.getElementById("svg-message-box-icon-info"),l=document.getElementById("svg-message-box-icon-error");a.innerText=r.title,o.innerHTML=r.text.replace(/\n/g,"<br>"),r.type.startsWith("error")?(s.style.display="none",l.style.removeProperty("display"),a.classList.remove("svg-message-box-colors-info"),a.classList.add("svg-message-box-colors-error"),""==r.title&&(a.innerHTML="Error")):(s.style.removeProperty("display"),l.style.display="none",a.classList.remove("svg-message-box-colors-error"),a.classList.add("svg-message-box-colors-info"),""==r.title&&(a.innerHTML="Message")),n.style.removeProperty("display")},t.openURL=function(e,r){var i=r[0];i.startsWith("http://")&&i.startsWith("https://")||(i="http://"+i);var n=["message","Open URL","The model asks you to open an external URL:<br><a href="+i+" target = '_blank' onclick = 'document.getElementById( \"svg-message-background\" ).style.display = \"none\"'>"+i+"</a><br><br>The URL will open in a new window"];t.showMessage(["type","title","text"],n)},t.SLEEP_TIME_STATISTICS_SIZE=20,t.MAX_FPS=20,t}(),$d=function(){function t(t,e,r){var i=this;this.networkManager=t,this.startTime=Date.now(),this.xhttp=this.networkManager.getAnimationPacket(e,function(){i.stopTime=Date.now(),r(i)})}return t.prototype.requestTime=function(){return this.stopTime?this.stopTime-this.startTime:Date.now()-this.startTime},t.prototype.abort=function(){this.xhttp.abort()},t}(),tp=function(){function t(t){this.paused=!1,this.networkManager=t}return t.prototype.start=function(){this.fullFrame=!0,this.activeRequests=[],this.responseTimeStatistics=new Array(t.REQUEST_STATISTICS_SIZE),this.responseTimeStatistics.fill(rp.MIN_REQUEST_INTERVAL),this.requestInterval=rp.MIN_REQUEST_INTERVAL,this.lastRequestTime=0,this.createRequest(),this.startRequestTimeout()},t.prototype.stop=function(){this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.pause=function(){this.paused=!0,this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.requestFullFrame=function(){console.debug(">> SVG: Request full frame."),this.fullFrame=!0},t.prototype.startRequestTimeout=function(){var t=this;this.requestTimeoutId=setTimeout(function(){t.processRequestTimeout()},this.requestInterval)},t.prototype.processRequestTimeout=function(){this.requestTimeoutId=void 0,this.activeRequests.length<rp.MAX_REQUEST_COUNT&&(this.createRequest(),this.startRequestTimeout())},t.prototype.createRequest=function(){var t=this,e=new $d(this.networkManager,this.fullFrame,function(e){return t.processResponse(e)});this.fullFrame=!1,this.activeRequests.push(e),this.lastRequestTime=Date.now()},t.prototype.processResponse=function(t){var e=this.activeRequests.indexOf(t);if(this.activeRequests.splice(e,1),this.addToResponseTimeStatistics(t.requestTime()),void 0!==this.requestTimeoutId||this.paused||(this.createRequest(),this.startRequestTimeout()),4==t.xhttp.readyState&&200==t.xhttp.status){var r=JSON.parse(t.xhttp.responseText);this.networkManager.packetManager.addPacket(r)}},t.prototype.addToResponseTimeStatistics=function(t){this.responseTimeStatistics.push(t),this.responseTimeStatistics.shift(),this.requestInterval=this.calculateRequestInterval(),this.networkManager.RPS=1e3/this.requestInterval},t.prototype.calculateRequestInterval=function(){if(0===this.responseTimeStatistics.length)return rp.MIN_REQUEST_INTERVAL;for(var t=0,e=0;e<this.responseTimeStatistics.length;e++)t+=this.responseTimeStatistics[e];var r=t/this.responseTimeStatistics.length*.5;return r<rp.MIN_REQUEST_INTERVAL?rp.MIN_REQUEST_INTERVAL:r>rp.MAX_REQUEST_INTERVAL?rp.MAX_REQUEST_INTERVAL:r},t.REQUEST_STATISTICS_SIZE=10,t}(),ep=function(){function t(t){this.client=t,this.reset()}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.waitingFullFrame=!1,this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.pause=function(){this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.addPacket=function(t){if(t){var e=t.frames;if(e&&0!==e.length){var r=e[0];if(!(r.number<this.expectedFrameNumber)){if(r.number===this.expectedFrameNumber||t.fullFrame){this.client.network.serverQueue=t.serverQueue;var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),this.cancelWaitExpectedFrameTimeoutIfNeeded(),void(t.fullFrame&&(this.waitingFullFrame=!1))}this.insertToPacketBuffer(t),console.debug(">> SVG: Reordering  or packet loss expectedFrame=",this.expectedFrameNumber),this.startWaitExpectedFrameTimeoutIfNeeded()}}}},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length&&!(this.packetBuffer[0].frames[0].number>=this.expectedFrameNumber)){var t=this.packetBuffer[this.packetBuffer.length-1];if(t.frames[t.frames.length-1].number>=this.expectedFrameNumber)this.packetBuffer=[];else{for(var e=0;e<this.packetBuffer.length&&!(this.packetBuffer[e].frames[0].number>=this.expectedFrameNumber);e++);this.packetBuffer.splice(0,e)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length&&this.packetBuffer[0].frames[0].number===this.expectedFrameNumber){for(var t=this.expectedFrameNumber,e=0;e<this.packetBuffer.length;e++){var r=this.packetBuffer[e].frames;if(r[0].number!==t)break;t=r[r.length-1].number+1}var i=this.packetBuffer.splice(0,e);this.client.frameDrawing.addAllPackets(i),this.expectedFrameNumber=t}},t.prototype.cancelWaitExpectedFrameTimeoutIfNeeded=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startWaitExpectedFrameTimeoutIfNeeded=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,t.client.network.requestFullFrame()},4*this.client.network.RPS*1e3))},t.prototype.waitFullFrame=function(){console.debug(">> SVG: Wait full frame."),this.waitingFullFrame=!0,this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t}(),rp=function(){function t(t){this.client=t,this.packetRequester=new tp(this),this.packetManager=new ep(t)}return t.prototype.start=function(){this.packetManager.reset(),this.packetRequester.start()},t.prototype.stop=function(){this.packetRequester.stop(),this.packetManager.reset()},t.prototype.pause=function(){this.paused=!0,this.packetRequester.pause()},t.prototype.getAnimationPacket=function(t,e){if(!this.paused){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},np.DEBUG_SPARK_LOCAL?r.open("GET","/http/update?fullFrame="+t+"&time="+Date.now(),!0):r.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+Date.now(),!0),r.send(),r}},t.prototype.postUserAction=function(t,e){if(!this.paused){var r=new XMLHttpRequest;np.DEBUG_SPARK_LOCAL?r.open("GET","/http/useraction?id="+t+"&value="+encodeURIComponent(e)):r.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),r.send()}},t.prototype.postUserCommand=function(t,e){if(!this.paused){var r=new XMLHttpRequest;r.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),r.send()}},t.prototype.getJarResourceURL=function(t){return this.getResourceURLWithSubpath("internal-resources",t)},t.prototype.getResourceURL=function(t){return this.getResourceURLWithSubpath("resources",t)},t.prototype.getResourceURLWithSubpath=function(t,e){if(!this.paused)return np.DEBUG_SPARK_LOCAL?"/http/image?path="+e:this.getRestRoot()+t+"?path="+e},t.prototype.getRestRoot=function(){return this.client.svgAnimationInfo.host+"/nodes/"+this.client.svgAnimationInfo.restUrl+"sessions/"+this.client.svgAnimationInfo.sessionUuid+"/"},t.prototype.postMaxFPS=function(t){if(!this.paused){var e=new XMLHttpRequest;np.DEBUG_SPARK_LOCAL?e.open("POST","http/max-fps"):e.open("POST",this.getRestRoot()+"max-fps"),e.send(t.toString())}},t.prototype.requestFullFrame=function(){this.packetRequester.requestFullFrame()},t.prototype.requestAndWaitFullFrame=function(){this.packetRequester.requestFullFrame(),this.packetManager.waitFullFrame()},t.MIN_REQUEST_INTERVAL=500,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_REQUEST_COUNT=2,t}(),ip=function(){function t(e){var r=this;this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDebugContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDebugContainer.parentElement,this.controlPanel=document.getElementById("control-panel"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDebugTools=document.getElementById("control-panel-button-dev-panel"),this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpInfoState=document.getElementById("control-panel-info-state"),window.addEventListener("resize",function(){return r.adjustControlPanelItemsVisibility()},!1),t.assignActionOnClick(this.cpButtonRun,function(){return r.client.network.postUserCommand("run","")}),t.assignActionOnClick(this.cpButtonPause,function(){return r.client.network.postUserCommand("pause","")}),t.assignActionOnClick(this.cpButtonX1,function(){return r.setSpeed(1)}),t.assignActionOnClick(this.cpButtonSlower,function(){return r.speedUpOrDown(!1)}),t.assignActionOnClick(this.cpButtonFaster,function(){return r.speedUpOrDown(!0)}),t.assignActionOnClick(this.cpButtonVirtual,function(){return r.setSpeed(1/0)}),this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},t.assignActionOnClick(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),E.addFullScreenListener(function(){return r.onFullScreenChange()}),this.cpButtonDebugTools.style.display="none"}return t.prototype.adjustControlPanelItemsVisibility=function(){var t=this.presentationContainer.getBoundingClientRect().width,e=262,r=E.isFullScreenEnabled();this.cpButtonFullScreen.style.removeProperty("display");var i=(t-=e+=r?46:0)>=(e=178);i?(this.cpButtonSlower.style.removeProperty("display"),this.cpInfoScale.style.removeProperty("display"),this.cpButtonFaster.style.removeProperty("display")):(this.cpButtonSlower.style.display="none",this.cpInfoScale.style.display="none",this.cpButtonFaster.style.display="none"),(i=(t-=e)>=(e=46))?this.cpButtonX1.style.removeProperty("display"):this.cpButtonX1.style.display="none",(i=(t-=e)>=(e=46))?this.cpButtonVirtual.style.removeProperty("display"):this.cpButtonVirtual.style.display="none",t-=e},t.prototype.updateExperimentState=function(){this.updateInfoState(),this.updateModelTimeScale(),this.updateRunGroup(),this.updateSpeedGroup()},t.prototype.updateModelTimeScale=function(){this.cpInfoScale.innerText=t.timeScaleToString(this.client.getModelTimeScale())},t.prototype.updateExperimentProgress=function(){var t=this.client.getModelProgress(),e=this.progressBar.firstElementChild,r=100*t;this.progressBar.style.width=t<=0?"0":r+"%",e.innerText=t<0?"progress n/a":Math.round(r)+"%"},t.prototype.updateInfoState=function(){var e=this.client.getModelState(),r=t.modelStateToString(e);this.cpInfoState.innerText=t.modelStateToString(r),this.indicateCpErrorState("ERROR"==e)},t.prototype.indicateCpErrorState=function(t){t?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getModelState()&&this.indicateCpErrorState(!1)},t.prototype.updateRunGroup=function(){var e=this.client.getModelState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e;t.setVisible(this.cpButtonRun,!r),this.setEnabled(this.cpButtonRun,!r&&i),t.setVisible(this.cpButtonPause,r),this.setEnabled(this.cpButtonPause,r)},t.prototype.updateSpeedGroup=function(){var e=this.client.getModelState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e,i=t.stringToTimeScale(this.cpInfoScale.innerText);this.setEnabled(this.cpButtonX1,r&&1!=i),this.setEnabled(this.cpButtonSlower,r&&i>t.speeds[0]),this.setEnabled(this.cpButtonFaster,r&&i!=1/0),this.setEnabled(this.cpButtonVirtual,r&&i!=1/0)},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=p.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r)},t.prototype.setSpeed=function(e){this.cpInfoScale.innerText=t.timeScaleToString(e),this.client.network.postUserCommand("setspeed",e.toString()),this.updateSpeedGroup()},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=E.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed")),this.adjustControlPanelItemsVisibility()},t.prototype.toggleFullScreen=function(){E.toggleFullScreen(this.presentationContainer)},t.modelStateToString=function(t){switch(t){case"INITIALIZE":return"Initializing...";case"IDLE":return"Idle";case"RUNNING":return"Running";case"PAUSED":return"Paused";case"FINISHED":return"Finished.";case"ERROR":return"Error!";case"PLEASE_WAIT":return"Please Wait..."}return t},t.timeScaleToString=function(t){return t<0||t==1/0?"Virtual":t>=1?"x"+t:"x1/"+1/t},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.setVisible=function(t,e){e?t.style.removeProperty("display"):t.style.display="none"},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.assignActionOnClick=function(e,r){e.onclick=function(){t.isEnabled(e)&&r()}},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t}(),np=function(){function t(){this.windowAdjusted=!1,this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new Jd(this),this.navigation=new Dd(this),this.network=new rp(this),this.controlPanel=new ip(this)}return t.prototype.start=function(t){this.svgAnimationInfo=t,this.svg.style.pointerEvents="auto",this.navigation.initSVGNavigation(),this.network.start(),this.frameDrawing.start(),this.modelState="INITIALIZE"},t.prototype.stop=function(t){t?(this.modelState=t.type,this.controlPanel.updateExperimentState()):this.modelState=void 0,this.frameDrawing.stop(),this.navigation.clearSVGNavigation(),this.network.stop(),this.onToggleFullScreen=void 0,this.onResize=void 0,this.onStop=void 0,this.windowAdjusted=!1,qt.removeAllChildren(this.presentation)},t.prototype.setCallback=function(t,e){switch(t){case"ontogglefullscreen":this.onToggleFullScreen=e;break;case"onstop":this.onStop=e;break;case"onresize":this.onResize=e}},t.prototype.pause=function(){this.network.pause()},t.prototype.stopAndAlert=function(t,e){console.log(t),console.log(e),Jd.showMessage(["type","title","text"],["error",t,e]),this.frameDrawing.stop()},t.prototype.updateExperimentState=function(t){t.state!=this.modelState&&(this.modelState=t.state,this.controlPanel.updateExperimentState()),t.progress!=this.modelProgress&&(this.modelProgress=t.progress,this.controlPanel.updateExperimentProgress()),t.time!=this.modelTime&&(this.modelTime=t.time),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.controlPanel.updateModelTimeScale())},t.prototype.updateViewArea=function(){this.navigation.applyNavigationSettings()},t.prototype.getModelTime=function(){return this.modelTime},t.prototype.getModelState=function(){return this.modelState},t.prototype.getModelTimeScale=function(){return this.modelTimeScale},t.prototype.getModelProgress=function(){return this.modelProgress},t.prototype.setNavigationSettings=function(t,e){var r=this;!this.windowAdjusted&&this.onResize&&(this.onResize(t,e+50,function(){r.navigation.applyNavigationSettings(),r.controlPanel.adjustControlPanelItemsVisibility()}),this.windowAdjusted=!0)},t.DEBUG_MODE=!1,t.DEBUG_SPARK_LOCAL=!1,t}(),ap=function(){function t(){}return t.createClient=function(){return new np},t.createDebugger=function(){return new Xt(new np)},t}(),op=function(){function t(t,e,r){var i=this;this.networkManager=t,this.startTime=Date.now(),this.xhttp=this.networkManager.getAnimationPacket(e,function(){i.stopTime=Date.now(),r(i)})}return t.prototype.requestTime=function(){return this.stopTime?this.stopTime-this.startTime:Date.now()-this.startTime},t.prototype.abort=function(){this.xhttp.abort()},t}(),sp=function(){function t(t){this.paused=!1,this.networkManager=t}return t.prototype.start=function(){this.fullFrame=!0,this.activeRequests=[],this.responseTimeStatistics=new Array(t.REQUEST_STATISTICS_SIZE),this.responseTimeStatistics.fill(up.MIN_REQUEST_INTERVAL),this.requestInterval=up.MIN_REQUEST_INTERVAL,this.lastRequestTime=0,this.createRequest(),this.startRequestTimeout()},t.prototype.stop=function(){this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.pause=function(){this.paused=!0,this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.requestFullFrame=function(){console.debug(">> SVG: Request full frame."),this.fullFrame=!0},t.prototype.startRequestTimeout=function(){var t=this;this.requestTimeoutId=setTimeout(function(){t.processRequestTimeout()},this.requestInterval)},t.prototype.processRequestTimeout=function(){this.requestTimeoutId=void 0,this.activeRequests.length<up.MAX_REQUEST_COUNT&&(this.createRequest(),this.startRequestTimeout())},t.prototype.createRequest=function(){var t=this,e=new op(this.networkManager,this.fullFrame,function(e){return t.processResponse(e)});this.fullFrame=!1,this.activeRequests.push(e),this.lastRequestTime=Date.now()},t.prototype.processResponse=function(t){var e=this.activeRequests.indexOf(t);if(this.activeRequests.splice(e,1),this.addToResponseTimeStatistics(t.requestTime()),void 0!==this.requestTimeoutId||this.paused||(this.createRequest(),this.startRequestTimeout()),4==t.xhttp.readyState&&200==t.xhttp.status){var r=JSON.parse(t.xhttp.responseText);this.networkManager.packetManager.addPacket(r)}},t.prototype.addToResponseTimeStatistics=function(t){this.responseTimeStatistics.push(t),this.responseTimeStatistics.shift(),this.requestInterval=this.calculateRequestInterval(),this.networkManager.RPS=1e3/this.requestInterval},t.prototype.calculateRequestInterval=function(){if(0===this.responseTimeStatistics.length)return up.MIN_REQUEST_INTERVAL;for(var t=0,e=0;e<this.responseTimeStatistics.length;e++)t+=this.responseTimeStatistics[e];var r=t/this.responseTimeStatistics.length*.5;return r<up.MIN_REQUEST_INTERVAL?up.MIN_REQUEST_INTERVAL:r>up.MAX_REQUEST_INTERVAL?up.MAX_REQUEST_INTERVAL:r},t.REQUEST_STATISTICS_SIZE=10,t}(),lp=function(){function t(t){this.client=t,this.reset()}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.waitingFullFrame=!1,this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.pause=function(){this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.addPacket=function(t){if(t){var e=t.frames;if(e&&0!==e.length){var r=e[0];if(!(r.number<this.expectedFrameNumber)){if(r.number===this.expectedFrameNumber||t.fullFrame){this.client.network.serverQueue=t.serverQueue;var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),this.cancelWaitExpectedFrameTimeoutIfNeeded(),void(t.fullFrame&&(this.waitingFullFrame=!1))}this.insertToPacketBuffer(t),console.debug(">> SVG: Reordering  or packet loss expectedFrame=",this.expectedFrameNumber),this.startWaitExpectedFrameTimeoutIfNeeded()}}}},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length&&!(this.packetBuffer[0].frames[0].number>=this.expectedFrameNumber)){var t=this.packetBuffer[this.packetBuffer.length-1];if(t.frames[t.frames.length-1].number>=this.expectedFrameNumber)this.packetBuffer=[];else{for(var e=0;e<this.packetBuffer.length&&!(this.packetBuffer[e].frames[0].number>=this.expectedFrameNumber);e++);this.packetBuffer.splice(0,e)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length&&this.packetBuffer[0].frames[0].number===this.expectedFrameNumber){for(var t=this.expectedFrameNumber,e=0;e<this.packetBuffer.length;e++){var r=this.packetBuffer[e].frames;if(r[0].number!==t)break;t=r[r.length-1].number+1}var i=this.packetBuffer.splice(0,e);this.client.frameDrawing.addAllPackets(i),this.expectedFrameNumber=t}},t.prototype.cancelWaitExpectedFrameTimeoutIfNeeded=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startWaitExpectedFrameTimeoutIfNeeded=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,t.client.network.requestFullFrame()},4*this.client.network.RPS*1e3))},t.prototype.waitFullFrame=function(){console.debug(">> SVG: Wait full frame."),this.waitingFullFrame=!0,this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t}(),up=function(){function t(t){this.client=t,this.packetRequester=new sp(this),this.packetManager=new lp(t)}return t.prototype.start=function(){this.packetManager.reset(),this.packetRequester.start()},t.prototype.stop=function(){this.packetRequester.stop(),this.packetManager.reset()},t.prototype.pause=function(){this.paused=!0,this.packetRequester.pause()},t.prototype.getAnimationPacket=function(t,e){if(!this.paused){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},Bp.DEBUG_SPARK_LOCAL?r.open("GET","/http/update?fullFrame="+t+"&time="+Date.now(),!0):r.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+Date.now(),!0),r.send(),r}},t.prototype.postUserAction=function(t,e){if(!this.paused){var r=new XMLHttpRequest;Bp.DEBUG_SPARK_LOCAL?r.open("GET","/http/useraction?id="+t+"&value="+encodeURIComponent(e)):r.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),r.send()}},t.prototype.postUserCommand=function(t,e){if(!this.paused){var r=new XMLHttpRequest;r.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),r.send()}},t.prototype.getJarResourceURL=function(t){return this.getResourceURLWithSubpath("internal-resources",t)},t.prototype.getResourceURL=function(t){return this.getResourceURLWithSubpath("resources",t)},t.prototype.getResourceURLWithSubpath=function(t,e){if(!this.paused)return Bp.DEBUG_SPARK_LOCAL?"/http/image?path="+e:this.getRestRoot()+t+"?path="+e},t.prototype.getResource=function(t,e){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},Bp.DEBUG_SPARK_LOCAL?r.open("GET","/http/resource?path="+t,!0):r.open("GET",this.getRestRoot()+"resources?path="+t,!0),r.send(),r},t.prototype.getRestRoot=function(){return this.client.svgAnimationInfo.host+"/nodes/"+this.client.svgAnimationInfo.restUrl+"sessions/"+this.client.svgAnimationInfo.sessionUuid+"/"},t.prototype.postMaxFPS=function(t){if(!this.paused){var e=new XMLHttpRequest;Bp.DEBUG_SPARK_LOCAL?e.open("POST","http/max-fps"):e.open("POST",this.getRestRoot()+"max-fps"),e.send(t.toString())}},t.prototype.requestFullFrame=function(){this.packetRequester.requestFullFrame()},t.prototype.requestAndWaitFullFrame=function(){this.packetRequester.requestFullFrame(),this.packetManager.waitFullFrame()},t.MIN_REQUEST_INTERVAL=500,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_REQUEST_COUNT=2,t}(),cp=function(){function t(t){this.frameDrawing=t}return t.createShapeArc=function(){return d.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:Dp.filterAndSetAttribute(t,e[a],r[a])}},t.createShapeText=function(){return d.createSvgElement("text")},t.updateShapeText=function(e,r,i){for(var n=0;n<r.length;n++)switch(r[n]){case"text-content":null==i[n]&&(i[n]="");var a=i[n].split("\n"),o=p.getFloatAttribute(e,"first-line-offset"),s=p.getFloatAttribute(e,"line-height");t.drawMultiLineText(e,a,s,o);break;case"font":e.style.font=i[n];break;default:Dp.filterAndSetAttribute(e,r[n],i[n])}},t.drawMultiLineText=function(t,e,r,i){var n=t.childElementCount;if(1==e.length&&1==n)t.firstElementChild.firstChild.textContent=e[0];else{for(var a=t.getAttribute("x"),o=null==a?0:parseFloat(a),s=t.getAttribute("y"),l=(null==s?0:parseFloat(s))+i,u=0;u<e.length;u++){var c=d.childElements(t),h=e[u];if(h.endsWith("\r")&&(h=h.substring(0,h.length-1)),c[u])c[u].firstChild.textContent=h;else{var p=d.createSvgElement("tspan");p.setAttribute("x",o.toString()),p.setAttribute("y",(l+u*r).toString());var f=d.createTextNode(h);p.appendChild(f),t.appendChild(p)}}for(;t.childElementCount>e.length;)d.removeElement(t.lastChild)}},t.createShapeImage=function(){return d.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":d.removeAllChildren(t);break;case"add":var n=d.cloneElementWithId("image-item");n.setAttributeNS(d.xlinkns,"href",this.frameDrawing.client.network.getJarResourceURL(r[i])),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.appendChild(n);break;case"set":for(var a=parseInt(r[i]),o=t.childNodes,s=0;s<o.length;s++)(n=o[s]).setAttribute("visibility",s==a?"inherit":"hidden");break;case"width":case"height":o=t.childNodes;for(s=0;s<o.length;s++)(n=o[s]).setAttribute(e[i],r[i]);default:Dp.filterAndSetAttribute(t,e[i],r[i])}},t.createShapeCanvas=function(t){var e=d.createSvgElement("image");return d.createCanvas(t,"canvas-group"),e},t.updateShapeCanvas=function(t,e,r){for(var i=t,n=document.getElementById(t.id+"canvas"),a=n.getContext("2d"),o=0;o<e.length;o++)switch(e[o]){case"global-composite-operation":a.globalCompositeOperation=r[o];break;case"width":case"height":i.setAttribute(e[o],r[o]),n.setAttribute(e[o],r[o]);break;case"fill-rect":case"clear-rect":var s=r[o].split(" "),l=parseFloat(s[0]),u=parseFloat(s[1]),c=parseFloat(s[2]),h=parseFloat(s[3]);if("clear-rect"==e[o])a.clearRect(l,u,c,h);else{var p=s[4];a.fillStyle=p,a.fillRect(l,u,c,h)}break;case"fill-circle":s=r[o].split(" ");var f=parseFloat(s[0]),m=parseFloat(s[1]),g=parseFloat(s[2]),v=s[3];a.fillStyle=v,a.beginPath(),a.arc(f,m,g,0,2*Math.PI),a.fill();break;case"clear":a.clearRect(0,0,n.width,n.height);break;case"update":i.setAttributeNS(d.xlinkns,"href",n.toDataURL("image/x-xbitmap"));break;default:Dp.filterAndSetAttribute(t,e[o],r[o])}},t.createShapeCAD=function(){return d.cloneElementWithId("shape-cad")},t.prototype.updateShapeCAD=function(t,e,r){for(var i=d.findChildOfType(t,"back"),n=d.findChildOfType(t,"image"),a=0;a<e.length;a++)switch(e[a]){case"width":case"height":i.setAttribute(e[a],r[a]),this.fitCAD(t);break;case"background-color":i.setAttribute("fill",r[a]);break;case"svg":n.setAttributeNS(d.xlinkns,"href",'data:image/svg+xml;utf8,<svg xmlns="'+d.svgns+'" width = "0" height = "\'0"><g transform = "translate(0 0) scale(1)" stroke-width = "0.6">'+r[a]+"</g></svg>");break;case"svg-dimensions":t.setAttribute(e[a],r[a]),this.fitCAD(t);break;case"layer-settings":var o=n.getAttribute("href"),s=o.indexOf("<svg"),l=o.substring(0,s),u=o.substring(s),c=document.createElementNS(d.svgns,"g");c.innerHTML=u;for(var h=c.firstElementChild.firstElementChild,f=0,m=p.splitSkipEmpty(r[a],"|");f<m.length;f++){var g=m[f].split(":"),v=d.findChildWithId(h,g[0]);null!=v&&(v.setAttribute("visibility",g[1]),"none"!=g[2]&&(v.setAttribute("stroke",g[2]),"none"!=v.getAttribute("fill")&&v.setAttribute("fill",g[2])))}u=c.innerHTML,n.setAttributeNS(d.xlinkns,"href",l+u);break;default:Dp.filterAndSetAttribute(t,e[a],r[a])}},t.prototype.fitCAD=function(e){var r=d.findChildOfType(e,"back"),i=d.findChildOfType(e,"image"),n=e.getAttribute("svg-dimensions"),a=p.getFloatAttribute(r,"width"),o=p.getFloatAttribute(r,"height");if(null!=a&&null!=o&&null!=n){var s=p.splitToFloats(n," "),l=Math.min(a/s[2],o/s[3]),u="translate("+-s[0]*l+" "+-s[1]*l+") scale("+l+")",c=t.DEFAULT_CAD_STROKE_WIDTH/l/this.frameDrawing.client.navigation.zoom,h=i.getAttribute("href");h=(h=h.replace(/width\s*=\s*"[^"]*"\s*height\s*=\s*"[^"]*"/,'width = "'+a+'" height = "'+o+'"')).replace(/transform\s*=\s*"[^"]*"\s*stroke-width\s*=\s*"[^"]*"/,'transform = "'+u+'" stroke-width = "'+c+'"'),i.setAttributeNS(d.xlinkns,"href",h),p.setMultipleAttributes(i,["width","height"],[a,o])}},t.onCADZoomChange=function(t,e,r){var i=d.findChildOfType(t,"image"),n=i.getAttribute("href");n=n.replace(/stroke-width\s*=\s*"([^"]*)"/,function(t,i){return'stroke-width = "'+parseFloat(i)*e/r+'"'}),i.setAttributeNS(d.xlinkns,"href",n)},t.createShapeSVG=function(){return d.createSvgElement("g")},t.updateShapeSVG=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"svg":t.innerHTML="null"==r[i]?"":r[i];break;default:Dp.filterAndSetAttribute(t,e[i],r[i])}},t.createUnsupportedObject=function(t){var e=d.cloneElementWithId("unsupported-object");return d.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=d.findChildOfType(t,"background"),n=d.findChildOfType(t,"text"),a=0;a<e.length;a++)switch(e[a]){case"width":var o=parseFloat(r[a]);i.setAttribute("width",o.toString());var s=n.getBBox();o<s.width&&(n.firstChild.textContent="Not supported",s=n.getBBox()),o<s.width&&(n.firstChild.textContent="N/A",s=n.getBBox()),o<s.width&&(n.firstChild.textContent=""),n.setAttribute("x",(o/2).toString());break;case"height":var l=parseFloat(r[a]);i.setAttribute("height",l.toString()),n.setAttribute("y",(l/2+3).toString());break;default:Dp.filterAndSetAttribute(t,e[a],r[a])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeCAD","ShapeSVG","ShapeGISMap"],t.DEFAULT_CAD_STROKE_WIDTH=.6,t}(),hp=function(){function t(){}return t.createStockIcon=function(t){var e=d.cloneElementWithId("STOCK"),r=d.findChildOfType(e,"back"),i=parseFloat(p.getSubAttribute(t,"width")),n=parseFloat(p.getSubAttribute(t,"height"));p.setMultipleAttributes(r,["x","y","width","height"],[-i/2,-n/2,i,n]);var a=d.findChildOfType(e,"bars").firstElementChild;p.setMultipleAttributes(a,["x","width"],[-i/2+1,i-2]);var o=p.getSubAttribute(t,"color");return null!=o&&(r.setAttribute("stroke",o),a.setAttribute("fill",o)),e},t.createFlowIcon=function(e){for(var r=d.cloneElementWithId("FLOW"),i=d.findChildOfType(r,"basepath"),n=d.findChildOfType(r,"innerpath"),a=d.findChildOfType(r,"animation"),o=d.findChildOfType(r,"arrow"),s=d.findChildOfType(r,"valve"),l=p.getSubAttribute(e,"color"),u=p.getSubAttribute(e,"points"),c=p.splitSkipEmpty(u,";"),h="",f=0;f<c.length;f++){var m=p.splitToFloats(c[f],",");if(h+=0==f?"M ":"L ",h+=m[0]+" "+m[1]+" ",0==f&&"null"==p.getSubAttribute(e,"source")){var g=p.splitToFloats(c[1],","),v=Math.atan2(m[1]-g[1],m[0]-g[0]);t.addFlowCloud(r,!0,m[0],m[1],v,l)}if(f==c.length-1){var b=p.splitToFloats(c[f-1],","),y=(v=Math.atan2(m[1]-b[1],m[0]-b[0]),p.radiansToDegrees(v)),A="translate("+m[0]+","+m[1]+") rotate("+y+")";o.setAttribute("transform",A),"null"==p.getSubAttribute(e,"target")&&t.addFlowCloud(r,!1,m[0],m[1],v,l)}}var T=p.roundPathCorners(h,5,!1);i.setAttribute("d",T),n.setAttribute("d",T),a.setAttribute("d",T);var C=p.getSubAttribute(e,"valve-pos"),S=p.splitToFloats(C,","),E="translate("+S[0]+","+S[1]+") rotate("+p.radiansToDegrees(S[2])+")";return s.setAttribute("transform",E),"true"==p.getSubAttribute(e,"external")&&s.setAttribute("stroke-dasharray","1,1"),null!=l&&(i.setAttribute("stroke",l),o.setAttribute("stroke",l),o.setAttribute("fill",p.changeBrightness(l,2)),s.setAttribute("stroke",l),s.setAttribute("fill",p.changeBrightness(l,2))),r},t.addFlowCloud=function(t,e,r,i,n,a){var o=e?15:35,s=r+o*Math.cos(n),l=i+o*Math.sin(n),u=d.createUseElement("flow-cloud-fill"),c=d.createUseElement("flow-cloud-line");p.setMultipleAttributes(u,["x","y"],[s,l]),p.setMultipleAttributes(c,["x","y"],[s,l]),c.setAttribute("stroke",null==a?"CornflowerBlue":a),t.appendChild(u),t.appendChild(c)},t.createDynamicVariableIcon=function(t){var e,r=(e="true"==p.getSubAttribute(t,"external")?d.cloneElementWithId("DYNAMIC_VARIABLE_EXTERNAL"):"true"==p.getSubAttribute(t,"constant")?d.cloneElementWithId("DYNAMIC_VARIABLE_CONSTANT"):d.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,i=p.getSubAttribute(t,"color");return null!=i&&r.setAttribute("fill",i),e},t.createShadowIconAndInfo=function(t,e,r){var i=p.getSubAttribute(r,"original"),n=pp.getModelPrimitiveByName(t,i);if(null==n)return console.log("Shadow variable could not find its original, name: "+i),d.createUseElement("DEFAULT_MODEL_ELEMENT");var a,o=d.findChildOfType(n,"icon");if("FLOW"==n.getAttribute("type")){var s=(a=d.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,l=d.findChildOfType(o,"valve");s.setAttribute("fill",l.getAttribute("stroke"))}else o.id=n.id+"icon",a=d.createUseElement(o.id);var u=d.findChildOfType(n,"info");u.id=n.id+"info";var c=d.createUseElement(u.id);c.setAttribute("type","info");var h=d.findChildOfType(e,"info"),f=p.getFloatAttribute(h,"x"),m=p.getFloatAttribute(h,"y");d.removeElement(h);var g=p.getFloatAttribute(u,"x"),v=p.getFloatAttribute(u,"y");return p.setMultipleAttributes(c,["x","y"],[-g+f,-v+m]),e.appendChild(c),a},t.createLinkIcon=function(t){var e=d.cloneElementWithId("LINK"),r=d.findChildOfType(e,"path"),i=p.splitToFloats(p.getSubAttribute(t,"start-point"),","),n=p.splitToFloats(p.getSubAttribute(t,"end-point"),","),a=p.getFloatSubAttribute(t,"r");if(null==a)r.setAttribute("d","M "+i[0]+" "+i[1]+" L "+n[0]+" "+n[1]);else{var o=p.getSubAttribute(t,"large"),s=p.getSubAttribute(t,"sweep");r.setAttribute("d","M "+i[0]+" "+i[1]+" A "+a+" "+a+" 0 "+o+" "+s+" "+n[0]+" "+n[1])}var l=r.getTotalLength(),u=d.findChildOfType(e,"arrow"),c=p.pathAngleAt(r,l),h=p.radiansToDegrees(c);u.setAttribute("transform","translate("+n[0]+" "+n[1]+") rotate("+h+")");var f=p.getSubAttribute(t,"color");null!=f&&(r.setAttribute("stroke",f),u.setAttribute("fill",f));var m=p.getSubAttribute(t,"stroke-width");if(null!=m){r.setAttribute("stroke-width",m);var g=1+((E=parseInt(m))-1)/4;u.setAttribute("transform",u.getAttribute("transform")+" scale("+g+")")}var v=p.getSubAttribute(t,"polarity");if(null!=v){var b=d.createSvgElement("text");b.appendChild(d.createTextNode(v));var y=n[0]+8*Math.cos(c-Math.PI/2),A=n[1]+8*Math.sin(c-Math.PI/2)+4;p.setMultipleAttributes(b,["x","y"],[y,A]),p.setMultipleAttributes(b,["fill","text-anchor"],[r.getAttribute("stroke"),"middle"]),e.appendChild(b)}if("true"==p.getSubAttribute(t,"delay")){var T=d.createUseElement("link-delay");T.setAttribute("stroke",null==f?"CornflowerBlue":f);var C=r.getPointAtLength(l/2),S=p.radiansToDegrees(p.pathAngleAt(r,l/2));T.setAttribute("transform","translate("+C.x+" "+C.y+") rotate( "+S+")"),e.appendChild(T)}if("true"==p.getSubAttribute(t,"initial-value")){var E=p.getFloatAttribute(r,"stroke-width");r.setAttribute("stroke-dasharray",4*E+","+1.5*E)}return e},t.createCausalLoopIcon=function(t){var e="true"==p.getSubAttribute(t,"clockwise"),r=d.cloneElementWithId(e?"CAUSAL_LOOP_CW":"CAUSAL_LOOP_CCW"),i=d.findChildOfType(r,"loop"),n=d.findChildOfType(r,"arrow"),a=d.findChildOfType(r,"text"),o=p.getSubAttribute(t,"text");a.firstChild.textContent=o;var s=8*o.length;if(s>18){var l=(s+6)/2;i.setAttribute("d","M0 -"+l+" A "+l+" "+l+" 0 1 "+(e?1:0)+" "+(e?-l:l)+" 0"),n.setAttribute("transform","translate("+(e?-1:1)*(l-12)+" 0)")}var u=p.getSubAttribute(t,"color");return null!=u&&(i.setAttribute("stroke",u),n.setAttribute("fill",u),a.setAttribute("fill",u)),r},t.updateStockState=function(t,e){var r=p.splitToFloats(e,","),i=r.length,n=d.findChildOfType(t,"back"),a=d.findChildOfType(t,"bars");if(a.childElementCount<i){for(var o=a.firstElementChild;a.childElementCount<i;)a.appendChild(d.cloneElement(o));var s=p.getFloatAttribute(n,"width"),l=-s/2+1,u=(s-1)/i-1;do{p.setMultipleAttributes(o,["x","width"],[l,u]),l+=u+1,o=o.nextElementSibling}while(null!=o)}for(var c=1/0,h=-1/0,f=0,m=r;f<m.length;f++){var g=m[f];g<c&&(c=g),h<g&&(h=g)}var v=Math.max(Math.abs(c),Math.abs(h)),b=Math.pow(10,Math.ceil(Math.log10(v)));c<0&&(b*=2),b<=0&&(b=1);for(var y=p.getFloatAttribute(n,"height"),A=a.firstElementChild,T=0;T<i;T++){var C=(y-2)*(r[T]/b),S=void 0;r[T]>=0?S=c>=0?y/2-1-C:-C:(C=-C,S=0),p.setMultipleAttributes(A,["y","height"],[S,C]),A=A.nextElementSibling}},t.updateFlowDirection=function(t,e){var r;r="1"==e?"model-primitive-flow-forward":"-1"==e?"model-primitive-flow-backward":"",d.findChildOfType(t,"animation").setAttribute("class",r)},t}(),dp=function(){function t(){}return t.createStateIcon=function(t){var e=d.cloneElementWithId("STATE"),r=parseFloat(p.getSubAttribute(t,"width")),i=parseFloat(p.getSubAttribute(t,"height"));p.setMultipleAttributes(e,["width","height"],[r,i]);var n=p.getSubAttribute(t,"color"),a="true"==p.getSubAttribute(t,"composite");return e.setAttribute("composite",a?"true":"false"),null!=n?(e.setAttribute("fill",n),e.setAttribute("stroke",p.changeBrightness(n,.8))):a&&(e.setAttribute("fill","none"),e.setAttribute("stroke","Gray")),e.setAttribute("stroke-width",a?"2":"1"),e},t.createFinalStateIcon=function(){return d.cloneElementWithId("FINAL_STATE")},t.createTransitionIcon=function(t){for(var e=d.cloneElementWithId("TRANSITION"),r=d.findChildOfType(e,"path"),i=p.getSubAttribute(t,"points"),n=p.splitSkipEmpty(i,";"),a="",o=0;o<n.length;o++){var s=p.splitToFloats(n[o],",");if(o==n.length-1){var l=p.splitToFloats(n[o-1],","),u=Math.atan2(s[1]-l[1],s[0]-l[0]);s[0]-=Math.round(4*Math.cos(u)),s[1]-=Math.round(4*Math.sin(u));var c=p.radiansToDegrees(u),h="translate("+s[0]+","+s[1]+") rotate("+c+")";d.findChildOfType(e,"arrow").setAttribute("transform",h)}a+=(0==o?"M ":"L ")+s[0]+" "+s[1]+" "}var f=p.roundPathCorners(a,10,!1);r.setAttribute("d",f);var m=p.getSubAttribute(t,"trigger");if(null!=m){var g=d.createUseElement("transition-icon-"+m);g.setAttribute("type","trigger"),g.setAttribute("stroke","Black"),d.findChildOfType(e,"path").setAttribute("d",f);var v=p.getFloatSubAttribute(t,"icon-offset"),b=r.getPointAtLength(v);g.setAttribute("transform","translate("+b.x+","+b.y+")"),e.appendChild(g)}return e},t.createStatePointerIcon=function(t,e){var r=d.cloneElementWithId("STATE_POINTER"),i=d.findChildOfType(r,"line"),n=d.findChildOfType(r,"entry-dash"),a=p.getSubAttribute(t,"dxdy"),o=p.splitToFloats(a,","),s=Math.atan2(o[1],o[0]);o[0]-=Math.round(4*Math.cos(s)),o[1]-=Math.round(4*Math.sin(s)),p.setMultipleAttributes(i,["x2","y2"],[o[0],o[1]]);var l=p.radiansToDegrees(s),u="translate("+o[0]+","+o[1]+") rotate("+l+")";return d.findChildOfType(r,"arrow").setAttribute("transform",u),e?n.setAttribute("transform","rotate("+l+")"):d.removeElement(n),r},t.updateStateState=function(t,e,r){var i="true"==r;if("STATE"==e)if(i)p.setMultipleAttributes(t,["stroke","stroke-width"],["Red",2]);else{var n="true"==t.getAttribute("composite")?2:1,a=t.getAttribute("fill"),o="none"==a?"Gray":p.changeBrightness(a,.8);p.setMultipleAttributes(t,["stroke","stroke-width"],[o,n])}else{var s=d.findChildOfType(t,"outer");n=i?2:1,o=i?"Red":"Black";p.setMultipleAttributes(s,["stroke","stroke-width"],[o,n])}},t.updateTransitionState=function(t,e){var r=d.findChildOfType(t,"path"),i=d.findChildOfType(t,"arrow"),n=d.findChildOfType(t,"trigger"),a="Black";switch(e){case"SCHEDULED":a="Blue";break;case"CURRENT":a="Red"}r.setAttribute("stroke",a),i.setAttribute("fill",a),null!=n&&n.setAttribute("stroke",a)},t}(),pp=function(){function t(t){this.frameDrawing=t}return t.create=function(){return d.cloneElementWithId("shape-model-primitives")},t.prototype.update=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"static-info":for(var o=p.splitSkipEmpty(i[a],"\n"),s=function(r){var i=p.splitSkipEmpty(o[r],"|"),a=p.getSubAttribute(i,"index"),s=p.getSubAttribute(i,"type"),l=p.getSubAttribute(i,"name"),u=p.getSubAttribute(i,"x"),c=p.getSubAttribute(i,"y"),h=d.cloneElementWithId("model-primitive");h.id=e.id+"-"+a,h.setAttribute("type",s),h.setAttribute("transform","translate("+u+","+c+")");var m=d.findChildOfType(h,"label"),g=d.findChildOfType(h,"info");if(m.appendChild(d.createTextNode(l)),"false"==p.getSubAttribute(i,"show-label"))m.setAttribute("visibility","hidden"),g.setAttribute("visibility","hidden");else{var v=parseFloat(p.getSubAttribute(i,"label-dx")),b=parseFloat(p.getSubAttribute(i,"label-dy"));if("FLOW"==s){var y=p.getSubAttribute(i,"valve-pos"),A=p.splitToFloats(y,",");v+=A[0],b+=A[1]}p.setMultipleAttributes(m,["x","y"],[v,b+4]),p.setMultipleAttributes(g,["x","y"],[v,b+4+9]),g.appendChild(d.createTextNode(""))}var T=void 0;switch(s){case"LINK_TO_AGENTS":T=t.createLinkToAgents(i);break;case"CONNECTOR":T=t.createConnectorIcon(i);break;case"STOCK":T=hp.createStockIcon(i);break;case"FLOW":T=hp.createFlowIcon(i);break;case"DYNAMIC_VARIABLE":T=hp.createDynamicVariableIcon(i);break;case"SHADOW":T=hp.createShadowIconAndInfo(e,h,i);break;case"LINK":T=hp.createLinkIcon(i);break;case"CAUSAL_LOOP":T=hp.createCausalLoopIcon(i);break;case"STATE":T=dp.createStateIcon(i);break;case"FINAL_STATE":T=dp.createFinalStateIcon();break;case"TRANSITION":T=dp.createTransitionIcon(i);break;case"STATECHART_ENTRY_POINT":T=dp.createStatePointerIcon(i,!0);break;case"INITIAL_STATE_POINTER":T=dp.createStatePointerIcon(i,!1);break;default:var C=null==document.getElementById(s)?"DEFAULT_MODEL_ELEMENT":s;T=d.createUseElement(C)}T.setAttribute("type","icon"),h.insertBefore(T,m),t.responsiveElements.indexOf(s)>=0&&new f(h,function(t){return n.onModelPrimitiveMouseEvent(h,"mouseover")},function(t){return n.onModelPrimitiveMouseEvent(h,"mouseout")},null,function(t){return n.onModelPrimitiveMouseEvent(h,"click")},null),e.appendChild(h)},l=0;l<o.length;l++)s(l);break;case"update":var u=parseInt(i[a]),c=i[a].slice(i[a].indexOf(" ")+1),h=p.splitSkipEmpty(c,"|"),m=d.findChildWithId(e,e.id+"-"+u),g=d.findChildOfType(m,"icon"),v=m.getAttribute("type");for(l=0;l<h.length;l++){var b=h[l].split(":");switch(b[0]){case"label":case"info":d.findChildOfType(m,b[0]).firstChild.textContent=b[1];break;case"info-flag":var y=d.findChildOfType(m,"info"),A="model-primitive-info";"warning"==b[1]&&(A="model-primitive-info-warning"),y.setAttribute("class",A);break;case"null":var T=v+("true"==b[1]?"_NULL":"");d.changeUseHref(g,T);break;case"link-empty":p.setMultipleAttributes(g,["stroke","fill"],"true"==b[1]?["DarkGray","Gainsboro"]:["SteelBlue","LightBlue"]);break;case"standard-icon":g.setAttribute("visibility","true"==b[1]?"inherit":"hidden");break;case"event-state":d.changeUseHref(g,"EVENT_"+b[1]);break;case"port-state":d.changeUseHref(g,"PORT_"+b[1]);break;case"empty":T=v+("true"==b[1]?"_EMPTY":""),d.changeUseHref(g,T);break;case"stock-state":hp.updateStockState(g,b[1]);break;case"flow-sign":hp.updateFlowDirection(g,b[1]);break;case"state-active":dp.updateStateState(g,v,b[1]);break;case"transition-state":dp.updateTransitionState(g,b[1])}}break;default:Dp.filterAndSetAttribute(e,r[a],i[a])}},t.createConnectorIcon=function(t){for(var e=d.cloneElementWithId("CONNECTOR"),r=p.getSubAttribute(t,"points"),i=p.splitSkipEmpty(r,";"),n="",a=0;a<i.length;a++){var o=i[a].split(",");if(0==a){n+="M ";var s=d.findChildOfType(e,"start-circle");p.setMultipleAttributes(s,["cx","cy"],o)}else n+="L ";if(n+=o[0]+" "+o[1]+" ",a==i.length-1){var l=d.findChildOfType(e,"end-circle");if(p.setMultipleAttributes(l,["cx","cy"],o),"true"==p.getSubAttribute(t,"sd")){var u=d.createUseElement("connector-arrow"),c=p.splitToFloats(i[a-1],","),h=Math.atan2(parseFloat(o[1])-c[1],parseFloat(o[0])-c[0]),f=p.radiansToDegrees(h),m="translate("+o[0]+","+o[1]+") rotate("+f+")";u.setAttribute("transform",m),e.appendChild(u)}}}var g=p.roundPathCorners(n,5,!1);return d.findChildOfType(e,"path").setAttribute("d",g),e},t.createLinkToAgents=function(t){var e=d.createSvgElement("g"),r=p.getSubAttribute(t,"multi"),i=p.getSubAttribute(t,"uni");return"true"==r&&e.appendChild(d.createUseElement("link-to-agents-multi")),e.appendChild(d.createUseElement("link-to-agents-basic")),"true"==i&&e.appendChild(d.createUseElement("link-to-agents-uni")),e},t.prototype.onModelPrimitiveMouseEvent=function(t,e){var r=d.findChildOfType(t,"icon"),i=d.findChildOfType(t,"label");switch(e){case"mouseover":r.setAttribute("class","clickable-over"),i.setAttribute("font-weight","600");break;case"mouseout":r.removeAttribute("class"),i.setAttribute("font-weight","400");break;case"click":this.frameDrawing.onModelPrimitiveClick(t.id)}},t.getModelPrimitiveByName=function(t,e){for(var r=0,i=d.childElements(t);r<i.length;r++){var n=i[r],a=d.findChildOfType(n,"label");if(null!=a&&a.innerHTML==e)return n}return null},t.responsiveElements=["PARAMETER_STATIC","VARIABLE","CONSTANT","COLLECTION","TABLE_FUNCTION","CUSTOM_DISTRIBUTION","EVENT","SCHEDULE","STATISTICS","DATASET","HISTOGRAM_DATA","HISTOGRAM_2D_DATA","OUTPUT","EXCEL_FILE","TEXT_FILE","DATABASE","LINK_TO_AGENTS","LINK_TO_CONTAINER","STOCK","FLOW","DYNAMIC_VARIABLE","SHADOW","TRAFFIC_LIGHT","EMBEDDED_AGENT_ICON","EMBEDDED_POPULATION_ICON"],t}(),fp=function(){function t(t,e,r,i,n){var a=this;this.dxrejected=0,this.dyrejected=0,this.ondrag=r,this.onup=i,this.cursor=n||"move",this.prevPtrCoords=[Math.round(t),Math.round(e)],this.onDocumentEventClosure=function(t){return a.onDocumentEvent(t)};var o=document.documentElement;o.addEventListener("mousemove",this.onDocumentEventClosure),o.addEventListener("mouseup",this.onDocumentEventClosure),o.addEventListener("touchmove",this.onDocumentEventClosure),o.addEventListener("touchend",this.onDocumentEventClosure)}return t.prototype.onDocumentEvent=function(t){var e,r;if("mousemove"==t.type||"touchmove"==t.type){if("mousemove"==t.type){var i=t;e=Math.round(i.pageX),r=Math.round(i.pageY)}else{var n=t;if(1!=n.touches.length)return void this.stop();e=Math.round(n.touches[0].pageX),r=Math.round(n.touches[0].pageY)}t.stopPropagation(),t.preventDefault();var a=e-this.prevPtrCoords[0],o=r-this.prevPtrCoords[1];if(this.prevPtrCoords=[e,r],null!=this.ondrag){document.documentElement.style.cursor=this.cursor;var s=Math.sign(this.dxrejected),l=Math.sign(this.dyrejected);if(this.dxrejected+=a,this.dyrejected+=o,Math.sign(this.dxrejected)!=s?(a=this.dxrejected,this.dxrejected=0):a=0,Math.sign(this.dyrejected)!=l?(o=this.dyrejected,this.dyrejected=0):o=0,0!=a||0!=o){var u=this.ondrag(t,a,o);u&&(this.dxrejected+=a-Math.round(u[0]),this.dyrejected+=o-Math.round(u[1]))}}}else t.preventDefault(),this.stop(),null!=this.onup&&this.onup(t)},t.prototype.stop=function(){var t=document.documentElement;t.removeEventListener("mousemove",this.onDocumentEventClosure),t.removeEventListener("mouseup",this.onDocumentEventClosure),t.removeEventListener("touchmove",this.onDocumentEventClosure),t.removeEventListener("touchend",this.onDocumentEventClosure),t.style.cursor="auto"},t}(),mp=function(){function t(){}return t.create=function(t,e,r,i,n,a,o){var s=d.cloneElementWithId("svg-button"),l=s.firstElementChild,u=s.lastElementChild;return u.setAttributeNS(d.xlinkns,"href","#"+t),l.setAttribute("fill",e),u.setAttribute("stroke",r),u.setAttribute("fill",r),new f(s,function(t){l.setAttribute("fill",i),u.setAttribute("stroke",n),u.setAttribute("fill",n)},function(t){l.setAttribute("fill",e),u.setAttribute("stroke",r),u.setAttribute("fill",r)},null,a,o),s},t}(),gp=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){for(var e=d.findChildOfType(t,"picture"),r=d.findChildOfType(t,"pictureback"),i=d.childElements(d.findChildOfType(t,"legend")),n=i.length,a="true"==t.getAttribute("show-pdf"),o="true"==t.getAttribute("show-cdf"),s="true"==t.getAttribute("show-mean"),l=p.getFloatAttribute(r,"height"),u=0;u<n;u++){var c=d.createSvgElement("g");if(a){var h=d.createSvgElement("g");c.appendChild(h)}if(o){var f=d.createSvgElement("polyline");p.setMultipleAttributes(f,["fill","stroke-width","stroke"],["none",i[u].getAttribute("cdf-line-width"),i[u].getAttribute("cdf-color")]),c.appendChild(f)}if(s){var m=d.createSvgElement("line");p.setMultipleAttributes(m,["stroke-width","stroke","y1","y2"],[i[u].getAttribute("cdf-line-width"),i[u].getAttribute("mean-color"),"0",l.toString()]),c.appendChild(m)}e.appendChild(c),Tp.addClickTapHandlerToChartItem(c)}},t.prototype.draw=function(t,e){for(var r=d.findChildOfType(t,"pictureback"),i=d.findChildOfType(t,"picture"),n=d.findChildOfType(t,"grid"),a=d.findChildOfType(t,"legend"),o=d.childElements(a),s="true"==t.getAttribute("show-pdf"),l="true"==t.getAttribute("show-cdf"),u="true"==t.getAttribute("show-mean"),c=p.getFloatAttribute(t,"bar-width"),h=p.getFloatAttribute(r,"width"),f=p.getFloatAttribute(r,"height"),m=p.splitSkipEmpty(e," "),g=m.length,v=1/0,b=-1/0,y=1/0,A=-1/0,T=[],C=[],S=[],E=[],w=[],k=[],x=[],M=[],O=[],I=0;I<g;I++)if(o[I].setAttribute("data",m[I]),"empty"!=m[I]){var _=p.splitSkipEmpty(m[I],":");T[I]="true"==_[0],C[I]="true"==_[1],S[I]=parseFloat(_[2]),E[I]=parseFloat(_[3]),w[I]=parseFloat(_[4]),k[I]=parseInt(_[5]),x[I]=parseInt(_[6]),M[I]=p.splitToFloats(_[7],"|");for(var L=0;L<M[I].length;L++)M[I][L]<y&&(y=M[I][L]),A<M[I][L]&&(A=M[I][L]);T[I]&&(O[I]=p.splitToFloats(_[8],"|")),S[I]<v&&(v=S[I]),b<E[I]&&(b=E[I])}v==1/0&&(v=0,b=0),y==1/0&&(y=0,A=1),this.chartScaleAndGrid.recalcChartScale(t,v,b,!1,!1),this.chartScaleAndGrid.recalcChartScale(t,0,A,!0,!1);var P=p.getFloatAttribute(n,"min-x"),R=p.getFloatAttribute(n,"max-x"),D=p.getFloatAttribute(n,"min-y"),F=p.getFloatAttribute(n,"max-y"),N=h/(R-P),B=f/(F-D),G=d.childElements(i);for(I=0;I<g;I++)if("empty"!=m[I]){"hidden"==G[I].getAttribute("visibility")&&G[I].setAttribute("visibility","inherit");var U=M[I].length,z=(E[I]-S[I])/U,W=o[I].getAttribute("original-color"),H=void 0,V=void 0;if(C[I]&&(H=o[I].getAttribute("low-color"),V=o[I].getAttribute("high-color")),s){var Y=G[I].firstElementChild,j=c*z*N,X=z*(1-c)/2;for(L=0;L<U;L++){var q=(S[I]+L*z+X-P)*N,Z=(F-M[I][L])*B,K=M[I][L]*B,Q=d.childElements(Y)[L];Q?Q.setAttribute("visibility","inherit"):(Q=d.createSvgElement("rect"),Y.appendChild(Q)),p.setMultipleAttributes(Q,["x","y","width","height"],[p.reducePrecision(q),p.reducePrecision(Z),p.reducePrecision(j),p.reducePrecision(K)]),T[I]&&C[I]&&L<k[I]?Q.setAttribute("fill",H):T[I]&&C[I]&&x[I]<L?Q.setAttribute("fill",V):Q.setAttribute("fill",W)}var J=d.childElements(Y);for(L=U;L<J.length;L++)J[L].setAttribute("visibility","hidden")}if(l){var $=s?G[I].firstElementChild.nextElementSibling:G[I].firstElementChild,tt="";if(tt+=(S[I]-P)*N+" "+f+" ",T[I])for(L=0;L<U;L++){tt+=p.reducePrecision((S[I]+(L+1)*z-P)*N)+","+p.reducePrecision((1-O[I][L])*f)+" "}$.setAttribute("points",tt)}if(u){var et=G[I].lastElementChild,rt=(w[I]-P)*N;et.setAttribute("x1",rt),et.setAttribute("x2",rt)}if("NONE"!=t.getAttribute("leg-pos")){var it=d.findChildOfType(o[I],"value");it.firstChild.textContent=p.formatNumber(w[I],2),it.setAttribute("fill",o[I].getAttribute("mean-color"))}}else G[I].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&Tp.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var n=d.findChildOfType(t,"picture"),a=d.childElements(n),o=d.childElements(a[e]),s=0;s<o.length;s++)o[s].setAttribute("visibility",r?"hidden":"inherit")},t.dataToString=function(t){for(var e=d.findChildOfType(t,"legend"),r=d.childElements(e),i=r.length,n="",a=0;a<i;a++){n+=Tp.getChratItemName(t,a)+"\n";var o=r[a].getAttribute("data");if("empty"==o)n+="no data\n";else{var s="true"==(o=p.splitSkipEmpty(o,":"))[0],l=parseFloat(o[2]),u=parseFloat(o[3]),c=p.splitToFloats(o[7],"|"),h=void 0;s&&(h=p.splitToFloats(o[8],"|")),n+="from\tto\tPDF",s&&(n+="\tCDF"),n+="\n";for(var f=c.length,m=(u-l)/f,g=l,v=0;v<f;v++)n+=g+"\t"+(g+m)+"\t"+c[v],s&&(n+="\t"+h[v]),n+="\n",g+=m}n+="\n"}return n},t}(),vp=function(){function t(t){this.frameDrawing=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",n=t.getAttribute("scale-type-"+i),a=d.findChildOfType(t,"grid"),o=d.findChildOfType(t,"pictureback"),s=d.findChildOfType(t,e?"pictureborderh":"pictureborderw"),l=a.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=l){var u=p.getFloatAttribute(o,"x"),c=p.getFloatAttribute(o,"y"),h=p.getFloatAttribute(o,"width"),f=p.getFloatAttribute(o,"height"),m="GRID_DEFAULT"==l,g="ChartBar"==r||"ChartStack"==r,v=t.getAttribute("bar-dir");e?g&&(!g||"NORTH"!=v&&"SOUTH"!=v)||p.setMultipleAttributes(s,["x1","y1","x2","y2"],m?[u,c,u,c+f]:[u+h,c,u+h,c+f]):g&&(!g||"EAST"!=v&&"WEST"!=v)||p.setMultipleAttributes(s,["x1","y1","x2","y2"],m?[u,c+f,u+h,c+f]:[u,c,u+h,c])}var b=a.getAttribute("grid-line-color");switch(a.setAttribute("grid-line-color",p.increaseTransparency(b,.5)),n){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var y=p.getFloatAttribute(t,"scale-min-"+i),A=p.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(y="ChartStack"==r?0:Math.min(0,y),A=Math.max(0,A)),this.recalcChartScale(t,y,A,e,!0);break;case"SCALE_TIME_WINDOW":A=Math.max(0,p.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,A,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,n){var a=t.getAttribute("type"),o=d.findChildOfType(t,"grid"),s=i?"min-y":"min-x",l=i?"max-y":"max-x";if(e!=p.getFloatAttribute(o,s)||r!=p.getFloatAttribute(o,l)){var u=e,c=r;if(u==c){if(n)return;u-=1,c+=1,"ChartTimeStack"==a&&u<0&&(u=0)}var h=d.findChildOfType(t,"pictureback"),f=p.getFloatAttribute(h,i?"height":"width"),m=i?25:45,g=(c-u)/Math.floor(f/m),v=Math.pow(10,Math.ceil(Math.log(c-u)/Math.log(10))-1),b=v/5;b<g&&(b=v/2)<g&&(b=v)<g&&(b=2*v)<g&&(b=5*v),n?(u=Math.ceil(u/b)*b,c=Math.floor(c/b)*b):(u=Math.floor(u/b)*b,c=Math.ceil(c/b)*b);var y=n?e:u,A=n?r:c;p.setMultipleAttributes(o,[s,l],[y,A]),this.drawChartGrid(t,u,c,b,y,A,i)}},t.prototype.drawChartGrid=function(t,e,r,i,n,a,o){var s=t.getAttribute("type"),l=d.findChildOfType(t,"grid"),u=l.getAttribute(o?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=u){var c=o?l.lastElementChild:l.firstElementChild,h=d.findChildOfType(t,"pictureback"),f=l.getAttribute("grid-text-color"),m=l.getAttribute("grid-line-color"),g=o?"scale-type-y":"scale-type-x",v="SCALE_100_PERCENT"==t.getAttribute(g),b="SCALE_TIME_WINDOW"==t.getAttribute(g)?t.getAttribute("date-format-pattern"):"null",y=Math.round((r-e)/i)+1,A="GRID_DEFAULT"==u,T=!0;if("ChartBar"==s||"ChartStack"==s){var C=t.getAttribute("bar-dir");"SOUTH"!=C&&"WEST"!=C||(T=!1)}for(var S=p.getFloatAttribute(h,"x"),E=p.getFloatAttribute(h,"y"),w=p.getFloatAttribute(h,"width"),k=p.getFloatAttribute(h,"height"),x=a-n,M=(o?k:w)/x,O=i*M;c.childElementCount<y;){var I=d.cloneElementWithId("grid-item");c.appendChild(I)}for(var _=d.childElements(c),L=e,P=o?T?E+(a-e)*M:E+(e-n)*M:T?S+(e-n)*M:S+(a-e)*M,R=0;R<y;R++){var D=o?A?S-4:S:P,F=o?P:A?E+k+4:E+k,N=o?A?S+w:S+w+4:P,B=o?P:A?E:E-4,G=o?A?D-3:N+3:D,U=o?F+3:A?F+11:B-3,z=o?A?"end":"start":"middle";(I=_[R]).setAttribute("visibility","inherit");var W=I.lastElementChild;p.setMultipleAttributes(W,["x1","x2","y1","y2","stroke"],[D,N,F,B,m]);var H=I.firstElementChild;p.setMultipleAttributes(H,["x","y","text-anchor","fill"],[G,U,z,f]);var V=void 0;V=v?p.formatPercent(L):"null"!=b?this.gridFormattedDate(L,x,b):p.formatNumber(L,2),H.firstChild.textContent=V,L+=i,P+=o?T?-O:+O:T?+O:-O}for(R=y;R<_.length;R++)_[R].setAttribute("visibility","hidden")}},t.prototype.gridFormattedDate=function(t,e,r){var i=this.frameDrawing.toDate(t),n=this.frameDrawing.toMilliseconds(e);return n>5*p.YEAR?p.formatDate(i,"YYYY"):n>5*p.MONTH?p.formatDate(i,"MMMYYYY"):n>5*p.DAY?p.formatDate(i,"DDMMM"):n>5*p.HOUR?p.formatDate(i,"DDMMHH"):n>5*p.MINUTE?p.formatDate(i,"HHmm"):p.formatDate(i,"mmss")},t}(),bp=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e,r,i=t.getAttribute("type"),n=d.findChildOfType(t,"pictureback"),a=d.findChildOfType(t,"picture"),o=d.findChildOfType(t,"legend"),s=d.childElements(o),l=s.length,u=p.getFloatAttribute(n,"width"),c=p.getFloatAttribute(n,"height");if("ChartBar"==i||"ChartStack"==i){var h=t.getAttribute("bar-dir");e="NORTH"==h||"SOUTH"==h;var f=p.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?u/l:c/l)*f:(e?u:c)*f}for(var m=0;m<l;m++){var g=void 0,v=s[m].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(g=d.createSvgElement("rect")).setAttribute("stroke","none"),g.setAttribute("fill",v);var b=void 0;e?(b=u/l,g.setAttribute("x","ChartBar"==i?b*m+(b-r)/2:(u-r)/2),g.setAttribute("width",r)):(b=c/l,g.setAttribute("y","ChartBar"==i?b*m+(b-r)/2:(c-r)/2),g.setAttribute("height",r)),a.appendChild(g);break;case"ChartPie":(g=d.createSvgElement("path")).setAttribute("stroke","none"),g.setAttribute("fill",v),a.appendChild(g)}Tp.addClickTapHandlerToChartItem(g)}for(m=0;m<l;m++)s[m].setAttribute("data","no data")},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=d.findChildOfType(t,"pictureback"),n=d.findChildOfType(t,"grid"),a=d.findChildOfType(t,"legend"),o=d.findChildOfType(t,"picture"),s=d.childElements(o),l=p.getFloatAttribute(i,"width"),u=p.getFloatAttribute(i,"height"),c=p.splitToFloats(e," "),h=c.length,f=1/0,m=-1/0,g=!1,v=0,b=0;b<h;b++)c[b]<f&&(f=c[b]),m<c[b]&&(m=c[b]),c[b]<0&&(g=!0),v+=c[b];var y=!1;if("ChartBar"==r||"ChartStack"==r){var A=t.getAttribute("bar-dir"),T="NORTH"==A||"SOUTH"==A;"ChartBar"==r?(f=Math.min(0,f),m=Math.max(0,m)):(f=0,m=Math.max(0,v));var C=t.getAttribute(T?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=C&&"SCALE_AUTO_FROM_0"!=C||this.chartScaleAndGrid.recalcChartScale(t,f,m,T,!1),y="SCALE_100_PERCENT"==C;var S=p.getFloatAttribute(n,T?"min-y":"min-x"),E=p.getFloatAttribute(n,T?"max-y":"max-x"),w=(T?u:l)/(E-S),k=0;for(b=0;b<h;b++)if("ChartStack"==r&&(g||0==v)||"ChartBar"==r&&y&&(g||0==v))s[b].setAttribute(T?"height":"width",0);else{var x=y?c[b]/v:c[b],M=Math.abs(x),O=void 0;if("ChartBar"==r)switch(A){case"NORTH":case"WEST":O=x>0?E-x:E;break;case"SOUTH":case"EAST":O=x<0?x-S:-S}else{switch(A){case"NORTH":case"WEST":O=E-(x+k);break;case"SOUTH":case"EAST":O=-S+k}k+=x}M*=w;var I=T?u:l;(O*=w)<0?(M-=-O,O=0):O+M>I&&(M-=O+M-I),M<0&&(M=0),T?(s[b].setAttribute("y",O),s[b].setAttribute("height",M)):(s[b].setAttribute("x",O),s[b].setAttribute("width",M))}}else{var _=-Math.PI/2;for(b=0;b<h;b++){var L=v<=0||g?0:2*Math.PI*(c[b]/v),P=l/2,R=u/2,D=p.sectorData(P,R,P,R,_,L);s[b].setAttribute("d",D),_+=L}}("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&y)&&g?Tp.showChartWarning(t,"Neg!"):Tp.hideChartWarning(t);var F=d.childElements(a);for(b=0;b<h;b++)F[b].setAttribute("data",c[b]);if("NONE"!=t.getAttribute("leg-pos")){for(b=0;b<h;b++){var N=d.findChildOfType(F[b],"value"),B=p.formatNumber(c[b],2);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&y)&&v>0&&!g&&(B+=" ("+p.formatPercent(c[b]/v)+")"),N.firstChild.textContent=B,N.setAttribute("fill",c[b]>=0?"royalBlue":"fireBrick")}Tp.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){d.childElements(d.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t.dataToString=function(t){for(var e=d.findChildOfType(t,"legend"),r=d.childElements(e),i=r.length,n="",a=0;a<i;a++){n+=Tp.getChratItemName(t,a)+"\t"+r[a].getAttribute("data")+"\n"}return n},t}(),yp=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=d.findChildOfType(t,"picture"),r=d.findChildOfType(t,"pictureback"),i=p.getFloatAttribute(r,"x"),n=p.getFloatAttribute(r,"y"),a=p.getFloatAttribute(r,"width"),o=p.getFloatAttribute(r,"height"),s=d.cloneElementWithId("normal-text");s.setAttribute("fill","grey"),s.setAttribute("text-anchor","middle"),s.setAttribute("x",(i+a/2).toString()),s.setAttribute("y",(n+o/2+3).toString()),s.firstChild.textContent="Not supported at the moment",e.appendChild(s)},t.draw=function(t,e){},t.setItemLook=function(t,e,r,i){},t.dataToString=function(t){return"N/A"},t}(),Ap=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=d.findChildOfType(t,"picture"),r=d.findChildOfType(t,"pictureback"),i=p.getFloatAttribute(r,"height"),n=d.childElements(d.findChildOfType(t,"legend")),a=n.length,o=i/a,s=o*p.getFloatAttribute(t,"bar-width"),l=(o-s)/2;t.setAttribute("rect-height",p.reducePrecision(s).toString());for(var u=0;u<a;u++){n[u].setAttribute("data","empty");var c=d.createSvgElement("g");c.setAttribute("transform","translate(0,"+(u*o+l)+")"),e.appendChild(c),Tp.addClickTapHandlerToChartItem(c)}},t.prototype.draw=function(e,r){for(var i=d.findChildOfType(e,"pictureback"),n=d.findChildOfType(e,"picture"),a=d.findChildOfType(e,"grid"),o=p.getFloatAttribute(i,"width"),s=Cp.mergeData(e,r),l=s.length,u=-1/0,c=0;c<l;c++)if("empty"==s[c])s[c]=[];else{s[c]=p.splitSkipEmpty(s[c],"|");for(var h=0;h<s[c].length;h++)s[c][h]=s[c][h].split(":"),s[c][h][0]=parseFloat(s[c][h][0]),s[c][h][1]=parseFloat(s[c][h][1]);var f=s[c][s[c].length-1][0];u<f&&(u=f)}u==1/0&&(u=0);for(c=0;c<l;c++)0!=s[c].length&&s[c][s[c].length-1][0]<u&&s[c].push([u,s[c][s[c].length-1][1]]);var m,g=p.getFloatAttribute(e,"scale-max-x");m="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(u,g):Math.max(u,g,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,m-g,m,!1,!0);var v=p.getFloatAttribute(a,"min-x"),b=o/(p.getFloatAttribute(a,"max-x")-v),y=d.childElements(n),A=p.getFloatAttribute(e,"rect-height"),T=t.colorMapping(e);for(c=0;c<l;c++){var C=y[c],S=d.childElements(C),E=S.length,w=0,k="",x=null;for(h=0;h<s[c].length;h++){var M=s[c][h][0],O=s[c][h][1];if(M<v)x=0,k=T(O);else if(null==x)x=(M-v)*b,k=T(O);else{var I=T(O);if(I!=k||h==s[c].length-1){var _=(M-v)*b,L=void 0;w<E?(L=S[w],w++,L.setAttribute("visibility","inherit")):(L=d.createSvgElement("rect"),C.appendChild(L)),p.setMultipleAttributes(L,["x","width","height","fill"],[p.reducePrecision(x),p.reducePrecision(_-x),A,k]),x=_,k=I}}}for(var P=w;P<E;P++)S[P].setAttribute("visibility","hidden")}},t.colorMapping=function(t){for(var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color"),i=p.splitSkipEmpty(e," "),n=[],a=[],o=function(t){var e=i[t].split(":"),r=void 0,o=parseFloat(e[1]);switch(e[0]){case"GREATER":r=function(t){return t>o};break;case"GREATER_OR_EQUALS":r=function(t){return t>=o};break;case"LESS":r=function(t){return t<o};break;case"LESS_OR_EQUALS":r=function(t){return t<=o};break;case"EQUALS":r=function(t){return t==o};break;case"NOT_EQUALS":r=function(t){return t!=o}}n[t]=r,a[t]=e[2]},s=0;s<i.length;s++)o(s);return function(t){for(var e=0;e<n.length;e++)if(n[e](t))return a[e];return r}},t.setItemLook=function(t,e,r,i){var n=d.findChildOfType(t,"picture");d.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),Tp=function(){function t(t){this.frameDrawing=t,this.chartScaleAndGrid=new vp(t),this.chart1D=new bp(t,this.chartScaleAndGrid),this.chart2D=new Cp(t,this.chartScaleAndGrid),this.chartHistogram=new gp(t,this.chartScaleAndGrid),this.chartHistogram2D=new yp(t,this.chartScaleAndGrid),this.chartTimeColor=new Ap(t,this.chartScaleAndGrid)}return t.create=function(){return d.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var n=e.getAttribute("type"),a=d.findChildOfType(e,"background"),o=d.findChildOfType(e,"pictureback"),s=d.findChildOfType(e,"pictureselect"),l=d.findChildOfType(e,"picture"),u=d.findChildOfType(e,"pictureborderh"),c=d.findChildOfType(e,"pictureborderw"),h=d.findChildOfType(e,"grid"),p=0;p<r.length;p++)switch(r[p]){case"width":case"height":case"fill":case"stroke":a.setAttribute(r[p],i[p]);break;case"pic-width":case"pic-height":o.setAttribute(r[p].substring(4),i[p]),s.setAttribute(r[p].substring(4),i[p]),l.setAttribute(r[p].substring(4),i[p]);break;case"pic-fill":o.setAttribute(r[p].substring(4),i[p]);break;case"pic-stroke":u.setAttribute(r[p].substring(4),i[p]),c.setAttribute(r[p].substring(4),i[p]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":h.setAttribute(r[p],i[p]);break;case"grid-completed":"ChartPie"!=n&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":t.addItem(e,i[p]);break;case"items-completed":t.setupLegendItemsLayout(e),t.setupPicture(e);break;case"data":this.drawPicture(e,i[p]);break;default:Dp.filterAndSetAttribute(e,r[p],i[p])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=d.findChildOfType(e,"background"),n=d.findChildOfType(e,"pictureback"),a=d.findChildOfType(e,"pictureselect"),o=d.findChildOfType(e,"picture"),s=d.findChildOfType(e,"pictureborderh"),l=d.findChildOfType(e,"pictureborderw"),u=d.findChildOfType(e,"warning"),c=d.findChildOfType(e,"legend"),h=d.findChildOfType(e,"controls"),f=e.getAttribute("leg-pos"),m=p.getFloatAttribute(i,"width"),g=p.getFloatAttribute(i,"height"),v=p.getFloatAttribute(e,"pic-offset-x"),b=p.getFloatAttribute(e,"pic-offset-y"),y=p.getFloatAttribute(n,"width"),A=p.getFloatAttribute(n,"height"),T=p.getFloatAttribute(e,"leg-size"),C=0,S=0,E=0,w=0;switch(f){case"SOUTH":C=v,S=g-T,E=m-v,w=T;break;case"WEST":v+=T,C=0,S=b,E=T,w=g-b;break;case"EAST":C=m-T,S=b,E=T,w=g-b;break;case"NORTH":b+=T,C=v,S=0,E=m-v,w=T}if(p.setMultipleAttributes(n,["x","y"],[v,b]),p.setMultipleAttributes(a,["x","y"],[v,b]),p.setMultipleAttributes(o,["x","y"],[v,b]),p.setMultipleAttributes(u,["x","y"],[v+y/2,b+A/2+3]),h.setAttribute("transform","translate("+(v+y)+","+b+")"),"NONE"==f?c.setAttribute("visibility","hidden"):(c.setAttribute("transform","translate("+C+","+S+")"),p.setMultipleAttributes(c,["width","height"],[E,w])),"ChartPie"==r){var k=y/2,x=A/2,M=d.createSvgElement("ellipse");p.setMultipleAttributes(M,["cx","cy","rx","ry","stroke","fill","visibility"],[v+k,b+x,k,x,"none",n.getAttribute("fill"),"hidden"]),e.insertBefore(M,n);var O=d.createSvgElement("ellipse");p.setMultipleAttributes(O,["cx","cy","rx","ry","stroke","fill"],[v+k,b+x,k,x,s.getAttribute("stroke"),"none"]),e.insertBefore(O,s),d.removeElement(s),d.removeElement(l)}var I=mp.create("icon-copy","rgba(220,220,220,0.7)","Black","DimGray","White",function(r){return t.copyToClipboard(e)},null);I.setAttribute("transform","translate(-20,0)"),h.appendChild(I),e.addEventListener("mouseover",function(e){return t.selectChart(e,!0)}),e.addEventListener("mouseout",function(e){return t.selectChart(e,!1)})},t.setupLegendItemsLayout=function(t){for(var e=d.findChildOfType(t,"legend"),r=d.childElements(e),i=p.getFloatAttribute(e,"width"),n=0,a=0,o=0;o<r.length;o++){var s=r[o],l=d.findChildOfType(s,"back"),u=p.getFloatAttribute(l,"width"),c=d.findChildOfType(s,"value"),h=6*c.firstChild.textContent.length,f=Math.max(u,p.getFloatAttribute(c,"x")+h);f>u&&l.setAttribute("width",f.toString()),0<n&&i<n+f&&(n=0,a+=20),s.setAttribute("transform","translate("+n+","+a+")"),n+=f+5}},t.showChartWarning=function(t,e){var r=d.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=d.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=d.findChildOfType(t,"picture"),r=d.findChildOfType(t,"legend");d.removeAllChildren(r),d.removeAllChildren(e)},t.addItem=function(e,r){var i=e.getAttribute("type"),n=d.findChildOfType(e,"legend"),a=r.split("\n"),o=a[0],s=a[1],l=d.cloneElementWithId("legend-item"),u=d.findChildOfType(l,"color"),c=d.findChildOfType(l,"name"),h=d.findChildOfType(l,"value");u.setAttribute("fill",o),l.setAttribute("original-color",o),c.setAttribute("fill",e.getAttribute("leg-text-color")),c.appendChild(d.createTextNode(s)),h.appendChild(d.createTextNode("")),n.appendChild(l);var f=c.getComputedTextLength();h.setAttribute("x",(p.getFloatAttribute(c,"x")+f+4).toString()),"ChartPlot"==i||"ChartTimePlot"==i?p.setMultipleAttributes(l,["draw-line","line-width","interpolation","point-style","fill-under-line"],[a[2],a[3],a[4],a[5],a[6]]):"ChartHistogram"==i&&p.setMultipleAttributes(l,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[a[2],a[3],a[4],a[5],a[6]]),t.addClickTapHandlerToChartItem(l)},t.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":bp.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":Cp.setup(t);break;case"ChartTimeColor":Ap.setup(t);break;case"ChartHistogram":gp.setup(t);break;case"ChartHistogram2D":yp.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":yp.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.selectChart=function(t,e){var r=t.currentTarget,i=d.findChildOfType(r,"pictureselect"),n=d.findChildOfType(r,"controls");i.setAttribute("visibility",e?"inherit":"hidden"),n.setAttribute("class",e?"shown-with-transition":"hidden-with-transition")},t.addClickTapHandlerToChartItem=function(e){new f(e,function(r){return t.selectChartItem(e,!0,!1,r)},function(r){return t.selectChartItem(e,!1,!1,r)},null,function(r){return t.selectChartItem(e,!0,!0,r)},null)},t.selectChartItem=function(e,r,i,n){for(var a=t.getChartShape(e),o=p.indexInParent(e),s=d.childElements(d.findChildOfType(a,"legend")),l=s[o],u="true"==l.getAttribute("selected"),c=!1,h=0;h<s.length;h++)if(h!=o&&"true"==s[h].getAttribute("selected")){c=!0;break}if(r&&"legend"!=e.parentNode.getAttribute("type")){var f=n,m=t.getChratItemName(a,o);Dp.showTooltip(m,f.clientX,f.clientY,"Black","White")}else Dp.hideTooltip();if(i)return u=!u,l.setAttribute("selected",u?"true":"false"),void t.setChartItemLook(a,o,!1,u);if(u||c){if(u)return;t.setChartItemLook(a,o,!r,r)}else{t.setChartItemLook(a,o,!1,r);for(h=0;h<s.length;h++)h!=o&&t.setChartItemLook(a,h,r,!1)}},t.setChartItemLook=function(e,r,i,n){var a=d.childElements(d.findChildOfType(e,"legend")),o=d.findChildOfType(a[r],"back"),s=d.findChildOfType(a[r],"color");o.setAttribute("class",n?"legend-item-background-selected":"legend-item-background");var l=i?t.colorItemGrayed:a[r].getAttribute("original-color");switch(s.setAttribute("fill",l),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":bp.setItemLook(e,r,i,l);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":Cp.setItemLook(e,r,i,l);break;case"ChartTimeColor":Ap.setItemLook(e,r,i,l);break;case"ChartHistogram":gp.setItemLook(e,r,i,l);break;case"ChartHistogram2D":yp.setItemLook(e,r,i,l)}},t.copyToClipboard=function(t){var e;switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":e=bp.dataToString(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":e=Cp.dataToString(t);break;case"ChartHistogram":e=gp.dataToString(t);break;case"ChartHistogram2D":e=yp.dataToString(t)}p.copyToClipboard(e)},t.datasetToString=function(t,e){return"\t"+t+"\n"+(e=(e=e.replace(/\|/g,"\n")).replace(/:/g,"\t"))},t.datasetsWithSharedXToString=function(t,e){for(var r=e.length,i=e,n=0;n<r;n++)if("empty"==i[n])i[n]=[];else{i[n]=p.splitSkipEmpty(i[n],"|");for(var a=0;a<i[n].length;a++)i[n][a]=i[n][a].split(":")}var o="";for(n=0;n<r;n++)o+="\t"+t[n];o+="\n";var s=new Array(r);for(s.fill(0);;){var l=1/0;for(n=0;n<r;n++)s[n]<e[n].length&&parseFloat(e[n][s[n]][0])<l&&(l=parseFloat(e[n][s[n]][0]));if(l==1/0)return o;o+=l;for(n=0;n<r;n++)o+="\t",s[n]<e[n].length&&parseFloat(e[n][s[n]][0])==l&&(o+=e[n][s[n]][1],s[n]++);o+="\n"}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.getChratItemName=function(t,e){var r=d.findChildOfType(t,"legend"),i=d.childElements(r);return d.findChildOfType(i[e],"name").firstChild.textContent},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),Cp=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(e){for(var r=e.getAttribute("type"),i=d.findChildOfType(e,"picture"),n=d.childElements(d.findChildOfType(e,"legend")),a=n.length,o=0;o<a;o++){var s=n[o].getAttribute("original-color"),l=d.createSvgElement("g");switch(n[o].setAttribute("data","empty"),r){case"ChartPlot":case"ChartTimePlot":if("true"==n[o].getAttribute("draw-line")){var u=d.createSvgElement("polyline");if(u.setAttribute("fill","none"),u.setAttribute("stroke",s),u.setAttribute("stroke-width",n[o].getAttribute("line-width")),l.appendChild(u),"true"==n[o].getAttribute("fill-under-line")){var c=d.createSvgElement("polyline");c.setAttribute("stroke","none"),c.setAttribute("fill",p.increaseTransparency(s,t.timePlotAlpha)),l.appendChild(c)}}if("POINT_NONE"!=n[o].getAttribute("point-style")){var h=d.createSvgElement("g");h.setAttribute("fill",s),l.appendChild(h)}break;case"ChartTimeStack":var f=d.createSvgElement("polyline");f.setAttribute("stroke-width","1"),f.setAttribute("stroke",s),f.setAttribute("fill","none"),l.appendChild(f);var m=d.createSvgElement("polyline");m.setAttribute("stroke","none"),m.setAttribute("fill",p.increaseTransparency(s,t.stackChartAlpha)),l.appendChild(m)}i.appendChild(l),Tp.addClickTapHandlerToChartItem(l)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),n=d.findChildOfType(e,"pictureback"),a=d.findChildOfType(e,"picture"),o=d.findChildOfType(e,"grid"),s=d.childElements(d.findChildOfType(e,"legend")),l=p.getFloatAttribute(n,"width"),u=p.getFloatAttribute(n,"height"),c=u,h=t.mergeData(e,r),f=h.length,m=t.parseDataAndFindMinMax(h),g=m.datasets,v=m.minx,b=m.maxx,y=m.miny,A=m.maxy;if("ChartTimeStack"==i&&y<0)Tp.showChartWarning(e,"Neg!");else{Tp.hideChartWarning(e),"ChartTimeStack"==i&&(y=0,A=t.prepareChartTimeStackData(g));var T,C=e.getAttribute("scale-type-x"),S=e.getAttribute("scale-type-y"),E="SCALE_100_PERCENT"==S;if("SCALE_AUTO"==C)this.chartScaleAndGrid.recalcChartScale(e,v,b,!1,!1);else if("SCALE_TIME_WINDOW"==C){T=p.getFloatAttribute(e,"scale-max-x");var w=void 0;w="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(b,T):Math.max(b,T,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,w-T,w,!1,!0)}"SCALE_AUTO"==S&&this.chartScaleAndGrid.recalcChartScale(e,y,A,!0,!1);for(var k=p.getFloatAttribute(o,"min-x"),x=p.getFloatAttribute(o,"max-x"),M=p.getFloatAttribute(o,"min-y"),O=p.getFloatAttribute(o,"max-y"),I=l/(x-k),_=u/(O-M),L=d.childElements(a),P="",R=0;R<f;R++){var D=void 0,F=void 0,N=void 0,B=void 0,G=void 0,U=void 0,z=void 0,W=void 0,H=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(D="true"==s[R].getAttribute("draw-line"),F=s[R].getAttribute("point-style"),N="INTERPOLATION_STEP"==s[R].getAttribute("interpolation")),(D||"ChartTimeStack"==i)&&(G=(B=L[R].firstElementChild).nextElementSibling),F&&"POINT_NONE"!=F)switch(U=L[R].lastElementChild,F){case"POINT_CIRCLE":z="plot-point-circle",W=0,H=0;break;case"POINT_SQUARE":z="plot-point-square",W=-1.5,H=-1.5;break;case"POINT_TRIANGLE":z="plot-point-triangle",W=0,H=0}for(var V=void 0,Y=void 0,j="",X="",q=void 0,Z=void 0,K=0,Q=0;Q<g[R].length;Q++){var J=(g[R][Q][0]-k)*I,$=void 0;if(E){var tt=g[f-1][Q][1];$=tt<=0?0:g[R][Q][1]/tt}else $=g[R][Q][1];var et=(-$+O)*_;if(J<0&&(J=0),l<J&&(J=l),et<0&&(et=0),u<et&&(et=u),!(null!=V&&Math.abs(J-V)<Tp.chartTolerance&&Math.abs(et-Y)<Tp.chartTolerance)){if(J=p.reducePrecision(J),et=p.reducePrecision(et),0==Q&&(q=J),Z=J,B&&(N&&null!=V&&(j+=J+","+Y+" "),j+=J+","+et+" ",G&&(0==R&&(P=J+","+c+" "+P),X=J+","+et+" "+X)),U){var rt=d.childElements(U)[K];rt?rt.setAttribute("visibility","inherit"):(rt=d.createUseElement(z),U.appendChild(rt)),rt.setAttribute("x",W+J),rt.setAttribute("y",H+et)}K++,V=J,Y=et}}if(B&&(B.setAttribute("points",j),G))if("ChartTimePlot"==i){var it="";if(""!=j){var nt=O*_;nt<0&&(nt=0),u<nt&&(nt=u),it=Z+","+nt+" "+q+","+nt}G.setAttribute("points",j+it)}else G.setAttribute("points",j+P),P=X;if(U){var at=d.childElements(U);for(Q=K;Q<at.length;Q++)at[Q].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,n){var a=e.getAttribute("type"),o=d.childElements(d.findChildOfType(e,"legend")),s=d.childElements(d.findChildOfType(e,"picture"));if("ChartTimeStack"==a)s[r].firstElementChild.setAttribute("stroke",n),s[r].lastElementChild.setAttribute("fill",p.increaseTransparency(n,t.stackChartAlpha));else{if("true"==o[r].getAttribute("draw-line")){var l=s[r].firstElementChild;l.setAttribute("stroke",n);var u=l.nextElementSibling;u&&u.setAttribute("fill",p.increaseTransparency(n,t.timePlotAlpha))}"POINT_NONE"!=o[r].getAttribute("point-style")&&s[r].lastElementChild.setAttribute("fill",n)}},t.mergeData=function(e,r){for(var i=d.findChildOfType(e,"legend"),n=d.childElements(i),a=p.splitSkipEmpty(r," "),o=a.length,s=[],l=0;l<o;l++){var u=n[l].getAttribute("data"),c=t.mergeDataset(u,a[l]);n[l].setAttribute("data",c),s.push(c)}return s},t.mergeDataset=function(t,e){var r=p.splitSkipEmpty(e,"#"),i=parseInt(r[0]),n=parseInt(r[1]),a=r[2];if("empty"==t||0==n)return a;var o=p.splitSkipEmpty(t,"|");o.splice(0,i),o.splice(n);var s=o.join("|")+"|";return"empty"==a?s:s+a},t.parseDataAndFindMinMax=function(t){for(var e=t,r=e.length,i=1/0,n=-1/0,a=1/0,o=-1/0,s=0;s<r;s++)if("empty"==e[s])e[s]=[];else{e[s]=p.splitSkipEmpty(e[s],"|");for(var l=0;l<e[s].length;l++){e[s][l]=e[s][l].split(":");var u=e[s][l][0]=parseFloat(e[s][l][0]),c=e[s][l][1]=parseFloat(e[s][l][1]);u<i&&(i=u),n<u&&(n=u),c<a&&(a=c),o<c&&(o=c)}}return i==1/0&&(i=0,n=0),a==1/0&&(a=0,o=0),{datasets:e,minx:i,maxx:n,miny:a,maxy:o}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a].length<=i||t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.dataToString=function(t){var e=t.getAttribute("type"),r=d.findChildOfType(t,"legend"),i=d.childElements(r),n=i.length;if("ChartPlot"==e){for(var a="",o=0;o<n;o++){var s=Tp.getChratItemName(t,o),l=i[o].getAttribute("data");a+=Tp.datasetToString(s,l)+"\n"}return a}var u=new Array(n);for(l=new Array(n),o=0;o<n;o++)u[o]=Tp.getChratItemName(t,o),l[o]=i[o].getAttribute("data");return Tp.datasetsWithSharedXToString(u,l)},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),Sp=function(){function t(t){this.frameDrawing=t}return t.prototype.create=function(){var e=this,r=d.cloneElementWithId("shape-inspect"),i=d.findChildOfType(r,"svg"),n=d.findChildOfType(i,"info"),a=d.findChildOfType(i,"chart"),o=d.findChildOfType(i,"controls"),s=mp.create("icon-info","Moccasin","DarkRed","Wheat","DarkRed",function(t){d.bringElementToFront(r),n.setAttribute("class","shown-with-transition"),a.setAttribute("class","hidden-with-transition")},null);s.setAttribute("type","show-info"),s.setAttribute("transform","translate(-80,0)"),o.appendChild(s);var l=mp.create("icon-chart","Ivory","DarkRed","Beige","DarkRed",function(t){d.bringElementToFront(r),n.setAttribute("class","hidden-with-transition"),a.setAttribute("class","shown-with-transition")},null);l.setAttribute("type","show-chart"),l.setAttribute("transform","translate(-60,0)"),o.appendChild(l);var u=mp.create("icon-copy","LightSalmon","DarkRed","IndianRed","White",function(e){d.bringElementToFront(r),t.copyInspect(r)},null);u.setAttribute("transform","translate(-40,0)"),o.appendChild(u);var c=mp.create("icon-close","LightSalmon","DarkRed","IndianRed","White",function(t){return e.closeInspct(r)},null);c.setAttribute("transform","translate(-20,0)"),o.appendChild(c);var h=function(e){return t.onInspectEvent(e)};return r.addEventListener("mouseover",h),r.addEventListener("mouseout",h),r.addEventListener("mousedown",h),r.addEventListener("wheel",h),r.addEventListener("touchstart",h),r},t.update=function(e,r,i){for(var n=d.findChildOfType(e,"svg"),a=d.findChildOfType(n,"name-text"),o=d.findChildOfType(n,"info"),s=d.findChildOfType(o,"info-text"),l=0;l<r.length;l++)switch(r[l]){case"name":a.firstChild.textContent=i[l];break;case"info":var u=d.findChildOfType(n,"chart");s.setAttribute("content",i[l]);for(var c=i[l].split("\n"),h=0;h<c.length;h++)c[h]=p.replaceTabsWithSpaces(c[h],8);if(cp.drawMultiLineText(s,c,12,0),c.length<=2&&null==u){var f=p.getFloatAttribute(n,"height");t.resizeInspect(e,0,60-f)}else t.scrollInfoText(e,0);break;case"dataset-names":var m=p.splitSkipEmpty(i[l]," ");u=d.findChildOfType(n,"chart");var g=d.findChildOfType(u,"plot"),v=m.length;if(0==v){d.removeElement(u);var b=d.findChildOfType(n,"controls"),y=d.findChildOfType(b,"show-info"),A=d.findChildOfType(b,"show-chart");d.removeElement(y),d.removeElement(A)}else{var T=d.findChildOfType(g,"picture");for(h=0;h<v;h++){var C=d.cloneElementWithId("inspect-plot-item");C.setAttribute("name",m[h]);var S=t.plotColors[h%t.plotColors.length];C.setAttribute("stroke",S),T.appendChild(C)}}break;case"data":u=d.findChildOfType(n,"chart"),g=d.findChildOfType(u,"plot");var E=d.findChildOfType(g,"picture"),w=d.childElements(E),k=p.splitSkipEmpty(i[l]," ");v=k.length;var x=[];for(h=0;h<v;h++){var M=w[h].getAttribute("data"),O=Cp.mergeDataset(M,k[h]);w[h].setAttribute("data",O),x.push(O)}var I=Cp.parseDataAndFindMinMax(x),_=I.datasets,L=I.minx,P=I.maxx,R=I.miny,D=I.maxy;t.recalcChartScaleAndDrawGrid(u,L,P,!1,!1),t.recalcChartScaleAndDrawGrid(u,R,D,!0,!1),t.drawPlotLines(u,_);break;default:Dp.filterAndSetAttribute(e,r[l],i[l])}},t.recalcChartScaleAndDrawGrid=function(e,r,i,n,a){var o=d.findChildOfType(e,"plot"),s=d.findChildOfType(o,"grid"),l=n?"min-y":"min-x",u=n?"max-y":"max-x",c=r,h=i;c==h&&(c-=1,h+=1);var f=d.findChildOfType(e,"chart-back"),m=p.getFloatAttribute(f,n?"height":"width")-(n?17:10),g=n?25:45,v=(h-c)/Math.floor(m/g),b=Math.pow(10,Math.ceil(Math.log(h-c)/Math.log(10))-1),y=b/5;y<v&&(y=b/2)<v&&(y=b)<v&&(y=2*b)<v&&(y=5*b),c=Math.floor(c/y)*y,h=Math.ceil(h/y)*y,(a||c!=p.getFloatAttribute(s,l)||h!=p.getFloatAttribute(s,u))&&(p.setMultipleAttributes(s,[l,u],[c,h]),t.drawChartGrid(e,c,h,y,n))},t.drawChartGrid=function(t,e,r,i,n){for(var a=d.findChildOfType(t,"plot"),o=d.findChildOfType(a,"grid"),s=n?o.lastElementChild:o.firstElementChild,l=d.findChildOfType(o,"zero-line"),u=d.findChildOfType(t,"chart-back"),c=Math.round((r-e)/i)+1,h=p.getFloatAttribute(u,"width")-10,f=p.getFloatAttribute(u,"height")-17,m=(n?f:h)/(r-e),g=i*m;s.childElementCount<c;){var v=d.cloneElementWithId("inspect-grid-item");s.appendChild(v)}for(var b=d.childElements(s),y=e,A=n?(r-e)*m:0,T=!1,C=0;C<c;C++){var S=n?0:A,E=n?A:f,w=n?h:A,k=n?A:0,x=n?S+1:S,M=n?0==C?E-2:C==c-1?E+8:E-3:E+9,O=n?"start":0==C?"start":C==c-1?"end":"middle";(v=b[C]).setAttribute("visibility","inherit");var I=v.lastElementChild;p.setMultipleAttributes(I,["x1","x2","y1","y2"],[S,w,E,k]),n&&Math.abs(y)<i/10&&(p.setMultipleAttributes(l,["x1","x2","y1","y2"],[S,w,E,k]),T=!0);var _=v.firstElementChild;p.setMultipleAttributes(_,["x","y","text-anchor"],[x,M,O]),_.firstChild.textContent=p.formatNumber(y,2),y+=i,A+=n?-g:+g}for(C=c;C<b.length;C++)b[C].setAttribute("visibility","hidden");n&&l.setAttribute("visibility",T?"inherit":"hidden")},t.drawPlotLines=function(t,e){for(var r=d.findChildOfType(t,"plot"),i=d.findChildOfType(t,"chart-back"),n=d.findChildOfType(r,"picture"),a=d.findChildOfType(r,"grid"),o=p.getFloatAttribute(i,"width")-10,s=p.getFloatAttribute(i,"height")-17,l=p.getFloatAttribute(a,"min-x"),u=p.getFloatAttribute(a,"max-x"),c=p.getFloatAttribute(a,"min-y"),h=p.getFloatAttribute(a,"max-y"),f=o/(u-l),m=s/(h-c),g=d.childElements(n),v=g.length,b=0;b<v;b++){for(var y=void 0,A=void 0,T="",C=0;C<e[b].length;C++){var S=0+(e[b][C][0]-l)*f,E=0+(-e[b][C][1]+h)*m;S<0&&(S=0),0+o<S&&(S=0+o),E<0&&(E=0),0+s<E&&(E=0+s),null!=y&&Math.abs(S-y)<Tp.chartTolerance&&Math.abs(E-A)<Tp.chartTolerance||(T+=(S=p.reducePrecision(S))+","+(E=p.reducePrecision(E))+" ",0,y=S,A=E)}g[b].setAttribute("points",T)}},t.redrawChart=function(e){var r=d.findChildOfType(e,"plot");if(null!=r){for(var i=d.findChildOfType(r,"picture"),n=d.childElements(i),a=n.length,o=[],s=0;s<a;s++){var l=n[s].getAttribute("data");o.push(l)}var u=Cp.parseDataAndFindMinMax(o),c=u.datasets,h=u.minx,p=u.maxx,f=u.miny,m=u.maxy;t.recalcChartScaleAndDrawGrid(e,h,p,!1,!0),t.recalcChartScaleAndDrawGrid(e,f,m,!0,!0),t.drawPlotLines(e,c)}},t.onInspectEvent=function(e){var r=e.currentTarget,i=e.target,n=d.findChildOfType(r,"svg"),a=d.findChildOfType(n,"info"),o=d.findChildOfType(a,"info-back"),s="inherit"==d.findChildOfType(a,"scrollbar").getAttribute("visibility");if(e instanceof MouseEvent){var l=e;switch(e.type){case"mouseover":e.stopPropagation(),t.onInspectMouseOver(r,e);break;case"mouseout":t.onInspectMouseOut(r,l);break;case"mousedown":1==l.which&&(l.stopPropagation(),l.preventDefault(),t.onInspectMouseDown(r,l));break;case"wheel":if(!l.altKey&&!l.ctrlKey&&i==o&&s){var u=e;e.stopPropagation(),e.preventDefault(),t.scrollInfoText(r,u.deltaY<0?36:-36)}}}else if(p.touchEventExists()&&e instanceof TouchEvent){var c=e;if(c.touches.length>1)return;switch(c.type){case"touchstart":c.stopPropagation(),c.preventDefault(),t.onInspectMouseOver(r,c),t.onInspectMouseDown(r,c)}}},t.onInspectMouseOver=function(e,r){if(!(t.resizing||t.moving||t.scrolling)){var i=d.findChildOfType(e,"svg"),n=d.findChildOfType(i,"name-back"),a=d.findChildOfType(i,"controls"),o=d.findChildOfType(a,"resize"),s=d.findChildOfType(i,"chart"),l=null==s?null:d.findChildOfType(s,"plot"),u=null==l?null:d.findChildOfType(l,"picture"),c=r.target;if(c==o)o.setAttribute("fill","IndianRed"),o.style.cursor="nw-resize";else if(c==n)n.setAttribute("fill","rgb(197,163,120)"),n.style.cursor="move";else if(c.parentNode==u){var h=void 0,f=void 0;if(r instanceof MouseEvent){var m=r;h=m.clientX,f=m.clientY}else{var g=r;h=g.touches[0].clientX,f=g.touches[0].clientY}var v=c.getAttribute("name"),b=p.removeTransparency(c.getAttribute("stroke"));Dp.showTooltip(v,h,f,b,"White")}a.setAttribute("class","shown-with-transition")}},t.onInspectMouseOut=function(e,r){if(!(t.resizing||t.moving||t.scrolling)){var i=d.findChildOfType(e,"svg"),n=d.findChildOfType(i,"name-back"),a=d.findChildOfType(i,"controls"),o=d.findChildOfType(a,"resize"),s=r.target;s==o?o.setAttribute("fill","LightSalmon"):s==n&&n.setAttribute("fill","BurlyWood"),Dp.hideTooltip(),r instanceof MouseEvent&&!e.contains(r.relatedTarget)&&a.setAttribute("class","hidden-with-transition")}},t.onInspectMouseDown=function(e,r){var i=d.findChildOfType(e,"svg"),n=d.findChildOfType(i,"info"),a=d.findChildOfType(i,"name-back"),o=d.findChildOfType(i,"controls"),s=d.findChildOfType(n,"info-back"),l=d.findChildOfType(n,"scrollbar"),u=d.findChildOfType(o,"resize"),c="inherit"==l.getAttribute("visibility"),h=p.getFloatAttribute(a,"height"),f=a.getBoundingClientRect().height/h;d.bringElementToFront(e);var m=r.target;if(m==u||m==a||m==s&&c){m==u?t.resizing=!0:m==a?t.moving=!0:m==s&&c&&(t.scrolling=!0);var g=void 0,v=void 0;if(r instanceof MouseEvent){var b=r;g=b.pageX,v=b.pageY}else{var y=r;g=y.touches[0].pageX,v=y.touches[0].pageY}new fp(g,v,function(r,i,n){i/=f,n/=f,t.resizing?t.resizeInspect(e,i,n):t.moving?t.moveInspect(e,i,n):t.scrolling&&t.scrollInfoText(e,n)},function(r){t.resizing=!1,t.moving=!1,t.scrolling=!1,t.onInspectMouseOut(e,r)},t.resizing?"nw-resize":t.scrolling?"ns-resize":"move")}},t.resizeInspect=function(e,r,i){var n=d.findChildOfType(e,"svg-shadow"),a=d.findChildOfType(e,"svg"),o=d.findChildOfType(a,"info"),s=d.findChildOfType(a,"chart"),l=d.findChildOfType(a,"name-back"),u=d.findChildOfType(a,"controls"),c=d.findChildOfType(o,"info-back"),h=d.findChildOfType(o,"scrollbar"),f=d.findChildOfType(u,"resize"),m=null==s?null:d.findChildOfType(s,"chart-back"),g=p.getFloatAttribute(l,"height"),v=Math.max(100,p.getFloatAttribute(a,"width")+r),b=Math.max(60,p.getFloatAttribute(a,"height")+i);p.setMultipleAttributes(n,["width","height"],[v,b]),p.setMultipleAttributes(a,["width","height"],[v,b]),p.setMultipleAttributes(c,["width","height"],[v,b-g]),null!=m&&p.setMultipleAttributes(m,["width","height"],[v,b-g]),l.setAttribute("width",v.toString()),h.setAttribute("x",(v-10).toString()),u.setAttribute("transform","translate("+v+")"),f.setAttribute("transform","translate(0,"+b+")"),t.scrollInfoText(e,0),null!=s&&t.redrawChart(s),t.updateArrow(e)},t.moveInspect=function(e,r,i){var n=d.findChildOfType(e,"svg-shadow"),a=d.findChildOfType(e,"svg"),o=p.getFloatAttribute(a,"x")+r,s=p.getFloatAttribute(a,"y")+i;p.setMultipleAttributes(n,["x","y"],[o,s]),p.setMultipleAttributes(a,["x","y"],[o,s]),t.updateArrow(e)},t.updateArrow=function(t){var e,r,i=d.findChildOfType(t,"arrow"),n=d.findChildOfType(t,"svg"),a=p.getFloatAttribute(n,"x"),o=p.getFloatAttribute(n,"y"),s=p.getFloatAttribute(n,"width"),l=p.getFloatAttribute(n,"height"),u=s/2,c=l/2;a>=0&&o>=0?(e=a+5,r=o+5):a>=0&&o<0&&o+l>=0?(e=a+5,r=(o+c)/c*5):a>=0&&o+l<0?(e=a+5,r=o+l-5):a<0&&a+s>=0&&o+l<0?(e=(a+u)/u*5,r=o+l-5):a+s<0&&o+l<0?(e=a+s-5,r=o+l-5):a+s<0&&o<0&&o+l>=0?(e=a+s-5,r=(o+c)/c*5):a+s<0&&o>=0?(e=a+s-5,r=o+5):a<0&&a+s>=0&&o>=0?(e=(a+u)/u*5,r=o+5):(e=0,r=0);var h=p.radiansToDegrees(Math.atan2(r,e)),f=Math.sqrt(e*e+r*r)/10;i.setAttribute("transform","rotate("+h+") scale("+f+",1)")},t.scrollInfoText=function(t,e){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"info"),n=d.findChildOfType(i,"info-back"),a=d.findChildOfType(i,"info-text"),o=d.findChildOfType(i,"scrollbar"),s=p.getFloatAttribute(n,"height"),l=12*(a.childElementCount+1),u=p.getFloatAttribute(a,"y"),c=u+e;if(c=Math.max(12+s-l,c),(c=Math.min(12,c))!=u){a.setAttribute("y",c.toString());for(var h=d.childElements(a),f=0;f<h.length;f++)h[f].setAttribute("y",(c+12*f).toString())}if(l>s){var m=s-14;o.setAttribute("visibility","inherit"),o.setAttribute("y",(4+m*(12-c)/l).toString()),o.setAttribute("height",(m*s/l+6).toString())}else o.setAttribute("visibility","hidden")},t.copyInspect=function(t){var e,r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"info"),n=d.findChildOfType(r,"chart"),a=d.findChildOfType(i,"info-text"),o=null==n?null:d.findChildOfType(n,"plot"),s=null==o?null:d.findChildOfType(o,"picture");if(null==n||"hidden-with-transition"==n.getAttribute("class"))e=a.getAttribute("content");else{for(var l=d.childElements(s),u=new Array(l.length),c=new Array(l.length),h=0;h<l.length;h++)u[h]=l[h].getAttribute("name"),c[h]=l[h].getAttribute("data");e=Tp.datasetsWithSharedXToString(u,c)}p.copyToClipboard(e)},t.prototype.closeInspct=function(t){var e=d.findChildOfType(t,"svg"),r=d.findChildOfType(e,"info"),i=d.findChildOfType(e,"chart"),n=d.findChildOfType(e,"controls");r.removeAttribute("class"),null!=i&&i.removeAttribute("class"),n.removeAttribute("class"),t.setAttribute("visibility","hidden"),this.frameDrawing.onControlAction(t.id,"0 0")},t.plotColors=["rgba(106,90,205,0.6)","rgba(178,34,34,0.6)","rgba(25,25,112,0.6)","rgba(0,128,128,0.6)","rgba(85,107,47,0.6)","rgba(70,130,180,0.6)","rgba(65,105,225,0.6)"],t.resizing=!1,t.moving=!1,t.scrolling=!1,t}(),Ep=function(){function t(t,e,r,i,n,a,o,s){var l=this;this.prevTouchZoomDistance=0,this.element=t,this.xyrefelement=e,this.ondrag=r,this.onwheel=i,this.ontouchzoomstart=n,this.ontouchzoom=a,this.ignore=o,this.wheelignore=s,this.onEventClosure=function(t){return l.onEvent(t)},this.element.addEventListener("mousedown",this.onEventClosure),this.element.addEventListener("wheel",this.onEventClosure),this.element.addEventListener("touchstart",this.onEventClosure),this.element.addEventListener("touchmove",this.onEventClosure),this.element.addEventListener("touchend",this.onEventClosure)}return t.prototype.onEvent=function(t){if(null==this.ignore||!this.ignore(t)){var e=p.offsetPage(this.xyrefelement);if(t instanceof MouseEvent){var r=t;switch(r.type){case"mousedown":null!=this.ondrag&&1==r.which&&(r.stopPropagation(),r.preventDefault(),this.onDragStart(r.pageX,r.pageY));break;case"wheel":if(null!=this.onwheel){var i=r;if(null==this.wheelignore||!this.wheelignore(i)){i.stopPropagation(),i.preventDefault();var n=i.pageX-e.left,a=i.pageY-e.top;this.onwheel(i,n,a)}}}}else if(p.touchEventExists()&&t instanceof TouchEvent){var o=t,s=void 0,l=void 0,u=void 0,c=void 0;switch(o.touches.length>0&&(s=o.touches[0].pageX-e.left,l=o.touches[0].pageY-e.top),o.touches.length>1&&(u=o.touches[1].pageX-e.left,c=o.touches[1].pageY-e.top),o.type){case"touchstart":o.stopPropagation(),1==o.touches.length?null!=this.ondrag&&this.onDragStart(o.touches[0].pageX,o.touches[0].pageY):(this.prevTouchZoomDistance=Math.hypot(u-s,c-l),null!=this.ontouchzoomstart&&this.ontouchzoomstart(o,this.prevTouchZoomDistance));break;case"touchmove":if(null!=this.ontouchzoom&&o.touches.length>1){o.stopPropagation(),o.preventDefault(),null!=this.dragHandler&&(this.dragHandler.stop(),this.dragHandler=null);var h=Math.hypot(u-s,c-l);if(this.prevTouchZoomDistance>0){var d=(s+u)/2,f=(l+c)/2,m=h/this.prevTouchZoomDistance;this.ontouchzoom(o,d,f,m)}this.prevTouchZoomDistance=h}break;case"touchend":this.prevTouchZoomDistance=0}}}},t.prototype.stop=function(){this.element.removeEventListener("mousedown",this.onEventClosure),this.element.removeEventListener("wheel",this.onEventClosure),this.element.removeEventListener("touchstart",this.onEventClosure),this.element.removeEventListener("touchmove",this.onEventClosure),this.element.removeEventListener("touchend",this.onEventClosure),null!=this.dragHandler&&(this.dragHandler.stop(),this.dragHandler=null)},t.prototype.onDragStart=function(t,e){var r=this;null!=this.dragHandler&&this.dragHandler.stop(),this.dragHandler=new fp(t,e,function(t,e,i){return r.ondrag(t,e,i,r.element)},null,null)},t}(),wp=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return d.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return d.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return d.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)Dp.filterAndSetAttribute(e,r[n],i[n]);t.updateGISMarkupPosition(e),kp.adjustGISPositionX(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=d.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=p.getFloatAttribute(t,"lon"),n=p.getFloatAttribute(t,"lat"),a=kp.lonLatToXY(r,i,n);p.setMultipleAttributes(t,["cx","cy"],[a[0],a[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var o=t.getAttribute("lonlatpoints"),s=kp.lonLatPointsToXYPoints(r,o);t.setAttribute("points",s)}},t}(),kp=function(){function t(t){this.initialTouchZoomDistance=0,this.currentTouchZoomDistance=0,this.accumulatedZoomWheelDelta=0,this.frameDrawing=t}return t.prototype.createShapeGISMap=function(){var e=this,r=d.cloneElementWithId("shape-gis-map"),i=d.findChildOfType(r,"background");return new Ep(r,i,function(e,r,i,n){return t.onDrag(e,r,i,n)},function(t,r,i){return e.onWheel(t,r,i)},function(t,r){return e.onTouchZoomStart(t,r)},function(t,r,i,n){return e.onTouchZoom(t,r,i,n)},function(e){return t.eventIgnoreCondition(e)},function(e){return t.wheelIgnoreCondition(e)}),r},t.prototype.updateShapeGISMap=function(e,r,i){for(var n=d.findChildOfType(e,"background"),a=d.findChildOfType(e,"map"),o=d.findChildOfType(e,"shadow"),s=d.findChildOfType(e,"border"),l=d.findChildOfType(a,"layers"),u=d.findChildOfType(l,"shapefiles"),c=function(l){switch(r[l]){case"width":case"height":n.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),s.setAttribute(r[l],i[l]);break;case"size-completed":e.getAttribute("zoom")&&t.redrawGISMap(e);break;case"background-color":n.setAttribute("fill",i[l]);break;case"border-color":s.setAttribute("stroke",i[l]);break;case"map-completed":t.redrawGISMap(e);break;case"shapefile":var c=d.createSvgElement("g");c.setAttribute("type","shapefile"),c.setAttribute("name",i[l]),u.appendChild(c),h.frameDrawing.client.network.getResource(i[l],function(e){t.onShapefileLoaded(e,c)});break;case"shapefiles-properties":for(var f=d.childElements(u),m=p.splitSkipEmpty(i[l]," "),g=0;g<f.length;g++)p.setMultipleAttributes(f[g],["visibility","stroke","fill"],m[g].split("|"));break;default:Dp.filterAndSetAttribute(e,r[l],i[l])}},h=this,f=0;f<r.length;f++)c(f)},t.redrawGISMap=function(e){t.redrawGISTiles(e),t.redrawGISShapefiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.redrawGISTiles=function(e){var r=d.findChildOfType(e,"background"),i=p.getFloatAttribute(r,"width"),n=p.getFloatAttribute(r,"height"),a=t.minGISZoom(i,n),o=d.findChildOfType(e,"map"),s=d.findChildOfType(o,"layers");s.setAttribute("transform","translate(0,0)");var l=p.getIntAttribute(e,"zoom"),u=p.getFloatAttribute(e,"center-lon"),c=p.getFloatAttribute(e,"center-lat");l<a&&(l=a,e.setAttribute("zoom",l.toString()));var h,f=Math.pow(2,l),m=t.latToTileYFloat(c,l),g=n/2/t.tileImageSize;m-g<0?h=g:f<m+g&&(h=f-g),h&&(c=t.tileYToLat(h,l),e.setAttribute("center-lat",c.toString()));var v=d.findChildOfType(s,"tiles");d.removeAllChildren(v),t.updateGISTiles(v,l,c,u,0,0,i,n,f)},t.updateGISTiles=function(e,r,i,n,a,o,s,l,u){if("false"!=d.findParentOfType(e,"ShapeGISMap").getAttribute("show-tiles")){for(var c=t.lonToTileXInt(n,r),h=t.latToTileYInt(i,r),f=a+s/2-t.lonToXOffsetWithinTile(n,r),m=o+l/2-t.latToYOffsetWithinTile(i,r);f>0;)f-=t.tileImageSize,c--;for(;m>0;)m-=t.tileImageSize,h--;c=p.modulo(c,u),h=p.modulo(h,u);for(var g=[],v=d.childElements(e),b=0;b<v.length;b++)g.push(v[b]);for(var y=c,A=f;A<s;A+=t.tileImageSize){for(var T=h,C=m;C<l;C+=t.tileImageSize){var S=r+"/"+y+"/"+T,E=null;for(b=0;b<g.length;b++)if(g[b].getAttribute("tileid")==S){E=g[b];break}null==E&&(E=t.addGISTile(e,r,y,T)),E.setAttribute("x",(A-a).toString()),E.setAttribute("y",(C-o).toString()),T=p.modulo(T+1,u)}y=p.modulo(y+1,u)}}},t.addGISTile=function(e,r,i,n){var a=d.findParentOfType(e,"ShapeGISMap"),o=t.tileURL(a,r,i,n),s=d.createSvgElement("image");return s.setAttribute("width",t.tileImageSize.toString()),s.setAttribute("height",t.tileImageSize.toString()),s.setAttributeNS(d.xlinkns,"href",o),s.setAttribute("tileid",r+"/"+i+"/"+n),e.appendChild(s),s},t.onShapefileLoaded=function(e,r){document.body.contains(r)&&(r.innerHTML=e.responseText,t.redrawGISShapefile(r),t.adjustX(r,!0))},t.redrawGISShapefiles=function(e){for(var r=d.findChildOfType(e,"map"),i=d.findChildOfType(r,"layers"),n=d.findChildOfType(i,"shapefiles"),a=d.childElements(n),o=0;o<a.length;o++)t.redrawGISShapefile(a[o]),t.adjustX(a[o],!0)},t.redrawGISShapefile=function(e){for(var r=d.findParentOfType(e,"ShapeGISMap"),i=d.childElements(e),n=0;n<i.length;n++){var a=i[n],o=a.getAttribute("lonlatpoints");switch(a.tagName){case"circle":var s=p.splitToFloats(o,","),l=t.lonLatToXY(r,s[0],s[1]);p.setMultipleAttributes(a,["cx","cy"],[l[0],l[1]]);break;case"polyline":case"polygon":var u=t.lonLatPointsToXYPoints(r,o);a.setAttribute("points",u)}}},t.redrawGISMarkup=function(e){for(var r=d.findChildOfType(e,"map"),i=d.findChildOfType(r,"layers"),n=d.findChildOfType(i,"markup"),a=d.childElements(n),o=0;o<a.length;o++)wp.updateGISMarkupPosition(a[o]);t.adjustX(n,!0)},t.redrawGISAgents=function(e){for(var r=d.findChildOfType(e,"map"),i=d.findChildOfType(r,"layers"),n=d.findChildOfType(i,"agents"),a=d.childElements(n),o=0;o<a.length;o++)t.updateGISAgentScale(a[o]),"hidden"!=a[o].getAttribute("visibility")&&t.updateGISAgentPosition(a[o]);t.adjustX(n,!0)},t.updateGISAgentPosition=function(e){var r=d.findParentOfType(e,"ShapeGISMap"),i=p.getFloatAttribute(e,"lon"),n=p.getFloatAttribute(e,"lat"),a=p.getFloatAttribute(e,"heading"),o=t.lonLatToXY(r,i,n),s="translate("+o[0]+","+o[1]+") rotate("+a+")",l=e.getAttribute("scale");l&&(s+=" scale("+l+")"),e.setAttribute("transform",s)},t.updateGISAgentScale=function(e){var r=d.findParentOfType(e,"ShapeGISMap"),i=p.getIntAttribute(e,"fixed-scale-zoom");if(i){var n=p.getIntAttribute(r,"zoom");if(n<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var a=1;if(p.getIntAttribute(e,"real-scale-zoom")<=n){var o=p.getFloatAttribute(e,"pixels-per-meter"),s=p.getFloatAttribute(e,"lat");a=t.pixelsPerGISMeter(n,s)/o}e.setAttribute("scale",a.toString())}},t.adjustGISPositionX=function(e){t.adjustX(e,!1)},t.adjustX=function(e,r){var i=d.findParentOfType(e,"ShapeGISMap"),n=d.findChildOfType(i,"map"),a=d.findChildOfType(n,"layers"),o=t.svgSize(i),s=p.getIntAttribute(i,"zoom"),l=Math.pow(2,s)*t.tileImageSize,u=p.getFloatAttribute(i,"center-lon"),c=p.parseTransform(a.getAttribute("transform"))[0];if(r)for(var h=d.childElements(e),f=0;f<h.length;f++)t.adjustShapeX(h[f],o[0],u,s,c,l);else t.adjustShapeX(e,o[0],u,s,c,l)},t.adjustShapeX=function(e,r,i,n,a,o){var s=0,l=0,u=0,c=1,h=1;if("hidden"!=e.getAttribute("visibility")){var d;if("circle"==e.tagName)d=p.getFloatAttribute(e,"cx");else if("g"==e.tagName){var f=p.parseTransform(e.getAttribute("transform"));s=f[0],l=f[1],u=f[2],c=f[3],h=f[4],d=s}else{var m=p.getFloatAttribute(e,"minlon"),g=p.getFloatAttribute(e,"maxlon");if(null==m||null==g)return;d=(t.lonToXFast(m,r,i,n)+t.lonToXFast(g,r,i,n))/2}d+=a;var v=Math.abs(d-r/2),b=Math.abs(d+o-r/2),y=Math.abs(d-o-r/2),A=0;b<v?A=o:y<v&&(A=-o);var T=p.constructTransform(s+A,l,u,c,h);null==T?e.removeAttribute("transform"):e.setAttribute("transform",T)}},t.panGIS=function(e,r,i){var n=d.findChildOfType(e,"map"),a=d.findChildOfType(n,"layers"),o=p.parseTransform(a.getAttribute("transform")),s=o[0]+r,l=o[1]+i,u=p.getIntAttribute(e,"zoom"),c=Math.pow(2,u),h=p.getFloatAttribute(e,"center-lon"),f=p.getFloatAttribute(e,"center-lat"),m=t.latToTileYFloat(f,u),g=t.svgSize(e),v=g[1]/2/t.tileImageSize;m-v-l/t.tileImageSize<0?l=(m-v)*t.tileImageSize:c<m+v-l/t.tileImageSize&&(l=(m+v-c)*t.tileImageSize),s=t.normalizedGISX(s,u),s=Math.round(s),l=Math.round(l),a.setAttribute("transform","translate("+s+","+l+")");var b=d.findChildOfType(a,"tiles");t.updateGISTiles(b,u,f,h,s,l,g[0],g[1],c);for(var y=d.findChildOfType(a,"shapefiles"),A=d.childElements(y),T=0;T<A.length;T++)t.adjustX(A[T],!0);var C=d.findChildOfType(a,"markup");t.adjustX(C,!0);var S=d.findChildOfType(a,"agents");t.adjustX(S,!0)},t.zoomGIS=function(e,r,i,n){var a,o=p.getIntAttribute(e,"zoom");if((r=Math.round(r))>0)a=Math.min(o+r,19);else{var s=d.findChildOfType(e,"background"),l=p.getFloatAttribute(s,"width"),u=p.getFloatAttribute(s,"height");a=Math.max(o+r,t.minGISZoom(l,u))}t.setGISZoom(e,i,n,a)},t.setGISZoom=function(e,r,i,n){var a=d.findChildOfType(e,"background"),o=p.getFloatAttribute(a,"width"),s=p.getFloatAttribute(a,"height"),l=d.findChildOfType(e,"map"),u=d.findChildOfType(l,"layers"),c=p.parseTransform(u.getAttribute("transform")),h=t.xyToLonLat(e,r-c[0],i-c[1]),f=t.lonToTileXFloat(h[0],n),m=t.latToTileYFloat(h[1],n),g=Math.pow(2,n);f=p.remainderPositive(f-(r-o/2)/t.tileImageSize,g),m=p.remainderPositive(m-(i-s/2)/t.tileImageSize,g);var v=t.tileXToLon(f,n),b=t.tileYToLat(m,n);p.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[n,v,b]),t.redrawGISMap(e)},t.eventIgnoreCondition=function(t){return"true"!=t.currentTarget.getAttribute("navigation-enabled")||!!(p.touchEventExists()&&t instanceof TouchEvent&&t.touches.length>2)},t.onDrag=function(e,r,i,n){var a=n,o=t.svgScale(a);t.panGIS(a,r/o[0],i/o[1])},t.wheelIgnoreCondition=function(t){return t.altKey||t.ctrlKey},t.prototype.onWheel=function(e,r,i){var n=this,a=e.currentTarget,o=t.svgScale(a);r/=o[0],i/=o[1],clearTimeout(this.delayedZoomTimeout),this.accumulatedZoomWheelDelta+=e.deltaY<0?1:-1,this.delayedZoomTimeout=setTimeout(function(){n.delayedWheelZoom(a,r,i)},t.zoomDelay)},t.prototype.onTouchZoomStart=function(t,e){this.initialTouchZoomDistance=e,this.currentTouchZoomDistance=e},t.prototype.onTouchZoom=function(e,r,i,n){var a=e.currentTarget,o=t.svgScale(a);r/=o[0],i/=o[1],this.currentTouchZoomDistance*=n;var s=this.currentTouchZoomDistance/this.initialTouchZoomDistance;(s<.8||1.2<s)&&(t.zoomGIS(a,s<1?-1:1,r,i),this.initialTouchZoomDistance=this.currentTouchZoomDistance)},t.prototype.delayedWheelZoom=function(e,r,i){0!=this.accumulatedZoomWheelDelta&&(t.zoomGIS(e,this.accumulatedZoomWheelDelta,r,i),this.accumulatedZoomWheelDelta=0)},t.eventToLonLat=function(e,r){var i=d.findChildOfType(e,"background"),n=p.offsetPage(i),a=t.svgScale(e),o=f.eventPageXY(r),s=(o[0]-n.left)/a[0],l=(o[1]-n.top)/a[1],u=d.findChildOfType(e,"map").firstElementChild,c=p.parseTransform(u.getAttribute("transform"));return t.xyToLonLat(e,s-c[0],l-c[1])},t.xyToLonLat=function(e,r,i){var n=t.svgSize(e),a=p.getIntAttribute(e,"zoom"),o=Math.pow(2,a),s=t.lonToTileXFloat(p.getFloatAttribute(e,"center-lon"),a),l=t.latToTileYFloat(p.getFloatAttribute(e,"center-lat"),a),u=(r-n[0]/2)/t.tileImageSize,c=(i-n[1]/2)/t.tileImageSize,h=p.remainderPositive(s+u,o),d=p.remainderPositive(l+c,o);return[t.tileXToLon(h,a),t.tileYToLat(d,a)]},t.lonLatToXY=function(e,r,i){var n=t.svgSize(e),a=p.getIntAttribute(e,"zoom"),o=t.lonToTileXFloat(p.getFloatAttribute(e,"center-lon"),a),s=t.latToTileYFloat(p.getFloatAttribute(e,"center-lat"),a),l=t.lonToTileXFloat(r,a),u=t.latToTileYFloat(i,a);return[n[0]/2+(l-o)*t.tileImageSize,n[1]/2+(u-s)*t.tileImageSize]},t.lonToXFast=function(e,r,i,n){var a=t.lonToTileXFloat(i,n);return r/2+(t.lonToTileXFloat(e,n)-a)*t.tileImageSize},t.lonLatPointsToXYPoints=function(e,r){for(var i=t.svgSize(e),n=p.getIntAttribute(e,"zoom"),a=t.lonToTileXFloat(p.getFloatAttribute(e,"center-lon"),n),o=t.latToTileYFloat(p.getFloatAttribute(e,"center-lat"),n),s=void 0,l=void 0,u="",c=p.splitSkipEmpty(r," "),h=0;h<c.length;h++){var d=c[h].split(","),f=t.lonToTileXFloat(parseFloat(d[0]),n),m=t.latToTileYFloat(parseFloat(d[1]),n),g=i[0]/2+(f-a)*t.tileImageSize,v=i[1]/2+(m-o)*t.tileImageSize;null!=s&&Math.abs(g-s)<t.gisTolerance&&Math.abs(v-l)<t.gisTolerance||(u+=(g=p.reducePrecision(g))+","+(v=p.reducePrecision(v))+" ",s=g,l=v)}return u},t.svgSize=function(t){var e=d.findChildOfType(t,"background");return[p.getFloatAttribute(e,"width"),p.getFloatAttribute(e,"height")]},t.svgScale=function(e){var r=d.findChildOfType(e,"background"),i=t.svgSize(e),n=r.getBoundingClientRect();return[n.width/i[0],n.height/i[1]]},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return t<-85.05?Math.pow(2,e):t>85.05?0:(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.tileURL=function(e,r,i,n){var a;switch(e.getAttribute("tile-url-provider-type")){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":a=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":a=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":a=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":a=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":a=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":a=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":a=p.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}return a[Math.floor(Math.random()*a.length)].replace("[zoom]",r.toString()).replace("[x]",i.toString()).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=p.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=p.stringToByteArray(t+"/"+e+"/"+r+".png"),a=0;a<n.length;a++)n[a]^=i[a%n.length];return btoa(p.byteArrayToString(n))},t.gisTolerance=2,t.tileImageSize=256,t.zoomDelay=50,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),xp=function(){function t(){}return t.createMarkupPipe=function(t){var e=d.cloneElementWithId("markup-pipe"),r=t+"basepath";d.findChildOfType(e,"basepath").firstElementChild.id=r;var i=d.findChildOfType(e,"pipe"),n=d.findChildOfType(e,"inner-pipe"),a=d.findChildOfType(e,"bubbles"),o="#"+r;return i.setAttributeNS(d.xlinkns,"href",o),n.setAttributeNS(d.xlinkns,"href",o),a.setAttributeNS(d.xlinkns,"href",o),e},t.updateMarkupPipe=function(t,e,r){for(var i,n=d.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=d.findChildOfType(t,"batches"),s=d.findChildOfType(t,"bubbles"),l=0;l<e.length;l++)switch(e[l]){case"phase":s.setAttribute("stroke-dashoffset",(12-parseFloat(r[l])).toString());break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,f=d.childElements(o)[parseInt(u[0])];f.setAttribute("stroke",u[3]),f.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var m=parseInt(r[l]),g=o.childElementCount,v=m;v<g;v++)d.removeElement(o.lastElementChild);for(v=g;v<m;v++)f=d.createUseElement(a),o.appendChild(f);break;case"d":var b=parseFloat(d.findChildOfType(t,"pipe").getAttribute("stroke-width")),y=p.roundPathCorners(r[l],2*b,!1);n.setAttribute("d",y);break;case"width":var A=parseFloat(r[l]);d.findChildOfType(t,"pipe").setAttribute("stroke-width",A.toString()),d.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*A).toString()),o.setAttribute("stroke-width",(.6*A).toString());var T=Math.min(5,.2*A);s.setAttribute("stroke-width",T.toString()),s.setAttribute("stroke-dasharray",T+","+(12-T));break;case"color":d.findChildOfType(t,"pipe").setAttribute("stroke",r[l]);break;case"inner-color":d.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[l]);break;default:Dp.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupStorageTank=function(){return d.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=d.findChildOfType(t,"square"),n=d.findChildOfType(t,"batches"),a=parseFloat(i.getAttribute("width")),o=0;o<e.length;o++)switch(e[o]){case"batch":var s=r[o].split(" "),l=parseFloat(s[1])*a,u=parseFloat(s[2])*a,c=d.childElements(n)[parseInt(s[0])];p.setMultipleAttributes(c,["y","height","fill"],[a/2-l-u,u,s[3]]);break;case"newbatches":for(var h=parseInt(r[o]),f=n.childElementCount,m=h;m<f;m++)d.removeElement(n.lastElementChild);for(m=f;m<h;m++)c=d.createSvgElement("rect"),p.setMultipleAttributes(c,["stroke","width","x"],["none",a,-a/2]),n.appendChild(c);break;case"progress":var g=parseFloat(r[o])*Math.PI*2,v=parseFloat(d.findChildOfType(t,"circle").getAttribute("r"))-2,b=v*Math.sin(g),y=-v*Math.cos(g),A="M 0 "+-v+" ";A+="A "+v+" "+v+" 0 "+(g>Math.PI?"1":"0")+" 1 "+b+" "+y,d.findChildOfType(t,"arc").setAttribute("d",A);break;case"radius":d.findChildOfType(t,"circle").setAttribute("r",r[o]),a=Math.max(10,2*parseFloat(r[o])/Math.sqrt(2)-8),p.setMultipleAttributes(i,["width","height","x","y"],[a,a,-a/2,-a/2]);break;case"color":d.findChildOfType(t,"circle").setAttribute("fill",r[o]);break;case"stroke-color":d.findChildOfType(t,"circle").setAttribute("stroke",r[o]),d.findChildOfType(t,"square").setAttribute("stroke",r[o]);break;default:Dp.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupBulkConveyorBelt=function(t){var e=d.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";d.findChildOfType(e,"basepath").firstElementChild.id=r;var i=d.findChildOfType(e,"belt"),n=d.findChildOfType(e,"belt-sections"),a="#"+r;return i.setAttributeNS(d.xlinkns,"href",a),n.setAttributeNS(d.xlinkns,"href",a),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,n=d.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=d.findChildOfType(t,"belt-sections"),s=d.findChildOfType(t,"batches"),l=0;l<e.length;l++)switch(e[l]){case"phase":o.setAttribute("stroke-dashoffset",r[l]);break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,p=d.childElements(s)[parseInt(u[0])];p.setAttribute("stroke",u[3]),p.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var f=parseInt(r[l]),m=s.childElementCount,g=f;g<m;g++)d.removeElement(s.lastElementChild);for(g=m;g<f;g++)p=d.createUseElement(a),s.appendChild(p);break;case"d":n.setAttribute("d",r[l]);break;case"width":var v=r[l];d.findChildOfType(t,"belt").setAttribute("stroke-width",v),o.setAttribute("stroke-width",v),o.setAttribute("stroke-dasharray","2, 10"),s.setAttribute("stroke-width",(.4*parseFloat(v)).toString());break;case"color":d.findChildOfType(t,"belt").setAttribute("stroke",r[l]);break;case"sections-color":o.setAttribute("stroke",r[l]);break;default:Dp.filterAndSetAttribute(t,e[l],r[l])}},t}(),Mp=function(){function t(){}return t.createMarkupPath=function(t,e){var r=d.cloneElementWithId("markup-path"),i=e+"basepath";d.findChildOfType(r,"basepath").firstElementChild.id=i;var n=d.findChildOfType(r,"paths"),a=1;"MarkupPathRoad"==t&&(a=2),"MarkupPathRailroad"==t&&(a=4);for(var o=0;o<a;o++){var s=d.createUseElement(i);n.appendChild(s)}var l=d.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(n.firstElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","white")):"MarkupPathRoad"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","white"),l.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(n.firstElementChild.setAttribute("stroke","gray"),d.childElements(n)[1].setAttribute("stroke","black"),d.childElements(n)[2].setAttribute("stroke","white"),n.lastElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),n=d.findChildOfType(t,"basepath").firstElementChild,a=d.findChildOfType(t,"paths"),o=a.firstElementChild,s=d.findChildOfType(t,"arrows"),l=0;l<e.length;l++)switch(e[l]){case"d":n.setAttribute("d",r[l]);break;case"bidirectional":d.removeAllChildren(s),"false"==r[l]&&p.addPathArrows(n,"arrowhead",1.7,s,50,100);break;case"stroke-width":var u=parseFloat(r[l]);switch(i){case"MarkupPathLine":o.setAttribute("stroke-width",u.toString());break;case"MarkupPathDashline":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",4*u+" "+u);break;case"MarkupPathConveyor":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",u/2+" "+u/10);break;case"MarkupPathRoad":o.setAttribute("stroke-width",u.toString());var c=a.lastElementChild;c.setAttribute("stroke-width",(u/12).toString()),c.setAttribute("stroke-dasharray",u/2+" "+u/5);break;case"MarkupPathRailroad":var h=u/10+" "+u/2.5;o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",h),d.childElements(a)[1].setAttribute("stroke-width",(u/2+u/12).toString()),d.childElements(a)[2].setAttribute("stroke-width",(u/2).toString());var f=a.lastElementChild;f.setAttribute("stroke-width",(u/2).toString()),f.setAttribute("stroke-dasharray",h)}break;case"stroke":o.setAttribute("stroke",r[l]),u=parseFloat(o.getAttribute("stroke-width")),s.setAttribute("stroke",u>4?"white":r[l]);break;default:Dp.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupAreaNode=function(t){var e,r=d.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=d.createSvgElement("rect");break;case"MarkupPolygonalNode":e=d.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:Dp.filterAndSetAttribute(i,e[n],r[n])}},t.createMarkupPalletRack=function(){return d.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"stroke":n.setAttribute(e[a],r[a]);break;case"fill":i.setAttribute(e[a],r[a]);break;case"rack-data":d.removeAllChildren(i),d.removeAllChildren(n);var o=r[a].split(" "),s=parseInt(o[0]),l=parseInt(o[1]),u=parseFloat(o[2]),c=parseFloat(o[3]),h=parseFloat(o[4]),f=void 0,m=void 0,g=void 0;s>1&&(f=parseFloat(o[5]),m=parseFloat(o[6]),g=c+f);var v=d.createSvgElement("rect");if(v.setAttribute("width",u.toString()),v.setAttribute("height",c.toString()),i.appendChild(v),s>1){var b=d.createSvgElement("rect");b.setAttribute("width",u.toString()),b.setAttribute("height",m.toString()),b.setAttribute("transform","translate( 0 "+g+")"),i.appendChild(b)}for(var y=h,A=0;A<l-1;A++){var T=d.createSvgElement("line");p.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,"0",c]),n.appendChild(T),y+=h}if(s>1){var C=g+m;y=h;for(A=0;A<l-1;A++){T=d.createSvgElement("line");p.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,g,C]),n.appendChild(T),y+=h}}break;default:Dp.filterAndSetAttribute(t,e[a],r[a])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),Op=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=d.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=d.createSvgElement("path");break;case"MarkupCircularWall":r=d.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=d.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:Dp.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupTargetLine=function(){return d.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var n=d.findChildOfType(e,"polyline"),a=d.findChildOfType(e,"serif-start"),o=d.findChildOfType(e,"serif-end"),s=0;s<r.length;s++)switch(r[s]){case"color":e.setAttribute("stroke",i[s]);break;case"points":n.setAttribute(r[s],i[s]);var l=i[s].split(" "),u=l.length;l[u-1].includes(",")||u--,t.setSerif(l[0],l[1],a),t.setSerif(l[u-1],l[u-2],o);break;default:Dp.filterAndSetAttribute(e,r[s],i[s])}},t.createMarkupPathway=function(){return d.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=d.findChildOfType(t,"polygon"),n=d.findChildOfType(t,"polyline"),a=d.findChildOfType(t,"ties"),o=0;o<e.length;o++)switch(e[o]){case"color":a.setAttribute("stroke",r[o]);break;case"points":var s=r[o].split(" "),l="",u="",c="";d.removeAllChildren(a);for(var h=0;h<s.length;h++){var f=p.splitToFloats(s[h],",");if(4==f.length){l+=f[0]+","+f[1]+" ",u=f[2]+","+f[3]+" "+u,c+=(f[0]+f[2])/2+","+(f[1]+f[3])/2+" ";var m=d.createSvgElement("line");p.setMultipleAttributes(m,["x1","y1","x2","y2"],[f[0],f[1],f[2],f[3]]),a.appendChild(m)}}i.setAttribute("points",l+u),n.setAttribute("points",c);break;default:Dp.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupPedFlowStatistics=function(){return d.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=d.findChildOfType(t,"line"),n=d.findChildOfType(t,"serif-end"),a=d.findChildOfType(t,"direction"),o=d.findChildOfType(t,"arrow-right"),s=d.findChildOfType(t,"arrow-left"),l=0;l<e.length;l++)switch(e[l]){case"color":t.setAttribute("stroke",r[l]);break;case"length":i.setAttribute("x2",r[l]),n.setAttribute("x1",r[l]),n.setAttribute("x2",r[l]);var u=parseInt(r[l])/2;a.setAttribute("x1",u.toString()),a.setAttribute("x2",u.toString()),o.setAttribute("transform","translate("+u+" 13) rotate(90)"),s.setAttribute("transform","translate("+u+" -13) rotate(-90)");break;case"direction":switch(o.setAttribute("visibility","inherit"),s.setAttribute("visibility","inherit"),r[l]){case"right":s.setAttribute("visibility","hidden");break;case"left":o.setAttribute("visibility","hidden")}break;default:Dp.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupServiceWithLines=function(){return d.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var n=d.findChildOfType(e,"queues"),a=d.findChildOfType(e,"services"),o=d.findChildOfType(e,"reverse-queues"),s=d.findChildOfType(e,"area"),l=0;l<r.length;l++)switch(r[l]){case"queue-color":n.setAttribute("stroke",i[l]);break;case"reverse-queue-color":o.setAttribute("stroke",i[l]);break;case"service-color":a.setAttribute("stroke",i[l]);break;case"clear-all-queues":d.removeAllChildren(n),d.removeAllChildren(o);break;case"queue":t.addQueue(n,i[l]);break;case"reverse-queue":t.addQueue(o,i[l]);break;case"clear-services":d.removeAllChildren(a);break;case"service":t.addService(a,i[l]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":s.setAttribute(r[l],i[l]);break;case"pos":case"scale":var u=p.posOrScaleToTransform(s,r[l],i[l]);p.applyTransformAttribute(s,u);break;default:Dp.filterAndSetAttribute(e,r[l],i[l])}},t.createMarkupServiceWithArea=function(){return d.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var n=d.findChildOfType(e,"services"),a=0;a<r.length;a++)switch(r[a]){case"service-color":n.setAttribute("stroke",i[a]);break;case"clear-services":d.removeAllChildren(n);break;case"service":t.addService(n,i[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":case"pos":case"scale":break;default:Dp.filterAndSetAttribute(e,r[a],i[a])}},t.createMarkupEscalatorGroup=function(){return d.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=d.findChildOfType(t,"background"),n=d.findChildOfType(t,"escalators"),a=0;a<e.length;a++)switch(e[a]){case"balustrade-color":i.setAttribute("fill",r[a]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[a]?"inherit":"hidden");break;case"dimensions-completed":var o=p.getIntAttribute(t,"number-of-escalators"),s=p.getFloatAttribute(t,"width"),l=p.getFloatAttribute(t,"length"),u=p.getFloatAttribute(t,"left-balustrade-width"),c=p.getFloatAttribute(t,"right-balustrade-width"),h=p.getFloatAttribute(t,"internal-balustrade-width"),f=p.getFloatAttribute(t,"lower-landing-length"),m=u+c+o*s+(o-1)*h,g=f+l+p.getFloatAttribute(t,"upper-landing-length");p.setMultipleAttributes(i,["y","width","height"],[-u,g,m]);for(var v=0;v<o;v++){var b=v*(s+h),y=d.cloneElementWithId("escalator"),A=d.findChildOfType(y,"background");p.setMultipleAttributes(A,["y","width","height"],[b,g,s]);var T=d.findChildOfType(y,"handrail-left"),C=d.findChildOfType(y,"handrail-right");p.setMultipleAttributes(T,["x2","y1","y2"],[g,b,b]),p.setMultipleAttributes(C,["x2","y1","y2"],[g,b+s,b+s]);var S=d.findChildOfType(y,"lower-landing-end"),E=d.findChildOfType(y,"upper-landing-end");p.setMultipleAttributes(S,["x1","x2","y1","y2"],[f,f,b,b+s]),p.setMultipleAttributes(E,["x1","x2","y1","y2"],[f+l,f+l,b,b+s]);var w=d.findChildOfType(y,"stairs");p.setMultipleAttributes(w,["x1","x2","y1","y2","stroke-width"],[f,f+l,b+s/2,b+s/2,s]),n.appendChild(y)}break;case"offsets":var k=p.splitToFloats(r[a]," "),x=d.childElements(n);for(v=0;v<x.length;v++)d.findChildOfType(x[v],"stairs").setAttribute("stroke-dashoffset",(-k[v]).toString());break;default:Dp.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupDensityMap=function(){for(var t=d.cloneElementWithId("markup-density-map"),e=d.findChildOfType(t,"grid");e.childElementCount<7;)e.appendChild(d.cloneElementWithId("grid-item"));return t},t.updateMarkupDensityMap=function(e,r,i){for(var n=d.findChildOfType(e,"colors"),a=d.findChildOfType(e,"frame"),o=0;o<r.length;o++)switch(r[o]){case"width":case"height":a.setAttribute(r[o],i[o]),t.redrawMarkupDensityMap(e);break;case"critical-density":e.setAttribute(r[o],i[o]),t.redrawMarkupDensityMap(e);break;case"colors":var s=p.splitSkipEmpty(i[o]," ");d.removeAllChildren(n);for(var l=0,u=s;l<u.length;l++){var c=u[l],h=d.createSvgElement("rect");h.setAttribute("fill",c),n.appendChild(h)}t.redrawMarkupDensityMap(e);break;default:Dp.filterAndSetAttribute(e,r[o],i[o])}},t.redrawMarkupDensityMap=function(t){var e=d.findChildOfType(t,"colors"),r=d.findChildOfType(t,"frame"),i=d.findChildOfType(t,"grid"),n=p.getFloatAttribute(r,"width"),a=p.getFloatAttribute(r,"height"),o=p.getFloatAttribute(t,"critical-density");if(null!=n&&null!=a&&null!=o){for(var s=a,l=0,u=o/6,c=a/6,h=d.childElements(i),f=0;f<7;f++){var m=h[f],g=m.lastElementChild;p.setMultipleAttributes(g,["x1","y1","x2","y2","stroke"],[n+4,s,0,s,"black"]);var v=m.firstElementChild;p.setMultipleAttributes(v,["x","y","text-anchor","fill"],[n+7,s+3,"start","black"]),v.firstChild.textContent=p.formatNumber(l,2),l+=u,s-=c}var b=e.childElementCount;if(b>0){s=a-(c=a/b);var y=d.childElements(e);for(f=0;f<b;f++)p.setMultipleAttributes(y[f],["y","width","height"],[s,n,c]),s-=c}}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),a=parseFloat(i[0]),o=parseFloat(i[1]),s=parseFloat(n[0])-a,l=parseFloat(n[1])-o,u=Math.hypot(s,l),c=3*l/u,h=3*s/u;p.setMultipleAttributes(r,["x1","x2","y1","y2"],[a+c,a-c,o-h,o+h])},t.addService=function(t,e){var r,i=e.split(" "),n=parseFloat(p.getSubAttribute(i,"x")),a=parseFloat(p.getSubAttribute(i,"y")),o=p.radiansToDegrees(parseFloat(p.getSubAttribute(i,"orientation")));if("point"==p.getSubAttribute(i,"type")){(r=d.createUseElement("service-point")).setAttribute("transform","translate("+n+" "+a+")");var s=d.createUseElement("arrowhead-small");s.setAttribute("transform","translate("+(n-11)+" "+a+") rotate("+o+" 11 0)"),t.appendChild(s)}else{(r=d.cloneElementWithId("service-line")).setAttribute("transform","translate("+n+" "+a+") rotate("+o+")");var l=r.firstElementChild.nextElementSibling,u=parseFloat(p.getSubAttribute(i,"length"));if(l.setAttribute("x2",u),"true"==p.getSubAttribute(i,"bidirectional")){var c=r.lastElementChild;c.setAttribute("visibility","inherit"),c.setAttribute("transform","translate("+(u+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=p.splitSkipEmpty(e,"|"),i=p.getSubAttribute(r,"queue-path"),n=d.createSvgElement("path");n.setAttribute("d",i),t.appendChild(n),p.addPathArrows(n,"arrowhead-small",.7,t,50,100);var a=p.getSubAttribute(r,"fence-color");if(a)for(var o=[p.getSubAttribute(r,"fence-path-left"),p.getSubAttribute(r,"fence-path-right")],s=0;s<o.length;s++){var l=d.createSvgElement("path");p.setMultipleAttributes(l,["d","stroke","stroke-width","stroke-dasharray"],[o[s],a,"2","none"]),t.appendChild(l)}},t}(),Ip=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return d.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:Dp.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return d.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)Dp.filterAndSetAttribute(t,e[i],r[i])},t}(),_p=function(){function t(){}return t.createMarkupIntersection=function(){return d.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,n=d.findChildOfType(t,"lane-connectors"),a=0;a<e.length;a++)switch(e[a]){case"fill":case"d":i.setAttribute(e[a],r[a]);break;case"lane-connector":var o=d.createSvgElement("g"),s=d.createSvgElement("path");s.setAttribute("d",r[a]),o.appendChild(s),p.addPathArrows(s,"arrowhead-tiny",.5,o,20,40),n.appendChild(o);break;case"lane-connector-colors":for(var l=p.splitSkipEmpty(r[a]," "),u=d.childElements(n),c=0;c<u.length;c++)u[c].setAttribute("stroke",l[c]);break;default:Dp.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupRoad=function(){return d.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var n=d.findChildOfType(e,"lanes"),a=d.findChildOfType(e,"delimiters"),o=d.findChildOfType(e,"median"),s=0;s<r.length;s++)switch(r[s]){case"lane-width":n.setAttribute("stroke-width",i[s]);break;case"lane-color":n.setAttribute("stroke",i[s]);break;case"forward-lane":case"backward-lane":var l=d.createSvgElement("path");l.setAttribute("d",i[s]),n.appendChild(l);break;case"lane-delimiter-color":a.setAttribute("stroke",i[s]);break;case"lane-delimiter-width":case"lane-delimiter-style":a.setAttribute(r[s],i[s]);break;case"lane-delimiter":var u=p.getFloatAttribute(a,"lane-delimiter-width"),c=a.getAttribute("lane-delimiter-style");t.addDelimiter(a,u,c,i[s],n.getAttribute("stroke"));break;case"median-color":o.setAttribute("stroke",i[s]);break;case"median-width":case"median-style":o.setAttribute(r[s],i[s]);break;case"median":u=p.getFloatAttribute(o,"median-width"),c=o.getAttribute("median-style"),t.addDelimiter(o,u,c,i[s],n.getAttribute("stroke"));break;default:Dp.filterAndSetAttribute(e,r[s],i[s])}},t.addDelimiter=function(t,e,r,i,n){var a=r.includes("DASHED"),o=r.includes("DOUBLE"),s=d.createSvgElement("path");if(s.setAttribute("d",i),s.setAttribute("stroke-width",(o?3*e:e).toString()),a&&s.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(s),o){var l=d.createSvgElement("path");p.setMultipleAttributes(l,["d","stroke-width","stroke"],[i,e,n]),t.appendChild(l)}},t.createMarkupStopLine=function(){return d.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:Dp.filterAndSetAttribute(t,e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return d.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:Dp.filterAndSetAttribute(t,e[a],r[a])}},t}(),Lp=function(){function t(t){this.control=t}return t.createControlList=function(e){var r=d.cloneElementWithId("control-list");r.setAttribute("always-focused",e.toString());var i=function(e){return t.onControlListMouseEvent(e)};return r.addEventListener("mouseover",i),r.addEventListener("mouseout",i),r.addEventListener("mousedown",i),r.addEventListener("wheel",i),r.addEventListener("touchstart",i),r},t.prototype.updateControlList=function(e,r,i){for(var n=d.findChildOfType(e,"svg"),a=d.findChildOfType(e,"border"),o=d.findChildOfType(n,"background"),s=d.findChildOfType(n,"itemgroup"),l=d.findChildOfType(n,"scrollbargroup"),u="true"==e.getAttribute("always-focused"),c=0;c<r.length;c++)switch(r[c]){case"enabled":e.setAttribute(r[c],i[c]);for(var h="true"==i[c],f=d.childElements(s),m=0;m<f.length;m++)t.updateControlListItemLook(f[m],u,!1);l.setAttribute("class",u?"control-opaque1":"control-opaque0");var g=void 0;g=h?u?"control-border-hover":"control-border":"control-border-disabled",a.setAttribute("class",g);break;case"text-array":d.removeAllChildren(s),s.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var v=p.splitSkipEmpty(i[c],"\n"),b=0,y=0;for(m=0;m<v.length;m++){var A=d.cloneElementWithId("list-item");d.findChildOfType(A,"background").setAttribute("fill",o.getAttribute("fill")),(w=d.findChildOfType(A,"text")).firstChild.textContent=v[m],e.hasAttribute("text-color")&&w.setAttribute("fill",e.getAttribute("text-color")),s.appendChild(A);var T=w.getBBox();b<T.width&&(b=T.width),y<T.height&&(y=T.height)}f=d.childElements(s);var C=Math.max(b+4,p.getFloatAttribute(n,"width")),S=Math.max(20,1.35*y);e.setAttribute("item-height",S.toString());for(m=0;m<f.length;m++)this.setupControlListItem(f[m],S*m,C,S,y);t.updateControlListScrollbar(e);break;case"background-color":o.setAttribute("fill",i[c]);break;case"text-color":e.setAttribute(r[c],i[c]);break;case"font-style":e.style.font=i[c];break;case"width":case"height":n.setAttribute(r[c],i[c]),o.setAttribute(r[c],i[c]),a.setAttribute(r[c],i[c]),n.hasAttribute("width")&&n.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[c],i[c]);break;case"value":var E=p.splitSkipEmpty(i[c],"\n");f=d.childElements(s),e.setAttribute("last-clicked","0");for(m=0;m<f.length;m++){A=f[m];var w=d.findChildOfType(A,"text"),k=E.indexOf(w.firstChild.textContent)>=0;A.setAttribute("selected",k),t.updateControlListItemLook(A,u,!1),k&&e.setAttribute("last-clicked",m.toString())}break;default:Dp.filterAndSetAttribute(e,r[c],i[c])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var n=i*p.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[n.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=d.findChildOfType(r,"svg"),n=d.findChildOfType(i,"scrollbargroup"),a=d.findChildOfType(n,"handle");if(e instanceof MouseEvent){var o=e;switch(o.type){case"mouseover":t.onGotFocus(r);break;case"mouseout":r.contains(o.relatedTarget)||t.dragging||t.onLostFocus(r);break;case"mousedown":if(1!=o.which||o.target!=a)return;o.stopPropagation(),o.preventDefault(),t.dragging=!0,new fp(o.pageX,o.pageY,function(e,i,n){var a=t.pageLengthToLines(r,n);t.scrollControlList(r,-a)},function(e){t.dragging=!1,t.onLostFocus(r)},"ns-resize");break;case"wheel":var s=o;s.altKey||s.ctrlKey||(e.stopPropagation(),e.preventDefault(),t.scrollControlList(r,s.deltaY<0?1:-1))}}else if(p.touchEventExists()&&e instanceof TouchEvent){var l=e;if(l.touches.length>1)return;switch(l.type){case"touchstart":if(l.target!=a)return;l.stopPropagation(),l.preventDefault(),t.dragging=!0,t.onGotFocus(r),new fp(l.touches[0].pageX,l.touches[0].pageY,function(e,i,n){var a=t.pageLengthToLines(r,n);t.scrollControlList(r,-a)},function(e){t.dragging=!1},null)}}}},t.onGotFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=d.findChildOfType(e,"border"),i=d.findChildOfType(e,"svg"),n=d.findChildOfType(i,"itemgroup"),a=d.findChildOfType(i,"scrollbargroup"),o=d.childElements(n);if("control-border-hover"!=r.getAttribute("class")){r.setAttribute("class","control-border-hover"),a.setAttribute("class","control-opaque1");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!0,!1)}}},t.onLostFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=d.findChildOfType(e,"border"),i=d.findChildOfType(e,"svg"),n=d.findChildOfType(i,"itemgroup"),a=d.findChildOfType(i,"scrollbargroup"),o=d.childElements(n);r.setAttribute("class","control-border"),a.setAttribute("class","control-opaque0");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!1,!1)}},t.isFocused=function(t){return"control-border-hover"==d.findChildOfType(t,"border").getAttribute("class")},t.scrollControlList=function(t,e){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"itemgroup"),n=i.childElementCount;if(0!=n){var a=p.getFloatAttribute(r,"height"),o=p.getFloatAttribute(t,"item-height"),s=n*o,l=i.getAttribute("transform"),u=p.parseTransform(l)[1];u+=e*o,u=Math.max(-s+a,u),u=Math.min(u,0),u=Math.round(u),i.setAttribute("transform","translate(0,"+u+")");var c=d.findChildOfType(r,"scrollbargroup"),h=d.findChildOfType(c,"handle"),f=p.getFloatAttribute(h,"height"),m=(a/2-u)/s,g=Math.max(2,a*m-f/2);g=Math.min(a-f-2,g),h.setAttribute("y",g.toString())}},t.prototype.setupControlListItem=function(e,r,i,n,a){var o=this,s=d.findChildOfType(e,"background"),l=d.findChildOfType(e,"text");e.setAttribute("transform","translate(0,"+r+")"),p.setMultipleAttributes(s,["width","height"],[i,n]),p.setMultipleAttributes(l,["x","y"],[2,n/2+.3*a]),new f(e,function(r){r instanceof MouseEvent&&t.updateControlListItemLook(e,!0,!0)},function(r){r instanceof MouseEvent&&t.updateControlListItemLook(e,!0,!1)},null,function(t){return o.onControlListItemClickTap(e,t)},null)},t.prototype.onControlListItemClickTap=function(e,r){var i=e.parentNode,n=i.parentNode.parentNode;if("false"!=n.getAttribute("enabled"))if(p.touchEventExists()&&r instanceof TouchEvent&&!t.isFocused(n))t.onGotFocus(n);else{var a=r instanceof MouseEvent&&r.ctrlKey||p.touchEventExists()&&r instanceof TouchEvent,o=r instanceof MouseEvent&&r.shiftKey,s="true"==n.getAttribute("multiple"),l=d.childElements(i),u=p.indexInParent(e),c="true"==e.getAttribute("selected");if(s)if(a)e.setAttribute("selected",String(!c)),t.updateControlListItemLook(e,!0,!0);else if(o){var h=p.getIntAttribute(n,"last-clicked");for(f=0;f<l.length;f++)c=h<=u?h<=f&&f<=u:u<=f&&f<=h,l[f].setAttribute("selected",c),t.updateControlListItemLook(l[f],!0,f==u)}else for(f=0;f<l.length;f++)l[f].setAttribute("selected",f==u),t.updateControlListItemLook(l[f],!0,f==u);else{c=!a||!c;for(var f=0;f<l.length;f++)l[f].setAttribute("selected",f==u&&c),t.updateControlListItemLook(l[f],!0,f==u)}n.setAttribute("last-clicked",u.toString());var m="";for(f=0;f<l.length;f++){if("true"==l[f].getAttribute("selected"))m+=d.findChildOfType(l[f],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(n,m),p.touchEventExists()&&r instanceof TouchEvent&&t.onLostFocus(n)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,n=d.findChildOfType(t,"background"),a=d.findChildOfType(t,"text"),o="true"==i.getAttribute("enabled"),s="true"==t.getAttribute("selected");if(!o)return n.setAttribute("class",s?"control-background-selected-disabled":""),void a.setAttribute("class","control-text-disabled");e?(r?n.setAttribute("class",s?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):n.setAttribute("class",s?"control-list-background-selected-hover":""),a.setAttribute("class",s?"control-text-selected-hover":"")):(n.setAttribute("class",s?"control-list-background-selected":""),a.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=d.findChildOfType(e,"svg"),i=d.findChildOfType(r,"scrollbargroup"),n=d.findChildOfType(i,"scrollbar"),a=d.findChildOfType(i,"handle"),o=p.getFloatAttribute(r,"width"),s=p.getFloatAttribute(r,"height"),l=o-p.getFloatAttribute(n,"width");n.setAttribute("x",l.toString()),n.setAttribute("height",s.toString()),a.setAttribute("x",(l+2).toString()),a.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"scrollbargroup"),n=(d.findChildOfType(i,"scrollbar"),d.findChildOfType(i,"handle")),a=p.getFloatAttribute(r,"height"),o=d.findChildOfType(r,"itemgroup").childElementCount,s=0;e=o>0&&a<(s=o*p.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e&&n.setAttribute("height",Math.max(a*(a/s)-4,7).toString())},t.pageLengthToLines=function(t,e){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"scrollbargroup"),n=d.findChildOfType(i,"scrollbar"),a=p.getFloatAttribute(n,"height"),o=e/(n.getBoundingClientRect().height/a),s=d.findChildOfType(r,"itemgroup").childElementCount,l=p.getFloatAttribute(t,"item-height");return o*(s*l/a)/l},t.dragging=!1,t}(),Pp=function(){function t(t){var e=this;this.onTextInputForSVGEventClosure=function(t){return e.onTextInputForSVGEvent(t)},this.frameDrawing=t,this.controlList=new Lp(this);var r=document.getElementById("text-input-for-svg-container");r.onmousedown=this.onTextInputForSVGEventClosure,r.onwheel=this.onTextInputForSVGEventClosure,r.onkeydown=this.onTextInputForSVGEventClosure,r.ontouchstart=this.onTextInputForSVGEventClosure,window.addEventListener("resize",this.onTextInputForSVGEventClosure,!1),E.addFullScreenListener(this.onTextInputForSVGEventClosure)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return cp.createUnsupportedObject("File chooser is not supported in the Cloud mode");case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":t.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":cp.updateUnsupportedObject(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=d.cloneElementWithId("control-button");return new f(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var n=d.findChildOfType(e,"background"),a=d.findChildOfType(e,"text"),o=0;o<r.length;o++)switch(r[o]){case"enabled":e.setAttribute(r[o],i[o]);var s="true"==i[o];n.setAttribute("class",s?"control-background":"control-background-disabled"),a.setAttribute("class",s?"control-button-text":"control-text-disabled");break;case"text":a.firstChild.textContent=i[o];break;case"background-color":break;case"text-color":a.setAttribute("fill",i[o]);break;case"font-style":a.style.font=i[o],t.centerControlText(a,n,!0,!0);break;case"width":case"height":var l=parseFloat(i[o])-2;n.setAttribute(r[o],l.toString()),t.centerControlText(a,n,!0,!0);break;default:Dp.filterAndSetAttribute(e,r[o],i[o])}},t.onButtonOver=function(t){var e=d.findChildOfType(t,"background"),r=d.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=d.findChildOfType(t,"background"),r=d.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=d.findChildOfType(t,"background"),r=d.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.onControlAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=d.cloneElementWithId("control-checkbox");return new f(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var n=d.findChildOfType(e,"background"),a=d.findChildOfType(e,"box"),o=d.findChildOfType(e,"check"),s=d.findChildOfType(e,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-checkbox-box":"control-checkbox-box-disabled"),o.setAttribute("class",u?"control-checkbox-check":"control-checkbox-check-disabled"),s.setAttribute("class",u?"":"control-text-disabled");break;case"text":s.firstChild.textContent=i[l];break;case"background-color":n.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":s.style.font=i[l],t.centerControlText(s,n,!1,!0);break;case"width":n.setAttribute(r[l],i[l]);break;case"height":n.setAttribute(r[l],i[l]);var c=parseFloat(i[l]);a.setAttribute("y",(c/2-8).toString()),o.setAttribute("transform","translate(0,"+(c/2-8)+")"),t.centerControlText(s,n,!1,!0);break;case"value":o.setAttribute("visibility","true"==i[l]?"inherit":"hidden");break;default:Dp.filterAndSetAttribute(e,r[l],i[l])}},t.onCheckboxOver=function(t){var e=d.findChildOfType(t,"box"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=d.findChildOfType(t,"box"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=d.findChildOfType(t,"box"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=d.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.onControlAction(t.id,r)},t.prototype.createSlider=function(){var t=this,e=d.cloneElementWithId("control-slider"),r=function(e){return t.onSliderEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e},t.updateSlider=function(e,r,i){for(var n=d.findChildOfType(e,"background"),a=d.findChildOfType(e,"line"),o=d.findChildOfType(e,"progress"),s=d.findChildOfType(e,"handle"),l=(d.findChildOfType(e,"value"),0);l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-background":"control-background-disabled"),o.setAttribute("class",u?"control-slider-progress":"control-background-selected-disabled"),s.setAttribute("class",u?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":n.setAttribute("fill",i[l]);break;case"width":case"height":n.setAttribute(r[l],i[l]);break;case"vertical":e.setAttribute(r[l],i[l]);var c=p.getFloatAttribute(n,"width"),h=p.getFloatAttribute(n,"height"),f=void 0,m=void 0,g=void 0,v=void 0,b=void 0,y=void 0,A=void 0,T=void 0,C=void 0,S=void 0;"false"==i[l]?(b=f=0,y=m=h/2-2,g=c,A=0,T=v=4,C=0,S=h/2):(b=f=c/2-2,m=0,y=h,A=g=4,v=h,T=0,C=c/2,S=h),p.setMultipleAttributes(a,["x","y","width","height"],[f,m,g,v]),p.setMultipleAttributes(o,["x","y","width","height"],[b,y,A,T]),p.setMultipleAttributes(s,["cx","cy"],[C,S]);break;case"value":var E=p.getFloatAttribute(e,"min"),w=p.getFloatAttribute(e,"max");c=p.getFloatAttribute(n,"width"),h=p.getFloatAttribute(n,"height");var k="true"==e.getAttribute("vertical")?h:c,x=(parseFloat(i[l])-E)/(w-E)*k;t.setSliderHandlePosition(e,x);break;default:Dp.filterAndSetAttribute(e,r[l],i[l])}},t.prototype.onSliderEvent=function(e){var r=this,i=e.currentTarget;if("false"!=i.getAttribute("enabled")){var n=d.findChildOfType(i,"background"),a=d.findChildOfType(i,"progress"),o=p.getFloatAttribute(n,"width"),s=p.getFloatAttribute(n,"height"),l=n.getBoundingClientRect(),u=l.width/o,c=l.height/s,h=p.offsetPage(n),f="true"==i.getAttribute("vertical");if(e instanceof MouseEvent){var m=e,g=(m.pageX-h.left)/u,v=(m.pageY-h.top)/c,b=f?s-v:g;switch(m.type){case"mouseover":t.onSliderOver(i);break;case"mouseout":i.contains(m.relatedTarget)||t.sliderDragging||t.onSliderOut(i);break;case"mousedown":if(1!=m.which)return;m.stopPropagation(),m.preventDefault(),t.sliderDragging=!0,t.onSliderHandleGrabbed(i,b),new fp(m.pageX,m.pageY,function(e,r,n){var o=p.getFloatAttribute(a,f?"height":"width");t.setSliderHandlePosition(i,o+(f?-n/c:r/u))},function(e){t.sliderDragging=!1,r.onSliderHandleReleased(i),t.onSliderOut(i)},f?"ns-resize":"ew-resize");break;case"wheel":var y=m;if(!m.altKey&&!m.ctrlKey){e.stopPropagation(),e.preventDefault();var A=p.getFloatAttribute(a,f?"height":"width");t.setSliderHandlePosition(i,A+(y.deltaY<0?1:-1)),this.confirmSliderValue(i)}}}else if(p.touchEventExists()&&e instanceof TouchEvent){var T=e;if(T.touches.length>1)return this.onSliderHandleReleased(i),void t.onSliderOut(i);g=void 0,v=void 0;g=(T.touches[0].pageX-h.left)/u,v=(T.touches[0].pageY-h.top)/c;b=f?s-v:g;switch(e.type){case"touchstart":T.stopPropagation(),T.preventDefault(),t.sliderDragging=!0,t.onSliderOver(i),t.onSliderHandleGrabbed(i,b),new fp(T.touches[0].pageX,T.touches[0].pageY,function(e,r,n){var o=p.getFloatAttribute(a,f?"height":"width");t.setSliderHandlePosition(i,o+(f?-n/c:r/u))},function(e){t.sliderDragging=!1,r.onSliderHandleReleased(i),t.onSliderOut(i)},null)}}}},t.onSliderOver=function(e){var r=d.findChildOfType(e,"line"),i=d.findChildOfType(e,"progress"),n=d.findChildOfType(e,"handle"),a=d.findChildOfType(e,"value");r.setAttribute("class","control-slider-line-hover"),i.setAttribute("class","control-fill-color-transition"),n.setAttribute("class",t.sliderDragging?"control-slider-handle-pressed":"control-slider-handle-hover"),a.setAttribute("class","control-opaque1")},t.onSliderOut=function(t){var e=d.findChildOfType(t,"line"),r=d.findChildOfType(t,"progress"),i=d.findChildOfType(t,"handle"),n=d.findChildOfType(t,"value");e.setAttribute("class","control-background"),r.setAttribute("class","control-slider-progress"),i.setAttribute("r","8"),i.setAttribute("class","control-slider-handle"),n.setAttribute("class","control-opaque0")},t.onSliderHandleGrabbed=function(e,r){var i=d.findChildOfType(e,"handle");i.setAttribute("r","7"),i.setAttribute("class","control-slider-handle-pressed"),t.setSliderHandlePosition(e,r)},t.prototype.onSliderHandleReleased=function(t){var e=d.findChildOfType(t,"handle");e.setAttribute("r","8"),e.setAttribute("class","control-slider-handle-hover"),this.confirmSliderValue(t)},t.setSliderHandlePosition=function(t,e){var r=d.findChildOfType(t,"background"),i=d.findChildOfType(t,"progress"),n=d.findChildOfType(t,"handle"),a=d.findChildOfType(t,"value"),o=p.getFloatAttribute(r,"width"),s=p.getFloatAttribute(r,"height"),l="true"==t.getAttribute("vertical"),u=l?s:o;e=Math.min(u,Math.max(e,0));var c,h=p.getFloatAttribute(t,"min"),f=p.getFloatAttribute(t,"max"),m=p.getFloatAttribute(t,"step");c=m>0?h+Math.round(e/u*(f-h)/m)*m:h+e/u*(f-h),e=((c=Math.min(c,f))-h)/(f-h)*u,l?(i.setAttribute("y",(u-e).toString()),i.setAttribute("height",e.toString()),n.setAttribute("cy",(u-e).toString())):(i.setAttribute("width",e.toString()),n.setAttribute("cx",e.toString()));var g=a.firstElementChild,v=a.lastElementChild;v.firstChild.textContent=p.formatNumber(c,2);var b=v.getComputedTextLength()+10;g.setAttribute("width",b.toString()),g.setAttribute("x",(5-b).toString());var y=l?o/2-9:e-14,A=l?s-e-15-10:s/2-15-4;a.setAttribute("transform","translate("+y+","+A+")"),t.setAttribute("current-value",c)},t.prototype.confirmSliderValue=function(t){var e=p.getFloatAttribute(t,"current-value");e!=p.getFloatAttribute(t,"last-value")&&(this.frameDrawing.onControlAction(t.id,e),t.setAttribute("last-value",e.toString()))},t.createRadioButtonGroup=function(){return d.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"enabled":e.setAttribute(r[a],i[a]);for(var o="true"==i[a],s=d.childElements(e),l=0;l<s.length;l++){var u=s[l],c=d.findChildOfType(u,"circle"),h=d.findChildOfType(u,"check"),m=d.findChildOfType(u,"text");c.setAttribute("class",o?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),h.setAttribute("class",o?"control-radiobutton-check":"control-text-disabled"),m.setAttribute("class",o?"":"control-text-disabled")}break;case"text-array":var g=i[a].split("\n"),v=function(r){var i=d.cloneElementWithId("radio-button"),a=d.findChildOfType(i,"background");e.hasAttribute("background-color")&&a.setAttribute("fill",e.getAttribute("background-color"));var o=d.findChildOfType(i,"text");o.firstChild.textContent=g[r],e.hasAttribute("text-color")&&o.setAttribute("fill",e.getAttribute("text-color")),new f(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return n.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(l=0;l<g.length;l++)v(l);break;case"background-color":case"text-color":e.setAttribute(r[a],i[a]);break;case"font-style":e.style.font=i[a];break;case"width":case"height":e.setAttribute(r[a],i[a]);break;case"vertical":var b=p.getFloatAttribute(e,"width"),y=p.getFloatAttribute(e,"height"),A=0;s=d.childElements(e);for(l=0;l<s.length;l++){u=s[l];var T=d.findChildOfType(u,"background"),C=(m=d.findChildOfType(u,"text")).getBBox();if("true"==i[a]){var S=Math.max(25,1.5*C.height);u.setAttribute("transform","translate(0,"+S*l+")"),p.setMultipleAttributes(T,["width","height"],[b,S])}else{var E=20+C.width+10;u.setAttribute("transform","translate("+A+",0)"),p.setMultipleAttributes(T,["width","height"],[E,y]),A+=E}t.centerRadioButton(u)}break;case"value":var w=parseInt(i[a]);s=d.childElements(e);for(l=0;l<s.length;l++){u=s[l];(h=d.findChildOfType(u,"check")).setAttribute("visibility",w==l?"inherit":"hidden")}break;default:Dp.filterAndSetAttribute(e,r[a],i[a])}},t.onRadioButtonOver=function(t){var e=d.findChildOfType(t,"circle"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=d.findChildOfType(t,"circle"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=d.findChildOfType(t,"circle"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=d.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=d.childElements(r),n=0;n<i.length;n++){var a=i[n];d.findChildOfType(a,"check").setAttribute("visibility",a==t?"inherit":"hidden"),a==t&&(e=n)}this.frameDrawing.onControlAction(r.id,e)}},t.centerRadioButton=function(e){var r=d.findChildOfType(e,"background"),i=d.findChildOfType(e,"circle"),n=d.findChildOfType(e,"check"),a=d.findChildOfType(e,"text"),o=p.getFloatAttribute(r,"height");i.setAttribute("cy",(o/2).toString()),n.setAttribute("cy",(o/2).toString()),t.centerControlText(a,r,!1,!0)},t.createListBox=function(){return Lp.createControlList(!1)},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var e=this,r=d.cloneElementWithId("control-combobox");new f(r,function(t){return e.onComboBoxEvent(r,"over",t)},function(t){return e.onComboBoxEvent(r,"out",t)},function(t){return e.onComboBoxEvent(r,"down",t)},function(t){return e.onComboBoxEvent(r,"click",t)},function(e){return t.isDisabled(r)});var i=Lp.createControlList(!0);return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),r.appendChild(i),r},t.prototype.updateComboBox=function(e,r,i){for(var n=d.findChildOfType(e,"svg"),a=d.findChildOfType(e,"border"),o=d.findChildOfType(e,"dropdown"),s=d.findChildOfType(n,"background"),l=d.findChildOfType(n,"text"),u=d.findChildOfType(n,"arrowback"),c=d.findChildOfType(n,"arrow"),h=0;h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var f="true"==i[h];l.setAttribute("class",f?"":"control-text-disabled"),a.setAttribute("class",f?"control-border":"control-border-disabled"),f||o.setAttribute("visibility","hidden"),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-array":var m=p.splitSkipEmpty(i[h],"\n"),g=m.length>0?m[0]:"";l.firstChild.textContent=g,this.controlList.updateControlList(o,[r[h]],[i[h]]),this.controlList.adjustControlListHeightToItems(o,5),this.controlList.updateControlList(o,["value"],[g]);break;case"background-color":s.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-color":l.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"font-style":e.style.font=i[h],t.centerControlText(l,s,!1,!0),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"width":case"height":var v=parseFloat(i[h]);if(n.setAttribute(r[h],i[h]),s.setAttribute(r[h],i[h]),a.setAttribute(r[h],i[h]),"width"==r[h])u.setAttribute("x",(v-20).toString()),this.controlList.updateControlList(o,[r[h]],[i[h]]);else{t.centerControlText(l,s,!1,!0),u.setAttribute("height",v.toString()),o.setAttribute("transform","translate(0,"+i[h]+")");var b=5*parseFloat(i[h]);this.controlList.updateControlList(o,["height"],[b.toString()])}if(n.hasAttribute("width")&&n.hasAttribute("height")){var y=p.getFloatAttribute(n,"width")-10,A=p.getFloatAttribute(n,"height")/2;c.setAttribute("transform","translate("+y+","+A+")")}break;case"editable":e.setAttribute(r[h],i[h]);break;case"value":l.firstChild.textContent=i[h],this.controlList.updateControlList(o,[r[h]],[i[h]]);break;default:Dp.filterAndSetAttribute(e,r[h],i[h])}},t.prototype.onComboBoxEvent=function(t,e,r){var i=d.findChildOfType(t,"svg"),n=d.findChildOfType(t,"border"),a=d.findChildOfType(t,"dropdown"),o=d.findChildOfType(i,"background"),s=d.findChildOfType(i,"text"),l=d.findChildOfType(i,"arrowback"),u=d.findChildOfType(i,"arrow"),c="true"==t.getAttribute("editable");switch(e){case"over":r instanceof MouseEvent&&(n.setAttribute("class","control-border-hover"),l.setAttribute("class","control-combobox-arrow-background-hover"),u.setAttribute("class","control-fill-color-transition"));break;case"out":r instanceof MouseEvent&&(n.setAttribute("class","control-border"),l.setAttribute("class","control-fill-transparent-transition"),u.setAttribute("class","control-fill-transparent-transition"),a.setAttribute("visibility","hidden"));break;case"down":!c||r.target!=o&&r.target!=s||this.displayTextInputForSVG(t,"left");break;case"click":if(c&&r.target!=l&&r.target!=u)this.displayTextInputForSVG(t,"left");else{r.stopPropagation(),r.preventDefault(),d.bringElementToFront(t);var h="inherit"==a.getAttribute("visibility");a.setAttribute("visibility",h?"hidden":"inherit")}}},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(t,"dropdown"),n=d.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var a=e.split("\n")[0];n.firstChild.textContent=a,this.frameDrawing.onControlAction(t.id,a)},t.prototype.createTextField=function(){var e=this,r=d.cloneElementWithId("control-textfield");return new f(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r)},function(t){return e.onTextFieldDown(r)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var n=d.findChildOfType(e,"svg"),a=d.findChildOfType(e,"border"),o=d.findChildOfType(n,"background"),s=d.findChildOfType(n,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];s.setAttribute("class",u?"":"control-text-disabled"),a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":e.style.font=i[l],t.centerControlText(s,o,!1,!0);break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),"width"==r[l]&&s.setAttribute("x",(parseFloat(i[l])-2).toString()),t.centerControlText(s,o,!1,!0);break;case"value":s.firstChild.textContent=i[l];break;default:Dp.filterAndSetAttribute(e,r[l],i[l])}},t.onTextFieldOver=function(t){d.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){d.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t){this.displayTextInputForSVG(t,"right")},t.createProgressBar=function(){return d.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var n=e.firstElementChild,a=d.findChildOfType(n,"background"),o=d.findChildOfType(n,"progress"),s=d.findChildOfType(n,"text"),l=d.findChildOfType(n,"border"),u=0;u<r.length;u++)switch(r[u]){case"background-color":a.setAttribute("fill",i[u]);break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":e.style.font=i[u],t.centerControlText(s,a,!1,!0);break;case"width":case"height":e.setAttribute(r[u],i[u]);break;case"vertical":var c="true"==i[u],h=e.getAttribute(c?"height":"width"),f=e.getAttribute(c?"width":"height");a.setAttribute("width",h),a.setAttribute("height",f),o.setAttribute("height",f),t.centerControlText(s,a,!0,!0),l.setAttribute("width",h),l.setAttribute("height",f),c&&n.setAttribute("transform","translate(0,"+h+") rotate(-90)");break;case"text":s.firstChild.textContent="null"==i[u]?"":i[u];break;case"value":var m=p.getFloatAttribute(a,"width");"null"==i[u]?(o.setAttribute("class","control-progressbar-indeterminate"),o.setAttribute("width",m.toString())):(o.setAttribute("class","control-slider-progress"),o.setAttribute("width",(parseFloat(i[u])*m).toString()));break;default:Dp.filterAndSetAttribute(e,r[u],i[u])}},t.prototype.displayTextInputForSVG=function(t,e){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"text"),n=document.getElementById("text-input-for-svg-container");n.style.display="block";var a=r.getBoundingClientRect(),o=p.getFloatAttribute(r,"width"),s=p.getFloatAttribute(r,"height"),l=a.width/o,u=n.firstElementChild;u.style.left=a.left+"px",u.style.top=a.top+"px",u.style.width=o+"px",u.style.height=s+"px",u.style.transform="scale("+l+")",u.style.font=t.style.font,u.style.textAlign=e,u.value=i.firstChild.textContent,n.setAttribute("control-id",t.id),window.setTimeout(function(){u.focus(),u.select()},0)},t.prototype.onTextInputForSVGEvent=function(t){var e=document.getElementById("text-input-for-svg-container"),r=e.firstElementChild,i=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=r?i=!0:t.stopPropagation();break;case"keydown":var n=t;"Enter"!=n.code&&"Escape"!=n.code&&"Tab"!=n.code||(i=!0);break;default:i=!0}if(i){var a=e.getAttribute("control-id");null!=a&&(e.style.display="none",e.removeAttribute("control-id"),this.onTextInputForSVGChanged(a,r.value))}},t.prototype.onTextInputForSVGChanged=function(t,e){var r=document.getElementById(t),i=d.findChildOfType(r,"svg");if(d.findChildOfType(i,"text").firstChild.textContent=e,this.frameDrawing.onControlAction(t,e),"ControlComboBox"==r.getAttribute("type")){var n=d.findChildOfType(r,"dropdown");this.controlList.updateControlList(n,["value"],[e])}},t.centerControlText=function(t,e,r,i){var n=p.getFloatAttribute(e,"width"),a=p.getFloatAttribute(e,"height"),o=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&a&&t.setAttribute("y",(1+a/2+.3*o.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.onControlAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t.sliderDragging=!1,t}(),Rp=function(){function t(){}return t.create=function(t){var e=d.createSvgElement("rect"),r=d.createCanvas(t,"canvas-group-3d");return e.setAttribute("stroke","none"),e.setAttribute("fill","gray"),Pd.getWorld().createCanvas3D(t,r),e},t.update=function(e,r,i){for(var n=e,a=document.getElementById(e.id+"canvas"),o=0;o<r.length;o++)switch(r[o]){case"width":case"height":n.setAttribute(r[o],i[o]),t.syncCanvas3DPosition(a);break;default:Dp.filterAndSetAttribute(e,r[o],i[o]),"pos"==r[o]||"scale"==r[o]?t.syncCanvas3DPosition(a):"visibility"==r[o]&&(a.style.visibility=i[o],t.syncCanvas3DPosition(a))}},t.syncCanvas3DPosition=function(t){var e=parseInt(t.id),r=document.getElementById(e.toString());if(null!=r.getAttribute("height")&&null!=r.getAttribute("width")){var i=r.getBoundingClientRect(),n=t.parentNode.getBoundingClientRect(),a=i.left-n.left,o=i.top-n.top;t.style.left=a+"px",t.style.top=o+"px";var s=Math.round(i.width),l=Math.round(i.height);if((s!=t.width||l!=t.height)&&(t.width=s,t.height=l,t.style.width=s+"px",t.style.height=l+"px",!Pd.getWorld().active)){var u=t.getContext("2d");u.fillStyle="rgba(255,0,0,0.2)",u.fillRect(0,0,t.width,t.height)}var c="inherit"!==t.style.visibility||a>n.width||o>n.height||a+s<0||o+l<0;Pd.getWorld().updateCanvasSize(t,!c)}},t.syncAllCanvas3DPositions=function(){for(var e=document.getElementById("canvas-group-3d").children,r=0,i=[].slice.call(e);r<i.length;r++){var n=i[r];n instanceof HTMLCanvasElement&&t.syncCanvas3DPosition(n)}},t}(),Dp=function(){function t(e){this.serverFPS=t.MAX_FPS,this.client=e,this.shapeComposite=new cp(this),this.shapeGISMap=new kp(this),this.shapeModelPrimitives=new pp(this),this.chart=new Tp(this),this.control=new Pp(this),this.shapeInspect=new Sp(this),this.world3d=Pd.getWorld()}return t.prototype.start=function(){this.frameDrawStartTime=Date.now(),this.catchingUp=!1,this.frameCount=0,this.fpsMeasureStartTime=null,this.actualFPS=0,this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.fullFrame=!1,this.packetFPS=t.MAX_FPS,this.desiredFPS=t.MAX_FPS,this.frameBuffer=[],this.sleepTimeStatistics=new Array(t.SLEEP_TIME_STATISTICS_SIZE),this.sleepTimeStatistics.fill(1e3/t.MAX_FPS),this.startMeasureInterval(),this.startFrameDrawingTimeout(this.desiredFPS),this.world3d.networkManager=this.client.network},t.prototype.stop=function(){this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.frameBuffer=[],this.stopMeasureInterval(),this.stopFrameDrawingTimeout(),this.world3d.deactivate()},t.prototype.startMeasureInterval=function(){var t=this;this.fpsMeasureIntervalId=setInterval(function(){return t.measureFPS()},1e3)},t.prototype.stopMeasureInterval=function(){this.fpsMeasureIntervalId&&(clearInterval(this.fpsMeasureIntervalId),this.fpsMeasureIntervalId=void 0)},t.prototype.startFrameDrawingTimeout=function(t){var e=this;this.frameDrawingTimeoutId=setTimeout(function(){var t=Date.now();e.drawFrame();var r=1e3/e.desiredFPS-(Date.now()-t);r<0&&(r=0),e.sleepTimeStatistics.push(r),e.sleepTimeStatistics.shift(),e.startFrameDrawingTimeout(r)},t)},t.prototype.stopFrameDrawingTimeout=function(){this.frameDrawingTimeoutId&&(clearTimeout(this.frameDrawingTimeoutId),this.frameDrawingTimeoutId=void 0)},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.totalFrameCount=function(){var t=this.frameBuffer.length;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.findOrRequestFullFrame=function(){if(this.fullFrame)console.log("Found a full frame in the local buffer, starting from there");else{for(var t=0;t<this.packetBuffer.length;t++){if(this.packetBuffer[t].fullFrame)return console.log("Found a full frame in the local buffer, starting from there"),void this.packetBuffer.splice(0,t)}this.packetBuffer=[],console.log("Cleared local frame buffer, requesting full frame from the server"),this.client.network.requestAndWaitFullFrame()}},t.prototype.switchToNextFrame=function(){if(0==this.frameBuffer.length){if(0==this.packetBuffer.length)return this.fullFrame=!1,this.packetFPS=t.MAX_FPS,void(this.desiredFPS=t.MAX_FPS);var e=this.packetBuffer.shift();this.frameBuffer=e.frames,this.fullFrame=e.fullFrame,this.packetFPS=e.fps,this.desiredFPS=e.fps,this.updateServerFpsIfNeeded()}return this.frameBuffer.shift()},t.prototype.updateServerFpsIfNeeded=function(){var e=this.actualFPS/this.packetFPS,r=this.measureSleepTime();if(e>=.9&&r>50&&this.serverFPS<t.MAX_FPS)return this.serverFPS++,void this.client.network.postMaxFPS(this.serverFPS);e<.9&&r<50&&this.serverFPS>1&&(this.serverFPS--,e<.7&&this.serverFPS>1&&this.serverFPS--,e<.6&&this.serverFPS>1&&this.serverFPS--,this.client.network.postMaxFPS(this.serverFPS))},t.prototype.measureSleepTime=function(){for(var t=0,e=0;e<this.sleepTimeStatistics.length;e++)t+=this.sleepTimeStatistics[e];return t/=this.sleepTimeStatistics.length},t.prototype.drawFrame=function(){var e=this,r=this.switchToNextFrame();if(r){this.client.updateExperimentState(r),this.world3d.applyFrame(r),this.fullFrame&&(this.fullFrame=!1,d.removeAllChildren(this.client.presentation)),this.frameDrawStartTime=Date.now(),this.client.svg.suspendRedraw(5e3),this.time=r.time;var i,n,a,o=r.commands;if(o.length>0&&"white"!=this.client.svg.style.backgroundColor&&(this.client.svg.style.backgroundColor="white"),Bp.DEBUG_MODE){var s=this.totalFrameCount();this.client.debugger.timeInfo.innerHTML=p.formatNumber(this.time,2),this.client.debugger.serverQueueInfo.innerHTML=this.client.network.serverQueue,this.client.debugger.browserQueueInfo.innerHTML=s+":"+this.client.network.packetManager.totalFrameCount(),i=0,n=0,a=0}for(var l=function(r){var s,l=o[r],c=void 0,h=l.att,m=l.val;switch(l.cmd){case"C":var g=p.getAttributeValue(h,m,"shape-type"),v=p.getAttributeValue(h,m,"owner-id"),b=p.getAttributeValue(h,m,"add-after"),y=null!=p.getAttributeValue(h,m,"has-click-handler");if(p.getAttributeValue(h,m,"draw-mode").includes("2D")||(g="Shape3DOnly"),s=u.createShape(g,l.id),"null"==v)u.client.presentation.appendChild(s);else{if(null==(c=document.getElementById(v)))return console.log("Can't find container to add a shape to, container id = "+v,l),u.findOrRequestFullFrame(),{value:void 0};if("ShapeGISMap"==c.getAttribute("type")){var A=d.findChildOfType(c,"map").firstElementChild;c=g.startsWith("MarkupGIS")?d.findChildOfType(A,"markup"):d.findChildOfType(A,"agents")}if("null"==b){var T=c.firstElementChild;null==T?c.appendChild(s):c.insertBefore(s,T)}else{if(c.lastElementChild.id==b)c.appendChild(s);else{var C=document.getElementById(b);if(null==C)return console.log("Can't find element to add after, el id = "+b,l),u.findOrRequestFullFrame(),{value:void 0};if(!c.contains(C))return console.log("the element to add after not found in group, el id = "+b,l),u.findOrRequestFullFrame(),{value:void 0};var S=C.nextElementSibling;c.insertBefore(s,S)}}}y&&"ShapeInspect"!=g&&(new f(s,function(e){return t.onClickableShapeOverOut(s,!0)},function(e){return t.onClickableShapeOverOut(s,!1)},null,function(t){return e.onClickableShapeClick(s,t)},null),"ShapeGISMap"!=g&&(s.style.pointerEvents="visible")),u.updateShape(s,h,m),i++;break;case"U":if(null==(s=document.getElementById(l.id)))return console.log("Can't find shape to be updated, shape id = "+l.id,l),u.findOrRequestFullFrame(),{value:void 0};u.updateShape(s,h,m),n++;break;case"D":if(null==(s=document.getElementById(l.id)))return console.log("Can't find shape to be deleted, shape id = "+l.id,l),u.findOrRequestFullFrame(),{value:void 0};d.removeElement(s),a++;break;case"S":u.applySettings(h,m);break;case"N":u.applyNavigation(h,m);break;case"M":t.showMessage(h,m);break;case"W":t.openURL(h,m);break;default:return u.client.stopAndAlert("Unknown command: "+l.cmd,null),{value:void 0}}},u=this,c=0;c<o.length;c++){var h=l(c);if("object"==typeof h)return h.value}this.client.svg.unsuspendRedrawAll(),this.frameCount++,Bp.DEBUG_MODE&&(this.client.debugger.cudCountInfo.innerHTML=i+"/"+n+"/"+a,this.client.debugger.drawTimeInfo.innerHTML=Date.now()-this.frameDrawStartTime,this.client.debugger.shapeCountInfo.innerHTML=d.getElementCount().toString()),!this.catchingUp&&this.packetBuffer.length>1?(this.catchingUp=!0,this.desiredFPS=1e3/this.packetFPS*.8):this.catchingUp&&(this.catchingUp=!1,this.desiredFPS=1e3/this.packetFPS)}},t.prototype.createShape=function(t,e){var r;if(d.isPrimitiveSVGElement(t))r=d.createSvgElement(t);else switch(t){case"Shape3DOnly":r=d.cloneElementWithId("3d-only-shape");break;case"ShapeArc":r=cp.createShapeArc();break;case"ShapeText":r=cp.createShapeText();break;case"ShapeImage":r=cp.createShapeImage();break;case"ShapeCanvas":r=cp.createShapeCanvas(e);break;case"ShapeCAD":r=cp.createShapeCAD();break;case"ShapeSVG":r=cp.createShapeSVG();break;case"ShapeModelPrimitives":r=pp.create();break;case"ShapeInspect":r=this.shapeInspect.create();break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=Mp.createMarkupPath(t,e);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=Mp.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=Mp.createMarkupPalletRack();break;case"MarkupRailwaySwitch":r=Ip.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=Ip.createMarkupPositionOnTrack();break;case"MarkupPipe":r=xp.createMarkupPipe(e);break;case"MarkupStorageTank":r=xp.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=xp.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=Op.createMarkupWall(t,e);break;case"MarkupTargetLine":r=Op.createMarkupTargetLine();break;case"MarkupPathway":r=Op.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=Op.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=Op.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=Op.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=Op.createMarkupEscalatorGroup();break;case"MarkupDensityMap":r=Op.createMarkupDensityMap();break;case"MarkupIntersection":r=_p.createMarkupIntersection();break;case"MarkupRoad":r=_p.createMarkupRoad();break;case"MarkupStopLine":r=_p.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=_p.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=wp.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=Tp.create();break;case"Window3D":r=Rp.create(e);break;default:return this.client.stopAndAlert("Can't create: unknown object type: "+t,void 0),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(e,r,i){var n=e.getAttribute("type");if("Shape3DOnly"!=n)if(d.isPrimitiveSVGElement(n))for(var a=0;a<r.length;a++)switch(r[a]){case"href":e.setAttributeNS(d.xlinkns,"href",i[a]);break;case"href-path":e.setAttributeNS(d.xlinkns,"href",this.client.network.getJarResourceURL(i[a]));break;case"geo":var o=i[a].split("|");e.setAttribute("lon",o[0]),e.setAttribute("lat",o[1]),e.setAttribute("heading",o[2]),kp.updateGISAgentPosition(e),kp.adjustGISPositionX(e);break;default:t.filterAndSetAttribute(e,r[a],i[a])}else switch(n){case"ShapeArc":cp.updateShapeArc(e,r,i);break;case"ShapeText":cp.updateShapeText(e,r,i);break;case"ShapeImage":this.shapeComposite.updateShapeImage(e,r,i);break;case"ShapeCanvas":cp.updateShapeCanvas(e,r,i);break;case"ShapeCAD":this.shapeComposite.updateShapeCAD(e,r,i);break;case"ShapeSVG":cp.updateShapeSVG(e,r,i);break;case"ShapeModelPrimitives":this.shapeModelPrimitives.update(e,r,i);break;case"ShapeInspect":Sp.update(e,r,i);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(e,r,i);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(e,r,i);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":Mp.updateMarkupPath(e,r,i);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":Mp.updateMarkupAreaNode(e,r,i);break;case"MarkupPalletRack":Mp.updateMarkupPalletRack(e,r,i);break;case"MarkupRailwaySwitch":Ip.updateMarkupRailwaySwitch(e,r,i);break;case"MarkupPositionOnTrack":Ip.updateMarkupPositionOnTrack(e,r,i);break;case"MarkupPipe":xp.updateMarkupPipe(e,r,i);break;case"MarkupStorageTank":xp.updateMarkupStorageTank(e,r,i);break;case"MarkupBulkConveyorBelt":xp.updateMarkupBulkConveyorBelt(e,r,i);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":Op.updateMarkupWall(e,r,i);break;case"MarkupTargetLine":Op.updateMarkupTargetLine(e,r,i);break;case"MarkupPathway":Op.updateMarkupPathway(e,r,i);break;case"MarkupPedFlowStatistics":Op.updateMarkupPedFlowStatistics(e,r,i);break;case"MarkupServiceWithLines":Op.updateMarkupServiceWithLines(e,r,i);break;case"MarkupServiceWithArea":Op.updateMarkupServiceWithArea(e,r,i);break;case"MarkupEscalatorGroup":Op.updateMarkupEscalatorGroup(e,r,i);break;case"MarkupDensityMap":Op.updateMarkupDensityMap(e,r,i);break;case"MarkupIntersection":_p.updateMarkupIntersection(e,r,i);break;case"MarkupRoad":_p.updateMarkupRoad(e,r,i);break;case"MarkupStopLine":_p.updateMarkupStopLine(e,r,i);break;case"MarkupBusStop":case"MarkupParkingLot":_p.updateMarkupBusStopOrParkingLot(e,r,i);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":wp.updateGISMarkup(e,r,i);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(e,r,i);break;case"Window3D":Rp.update(e,r,i)}},t.filterAndSetAttribute=function(t,e,r){if(!(["shape-type","owner-id","add-after","has-click-handler"].indexOf(e)>=0||e.startsWith("3d")))if("pos"==e||"scale"==e){var i=p.posOrScaleToTransform(t,e,r);p.applyTransformAttribute(t,i)}else t.setAttribute(e,r)},t.prototype.measureFPS=function(){var t=Date.now();null!=this.fpsMeasureStartTime&&(this.actualFPS=Math.round(1e3*this.frameCount/(t-this.fpsMeasureStartTime))),Bp.DEBUG_MODE&&(this.client.debugger.fpsInfo.innerHTML=this.actualFPS+":"+this.packetFPS),this.fpsMeasureStartTime=t,this.frameCount=0},t.prototype.onControlAction=function(t,e){this.client.network.postUserAction(t,e)},t.prototype.onModelPrimitiveClick=function(t){var e=t.split("-");this.client.network.postUserAction(e[0],e[1])},t.onClickableShapeOverOut=function(t,e){var r=t.getAttribute("type");"ShapeGISMap"!=r&&"ShapeCanvas"!=r&&(e?t.setAttribute("class","clickable-over"):t.removeAttribute("class"))},t.prototype.onClickableShapeClick=function(t,e){var r;if("ShapeGISMap"==t.getAttribute("type"))r=kp.eventToLonLat(t,e);else{var i=this.client.navigation.eventToXY(e);r=this.client.navigation.XYtoShapeXY(t,i)}this.client.network.postUserAction(t.id,r[0]+" "+r[1])},t.prototype.applySettings=function(t,e){for(var r=0;r<t.length;r++)this.modelSettings[p.hyphenToCameLCase(t[r])]=e[r];this.modelSettings.startTime=parseInt(this.modelSettings.startTime),this.modelSettings.startDate=parseInt(this.modelSettings.startDate),this.modelSettings.stopTime&&(this.modelSettings.stopTime=parseInt(this.modelSettings.startTime),this.modelSettings.stopDate=parseInt(this.modelSettings.startDate))},t.prototype.toDate=function(t){var e=this.modelSettings,r=t-e.startTime;return new Date(e.startDate+this.toMilliseconds(r))},t.prototype.date=function(){return this.toDate(this.time)},t.prototype.toMilliseconds=function(t){switch(this.modelSettings.timeUnit){case"MILLISECOND":return t*p.MILLISECOND;case"SECOND":return t*p.SECOND;case"MINUTE":return t*p.MINUTE;case"HOUR":return t*p.HOUR;case"DAY":return t*p.DAY;case"WEEK":return t*p.WEEK;case"MONTH":return t*p.MONTH;case"YEAR":return t*p.YEAR}},t.prototype.applyNavigation=function(t,e){for(var r=0;r<t.length;r++)this.navigationSettings[p.hyphenToCameLCase(t[r])]=e[r];this.navigationSettings.x=parseFloat(this.navigationSettings.x),this.navigationSettings.y=parseFloat(this.navigationSettings.y),this.navigationSettings.width=parseFloat(this.navigationSettings.width),this.navigationSettings.height=parseFloat(this.navigationSettings.height),this.navigationSettings.zoomAndPanningEnabled="true"==this.navigationSettings.zoomAndPanningEnabled,this.navigationSettings.navigationBackEnabled="true"==this.navigationSettings.navigationBackEnabled,this.client.setNavigationSettings(this.navigationSettings.width,this.navigationSettings.height),this.client.navigation.applyNavigationSettings()},t.showMessage=function(t,e){for(var r={},i=0;i<t.length;i++)r[p.hyphenToCameLCase(t[i])]=e[i];var n=document.getElementById("svg-message-background"),a=document.getElementById("svg-message-box-title"),o=document.getElementById("svg-message-box-text"),s=document.getElementById("svg-message-box-icon-info"),l=document.getElementById("svg-message-box-icon-error");a.innerText=r.title,o.innerHTML=r.text.replace(/\n/g,"<br>"),r.type.startsWith("error")?(s.style.display="none",l.style.removeProperty("display"),a.classList.remove("svg-message-box-colors-info"),a.classList.add("svg-message-box-colors-error"),""==r.title&&(a.innerHTML="Error")):(s.style.removeProperty("display"),l.style.display="none",a.classList.remove("svg-message-box-colors-error"),a.classList.add("svg-message-box-colors-info"),""==r.title&&(a.innerHTML="Message")),n.style.removeProperty("display")},t.openURL=function(e,r){var i=r[0];i.startsWith("http://")&&i.startsWith("https://")||(i="http://"+i);var n=["message","Open URL","The model asks you to open an external URL:<br><a href="+i+" target = '_blank' onclick = 'document.getElementById( \"svg-message-background\" ).style.display = \"none\"'>"+i+"</a><br><br>The URL will open in a new window"];t.showMessage(["type","title","text"],n)},t.showTooltip=function(t,e,r,i,n){var a=document.getElementById("presentation-tooltip");a.innerText=t;var o=a.offsetWidth,s=a.offsetHeight;a.style.left=Math.max(0,e-o-1)+"px",a.style.top=Math.max(0,r-s-1)+"px",a.style.backgroundColor=i,a.style.color=n,a.className="presentation-tooltip-shown"},t.hideTooltip=function(){document.getElementById("presentation-tooltip").className="presentation-tooltip-hidden"},t.SLEEP_TIME_STATISTICS_SIZE=20,t.MAX_FPS=20,t}(),Fp=function(){function t(t){var e=this;this.accumulatedZoomWheelDelta=0,this.client=t,this.onWindowResizeEventClosure=function(t){return e.applyNavigationSettings()}}return t.prototype.initSVGNavigation=function(){var e=this;this.presentationCoords=[0,0],this.zoom=1,window.addEventListener("resize",this.onWindowResizeEventClosure,!1),E.addFullScreenListener(this.onWindowResizeEventClosure);var r=this.client.svgContainer;r.oncontextmenu=function(){return!1},this.dragWheelZoomHandler=new Ep(r,this.client.svg,function(t,r,i,n){return e.onDrag(t,r,i,n)},function(t,r,i){return e.onWheel(t,r,i)},null,function(t,r,i,n){return e.onTouchZoom(t,r,i,n)},function(e){return t.eventIgnoreCondition(e)},function(e){return t.wheelIgnoreCondition(e)})},t.prototype.clearSVGNavigation=function(){window.removeEventListener("resize",this.onWindowResizeEventClosure,!1),E.removeFullScreenListener(this.onWindowResizeEventClosure),null!=this.dragWheelZoomHandler&&(this.dragWheelZoomHandler.stop(),this.dragWheelZoomHandler=null)},t.eventIgnoreCondition=function(t){if(t.target instanceof HTMLCanvasElement&&"canvas-group-3d"==t.target.parentElement.id)return!0;return!1},t.prototype.onDrag=function(t,e,r,i){this.applyPanning(e,r)},t.wheelIgnoreCondition=function(t){return t.altKey},t.prototype.onWheel=function(e,r,i){var n=this;e.ctrlKey?(clearTimeout(this.delayedZoomTimeout),this.accumulatedZoomWheelDelta+=e.deltaY<0?1:-1,this.delayedZoomTimeout=setTimeout(function(){n.delayedWheelZoom(r,i)},t.zoomDelay)):0<e.deltaY?this.applyPanning(0,-50):this.applyPanning(0,50)},t.prototype.onTouchZoom=function(e,r,i,n){var a=n*this.zoom;a=Math.max(a,t.zooms[0]),a=Math.min(a,t.zooms[t.zooms.length-1]),this.applyZoom(a,r,i)},t.prototype.delayedWheelZoom=function(e,r){if(0!=this.accumulatedZoomWheelDelta){var i,n=t.zooms.length,a=!1;if(this.accumulatedZoomWheelDelta<0){for(var o=n-1;o>=0;o--)if(t.zooms[o]<this.zoom){a=!0,i=o+this.accumulatedZoomWheelDelta+1;break}}else for(o=0;o<n;o++)if(this.zoom<t.zooms[o]){a=!0,i=o+this.accumulatedZoomWheelDelta-1;break}a&&(i=Math.min(i,n-1),i=Math.max(0,i),this.applyZoom(t.zooms[i],e,r)),this.accumulatedZoomWheelDelta=0}},t.prototype.applyPresentationTransform=function(){var t=this.client.frameDrawing.navigationSettings;if(!t.zoomAndPanningEnabled){var e=this.zoom,r=this.presentationCoords[0],i=this.presentationCoords[1],n=this.client.svg.getBoundingClientRect(),a=n.width,o=n.height;e=Math.max(e,a/t.width),e=Math.max(e,o/t.height),r=Math.min(r,-t.x*e),r=Math.max(r,a-(t.x+t.width)*e),i=Math.min(i,-t.y*e),i=Math.max(i,o-(t.y+t.height)*e),this.presentationCoords=[r,i],this.zoom=e}var s=p.fixedPrecision(this.presentationCoords[0],1),l=p.fixedPrecision(this.presentationCoords[1],1),u=p.reducePrecision(this.zoom),c="translate("+s+","+l+") scale("+u+")",h=this.client.presentation.getAttribute("transform");if(c!=h){this.client.presentation.setAttribute("transform",c),Rp.syncAllCanvas3DPositions();var d=p.parseTransform(h);u!=d[3]&&this.invokeZoomLsteners(d[3],u)}},t.prototype.applyZoom=function(t,e,r){if(t!=this.zoom){var i=this.client.frameDrawing.navigationSettings;if(!i.zoomAndPanningEnabled){var n=this.client.svg,a=n.getBoundingClientRect(),o=a.width,s=a.height,l=i.width,u=i.height,c=n.parentNode.getBoundingClientRect(),h=c.width,d=c.height;if((t=l/u>h/d?Math.max(t,h/l):Math.max(t,d/u))==this.zoom)return;var p=Math.min(l*t,h),f=Math.min(u*t,d),m=!1;if(p!=o&&(n.setAttribute("width",p.toString()),m=!0),f!=s&&(n.setAttribute("height",f.toString()),m=!0),m){var g=document.getElementById("canvas-group-3d");g.style.width=p+"px",g.style.height=f+"px"}}var v=t/this.zoom,b=e-(e-this.presentationCoords[0])*v,y=r-(r-this.presentationCoords[1])*v;this.presentationCoords=[b,y],this.zoom=t,this.applyPresentationTransform()}},t.prototype.applyPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform()},t.prototype.navigateTo=function(t,e,r){this.zoom=r,this.presentationCoords=[-t*this.zoom,-e*this.zoom],this.applyPresentationTransform()},t.prototype.applyNavigationSettings=function(){var t,e,r,i=this.client.frameDrawing.navigationSettings,n=i.width,a=i.height,o=i.zoomAndPanningEnabled,s=i.width/i.height,l=this.client.svgContainer.getBoundingClientRect(),u=l.width,c=l.height,h=u/c,d=i.x,f=i.y;s>h?(r=u/n,t=u,o?f-=((e=c)/r-a)/2:e=u/s):(r=c/a,o?d-=((t=u)/r-n)/2:t=c*s,e=c),p.setMultipleAttributes(this.client.svg,["width","height"],[t,e]);var m=document.getElementById("canvas-group-3d");m.style.width=t+"px",m.style.height=e+"px",this.navigateTo(d,f,r)},t.prototype.invokeZoomLsteners=function(t,e){for(var r=0,i=this.client.presentation.getElementsByClassName("svg-zoom-listener");r<i.length;r++){var n=i[r];switch(n.getAttribute("type")){case"ShapeCAD":cp.onCADZoomChange(n,t,e)}}},t.prototype.eventToXY=function(t){var e=p.offsetPage(this.client.svg),r=f.eventPageXY(t),i=r[0]-e.left,n=r[1]-e.top,a=i-this.presentationCoords[0],o=n-this.presentationCoords[1];return[a/=this.zoom,o/=this.zoom]},t.prototype.XYtoShapeXY=function(t,e){if(t==this.client.presentation)return e;var r=this.XYtoShapeXY(t.parentNode,e),i=p.parseTransform(t.getAttribute("transform")),n=r[0]-i[0],a=r[1]-i[1];if(0!=i[2]){var o=Math.sqrt(n*n+a*a),s=Math.atan2(a,n)-i[2];n=o*Math.cos(s),a=o*Math.sin(s)}return[n/i[3],a/i[4]]},t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t.zoomDelay=50,t}(),Np=function(){function t(e){var r=this;this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDebugContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDebugContainer.parentElement,this.controlPanel=document.getElementById("control-panel"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDebugTools=document.getElementById("control-panel-button-dev-panel"),this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.cpButtonWebsite=document.getElementById("control-panel-button-website"),this.cpButtonTermsOfUse=document.getElementById("control-panel-button-terms-of-use"),this.cpButtonAbout=document.getElementById("control-panel-button-about"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpInfoState=document.getElementById("control-panel-info-state"),window.addEventListener("resize",function(){return r.adjustControlPanelItemsVisibility()},!1),t.assignActionOnClick(this.cpButtonRun,function(){return r.client.network.postUserCommand("run","")}),t.assignActionOnClick(this.cpButtonPause,function(){return r.client.network.postUserCommand("pause","")}),t.assignActionOnClick(this.cpButtonX1,function(){return r.setSpeed(1)}),t.assignActionOnClick(this.cpButtonSlower,function(){return r.speedUpOrDown(!1)}),t.assignActionOnClick(this.cpButtonFaster,function(){return r.speedUpOrDown(!0)}),t.assignActionOnClick(this.cpButtonVirtual,function(){return r.setSpeed(1/0)}),this.cpButtonWebsite.onclick=function(){return window.open("https://www.anylogic.com")},this.cpButtonTermsOfUse.onclick=function(){return window.open("https://www.anylogic.com/downloads/legal-info/")},this.cpButtonAbout.onclick=function(){return window.open("https://www.anylogic.com/features/cloud/")},this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},t.assignActionOnClick(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),E.addFullScreenListener(function(){return r.onFullScreenChange()}),this.cpButtonDebugTools.style.display="none"}return t.prototype.adjustControlPanelItemsVisibility=function(){var t=this.presentationContainer.getBoundingClientRect().width,e=262,r=E.isFullScreenEnabled();this.cpButtonFullScreen.style.removeProperty("display");var i=(t-=e+=r?46:0)>=(e=178);i?(this.cpButtonSlower.style.removeProperty("display"),this.cpInfoScale.style.removeProperty("display"),this.cpButtonFaster.style.removeProperty("display")):(this.cpButtonSlower.style.display="none",this.cpInfoScale.style.display="none",this.cpButtonFaster.style.display="none"),(i=(t-=e)>=(e=46))?this.cpButtonX1.style.removeProperty("display"):this.cpButtonX1.style.display="none",(i=(t-=e)>=(e=46))?this.cpButtonVirtual.style.removeProperty("display"):this.cpButtonVirtual.style.display="none",t-=e},t.prototype.updateExperimentState=function(){this.updateInfoState(),this.updateModelTimeScale(),this.updateRunGroup(),this.updateSpeedGroup()},t.prototype.updateModelTimeScale=function(){this.cpInfoScale.innerText=t.timeScaleToString(this.client.getModelTimeScale())},t.prototype.updateExperimentProgress=function(){var t=this.client.getModelProgress(),e=this.progressBar.firstElementChild,r=100*t;this.progressBar.style.width=t<=0?"0":r+"%",e.innerText=t<0?"progress n/a":Math.round(r)+"%"},t.prototype.updateInfoState=function(){var e=this.client.getModelState(),r=t.modelStateToString(e);this.cpInfoState.innerText=t.modelStateToString(r),this.indicateCpErrorState("ERROR"==e)},t.prototype.indicateCpErrorState=function(t){t?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getModelState()&&this.indicateCpErrorState(!1)},t.prototype.updateRunGroup=function(){var e=this.client.getModelState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e;t.setVisible(this.cpButtonRun,!r),this.setEnabled(this.cpButtonRun,!r&&i),t.setVisible(this.cpButtonPause,r),this.setEnabled(this.cpButtonPause,r)},t.prototype.updateSpeedGroup=function(){var e=this.client.getModelState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e,i=t.stringToTimeScale(this.cpInfoScale.innerText);this.setEnabled(this.cpButtonX1,r&&1!=i),this.setEnabled(this.cpButtonSlower,r&&i>t.speeds[0]),this.setEnabled(this.cpButtonFaster,r&&i!=1/0),this.setEnabled(this.cpButtonVirtual,r&&i!=1/0)},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=p.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r)},t.prototype.setSpeed=function(e){this.cpInfoScale.innerText=t.timeScaleToString(e),this.client.network.postUserCommand("setspeed",e.toString()),this.updateSpeedGroup()},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=E.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed")),this.adjustControlPanelItemsVisibility()},t.prototype.toggleFullScreen=function(){E.toggleFullScreen(this.presentationContainer)},t.modelStateToString=function(t){switch(t){case"IDLE":return"Idle";case"RUNNING":return"Running";case"PAUSED":return"Paused";case"FINISHED":return"Finished.";case"ERROR":return"Error!";case"PLEASE_WAIT":return"Please Wait...";case"INITIALIZE":return"Initializing...";case"STOPPED":return"Stopped";case"TIME_LIMIT":return"Time limit";case"TERMINATED":return"Terminated"}return t},t.timeScaleToString=function(t){return t<0||t==1/0?"Virtual":t>=1?"x"+t:"x1/"+1/t},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.setVisible=function(t,e){e?t.style.removeProperty("display"):t.style.display="none"},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.assignActionOnClick=function(e,r){e.onclick=function(){t.isEnabled(e)&&r()}},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t}(),Bp=function(){function t(){this.windowAdjusted=!1,this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new Dp(this),this.navigation=new Fp(this),this.network=new up(this),this.controlPanel=new Np(this)}return t.prototype.start=function(t){this.svgAnimationInfo=t,this.navigation.initSVGNavigation(),this.network.start(),this.frameDrawing.start(),this.modelState="INITIALIZE"},t.prototype.stop=function(t){t?(this.modelState=t.type,this.controlPanel.updateExperimentState()):this.modelState=void 0,this.frameDrawing.stop(),this.navigation.clearSVGNavigation(),this.network.stop(),this.onToggleFullScreen=void 0,this.onResize=void 0,this.onStop=void 0,this.windowAdjusted=!1,d.removeAllChildren(this.presentation)},t.prototype.pause=function(){this.network.pause()},t.prototype.setCallback=function(t,e){switch(t){case"ontogglefullscreen":this.onToggleFullScreen=e;break;case"onstop":this.onStop=e;break;case"onresize":this.onResize=e}},t.prototype.stopAndAlert=function(t,e){console.log(t),console.log(e),Dp.showMessage(["type","title","text"],["error",t,e]),this.frameDrawing.stop()},t.prototype.updateExperimentState=function(t){t.state!=this.modelState&&(this.modelState=t.state,this.controlPanel.updateExperimentState()),t.progress!=this.modelProgress&&(this.modelProgress=t.progress,this.controlPanel.updateExperimentProgress()),t.time!=this.modelTime&&(this.modelTime=t.time),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.controlPanel.updateModelTimeScale())},t.prototype.getModelTime=function(){return this.modelTime},t.prototype.getModelState=function(){return this.modelState},t.prototype.getModelTimeScale=function(){return this.modelTimeScale},t.prototype.getModelProgress=function(){return this.modelProgress},t.prototype.setNavigationSettings=function(t,e){var r=this;!this.windowAdjusted&&this.onResize&&(this.onResize(t,e+50,function(){r.navigation.applyNavigationSettings(),r.controlPanel.adjustControlPanelItemsVisibility()}),this.windowAdjusted=!0)},t.DEBUG_MODE=!1,t.DEBUG_SPARK_LOCAL=!1,t}(),Gp=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(t){var e=this;d.setDebugMode(),Bp.DEBUG_MODE=!0,Bp.DEBUG_SPARK_LOCAL=t,this.client.debugger=this,this.serverQueueInfo=document.getElementById("dev-panel-info-server-queue"),this.browserQueueInfo=document.getElementById("dev-panel-info-browser-queue"),this.parseTimeInfo=document.getElementById("dev-panel-info-parse-time"),this.shapeCountInfo=document.getElementById("dev-panel-info-shape-count"),this.cudCountInfo=document.getElementById("dev-panel-info-cud-count"),this.drawTimeInfo=document.getElementById("dev-panel-info-draw-time"),this.fpsInfo=document.getElementById("dev-panel-info-fps"),this.timeInfo=document.getElementById("dev-panel-info-time"),t&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return e.onNewModelSelected()})},t.prototype.stop=function(){this.modelSelector&&(this.modelSelector.onchange=void 0)},t.prototype.onNewModelSelected=function(){var t=this;if(null!=this.client.svg&&this.client.stop("TERMINATED"),"NO MODEL SELECTED"!=this.modelSelector.value){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&t.client.start({})},e.open("GET","/http/start?path="+this.modelSelector.value,!0),e.send()}},t}(),Up=function(){function t(){}return t.createClient=function(){return new Bp},t.createDebugger=function(){return new Gp(new Bp)},t}(),zp=function(){function t(t,e){void 0===e&&(e=0),this.array=new Array(t),this.defaultvalue=e,this.reset()}return t.prototype.reset=function(){this.array.fill(this.defaultvalue)},t.prototype.add=function(t){this.array.push(t),this.array.shift()},t.prototype.mean=function(){for(var t=0,e=0,r=this.array;e<r.length;e++){t+=r[e]}return t/this.array.length},t.prototype.linearWeightedAverage=function(t){var e=this.array.length;t||(t=e);for(var r=(t-1)/(e-1),i=1,n=0,a=0,o=0;o<e;o++)n+=i*this.array[o],a+=i,i+=r;return n/a},t}(),Wp=function(){function t(t){this.client=t}return t.createShapeArc=function(){return d.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:mf.filterAndSetAttribute(t,e[a],r[a])}},t.createShapeArrowLine=function(){return d.cloneElementWithId("shape-arrow-line")},t.updateShapeArrowLine=function(e,r,i){for(var n=d.findChildOfType(e,"line"),a=0;a<r.length;a++)switch(r[a]){case"x2":case"y2":e.setAttribute(r[a],i[a]),n.setAttribute(r[a],i[a]),"y2"==r[a]&&t.setupBothArrows(e);break;case"stroke-dasharray":n.setAttribute(r[a],i[a]);break;case"stroke-width":case"stroke":e.setAttribute(r[a],i[a]),"stroke"==r[a]&&e.setAttribute("fill",i[a]);break;case"arrow-settings":e.setAttribute(r[a],i[a]),t.setupBothArrows(e);break;default:mf.filterAndSetAttribute(e,r[a],i[a])}},t.setupBothArrows=function(e){var r=e.getAttribute("arrow-settings");if(null!=r){var i=p.splitSkipEmpty(r,":");t.setupArrow(e,!0,i[0],parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3])),t.setupArrow(e,!1,i[4],parseFloat(i[5]),parseFloat(i[6]),parseFloat(i[7]))}},t.setupArrow=function(t,e,r,i,n,a){var o,s,l,u,c=d.findChildOfType(t,"line"),h=d.findChildOfType(t,e?"begin-arrow":"end-arrow"),f=p.getFloatAttribute(t,"x2"),m=p.getFloatAttribute(t,"y2"),g=p.getFloatAttribute(t,"stroke-width"),v=Math.hypot(f,m);if("ARROW_NONE"==r||v<n)return h.setAttribute("visibility","hidden"),void(e?p.setMultipleAttributes(c,["x1","y1"],[0,0]):p.setMultipleAttributes(c,["x2","y2"],[f,m]));h.setAttribute("visibility","inherit"),"ARROW_FILLED"==r?h.removeAttribute("fill"):h.setAttribute("fill","none"),h.setAttribute("points",-a/2+","+n+" 0,0 "+a/2+","+n);var b=e?Math.atan2(m,f)+Math.PI:Math.atan2(m,f);if(i>0)o=i*f,l=i*m,s=e?0:f,u=e?0:m;else{var y=2*g*Math.sqrt(n*n+a*a/4)/(2*a),A=e?0:v;s=o=(A-y)*Math.cos(b),u=l=(A-y)*Math.sin(b)}var T=p.radiansToDegrees(b+Math.PI/2);h.setAttribute("transform","translate("+o+" "+l+") rotate("+T+")"),p.setMultipleAttributes(c,e?["x1","y1"]:["x2","y2"],[s,u])},t.createShapeText=function(){var t=d.createSvgElement("text");return t.setAttribute("class","shape-text"),t},t.updateShapeText=function(e,r,i){for(var n=0;n<r.length;n++)switch(r[n]){case"text-content":null==i[n]&&(i[n]="");var a=i[n].split("\n"),o=p.getFloatAttribute(e,"first-line-offset"),s=p.getFloatAttribute(e,"line-height");t.drawMultiLineText(e,a,s,o);break;case"font":e.style.font=i[n];break;default:mf.filterAndSetAttribute(e,r[n],i[n])}},t.drawMultiLineText=function(t,e,r,i){var n=t.childElementCount;if(1==e.length&&1==n)t.firstElementChild.firstChild.textContent=e[0];else{for(var a=t.getAttribute("x"),o=null==a?0:parseFloat(a),s=t.getAttribute("y"),l=(null==s?0:parseFloat(s))+i,u=0;u<e.length;u++){var c=d.childElements(t),h=e[u];if(h.endsWith("\r")&&(h=h.substring(0,h.length-1)),c[u])c[u].firstChild.textContent=h;else{var p=d.createSvgElement("tspan");p.setAttribute("x",o.toString()),p.setAttribute("y",(l+u*r).toString());var f=d.createTextNode(h);p.appendChild(f),t.appendChild(p)}}for(;t.childElementCount>e.length;)d.removeElement(t.lastChild)}},t.createShapeImage=function(){return d.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":d.removeAllChildren(t);break;case"add":var n=d.cloneElementWithId("image-item");n.setAttributeNS(d.xlinkns,"href",this.client.networkManager.getInternalResource(r[i])),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.appendChild(n);break;case"set":for(var a=parseInt(r[i]),o=t.childNodes,s=0;s<o.length;s++)(n=o[s]).setAttribute("visibility",s==a?"inherit":"hidden");break;case"width":case"height":o=t.childNodes;for(s=0;s<o.length;s++)(n=o[s]).setAttribute(e[i],r[i]);default:mf.filterAndSetAttribute(t,e[i],r[i])}},t.createShapeCanvas=function(t){var e=d.createSvgElement("image");return d.createCanvas(t,"canvas-group"),e},t.updateShapeCanvas=function(t,e,r){for(var i=t,n=document.getElementById(t.id+"canvas"),a=n.getContext("2d"),o=function(o){switch(e[o]){case"global-composite-operation":a.globalCompositeOperation=r[o];break;case"width":case"height":i.setAttribute(e[o],r[o]),n.setAttribute(e[o],r[o]);break;case"fill-rect":case"clear-rect":var s=r[o].split(" "),l=parseFloat(s[0]),u=parseFloat(s[1]),c=parseFloat(s[2]),h=parseFloat(s[3]);if("clear-rect"==e[o])a.clearRect(l,u,c,h);else{var p=s[4];a.fillStyle=p,a.fillRect(l,u,c,h)}break;case"fill-circle":s=r[o].split(" ");var f=parseFloat(s[0]),m=parseFloat(s[1]),g=parseFloat(s[2]),v=s[3];a.fillStyle=v,a.beginPath(),a.arc(f,m,g,0,2*Math.PI),a.fill();break;case"clear":a.clearRect(0,0,n.width,n.height);break;case"update":i.setAttributeNS(d.xlinkns,"href",n.toDataURL("image/x-xbitmap"));break;case"image":var b=new Image;b.onload=function(){var t=n.getContext("2d");t.clearRect(0,0,n.width,n.height),t.drawImage(b,0,0),i.setAttributeNS(d.xlinkns,"href",n.toDataURL("image/x-xbitmap"))},b.src=r[o];break;default:mf.filterAndSetAttribute(t,e[o],r[o])}},s=0;s<e.length;s++)o(s)},t.createShapeCAD=function(){return d.cloneElementWithId("shape-cad")},t.prototype.updateShapeCAD=function(t,e,r){for(var i=d.findChildOfType(t,"back"),n=d.findChildOfType(t,"image"),a=0;a<e.length;a++)switch(e[a]){case"width":case"height":i.setAttribute(e[a],r[a]),this.fitCAD(t);break;case"background-color":i.setAttribute("fill",r[a]);break;case"svg":n.setAttributeNS(d.xlinkns,"href",'data:image/svg+xml;utf8,<svg xmlns="'+d.svgns+'" width = "0" height = "0"><g transform = "translate(0 0) scale(1)" stroke-width = "0.6">'+r[a]+"</g></svg>");break;case"svg-dimensions":t.setAttribute(e[a],r[a]),this.fitCAD(t);break;case"layer-settings":var o=n.getAttribute("href"),s=o.indexOf("<svg"),l=o.substring(0,s),u=o.substring(s),c=document.createElementNS(d.svgns,"g");c.innerHTML=u;for(var h=c.firstElementChild.firstElementChild,f=0,m=p.splitSkipEmpty(r[a],"|");f<m.length;f++){var g=m[f].split(":"),v=d.findChildWithId(h,g[0]);null!=v&&(v.setAttribute("visibility",g[1]),"none"!=g[2]&&(v.setAttribute("stroke",g[2]),"none"!=v.getAttribute("fill")&&v.setAttribute("fill",g[2])))}u=c.innerHTML,n.setAttributeNS(d.xlinkns,"href",l+u);break;default:mf.filterAndSetAttribute(t,e[a],r[a])}},t.prototype.fitCAD=function(e){var r=d.findChildOfType(e,"back"),i=d.findChildOfType(e,"image"),n=e.getAttribute("svg-dimensions"),a=p.getFloatAttribute(r,"width"),o=p.getFloatAttribute(r,"height");if(null!=a&&null!=o&&null!=n){var s=p.splitToFloats(n," "),l=Math.min(a/s[2],o/s[3]),u="translate("+-s[0]*l+" "+-s[1]*l+") scale("+l+")",c=t.DEFAULT_CAD_STROKE_WIDTH/l/this.client.navigation.getZoom(),h=i.getAttribute("href");h=(h=h.replace(/width\s*=\s*"[^"]*"\s*height\s*=\s*"[^"]*"/,'width = "'+a+'" height = "'+o+'"')).replace(/transform\s*=\s*"[^"]*"\s*stroke-width\s*=\s*"[^"]*"/,'transform = "'+u+'" stroke-width = "'+c+'"'),i.setAttributeNS(d.xlinkns,"href",h),p.setMultipleAttributes(i,["width","height"],[a,o])}},t.onCADZoomChange=function(t,e,r){var i=d.findChildOfType(t,"image"),n=i.getAttribute("href");n=n.replace(/stroke-width\s*=\s*"([^"]*)"/,function(t,i){return'stroke-width = "'+parseFloat(i)*e/r+'"'}),i.setAttributeNS(d.xlinkns,"href",n)},t.createShapeScale=function(){return d.cloneElementWithId("shape-scale")},t.updateShapeScale=function(t,e,r){for(var i=d.findChildOfType(t,"background"),n=d.findChildOfType(t,"dashline"),a=d.findChildOfType(t,"start-group"),o=d.findChildOfType(a,"ratio"),s=d.findChildOfType(t,"middle-group"),l=d.findChildOfType(s,"middle-value"),u=d.findChildOfType(t,"end-group"),c=d.findChildOfType(u,"end-value"),f=d.findChildOfType(u,"units"),m=0;m<e.length;m++)switch(e[m]){case"length":i.setAttribute("width",r[m]),n.setAttribute("x2",r[m]),u.setAttribute("transform","translate("+r[m]+")");break;case"units":f.innerHTML=h.msg[r[m]]();break;case"length-in-units":var g=parseFloat(r[m]),v=p.getFloatAttribute(i,"width"),b=v/g,y=p.goodGridStep(g,v,10)*b;n.setAttribute("stroke-dasharray",y+" "+y),o.innerHTML="1"+f.innerHTML+" = "+p.formatNumber(b,2)+h.msg.PIXEL(),c.innerHTML=p.formatNumber(g,2);var A=2*y/b;A<=2/3*g?(s.setAttribute("transform","translate("+2*y+")"),l.innerHTML=p.formatNumber(A,2)+f.innerHTML):s.setAttribute("display","none");break;default:mf.filterAndSetAttribute(t,e[m],r[m])}},t.onScaleZoomChange=function(t,e,r){var i=d.findChildOfType(t,"background"),n=d.findChildOfType(t,"dashline"),a=d.findChildOfType(t,"start-group"),o=d.findChildOfType(t,"middle-group"),s=d.findChildOfType(t,"end-group"),l=e/r,u=p.getFloatAttribute(i,"height")*l,c=p.getFloatAttribute(i,"stroke-width")*l;p.setMultipleAttributes(i,["height","stroke-width"],[u,c]),p.setMultipleAttributes(n,["stroke-width","y1","y2"],[u,u/2,u/2]);var h=p.setTransformScale(a.getAttribute("transform"),1/r);null!=h?a.setAttribute("transform",h):a.removeAttribute("transform"),null!=(h=p.setTransformScale(o.getAttribute("transform"),1/r))?o.setAttribute("transform",h):o.removeAttribute("transform"),null!=(h=p.setTransformScale(s.getAttribute("transform"),1/r))?s.setAttribute("transform",h):s.removeAttribute("transform")},t.createShapeSVG=function(){return d.createSvgElement("g")},t.updateShapeSVG=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"svg":t.innerHTML="null"==r[i]?"":r[i];break;default:mf.filterAndSetAttribute(t,e[i],r[i])}},t.createUnsupportedObject=function(t){var e=d.cloneElementWithId("unsupported-object");return d.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=d.findChildOfType(t,"background"),n=d.findChildOfType(t,"text"),a=0;a<e.length;a++)switch(e[a]){case"width":var o=parseFloat(r[a]);i.setAttribute("width",o.toString());var s=n.getBBox();o<s.width&&(n.firstChild.textContent="Not supported",s=n.getBBox()),o<s.width&&(n.firstChild.textContent="N/A",s=n.getBBox()),o<s.width&&(n.firstChild.textContent=""),n.setAttribute("x",(o/2).toString());break;case"height":var l=parseFloat(r[a]);i.setAttribute("height",l.toString()),n.setAttribute("y",(l/2+3).toString());break;default:mf.filterAndSetAttribute(t,e[a],r[a])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeCAD","ShapeGISMap","ShapeScale","ShapeSVG"],t.DEFAULT_CAD_STROKE_WIDTH=.6,t}(),Hp=function(){function t(){}return t.createStockIcon=function(t){var e=d.cloneElementWithId("STOCK"),r=d.findChildOfType(e,"back"),i=parseFloat(p.getSubAttribute(t,"width")),n=parseFloat(p.getSubAttribute(t,"height"));p.setMultipleAttributes(r,["x","y","width","height"],[-i/2,-n/2,i,n]);var a=d.findChildOfType(e,"bars").firstElementChild;p.setMultipleAttributes(a,["x","width"],[-i/2+1,i-2]);var o=p.getSubAttribute(t,"color");return null!=o&&(r.setAttribute("stroke",o),a.setAttribute("fill",o)),e},t.createFlowIcon=function(e){for(var r=d.cloneElementWithId("FLOW"),i=d.findChildOfType(r,"basepath"),n=d.findChildOfType(r,"innerpath"),a=d.findChildOfType(r,"animation"),o=d.findChildOfType(r,"arrow"),s=d.findChildOfType(r,"valve"),l=p.getSubAttribute(e,"color"),u=p.getSubAttribute(e,"points"),c=p.splitSkipEmpty(u,";"),h="",f=0;f<c.length;f++){var m=p.splitToFloats(c[f],",");if(h+=0==f?"M ":"L ",h+=m[0]+" "+m[1]+" ",0==f&&"null"==p.getSubAttribute(e,"source")){var g=p.splitToFloats(c[1],","),v=Math.atan2(m[1]-g[1],m[0]-g[0]);t.addFlowCloud(r,!0,m[0],m[1],v,l)}if(f==c.length-1){var b=p.splitToFloats(c[f-1],","),y=(v=Math.atan2(m[1]-b[1],m[0]-b[0]),p.radiansToDegrees(v)),A="translate("+m[0]+","+m[1]+") rotate("+y+")";o.setAttribute("transform",A),"null"==p.getSubAttribute(e,"target")&&t.addFlowCloud(r,!1,m[0],m[1],v,l)}}var T=p.roundPathCorners(h,5,!1);i.setAttribute("d",T),n.setAttribute("d",T),a.setAttribute("d",T);var C=p.getSubAttribute(e,"valve-pos"),S=p.splitToFloats(C,","),E="translate("+S[0]+","+S[1]+") rotate("+p.radiansToDegrees(S[2])+")";return s.setAttribute("transform",E),"true"==p.getSubAttribute(e,"external")&&s.setAttribute("stroke-dasharray","1,1"),null!=l&&(i.setAttribute("stroke",l),o.setAttribute("stroke",l),o.setAttribute("fill",p.changeBrightness(l,2)),s.setAttribute("stroke",l),s.setAttribute("fill",p.changeBrightness(l,2))),r},t.addFlowCloud=function(t,e,r,i,n,a){var o=e?15:35,s=r+o*Math.cos(n),l=i+o*Math.sin(n),u=d.createUseElement("flow-cloud-fill"),c=d.createUseElement("flow-cloud-line");p.setMultipleAttributes(u,["x","y"],[s,l]),p.setMultipleAttributes(c,["x","y"],[s,l]),c.setAttribute("stroke",null==a?"CornflowerBlue":a),t.appendChild(u),t.appendChild(c)},t.createDynamicVariableIcon=function(t){var e,r=(e="true"==p.getSubAttribute(t,"external")?d.cloneElementWithId("DYNAMIC_VARIABLE_EXTERNAL"):"true"==p.getSubAttribute(t,"constant")?d.cloneElementWithId("DYNAMIC_VARIABLE_CONSTANT"):d.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,i=p.getSubAttribute(t,"color");return null!=i&&r.setAttribute("fill",i),e},t.createShadowIconAndInfo=function(t,e,r){var i=p.getSubAttribute(r,"original"),n=Yp.getModelPrimitiveByName(t,i);if(null==n)return console.log("Shadow variable could not find its original, name: "+i),d.createUseElement("DEFAULT_MODEL_ELEMENT");var a,o=d.findChildOfType(n,"icon");if("FLOW"==n.getAttribute("type")){var s=(a=d.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,l=d.findChildOfType(o,"valve");s.setAttribute("fill",l.getAttribute("stroke"))}else o.id=n.id+"icon",a=d.createUseElement(o.id);var u=d.findChildOfType(n,"info");u.id=n.id+"info";var c=d.createUseElement(u.id);c.setAttribute("type","info");var h=d.findChildOfType(e,"info"),f=p.getFloatAttribute(h,"x"),m=p.getFloatAttribute(h,"y");d.removeElement(h);var g=p.getFloatAttribute(u,"x"),v=p.getFloatAttribute(u,"y");return p.setMultipleAttributes(c,["x","y"],[-g+f,-v+m]),e.appendChild(c),a},t.createLinkIcon=function(t){var e=d.cloneElementWithId("LINK"),r=d.findChildOfType(e,"path"),i=p.splitToFloats(p.getSubAttribute(t,"start-point"),","),n=p.splitToFloats(p.getSubAttribute(t,"end-point"),","),a=p.getFloatSubAttribute(t,"r");if(null==a)r.setAttribute("d","M "+i[0]+" "+i[1]+" L "+n[0]+" "+n[1]);else{var o=p.getSubAttribute(t,"large"),s=p.getSubAttribute(t,"sweep");r.setAttribute("d","M "+i[0]+" "+i[1]+" A "+a+" "+a+" 0 "+o+" "+s+" "+n[0]+" "+n[1])}var l=r.getTotalLength(),u=d.findChildOfType(e,"arrow"),c=p.pathAngleAt(r,l),h=p.radiansToDegrees(c);u.setAttribute("transform","translate("+n[0]+" "+n[1]+") rotate("+h+")");var f=p.getSubAttribute(t,"color");null!=f&&(r.setAttribute("stroke",f),u.setAttribute("fill",f));var m=p.getSubAttribute(t,"stroke-width");if(null!=m){r.setAttribute("stroke-width",m);var g=1+((E=parseInt(m))-1)/4;u.setAttribute("transform",u.getAttribute("transform")+" scale("+g+")")}var v=p.getSubAttribute(t,"polarity");if(null!=v){var b=d.createSvgElement("text");b.appendChild(d.createTextNode(v));var y=n[0]+8*Math.cos(c-Math.PI/2),A=n[1]+8*Math.sin(c-Math.PI/2)+4;p.setMultipleAttributes(b,["x","y"],[y,A]),p.setMultipleAttributes(b,["fill","text-anchor"],[r.getAttribute("stroke"),"middle"]),e.appendChild(b)}if("true"==p.getSubAttribute(t,"delay")){var T=d.createUseElement("link-delay");T.setAttribute("stroke",null==f?"CornflowerBlue":f);var C=r.getPointAtLength(l/2),S=p.radiansToDegrees(p.pathAngleAt(r,l/2));T.setAttribute("transform","translate("+C.x+" "+C.y+") rotate( "+S+")"),e.appendChild(T)}if("true"==p.getSubAttribute(t,"initial-value")){var E=p.getFloatAttribute(r,"stroke-width");r.setAttribute("stroke-dasharray",4*E+","+1.5*E)}return e},t.createCausalLoopIcon=function(t){var e="true"==p.getSubAttribute(t,"clockwise"),r=d.cloneElementWithId(e?"CAUSAL_LOOP_CW":"CAUSAL_LOOP_CCW"),i=d.findChildOfType(r,"loop"),n=d.findChildOfType(r,"arrow"),a=d.findChildOfType(r,"text"),o=p.getSubAttribute(t,"text");a.firstChild.textContent=o;var s=8*o.length;if(s>18){var l=(s+6)/2;i.setAttribute("d","M0 -"+l+" A "+l+" "+l+" 0 1 "+(e?1:0)+" "+(e?-l:l)+" 0"),n.setAttribute("transform","translate("+(e?-1:1)*(l-12)+" 0)")}var u=p.getSubAttribute(t,"color");return null!=u&&(i.setAttribute("stroke",u),n.setAttribute("fill",u),a.setAttribute("fill",u)),r},t.updateStockState=function(t,e){var r=p.splitToFloats(e,","),i=r.length,n=d.findChildOfType(t,"back"),a=d.findChildOfType(t,"bars");if(a.childElementCount<i){for(var o=a.firstElementChild;a.childElementCount<i;)a.appendChild(d.cloneElement(o));var s=p.getFloatAttribute(n,"width"),l=-s/2+1,u=(s-1)/i-1;do{p.setMultipleAttributes(o,["x","width"],[l,u]),l+=u+1,o=o.nextElementSibling}while(null!=o)}for(var c=1/0,h=-1/0,f=0,m=r;f<m.length;f++){var g=m[f];g<c&&(c=g),h<g&&(h=g)}var v=Math.max(Math.abs(c),Math.abs(h)),b=Math.pow(10,Math.ceil(Math.log10(v)));c<0&&(b*=2),b<=0&&(b=1);for(var y=p.getFloatAttribute(n,"height"),A=a.firstElementChild,T=0;T<i;T++){var C=(y-2)*(r[T]/b),S=void 0;r[T]>=0?S=c>=0?y/2-1-C:-C:(C=-C,S=0),p.setMultipleAttributes(A,["y","height"],[S,C]),A=A.nextElementSibling}},t.updateFlowDirection=function(t,e){var r;r="1"==e?"model-primitive-flow-forward":"-1"==e?"model-primitive-flow-backward":"",d.findChildOfType(t,"animation").setAttribute("class",r)},t}(),Vp=function(){function t(){}return t.createStateIcon=function(t){var e=d.cloneElementWithId("STATE"),r=parseFloat(p.getSubAttribute(t,"width")),i=parseFloat(p.getSubAttribute(t,"height"));p.setMultipleAttributes(e,["width","height"],[r,i]);var n=p.getSubAttribute(t,"color"),a="true"==p.getSubAttribute(t,"composite");return e.setAttribute("composite",a?"true":"false"),null!=n?(e.setAttribute("fill",n),e.setAttribute("stroke",p.changeBrightness(n,.8))):a&&(e.setAttribute("fill","none"),e.setAttribute("stroke","Gray")),e.setAttribute("stroke-width",a?"2":"1"),e},t.createFinalStateIcon=function(){return d.cloneElementWithId("FINAL_STATE")},t.createTransitionIcon=function(t){for(var e=d.cloneElementWithId("TRANSITION"),r=d.findChildOfType(e,"path"),i=p.getSubAttribute(t,"points"),n=p.splitSkipEmpty(i,";"),a="",o=0;o<n.length;o++){var s=p.splitToFloats(n[o],",");if(o==n.length-1){var l=p.splitToFloats(n[o-1],","),u=Math.atan2(s[1]-l[1],s[0]-l[0]);s[0]-=Math.round(4*Math.cos(u)),s[1]-=Math.round(4*Math.sin(u));var c=p.radiansToDegrees(u),h="translate("+s[0]+","+s[1]+") rotate("+c+")";d.findChildOfType(e,"arrow").setAttribute("transform",h)}a+=(0==o?"M ":"L ")+s[0]+" "+s[1]+" "}var f=p.roundPathCorners(a,10,!1);r.setAttribute("d",f);var m=p.getSubAttribute(t,"trigger");if(null!=m){var g=d.createUseElement("transition-icon-"+m);g.setAttribute("type","trigger"),g.setAttribute("stroke","Black"),d.findChildOfType(e,"path").setAttribute("d",f);var v=p.getFloatSubAttribute(t,"icon-offset"),b=r.getPointAtLength(v);g.setAttribute("transform","translate("+b.x+","+b.y+")"),e.appendChild(g)}return e},t.createStatePointerIcon=function(t,e){var r=d.cloneElementWithId("STATE_POINTER"),i=d.findChildOfType(r,"line"),n=d.findChildOfType(r,"entry-dash"),a=p.getSubAttribute(t,"dxdy"),o=p.splitToFloats(a,","),s=Math.atan2(o[1],o[0]);o[0]-=Math.round(4*Math.cos(s)),o[1]-=Math.round(4*Math.sin(s)),p.setMultipleAttributes(i,["x2","y2"],[o[0],o[1]]);var l=p.radiansToDegrees(s),u="translate("+o[0]+","+o[1]+") rotate("+l+")";return d.findChildOfType(r,"arrow").setAttribute("transform",u),e?n.setAttribute("transform","rotate("+l+")"):d.removeElement(n),r},t.updateStateState=function(t,e,r){var i="true"==r;if("STATE"==e)if(i)p.setMultipleAttributes(t,["stroke","stroke-width"],["Red",2]);else{var n="true"==t.getAttribute("composite")?2:1,a=t.getAttribute("fill"),o="none"==a?"Gray":p.changeBrightness(a,.8);p.setMultipleAttributes(t,["stroke","stroke-width"],[o,n])}else{var s=d.findChildOfType(t,"outer");n=i?2:1,o=i?"Red":"Black";p.setMultipleAttributes(s,["stroke","stroke-width"],[o,n])}},t.updateTransitionState=function(t,e){var r=d.findChildOfType(t,"path"),i=d.findChildOfType(t,"arrow"),n=d.findChildOfType(t,"trigger"),a="Black";switch(e){case"SCHEDULED":a="Blue";break;case"CURRENT":a="Red"}r.setAttribute("stroke",a),i.setAttribute("fill",a),null!=n&&n.setAttribute("stroke",a)},t}(),Yp=function(){function t(t){this.frameDrawing=t}return t.create=function(){return d.cloneElementWithId("shape-model-primitives")},t.prototype.update=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"static-info":for(var o=p.splitSkipEmpty(i[a],"\n"),s=function(r){var i=p.splitSkipEmpty(o[r],"|"),a=p.getSubAttribute(i,"index"),s=p.getSubAttribute(i,"type"),l=p.getSubAttribute(i,"name"),u=p.getSubAttribute(i,"x"),c=p.getSubAttribute(i,"y"),h=d.cloneElementWithId("model-primitive");h.id=e.id+"-"+a,h.setAttribute("type",s),h.setAttribute("transform","translate("+u+","+c+")");var m=d.findChildOfType(h,"label"),g=d.findChildOfType(h,"info");if(m.appendChild(d.createTextNode(l)),"false"==p.getSubAttribute(i,"show-label"))m.setAttribute("visibility","hidden"),g.setAttribute("visibility","hidden");else{var v=parseFloat(p.getSubAttribute(i,"label-dx")),b=parseFloat(p.getSubAttribute(i,"label-dy"));if("FLOW"==s){var y=p.getSubAttribute(i,"valve-pos"),A=p.splitToFloats(y,",");v+=A[0],b+=A[1]}p.setMultipleAttributes(m,["x","y"],[v,b+4]),p.setMultipleAttributes(g,["x","y"],[v,b+4+9]),g.appendChild(d.createTextNode(""))}var T=void 0;switch(s){case"LINK_TO_AGENTS":T=t.createLinkToAgents(i);break;case"CONNECTOR":T=t.createConnectorIcon(i);break;case"STOCK":T=Hp.createStockIcon(i);break;case"FLOW":T=Hp.createFlowIcon(i);break;case"DYNAMIC_VARIABLE":T=Hp.createDynamicVariableIcon(i);break;case"SHADOW":T=Hp.createShadowIconAndInfo(e,h,i);break;case"LINK":T=Hp.createLinkIcon(i);break;case"CAUSAL_LOOP":T=Hp.createCausalLoopIcon(i);break;case"STATE":T=Vp.createStateIcon(i);break;case"FINAL_STATE":T=Vp.createFinalStateIcon();break;case"TRANSITION":T=Vp.createTransitionIcon(i);break;case"STATECHART_ENTRY_POINT":T=Vp.createStatePointerIcon(i,!0);break;case"INITIAL_STATE_POINTER":T=Vp.createStatePointerIcon(i,!1);break;default:var C=null==document.getElementById(s)?"DEFAULT_MODEL_ELEMENT":s;T=d.createUseElement(C)}T.setAttribute("type","icon"),h.insertBefore(T,m);var S=null;t.dblClickableElements.indexOf(s)>=0&&(S=function(t){return n.onModelPrimitiveMouseEvent(h,"dblclick")}),t.responsiveElements.indexOf(s)>=0&&new f(h,function(t){return n.onModelPrimitiveMouseEvent(h,"mouseover")},function(t){return n.onModelPrimitiveMouseEvent(h,"mouseout")},null,function(t){return n.onModelPrimitiveMouseEvent(h,"click")},null,S),e.appendChild(h)},l=0;l<o.length;l++)s(l);break;case"update":var u=parseInt(i[a]),c=i[a].slice(i[a].indexOf(" ")+1),h=p.splitSkipEmpty(c,"|"),m=d.findChildWithId(e,e.id+"-"+u),g=d.findChildOfType(m,"icon"),v=m.getAttribute("type");for(l=0;l<h.length;l++){var b=h[l].split(":");switch(b[0]){case"label":case"info":d.findChildOfType(m,b[0]).firstChild.textContent=b[1];break;case"info-flag":var y=d.findChildOfType(m,"info"),A="model-primitive-info";"warning"==b[1]&&(A="model-primitive-info-warning"),y.setAttribute("class",A);break;case"null":var T=v+("true"==b[1]?"_NULL":"");d.changeUseHref(g,T);break;case"link-empty":p.setMultipleAttributes(g,["stroke","fill"],"true"==b[1]?["DarkGray","Gainsboro"]:["SteelBlue","LightBlue"]);break;case"standard-icon":g.setAttribute("visibility","true"==b[1]?"inherit":"hidden");break;case"event-state":d.changeUseHref(g,"EVENT_"+b[1]);break;case"port-state":d.changeUseHref(g,"PORT_"+b[1]);break;case"empty":T=v+("true"==b[1]?"_EMPTY":""),d.changeUseHref(g,T);break;case"stock-state":Hp.updateStockState(g,b[1]);break;case"flow-sign":Hp.updateFlowDirection(g,b[1]);break;case"state-active":Vp.updateStateState(g,v,b[1]);break;case"transition-state":Vp.updateTransitionState(g,b[1])}}break;default:mf.filterAndSetAttribute(e,r[a],i[a])}},t.createConnectorIcon=function(t){for(var e=d.cloneElementWithId("CONNECTOR"),r=p.getSubAttribute(t,"points"),i=p.splitSkipEmpty(r,";"),n="",a=0;a<i.length;a++){var o=i[a].split(",");if(0==a){n+="M ";var s=d.findChildOfType(e,"start-circle");p.setMultipleAttributes(s,["cx","cy"],o)}else n+="L ";if(n+=o[0]+" "+o[1]+" ",a==i.length-1){var l=d.findChildOfType(e,"end-circle");if(p.setMultipleAttributes(l,["cx","cy"],o),"true"==p.getSubAttribute(t,"sd")){var u=d.createUseElement("connector-arrow"),c=p.splitToFloats(i[a-1],","),h=Math.atan2(parseFloat(o[1])-c[1],parseFloat(o[0])-c[0]),f=p.radiansToDegrees(h),m="translate("+o[0]+","+o[1]+") rotate("+f+")";u.setAttribute("transform",m),e.appendChild(u)}}}var g=p.roundPathCorners(n,5,!1);return d.findChildOfType(e,"path").setAttribute("d",g),e},t.createLinkToAgents=function(t){var e=d.createSvgElement("g"),r=p.getSubAttribute(t,"multi"),i=p.getSubAttribute(t,"uni");return"true"==r&&e.appendChild(d.createUseElement("link-to-agents-multi")),e.appendChild(d.createUseElement("link-to-agents-basic")),"true"==i&&e.appendChild(d.createUseElement("link-to-agents-uni")),e},t.prototype.onModelPrimitiveMouseEvent=function(t,e){var r=d.findChildOfType(t,"icon"),i=d.findChildOfType(t,"label"),n=t.id.split("-");switch(e){case"mouseover":r.setAttribute("class","clickable-over"),i.setAttribute("font-weight","600");break;case"mouseout":r.removeAttribute("class"),i.setAttribute("font-weight","400");break;case"click":this.frameDrawing.client.postUserAction(n[0],n[1]);break;case"dblclick":this.frameDrawing.client.postUserAction(n[0],n[1]+" dblclick")}},t.getModelPrimitiveByName=function(t,e){for(var r=0,i=d.childElements(t);r<i.length;r++){var n=i[r],a=d.findChildOfType(n,"label");if(null!=a&&a.innerHTML==e)return n}return null},t.responsiveElements=["PARAMETER_STATIC","VARIABLE","CONSTANT","COLLECTION","TABLE_FUNCTION","CUSTOM_DISTRIBUTION","EVENT","SCHEDULE","STATISTICS","DATASET","HISTOGRAM_DATA","HISTOGRAM_2D_DATA","OUTPUT","EXCEL_FILE","TEXT_FILE","DATABASE","LINK_TO_AGENTS","LINK_TO_CONTAINER","STOCK","FLOW","DYNAMIC_VARIABLE","SHADOW","TRAFFIC_LIGHT","EMBEDDED_AGENT_ICON","EMBEDDED_POPULATION_ICON"],t.dblClickableElements=["LINK_TO_AGENTS","LINK_TO_CONTAINER","EMBEDDED_AGENT_ICON","EMBEDDED_POPULATION_ICON"],t}(),jp=function(){function t(t){this.chart=t}return t.prototype.setup=function(t){for(var e=d.findChildOfType(t,"picture"),r=d.findChildOfType(t,"pictureback"),i=d.childElements(d.findChildOfType(t,"legend")),n=i.length,a="true"==t.getAttribute("show-pdf"),o="true"==t.getAttribute("show-cdf"),s="true"==t.getAttribute("show-mean"),l=p.getFloatAttribute(r,"height"),u=0;u<n;u++){var c=d.createSvgElement("g");if(a){var h=d.createSvgElement("g");c.appendChild(h)}if(o){var f=d.createSvgElement("polyline");p.setMultipleAttributes(f,["fill","stroke-width","stroke"],["none",i[u].getAttribute("cdf-line-width"),i[u].getAttribute("cdf-color")]),c.appendChild(f)}if(s){var m=d.createSvgElement("line");p.setMultipleAttributes(m,["stroke-width","stroke","y1","y2"],[i[u].getAttribute("cdf-line-width"),i[u].getAttribute("mean-color"),"0",l.toString()]),c.appendChild(m)}e.appendChild(c),this.chart.addClickTapHandlerToChartItem(c)}},t.prototype.draw=function(t,e){for(var r=d.findChildOfType(t,"pictureback"),i=d.findChildOfType(t,"picture"),n=d.findChildOfType(t,"grid"),a=d.findChildOfType(t,"legend"),o=d.childElements(a),s="true"==t.getAttribute("show-pdf"),l="true"==t.getAttribute("show-cdf"),u="true"==t.getAttribute("show-mean"),c=p.getFloatAttribute(t,"bar-width"),h=p.getFloatAttribute(r,"width"),f=p.getFloatAttribute(r,"height"),m=p.splitSkipEmpty(e," "),g=m.length,v=1/0,b=-1/0,y=1/0,A=-1/0,T=[],C=[],S=[],E=[],w=[],k=[],x=[],M=[],O=[],I=0;I<g;I++)if(o[I].setAttribute("data",m[I]),"empty"!=m[I]){var _=p.splitSkipEmpty(m[I],":");T[I]="true"==_[0],C[I]="true"==_[1],S[I]=parseFloat(_[2]),E[I]=parseFloat(_[3]),w[I]=parseFloat(_[4]),k[I]=parseInt(_[5]),x[I]=parseInt(_[6]),M[I]=p.splitToFloats(_[7],"|");for(var L=0;L<M[I].length;L++)M[I][L]<y&&(y=M[I][L]),A<M[I][L]&&(A=M[I][L]);T[I]&&(O[I]=p.splitToFloats(_[8],"|")),S[I]<v&&(v=S[I]),b<E[I]&&(b=E[I])}v==1/0&&(v=0,b=0),y==1/0&&(y=0,A=1),this.chart.chartScaleAndGrid.recalcChartScale(t,v,b,!1,!1),this.chart.chartScaleAndGrid.recalcChartScale(t,0,A,!0,!1);var P=p.getFloatAttribute(n,"min-x"),R=p.getFloatAttribute(n,"max-x"),D=p.getFloatAttribute(n,"min-y"),F=p.getFloatAttribute(n,"max-y"),N=h/(R-P),B=f/(F-D),G=d.childElements(i);for(I=0;I<g;I++)if("empty"!=m[I]){"hidden"==G[I].getAttribute("visibility")&&G[I].setAttribute("visibility","inherit");var U=M[I].length,z=(E[I]-S[I])/U,W=o[I].getAttribute("original-color"),H=void 0,V=void 0;if(C[I]&&(H=o[I].getAttribute("low-color"),V=o[I].getAttribute("high-color")),s){var Y=G[I].firstElementChild,j=c*z*N,X=z*(1-c)/2;for(L=0;L<U;L++){var q=(S[I]+L*z+X-P)*N,Z=(F-M[I][L])*B,K=M[I][L]*B,Q=d.childElements(Y)[L];Q?Q.setAttribute("visibility","inherit"):(Q=d.createSvgElement("rect"),Y.appendChild(Q)),p.setMultipleAttributes(Q,["x","y","width","height"],[p.reducePrecision(q),p.reducePrecision(Z),p.reducePrecision(j),p.reducePrecision(K)]),T[I]&&C[I]&&L<k[I]?Q.setAttribute("fill",H):T[I]&&C[I]&&x[I]<L?Q.setAttribute("fill",V):Q.setAttribute("fill",W)}var J=d.childElements(Y);for(L=U;L<J.length;L++)J[L].setAttribute("visibility","hidden")}if(l){var $=s?G[I].firstElementChild.nextElementSibling:G[I].firstElementChild,tt="";if(tt+=(S[I]-P)*N+" "+f+" ",T[I])for(L=0;L<U;L++){tt+=p.reducePrecision((S[I]+(L+1)*z-P)*N)+","+p.reducePrecision((1-O[I][L])*f)+" "}$.setAttribute("points",tt)}if(u){var et=G[I].lastElementChild,rt=(w[I]-P)*N;et.setAttribute("x1",rt),et.setAttribute("x2",rt)}if("NONE"!=t.getAttribute("leg-pos")){var it=d.findChildOfType(o[I],"value");it.firstChild.textContent=p.formatNumber(w[I],2),it.setAttribute("fill",o[I].getAttribute("mean-color"))}}else G[I].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&Qp.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var n=d.findChildOfType(t,"picture"),a=d.childElements(n),o=d.childElements(a[e]),s=0;s<o.length;s++)o[s].setAttribute("visibility",r?"hidden":"inherit")},t.dataToString=function(t){for(var e=d.findChildOfType(t,"legend"),r=d.childElements(e),i=r.length,n="",a=0;a<i;a++){n+=Qp.getChratItemName(t,a)+"\n";var o=r[a].getAttribute("data");if("empty"==o)n+="no data\n";else{var s="true"==(o=p.splitSkipEmpty(o,":"))[0],l=parseFloat(o[2]),u=parseFloat(o[3]),c=p.splitToFloats(o[7],"|"),h=void 0;s&&(h=p.splitToFloats(o[8],"|")),n+="from\tto\tPDF",s&&(n+="\tCDF"),n+="\n";for(var f=c.length,m=(u-l)/f,g=l,v=0;v<f;v++)n+=g+"\t"+(g+m)+"\t"+c[v],s&&(n+="\t"+h[v]),n+="\n",g+=m}n+="\n"}return n},t}(),Xp=function(){function t(t){this.chart=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",n=t.getAttribute("scale-type-"+i),a=d.findChildOfType(t,"grid"),o=d.findChildOfType(t,"pictureback"),s=d.findChildOfType(t,e?"pictureborderh":"pictureborderw"),l=a.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=l){var u=p.getFloatAttribute(o,"x"),c=p.getFloatAttribute(o,"y"),h=p.getFloatAttribute(o,"width"),f=p.getFloatAttribute(o,"height"),m="GRID_DEFAULT"==l,g="ChartBar"==r||"ChartStack"==r,v=t.getAttribute("bar-dir");e?g&&(!g||"NORTH"!=v&&"SOUTH"!=v)||p.setMultipleAttributes(s,["x1","y1","x2","y2"],m?[u,c,u,c+f]:[u+h,c,u+h,c+f]):g&&(!g||"EAST"!=v&&"WEST"!=v)||p.setMultipleAttributes(s,["x1","y1","x2","y2"],m?[u,c+f,u+h,c+f]:[u,c,u+h,c])}var b=a.getAttribute("grid-line-color");switch(a.setAttribute("grid-line-color",p.increaseTransparency(b,.5)),n){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var y=p.getFloatAttribute(t,"scale-min-"+i),A=p.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(y="ChartStack"==r?0:Math.min(0,y),A=Math.max(0,A)),this.recalcChartScale(t,y,A,e,!0);break;case"SCALE_TIME_WINDOW":A=Math.max(0,p.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,A,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,n){var a=t.getAttribute("type"),o=d.findChildOfType(t,"grid"),s=i?"min-y":"min-x",l=i?"max-y":"max-x";if(e!=p.getFloatAttribute(o,s)||r!=p.getFloatAttribute(o,l)){var u=e,c=r;if(u==c){if(n)return;u-=1,c+=1,"ChartTimeStack"==a&&u<0&&(u=0)}var h=d.findChildOfType(t,"pictureback"),f=p.getFloatAttribute(h,i?"height":"width"),m=i?25:45,g=p.goodGridStep(c-u,f,m);n?(u=Math.ceil(u/g)*g,c=Math.floor(c/g)*g):(u=Math.floor(u/g)*g,c=Math.ceil(c/g)*g);var v=n?e:u,b=n?r:c;p.setMultipleAttributes(o,[s,l],[v,b]),this.drawChartGrid(t,u,c,g,v,b,i)}},t.prototype.drawChartGrid=function(t,e,r,i,n,a,o){var s=t.getAttribute("type"),l=d.findChildOfType(t,"grid"),u=l.getAttribute(o?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=u){var c=o?l.lastElementChild:l.firstElementChild,h=d.findChildOfType(t,"pictureback"),f=l.getAttribute("grid-text-color"),m=l.getAttribute("grid-line-color"),g=o?"scale-type-y":"scale-type-x",v="SCALE_100_PERCENT"==t.getAttribute(g),b="SCALE_TIME_WINDOW"==t.getAttribute(g)?t.getAttribute("date-format-pattern"):"null",y=Math.round((r-e)/i)+1,A="GRID_DEFAULT"==u,T=!0;if("ChartBar"==s||"ChartStack"==s){var C=t.getAttribute("bar-dir");"SOUTH"!=C&&"WEST"!=C||(T=!1)}for(var S=p.getFloatAttribute(h,"x"),E=p.getFloatAttribute(h,"y"),w=p.getFloatAttribute(h,"width"),k=p.getFloatAttribute(h,"height"),x=(o?k:w)/(a-n),M=i*x;c.childElementCount<y;){var O=d.cloneElementWithId("grid-item");c.appendChild(O)}for(var I=d.childElements(c),_=e,L=o?T?E+(a-e)*x:E+(e-n)*x:T?S+(e-n)*x:S+(a-e)*x,P=0;P<y;P++){var R=o?A?S-4:S:L,D=o?L:A?E+k+4:E+k,F=o?A?S+w:S+w+4:L,N=o?L:A?E:E-4,B=o?A?R-3:F+3:R,G=o?D+3:A?D+11:N-3,U=o?A?"end":"start":"middle";(O=I[P]).setAttribute("visibility","inherit");var z=O.lastElementChild;p.setMultipleAttributes(z,["x1","x2","y1","y2","stroke"],[R,F,D,N,m]);var W=O.firstElementChild;p.setMultipleAttributes(W,["x","y","text-anchor","fill"],[B,G,U,f]);var H=void 0;if(v)H=p.formatPercent(_);else if("null"!=b){var V=this.chart.client.toModelDate(_);(H=p.formatDate(V,b)).length>10&&P%2==1&&(H="")}else H=p.formatNumber(_,2);W.firstChild.textContent=H,_+=i,L+=o?T?-M:+M:T?+M:-M}for(P=y;P<I.length;P++)I[P].setAttribute("visibility","hidden")}},t}(),qp=function(){function t(t){this.chart=t}return t.prototype.setup=function(t){var e,r,i=t.getAttribute("type"),n=d.findChildOfType(t,"pictureback"),a=d.findChildOfType(t,"picture"),o=d.findChildOfType(t,"legend"),s=d.childElements(o),l=s.length,u=p.getFloatAttribute(n,"width"),c=p.getFloatAttribute(n,"height");if("ChartBar"==i||"ChartStack"==i){var h=t.getAttribute("bar-dir");e="NORTH"==h||"SOUTH"==h;var f=p.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?u/l:c/l)*f:(e?u:c)*f}for(var m=0;m<l;m++){var g=void 0,v=s[m].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(g=d.createSvgElement("rect")).setAttribute("stroke","none"),g.setAttribute("fill",v);var b=void 0;e?(b=u/l,g.setAttribute("x","ChartBar"==i?b*m+(b-r)/2:(u-r)/2),g.setAttribute("width",r)):(b=c/l,g.setAttribute("y","ChartBar"==i?b*m+(b-r)/2:(c-r)/2),g.setAttribute("height",r)),a.appendChild(g);break;case"ChartPie":(g=d.createSvgElement("path")).setAttribute("stroke","none"),g.setAttribute("fill",v),a.appendChild(g)}this.chart.addClickTapHandlerToChartItem(g)}for(m=0;m<l;m++)s[m].setAttribute("data","no data")},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=d.findChildOfType(t,"pictureback"),n=d.findChildOfType(t,"grid"),a=d.findChildOfType(t,"legend"),o=d.findChildOfType(t,"picture"),s=d.childElements(o),l=p.getFloatAttribute(i,"width"),u=p.getFloatAttribute(i,"height"),c=p.splitToFloats(e," "),h=c.length,f=1/0,m=-1/0,g=!1,v=0,b=0;b<h;b++)c[b]<f&&(f=c[b]),m<c[b]&&(m=c[b]),c[b]<0&&(g=!0),v+=c[b];var y=!1;if("ChartBar"==r||"ChartStack"==r){var A=t.getAttribute("bar-dir"),T="NORTH"==A||"SOUTH"==A;"ChartBar"==r?(f=Math.min(0,f),m=Math.max(0,m)):(f=0,m=Math.max(0,v));var C=t.getAttribute(T?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=C&&"SCALE_AUTO_FROM_0"!=C||this.chart.chartScaleAndGrid.recalcChartScale(t,f,m,T,!1),y="SCALE_100_PERCENT"==C;var S=p.getFloatAttribute(n,T?"min-y":"min-x"),E=p.getFloatAttribute(n,T?"max-y":"max-x"),w=(T?u:l)/(E-S),k=0;for(b=0;b<h;b++)if("ChartStack"==r&&(g||0==v)||"ChartBar"==r&&y&&(g||0==v))s[b].setAttribute(T?"height":"width",0);else{var x=y?c[b]/v:c[b],M=Math.abs(x),O=void 0;if("ChartBar"==r)switch(A){case"NORTH":case"WEST":O=x>0?E-x:E;break;case"SOUTH":case"EAST":O=x<0?x-S:-S}else{switch(A){case"NORTH":case"WEST":O=E-(x+k);break;case"SOUTH":case"EAST":O=-S+k}k+=x}M*=w;var I=T?u:l;(O*=w)<0?(M-=-O,O=0):O+M>I&&(M-=O+M-I),M<0&&(M=0),T?(s[b].setAttribute("y",O),s[b].setAttribute("height",M)):(s[b].setAttribute("x",O),s[b].setAttribute("width",M))}}else{var _=-Math.PI/2;for(b=0;b<h;b++){var L=v<=0||g?0:2*Math.PI*(c[b]/v),P=l/2,R=u/2,D=p.sectorData(P,R,P,R,_,L);s[b].setAttribute("d",D),_+=L}}("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&y)&&g?Qp.showChartWarning(t,"Neg!"):Qp.hideChartWarning(t);var F=d.childElements(a);for(b=0;b<h;b++)F[b].setAttribute("data",c[b]);if("NONE"!=t.getAttribute("leg-pos")){for(b=0;b<h;b++){var N=d.findChildOfType(F[b],"value"),B=p.formatNumber(c[b],2);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&y)&&v>0&&!g&&(B+=" ("+p.formatPercent(c[b]/v)+")"),N.firstChild.textContent=B,N.setAttribute("fill",c[b]>=0?"royalBlue":"fireBrick")}Qp.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){d.childElements(d.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t.dataToString=function(t){for(var e=d.findChildOfType(t,"legend"),r=d.childElements(e),i=r.length,n="",a=0;a<i;a++){n+=Qp.getChratItemName(t,a)+"\t"+r[a].getAttribute("data")+"\n"}return n},t}(),Zp=function(){function t(t){this.chart=t}return t.prototype.setup=function(t){for(var e=d.findChildOfType(t,"picture"),r=d.childElements(d.findChildOfType(t,"legend")).length,i=0;i<r;i++){var n=d.createSvgElement("g");n.setAttribute("stroke","none"),e.appendChild(n),this.chart.addClickTapHandlerToChartItem(n)}},t.prototype.draw=function(t,e){for(var r=d.findChildOfType(t,"pictureback"),i=d.findChildOfType(t,"picture"),n=d.findChildOfType(t,"grid"),a=d.findChildOfType(t,"legend"),o=d.childElements(a),s=p.getFloatAttribute(r,"width"),l=p.getFloatAttribute(r,"height"),u=p.splitSkipEmpty(e," "),c=u.length,h=1/0,f=-1/0,m=1/0,g=-1/0,v=[],b=[],y=[],A=[],T=[],C=[],S=[],E=0;E<c;E++){o[E].setAttribute("data",u[E]);var w=p.splitSkipEmpty(u[E],":");v[E]=parseFloat(w[0]),b[E]=parseFloat(w[1]),T[E]=parseInt(w[2]),y[E]=parseFloat(w[3]),A[E]=parseFloat(w[4]),C[E]=parseInt(w[5]);var k=p.splitSkipEmpty(w[6],"#");v[E]<h&&(h=v[E]),f<b[E]&&(f=b[E]),y[E]<m&&(m=y[E]),g<A[E]&&(g=A[E]);for(var x=[],M=0;M<T[E];M++)"empty"==k[M]?x[M]="empty":x[M]=p.splitSkipEmpty(k[M],"|");S[E]=x}h==1/0&&(h=-1,f=1),m==1/0&&(m=-1,g=1),this.chart.chartScaleAndGrid.recalcChartScale(t,h,f,!1,!1),this.chart.chartScaleAndGrid.recalcChartScale(t,m,g,!0,!1);var O=p.getFloatAttribute(n,"min-x"),I=p.getFloatAttribute(n,"max-x"),_=p.getFloatAttribute(n,"min-y"),L=s/(I-O),P=l/(p.getFloatAttribute(n,"max-y")-_),R=d.childElements(i);for(E=0;E<c;E++){var D=o[E].getAttribute("original-color");d.removeAllChildren(R[E]);var F=(b[E]-v[E])/T[E]*L,N=(A[E]-y[E])/C[E]*P,B=(v[E]-O)*L;for(M=0;M<T[E];M++){if("empty"!=S[E][M])for(var G=(A[E]-_)*P-N,U=0;U<C[E];U++){var z=S[E][M][U];if(z>0){var W=d.createSvgElement("rect"),H=p.increaseTransparency(D,z);p.setMultipleAttributes(W,["x","y","width","height","fill"],[B,G,F,N,H]),R[E].appendChild(W)}G-=N}B+=F}}},t.setItemLook=function(t,e,r,i){var n=d.findChildOfType(t,"picture");d.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t.dataToString=function(t){for(var e=d.findChildOfType(t,"legend"),r=d.childElements(e),i=r.length,n="",a=0;a<i;a++){n+=Qp.getChratItemName(t,a),"true"==t.getAttribute("draw-envelopes")&&(n+=" (envelopes)"),n+="\n";var o=r[a].getAttribute("data"),s=p.splitSkipEmpty(o,":"),l=parseFloat(s[0]),u=parseFloat(s[1]),c=parseInt(s[2]),h=parseFloat(s[3]),f=parseFloat(s[4]),m=parseInt(s[5]),g=p.splitSkipEmpty(s[6],"#"),v=(u-l)/c,b=(f-h)/m;n+="\t";for(var y=0;y<m;y++)n+=p.formatNumber(h+b*y,2)+"\t";n+="\n";for(var A=0;A<c;A++){if(n+=p.formatNumber(l+v*A,2)+"\t","empty"==g[A])for(y=0;y<m;y++)n+="0\t";else n+=g[A].replace(/\|/g,"\t");n+="\n"}n+="\n"}return n},t}(),Kp=function(){function t(t){this.chart=t}return t.prototype.setup=function(t){var e=d.findChildOfType(t,"picture"),r=d.findChildOfType(t,"pictureback"),i=p.getFloatAttribute(r,"height"),n=d.childElements(d.findChildOfType(t,"legend")),a=n.length,o=i/a,s=o*p.getFloatAttribute(t,"bar-width"),l=(o-s)/2;t.setAttribute("rect-height",p.reducePrecision(s).toString());for(var u=0;u<a;u++){n[u].setAttribute("data","empty");var c=d.createSvgElement("g");c.setAttribute("transform","translate(0,"+(u*o+l)+")"),e.appendChild(c),this.chart.addClickTapHandlerToChartItem(c)}},t.prototype.draw=function(e,r){for(var i=d.findChildOfType(e,"pictureback"),n=d.findChildOfType(e,"picture"),a=d.findChildOfType(e,"grid"),o=p.getFloatAttribute(i,"width"),s=Jp.mergeData(e,r),l=s.length,u=-1/0,c=0;c<l;c++)if("empty"==s[c])s[c]=[];else{s[c]=p.splitSkipEmpty(s[c],"|");for(var h=0;h<s[c].length;h++)s[c][h]=s[c][h].split(":"),s[c][h][0]=parseFloat(s[c][h][0]),s[c][h][1]=parseFloat(s[c][h][1]);var f=s[c][s[c].length-1][0];u<f&&(u=f)}u==1/0&&(u=0);for(c=0;c<l;c++)0!=s[c].length&&s[c][s[c].length-1][0]<u&&s[c].push([u,s[c][s[c].length-1][1]]);var m,g=p.getFloatAttribute(e,"scale-max-x");m="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(u,g):Math.max(u,g,this.chart.client.getModelTime()),this.chart.chartScaleAndGrid.recalcChartScale(e,m-g,m,!1,!0);var v=p.getFloatAttribute(a,"min-x"),b=o/(p.getFloatAttribute(a,"max-x")-v),y=d.childElements(n),A=p.getFloatAttribute(e,"rect-height"),T=t.colorMapping(e);for(c=0;c<l;c++){var C=y[c],S=d.childElements(C),E=S.length,w=0,k="",x=null;for(h=0;h<s[c].length;h++){var M=s[c][h][0],O=s[c][h][1];if(M<v)x=0,k=T(O);else if(null==x)x=(M-v)*b,k=T(O);else{var I=T(O);if(I!=k||h==s[c].length-1){var _=(M-v)*b,L=void 0;w<E?(L=S[w],w++,L.setAttribute("visibility","inherit")):(L=d.createSvgElement("rect"),C.appendChild(L)),p.setMultipleAttributes(L,["x","width","height","fill"],[p.reducePrecision(x),p.reducePrecision(_-x),A,k]),x=_,k=I}}}for(var P=w;P<E;P++)S[P].setAttribute("visibility","hidden")}},t.colorMapping=function(t){for(var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color"),i=p.splitSkipEmpty(e," "),n=[],a=[],o=function(t){var e=i[t].split(":"),r=void 0,o=parseFloat(e[1]);switch(e[0]){case"GREATER":r=function(t){return t>o};break;case"GREATER_OR_EQUALS":r=function(t){return t>=o};break;case"LESS":r=function(t){return t<o};break;case"LESS_OR_EQUALS":r=function(t){return t<=o};break;case"EQUALS":r=function(t){return t==o};break;case"NOT_EQUALS":r=function(t){return t!=o}}n[t]=r,a[t]=e[2]},s=0;s<i.length;s++)o(s);return function(t){for(var e=0;e<n.length;e++)if(n[e](t))return a[e];return r}},t.setItemLook=function(t,e,r,i){var n=d.findChildOfType(t,"picture");d.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),Qp=function(){function t(t){this.client=t,this.chartScaleAndGrid=new Xp(this),this.chart1D=new qp(this),this.chart2D=new Jp(this),this.chartHistogram=new jp(this),this.chartHistogram2D=new Zp(this),this.chartTimeColor=new Kp(this)}return t.create=function(){return d.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var n=e.getAttribute("type"),a=d.findChildOfType(e,"background"),o=d.findChildOfType(e,"pictureback"),s=d.findChildOfType(e,"pictureselect"),l=d.findChildOfType(e,"picture"),u=d.findChildOfType(e,"pictureborderh"),c=d.findChildOfType(e,"pictureborderw"),h=d.findChildOfType(e,"grid"),p=0;p<r.length;p++)switch(r[p]){case"width":case"height":case"fill":case"stroke":a.setAttribute(r[p],i[p]);break;case"pic-width":case"pic-height":o.setAttribute(r[p].substring(4),i[p]),s.setAttribute(r[p].substring(4),i[p]),l.setAttribute(r[p].substring(4),i[p]);break;case"pic-fill":o.setAttribute(r[p].substring(4),i[p]);break;case"pic-stroke":u.setAttribute(r[p].substring(4),i[p]),c.setAttribute(r[p].substring(4),i[p]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":h.setAttribute(r[p],i[p]);break;case"grid-completed":"ChartPie"!=n&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":this.addItem(e,i[p]);break;case"items-completed":t.setupLegendItemsLayout(e),this.setupPicture(e);var f=e.getAttribute("selection");f&&t.setSelection(e,f);break;case"data":this.drawPicture(e,i[p]);break;case"selection":t.setSelection(e,i[p]),e.setAttribute(r[p],i[p]);break;default:mf.filterAndSetAttribute(e,r[p],i[p])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=d.findChildOfType(e,"background"),n=d.findChildOfType(e,"pictureback"),a=d.findChildOfType(e,"pictureselect"),o=d.findChildOfType(e,"picture"),s=d.findChildOfType(e,"pictureborderh"),l=d.findChildOfType(e,"pictureborderw"),u=d.findChildOfType(e,"warning"),c=d.findChildOfType(e,"legend"),h=d.findChildOfType(e,"controls"),f=e.getAttribute("leg-pos"),m=p.getFloatAttribute(i,"width"),g=p.getFloatAttribute(i,"height"),v=p.getFloatAttribute(e,"pic-offset-x"),b=p.getFloatAttribute(e,"pic-offset-y"),y=p.getFloatAttribute(n,"width"),A=p.getFloatAttribute(n,"height"),T=p.getFloatAttribute(e,"leg-size"),C=0,S=0,E=0,w=0;switch(f){case"SOUTH":C=v,S=g-T,E=m-v,w=T;break;case"WEST":v+=T,C=0,S=b,E=T,w=g-b;break;case"EAST":C=m-T,S=b,E=T,w=g-b;break;case"NORTH":b+=T,C=v,S=0,E=m-v,w=T}if(p.setMultipleAttributes(n,["x","y"],[v,b]),p.setMultipleAttributes(a,["x","y"],[v,b]),p.setMultipleAttributes(o,["x","y"],[v,b]),p.setMultipleAttributes(u,["x","y"],[v+y/2,b+A/2+3]),h.setAttribute("transform","translate("+(v+y)+","+b+")"),"NONE"==f?c.setAttribute("visibility","hidden"):(c.setAttribute("transform","translate("+C+","+S+")"),p.setMultipleAttributes(c,["width","height"],[E,w])),"ChartPie"==r){var k=y/2,x=A/2,M=d.createSvgElement("ellipse");p.setMultipleAttributes(M,["cx","cy","rx","ry","stroke","fill","visibility"],[v+k,b+x,k,x,"none",n.getAttribute("fill"),"hidden"]),e.insertBefore(M,n);var O=d.createSvgElement("ellipse");p.setMultipleAttributes(O,["cx","cy","rx","ry","stroke","fill"],[v+k,b+x,k,x,s.getAttribute("stroke"),"none"]),e.insertBefore(O,s),d.removeElement(s),d.removeElement(l)}var I=mp.create("icon-copy","rgba(220,220,220,0.7)","Black","DimGray","White",function(r){return t.copyToClipboard(e)},null);I.setAttribute("transform","translate(-20,0)"),h.appendChild(I),e.addEventListener("mouseover",function(e){return t.selectChart(e,!0)}),e.addEventListener("mouseout",function(e){return t.selectChart(e,!1)})},t.setupLegendItemsLayout=function(t){for(var e=d.findChildOfType(t,"legend"),r=d.childElements(e),i=p.getFloatAttribute(e,"width"),n=0,a=0,o=0;o<r.length;o++){var s=r[o],l=d.findChildOfType(s,"back"),u=p.getFloatAttribute(l,"width"),c=d.findChildOfType(s,"value"),h=6*c.firstChild.textContent.length,f=Math.max(u,p.getFloatAttribute(c,"x")+h);f>u&&l.setAttribute("width",f.toString()),0<n&&i<n+f&&(n=0,a+=20),s.setAttribute("transform","translate("+n+","+a+")"),n+=f+5}},t.showChartWarning=function(t,e){var r=d.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=d.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=d.findChildOfType(t,"picture"),r=d.findChildOfType(t,"legend");d.removeAllChildren(r),d.removeAllChildren(e)},t.prototype.addItem=function(t,e){var r=t.getAttribute("type"),i=d.findChildOfType(t,"legend"),n=e.split("\n"),a=n[0],o=n[1],s=d.cloneElementWithId("legend-item"),l=d.findChildOfType(s,"color"),u=d.findChildOfType(s,"name"),c=d.findChildOfType(s,"value");l.setAttribute("fill",a),s.setAttribute("original-color",a),u.setAttribute("fill",t.getAttribute("leg-text-color")),u.appendChild(d.createTextNode(o)),c.appendChild(d.createTextNode("")),i.appendChild(s);var h=u.getComputedTextLength();c.setAttribute("x",(p.getFloatAttribute(u,"x")+h+4).toString()),"ChartPlot"==r||"ChartTimePlot"==r?p.setMultipleAttributes(s,["draw-line","line-width","interpolation","point-style","fill-under-line"],[n[2],n[3],n[4],n[5],n[6]]):"ChartHistogram"==r&&p.setMultipleAttributes(s,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[n[2],n[3],n[4],n[5],n[6]]),this.addClickTapHandlerToChartItem(s)},t.prototype.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.setup(t);break;case"ChartTimeColor":this.chartTimeColor.setup(t);break;case"ChartHistogram":this.chartHistogram.setup(t);break;case"ChartHistogram2D":this.chartHistogram2D.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":this.chartHistogram2D.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.setSelection=function(e,r){var i=p.splitSkipEmpty(r," ").map(function(t){return"true"==t}),n=!1;i.forEach(function(t){n=n||t});for(var a=d.childElements(d.findChildOfType(e,"legend")),o=0;o<a.length;o++){var s=a[o],l=o<i.length&&i[o];s.setAttribute("selected",l?"true":"false"),t.setChartItemLook(e,o,!l&&n,l)}},t.selectChart=function(t,e){var r=t.currentTarget,i=r.getAttribute("type"),n=d.findChildOfType(r,"pictureselect"),a=d.findChildOfType(r,"controls");"ChartPie"!=i&&n.setAttribute("visibility",e?"inherit":"hidden"),a.setAttribute("class",e?"shown-with-transition":"hidden-with-transition")},t.prototype.addClickTapHandlerToChartItem=function(t){var e=this;new f(t,function(r){return e.selectChartItem(t,!0,!1,r)},function(r){return e.selectChartItem(t,!1,!1,r)},null,function(r){return e.selectChartItem(t,!0,!0,r)},null)},t.prototype.selectChartItem=function(e,r,i,n){for(var a=t.getChartShape(e),o=p.indexInParent(e),s=d.childElements(d.findChildOfType(a,"legend")),l=s[o],u="true"==l.getAttribute("selected"),c=!1,h=0;h<s.length;h++)if(h!=o&&"true"==s[h].getAttribute("selected")){c=!0;break}if(r&&"legend"!=e.parentNode.getAttribute("type")){var f=n,m=t.getChratItemName(a,o);this.client.showTooltip(m,f.clientX,f.clientY,"Black","White")}else this.client.hideTooltip();if(i){u=!u,l.setAttribute("selected",u?"true":"false"),t.setChartItemLook(a,o,!1,u);var g="";for(h=0;h<s.length;h++)"true"==s[h].getAttribute("selected")&&(g+=h+" ");this.client.postUserAction(a.id,"setselection "+g)}else if(u||c){if(u)return;t.setChartItemLook(a,o,!r,r)}else{t.setChartItemLook(a,o,!1,r);for(h=0;h<s.length;h++)h!=o&&t.setChartItemLook(a,h,r,!1)}},t.setChartItemLook=function(e,r,i,n){var a=d.childElements(d.findChildOfType(e,"legend")),o=d.findChildOfType(a[r],"back"),s=d.findChildOfType(a[r],"color");o.setAttribute("class",n?"legend-item-background-selected":"legend-item-background");var l=i?t.colorItemGrayed:a[r].getAttribute("original-color");switch(s.setAttribute("fill",l),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":qp.setItemLook(e,r,i,l);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":Jp.setItemLook(e,r,i,l);break;case"ChartTimeColor":Kp.setItemLook(e,r,i,l);break;case"ChartHistogram":jp.setItemLook(e,r,i,l);break;case"ChartHistogram2D":Zp.setItemLook(e,r,i,l)}},t.copyToClipboard=function(t){var e;switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":e=qp.dataToString(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":e=Jp.dataToString(t);break;case"ChartHistogram":e=jp.dataToString(t);break;case"ChartHistogram2D":e=Zp.dataToString(t)}p.copyToClipboard(e)},t.datasetToString=function(t,e){return"\t"+t+"\n"+(e=(e=e.replace(/\|/g,"\n")).replace(/:/g,"\t"))},t.datasetsWithSharedXToString=function(t,e){for(var r=e.length,i=e,n=0;n<r;n++)if("empty"==i[n])i[n]=[];else{i[n]=p.splitSkipEmpty(i[n],"|");for(var a=0;a<i[n].length;a++)i[n][a]=i[n][a].split(":")}var o="";for(n=0;n<r;n++)o+="\t"+t[n];o+="\n";var s=new Array(r);for(s.fill(0);;){var l=1/0;for(n=0;n<r;n++)s[n]<e[n].length&&parseFloat(e[n][s[n]][0])<l&&(l=parseFloat(e[n][s[n]][0]));if(l==1/0)return o;o+=l;for(n=0;n<r;n++)o+="\t",s[n]<e[n].length&&parseFloat(e[n][s[n]][0])==l&&(o+=e[n][s[n]][1],s[n]++);o+="\n"}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.getChratItemName=function(t,e){var r=d.findChildOfType(t,"legend"),i=d.childElements(r);return d.findChildOfType(i[e],"name").firstChild.textContent},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),Jp=function(){function t(t){this.chart=t}return t.prototype.setup=function(e){for(var r=e.getAttribute("type"),i=d.findChildOfType(e,"picture"),n=d.childElements(d.findChildOfType(e,"legend")),a=n.length,o=0;o<a;o++){var s=n[o].getAttribute("original-color"),l=d.createSvgElement("g");switch(n[o].setAttribute("data","empty"),r){case"ChartPlot":case"ChartTimePlot":if("true"==n[o].getAttribute("draw-line")){var u=d.createSvgElement("polyline");if(u.setAttribute("fill","none"),u.setAttribute("stroke",s),u.setAttribute("stroke-width",n[o].getAttribute("line-width")),l.appendChild(u),"true"==n[o].getAttribute("fill-under-line")){var c=d.createSvgElement("polyline");c.setAttribute("stroke","none"),c.setAttribute("fill",p.increaseTransparency(s,t.timePlotAlpha)),l.appendChild(c)}}if("POINT_NONE"!=n[o].getAttribute("point-style")){var h=d.createSvgElement("g");h.setAttribute("fill",s),l.appendChild(h)}break;case"ChartTimeStack":var f=d.createSvgElement("polyline");f.setAttribute("stroke-width","1"),f.setAttribute("stroke",s),f.setAttribute("fill","none"),l.appendChild(f);var m=d.createSvgElement("polyline");m.setAttribute("stroke","none"),m.setAttribute("fill",p.increaseTransparency(s,t.stackChartAlpha)),l.appendChild(m)}i.appendChild(l),this.chart.addClickTapHandlerToChartItem(l)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),n=d.findChildOfType(e,"pictureback"),a=d.findChildOfType(e,"picture"),o=d.findChildOfType(e,"grid"),s=d.childElements(d.findChildOfType(e,"legend")),l=p.getFloatAttribute(n,"width"),u=p.getFloatAttribute(n,"height"),c=u,h=t.mergeData(e,r),f=h.length,m=t.parseDataAndFindMinMax(h),g=m.datasets,v=m.minx,b=m.maxx,y=m.miny,A=m.maxy;if("ChartTimeStack"==i&&y<0)Qp.showChartWarning(e,"Neg!");else{Qp.hideChartWarning(e),"ChartTimeStack"==i&&(y=0,A=t.prepareChartTimeStackData(g));var T,C=e.getAttribute("scale-type-x"),S=e.getAttribute("scale-type-y"),E="SCALE_100_PERCENT"==S;if("SCALE_AUTO"==C)this.chart.chartScaleAndGrid.recalcChartScale(e,v,b,!1,!1);else if("SCALE_TIME_WINDOW"==C){T=p.getFloatAttribute(e,"scale-max-x");var w=void 0;w="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(b,T):Math.max(b,T,this.chart.client.getModelTime()),this.chart.chartScaleAndGrid.recalcChartScale(e,w-T,w,!1,!0)}"SCALE_AUTO"==S&&this.chart.chartScaleAndGrid.recalcChartScale(e,y,A,!0,!1);for(var k=p.getFloatAttribute(o,"min-x"),x=p.getFloatAttribute(o,"max-x"),M=p.getFloatAttribute(o,"min-y"),O=p.getFloatAttribute(o,"max-y"),I=l/(x-k),_=u/(O-M),L=d.childElements(a),P="",R=0;R<f;R++){var D=void 0,F=void 0,N=void 0,B=void 0,G=void 0,U=void 0,z=void 0,W=void 0,H=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(D="true"==s[R].getAttribute("draw-line"),F=s[R].getAttribute("point-style"),N="INTERPOLATION_STEP"==s[R].getAttribute("interpolation")),(D||"ChartTimeStack"==i)&&(G=(B=L[R].firstElementChild).nextElementSibling),F&&"POINT_NONE"!=F)switch(U=L[R].lastElementChild,F){case"POINT_CIRCLE":z="plot-point-circle",W=0,H=0;break;case"POINT_SQUARE":z="plot-point-square",W=-1.5,H=-1.5;break;case"POINT_TRIANGLE":z="plot-point-triangle",W=0,H=0}for(var V=void 0,Y=void 0,j="",X="",q=void 0,Z=void 0,K=0,Q=0;Q<g[R].length;Q++){var J=(g[R][Q][0]-k)*I,$=void 0;if(E){var tt=g[f-1][Q][1];$=tt<=0?0:g[R][Q][1]/tt}else $=g[R][Q][1];var et=(-$+O)*_;if(J<0&&(J=0),l<J&&(J=l),et<0&&(et=0),u<et&&(et=u),!(null!=V&&Math.abs(J-V)<Qp.chartTolerance&&Math.abs(et-Y)<Qp.chartTolerance)){if(J=p.reducePrecision(J),et=p.reducePrecision(et),0==Q&&(q=J),Z=J,B&&(N&&null!=V&&(j+=J+","+Y+" "),j+=J+","+et+" ",G&&(0==R&&(P=J+","+c+" "+P),X=J+","+et+" "+X)),U){var rt=d.childElements(U)[K];rt?rt.setAttribute("visibility","inherit"):(rt=d.createUseElement(z),U.appendChild(rt)),rt.setAttribute("x",W+J),rt.setAttribute("y",H+et)}K++,V=J,Y=et}}if(B&&(B.setAttribute("points",j),G))if("ChartTimePlot"==i){var it="";if(""!=j){var nt=O*_;nt<0&&(nt=0),u<nt&&(nt=u),it=Z+","+nt+" "+q+","+nt}G.setAttribute("points",j+it)}else G.setAttribute("points",j+P),P=X;if(U){var at=d.childElements(U);for(Q=K;Q<at.length;Q++)at[Q].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,n){var a=e.getAttribute("type"),o=d.childElements(d.findChildOfType(e,"legend")),s=d.childElements(d.findChildOfType(e,"picture"));if("ChartTimeStack"==a)s[r].firstElementChild.setAttribute("stroke",n),s[r].lastElementChild.setAttribute("fill",p.increaseTransparency(n,t.stackChartAlpha));else{if("true"==o[r].getAttribute("draw-line")){var l=s[r].firstElementChild;l.setAttribute("stroke",n);var u=l.nextElementSibling;u&&u.setAttribute("fill",p.increaseTransparency(n,t.timePlotAlpha))}"POINT_NONE"!=o[r].getAttribute("point-style")&&s[r].lastElementChild.setAttribute("fill",n)}},t.mergeData=function(e,r){for(var i=d.findChildOfType(e,"legend"),n=d.childElements(i),a=p.splitSkipEmpty(r," "),o=a.length,s=[],l=0;l<o;l++){var u=n[l].getAttribute("data"),c=t.mergeDataset(u,a[l]);n[l].setAttribute("data",c),s.push(c)}return s},t.mergeDataset=function(t,e){var r=p.splitSkipEmpty(e,"#"),i=parseInt(r[0]),n=parseInt(r[1]),a=r[2];if("empty"==t||0==n)return a;var o=p.splitSkipEmpty(t,"|");o.splice(0,i),o.splice(n);var s=o.join("|")+"|";return"empty"==a?s:s+a},t.parseDataAndFindMinMax=function(t){for(var e=t,r=e.length,i=1/0,n=-1/0,a=1/0,o=-1/0,s=0;s<r;s++)if("empty"==e[s])e[s]=[];else{e[s]=p.splitSkipEmpty(e[s],"|");for(var l=0;l<e[s].length;l++){e[s][l]=e[s][l].split(":");var u=e[s][l][0]=parseFloat(e[s][l][0]),c=e[s][l][1]=parseFloat(e[s][l][1]);u<i&&(i=u),n<u&&(n=u),c<a&&(a=c),o<c&&(o=c)}}return i==1/0&&(i=0,n=0),a==1/0&&(a=0,o=0),{datasets:e,minx:i,maxx:n,miny:a,maxy:o}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a].length<=i||t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.dataToString=function(t){var e=t.getAttribute("type"),r=d.findChildOfType(t,"legend"),i=d.childElements(r),n=i.length;if("ChartPlot"==e){for(var a="",o=0;o<n;o++){var s=Qp.getChratItemName(t,o),l=i[o].getAttribute("data");a+=Qp.datasetToString(s,l)+"\n"}return a}var u=new Array(n);for(l=new Array(n),o=0;o<n;o++)u[o]=Qp.getChratItemName(t,o),l[o]=i[o].getAttribute("data");return Qp.datasetsWithSharedXToString(u,l)},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),$p=function(){function t(t){this.resizing=!1,this.moving=!1,this.scrolling=!1,this.frameDrawing=t}return t.prototype.create=function(){var e=this,r=d.cloneElementWithId("shape-inspect"),i=d.findChildOfType(r,"svg"),n=d.findChildOfType(i,"info"),a=d.findChildOfType(i,"chart"),o=d.findChildOfType(i,"controls"),s=mp.create("icon-info","Moccasin","DarkRed","Wheat","DarkRed",function(){d.bringElementToFront(r),n.setAttribute("class","shown-with-transition"),a.setAttribute("class","hidden-with-transition")},null);s.setAttribute("type","show-info"),s.setAttribute("transform","translate(-80,0)"),o.appendChild(s);var l=mp.create("icon-chart","Ivory","DarkRed","Beige","DarkRed",function(){d.bringElementToFront(r),n.setAttribute("class","hidden-with-transition"),a.setAttribute("class","shown-with-transition")},null);l.setAttribute("type","show-chart"),l.setAttribute("transform","translate(-60,0)"),o.appendChild(l);var u=mp.create("icon-copy","LightSalmon","DarkRed","IndianRed","White",function(){d.bringElementToFront(r),t.copyInspect(r)},null);u.setAttribute("transform","translate(-40,0)"),o.appendChild(u);var c=mp.create("icon-close","LightSalmon","DarkRed","IndianRed","White",function(){return e.closeInspct(r)},null);c.setAttribute("transform","translate(-20,0)"),o.appendChild(c);var h=function(t){return e.onInspectEvent(t)};return r.addEventListener("mouseover",h),r.addEventListener("mouseout",h),r.addEventListener("mousedown",h),r.addEventListener("wheel",h),r.addEventListener("touchstart",h),r},t.prototype.update=function(e,r,i){for(var n=d.findChildOfType(e,"svg"),a=d.findChildOfType(n,"name-text"),o=d.findChildOfType(n,"info"),s=d.findChildOfType(o,"info-text"),l=0;l<r.length;l++)switch(r[l]){case"name":a.firstChild.textContent=i[l];break;case"info":var u=d.findChildOfType(n,"chart");s.setAttribute("content",i[l]);for(var c=i[l].split("\n"),h=0;h<c.length;h++)c[h]=p.replaceTabsWithSpaces(c[h],8);if(Wp.drawMultiLineText(s,c,12,0),c.length<=2&&null==u){var f=p.getFloatAttribute(n,"height");t.resizeInspect(e,0,60-f)}else t.scrollInfoText(e,0);break;case"editable-as":s.setAttribute("class","inspect-info-text-editable"),e.setAttribute(r[l],i[l]);break;case"dataset-names":var m=p.splitSkipEmpty(i[l]," ");u=d.findChildOfType(n,"chart");var g=d.findChildOfType(u,"plot"),v=m.length;if(0==v){d.removeElement(u);var b=d.findChildOfType(n,"controls"),y=d.findChildOfType(b,"show-info"),A=d.findChildOfType(b,"show-chart");d.removeElement(y),d.removeElement(A)}else{var T=d.findChildOfType(g,"picture");for(h=0;h<v;h++){var C=d.cloneElementWithId("inspect-plot-item");C.setAttribute("name",m[h]);var S=t.plotColors[h%t.plotColors.length];C.setAttribute("stroke",S),T.appendChild(C)}}break;case"data":u=d.findChildOfType(n,"chart"),g=d.findChildOfType(u,"plot");var E=d.findChildOfType(g,"picture"),w=d.childElements(E),k=p.splitSkipEmpty(i[l]," ");v=k.length;var x=[];for(h=0;h<v;h++){var M=w[h].getAttribute("data"),O=Jp.mergeDataset(M,k[h]);w[h].setAttribute("data",O),x.push(O)}var I=Jp.parseDataAndFindMinMax(x),_=I.datasets,L=I.minx,P=I.maxx,R=I.miny,D=I.maxy;t.recalcChartScaleAndDrawGrid(u,L,P,!1,!1),t.recalcChartScaleAndDrawGrid(u,R,D,!0,!1),t.drawPlotLines(u,_);break;default:if(mf.filterAndSetAttribute(e,r[l],i[l]),"pos"==r[l]){var F=this.frameDrawing.client.svgContainer.getBoundingClientRect(),N=p.getFloatAttribute(n,"height"),B=n.getBoundingClientRect(),G=B.height/N,U=B.right>F.right?-(B.right-F.right)/G:0,z=B.bottom>F.bottom?-(B.bottom-F.bottom)/G:0;0==U&&0==z||t.moveInspect(e,U,z)}}},t.recalcChartScaleAndDrawGrid=function(e,r,i,n,a){var o=d.findChildOfType(e,"plot"),s=d.findChildOfType(o,"grid"),l=n?"min-y":"min-x",u=n?"max-y":"max-x",c=r,h=i;c==h&&(c-=1,h+=1);var f=d.findChildOfType(e,"chart-back"),m=p.getFloatAttribute(f,n?"height":"width")-(n?17:10),g=n?25:45,v=p.goodGridStep(h-c,m,g);c=Math.floor(c/v)*v,h=Math.ceil(h/v)*v,(a||c!=p.getFloatAttribute(s,l)||h!=p.getFloatAttribute(s,u))&&(p.setMultipleAttributes(s,[l,u],[c,h]),t.drawChartGrid(e,c,h,v,n))},t.drawChartGrid=function(t,e,r,i,n){for(var a=d.findChildOfType(t,"plot"),o=d.findChildOfType(a,"grid"),s=n?o.lastElementChild:o.firstElementChild,l=d.findChildOfType(o,"zero-line"),u=d.findChildOfType(t,"chart-back"),c=Math.round((r-e)/i)+1,h=p.getFloatAttribute(u,"width")-10,f=p.getFloatAttribute(u,"height")-17,m=(n?f:h)/(r-e),g=i*m;s.childElementCount<c;){var v=d.cloneElementWithId("inspect-grid-item");s.appendChild(v)}for(var b=d.childElements(s),y=e,A=n?(r-e)*m:0,T=!1,C=0;C<c;C++){var S=n?0:A,E=n?A:f,w=n?h:A,k=n?A:0,x=n?S+1:S,M=n?0==C?E-2:C==c-1?E+8:E-3:E+9,O=n?"start":0==C?"start":C==c-1?"end":"middle";(v=b[C]).setAttribute("visibility","inherit");var I=v.lastElementChild;p.setMultipleAttributes(I,["x1","x2","y1","y2"],[S,w,E,k]),n&&Math.abs(y)<i/10&&(p.setMultipleAttributes(l,["x1","x2","y1","y2"],[S,w,E,k]),T=!0);var _=v.firstElementChild;p.setMultipleAttributes(_,["x","y","text-anchor"],[x,M,O]),_.firstChild.textContent=p.formatNumber(y,2),y+=i,A+=n?-g:+g}for(C=c;C<b.length;C++)b[C].setAttribute("visibility","hidden");n&&l.setAttribute("visibility",T?"inherit":"hidden")},t.drawPlotLines=function(t,e){for(var r=d.findChildOfType(t,"plot"),i=d.findChildOfType(t,"chart-back"),n=d.findChildOfType(r,"picture"),a=d.findChildOfType(r,"grid"),o=p.getFloatAttribute(i,"width")-10,s=p.getFloatAttribute(i,"height")-17,l=p.getFloatAttribute(a,"min-x"),u=p.getFloatAttribute(a,"max-x"),c=p.getFloatAttribute(a,"min-y"),h=p.getFloatAttribute(a,"max-y"),f=o/(u-l),m=s/(h-c),g=d.childElements(n),v=g.length,b=0;b<v;b++){for(var y=void 0,A=void 0,T="",C=0;C<e[b].length;C++){var S=0+(e[b][C][0]-l)*f,E=0+(-e[b][C][1]+h)*m;S<0&&(S=0),0+o<S&&(S=0+o),E<0&&(E=0),0+s<E&&(E=0+s),null!=y&&Math.abs(S-y)<Qp.chartTolerance&&Math.abs(E-A)<Qp.chartTolerance||(T+=(S=p.reducePrecision(S))+","+(E=p.reducePrecision(E))+" ",0,y=S,A=E)}g[b].setAttribute("points",T)}},t.redrawChart=function(e){var r=d.findChildOfType(e,"plot");if(null!=r){for(var i=d.findChildOfType(r,"picture"),n=d.childElements(i),a=n.length,o=[],s=0;s<a;s++){var l=n[s].getAttribute("data");o.push(l)}var u=Jp.parseDataAndFindMinMax(o),c=u.datasets,h=u.minx,p=u.maxx,f=u.miny,m=u.maxy;t.recalcChartScaleAndDrawGrid(e,h,p,!1,!0),t.recalcChartScaleAndDrawGrid(e,f,m,!0,!0),t.drawPlotLines(e,c)}},t.prototype.onInspectEvent=function(e){var r=e.currentTarget,i=e.target,n=d.findChildOfType(r,"svg"),a=d.findChildOfType(n,"info"),o=d.findChildOfType(a,"info-back"),s="inherit"==d.findChildOfType(a,"scrollbar").getAttribute("visibility");if(e instanceof MouseEvent){var l=e;switch(e.type){case"mouseover":e.stopPropagation(),this.onInspectMouseOver(r,e);break;case"mouseout":this.onInspectMouseOut(r,l);break;case"mousedown":1==l.which&&(l.stopPropagation(),l.preventDefault(),this.onInspectMouseDown(r,l));break;case"wheel":if(!l.altKey&&!l.ctrlKey&&i==o&&s){var u=e;e.stopPropagation(),e.preventDefault(),t.scrollInfoText(r,u.deltaY<0?36:-36)}}}else if(p.touchEventExists()&&e instanceof TouchEvent){var c=e;if(c.touches.length>1)return;switch(c.type){case"touchstart":c.stopPropagation(),c.preventDefault(),this.onInspectMouseOver(r,c),this.onInspectMouseDown(r,c)}}},t.prototype.onInspectMouseOver=function(t,e){if(!(this.resizing||this.moving||this.scrolling)){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"name-back"),n=d.findChildOfType(r,"controls"),a=d.findChildOfType(n,"resize"),o=d.findChildOfType(r,"chart"),s=null==o?null:d.findChildOfType(o,"plot"),l=null==s?null:d.findChildOfType(s,"picture"),u=e.target;if(u==a)a.setAttribute("fill","IndianRed"),a.style.cursor="nw-resize";else if(u==i)i.setAttribute("fill","rgb(197,163,120)"),i.style.cursor="move";else if(u.parentNode==l){var c=void 0,h=void 0;if(e instanceof MouseEvent){var f=e;c=f.clientX,h=f.clientY}else{var m=e;c=m.touches[0].clientX,h=m.touches[0].clientY}var g=u.getAttribute("name"),v=p.removeTransparency(u.getAttribute("stroke"));this.frameDrawing.client.showTooltip(g,c,h,v,"White")}n.setAttribute("class","shown-with-transition")}},t.prototype.onInspectMouseOut=function(t,e){if(!(this.resizing||this.moving||this.scrolling)){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"name-back"),n=d.findChildOfType(r,"controls"),a=d.findChildOfType(n,"resize"),o=e.target;o==a?a.setAttribute("fill","LightSalmon"):o==i&&i.setAttribute("fill","BurlyWood"),this.frameDrawing.client.hideTooltip(),e instanceof MouseEvent&&!t.contains(e.relatedTarget)&&n.setAttribute("class","hidden-with-transition")}},t.prototype.onInspectMouseDown=function(e,r){var i=this,n=d.findChildOfType(e,"svg"),a=d.findChildOfType(n,"info"),o=d.findChildOfType(n,"name-back"),s=d.findChildOfType(n,"controls"),l=d.findChildOfType(a,"info-back"),u=d.findChildOfType(a,"info-text"),c=d.findChildOfType(a,"scrollbar"),h=d.findChildOfType(s,"resize"),f="inherit"==c.getAttribute("visibility"),m=p.getFloatAttribute(o,"height"),g=o.getBoundingClientRect().height/m;d.bringElementToFront(e);var v=r.target;if(v==h||v==o||v==l&&f){v==h?this.resizing=!0:v==o?this.moving=!0:v==l&&f&&(this.scrolling=!0);var b=void 0,y=void 0;if(r instanceof MouseEvent){var A=r;b=A.pageX,y=A.pageY}else{var T=r;b=T.touches[0].pageX,y=T.touches[0].pageY}new fp(b,y,function(r,n,a){var o=n/g,s=a/g;if(i.resizing){var l=t.resizeInspect(e,o,s);return[l[0]*g,l[1]*g]}return i.moving?(t.moveInspect(e,o,s),[n,a]):i.scrolling?[0,t.scrollInfoText(e,s)*g]:void 0},function(t){i.resizing=!1,i.moving=!1,i.scrolling=!1,i.onInspectMouseOut(e,t)},this.resizing?"nw-resize":this.scrolling?"ns-resize":"move")}else u.contains(v)&&this.editInspect(e)},t.resizeInspect=function(e,r,i){var n=d.findChildOfType(e,"svg-shadow"),a=d.findChildOfType(e,"svg"),o=d.findChildOfType(a,"info"),s=d.findChildOfType(a,"chart"),l=d.findChildOfType(a,"name-back"),u=d.findChildOfType(a,"controls"),c=d.findChildOfType(o,"info-back"),h=d.findChildOfType(o,"scrollbar"),f=d.findChildOfType(u,"resize"),m=null==s?null:d.findChildOfType(s,"chart-back"),g=p.getFloatAttribute(l,"height"),v=p.getFloatAttribute(a,"width"),b=p.getFloatAttribute(a,"height"),y=Math.max(100,v+r),A=Math.max(60,b+i);return p.setMultipleAttributes(n,["width","height"],[y,A]),p.setMultipleAttributes(a,["width","height"],[y,A]),p.setMultipleAttributes(c,["width","height"],[y,A-g]),null!=m&&p.setMultipleAttributes(m,["width","height"],[y,A-g]),l.setAttribute("width",y.toString()),h.setAttribute("x",(y-10).toString()),u.setAttribute("transform","translate("+y+")"),f.setAttribute("transform","translate(0,"+A+")"),t.scrollInfoText(e,0),null!=s&&t.redrawChart(s),t.updateArrow(e),[y-v,A-b]},t.moveInspect=function(e,r,i){var n=d.findChildOfType(e,"svg-shadow"),a=d.findChildOfType(e,"svg"),o=p.getFloatAttribute(a,"x")+r,s=p.getFloatAttribute(a,"y")+i;p.setMultipleAttributes(n,["x","y"],[o,s]),p.setMultipleAttributes(a,["x","y"],[o,s]),t.updateArrow(e)},t.updateArrow=function(t){var e,r,i=d.findChildOfType(t,"arrow"),n=d.findChildOfType(t,"svg"),a=p.getFloatAttribute(n,"x"),o=p.getFloatAttribute(n,"y"),s=p.getFloatAttribute(n,"width"),l=p.getFloatAttribute(n,"height"),u=s/2,c=l/2;a>=0&&o>=0?(e=a+5,r=o+5):a>=0&&o<0&&o+l>=0?(e=a+5,r=(o+c)/c*5):a>=0&&o+l<0?(e=a+5,r=o+l-5):a<0&&a+s>=0&&o+l<0?(e=(a+u)/u*5,r=o+l-5):a+s<0&&o+l<0?(e=a+s-5,r=o+l-5):a+s<0&&o<0&&o+l>=0?(e=a+s-5,r=(o+c)/c*5):a+s<0&&o>=0?(e=a+s-5,r=o+5):a<0&&a+s>=0&&o>=0?(e=(a+u)/u*5,r=o+5):(e=0,r=0);var h=p.radiansToDegrees(Math.atan2(r,e)),f=Math.sqrt(e*e+r*r)/10;i.setAttribute("transform","rotate("+h+") scale("+f+",1)")},t.scrollInfoText=function(t,e){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"info"),n=d.findChildOfType(i,"info-back"),a=d.findChildOfType(i,"info-text"),o=d.findChildOfType(i,"scrollbar"),s=p.getFloatAttribute(n,"height"),l=12*(a.childElementCount+1),u=p.getFloatAttribute(a,"y"),c=u+e;if(c=Math.max(12+s-l,c),(c=Math.min(12,c))!=u){a.setAttribute("y",c.toString());for(var h=d.childElements(a),f=0;f<h.length;f++)h[f].setAttribute("y",(c+12*f).toString())}if(l>s){var m=s-14;o.setAttribute("visibility","inherit"),o.setAttribute("y",(4+m*(12-c)/l).toString()),o.setAttribute("height",(m*s/l+6).toString())}else o.setAttribute("visibility","hidden");return c-u},t.copyInspect=function(t){var e,r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"info"),n=d.findChildOfType(r,"chart"),a=d.findChildOfType(i,"info-text"),o=null==n?null:d.findChildOfType(n,"plot"),s=null==o?null:d.findChildOfType(o,"picture");if(null==n||"hidden-with-transition"==n.getAttribute("class"))e=a.getAttribute("content");else{for(var l=d.childElements(s),u=new Array(l.length),c=new Array(l.length),h=0;h<l.length;h++)u[h]=l[h].getAttribute("name"),c[h]=l[h].getAttribute("data");e=Qp.datasetsWithSharedXToString(u,c)}p.copyToClipboard(e)},t.prototype.closeInspct=function(t){var e=d.findChildOfType(t,"svg"),r=d.findChildOfType(e,"info"),i=d.findChildOfType(e,"chart"),n=d.findChildOfType(e,"controls");r.removeAttribute("class"),null!=i&&i.removeAttribute("class"),n.removeAttribute("class"),t.setAttribute("visibility","hidden"),this.frameDrawing.client.postUserAction(t.id,"close")},t.prototype.editInspect=function(t){var e=this,r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"info"),n=d.findChildOfType(i,"info-back"),a=d.findChildOfType(i,"info-text"),o=a.getAttribute("content"),s=t.getAttribute("editable-as");"number"==s&&(o=p.parseFloatIgnoreCommas(o).toString()),this.frameDrawing.textInputForSVG.display(o,n,a,"left",function(r){"number"==s&&(r=r.replace(/,/g,"")),e.frameDrawing.client.postUserAction(t.id,"setvalue "+r)},16)},t.plotColors=["rgba(106,90,205,0.6)","rgba(178,34,34,0.6)","rgba(25,25,112,0.6)","rgba(0,128,128,0.6)","rgba(85,107,47,0.6)","rgba(70,130,180,0.6)","rgba(65,105,225,0.6)"],t}(),tf=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return d.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return d.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return d.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)mf.filterAndSetAttribute(e,r[n],i[n]);t.updateGISMarkupPosition(e),ef.adjustGISPositionX(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=d.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=p.getFloatAttribute(t,"lon"),n=p.getFloatAttribute(t,"lat"),a=ef.lonLatToXY(r,i,n);p.setMultipleAttributes(t,["cx","cy"],[a[0],a[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var o=t.getAttribute("lonlatpoints"),s=ef.lonLatPointsToXYPoints(r,o);t.setAttribute("points",s)}},t}(),ef=function(){function t(t){this.initialTouchZoomDistance=0,this.currentTouchZoomDistance=0,this.accumulatedZoomWheelDelta=0,this.client=t}return t.prototype.createShapeGISMap=function(){var e=this,r=d.cloneElementWithId("shape-gis-map"),i=d.findChildOfType(r,"background");return new Ep(r,i,function(t,r,i,n){return e.onDrag(t,r,i,n)},function(t,r,i){return e.onWheel(t,r,i)},function(t,r){return e.onTouchZoomStart(t,r)},function(t,r,i,n){return e.onTouchZoom(t,r,i,n)},function(e){return t.eventIgnoreCondition(e)},function(e){return t.wheelIgnoreCondition(e)}),r},t.prototype.updateShapeGISMap=function(e,r,i){for(var n=this,a=d.findChildOfType(e,"background"),o=d.findChildOfType(e,"map"),s=d.findChildOfType(e,"shadow"),l=d.findChildOfType(e,"border"),u=d.findChildOfType(e,"copyright"),c=d.findChildOfType(o,"layers"),h=d.findChildOfType(c,"shapefiles"),f=function(c){switch(r[c]){case"width":case"height":a.setAttribute(r[c],i[c]),o.setAttribute(r[c],i[c]),s.setAttribute(r[c],i[c]),l.setAttribute(r[c],i[c]),"height"==r[c]&&u.setAttribute("y",(parseFloat(i[c])-5).toString());break;case"size-completed":e.getAttribute("zoom")&&m.redrawGISMap(e);break;case"background-color":a.setAttribute("fill",i[c]);break;case"border-color":l.setAttribute("stroke",i[c]);break;case"map-completed":m.redrawGISMap(e);break;case"shapefile":var f=d.createSvgElement("g");f.setAttribute("type","shapefile"),f.setAttribute("name",i[c]),f.setAttribute("pending-commands",""),h.appendChild(f),m.client.networkManager.getResource(i[c],function(t){n.onShapefileLoaded(t,f)});break;case"shapefiles-properties":for(var g=d.childElements(h),v=p.splitSkipEmpty(i[c]," "),b=0;b<g.length;b++)p.setMultipleAttributes(g[b],["visibility","stroke","fill"],v[b].split("|"));break;case"shape-properties":var y=p.splitSkipEmpty(i[c],"|");null!=(f=t.getShapeFileElement(e,y[0])).firstElementChild?t.applyShapeProperties(f,i[c]):f.setAttribute("pending-commands",f.getAttribute("pending-commands")+i[c]+"#");break;case"tile-url-provider-type":e.setAttribute(r[c],i[c]);var A=t.tileProviderCopyright(i[c]);A&&(u.innerHTML=A,u.onclick=function(){return n.client.openURL(t.tileProviderWebsite(i[c]))});break;default:mf.filterAndSetAttribute(e,r[c],i[c])}},m=this,g=0;g<r.length;g++)f(g)},t.prototype.redrawGISMap=function(e){this.redrawGISTiles(e),t.redrawGISShapefiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.prototype.redrawGISTiles=function(e){var r=d.findChildOfType(e,"background"),i=p.getFloatAttribute(r,"width"),n=p.getFloatAttribute(r,"height"),a=t.minGISZoom(i,n),o=d.findChildOfType(e,"map"),s=d.findChildOfType(o,"layers");s.setAttribute("transform","translate(0,0)");var l=p.getIntAttribute(e,"zoom"),u=p.getFloatAttribute(e,"center-lon"),c=p.getFloatAttribute(e,"center-lat");l<a&&(l=a,e.setAttribute("zoom",l.toString()));var h,f=Math.pow(2,l),m=t.latToTileYFloat(c,l),g=n/2/t.tileImageSize;m-g<0?h=g:f<m+g&&(h=f-g),h&&(c=t.tileYToLat(h,l),e.setAttribute("center-lat",c.toString()));var v=d.findChildOfType(s,"tiles");d.removeAllChildren(v),this.updateGISTiles(v,l,c,u,0,0,i,n,f)},t.prototype.updateGISTiles=function(e,r,i,n,a,o,s,l,u){if("false"!=d.findParentOfType(e,"ShapeGISMap").getAttribute("show-tiles")){for(var c=t.lonToTileXInt(n,r),h=t.latToTileYInt(i,r),f=a+s/2-t.lonToXOffsetWithinTile(n,r),m=o+l/2-t.latToYOffsetWithinTile(i,r);f>0;)f-=t.tileImageSize,c--;for(;m>0;)m-=t.tileImageSize,h--;c=p.modulo(c,u),h=p.modulo(h,u);for(var g=[],v=d.childElements(e),b=0;b<v.length;b++)g.push(v[b]);for(var y=c,A=f;A<s;A+=t.tileImageSize){for(var T=h,C=m;C<l;C+=t.tileImageSize){var S=r+"/"+y+"/"+T,E=null;for(b=0;b<g.length;b++)if(g[b].getAttribute("tileid")==S){E=g[b];break}null==E&&(E=this.addGISTile(e,r,y,T)),E.setAttribute("x",(A-a).toString()),E.setAttribute("y",(C-o).toString()),T=p.modulo(T+1,u)}y=p.modulo(y+1,u)}}},t.prototype.addGISTile=function(e,r,i,n){var a=d.findParentOfType(e,"ShapeGISMap"),o=this.tileURL(a,r,i,n),s=d.createSvgElement("image");return s.setAttribute("onerror",'this.setAttributeNS( "http://www.w3.org/1999/xlink", "href", "/assets/svg/images/defaulttile.png" )'),s.setAttribute("width",t.tileImageSize.toString()),s.setAttribute("height",t.tileImageSize.toString()),s.setAttributeNS(d.xlinkns,"href",o),s.setAttribute("tileid",r+"/"+i+"/"+n),e.appendChild(s),s},t.getShapeFileElement=function(t,e){for(var r=d.findChildOfType(t,"map"),i=d.findChildOfType(r,"layers"),n=d.findChildOfType(i,"shapefiles"),a=d.childElements(n),o=0;o<a.length;o++){var s=a[o];if(s.getAttribute("name")==e)return s}return null},t.prototype.onShapefileLoaded=function(e,r){if(!this.client.isStoppedAndShouldIgnoreResponses()&&document.body.contains(r)){r.innerHTML=e.responseText,t.redrawGISShapefile(r),t.adjustX(r,!0);var i=r.getAttribute("pending-commands");if(""!=i){for(var n=0,a=p.splitSkipEmpty(i,"#");n<a.length;n++){var o=a[n];t.applyShapeProperties(r,o)}r.setAttribute("pending-commands","")}}},t.redrawGISShapefiles=function(e){for(var r=d.findChildOfType(e,"map"),i=d.findChildOfType(r,"layers"),n=d.findChildOfType(i,"shapefiles"),a=d.childElements(n),o=0;o<a.length;o++)t.redrawGISShapefile(a[o]),t.adjustX(a[o],!0)},t.redrawGISShapefile=function(e){for(var r=d.findParentOfType(e,"ShapeGISMap"),i=d.childElements(e),n=0;n<i.length;n++){var a=i[n],o=a.getAttribute("lonlatpoints");switch(a.tagName){case"circle":var s=p.splitToFloats(o,","),l=t.lonLatToXY(r,s[0],s[1]);p.setMultipleAttributes(a,["cx","cy"],[l[0],l[1]]);break;case"polyline":case"polygon":var u=t.lonLatPointsToXYPoints(r,o);a.setAttribute("points",u);break;case"path":var c=a.getAttribute("dontdraw"),h=t.lonLatPointsToPathData(r,o,c);a.setAttribute("d",h);break;case"g":t.redrawGISShapefile(a)}}},t.applyShapeProperties=function(t,e){for(var r=p.splitSkipEmpty(e,"|"),i=p.splitToInts(r[1],","),n=d.childElements(t),a=0;a<n.length;a++)i.indexOf(a)>=0&&n[a].setAttribute(r[2],r[3])},t.redrawGISMarkup=function(e){for(var r=d.findChildOfType(e,"map"),i=d.findChildOfType(r,"layers"),n=d.findChildOfType(i,"markup"),a=d.childElements(n),o=0;o<a.length;o++)tf.updateGISMarkupPosition(a[o]);t.adjustX(n,!0)},t.redrawGISAgents=function(e){for(var r=d.findChildOfType(e,"map"),i=d.findChildOfType(r,"layers"),n=d.findChildOfType(i,"agents"),a=d.childElements(n),o=0;o<a.length;o++)t.updateGISAgentScale(a[o]),"hidden"!=a[o].getAttribute("visibility")&&t.updateGISAgentPosition(a[o]);t.adjustX(n,!0)},t.updateGISAgentPosition=function(e){var r=d.findParentOfType(e,"ShapeGISMap"),i=p.getFloatAttribute(e,"lon"),n=p.getFloatAttribute(e,"lat"),a=p.getFloatAttribute(e,"heading"),o=t.lonLatToXY(r,i,n),s="translate("+o[0]+","+o[1]+") rotate("+a+")",l=e.getAttribute("scale");l&&(s+=" scale("+l+")"),e.setAttribute("transform",s)},t.updateGISAgentScale=function(e){var r=d.findParentOfType(e,"ShapeGISMap"),i=p.getIntAttribute(e,"fixed-scale-zoom");if(null!=i){var n=p.getIntAttribute(r,"zoom");if(n<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var a=1;if(p.getIntAttribute(e,"real-scale-zoom")<=n){var o=p.getFloatAttribute(e,"pixels-per-meter"),s=p.getFloatAttribute(e,"lat");a=t.pixelsPerGISMeter(n,s)/o}e.setAttribute("scale",a.toString())}},t.adjustGISPositionX=function(e){t.adjustX(e,!1)},t.adjustX=function(e,r){var i=d.findParentOfType(e,"ShapeGISMap"),n=d.findChildOfType(i,"map"),a=d.findChildOfType(n,"layers"),o=t.svgSize(i),s=p.getIntAttribute(i,"zoom"),l=Math.pow(2,s)*t.tileImageSize,u=p.getFloatAttribute(i,"center-lon"),c=p.parseTransform(a.getAttribute("transform"))[0];if(r)for(var h=d.childElements(e),f=0;f<h.length;f++)t.adjustShapeX(h[f],o[0],u,s,c,l);else t.adjustShapeX(e,o[0],u,s,c,l)},t.adjustShapeX=function(e,r,i,n,a,o){var s=0,l=0,u=0,c=1,h=1;if("hidden"!=e.getAttribute("visibility")){var d;if("circle"==e.tagName)d=p.getFloatAttribute(e,"cx");else if("g"==e.tagName){var f=p.parseTransform(e.getAttribute("transform"));s=f[0],l=f[1],u=f[2],c=f[3],h=f[4],d=s}else{var m=p.getFloatAttribute(e,"minlon"),g=p.getFloatAttribute(e,"maxlon");if(null==m||null==g)return;d=(t.lonToXFast(m,r,i,n)+t.lonToXFast(g,r,i,n))/2}d+=a;var v=Math.abs(d-r/2),b=Math.abs(d+o-r/2),y=Math.abs(d-o-r/2),A=0;b<v?A=o:y<v&&(A=-o);var T=p.constructTransform(s+A,l,u,c,h);null==T?e.removeAttribute("transform"):e.setAttribute("transform",T)}},t.prototype.panGIS=function(e,r,i){var n=d.findChildOfType(e,"map"),a=d.findChildOfType(n,"layers"),o=p.parseTransform(a.getAttribute("transform")),s=o[0]+r,l=o[1]+i,u=p.getIntAttribute(e,"zoom"),c=Math.pow(2,u),h=p.getFloatAttribute(e,"center-lon"),f=p.getFloatAttribute(e,"center-lat"),m=t.latToTileYFloat(f,u),g=t.svgSize(e),v=g[1]/2/t.tileImageSize;m-v-l/t.tileImageSize<0?l=(m-v)*t.tileImageSize:c<m+v-l/t.tileImageSize&&(l=(m+v-c)*t.tileImageSize),s=t.normalizedGISX(s,u),s=Math.round(s),l=Math.round(l),a.setAttribute("transform","translate("+s+","+l+")");var b=d.findChildOfType(a,"tiles");this.updateGISTiles(b,u,f,h,s,l,g[0],g[1],c);for(var y=d.findChildOfType(a,"shapefiles"),A=d.childElements(y),T=0;T<A.length;T++)t.adjustX(A[T],!0);var C=d.findChildOfType(a,"markup");t.adjustX(C,!0);var S=d.findChildOfType(a,"agents");t.adjustX(S,!0)},t.prototype.zoomGIS=function(e,r,i,n){var a,o=p.getIntAttribute(e,"zoom");if((r=Math.round(r))>0)a=Math.min(o+r,19);else{var s=d.findChildOfType(e,"background"),l=p.getFloatAttribute(s,"width"),u=p.getFloatAttribute(s,"height");a=Math.max(o+r,t.minGISZoom(l,u))}this.setGISZoom(e,i,n,a)},t.prototype.setGISZoom=function(e,r,i,n){var a=d.findChildOfType(e,"background"),o=p.getFloatAttribute(a,"width"),s=p.getFloatAttribute(a,"height"),l=d.findChildOfType(e,"map"),u=d.findChildOfType(l,"layers"),c=p.parseTransform(u.getAttribute("transform")),h=t.xyToLonLat(e,r-c[0],i-c[1]),f=t.lonToTileXFloat(h[0],n),m=t.latToTileYFloat(h[1],n),g=Math.pow(2,n);f=p.remainderPositive(f-(r-o/2)/t.tileImageSize,g),m=p.remainderPositive(m-(i-s/2)/t.tileImageSize,g);var v=t.tileXToLon(f,n),b=t.tileYToLat(m,n);p.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[n,v,b]),this.redrawGISMap(e)},t.eventIgnoreCondition=function(t){return"true"!=t.currentTarget.getAttribute("navigation-enabled")||!!(p.touchEventExists()&&t instanceof TouchEvent&&t.touches.length>2)},t.prototype.onDrag=function(e,r,i,n){var a=n,o=t.svgScale(a);this.panGIS(a,r/o[0],i/o[1])},t.wheelIgnoreCondition=function(t){return t.altKey||t.ctrlKey},t.prototype.onWheel=function(e,r,i){var n=this,a=e.currentTarget,o=t.svgScale(a);r/=o[0],i/=o[1],clearTimeout(this.delayedZoomTimeout),this.accumulatedZoomWheelDelta+=e.deltaY<0?1:-1,this.delayedZoomTimeout=setTimeout(function(){n.delayedWheelZoom(a,r,i)},t.zoomDelay)},t.prototype.onTouchZoomStart=function(t,e){this.initialTouchZoomDistance=e,this.currentTouchZoomDistance=e},t.prototype.onTouchZoom=function(e,r,i,n){var a=e.currentTarget,o=t.svgScale(a);r/=o[0],i/=o[1],this.currentTouchZoomDistance*=n;var s=this.currentTouchZoomDistance/this.initialTouchZoomDistance;(s<.8||1.2<s)&&(this.zoomGIS(a,s<1?-1:1,r,i),this.initialTouchZoomDistance=this.currentTouchZoomDistance)},t.prototype.delayedWheelZoom=function(t,e,r){0!=this.accumulatedZoomWheelDelta&&(this.zoomGIS(t,this.accumulatedZoomWheelDelta,e,r),this.accumulatedZoomWheelDelta=0)},t.eventToLonLat=function(e,r){var i=d.findChildOfType(e,"background"),n=p.offsetPage(i),a=t.svgScale(e),o=f.eventPageXY(r),s=(o[0]-n.left)/a[0],l=(o[1]-n.top)/a[1],u=d.findChildOfType(e,"map").firstElementChild,c=p.parseTransform(u.getAttribute("transform"));return t.xyToLonLat(e,s-c[0],l-c[1])},t.xyToLonLat=function(e,r,i){var n=t.svgSize(e),a=p.getIntAttribute(e,"zoom"),o=Math.pow(2,a),s=t.lonToTileXFloat(p.getFloatAttribute(e,"center-lon"),a),l=t.latToTileYFloat(p.getFloatAttribute(e,"center-lat"),a),u=(r-n[0]/2)/t.tileImageSize,c=(i-n[1]/2)/t.tileImageSize,h=p.remainderPositive(s+u,o),d=p.remainderPositive(l+c,o);return[t.tileXToLon(h,a),t.tileYToLat(d,a)]},t.lonLatToXY=function(e,r,i){var n=t.svgSize(e),a=p.getIntAttribute(e,"zoom"),o=t.lonToTileXFloat(p.getFloatAttribute(e,"center-lon"),a),s=t.latToTileYFloat(p.getFloatAttribute(e,"center-lat"),a),l=t.lonToTileXFloat(r,a),u=t.latToTileYFloat(i,a);return[n[0]/2+(l-o)*t.tileImageSize,n[1]/2+(u-s)*t.tileImageSize]},t.lonToXFast=function(e,r,i,n){var a=t.lonToTileXFloat(i,n);return r/2+(t.lonToTileXFloat(e,n)-a)*t.tileImageSize},t.lonLatPointsToXYPoints=function(e,r){for(var i=t.svgSize(e),n=p.getIntAttribute(e,"zoom"),a=t.lonToTileXFloat(p.getFloatAttribute(e,"center-lon"),n),o=t.latToTileYFloat(p.getFloatAttribute(e,"center-lat"),n),s=void 0,l=void 0,u="",c=p.splitSkipEmpty(r," "),h=0;h<c.length;h++){var d=c[h].split(","),f=t.lonToTileXFloat(parseFloat(d[0]),n),m=t.latToTileYFloat(parseFloat(d[1]),n),g=i[0]/2+(f-a)*t.tileImageSize,v=i[1]/2+(m-o)*t.tileImageSize;null!=s&&Math.abs(g-s)<t.gisTolerance&&Math.abs(v-l)<t.gisTolerance||(u+=(g=p.reducePrecision(g))+","+(v=p.reducePrecision(v))+" ",s=g,l=v)}return u},t.lonLatPointsToPathData=function(e,r,i){for(var n=t.svgSize(e),a=p.getIntAttribute(e,"zoom"),o=t.lonToTileXFloat(p.getFloatAttribute(e,"center-lon"),a),s=t.latToTileYFloat(p.getFloatAttribute(e,"center-lat"),a),l=void 0,u=void 0,c="",h=p.splitSkipEmpty(r," "),d=p.splitToInts(i," "),f=0;f<h.length;f++){var m=d.indexOf(f-1)>=0,g=m||d.indexOf(f)>=0,v=h[f].split(","),b=t.lonToTileXFloat(parseFloat(v[0]),a),y=t.latToTileYFloat(parseFloat(v[1]),a),A=n[0]/2+(b-o)*t.tileImageSize,T=n[1]/2+(y-s)*t.tileImageSize;null!=l&&!g&&Math.abs(A-l)<t.gisTolerance&&Math.abs(T-u)<t.gisTolerance||(c+=(""==c||m?"M":"L")+(A=p.reducePrecision(A))+","+(T=p.reducePrecision(T))+" ",l=A,u=T)}return c+="Z"},t.svgSize=function(t){var e=d.findChildOfType(t,"background");return[p.getFloatAttribute(e,"width"),p.getFloatAttribute(e,"height")]},t.svgScale=function(e){var r=d.findChildOfType(e,"background"),i=t.svgSize(e),n=r.getBoundingClientRect();return[n.width/i[0],n.height/i[1]]},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return t<-85.05?Math.pow(2,e):t>85.05?0:(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.prototype.tileURL=function(e,r,i,n){var a=e.getAttribute("tile-url-provider-type");return this.client.runningFromCloud()?t.cloudTileUrl(e,r,i,n,a):t.localTileUrl(e,i,n,r,a)},t.localTileUrl=function(t,e,r,i,n){var a=window.location.origin+"/tiles/"+n+"/"+e+"/"+r+"/"+i;if("CUSTOM"===n){var o=p.splitSkipEmpty(t.getAttribute("custom-tile-url")," ");a+="?url="+encodeURIComponent(o[Math.floor(Math.random()*o.length)])}return a},t.cloudTileUrl=function(e,r,i,n,a){var o;switch(a){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":o=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":o=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":o=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":o=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":o=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":o=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":o=p.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}var s=o[Math.floor(Math.random()*o.length)];return s=(s=(s=s.replace("[zoom]",r.toString())).replace("[x]",i.toString())).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=p.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=p.stringToByteArray(t+"/"+e+"/"+r+".png"),a=0;a<n.length;a++)n[a]^=i[a%n.length];return btoa(p.byteArrayToString(n))},t.tileProviderCopyright=function(t){switch(t){case"ANYLOGIC":case"CLASSIC":case"GERMANSTYLE":case"TRANSPORT":case"CYCLEMAP":case"HUMANITARIAN":return"&copy; OpenStreetMap contributors";case"LANDSTAT":return"&copy; GIS-Lab &amp; authors";default:return}},t.tileProviderWebsite=function(t){switch(t){case"ANYLOGIC":case"CLASSIC":case"GERMANSTYLE":case"TRANSPORT":case"CYCLEMAP":case"HUMANITARIAN":return"https://www.openstreetmap.org/copyright";case"LANDSTAT":return"http://gis-lab.info/";default:return}},t.gisTolerance=2,t.tileImageSize=256,t.zoomDelay=50,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),rf=function(){function t(){}return t.createMarkupPath=function(t,e){var r=d.cloneElementWithId("markup-path"),i=e+"basepath";d.findChildOfType(r,"basepath").firstElementChild.id=i;var n=d.findChildOfType(r,"paths"),a=1;"MarkupPathRoad"!=t&&"MarkupPathConveyor"!=t||(a=2),"MarkupPathRailroad"==t&&(a=4);for(var o=0;o<a;o++){var s=d.createUseElement(i);n.appendChild(s)}var l=d.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","rgba(255,255,255,0.5)"),l.setAttribute("stroke","white")):"MarkupPathRoad"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","white"),l.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(n.firstElementChild.setAttribute("stroke","gray"),d.childElements(n)[1].setAttribute("stroke","black"),d.childElements(n)[2].setAttribute("stroke","white"),n.lastElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),n=d.findChildOfType(t,"basepath").firstElementChild,a=d.findChildOfType(t,"paths"),o=a.firstElementChild,s=a.childElementCount>1?d.childElements(a)[1]:void 0,l=d.findChildOfType(t,"arrows"),u=0;u<e.length;u++)switch(e[u]){case"d":n.setAttribute("d",r[u]);break;case"bidirectional":d.removeAllChildren(l),"false"==r[u]&&p.addPathArrows(n,"arrowhead",1.7,l,50,100);break;case"stroke-width":var c=parseFloat(r[u]);switch(i){case"MarkupPathLine":o.setAttribute("stroke-width",c.toString());break;case"MarkupPathDashline":o.setAttribute("stroke-width",c.toString()),o.setAttribute("stroke-dasharray",4*c+" "+c);break;case"MarkupPathConveyor":o.setAttribute("stroke-width",c.toString()),s.setAttribute("stroke-width",c.toString()),s.setAttribute("stroke-dasharray",c/10+" "+c/2);break;case"MarkupPathRoad":o.setAttribute("stroke-width",c.toString()),s.setAttribute("stroke-width",(c/12).toString()),s.setAttribute("stroke-dasharray",c/2+" "+c/5);break;case"MarkupPathRailroad":var h=c/10+" "+c/2.5;o.setAttribute("stroke-width",c.toString()),o.setAttribute("stroke-dasharray",h),s.setAttribute("stroke-width",(c/2+c/12).toString()),d.childElements(a)[2].setAttribute("stroke-width",(c/2).toString());var f=a.lastElementChild;f.setAttribute("stroke-width",(c/2).toString()),f.setAttribute("stroke-dasharray",h)}break;case"stroke":o.setAttribute("stroke",r[u]),c=parseFloat(o.getAttribute("stroke-width")),l.setAttribute("stroke",c>4?"white":r[u]);break;default:mf.filterAndSetAttribute(t,e[u],r[u])}},t.createMarkupPointNode=function(){return d.cloneElementWithId("markup-point-node")},t.updateMarkupPointNode=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":t.setAttribute("fill",r[a]),t.setAttribute("stroke",r[a]);break;case"draw-circle":i.setAttribute("fill","none"),i.removeAttribute("stroke");break;case"radius":i.setAttribute("r",r[a]);break;case"connector":var o=d.createSvgElement("path");o.setAttribute("d",r[a]),n.appendChild(o);break;case"connectors-transform":n.setAttribute("transform",r[a]);break;default:mf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupAreaNode=function(t){var e,r=d.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=d.createSvgElement("rect");break;case"MarkupPolygonalNode":e=d.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:mf.filterAndSetAttribute(i,e[n],r[n])}},t.createMarkupPalletRack=function(){return d.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"stroke":n.setAttribute(e[a],r[a]);break;case"fill":i.setAttribute(e[a],r[a]);break;case"rack-data":d.removeAllChildren(i),d.removeAllChildren(n);var o=r[a].split(" "),s=parseInt(o[0]),l=parseInt(o[1]),u=parseFloat(o[2]),c=parseFloat(o[3]),h=parseFloat(o[4]),f=void 0,m=void 0,g=void 0;s>1&&(f=parseFloat(o[5]),m=parseFloat(o[6]),g=c+f);var v=d.createSvgElement("rect");if(v.setAttribute("width",u.toString()),v.setAttribute("height",c.toString()),i.appendChild(v),s>1){var b=d.createSvgElement("rect");b.setAttribute("width",u.toString()),b.setAttribute("height",m.toString()),b.setAttribute("transform","translate( 0 "+g+")"),i.appendChild(b)}for(var y=h,A=0;A<l-1;A++){var T=d.createSvgElement("line");p.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,"0",c]),n.appendChild(T),y+=h}if(s>1){var C=g+m;y=h;for(A=0;A<l-1;A++){T=d.createSvgElement("line");p.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,g,C]),n.appendChild(T),y+=h}}break;case"use-color-map":var S=t.firstElementChild;"ShapeCanvas"==S.getAttribute("type")&&t.appendChild(S);break;default:mf.filterAndSetAttribute(t,e[a],r[a])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupConveyorPath","MarkupPositionOnConveyor","MarkupConveyorTransferTable","MarkupConveyorTurntable","MarkupConveyorTurnStation","MarkupConveyorStation","MarkupConveyorCustomStation","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupDensityMap","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),nf=function(){function t(){}return t.createMarkupConveyorPath=function(t){var e=d.cloneElementWithId("markup-conveyor-path"),r=t+"basepath";d.findChildOfType(e,"basepath").firstElementChild.id=r;var i=d.findChildOfType(e,"paths"),n=d.createUseElement(r),a=d.createUseElement(r);return i.appendChild(n),i.appendChild(a),a.setAttribute("stroke","rgba(255,255,255,0.5)"),e},t.updateMarkupConveyorPath=function(t,e,r){for(var i=d.findChildOfType(t,"basepath").firstElementChild,n=d.findChildOfType(t,"paths"),a=n.firstElementChild,o=n.childElementCount>1?d.childElements(n)[1]:void 0,s=d.findChildOfType(t,"arrows"),l=0;l<e.length;l++)switch(e[l]){case"d":i.setAttribute("d",r[l]);break;case"bidirectional":d.removeAllChildren(s),"false"==r[l]&&p.addPathArrows(i,"arrowhead",1.2,s,50,100);break;case"stroke-width":var u=parseFloat(r[l]);n.setAttribute("stroke-width",u.toString());break;case"stroke-dasharray":o.setAttribute("stroke-dasharray",r[l]);break;case"stroke":a.setAttribute("stroke",r[l]),u=parseFloat(n.getAttribute("stroke-width")),s.setAttribute("stroke",u>4?"rgba(255,255,255,0.7)":r[l]);break;case"offset":o.setAttribute("stroke-dashoffset","-"+r[l]);break;default:mf.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupPositionOnConveyor=function(){return d.cloneElementWithId("markup-position-on-conveyor")},t.updateMarkupPositionOnConveyor=function(t,e,r){for(var i=0;i<e.length;i++)mf.filterAndSetAttribute(t,e[i],r[i])},t.createMarkupConveyorNode=function(t){var e=d.cloneElementWithId("markup-conveyor-node");return"MarkupConveyorTransferTable"==t&&d.removeElement(e.lastElementChild),e},t.updateMarkupConveyorNode=function(t,e,r){for(var i=t.getAttribute("type"),n=t.firstElementChild,a=t.lastElementChild,o=0;o<e.length;o++)switch(e[o]){case"area":n.setAttribute("d",r[o]);break;case"radius":a.setAttribute("r",r[o]);break;case"stroke":"MarkupConveyorTurntable"==i&&("none"==r[o]?a.setAttribute("fill","none"):a.removeAttribute("fill"));default:mf.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupConveyorStation=function(){return d.createSvgElement("path")},t.updateMarkupConveyorStation=function(t,e,r){for(var i=0;i<e.length;i++)mf.filterAndSetAttribute(t,e[i],r[i])},t.createMarkupConveyorCustomStation=function(){return d.createSvgElement("polygon")},t.updateMarkupConveyorCustomStation=function(t,e,r){for(var i=0;i<e.length;i++)mf.filterAndSetAttribute(t,e[i],r[i])},t.createMarkupConveyorSplitMerge=function(){var t=d.createSvgElement("path");return t.setAttribute("stroke-width","0.5"),t},t.updateMarkupConveyorSplitMerge=function(t,e,r){for(var i=0;i<e.length;i++)mf.filterAndSetAttribute(t,e[i],r[i])},t.createMarkupTowerCrane=function(){return d.cloneElementWithId("markup-tower-crane")},t.updateMarkupTowerCrane=function(t,e,r){for(var i=d.findChildOfType(t,"crane"),n=d.findChildOfType(i,"tower"),a=d.findChildOfType(i,"jib"),o=d.findChildOfType(i,"caret"),s=0;s<e.length;s++)switch(e[s]){case"jib-length":var l=parseFloat(r[s]),u=Math.max(1,l/40),c=8*u,h=2*u;n.setAttribute("r",h.toString()),p.setMultipleAttributes(a,["stroke-width","x1","x2"],[u,-c,l]),p.setMultipleAttributes(o,["x","y","width","height"],[-u,-u,h,h]);break;case"crane-color":p.setMultipleAttributes(i,["stroke","fill"],[r[s],r[s]]);break;case"jib-angle":var f=parseFloat(r[s]);i.setAttribute("transform","rotate("+p.radiansToDegrees(f)+")");break;case"caret-distance":o.setAttribute("transform","translate("+r[s]+",0)");break;default:mf.filterAndSetAttribute(t,e[s],r[s])}},t.createMarkupLift=function(){return d.cloneElementWithId("markup-lift")},t.updateMarkupLift=function(t,e,r){for(var i=d.findChildOfType(t,"box"),n=d.findChildOfType(t,"door"),a=d.findChildOfType(t,"left"),o=d.findChildOfType(t,"right"),s=d.findChildOfType(t,"left-arrow"),l=d.findChildOfType(t,"right-arrow"),u=0;u<e.length;u++)switch(e[u]){case"width":case"height":i.setAttribute(e[u],r[u]);var c=p.getFloatAttribute(i,"width"),h=p.getFloatAttribute(i,"height");if(null!=c&&null!=h){var f=c/2,m=h/2,g=c/4,v=Math.min(3*g/5,h/4*3/5);p.setMultipleAttributes(i,["x","y"],[-f,-m]),p.setMultipleAttributes(n,["y1","y2"],[-m,m]),v>2.5&&(p.setMultipleAttributes(a,["x1","y1","x2","y2"],[-g,v-m,-g,3*v-m]),p.setMultipleAttributes(o,["x1","y1","x2","y2"],[g,m-3*v,g,m-v])),s.setAttribute("points",-g-v+","+(2*v-m)+" "+-g+","+(v-m)+" "+(-g+v)+","+(2*v-m)),l.setAttribute("points",g-v+","+(m-2*v)+" "+g+","+(m-v)+" "+(g+v)+","+(m-2*v))}break;default:mf.filterAndSetAttribute(t,e[u],r[u])}},t}(),af=function(){function t(){}return t.createMarkupPipe=function(t){var e=d.cloneElementWithId("markup-pipe"),r=t+"basepath";d.findChildOfType(e,"basepath").firstElementChild.id=r;var i=d.findChildOfType(e,"pipe"),n=d.findChildOfType(e,"inner-pipe"),a=d.findChildOfType(e,"bubbles"),o="#"+r;return i.setAttributeNS(d.xlinkns,"href",o),n.setAttributeNS(d.xlinkns,"href",o),a.setAttributeNS(d.xlinkns,"href",o),e},t.updateMarkupPipe=function(t,e,r){for(var i,n=d.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=d.findChildOfType(t,"batches"),s=d.findChildOfType(t,"bubbles"),l=0;l<e.length;l++)switch(e[l]){case"phase":s.setAttribute("stroke-dashoffset",(12-parseFloat(r[l])).toString());break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,f=d.childElements(o)[parseInt(u[0])];f.setAttribute("stroke",u[3]),f.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var m=parseInt(r[l]),g=o.childElementCount,v=m;v<g;v++)d.removeElement(o.lastElementChild);for(v=g;v<m;v++)f=d.createUseElement(a),o.appendChild(f);break;case"d":var b=parseFloat(d.findChildOfType(t,"pipe").getAttribute("stroke-width")),y=p.roundPathCorners(r[l],2*b,!1);n.setAttribute("d",y);break;case"width":var A=parseFloat(r[l]);d.findChildOfType(t,"pipe").setAttribute("stroke-width",A.toString()),d.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*A).toString()),o.setAttribute("stroke-width",(.6*A).toString());var T=Math.min(5,.2*A);s.setAttribute("stroke-width",T.toString()),s.setAttribute("stroke-dasharray",T+","+(12-T));break;case"color":d.findChildOfType(t,"pipe").setAttribute("stroke",r[l]);break;case"inner-color":d.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[l]);break;default:mf.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupStorageTank=function(){return d.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=d.findChildOfType(t,"square"),n=d.findChildOfType(t,"batches"),a=parseFloat(i.getAttribute("width")),o=0;o<e.length;o++)switch(e[o]){case"batch":var s=r[o].split(" "),l=parseFloat(s[1])*a,u=parseFloat(s[2])*a,c=d.childElements(n)[parseInt(s[0])];p.setMultipleAttributes(c,["y","height","fill"],[a/2-l-u,u,s[3]]);break;case"newbatches":for(var h=parseInt(r[o]),f=n.childElementCount,m=h;m<f;m++)d.removeElement(n.lastElementChild);for(m=f;m<h;m++)c=d.createSvgElement("rect"),p.setMultipleAttributes(c,["stroke","width","x"],["none",a,-a/2]),n.appendChild(c);break;case"progress":var g=parseFloat(r[o])*Math.PI*2,v=parseFloat(d.findChildOfType(t,"circle").getAttribute("r"))-2,b=v*Math.sin(g),y=-v*Math.cos(g),A="M 0 "+-v+" ";A+="A "+v+" "+v+" 0 "+(g>Math.PI?"1":"0")+" 1 "+b+" "+y,d.findChildOfType(t,"arc").setAttribute("d",A);break;case"radius":d.findChildOfType(t,"circle").setAttribute("r",r[o]),a=Math.max(10,2*parseFloat(r[o])/Math.sqrt(2)-8),p.setMultipleAttributes(i,["width","height","x","y"],[a,a,-a/2,-a/2]);break;case"color":d.findChildOfType(t,"circle").setAttribute("fill",r[o]);break;case"stroke-color":d.findChildOfType(t,"circle").setAttribute("stroke",r[o]),d.findChildOfType(t,"square").setAttribute("stroke",r[o]);break;default:mf.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupBulkConveyorBelt=function(t){var e=d.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";d.findChildOfType(e,"basepath").firstElementChild.id=r;var i=d.findChildOfType(e,"belt"),n=d.findChildOfType(e,"belt-sections"),a="#"+r;return i.setAttributeNS(d.xlinkns,"href",a),n.setAttributeNS(d.xlinkns,"href",a),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,n=d.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=d.findChildOfType(t,"belt-sections"),s=d.findChildOfType(t,"batches"),l=0;l<e.length;l++)switch(e[l]){case"phase":o.setAttribute("stroke-dashoffset",r[l]);break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,p=d.childElements(s)[parseInt(u[0])];p.setAttribute("stroke",u[3]),p.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var f=parseInt(r[l]),m=s.childElementCount,g=f;g<m;g++)d.removeElement(s.lastElementChild);for(g=m;g<f;g++)p=d.createUseElement(a),s.appendChild(p);break;case"d":n.setAttribute("d",r[l]);break;case"width":var v=r[l];d.findChildOfType(t,"belt").setAttribute("stroke-width",v),o.setAttribute("stroke-width",v),o.setAttribute("stroke-dasharray","2, 10"),s.setAttribute("stroke-width",(.4*parseFloat(v)).toString());break;case"color":d.findChildOfType(t,"belt").setAttribute("stroke",r[l]);break;case"sections-color":o.setAttribute("stroke",r[l]);break;default:mf.filterAndSetAttribute(t,e[l],r[l])}},t}(),of=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=d.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=d.createSvgElement("path");break;case"MarkupCircularWall":r=d.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=d.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:mf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupTargetLine=function(){return d.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var n=d.findChildOfType(e,"polyline"),a=d.findChildOfType(e,"serif-start"),o=d.findChildOfType(e,"serif-end"),s=0;s<r.length;s++)switch(r[s]){case"color":e.setAttribute("stroke",i[s]);break;case"points":n.setAttribute(r[s],i[s]);var l=i[s].split(" "),u=l.length;l[u-1].includes(",")||u--,t.setSerif(l[0],l[1],a),t.setSerif(l[u-1],l[u-2],o);break;default:mf.filterAndSetAttribute(e,r[s],i[s])}},t.createMarkupPathway=function(){return d.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=d.findChildOfType(t,"polygon"),n=d.findChildOfType(t,"polyline"),a=d.findChildOfType(t,"ties"),o=0;o<e.length;o++)switch(e[o]){case"color":a.setAttribute("stroke",r[o]);break;case"points":var s=r[o].split(" "),l="",u="",c="";d.removeAllChildren(a);for(var h=0;h<s.length;h++){var f=p.splitToFloats(s[h],",");if(4==f.length){l+=f[0]+","+f[1]+" ",u=f[2]+","+f[3]+" "+u,c+=(f[0]+f[2])/2+","+(f[1]+f[3])/2+" ";var m=d.createSvgElement("line");p.setMultipleAttributes(m,["x1","y1","x2","y2"],[f[0],f[1],f[2],f[3]]),a.appendChild(m)}}i.setAttribute("points",l+u),n.setAttribute("points",c);break;default:mf.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupPedFlowStatistics=function(){return d.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=d.findChildOfType(t,"line"),n=d.findChildOfType(t,"serif-end"),a=d.findChildOfType(t,"direction"),o=d.findChildOfType(t,"arrow-right"),s=d.findChildOfType(t,"arrow-left"),l=0;l<e.length;l++)switch(e[l]){case"color":t.setAttribute("stroke",r[l]);break;case"length":i.setAttribute("x2",r[l]),n.setAttribute("x1",r[l]),n.setAttribute("x2",r[l]);var u=parseInt(r[l])/2;a.setAttribute("x1",u.toString()),a.setAttribute("x2",u.toString()),o.setAttribute("transform","translate("+u+" 13) rotate(90)"),s.setAttribute("transform","translate("+u+" -13) rotate(-90)");break;case"direction":switch(o.setAttribute("visibility","inherit"),s.setAttribute("visibility","inherit"),r[l]){case"right":s.setAttribute("visibility","hidden");break;case"left":o.setAttribute("visibility","hidden")}break;default:mf.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupServiceWithLines=function(){return d.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var n=d.findChildOfType(e,"queues"),a=d.findChildOfType(e,"services"),o=d.findChildOfType(e,"reverse-queues"),s=d.findChildOfType(e,"area"),l=0;l<r.length;l++)switch(r[l]){case"queue-color":n.setAttribute("stroke",i[l]);break;case"reverse-queue-color":o.setAttribute("stroke",i[l]);break;case"service-color":a.setAttribute("stroke",i[l]);break;case"clear-all-queues":d.removeAllChildren(n),d.removeAllChildren(o);break;case"queue":t.addQueue(n,i[l]);break;case"reverse-queue":t.addQueue(o,i[l]);break;case"clear-services":d.removeAllChildren(a);break;case"service":t.addService(a,i[l]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":s.setAttribute(r[l],i[l]);break;case"pos":case"scale":var u=p.posOrScaleToTransform(s,r[l],i[l]);p.applyTransformAttribute(s,u);break;default:mf.filterAndSetAttribute(e,r[l],i[l])}},t.createMarkupServiceWithArea=function(){return d.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var n=d.findChildOfType(e,"services"),a=0;a<r.length;a++)switch(r[a]){case"service-color":n.setAttribute("stroke",i[a]);break;case"clear-services":d.removeAllChildren(n);break;case"service":t.addService(n,i[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":case"pos":case"scale":break;default:mf.filterAndSetAttribute(e,r[a],i[a])}},t.createMarkupEscalatorGroup=function(){return d.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=d.findChildOfType(t,"background"),n=d.findChildOfType(t,"escalators"),a=0;a<e.length;a++)switch(e[a]){case"balustrade-color":i.setAttribute("fill",r[a]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[a]?"inherit":"hidden");break;case"dimensions-completed":var o=p.getIntAttribute(t,"number-of-escalators"),s=p.getFloatAttribute(t,"width"),l=p.getFloatAttribute(t,"length"),u=p.getFloatAttribute(t,"left-balustrade-width"),c=p.getFloatAttribute(t,"right-balustrade-width"),h=p.getFloatAttribute(t,"internal-balustrade-width"),f=p.getFloatAttribute(t,"lower-landing-length"),m=p.getFloatAttribute(t,"upper-landing-length"),g=p.getFloatAttribute(t,"step-width"),v=u+c+o*s+(o-1)*h,b=f+l+m,y="1 "+Math.max(2,g-1);p.setMultipleAttributes(i,["y","width","height"],[-u,b,v]);for(var A=0;A<o;A++){var T=A*(s+h),C=d.cloneElementWithId("escalator"),S=d.findChildOfType(C,"background");p.setMultipleAttributes(S,["y","width","height"],[T,b,s]);var E=d.findChildOfType(C,"handrail-left"),w=d.findChildOfType(C,"handrail-right");p.setMultipleAttributes(E,["x2","y1","y2"],[b,T,T]),p.setMultipleAttributes(w,["x2","y1","y2"],[b,T+s,T+s]);var k=d.findChildOfType(C,"lower-landing-end"),x=d.findChildOfType(C,"upper-landing-end");p.setMultipleAttributes(k,["x1","x2","y1","y2"],[f,f,T,T+s]),p.setMultipleAttributes(x,["x1","x2","y1","y2"],[f+l,f+l,T,T+s]);var M=d.findChildOfType(C,"stairs");p.setMultipleAttributes(M,["x1","x2","y1","y2","stroke-width","stroke-dasharray"],[f,f+l,T+s/2,T+s/2,s,y]),n.appendChild(C)}break;case"offsets":var O=p.splitToFloats(r[a]," "),I=d.childElements(n);for(A=0;A<I.length;A++)d.findChildOfType(I[A],"stairs").setAttribute("stroke-dashoffset",(-O[A]).toString());break;default:mf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupDensityMap=function(){for(var t=d.cloneElementWithId("markup-density-map"),e=d.findChildOfType(t,"grid");e.childElementCount<7;)e.appendChild(d.cloneElementWithId("grid-item"));return t},t.updateMarkupDensityMap=function(e,r,i){for(var n=d.findChildOfType(e,"colors"),a=d.findChildOfType(e,"frame"),o=0;o<r.length;o++)switch(r[o]){case"width":case"height":a.setAttribute(r[o],i[o]),t.redrawMarkupDensityMap(e);break;case"critical-density":e.setAttribute(r[o],i[o]),t.redrawMarkupDensityMap(e);break;case"colors":var s=p.splitSkipEmpty(i[o]," ");d.removeAllChildren(n);for(var l=0,u=s;l<u.length;l++){var c=u[l],h=d.createSvgElement("rect");h.setAttribute("fill",c),n.appendChild(h)}t.redrawMarkupDensityMap(e);break;default:mf.filterAndSetAttribute(e,r[o],i[o])}},t.redrawMarkupDensityMap=function(t){var e=d.findChildOfType(t,"colors"),r=d.findChildOfType(t,"frame"),i=d.findChildOfType(t,"grid"),n=p.getFloatAttribute(r,"width"),a=p.getFloatAttribute(r,"height"),o=p.getFloatAttribute(t,"critical-density");if(null!=n&&null!=a&&null!=o){for(var s=a,l=0,u=o/6,c=a/6,h=d.childElements(i),f=0;f<7;f++){var m=h[f],g=m.lastElementChild;p.setMultipleAttributes(g,["x1","y1","x2","y2","stroke"],[n+4,s,0,s,"black"]);var v=m.firstElementChild;p.setMultipleAttributes(v,["x","y","text-anchor","fill"],[n+7,s+3,"start","black"]),v.firstChild.textContent=p.formatNumber(l,2),l+=u,s-=c}var b=e.childElementCount;if(b>0){s=a-(c=a/b);var y=d.childElements(e);for(f=0;f<b;f++)p.setMultipleAttributes(y[f],["y","width","height"],[s,n,c]),s-=c}}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),a=parseFloat(i[0]),o=parseFloat(i[1]),s=parseFloat(n[0])-a,l=parseFloat(n[1])-o,u=Math.hypot(s,l),c=3*l/u,h=3*s/u;p.setMultipleAttributes(r,["x1","x2","y1","y2"],[a+c,a-c,o-h,o+h])},t.addService=function(t,e){var r,i=e.split(" "),n=parseFloat(p.getSubAttribute(i,"x")),a=parseFloat(p.getSubAttribute(i,"y")),o=p.radiansToDegrees(parseFloat(p.getSubAttribute(i,"orientation")));if("point"==p.getSubAttribute(i,"type")){(r=d.createUseElement("service-point")).setAttribute("transform","translate("+n+" "+a+")");var s=d.createUseElement("arrowhead-small");s.setAttribute("transform","translate("+(n-11)+" "+a+") rotate("+o+" 11 0)"),t.appendChild(s)}else{(r=d.cloneElementWithId("service-line")).setAttribute("transform","translate("+n+" "+a+") rotate("+o+")");var l=r.firstElementChild.nextElementSibling,u=parseFloat(p.getSubAttribute(i,"length"));if(l.setAttribute("x2",u),"true"==p.getSubAttribute(i,"bidirectional")){var c=r.lastElementChild;c.setAttribute("visibility","inherit"),c.setAttribute("transform","translate("+(u+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=p.splitSkipEmpty(e,"|"),i=p.getSubAttribute(r,"queue-path"),n=d.createSvgElement("path");n.setAttribute("d",i),t.appendChild(n),p.addPathArrows(n,"arrowhead-small",.7,t,50,100);var a=p.getSubAttribute(r,"fence-color");if(a)for(var o=[p.getSubAttribute(r,"fence-path-left"),p.getSubAttribute(r,"fence-path-right")],s=0;s<o.length;s++){var l=d.createSvgElement("path");p.setMultipleAttributes(l,["d","stroke","stroke-width","stroke-dasharray"],[o[s],a,"2","none"]),t.appendChild(l)}},t}(),sf=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return d.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:mf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return d.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)mf.filterAndSetAttribute(t,e[i],r[i])},t}(),lf=function(){function t(){}return t.createMarkupIntersection=function(){return d.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,n=d.findChildOfType(t,"lane-connectors"),a=0;a<e.length;a++)switch(e[a]){case"fill":case"d":i.setAttribute(e[a],r[a]);break;case"lane-connector":var o=d.createSvgElement("g"),s=d.createSvgElement("path");s.setAttribute("d",r[a]),o.appendChild(s),p.addPathArrows(s,"arrowhead-tiny",.5,o,20,40),n.appendChild(o);break;case"lane-connector-colors":for(var l=p.splitSkipEmpty(r[a]," "),u=d.childElements(n),c=0;c<u.length;c++)u[c].setAttribute("stroke",l[c]);break;default:mf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupRoad=function(){return d.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var n=d.findChildOfType(e,"lanes"),a=d.findChildOfType(e,"delimiters"),o=d.findChildOfType(e,"median"),s=0;s<r.length;s++)switch(r[s]){case"lane-width":n.setAttribute("stroke-width",i[s]);break;case"lane-color":n.setAttribute("stroke",i[s]);break;case"forward-lane":case"backward-lane":var l=d.createSvgElement("path");l.setAttribute("d",i[s]),n.appendChild(l);break;case"lane-delimiter-color":a.setAttribute("stroke",i[s]);break;case"lane-delimiter-width":case"lane-delimiter-style":a.setAttribute(r[s],i[s]);break;case"lane-delimiter":var u=p.getFloatAttribute(a,"lane-delimiter-width"),c=a.getAttribute("lane-delimiter-style");t.addDelimiter(a,u,c,i[s],n.getAttribute("stroke"));break;case"median-color":o.setAttribute("stroke",i[s]);break;case"median-width":case"median-style":o.setAttribute(r[s],i[s]);break;case"median":u=p.getFloatAttribute(o,"median-width"),c=o.getAttribute("median-style"),t.addDelimiter(o,u,c,i[s],n.getAttribute("stroke"));break;default:mf.filterAndSetAttribute(e,r[s],i[s])}},t.addDelimiter=function(t,e,r,i,n){var a=r.includes("DASHED"),o=r.includes("DOUBLE"),s=d.createSvgElement("path");if(s.setAttribute("d",i),s.setAttribute("stroke-width",(o?3*e:e).toString()),a&&s.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(s),o){var l=d.createSvgElement("path");p.setMultipleAttributes(l,["d","stroke-width","stroke"],[i,e,n]),t.appendChild(l)}},t.createMarkupStopLine=function(){return d.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:mf.filterAndSetAttribute(t,e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return d.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:mf.filterAndSetAttribute(t,e[a],r[a])}},t}(),uf=function(){function t(t){this.sliderDragging=!1,this.control=t}return t.prototype.createSlider=function(){var t=this,e=d.cloneElementWithId("control-slider"),r=function(e){return t.onEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e},t.updateSlider=function(e,r,i){for(var n=d.findChildOfType(e,"background"),a=d.findChildOfType(e,"line"),o=d.findChildOfType(e,"progress"),s=d.findChildOfType(e,"handle"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-background":"control-background-disabled"),o.setAttribute("class",u?"control-slider-progress":"control-background-selected-disabled"),s.setAttribute("class",u?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":n.setAttribute("fill",i[l]);break;case"width":case"height":n.setAttribute(r[l],i[l]);break;case"vertical":e.setAttribute(r[l],i[l]);var c=p.getFloatAttribute(n,"width"),h=p.getFloatAttribute(n,"height"),f=void 0,m=void 0,g=void 0,v=void 0,b=void 0,y=void 0,A=void 0,T=void 0,C=void 0,S=void 0;"false"==i[l]?(b=f=0,y=m=h/2-2,g=c,A=0,T=v=4,C=0,S=h/2):(b=f=c/2-2,m=0,y=h,A=g=4,v=h,T=0,C=c/2,S=h),p.setMultipleAttributes(a,["x","y","width","height"],[f,m,g,v]),p.setMultipleAttributes(o,["x","y","width","height"],[b,y,A,T]),p.setMultipleAttributes(s,["cx","cy"],[C,S]);break;case"value":var E=t.valueToPos(e,parseFloat(i[l]));t.setHandlePosition(e,E);break;default:mf.filterAndSetAttribute(e,r[l],i[l])}},t.prototype.onEvent=function(e){var r=this,i=e.currentTarget;if("false"!=i.getAttribute("enabled")){var n=d.findChildOfType(i,"progress"),a="true"==i.getAttribute("vertical");if(e instanceof MouseEvent){var o=e;switch(o.type){case"mouseover":this.onOver(i);break;case"mouseout":i.contains(o.relatedTarget)||this.sliderDragging||t.onOut(i);break;case"mousedown":if(1!=o.which)return;o.stopPropagation(),o.preventDefault(),this.sliderDragging=!0,this.onHandleGrabbed(i,o.pageX,o.pageY);break;case"wheel":var s=o;if(!o.altKey&&!o.ctrlKey){e.stopPropagation(),e.preventDefault();var l=void 0,u=p.getFloatAttribute(i,"step");if(u>0){var c=p.getFloatAttribute(i,"current-value");l=t.valueToPos(i,c+(s.deltaY<0?u:-u))}else l=p.getFloatAttribute(n,a?"height":"width"),l+=s.deltaY<0?1:-1;t.setHandlePosition(i,l),clearTimeout(this.wheelConfirmTimeout),this.wheelConfirmTimeout=setTimeout(function(){return r.confirmValue(i)},t.wheelConfirmDelay)}}}else if(p.touchEventExists()&&e instanceof TouchEvent){var h=e;if(h.touches.length>1)return this.onHandleReleased(i),void t.onOut(i);switch(e.type){case"touchstart":h.stopPropagation(),h.preventDefault(),this.sliderDragging=!0,this.onOver(i),this.onHandleGrabbed(i,h.touches[0].pageX,h.touches[0].pageY)}}}},t.prototype.onOver=function(t){var e=d.findChildOfType(t,"line"),r=d.findChildOfType(t,"progress"),i=d.findChildOfType(t,"handle"),n=d.findChildOfType(t,"value");e.setAttribute("class","control-slider-line-hover"),r.setAttribute("class","control-fill-color-transition"),i.setAttribute("class",this.sliderDragging?"control-slider-handle-pressed":"control-slider-handle-hover"),n.setAttribute("class","control-opaque1")},t.onOut=function(t){var e=d.findChildOfType(t,"line"),r=d.findChildOfType(t,"progress"),i=d.findChildOfType(t,"handle"),n=d.findChildOfType(t,"value");e.setAttribute("class","control-background"),r.setAttribute("class","control-slider-progress"),i.setAttribute("r","8"),i.setAttribute("class","control-slider-handle"),n.setAttribute("class","control-opaque0")},t.prototype.onHandleGrabbed=function(e,r,i){var n=this,a=d.findChildOfType(e,"background"),o=d.findChildOfType(e,"progress"),s=d.findChildOfType(e,"handle"),l="true"==e.getAttribute("vertical"),u=p.getFloatAttribute(a,"width"),c=p.getFloatAttribute(a,"height"),h=a.getBoundingClientRect(),f=h.width/u,m=h.height/c,g=p.offsetPage(a),v=(r-g.left)/f,b=(i-g.top)/m,y=l?c-b:v;s.setAttribute("r","7"),s.setAttribute("class","control-slider-handle-pressed"),t.setHandlePosition(e,y),new fp(r,i,function(r,i,n){var a=p.getFloatAttribute(o,l?"height":"width"),s=a+(l?-n/m:i/f),h=l?c:u;return s=Math.min(h,Math.max(s,0)),t.setHandlePosition(e,s),l?[0,(a-s)*m]:[(s-a)*f,0]},function(){n.sliderDragging=!1,n.onHandleReleased(e),t.onOut(e)},l?"ns-resize":"ew-resize")},t.prototype.onHandleReleased=function(t){var e=d.findChildOfType(t,"handle");e.setAttribute("r","8"),e.setAttribute("class","control-slider-handle-hover"),this.confirmValue(t)},t.setHandlePosition=function(e,r){var i=d.findChildOfType(e,"background"),n=d.findChildOfType(e,"progress"),a=d.findChildOfType(e,"handle"),o=d.findChildOfType(e,"value"),s=p.getFloatAttribute(i,"width"),l=p.getFloatAttribute(i,"height"),u="true"==e.getAttribute("vertical"),c=u?l:s;r=Math.min(Math.max(0,r),c),u?(n.setAttribute("y",(c-r).toString()),n.setAttribute("height",r.toString()),a.setAttribute("cy",(c-r).toString())):(n.setAttribute("width",r.toString()),a.setAttribute("cx",r.toString()));var h=t.posToValue(e,r),f=o.firstElementChild,m=o.lastElementChild,g=t.snapValueToStep(e,h);m.firstChild.textContent=p.formatNumber(g,2);var v=m.getComputedTextLength()+10;f.setAttribute("width",v.toString()),f.setAttribute("x",(5-v).toString());var b=u?s/2-9:r-14,y=u?l-r-15-10:l/2-15-4;o.setAttribute("transform","translate("+b+","+y+")"),e.setAttribute("current-value",h.toString())},t.prototype.confirmValue=function(e){var r=p.getFloatAttribute(e,"current-value"),i=t.snapValueToStep(e,r);if(i!=r){var n=t.valueToPos(e,i);t.setHandlePosition(e,n)}i!=p.getFloatAttribute(e,"last-value")&&(this.control.frameDrawing.client.postUserAction(e.id,i.toString()),e.setAttribute("last-value",i.toString()))},t.posToValue=function(t,e){var r=d.findChildOfType(t,"background"),i=p.getFloatAttribute(r,"width"),n=p.getFloatAttribute(r,"height"),a=e/("true"==t.getAttribute("vertical")?n:i),o=p.getFloatAttribute(t,"min"),s=p.getFloatAttribute(t,"max"),l=o+(s-o)*a;return Math.min(Math.max(o,l),s)},t.valueToPos=function(t,e){var r=p.getFloatAttribute(t,"min"),i=(e-r)/(p.getFloatAttribute(t,"max")-r),n=d.findChildOfType(t,"background"),a=p.getFloatAttribute(n,"width"),o=p.getFloatAttribute(n,"height"),s="true"==t.getAttribute("vertical")?o:a,l=s*i;return Math.min(Math.max(0,l),s)},t.snapValueToStep=function(t,e){var r=p.getFloatAttribute(t,"step");if(r<=0)return e;var i=p.getFloatAttribute(t,"min"),n=p.getFloatAttribute(t,"max");return e=i+Math.round((e-i)/r)*r,Math.min(e,n)},t.wheelConfirmDelay=150,t}(),cf=function(){function t(t){this.control=t}return t.createControlList=function(e){var r=d.cloneElementWithId("control-list");r.setAttribute("always-focused",e.toString());var i=function(e){return t.onControlListMouseEvent(e)};return r.addEventListener("mouseover",i),r.addEventListener("mouseout",i),r.addEventListener("mousedown",i),r.addEventListener("wheel",i),r.addEventListener("touchstart",i),r},t.prototype.updateControlList=function(e,r,i){for(var n=d.findChildOfType(e,"svg"),a=d.findChildOfType(e,"border"),o=d.findChildOfType(n,"background"),s=d.findChildOfType(n,"itemgroup"),l=d.findChildOfType(n,"scrollbargroup"),u="true"==e.getAttribute("always-focused"),c=0;c<r.length;c++)switch(r[c]){case"enabled":e.setAttribute(r[c],i[c]);for(var h="true"==i[c],f=d.childElements(s),m=0;m<f.length;m++)t.updateControlListItemLook(f[m],u,!1);l.setAttribute("class",u?"control-opaque1":"control-opaque0");var g=void 0;g=h?u?"control-border-hover":"control-border":"control-border-disabled",a.setAttribute("class",g);break;case"text-array":d.removeAllChildren(s),s.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var v=p.splitSkipEmpty(i[c],"\n"),b=0,y=0;for(m=0;m<v.length;m++){var A=d.cloneElementWithId("list-item");d.findChildOfType(A,"background").setAttribute("fill",o.getAttribute("fill")),(w=d.findChildOfType(A,"text")).firstChild.textContent=v[m],e.hasAttribute("text-color")&&w.setAttribute("fill",e.getAttribute("text-color")),s.appendChild(A);var T=w.getBBox();b<T.width&&(b=T.width),y<T.height&&(y=T.height)}f=d.childElements(s);var C=Math.max(b+4,p.getFloatAttribute(n,"width")),S=Math.max(20,1.35*y);e.setAttribute("item-height",S.toString());for(m=0;m<f.length;m++)this.setupControlListItem(f[m],S*m,C,S,y);t.updateControlListScrollbar(e);break;case"background-color":o.setAttribute("fill",i[c]);break;case"text-color":e.setAttribute(r[c],i[c]);break;case"font-style":e.style.font=i[c];break;case"width":case"height":n.setAttribute(r[c],i[c]),o.setAttribute(r[c],i[c]),a.setAttribute(r[c],i[c]),n.hasAttribute("width")&&n.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[c],i[c]);break;case"value":var E=p.splitSkipEmpty(i[c],"\n");f=d.childElements(s),e.setAttribute("last-clicked","0");for(m=0;m<f.length;m++){A=f[m];var w=d.findChildOfType(A,"text"),k=E.indexOf(w.firstChild.textContent)>=0;A.setAttribute("selected",k),t.updateControlListItemLook(A,u,!1),k&&e.setAttribute("last-clicked",m.toString())}break;default:mf.filterAndSetAttribute(e,r[c],i[c])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var n=i*p.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[n.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=d.findChildOfType(r,"svg"),n=d.findChildOfType(i,"scrollbargroup"),a=d.findChildOfType(n,"handle");if(e instanceof MouseEvent){var o=e;switch(o.type){case"mouseover":t.onGotFocus(r);break;case"mouseout":r.contains(o.relatedTarget)||t.dragging||t.onLostFocus(r);break;case"mousedown":if(1!=o.which||o.target!=a)return;o.stopPropagation(),o.preventDefault(),t.onDragStart(r,o.pageX,o.pageY);break;case"wheel":var s=o;if(!s.altKey&&!s.ctrlKey){e.stopPropagation(),e.preventDefault();var l=p.getFloatAttribute(r,"item-height");t.scrollControlList(r,s.deltaY<0?l:-l)}}}else if(p.touchEventExists()&&e instanceof TouchEvent){var u=e;if(u.touches.length>1)return;switch(u.type){case"touchstart":if(u.target!=a)return;u.stopPropagation(),u.preventDefault(),t.onGotFocus(r),t.onDragStart(r,u.touches[0].pageX,u.touches[0].pageY)}}}},t.onGotFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=d.findChildOfType(e,"border"),i=d.findChildOfType(e,"svg"),n=d.findChildOfType(i,"itemgroup"),a=d.findChildOfType(i,"scrollbargroup"),o=d.childElements(n);if("control-border-hover"!=r.getAttribute("class")){r.setAttribute("class","control-border-hover"),a.setAttribute("class","control-opaque1");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!0,!1)}}},t.onLostFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=d.findChildOfType(e,"border"),i=d.findChildOfType(e,"svg"),n=d.findChildOfType(i,"itemgroup"),a=d.findChildOfType(i,"scrollbargroup"),o=d.childElements(n);r.setAttribute("class","control-border"),a.setAttribute("class","control-opaque0");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!1,!1)}},t.isFocused=function(t){return"control-border-hover"==d.findChildOfType(t,"border").getAttribute("class")},t.onDragStart=function(e,r,i){var n=d.findChildOfType(e,"svg"),a=d.findChildOfType(n,"scrollbargroup"),o=d.findChildOfType(a,"scrollbar"),s=p.getFloatAttribute(o,"height"),l=o.getBoundingClientRect().height/s;t.dragging=!0,new fp(r,i,function(r,i,n){var a=p.getFloatAttribute(e,"scroll-scale"),o=-n/l*a;return[0,-t.scrollControlList(e,o)/a*l]},function(r){t.dragging=!1,r instanceof MouseEvent&&t.onLostFocus(e)},"ns-resize")},t.scrollControlList=function(t,e){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"itemgroup"),n=d.findChildOfType(r,"scrollbargroup"),a=d.findChildOfType(n,"handle"),o=i.childElementCount;if(0!=o){var s=p.getFloatAttribute(r,"height"),l=o*p.getFloatAttribute(t,"item-height"),u=i.getAttribute("transform"),c=p.parseTransform(u)[1],h=c+e;h=Math.max(-l+s,h),h=Math.min(h,0),i.setAttribute("transform","translate(0,"+h+")");var f=2-h/p.getFloatAttribute(t,"scroll-scale");return a.setAttribute("y",f.toString()),h-c}},t.prototype.setupControlListItem=function(e,r,i,n,a){var o=this,s=d.findChildOfType(e,"background"),l=d.findChildOfType(e,"text");e.setAttribute("transform","translate(0,"+r+")"),p.setMultipleAttributes(s,["width","height"],[i,n]),p.setMultipleAttributes(l,["x","y"],[2,n/2+.3*a]),new f(e,function(r){r instanceof MouseEvent&&t.updateControlListItemLook(e,!0,!0)},function(r){r instanceof MouseEvent&&t.updateControlListItemLook(e,!0,!1)},null,function(t){return o.onControlListItemClickTap(e,t)},null)},t.prototype.onControlListItemClickTap=function(e,r){var i=e.parentNode,n=i.parentNode.parentNode;if("false"!=n.getAttribute("enabled"))if(p.touchEventExists()&&r instanceof TouchEvent&&!t.isFocused(n))t.onGotFocus(n);else{var a=r instanceof MouseEvent&&r.ctrlKey||p.touchEventExists()&&r instanceof TouchEvent,o=r instanceof MouseEvent&&r.shiftKey,s="true"==n.getAttribute("multiple"),l=d.childElements(i),u=p.indexInParent(e),c="true"==e.getAttribute("selected");if(s)if(a)e.setAttribute("selected",String(!c)),t.updateControlListItemLook(e,!0,!0);else if(o){var h=p.getIntAttribute(n,"last-clicked");for(f=0;f<l.length;f++)c=h<=u?h<=f&&f<=u:u<=f&&f<=h,l[f].setAttribute("selected",c),t.updateControlListItemLook(l[f],!0,f==u)}else for(f=0;f<l.length;f++)l[f].setAttribute("selected",f==u),t.updateControlListItemLook(l[f],!0,f==u);else{c=!a||!c;for(var f=0;f<l.length;f++)l[f].setAttribute("selected",f==u&&c),t.updateControlListItemLook(l[f],!0,f==u)}n.setAttribute("last-clicked",u.toString());var m="";for(f=0;f<l.length;f++){if("true"==l[f].getAttribute("selected"))m+=d.findChildOfType(l[f],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(n,m),p.touchEventExists()&&r instanceof TouchEvent&&t.onLostFocus(n)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,n=d.findChildOfType(t,"background"),a=d.findChildOfType(t,"text"),o="true"==i.getAttribute("enabled"),s="true"==t.getAttribute("selected");if(!o)return n.setAttribute("class",s?"control-background-selected-disabled":""),void a.setAttribute("class","control-text-disabled");e?(r?n.setAttribute("class",s?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):n.setAttribute("class",s?"control-list-background-selected-hover":""),a.setAttribute("class",s?"control-text-selected-hover":"")):(n.setAttribute("class",s?"control-list-background-selected":""),a.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=d.findChildOfType(e,"svg"),i=d.findChildOfType(r,"scrollbargroup"),n=d.findChildOfType(i,"scrollbar"),a=d.findChildOfType(i,"handle"),o=p.getFloatAttribute(r,"width"),s=p.getFloatAttribute(r,"height"),l=o-p.getFloatAttribute(n,"width");n.setAttribute("x",l.toString()),n.setAttribute("height",s.toString()),a.setAttribute("x",(l+2).toString()),a.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"scrollbargroup"),n=d.findChildOfType(i,"handle"),a=p.getFloatAttribute(r,"height"),o=d.findChildOfType(r,"itemgroup").childElementCount,s=0;if(e=o>0&&a<(s=o*p.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e){n.setAttribute("y","2");var l=Math.max(a*(a/s)-4,7);n.setAttribute("height",l.toString());var u=(s-a)/(a-l-4);t.setAttribute("scroll-scale",u.toString())}},t.dragging=!1,t}(),hf=function(){function t(t){this.frameDrawing=t,this.controlSlider=new uf(this),this.controlList=new cf(this)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.controlSlider.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return this.createFileChooser();case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":uf.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":t.updateFileChooser(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=d.cloneElementWithId("control-button");return new f(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var n=d.findChildOfType(e,"background"),a=d.findChildOfType(e,"text"),o=0;o<r.length;o++)switch(r[o]){case"enabled":e.setAttribute(r[o],i[o]);var s="true"==i[o];n.setAttribute("class",s?"control-background":"control-background-disabled"),a.setAttribute("class",s?"control-button-text":"control-text-disabled");break;case"text":a.firstChild.textContent=i[o];break;case"background-color":break;case"text-color":a.setAttribute("fill",i[o]);break;case"font-style":a.style.font=i[o],t.centerControlText(a,n,!0,!0);break;case"width":case"height":var l=parseFloat(i[o])-2;n.setAttribute(r[o],l.toString()),t.centerControlText(a,n,!0,!0);break;default:mf.filterAndSetAttribute(e,r[o],i[o])}},t.onButtonOver=function(t){var e=d.findChildOfType(t,"background"),r=d.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=d.findChildOfType(t,"background"),r=d.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=d.findChildOfType(t,"background"),r=d.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.client.postUserAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=d.cloneElementWithId("control-checkbox");return new f(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var n=d.findChildOfType(e,"background"),a=d.findChildOfType(e,"box"),o=d.findChildOfType(e,"check"),s=d.findChildOfType(e,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-checkbox-box":"control-checkbox-box-disabled"),o.setAttribute("class",u?"control-checkbox-check":"control-checkbox-check-disabled"),s.setAttribute("class",u?"":"control-text-disabled");break;case"text":s.firstChild.textContent=i[l];break;case"background-color":n.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":s.style.font=i[l],t.centerControlText(s,n,!1,!0);break;case"width":n.setAttribute(r[l],i[l]);break;case"height":n.setAttribute(r[l],i[l]);var c=parseFloat(i[l]);a.setAttribute("y",(c/2-8).toString()),o.setAttribute("transform","translate(0,"+(c/2-8)+")"),t.centerControlText(s,n,!1,!0);break;case"value":o.setAttribute("visibility","true"==i[l]?"inherit":"hidden");break;default:mf.filterAndSetAttribute(e,r[l],i[l])}},t.onCheckboxOver=function(t){var e=d.findChildOfType(t,"box"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=d.findChildOfType(t,"box"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=d.findChildOfType(t,"box"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=d.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.client.postUserAction(t.id,r.toString())},t.createRadioButtonGroup=function(){return d.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"enabled":e.setAttribute(r[a],i[a]);for(var o="true"==i[a],s=d.childElements(e),l=0;l<s.length;l++){var u=s[l],c=d.findChildOfType(u,"circle"),h=d.findChildOfType(u,"check"),m=d.findChildOfType(u,"text");c.setAttribute("class",o?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),h.setAttribute("class",o?"control-radiobutton-check":"control-text-disabled"),m.setAttribute("class",o?"":"control-text-disabled")}break;case"text-array":var g=i[a].split("\n"),v=function(r){var i=d.cloneElementWithId("radio-button"),a=d.findChildOfType(i,"background");e.hasAttribute("background-color")&&a.setAttribute("fill",e.getAttribute("background-color"));var o=d.findChildOfType(i,"text");o.firstChild.textContent=g[r],e.hasAttribute("text-color")&&o.setAttribute("fill",e.getAttribute("text-color")),new f(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return n.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(l=0;l<g.length;l++)v(l);break;case"background-color":case"text-color":e.setAttribute(r[a],i[a]);break;case"font-style":e.style.font=i[a];break;case"width":case"height":e.setAttribute(r[a],i[a]);break;case"vertical":var b=p.getFloatAttribute(e,"width"),y=p.getFloatAttribute(e,"height"),A=0;s=d.childElements(e);for(l=0;l<s.length;l++){u=s[l];var T=d.findChildOfType(u,"background"),C=(m=d.findChildOfType(u,"text")).getBBox();if("true"==i[a]){var S=Math.max(25,1.5*C.height);u.setAttribute("transform","translate(0,"+S*l+")"),p.setMultipleAttributes(T,["width","height"],[b,S])}else{var E=20+C.width+10;u.setAttribute("transform","translate("+A+",0)"),p.setMultipleAttributes(T,["width","height"],[E,y]),A+=E}t.centerRadioButton(u)}break;case"value":var w=parseInt(i[a]);s=d.childElements(e);for(l=0;l<s.length;l++){u=s[l];(h=d.findChildOfType(u,"check")).setAttribute("visibility",w==l?"inherit":"hidden")}break;default:mf.filterAndSetAttribute(e,r[a],i[a])}},t.onRadioButtonOver=function(t){var e=d.findChildOfType(t,"circle"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=d.findChildOfType(t,"circle"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=d.findChildOfType(t,"circle"),r=d.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=d.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=d.childElements(r),n=0;n<i.length;n++){var a=i[n];d.findChildOfType(a,"check").setAttribute("visibility",a==t?"inherit":"hidden"),a==t&&(e=n)}this.frameDrawing.client.postUserAction(r.id,e.toString())}},t.centerRadioButton=function(e){var r=d.findChildOfType(e,"background"),i=d.findChildOfType(e,"circle"),n=d.findChildOfType(e,"check"),a=d.findChildOfType(e,"text"),o=p.getFloatAttribute(r,"height");i.setAttribute("cy",(o/2).toString()),n.setAttribute("cy",(o/2).toString()),t.centerControlText(a,r,!1,!0)},t.createListBox=function(){return cf.createControlList(!1)},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var e=this,r=d.cloneElementWithId("control-combobox");new f(r,function(t){return e.onComboBoxEvent(r,"over",t)},function(t){return e.onComboBoxEvent(r,"out",t)},function(t){return e.onComboBoxEvent(r,"down",t)},function(t){return e.onComboBoxEvent(r,"click",t)},function(e){return t.isDisabled(r)});var i=cf.createControlList(!0);return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),r.appendChild(i),r},t.prototype.updateComboBox=function(e,r,i){for(var n=d.findChildOfType(e,"svg"),a=d.findChildOfType(e,"border"),o=d.findChildOfType(e,"dropdown"),s=d.findChildOfType(n,"background"),l=d.findChildOfType(n,"text"),u=d.findChildOfType(n,"arrowback"),c=d.findChildOfType(n,"arrow"),h=0;h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var f="true"==i[h];l.setAttribute("class",f?"":"control-text-disabled"),a.setAttribute("class",f?"control-border":"control-border-disabled"),f||o.setAttribute("visibility","hidden"),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-array":var m=p.splitSkipEmpty(i[h],"\n"),g=m.length>0?m[0]:"";l.firstChild.textContent=g,this.controlList.updateControlList(o,[r[h]],[i[h]]),this.controlList.adjustControlListHeightToItems(o,5),this.controlList.updateControlList(o,["value"],[g]);break;case"background-color":s.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-color":l.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"font-style":e.style.font=i[h],t.centerControlText(l,s,!1,!0),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"width":case"height":var v=parseFloat(i[h]);if(n.setAttribute(r[h],i[h]),s.setAttribute(r[h],i[h]),a.setAttribute(r[h],i[h]),"width"==r[h])u.setAttribute("x",(v-20).toString()),this.controlList.updateControlList(o,[r[h]],[i[h]]);else{t.centerControlText(l,s,!1,!0),u.setAttribute("height",v.toString()),o.setAttribute("transform","translate(0,"+i[h]+")");var b=5*parseFloat(i[h]);this.controlList.updateControlList(o,["height"],[b.toString()])}if(n.hasAttribute("width")&&n.hasAttribute("height")){var y=p.getFloatAttribute(n,"width")-10,A=p.getFloatAttribute(n,"height")/2;c.setAttribute("transform","translate("+y+","+A+")")}break;case"editable":e.setAttribute(r[h],i[h]);break;case"value":l.firstChild.textContent=i[h],this.controlList.updateControlList(o,[r[h]],[i[h]]);break;default:mf.filterAndSetAttribute(e,r[h],i[h])}},t.prototype.onComboBoxEvent=function(t,e,r){var i=d.findChildOfType(t,"svg"),n=d.findChildOfType(t,"border"),a=d.findChildOfType(t,"dropdown"),o=d.findChildOfType(i,"background"),s=d.findChildOfType(i,"text"),l=d.findChildOfType(i,"arrowback"),u=d.findChildOfType(i,"arrow"),c="true"==t.getAttribute("editable");switch(e){case"over":r instanceof MouseEvent&&(n.setAttribute("class","control-border-hover"),l.setAttribute("class","control-combobox-arrow-background-hover"),u.setAttribute("class","control-fill-color-transition"));break;case"out":r instanceof MouseEvent&&(n.setAttribute("class","control-border"),l.setAttribute("class","control-fill-transparent-transition"),u.setAttribute("class","control-fill-transparent-transition"),a.setAttribute("visibility","hidden"));break;case"down":r.stopPropagation(),!c||r.target!=o&&r.target!=s||this.displayTextInputForComboBox(t);break;case"click":if(c&&r.target!=l&&r.target!=u)this.displayTextInputForComboBox(t);else{r.stopPropagation(),r.preventDefault(),d.bringElementToFront(t);var h="inherit"==a.getAttribute("visibility");a.setAttribute("visibility",h?"hidden":"inherit");var f=d.findChildOfType(a,"border"),m=p.getFloatAttribute(n,"height"),g=p.getFloatAttribute(f,"height"),v=this.frameDrawing.client.svgContainer.getBoundingClientRect(),b=f.getBoundingClientRect();b.bottom>v.bottom?a.setAttribute("transform","translate(0,"+-g+")"):b.top<v.top&&a.setAttribute("transform","translate(0,"+m+")")}}},t.prototype.displayTextInputForComboBox=function(t){var e=this,r=d.findChildOfType(t,"svg"),i=d.findChildOfType(t,"dropdown"),n=d.findChildOfType(t,"border"),a=d.findChildOfType(r,"text");this.frameDrawing.textInputForSVG.display(a.firstChild.textContent,n,t,"left",function(r){a.firstChild.textContent=r,e.frameDrawing.client.postUserAction(t.id,r),e.controlList.updateControlList(i,["value"],[r])})},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=d.findChildOfType(t,"svg"),i=d.findChildOfType(t,"dropdown"),n=d.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var a=e.split("\n")[0];n.firstChild.textContent=a,this.frameDrawing.client.postUserAction(t.id,a)},t.prototype.createTextField=function(){var e=this,r=d.cloneElementWithId("control-textfield");return new f(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r,t)},function(t){return e.onTextFieldDown(r,t)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var n=d.findChildOfType(e,"svg"),a=d.findChildOfType(e,"border"),o=d.findChildOfType(n,"background"),s=d.findChildOfType(n,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];s.setAttribute("class",u?"":"control-text-disabled"),a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":e.style.font=i[l],t.centerControlText(s,o,!1,!0);break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),"width"==r[l]&&s.setAttribute("x",(parseFloat(i[l])-2).toString()),t.centerControlText(s,o,!1,!0);break;case"value":s.firstChild.textContent=i[l];break;default:mf.filterAndSetAttribute(e,r[l],i[l])}},t.onTextFieldOver=function(t){d.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){d.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t,e){var r=this;e.stopPropagation();var i=d.findChildOfType(t,"svg"),n=d.findChildOfType(t,"border"),a=d.findChildOfType(i,"text");this.frameDrawing.textInputForSVG.display(a.firstChild.textContent,n,t,"right",function(e){a.firstChild.textContent=e,r.frameDrawing.client.postUserAction(t.id,e)})},t.prototype.createFileChooser=function(){var e=this,r=d.cloneElementWithId("control-file-chooser");return new f(r,function(e){return t.onFileChooserOver(r)},function(e){return t.onFileChooserOut(r)},null,function(t){return e.onFileChooserPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateFileChooser=function(e,r,i){for(var n=d.findChildOfType(e,"background"),a=d.findChildOfType(e,"progress"),o=d.findChildOfType(e,"svg"),s=d.findChildOfType(o,"text"),l=d.findChildOfType(e,"border"),u=0;u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];n.setAttribute("class",c?"control-background":"control-background-disabled"),s.setAttribute("class",c?"control-button-text":"control-text-disabled"),l.setAttribute("class",c?"control-border":"control-border-disabled"),c?e.setAttribute("style","cursor: pointer"):e.removeAttribute("style");break;case"background-color":n.setAttribute("style","fill: "+i[u]),a.setAttribute("style","fill: "+p.changeBrightness(i[u],.8));break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":s.style.font=i[u],t.centerControlText(s,n,!1,!0);break;case"width":case"height":if(n.setAttribute(r[u],i[u]),o.setAttribute(r[u],i[u]),l.setAttribute(r[u],i[u]),"height"==r[u]){a.setAttribute(r[u],i[u]);var h=parseFloat(i[u]);s.setAttribute("x",(h/4).toString())}break;case"upload":e.setAttribute(r[u],i[u]);break;case"title":e.setAttribute(r[u],i[u]),s.firstChild.textContent=i[u];break;default:mf.filterAndSetAttribute(e,r[u],i[u])}},t.onFileChooserOver=function(t){d.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onFileChooserOut=function(t){d.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onFileChooserPressed=function(t){var e=this;if("true"==t.getAttribute("upload")){var r=document.getElementById("file-input-for-svg");r.setAttribute("control-id",t.id),r.accept=t.getAttribute("accept"),r.onchange=function(){return e.onFileChosen()},r.click()}else{var i=t.getAttribute("value");this.frameDrawing.client.networkManager.downloadFile(i),this.frameDrawing.client.postUserAction(t.id,null)}},t.prototype.onFileChosen=function(){var t=this,e=document.getElementById("file-input-for-svg"),r=e.getAttribute("control-id"),i=e.files;if(i.length>0){var n=i[0],a=document.getElementById(r);this.frameDrawing.client.networkManager.uploadFile(r,n,function(e){return t.onFileUploadProgress(e,a)},function(e){return t.onFileUploaded(a)},function(e){return t.onFileUploadError(a,e)},"file");var o=d.findChildOfType(a,"svg");d.findChildOfType(o,"text").firstChild.textContent=h.msg.UPLOADING()+" "+n.name+" ["+p.formatNumber(n.size,0)+" "+h.msg.BYTES()+"]"}e.value=""},t.prototype.onFileUploadProgress=function(t,e){if(!this.frameDrawing.client.isStoppedAndShouldIgnoreResponses()&&t.lengthComputable){var r=t.loaded/t.total,i=d.findChildOfType(e,"background"),n=d.findChildOfType(e,"progress"),a=p.getFloatAttribute(i,"width");n.setAttribute("width",(a*r).toString())}},t.prototype.onFileUploaded=function(t){if(!this.frameDrawing.client.isStoppedAndShouldIgnoreResponses()){var e=d.findChildOfType(t,"progress"),r=d.findChildOfType(t,"svg"),i=d.findChildOfType(r,"text");e.setAttribute("width","0"),i.firstChild.textContent=i.firstChild.textContent.replace(h.msg.UPLOADING()+" ","")}},t.prototype.onFileUploadError=function(t,e){if(!this.frameDrawing.client.isStoppedAndShouldIgnoreResponses()){var r=d.findChildOfType(t,"progress"),i=d.findChildOfType(t,"svg"),n=d.findChildOfType(i,"text");r.setAttribute("width","0"),n.firstChild.textContent=h.msg.UPLOAD_FAILED()+": "+e}},t.createProgressBar=function(){return d.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var n=e.firstElementChild,a=d.findChildOfType(n,"background"),o=d.findChildOfType(n,"progress"),s=d.findChildOfType(n,"text"),l=d.findChildOfType(n,"border"),u=0;u<r.length;u++)switch(r[u]){case"background-color":e.setAttribute("fill",i[u]);break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":s.style.font=i[u],t.centerControlText(s,a,!1,!0);break;case"width":case"height":e.setAttribute(r[u],i[u]);break;case"vertical":var c="true"==i[u],h=e.getAttribute(c?"height":"width"),f=e.getAttribute(c?"width":"height");a.setAttribute("width",h),a.setAttribute("height",f),o.setAttribute("height",f),t.centerControlText(s,a,!0,!0),l.setAttribute("width",h),l.setAttribute("height",f),c&&n.setAttribute("transform","translate(0,"+h+") rotate(-90)");break;case"text":s.firstChild.textContent="null"==i[u]?"":i[u];break;case"value":var m=p.getFloatAttribute(a,"width"),g=Math.min(parseFloat(i[u]),1);"null"==i[u]?(o.setAttribute("class","control-progressbar-indeterminate"),o.setAttribute("width",m.toString())):(o.setAttribute("class","control-slider-progress"),o.setAttribute("width",(g*m).toString()));break;default:mf.filterAndSetAttribute(e,r[u],i[u])}},t.centerControlText=function(t,e,r,i){var n=p.getFloatAttribute(e,"width"),a=p.getFloatAttribute(e,"height"),o=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&a&&t.setAttribute("y",(1+a/2+.3*o.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.client.postUserAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t}(),df=function(){function t(){var t=this;this.onEventClosure=function(e){return t.onEvent(e)}}return t.prototype.start=function(){this.textdiv=document.getElementById("text-input-for-svg-container"),this.textdiv.onmousedown=this.onEventClosure,this.textdiv.onwheel=this.onEventClosure,this.textdiv.onkeydown=this.onEventClosure,this.textdiv.ontouchstart=this.onEventClosure,window.addEventListener("resize",this.onEventClosure,!1),E.addFullScreenListener(this.onEventClosure)},t.prototype.stop=function(){window.removeEventListener("resize",this.onEventClosure,!1),E.removeFullScreenListener(this.onEventClosure)},t.prototype.display=function(t,e,r,i,n,a){void 0===a&&(a=0),this.textdiv.style.display="block";var o=e.getBoundingClientRect(),s=p.getFloatAttribute(e,"width"),l=p.getFloatAttribute(e,"height"),u=o.width/s,c=this.textdiv.firstElementChild;c.style.left=o.left+"px",c.style.top=o.top+"px",c.style.width=s+"px",c.style.height=l+"px",c.style.paddingBottom=0==a?"0":l-a+"px",c.style.transform="scale("+u+")",c.style.font=window.getComputedStyle(r).font,c.style.textAlign=i,c.value=t,this.text=t,this.onchange=n,window.setTimeout(function(){c.focus(),c.select()},0)},t.prototype.onEvent=function(t){var e=this.textdiv.firstElementChild,r=!1,i=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=e?(r=!0,i=!0):t.stopPropagation();break;case"keydown":var n=t;r="Enter"==n.code||"Escape"==n.code||"Tab"==n.code,i="Enter"==n.code||"Tab"==n.code;break;default:r=!0}r&&this.onchange&&(this.textdiv.style.display="none",i&&e.value!=this.text&&this.onchange(e.value),this.onchange=null,this.text=null)},t}(),pf=function(){function t(){}return t.create=function(t){var e=d.createSvgElement("rect"),r=d.createCanvas(t,"canvas-group-3d");e.setAttribute("stroke","none"),e.setAttribute("fill","gray");var i=Pd.getWorld().createCanvas3D(t,r),n=document.getElementById("canvas-group-3d"),a=document.createElement("div");a.style.display="none",a.className="context-menu-3d",a.tabIndex=0;var o=function(){a.style.display="none",document.removeEventListener("mousedown",s,!0),document.removeEventListener("touchstart",s,!0)},s=function(t){a.contains(t.target)||o.call(null)};a.addEventListener("blur",o),a.addEventListener("keydown",function(t){27==t.keyCode&&o.call(null)});var l=document.createElement("div");a.appendChild(l),l.className="context-menu-3d-item";var u=function(t){t.preventDefault(),o.call(null);var e=i.getCameraData();p.copyToClipboard(e)};l.addEventListener("mousedown",u),l.addEventListener("touchstart",u);var c=document.createElement("img");c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACB0lEQVQ4ja2S3UuacRSAf/+VdOXVNrwf8kJFsGGri4FjXzVaoMy+bLq0tG/ntFgvvPUmm3MULPdhQhB4sTbG6MNhJit11fRVL55dGG1SzV3swAOHwzkPB84R4n9GPB7HbDbT2NiI0WjEZrORSCT4p+FgcIaenp4zzaq6yOjo2N8lic19upVtel+kcYT38C5ncEYyuF7v4YxkGI7ssvBhp0by+dNHliIvq7Xnb76S2Ny/EHUty2hoAyGEeBtdQVVkVEVmKRL+LXi/kb2QiZUDTJ51VEXmmd/PTMCPZ9jFoH0AYXcvcR4m5zvkWAo5ljoVPLb30/2wiwedHdy7c5vOjvtVQaVcqqFr4guOkTBWNYV1Mc1deQ+TZx2T6TqtrSaam5uQJIn2tjaEYyRMWSuwGhoiMNBCuVTgydz2qeRWIEl7MM019xpXLl/CYDCg1+tpaGjAaDQiXB6VinZERTuiXDikXDyuoh3jHlmgaWyHpvEkN9wxhBAiFAohSRI6nQ69Xo/weucoF/KshoZYnrWieG4SGGih9DOH1zvH1UevkPqjxDbSNWeMRqNYLBaEbzJI6ej7ufgmg/W/0D8+hvZj98wGWn4X/9REfcHspAstl6SY/YaWT6LlTsgnmZ1y1RfI04No2U2KB1touW2K+1tVDraQfY76gnl/H/NP+1Cme1F8J/yR15v/BbvaAYzt4uTOAAAAAElFTkSuQmCC",l.appendChild(c);var f=document.createElement("p");f.style.margin="0 5px 0 10px",f.innerText=h.msg.COPY_CAMERA_LOCATION(),l.appendChild(f),n.appendChild(a);var m=!0;return r.addEventListener("touchstart",function(t){t.touches.length>1&&(m=!1)}),r.addEventListener("touchend",function(t){return m=!0}),r.addEventListener("contextmenu",function(t){m&&(t.preventDefault(),document.addEventListener("mousedown",s,!0),document.addEventListener("touchstart",s,!0),a.style.display="",a.style.left=t.clientX+"px",a.style.top=t.clientY+"px",a.focus())}),e},t.update=function(e,r,i){for(var n=e,a=document.getElementById(e.id+"canvas"),o=0;o<r.length;o++)switch(r[o]){case"width":case"height":n.setAttribute(r[o],i[o]),t.syncCanvas3DPosition(a);break;default:mf.filterAndSetAttribute(e,r[o],i[o]),"pos"==r[o]||"scale"==r[o]?t.syncCanvas3DPosition(a):"visibility"==r[o]&&(a.style.visibility=i[o],t.syncCanvas3DPosition(a))}},t.syncCanvas3DPosition=function(t){var e=parseInt(t.id),r=document.getElementById(e.toString());if(null!=r.getAttribute("height")&&null!=r.getAttribute("width")){var i=r.getBoundingClientRect(),n=t.parentNode.getBoundingClientRect(),a=i.left-n.left,o=i.top-n.top;t.style.left=a+"px",t.style.top=o+"px";var s=Math.round(i.width),l=Math.round(i.height);if((s!=t.width||l!=t.height)&&(t.width=s,t.height=l,t.style.width=s+"px",t.style.height=l+"px",!Pd.getWorld().active)){var u=t.getContext("2d");null!=u&&(u.fillStyle="rgba(255,0,0,0.2)",u.fillRect(0,0,t.width,t.height))}var c="inherit"!==t.style.visibility||a>n.width||o>n.height||a+s<0||o+l<0;Pd.getWorld().updateCanvasSize(t,!c)}},t.syncAllCanvas3DPositions=function(){for(var e=document.getElementById("canvas-group-3d").children,r=0,i=[].slice.call(e);r<i.length;r++){var n=i[r];n instanceof HTMLCanvasElement&&t.syncCanvas3DPosition(n)}},t}(),ff=function(){function t(){var t=this;this.active=!1,this.times=new Array(10),this.lastTime=0,this.frameCount=0,this.rafID=0,this.callback=function(){return t.run()}}return t.prototype.run=function(){if(this.active){var t=window.performance.now();this.lastTime>0&&(this.times[this.frameCount%this.times.length]=t-this.lastTime,this.frameCount++),this.lastTime=t,this.rafID=window.requestAnimationFrame(this.callback)}},t.prototype.start=function(){this.active=!0,this.frameCount=0,this.times.fill(0),this.lastTime=0,this.run()},t.prototype.stop=function(){this.active&&(this.active=!1,window.cancelAnimationFrame(this.rafID))},t.prototype.getFramePaintTime=function(){for(var t=this.times,e=0,r=0;r<t.length;r++)e+=t[r];return e/t.length},t.prototype.getFps=function(t){void 0===t&&(t=60);var e=this.getFramePaintTime(),r=0==e?t:Math.round(1e3/e);return Math.min(t,r)},t.prototype.isValid=function(){return this.active&&window.performance.now()-this.lastTime<5e3},t}(),mf=function(){function t(e){this.infoCommandListeners=[],this.client=e,this.actualFIStats=new zp(t.MEASURED_FRAME_STATISTICS_SIZE,1e3/kf.START_FPS),this.browserFPSStats=new zp(t.MEASURED_FRAME_STATISTICS_SIZE,kf.START_FPS),this.suggestedFPSStats=new zp(t.SUGGESTED_FPS_STATISTICS_SIZE,kf.START_FPS),this.shapeComposite=new Wp(e),this.shapeGISMap=new ef(e),this.shapeModelPrimitives=new Yp(this),this.chart=new Qp(e),this.control=new hf(this),this.textInputForSVG=new df,this.shapeInspect=new $p(this),this.world3d=Pd.getWorld(),this.animationFpsCounter=new ff}return t.prototype.start=function(){this.packetBuffer=[],this.resetAdaptiveness(),this.nextFrameDueTime=void 0,this.lastFrameStartTime=void 0,this.textInputForSVG.start(),this.world3d.networkManager=this.client.networkManager,this.animationFpsCounter.start(),this.frameDrawingLoop()},t.prototype.stop=function(){window.cancelAnimationFrame(this.requestAnimationFrameId),this.packetBuffer=[],this.world3d.deactivate(),this.textInputForSVG.stop(),this.animationFpsCounter.stop()},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.frameContainsRemoveSVGImage=function(t){var e=t.commands,r=this.client.presentation.firstElementChild;if(null==r)return!0;for(var i=0;i<e.length;i++){var n=e[i];if("D"==n.cmd&&n.id==r.id)return!0}return!1},t.prototype.getPacketFPS=function(){return this.packetFPS},t.prototype.framesToPlay=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.timeToPlay=function(){for(var t=0,e=0,r=this.packetBuffer;e<r.length;e++){var i=r[e];t+=i.frames.length/i.fps}return t},t.prototype.actualFPS=function(){return 1e3/this.actualFIStats.linearWeightedAverage()},t.prototype.frameDrawingLoop=function(){var t=this;this.requestAnimationFrameId=window.requestAnimationFrame(function(){return t.frameDrawingLoop()});var e=performance.now(),r=1e3/this.desiredFPS;if(this.nextFrameDueTime||(this.nextFrameDueTime=e),e>=this.nextFrameDueTime){for(this.lastFrameStartTime&&this.actualFIStats.add(e-this.lastFrameStartTime),this.lastFrameStartTime=e,this.animationFpsCounter.isValid()&&this.browserFPSStats.add(this.animationFpsCounter.getFps());this.nextFrameDueTime<=e;)this.nextFrameDueTime+=r;var i=this.getNextFrame();i&&(this.drawFrame(i),this.updateDesiredFPS(),this.adjustServerFPS(),this.client.panels.updateMoreDebugInfo(" Br / Ac / Sg / Des: "+p.formatNumber(this.browserFPSStats.linearWeightedAverage(),1,!1)+"/"+p.formatNumber(this.actualFPS(),1,!1)+"/"+p.formatNumber(this.suggestedFPSStats.linearWeightedAverage(),1,!1)+"/"+p.formatNumber(this.desiredFPS,1,!1)))}},t.prototype.getNextFrame=function(){for(;this.packetBuffer&&this.packetBuffer.length>0;){if(this.packetFPS=this.packetBuffer[0].fps,this.packetBuffer[0].frames.length>0)return this.packetBuffer[0].frames.shift();this.packetBuffer.shift()}},t.prototype.findOrRequestFullFrame=function(){for(;this.packetBuffer&&this.packetBuffer.length>0;){for(;this.packetBuffer[0].frames.length>0&&!this.packetBuffer[0].frames[0].fullFrame;)this.packetBuffer[0].frames.shift();if(this.packetBuffer[0].frames.length>0)return;this.packetBuffer.shift()}this.client.packetManager.requestAndWaitFullFrame()},t.prototype.updateDesiredFPS=function(){var t=this.timeToPlay(),e=this.client.packetRequester.getRequestInterval()/1e3,r=1/this.packetFPS,i=Math.max(e,r);if(t>i){var n=t/i;this.desiredFPS=this.packetFPS*n}else this.desiredFPS=this.packetFPS},t.prototype.adjustServerFPS=function(){if(this.animationFpsCounter.isValid()){var e=(this.actualFPS()+this.browserFPSStats.linearWeightedAverage())/2;this.suggestedFPSStats.add(e),e=this.suggestedFPSStats.linearWeightedAverage(),(e=p.snapToArrayValue(t.fpsValues,e,!1))!=this.requestedFPS&&(this.requestedFPS=e,this.client.networkManager.postMaxFPS(this.requestedFPS))}},t.prototype.resetAdaptiveness=function(){this.packetFPS=kf.START_FPS,this.desiredFPS=kf.START_FPS,this.requestedFPS=kf.START_FPS,this.actualFIStats.reset(),this.browserFPSStats.reset(),this.suggestedFPSStats.reset()},t.prototype.drawFrame=function(t){this.client.updateExperimentState(t),this.world3d.applyFrame(t,this.frameContainsRemoveSVGImage(t)),t.fullFrame&&d.removeAllChildren(this.client.presentation),t.fullFrame&&0==t.commands.length?this.emptyErrorFrames||(this.client.showFadingInfoLine(h.msg.ERROR_DRAWING_FRAME(),!1,"white","orangered"),this.emptyErrorFrames=!0):this.emptyErrorFrames&&(this.client.hideFadingInfoLine(),this.emptyErrorFrames=!1);for(var e=0,r=0,i=0,n=0;n<t.commands.length;n++){var a=t.commands[n],o=void 0,s=a.att,l=a.val,u=void 0;switch(a.cmd){case"C":var c=p.getAttributeValue(s,l,"shape-type"),f=p.getAttributeValue(s,l,"owner-id"),m=p.getAttributeValue(s,l,"add-after"),g=null!=p.getAttributeValue(s,l,"has-click-handler");if(p.getAttributeValue(s,l,"draw-mode").includes("2D")||(c="Shape3DOnly"),u=this.createShape(c,a.id),"null"==f)this.client.presentation.appendChild(u);else{if(null==(o=document.getElementById(f)))return console.log("Animation: Can't find container to add a shape to, container id = "+f,a),void this.findOrRequestFullFrame();if("ShapeGISMap"==o.getAttribute("type")){var v=d.findChildOfType(o,"map").firstElementChild;o=c.startsWith("MarkupGIS")?d.findChildOfType(v,"markup"):d.findChildOfType(v,"agents")}if("null"==m){var b=o.firstElementChild;null==b?o.appendChild(u):o.insertBefore(u,b)}else{if(o.lastElementChild.id==m)o.appendChild(u);else{var y=document.getElementById(m);if(null==y)return console.log("Animation: Can't find element to add after, el id = "+m,a),void this.findOrRequestFullFrame();if(!o.contains(y))return console.log("Animation: the element to add after not found in group, el id = "+m,a),void this.findOrRequestFullFrame();var A=y.nextElementSibling;o.insertBefore(u,A)}}}g&&this.assignClickableShapeClickHandler(u,c),this.updateShape(u,s,l),e++;break;case"U":if(null==(u=document.getElementById(a.id)))return console.log("Animation: Can't find shape to be updated, shape id = "+a.id,a),void this.findOrRequestFullFrame();this.updateShape(u,s,l),r++;break;case"D":if(null==(u=document.getElementById(a.id)))return console.log("Animation: Can't find shape to be deleted, shape id = "+a.id,a),void this.findOrRequestFullFrame();d.removeElement(u),i++;break;case"S":this.applySettings(s,l);break;case"N":this.applyNavigation(s,l,t.fullFrame);break;case"M":this.client.showMessageBox(l[0],l[1],l[2]);break;case"W":this.client.openURL(l[0]);break;case"P":this.client.copyToClipboard(l[0]);break;case"I":this.onInfoCommand(s,l);break;default:return console.log("The animation command is not supported: "+a.cmd),this.client.showMessageBox("error",h.msg.BOX_TITLE_UNKNOWN_COMMAND(),h.msg.ANIMATION_COMMAND_NOT_SUPPORTED()+": "+a.cmd+"\n"+h.msg.ENGINE_AND_FRONTEND_DONT_MATCH()),void this.stop()}}d.isDebugMode()&&(this.client.panels.updateCreateUpdateDeleteCount(e,r,i),this.client.panels.updateShapeCount(d.getElementCount()))},t.prototype.createShape=function(t,e){var r;if(d.isPrimitiveSVGElement(t))r=d.createSvgElement(t);else switch(t){case"Shape3DOnly":r=d.cloneElementWithId("3d-only-shape");break;case"ShapeArc":r=Wp.createShapeArc();break;case"ShapeArrowLine":r=Wp.createShapeArrowLine();break;case"ShapeText":r=Wp.createShapeText();break;case"ShapeImage":r=Wp.createShapeImage();break;case"ShapeCanvas":r=Wp.createShapeCanvas(e);break;case"ShapeCAD":r=Wp.createShapeCAD();break;case"ShapeScale":r=Wp.createShapeScale();break;case"ShapeSVG":r=Wp.createShapeSVG();break;case"ShapeModelPrimitives":r=Yp.create();break;case"ShapeInspect":r=this.shapeInspect.create();break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=rf.createMarkupPath(t,e);break;case"MarkupPointNode":r=rf.createMarkupPointNode();break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=rf.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=rf.createMarkupPalletRack();break;case"MarkupConveyorPath":r=nf.createMarkupConveyorPath(e);break;case"MarkupPositionOnConveyor":r=nf.createMarkupPositionOnConveyor();break;case"MarkupConveyorTurnStation":case"MarkupConveyorTurntable":case"MarkupConveyorTransferTable":r=nf.createMarkupConveyorNode(t);break;case"MarkupConveyorStation":r=nf.createMarkupConveyorStation();break;case"MarkupConveyorCustomStation":r=nf.createMarkupConveyorCustomStation();break;case"MarkupConveyorSplitMerge":r=nf.createMarkupConveyorSplitMerge();break;case"MarkupTowerCrane":r=nf.createMarkupTowerCrane();break;case"MarkupLift":r=nf.createMarkupLift();break;case"MarkupRailwaySwitch":r=sf.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=sf.createMarkupPositionOnTrack();break;case"MarkupPipe":r=af.createMarkupPipe(e);break;case"MarkupStorageTank":r=af.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=af.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=of.createMarkupWall(t,e);break;case"MarkupTargetLine":r=of.createMarkupTargetLine();break;case"MarkupPathway":r=of.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=of.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=of.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=of.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=of.createMarkupEscalatorGroup();break;case"MarkupDensityMap":r=of.createMarkupDensityMap();break;case"MarkupIntersection":r=lf.createMarkupIntersection();break;case"MarkupRoad":r=lf.createMarkupRoad();break;case"MarkupStopLine":r=lf.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=lf.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=tf.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=Qp.create();break;case"Window3D":r=pf.create(e);break;default:return console.log("The shape type is not supported: "+t),this.client.showMessageBox("error",h.msg.BOX_TITLE_UNKNOWN_SHAPE_TYPE(),h.msg.SHAPE_TYPE_NOT_SUPPORTED()+": "+t+"\n"+h.msg.ENGINE_AND_FRONTEND_DONT_MATCH()),this.stop(),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(e,r,i){var n=e.getAttribute("type");if("Shape3DOnly"!=n)if(d.isPrimitiveSVGElement(n))for(var a=0;a<r.length;a++)switch(r[a]){case"href":e.setAttributeNS(d.xlinkns,"href",i[a]);break;case"href-path":e.setAttributeNS(d.xlinkns,"href",this.client.networkManager.getInternalResource(i[a]));break;case"geo":var o=i[a].split("|");e.setAttribute("lon",o[0]),e.setAttribute("lat",o[1]),e.setAttribute("heading",o[2]),ef.updateGISAgentPosition(e),ef.adjustGISPositionX(e);break;default:t.filterAndSetAttribute(e,r[a],i[a])}else switch(n){case"ShapeArc":Wp.updateShapeArc(e,r,i);break;case"ShapeArrowLine":Wp.updateShapeArrowLine(e,r,i);break;case"ShapeText":Wp.updateShapeText(e,r,i);break;case"ShapeImage":this.shapeComposite.updateShapeImage(e,r,i);break;case"ShapeCanvas":Wp.updateShapeCanvas(e,r,i);break;case"ShapeCAD":this.shapeComposite.updateShapeCAD(e,r,i);break;case"ShapeScale":Wp.updateShapeScale(e,r,i);break;case"ShapeSVG":Wp.updateShapeSVG(e,r,i);break;case"ShapeModelPrimitives":this.shapeModelPrimitives.update(e,r,i);break;case"ShapeInspect":this.shapeInspect.update(e,r,i);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(e,r,i);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(e,r,i);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":rf.updateMarkupPath(e,r,i);break;case"MarkupPointNode":rf.updateMarkupPointNode(e,r,i);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":rf.updateMarkupAreaNode(e,r,i);break;case"MarkupPalletRack":rf.updateMarkupPalletRack(e,r,i);break;case"MarkupConveyorPath":nf.updateMarkupConveyorPath(e,r,i);break;case"MarkupPositionOnConveyor":nf.updateMarkupPositionOnConveyor(e,r,i);break;case"MarkupConveyorTurnStation":case"MarkupConveyorTurntable":case"MarkupConveyorTransferTable":nf.updateMarkupConveyorNode(e,r,i);break;case"MarkupConveyorStation":nf.updateMarkupConveyorStation(e,r,i);break;case"MarkupConveyorCustomStation":nf.updateMarkupConveyorCustomStation(e,r,i);break;case"MarkupConveyorSplitMerge":nf.updateMarkupConveyorSplitMerge(e,r,i);break;case"MarkupTowerCrane":nf.updateMarkupTowerCrane(e,r,i);break;case"MarkupLift":nf.updateMarkupLift(e,r,i);break;case"MarkupRailwaySwitch":sf.updateMarkupRailwaySwitch(e,r,i);break;case"MarkupPositionOnTrack":sf.updateMarkupPositionOnTrack(e,r,i);break;case"MarkupPipe":af.updateMarkupPipe(e,r,i);break;case"MarkupStorageTank":af.updateMarkupStorageTank(e,r,i);break;case"MarkupBulkConveyorBelt":af.updateMarkupBulkConveyorBelt(e,r,i);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":of.updateMarkupWall(e,r,i);break;case"MarkupTargetLine":of.updateMarkupTargetLine(e,r,i);break;case"MarkupPathway":of.updateMarkupPathway(e,r,i);break;case"MarkupPedFlowStatistics":of.updateMarkupPedFlowStatistics(e,r,i);break;case"MarkupServiceWithLines":of.updateMarkupServiceWithLines(e,r,i);break;case"MarkupServiceWithArea":of.updateMarkupServiceWithArea(e,r,i);break;case"MarkupEscalatorGroup":of.updateMarkupEscalatorGroup(e,r,i);break;case"MarkupDensityMap":of.updateMarkupDensityMap(e,r,i);break;case"MarkupIntersection":lf.updateMarkupIntersection(e,r,i);break;case"MarkupRoad":lf.updateMarkupRoad(e,r,i);break;case"MarkupStopLine":lf.updateMarkupStopLine(e,r,i);break;case"MarkupBusStop":case"MarkupParkingLot":lf.updateMarkupBusStopOrParkingLot(e,r,i);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":tf.updateGISMarkup(e,r,i);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(e,r,i);break;case"Window3D":pf.update(e,r,i)}},t.filterAndSetAttribute=function(e,r,i){if(!(["shape-type","owner-id","add-after","has-click-handler"].indexOf(r)>=0||r.startsWith("3d")&&"3d-rot"!=r))if("pos"==r||"scale"==r){var n=p.posOrScaleToTransform(e,r,i);if(p.applyTransformAttribute(e,n),"scale"==r&&null!=e.getAttribute("scalexy")){var a=p.splitToFloats(e.getAttribute("scalexy"),":");n=p.adjustTransformScale(n,a[0],a[1]),p.applyTransformAttribute(e,n)}}else if("3d-rot"==r){var o=p.splitToFloats(i,":"),s=e.getAttribute("scalexy");if(0==o[0]&&0==o[1]&&null==s)return;var l=Math.cos(o[1]),u=Math.cos(o[0]);if(l=Math.abs(l)<t.SCALE_XY_TOLERANCE?0:l,u=Math.abs(u)<t.SCALE_XY_TOLERANCE?0:u,l=Math.abs(l-1)<t.SCALE_XY_TOLERANCE?1:l,u=Math.abs(u-1)<t.SCALE_XY_TOLERANCE?1:u,1==l&&1==u&&null==s)return;var c=l,h=u;if(null!=s){var d=p.splitToFloats(s,":");c/=d[0],h/=d[1]}n=e.getAttribute("transform");n=p.adjustTransformScale(n,c,h),p.applyTransformAttribute(e,n),1==l&&1==u?e.removeAttribute("scalexy"):e.setAttribute("scalexy",l+":"+u)}else e.setAttribute(r,i)},t.prototype.assignClickableShapeClickHandler=function(e,r){var i=this;"ShapeInspect"!=r&&(new f(e,function(){return t.onClickableShapeOverOut(e,!0)},function(){return t.onClickableShapeOverOut(e,!1)},null,function(t){return i.onClickableShapeClick(e,t)},null,function(t){return i.onClickableShapeClick(e,t,!0)}),"ShapeGISMap"!=r&&(e.style.pointerEvents="visible"))},t.onClickableShapeOverOut=function(t,e){var r=t.getAttribute("type");"ShapeGISMap"!=r&&"ShapeCanvas"!=r&&(e?t.setAttribute("class","clickable-over"):t.removeAttribute("class"))},t.prototype.onClickableShapeClick=function(t,e,r){var i;if(void 0===r&&(r=!1),"ShapeGISMap"==t.getAttribute("type"))i=ef.eventToLonLat(t,e);else{var n=this.client.navigation.eventToXY(e);i=this.client.navigation.XYtoShapeXY(t,n)}var a=r?" dblclick":"";this.client.postUserAction(t.id,i[0]+" "+i[1]+a)},t.prototype.applySettings=function(t,e){for(var r,i,n,a,o,s,l,u,c=!0,h=!0,d=0;d<t.length;d++)switch(t[d]){case"experiment-type":r=e[d];break;case"experiment-name":i=e[d];break;case"max-memory":n=parseFloat(e[d]);break;case"time-unit":a=e[d];break;case"start-time":o=parseFloat(e[d]);break;case"start-date":s=parseInt(e[d]);break;case"stop-time":l=parseFloat(e[d]);break;case"stop-date":u=parseInt(e[d]);break;case"run-control-enabled":c="true"==e[d];break;case"speed-control-enabled":h="true"==e[d]}this.client.setExperimentSettings(r,i,n,a,o,s,l,u,c,h)},t.prototype.applyNavigation=function(t,e,r){for(var i,n,a,o,s,l,u,c,h,d,f=0;f<t.length;f++)switch(t[f]){case"x":i=parseFloat(e[f]);break;case"y":n=parseFloat(e[f]);break;case"width":a=parseFloat(e[f]);break;case"height":o=parseFloat(e[f]);break;case"zoom-and-panning-enabled":s="true"==e[f];break;case"navigation-back-enabled":l="true"==e[f];break;case"view-title":u=e[f];break;case"view-areas":c=p.splitSkipEmpty(e[f],"\n");break;case"presentable":h=p.splitSkipEmpty(e[f],".");break;case"next-level-agents":d=p.splitSkipEmpty(e[f],"|")}var m=this.client.getPresentable();m&&h.toString()==m.toString()||this.resetAdaptiveness(),this.client.setNavigationSettings(i,n,a,o,s,l,u,c,h,d,r)},t.prototype.addInfoCommandListener=function(t){this.infoCommandListeners.push(t)},t.prototype.removeInfoCommandListener=function(t){this.infoCommandListeners.splice(this.infoCommandListeners.indexOf(t),1)},t.prototype.onInfoCommand=function(t,e){for(var r=0,i=this.infoCommandListeners;r<i.length;r++){(0,i[r])(t,e)}},t.MEASURED_FRAME_STATISTICS_SIZE=20,t.SUGGESTED_FPS_STATISTICS_SIZE=100,t.fpsValues=[.2,.35,.5,.75,1,1.5,2,3,4,5,6,7,8,10,12,14,16,18,20,24,28,32,36,40],t.SCALE_XY_TOLERANCE=1e-5,t}(),gf=function(){function t(t){var e=this;this.accumulatedZoomWheelDelta=0,this.navPoint={x:0,y:0,w:100,h:50},this.client=t,this.onWindowResizeEventClosure=function(t){return e.keepAtNavigationPoint()}}return t.prototype.start=function(){var e=this;this.presentationCoords=[0,0],this.zoom=1,window.addEventListener("resize",this.onWindowResizeEventClosure,!1),E.addFullScreenListener(this.onWindowResizeEventClosure);var r=this.client.svgContainer;r.oncontextmenu=function(){return!1},this.dragWheelZoomHandler=new Ep(r,this.client.svg,function(t,r,i,n){return e.onDrag(t,r,i,n)},function(t,r,i){return e.onWheel(t,r,i)},null,function(t,r,i,n){return e.onTouchZoom(t,r,i,n)},function(e){return t.eventIgnoreCondition(e)},function(e){return t.wheelIgnoreCondition(e)})},t.prototype.stop=function(){window.removeEventListener("resize",this.onWindowResizeEventClosure,!1),E.removeFullScreenListener(this.onWindowResizeEventClosure),null!=this.dragWheelZoomHandler&&(this.dragWheelZoomHandler.stop(),this.dragWheelZoomHandler=null),this.delayedZoomTimeout&&(clearTimeout(this.delayedZoomTimeout),this.delayedZoomTimeout=void 0)},t.prototype.getZoom=function(){return this.zoom},t.prototype.zoomInOut=function(e){var r=p.findNearestArrayIndex(t.zooms,this.zoom,e);if(!(r<0||r>=t.zooms.length)){var i=this.client.svgContainer.getBoundingClientRect();this.applyZoom(t.zooms[r],i.width/2,i.height/2)}},t.prototype.applyNavigationSettings=function(){null!=this.client.getWindowX()&&(this.navPoint.x=this.client.getWindowX(),this.navPoint.y=this.client.getWindowY(),this.navPoint.w=this.client.getWindowWidth(),this.navPoint.h=this.client.getWindowHeight(),this.keepAtNavigationPoint())},t.prototype.keepAtNavigationPoint=function(){var t=this.client.isZoomAndPanningEnabled();if(null!=t){var e=this.navPoint.w/this.navPoint.h,r=this.client.svgContainer.getBoundingClientRect(),i=r.width,n=r.height,a=e>i/n?i/this.navPoint.w:n/this.navPoint.h,o=this.navPoint.x+this.navPoint.w/2,s=this.navPoint.y+this.navPoint.h/2,l=i,u=n,c=l/a,h=u/a,d=o-c/2,f=s-h/2;if(!t){var m=Math.max(d,this.client.getWindowX()),g=Math.min(d+c,this.client.getWindowX()+this.client.getWindowWidth());d=o-(c=2*Math.min(o-m,g-o))/2;var v=Math.max(f,this.client.getWindowY()),b=Math.min(f+h,this.client.getWindowY()+this.client.getWindowHeight());f=s-(h=2*Math.min(s-v,b-s))/2,l=c*a,u=h*a}this.client.svgBackLogo&&(this.client.svgBackLogo.remove(),this.client.svgBackLogo=void 0),p.setMultipleAttributes(this.client.svg,["width","height"],[l,u]);var y=document.getElementById("canvas-group-3d");y.style.width=l+"px",y.style.height=u+"px",this.zoom=a,this.presentationCoords=[-d*a,-f*a],this.applyPresentationTransform(!1)}},t.eventIgnoreCondition=function(t){if(t.target instanceof HTMLCanvasElement&&"canvas-group-3d"==t.target.parentElement.id){if(t instanceof WheelEvent)if(t.ctrlKey)return!1;return!0}return!1},t.prototype.onDrag=function(t,e,r,i){this.applyPanning(e,r)},t.wheelIgnoreCondition=function(t){return t.altKey},t.prototype.onWheel=function(e,r,i){var n=this;e.ctrlKey?(clearTimeout(this.delayedZoomTimeout),this.accumulatedZoomWheelDelta+=e.deltaY<0?1:-1,this.delayedZoomTimeout=setTimeout(function(){n.delayedWheelZoom(r,i)},t.zoomDelay)):0<e.deltaY?this.applyPanning(0,-50):this.applyPanning(0,50)},t.prototype.onTouchZoom=function(e,r,i,n){var a=n*this.zoom;a=Math.max(a,t.zooms[0]),a=Math.min(a,t.zooms[t.zooms.length-1]),this.applyZoom(a,r,i)},t.prototype.delayedWheelZoom=function(e,r){if(0!=this.accumulatedZoomWheelDelta){var i,n=t.zooms.length,a=!1;if(this.accumulatedZoomWheelDelta<0){for(var o=n-1;o>=0;o--)if(t.zooms[o]<this.zoom){a=!0,i=o+this.accumulatedZoomWheelDelta+1;break}}else for(o=0;o<n;o++)if(this.zoom<t.zooms[o]){a=!0,i=o+this.accumulatedZoomWheelDelta-1;break}if(a){i=Math.min(i,n-1),i=Math.max(0,i);var s=t.zooms[i];this.applyZoom(s,e,r),this.client.showFadingInfoLine(Math.round(100*s)+"%")}this.accumulatedZoomWheelDelta=0}},t.prototype.applyPresentationTransform=function(t){var e=this.client.svg.getBoundingClientRect(),r=e.width,i=e.height;if(!this.client.isZoomAndPanningEnabled()){var n=this.zoom,a=this.presentationCoords[0],o=this.presentationCoords[1],s=this.client.getWindowX(),l=this.client.getWindowY(),u=this.client.getWindowWidth(),c=this.client.getWindowHeight();n=Math.max(n,r/u),n=Math.max(n,i/c),a=Math.min(a,-s*n),a=Math.max(a,r-(s+u)*n),o=Math.min(o,-l*n),o=Math.max(o,i-(l+c)*n),this.presentationCoords=[a,o],this.zoom=n}var h=p.fixedPrecision(this.presentationCoords[0],1),d=p.fixedPrecision(this.presentationCoords[1],1),f=p.reducePrecision(this.zoom),m="translate("+h+","+d+") scale("+f+")",g=this.client.presentation.getAttribute("transform");if(m!=g){this.client.presentation.setAttribute("transform",m),t&&(this.navPoint.x=-h/f,this.navPoint.y=-d/f,this.navPoint.w=r/f,this.navPoint.h=i/f),pf.syncAllCanvas3DPositions();var v=p.parseTransform(g);f!=v[3]&&this.invokeZoomLsteners(v[3],f)}},t.prototype.applyZoom=function(t,e,r){if(t!=this.zoom){if(!this.client.isZoomAndPanningEnabled()){var i=this.client.svg,n=i.getBoundingClientRect(),a=n.width,o=n.height,s=this.client.getWindowWidth(),l=this.client.getWindowHeight(),u=this.client.svgContainer.getBoundingClientRect(),c=u.width,h=u.height;if((t=s/l>c/h?Math.max(t,c/s):Math.max(t,h/l))==this.zoom)return;var d=Math.min(s*t,c),p=Math.min(l*t,h),f=!1;if(d!=a&&(i.setAttribute("width",d.toString()),f=!0),p!=o&&(i.setAttribute("height",p.toString()),f=!0),f){var m=document.getElementById("canvas-group-3d");m.style.width=d+"px",m.style.height=p+"px"}}var g=t/this.zoom,v=e-(e-this.presentationCoords[0])*g,b=r-(r-this.presentationCoords[1])*g;this.presentationCoords=[v,b],this.zoom=t,this.applyPresentationTransform(!0)}},t.prototype.applyPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform(!0)},t.prototype.invokeZoomLsteners=function(t,e){for(var r=this.client.presentation.getElementsByClassName("svg-zoom-listener"),i=0;i<r.length;i++){var n=r.item(i);switch(n.getAttribute("type")){case"ShapeCAD":Wp.onCADZoomChange(n,t,e);break;case"ShapeScale":Wp.onScaleZoomChange(n,t,e)}}this.client.panels.modelNavigation.updateZoom()},t.prototype.eventToXY=function(t){var e=p.offsetPage(this.client.svg),r=f.eventPageXY(t),i=r[0]-e.left,n=r[1]-e.top,a=i-this.presentationCoords[0],o=n-this.presentationCoords[1];return[a/=this.zoom,o/=this.zoom]},t.prototype.XYtoShapeXY=function(t,e){if(t==this.client.presentation)return e;var r=this.XYtoShapeXY(t.parentNode,e),i=p.parseTransform(t.getAttribute("transform")),n=r[0]-i[0],a=r[1]-i[1];if(0!=i[2]){var o=Math.sqrt(n*n+a*a),s=Math.atan2(a,n)-i[2];n=o*Math.cos(s),a=o*Math.sin(s)}return[n/i[3],a/i[4]]},t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t.zoomDelay=50,t}(),vf=function(){function t(t){var e=this;this.lastRealSpeed=1,this.panels=t,this.client=t.client,this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonStop=document.getElementById("control-panel-button-stop"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpInfoMultiRun=document.getElementById("control-panel-multi-run-progress"),this.dpInfoPauseAt=document.getElementById("dev-panel-info-pause-at"),this.dpButtonRun=document.getElementById("dev-panel-button-run"),this.dpButtonStep=document.getElementById("dev-panel-button-step"),this.dpButtonStop=document.getElementById("dev-panel-button-stop"),this.dpButtonRunOpt=document.getElementById("dev-panel-button-run-options"),this.dpSectionRunUntil=document.getElementById("dev-panel-section-run-until"),this.dpButtonRunUntil=document.getElementById("dev-panel-button-run-until"),this.dpFieldRunUntil=document.getElementById("dev-panel-field-run-until"),this.dpButtonRunUntilDate=document.getElementById("dev-panel-button-run-until-date"),this.dpSectionRunFor=document.getElementById("dev-panel-section-run-for"),this.dpButtonRunFor=document.getElementById("dev-panel-button-run-for"),this.dpFieldRunFor=document.getElementById("dev-panel-field-run-for"),this.dpButtonPause=document.getElementById("dev-panel-button-pause"),this.dpSectionPauseAt=document.getElementById("dev-panel-section-pause-at"),this.dpButtonPauseAt=document.getElementById("dev-panel-button-pause-at"),this.dpFieldPauseAt=document.getElementById("dev-panel-field-pause-at"),this.dpFieldPauseAtDate=document.getElementById("dev-panel-field-pause-at-date"),this.dpButtonPauseAtDate=document.getElementById("dev-panel-button-pause-at-date"),this.panels.setupActionAndTooltip(this.cpButtonRun,function(){return e.client.postUserCommand("run","")}),this.panels.setupActionAndTooltip(this.cpButtonPause,function(){return e.client.postUserCommand("pause","")}),this.panels.setupActionAndTooltip(this.cpButtonStop,function(){return e.stopExperiment()}),this.panels.setupActionAndTooltip(this.cpButtonX1,function(){return e.setSpeed(1,!0)}),this.panels.setupActionAndTooltip(this.cpButtonSlower,function(){return e.speedUpOrDown(!1)}),this.panels.setupTooltip(this.cpInfoScale),this.panels.setupActionAndTooltip(this.cpButtonFaster,function(){return e.speedUpOrDown(!0)}),this.panels.setupActionAndTooltip(this.cpButtonVirtual,function(){return e.toggleVirtualTime()}),this.panels.setupTooltip(this.cpInfoMultiRun),this.panels.setupActionAndTooltip(this.dpButtonRunOpt,function(){Cf.toggleExpanded(e.dpButtonRunOpt),e.updateRunGroup()}),this.panels.setupTooltip(this.dpInfoPauseAt),this.panels.setupActionAndTooltip(this.dpButtonRun,function(){return e.client.postUserCommand("run","")}),this.panels.setupActionAndTooltip(this.dpButtonRunUntil,function(){return e.runUntilOrPauseAt(e.dpSectionRunUntil)}),this.panels.setupActionAndTooltip(this.dpButtonRunFor,function(){return e.runFor()}),this.panels.setupActionAndTooltip(this.dpButtonStep,function(){return e.client.postUserCommand("step","")}),this.panels.setupActionAndTooltip(this.dpButtonStop,function(){return e.stopExperiment()}),this.panels.setupActionAndTooltip(this.dpButtonPause,function(){return e.client.postUserCommand("pause","")}),this.panels.setupActionAndTooltip(this.dpButtonPauseAt,function(){return e.runUntilOrPauseAt(e.dpSectionPauseAt)}),Cf.assignActionOnEnterPressed(this.dpFieldRunUntil,function(){return e.runUntilOrPauseAt(e.dpSectionRunUntil)}),Cf.assignActionOnEnterPressed(this.dpFieldRunFor,function(){return e.runFor()}),Cf.assignActionOnEnterPressed(this.dpFieldPauseAt,function(){return e.runUntilOrPauseAt(e.dpSectionPauseAt)}),this.panels.setupActionAndTooltip(this.dpButtonRunUntilDate,function(){return e.toggleTimeDateInputs(e.dpButtonRunUntilDate)}),this.panels.setupActionAndTooltip(this.dpButtonPauseAtDate,function(){return e.toggleTimeDateInputs(e.dpButtonPauseAtDate)})}return t.prototype.start=function(){this.dpButtonRunUntil.lastElementChild.innerHTML=h.msg.RUN_UNTIL()+":",this.dpButtonRunFor.lastElementChild.innerHTML=h.msg.RUN_FOR()+":",this.dpButtonPauseAt.lastElementChild.innerHTML=h.msg.PAUSE_AT()+":";for(var t=this.dpSectionRunFor.getElementsByTagName("select").item(0).getElementsByTagName("option"),e=0;e<t.length;e++){var r=t.item(e);r.innerHTML=h.msg[r.value]()}},t.prototype.updateExperimentSettings=function(){if(this.client.isSimulationExperiment()){Cf.setVisible(this.cpButtonX1,!0,"logic"),Cf.setVisible(this.cpButtonSlower,!0,"logic"),Cf.setVisible(this.cpInfoScale,!0,"logic"),Cf.setVisible(this.cpButtonFaster,!0,"logic"),Cf.setVisible(this.cpButtonVirtual,!0,"logic"),Cf.setVisible(this.cpInfoMultiRun,!1,"logic"),Cf.setVisible(this.dpButtonRunOpt,!0);for(var t=this.client.getTimeUnit(),e=this.dpSectionRunFor.getElementsByTagName("select").item(0),r=0;r<e.options.length;r++)if(e.options[r].value==t){e.selectedIndex=r;break}}else Cf.setVisible(this.cpButtonX1,!1,"logic"),Cf.setVisible(this.cpButtonSlower,!1,"logic"),Cf.setVisible(this.cpInfoScale,!1,"logic"),Cf.setVisible(this.cpButtonFaster,!1,"logic"),Cf.setVisible(this.cpButtonVirtual,!1,"logic"),Cf.setVisible(this.cpInfoMultiRun,!0,"logic"),Cf.setVisible(this.dpButtonRunOpt,!1),Cf.setVisible(this.dpSectionRunUntil,!1),Cf.setVisible(this.dpSectionRunFor,!1),Cf.setVisible(this.dpSectionPauseAt,!1)},t.prototype.updateRunGroup=function(){var e=this.client.getExperimentState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e,n=r||"PAUSED"==e||"FINISHED"==e||"ERROR"==e,a=this.client.isRunControlEnabled();if(Cf.setVisible(this.cpButtonRun,!r,"logic"),Cf.setVisible(this.cpButtonPause,r,"logic"),this.panels.setEnabled(this.cpButtonRun,a&&i),this.panels.setEnabled(this.cpButtonPause,a&&r),this.panels.setEnabled(this.cpButtonStop,a&&n),Cf.setTooltip(this.cpButtonRun,a?"TOOLTIP_RUN":t.tooltipdisabledbydesigner),Cf.setTooltip(this.cpButtonPause,a?"TOOLTIP_PAUSE":t.tooltipdisabledbydesigner),Cf.setTooltip(this.cpButtonStop,a?"TOOLTIP_STOP":t.tooltipdisabledbydesigner),Cf.setVisible(this.dpButtonRun,!r),this.panels.setEnabled(this.dpButtonRun,i),Cf.setVisible(this.dpButtonStep,!r),this.panels.setEnabled(this.dpButtonStep,i),Cf.setVisible(this.dpButtonPause,r),this.panels.setEnabled(this.dpButtonPause,r),this.panels.setEnabled(this.dpButtonStop,n),this.client.isSimulationExperiment()){var o="true"==this.dpButtonRunOpt.getAttribute("expanded");r||Cf.setVisible(this.dpInfoPauseAt,!1),Cf.setVisible(this.dpSectionRunFor,o&&!r),this.panels.setEnabled(this.dpSectionRunFor,i),Cf.setVisible(this.dpSectionRunUntil,o&&!r),this.panels.setEnabled(this.dpSectionRunUntil,i),Cf.setVisible(this.dpSectionPauseAt,o&&r),this.panels.setEnabled(this.dpSectionPauseAt,r)}},t.prototype.canRun=function(){var t=this.client.getExperimentState();return"IDLE"==t||"PAUSED"==t},t.prototype.canPause=function(){return"RUNNING"==this.client.getExperimentState()},t.prototype.updateSpeedGroup=function(){var e=this.client.getExperimentState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e||"FINISHED"==e,i=this.client.isSpeedControlEnabled(),n=t.stringToTimeScale(this.cpInfoScale.innerText);this.panels.setEnabled(this.cpButtonX1,i&&r&&1!=n),this.panels.setEnabled(this.cpButtonSlower,i&&r&&n>t.speeds[0]),this.panels.setEnabled(this.cpButtonFaster,i&&r&&n!=1/0),this.panels.setEnabled(this.cpButtonVirtual,i&&r),Cf.setTooltip(this.cpButtonX1,i?"TOOLTIP_SET_REAL_TIME_SCALE_X1":t.tooltipdisabledbydesigner),Cf.setTooltip(this.cpButtonSlower,i?"TOOLTIP_SLOW_DOWN":t.tooltipdisabledbydesigner),Cf.setTooltip(this.cpButtonFaster,i?"TOOLTIP_SPEED_UP":t.tooltipdisabledbydesigner),Cf.setTooltip(this.cpButtonVirtual,i?"TOOLTIP_RUN_AS_FAST_AS_POSSIBLE_VIRTUAL_TIME_MODE":t.tooltipdisabledbydesigner);var a="control-panel-control-pressed";n==1/0?this.cpButtonVirtual.classList.contains(a)||this.cpButtonVirtual.classList.add(a):this.cpButtonVirtual.classList.remove(a)},t.prototype.setSpeed=function(e,r){if(e!=1/0)this.lastRealSpeed=e;else{var i=t.stringToTimeScale(this.cpInfoScale.innerText);i!=1/0&&(this.lastRealSpeed=i)}this.cpInfoScale.innerText=t.timeScaleToString(e),this.updateSpeedGroup(),r&&this.client.postUserCommand("setspeed",e.toString())},t.prototype.updateInfoPauseAt=function(){var t=this.client.getModelTime();"none"!=this.dpInfoPauseAt.style.display&&(t<0||p.parseFloatIgnoreCommas(this.dpInfoPauseAt.innerText.substring(1))<=parseFloat(t.toFixed(2)))&&Cf.setVisible(this.dpInfoPauseAt,!1)},t.prototype.runUntilOrPauseAt=function(e){var r,i=this.client.getExperimentState(),n=Cf.statesToShowTime.indexOf(i)>=0,a=n?this.client.getModelTime():this.client.getStartTime(),o=n?this.client.getModelDate():this.client.getStartDate(),s=e.getElementsByTagName("input"),l=s.item(0),u=s.item(1),c=s.item(2);if("none"!=l.style.display){if(r=t.validateFloatGreaterThan(l,a),isNaN(r))return}else{var h=this.validateDateLaterThan(u,c,o);if(null==h)return;var d=h.valueOf()-o.valueOf();r=a+this.client.toModelTimeUnits(d,"MILLISECOND")}var p=e==this.dpSectionRunUntil?"rununtiltime":"pauseattime";this.client.postUserCommand(p,r.toString()),this.showPauseAtReminder(r)},t.prototype.runFor=function(){var e=this.dpSectionRunFor.getElementsByTagName("input").item(0),r=this.dpSectionRunFor.getElementsByTagName("select").item(0),i=t.validateFloatGreaterThan(e,0);if(!isNaN(i)){this.client.postUserCommand("runfor",i+"|"+r.value);var n=this.client.toModelTimeUnits(i,r.value);this.showPauseAtReminder(this.client.getModelTime()+n)}},t.prototype.toggleTimeDateInputs=function(t){var e=t.parentElement.getElementsByTagName("input"),r=e.item(0),i=e.item(1),n=e.item(2);"none"==r.style.display?(r.style.removeProperty("display"),i.style.display="none",n.style.display="none",t.classList.remove("dev-panel-control-pressed"),t.firstElementChild.classList.remove("dev-panel-control-selected")):(r.style.display="none",i.style.removeProperty("display"),n.style.removeProperty("display"),this.updateDateAndTimeInInputs(i,n),t.classList.add("dev-panel-control-pressed"),t.firstElementChild.classList.add("dev-panel-control-selected"))},t.prototype.showPauseAtReminder=function(t){this.dpInfoPauseAt.innerText="["+p.formatNumber(t,2,!0)+"]",Cf.setVisible(this.dpInfoPauseAt,!0)},t.prototype.stopExperiment=function(){this.client.postUserCommand("stop",""),this.panels.onStop&&this.panels.onStop()},t.prototype.updateDateAndTimeInInputs=function(t,e){var r=this.client.getModelDate();if(!isNaN(r.getTime())){var i=new Date(t.value+" "+e.value);(isNaN(i.getTime())||i<r)&&(t.value=p.formatDate(r,"YYYY-MM-DD"),e.value=p.formatDate(r,"hh:mm"))}},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=p.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r,!0)},t.prototype.toggleVirtualTime=function(){t.stringToTimeScale(this.cpInfoScale.innerText)==1/0?this.setSpeed(this.lastRealSpeed,!0):this.setSpeed(1/0,!0)},t.timeScaleToString=function(e){if(e==1/0)return"Virtual";for(var r=0,i=t.speeds;r<i.length;r++){var n=i[r];if(Math.abs(e-n)<=1e-7)return n>=1?"x"+n:"x1/"+1/n}return"x"+(e>99999?e.toExponential(2):p.formatNumber(e,2))},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.validateFloatGreaterThan=function(t,e){var r=parseFloat(t.value);return isNaN(r)||r<=e?(t.setCustomValidity(h.msg.ENTER_NUMBER_GREATER_THAN()+" "+p.formatNumber(e,2)),NaN):(t.setCustomValidity(""),r)},t.prototype.validateDateLaterThan=function(t,e,r){var i=new Date(t.value+" "+e.value);if(isNaN(i.getTime())){var n=h.msg.VALID_DATE_REQUIRED();return t.setCustomValidity(n),e.setCustomValidity(n),void this.panels.client.showFadingInfoLine(n,!0,"white","red")}if(i<=r){n=h.msg.ENTER_DATE_LATER_THAN()+r.toString();return t.setCustomValidity(n),e.setCustomValidity(n),void this.panels.client.showFadingInfoLine(n,!0,"white","red")}return t.setCustomValidity(""),e.setCustomValidity(""),i},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t.tooltipdisabledbydesigner="TOOLTIP_DISABLED_BY_MODEL_DESIGNER",t}(),bf=function(){function t(t){var e=this;this.indexWasChanged=!1,this.panels=t,this.client=t.client,this.dpRowNavigationDeep=document.getElementById("dev-panel-row-navigation-deep"),this.dpButtonUp=document.getElementById("dev-panel-button-up"),this.dpButtonToExperiment=document.getElementById("dev-panel-button-to-experiment"),this.dpButtonToRootAgent=document.getElementById("dev-panel-button-to-root-agent"),this.dpBreadcrumbIndex=document.getElementById("dev-panel-breadcrumb-index"),this.dpBreadcrumbNextLevel=document.getElementById("dev-panel-breadcrumb-next-level"),this.dpRowNavigationLocal=document.getElementById("dev-panel-row-navigation-local"),this.dpButtonBack=document.getElementById("dev-panel-button-back"),this.dpButtonOrigin=document.getElementById("dev-panel-button-origin"),this.dpButtonZoomOut=document.getElementById("dev-panel-button-zoom-out"),this.dpInfoZoom=document.getElementById("dev-panel-info-zoom"),this.dpButtonZoomIn=document.getElementById("dev-panel-button-zoom-in"),this.dpSelectViewArea=document.getElementById("dev-panel-view-area-select"),this.panels.setupActionAndTooltip(this.dpButtonUp,function(){return e.navigate("up")}),this.panels.setupActionAndTooltip(this.dpButtonToExperiment,function(){return e.setPresentable("experiment")}),this.panels.setupActionAndTooltip(this.dpButtonToRootAgent,function(){return e.setPresentable("experiment.root")}),this.panels.setupTooltip(this.dpBreadcrumbNextLevel),this.panels.setupActionAndTooltip(this.dpButtonBack,function(){return e.navigate("back")}),this.panels.setupActionAndTooltip(this.dpButtonOrigin,function(){return e.navigate("home")}),this.panels.setupActionAndTooltip(this.dpButtonZoomOut,function(){return e.client.navigation.zoomInOut(!1)}),this.panels.setupTooltip(this.dpInfoZoom.parentNode),this.panels.setupActionAndTooltip(this.dpButtonZoomIn,function(){return e.client.navigation.zoomInOut(!0)}),this.dpSelectViewArea.onchange=function(){return e.client.postUserCommand("navigateto",e.dpSelectViewArea.value)},this.panels.setupTooltip(this.dpSelectViewArea.parentNode)}return t.prototype.update=function(){this.panels.setEnabled(this.dpRowNavigationLocal,!1),this.panels.setEnabled(this.dpRowNavigationDeep,!1);var t=this.client.getPresentable(),e=null!=t&&t.length>0;for(this.panels.setEnabled(this.dpButtonBack,this.client.isNavigationBackEnabled()),this.panels.setEnabled(this.dpButtonOrigin,e),this.panels.setEnabled(this.dpButtonZoomOut,e),this.panels.setEnabled(this.dpButtonZoomIn,e);this.dpSelectViewArea.length>0;)this.dpSelectViewArea.remove(0);var r=this.dpSelectViewArea.parentNode,i=this.client.getViewAreas();if(null!=i&&i.length>0){Cf.setVisible(r,!0),this.panels.setEnabled(r,!0);for(var n=0,a=i;n<a.length;n++){var o=a[n],s=document.createElement("option");s.innerText=o,s.value=o,this.dpSelectViewArea.appendChild(s)}var l=this.client.getViewTitle();null!=l&&(this.dpSelectViewArea.value=l)}else Cf.setVisible(r,!1);for(;this.dpButtonToRootAgent.nextElementSibling&&this.dpButtonToRootAgent.nextElementSibling!=this.dpBreadcrumbIndex;)this.dpButtonToRootAgent.nextElementSibling.remove();var u=!1,c=!1,h=null!=t&&t.length>(this.client.runningFromCloud()?2:1);this.panels.setEnabled(this.dpButtonUp,h);var d=null!=t&&t.length>1&&!this.client.runningFromCloud();this.panels.setEnabled(this.dpButtonToExperiment,d);var p=this.client.getExperimentState(),f="RUNNING"==p||"PAUSED"==p||"FINISHED"==p||"ERROR"==p;this.panels.setEnabled(this.dpButtonToRootAgent,null!=t&&2!=t.length&&f);var m=this.dpButtonToRootAgent.parentElement,g=null!=t&&t.length>1?"experiment.root":"experiment";if(null!=t)for(var v=2;v<t.length;v++){var b=t[v].indexOf("[");if(v<t.length-1||b<0){var y=this.createBreadcrumb(t[v],v<t.length-1,g);m.insertBefore(y,this.dpBreadcrumbIndex)}else{u=!0;var A=t[v].substring(0,b),T=parseInt(t[v].substring(b+1));this.showBreadcrumbWithIndex(g,A,T),this.indexWasChanged&&(this.dpBreadcrumbIndex.getElementsByTagName("input").item(0).focus(),this.indexWasChanged=!1)}g+="."+t[v]}if(null!=t&&t.length>1){var C=this.client.getNextLevelAgents();null!=C&&C.length>0&&(c=!0,this.showBreadcrumbNextlevel(g,C))}u||(this.dpBreadcrumbIndex.style.display="none"),c||(this.dpBreadcrumbNextLevel.style.display="none")},t.prototype.updateZoom=function(){var t=this.client.navigation.getZoom();this.dpInfoZoom.innerText=Math.round(100*t)+"%"},t.prototype.setDeepNavigationVisible=function(t){Cf.setVisible(this.dpRowNavigationDeep,t)},t.prototype.createBreadcrumb=function(t,e,r){var i=this,n=d.cloneHTMLElement("dev-panel-breadcrumb-template");return n.lastElementChild.innerText=t,e?this.panels.setupActionAndTooltip(n,function(){return i.setPresentable(r+"."+t)}):n.classList.remove("dev-panel-control-link"),n},t.prototype.showBreadcrumbWithIndex=function(e,r,i){var n=this;this.dpBreadcrumbIndex.style.removeProperty("display"),this.panels.setEnabled(this.dpBreadcrumbIndex,!0),this.dpBreadcrumbIndex.getElementsByClassName("dev-panel-text").item(0).innerText=r;var a=this.dpBreadcrumbIndex.getElementsByTagName("input").item(0);a.value=i.toString(),a.onchange=function(){var o=t.validateNonNegativeInteger(a);isNaN(o)||o==i||(n.setPresentable(e+"."+r+"["+o+"]"),n.indexWasChanged=!0)}},t.prototype.showBreadcrumbNextlevel=function(t,e){var r=this;this.dpBreadcrumbNextLevel.style.removeProperty("display"),this.panels.setEnabled(this.dpBreadcrumbNextLevel,!0);for(var i=this.dpBreadcrumbNextLevel.getElementsByTagName("select").item(0),n=i.firstElementChild;n.nextElementSibling;)n.nextElementSibling.remove();for(var a=0,o=e;a<o.length;a++){var s=o[a],l=document.createElement("option");l.innerText=s,l.value=s,i.appendChild(l)}i.onchange=function(){var e=i.value;if("..."!=e){var n=e.indexOf("["),a=n<0?e:e.substring(0,n)+"[0]";r.setPresentable(t+"."+a)}}},t.prototype.navigate=function(t){switch(t){case"home":case"back":this.client.postUserCommand(t,""),this.panels.setEnabled(this.dpRowNavigationLocal,!1),this.panels.setEnabled(this.dpRowNavigationDeep,!1);break;case"up":for(var e=this.client.getPresentable(),r=e[0],i=1;i<e.length-1;i++)r+="."+e[i];this.setPresentable(r)}},t.prototype.setPresentable=function(t){this.client.postUserCommand("setpresentable",t),this.panels.setEnabled(this.dpRowNavigationLocal,!1),this.panels.setEnabled(this.dpRowNavigationDeep,!1)},t.validateNonNegativeInteger=function(t){var e=parseInt(t.value);return isNaN(e)||e<0?(t.setCustomValidity(h.msg.NON_NEGATIVE_INTEGER_REQUIRED()),NaN):(t.setCustomValidity(""),e)},t}(),yf=function(){function t(t){var e=this;this.autoScroll=!1,this.userScrolled=!1,this.panels=t,this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.dpButtonConsole=document.getElementById("dev-panel-button-console"),this.dpSectionConsole=document.getElementById("dev-panel-section-console"),this.dpButtonConsoleClear=document.getElementById("dev-panel-button-console-clear"),this.dpButtonConsoleScroll=document.getElementById("dev-panel-button-console-scroll"),this.dpButtonConsoleWrap=document.getElementById("dev-panel-button-console-wrap"),this.dpInfoConsole=document.getElementById("dev-panel-console"),this.panels.setupActionAndTooltip(this.dpButtonConsole,function(){t.eventsView.hide(),e.show()}),this.panels.setupActionAndTooltip(this.dpButtonConsoleClear,function(){return e.clear()}),this.panels.setupActionAndTooltip(this.dpButtonConsoleScroll,function(){return e.scrollDown()}),this.panels.setupActionAndTooltip(this.dpButtonConsoleWrap,function(){return e.toggleTextWrap()}),this.panels.setEnabled(this.dpButtonConsoleScroll,this.userScrolled),this.dpInfoConsole.onscroll=function(){e.onScroll()}}return t.prototype.start=function(){this.dpButtonConsole.firstElementChild.innerHTML=h.msg.CONSOLE()},t.prototype.show=function(){this.panels.setEnabled(this.dpButtonConsole,!1),Cf.setVisible(this.dpSectionConsole,!0),Cf.setVisible(this.dpInfoConsole,!0),this.dpButtonConsole.classList.remove(t.rowTabInactiveClass)},t.prototype.hide=function(){this.panels.setEnabled(this.dpButtonConsole,!0),Cf.setVisible(this.dpSectionConsole,!1),Cf.setVisible(this.dpInfoConsole,!1),this.dpButtonConsole.classList.add(t.rowTabInactiveClass)},t.prototype.update=function(e){var r=e.length;if(0!=r){var i=Math.min(r,t.MAX_CONSOLE_ITEMS),n=i>2,a=this.dpInfoConsole.parentNode;n&&this.dpInfoConsole.remove();var o=this.dpInfoConsole.childElementCount,s=Math.max(0,o+i-t.MAX_CONSOLE_ITEMS);if(s==o)this.dpInfoConsole.innerHTML="";else for(var l=0;l<s;l++)this.dpInfoConsole.firstElementChild.remove();var u=e[r-i].id,c=this.dpInfoConsole.lastElementChild;if(c&&c.getAttribute("itemid")){var d=u-(parseInt(c.getAttribute("itemid"))+1);if(d>1){var p=t.createNotification("..."+d+" "+h.msg.ITEMS_SKIPPED()+"...");this.dpInfoConsole.appendChild(p)}}for(l=r-i;l<r;l++){var f=e[l],m=document.createElement("p");m.setAttribute("itemid",f.id.toString()),m.innerText=f.text,"null"!=f.color&&(m.style.color=f.color),this.dpInfoConsole.appendChild(m)}var g=this.dpInfoConsole.firstElementChild;if(g&&g.getAttribute("itemid")){var v=parseInt(g.getAttribute("itemid"));if(v>0){p=t.createNotification("..."+v+" "+h.msg.ITEMS_DELETED()+"...");this.dpInfoConsole.insertBefore(p,g)}}n&&a.appendChild(this.dpInfoConsole),this.userScrolled||this.scrollDown(),this.panels.isDevPanelOpen()||this.cpIconConsole.classList.contains(t.newItemsIndicatorClass)||this.cpIconConsole.classList.add(t.newItemsIndicatorClass)}},t.prototype.scrollDown=function(){this.dpInfoConsole.scrollTop=this.dpInfoConsole.scrollHeight,this.dpInfoConsole.scrollLeft=0,this.autoScroll=!0,this.userScrolled=!1,this.panels.setEnabled(this.dpButtonConsoleScroll,!1)},t.prototype.resetNewItemsIndicator=function(){this.cpIconConsole.classList.remove(t.newItemsIndicatorClass)},t.prototype.clear=function(){this.dpInfoConsole.innerHTML="",this.autoScroll=!0,this.userScrolled=!1,this.panels.setEnabled(this.dpButtonConsoleScroll,!1)},t.createNotification=function(t){var e=document.createElement("p");return e.className=this.notificationClass,e.innerText=t,e},t.prototype.onScroll=function(){this.autoScroll||(this.userScrolled=!0,this.panels.setEnabled(this.dpButtonConsoleScroll,!0)),this.autoScroll=!1},t.prototype.toggleTextWrap=function(){var t="pre"==this.dpInfoConsole.style.whiteSpace;this.dpInfoConsole.style.whiteSpace=t?"pre-wrap":"pre"},t.MAX_CONSOLE_ITEMS=1e3,t.newItemsIndicatorClass="control-panel-console-new",t.notificationClass="dev-panel-console-notification",t.rowTabInactiveClass="dev-panel-row-tab-inactive",t}(),Af=function(){function t(t){var e=this;this.showEventQueue=!0,this.panels=t,this.dpButtonEvents=document.getElementById("dev-panel-button-events"),this.dpSectionEvents=document.getElementById("dev-panel-section-events"),this.dpButtonQueue=document.getElementById("dev-panel-button-events-queue"),this.dpButtonMonitor=document.getElementById("dev-panel-button-events-monitor"),this.dpInfoQueue=document.getElementById("dev-panel-events-queue"),this.dpInfoMonitor=document.getElementById("dev-panel-events-monitor"),this.panels.setupActionAndTooltip(this.dpButtonEvents,function(){t.modelConsole.hide(),e.show()}),this.panels.setupActionAndTooltip(this.dpButtonQueue,function(){e.showEventQueue=!0,e.showTable()}),this.panels.setupActionAndTooltip(this.dpButtonMonitor,function(){e.showEventQueue=!1,e.showTable()})}return t.prototype.start=function(){this.dpButtonEvents.firstElementChild.innerHTML=h.msg.EVENTS();var t=document.getElementById("dev-panel-events-queue-table-template");t.rows[0].cells[1].innerText=h.msg.EVENTS_EVENTS_SCHEDULED_BY()+":",t.rows[0].cells[2].innerText=h.msg.EVENTS_TIME_LEFT(),(t=document.getElementById("dev-panel-events-monitor-table-template")).rows[0].cells[1].innerText=h.msg.EVENTS_CONDITIONS_MONITORED_BY()+":"},t.prototype.show=function(){this.panels.setEnabled(this.dpButtonEvents,!1),this.dpButtonEvents.classList.remove(yf.rowTabInactiveClass),Cf.setVisible(this.dpSectionEvents,!0),this.showTable(),this.setSendEvents(!0)},t.prototype.hide=function(){this.panels.setEnabled(this.dpButtonEvents,!0),this.dpButtonEvents.classList.add(yf.rowTabInactiveClass),Cf.setVisible(this.dpSectionEvents,!1),Cf.setVisible(this.dpInfoQueue,!1),Cf.setVisible(this.dpInfoMonitor,!1),this.setSendEvents(!1)},t.prototype.isShown=function(){return"none"!=this.dpSectionEvents.style.display},t.prototype.onDevPanelOpenClose=function(){this.setSendEvents(this.panels.isDevPanelOpen()&&this.isShown())},t.prototype.showTable=function(){Cf.setVisible(this.dpInfoQueue,this.showEventQueue),Cf.setVisible(this.dpInfoMonitor,!this.showEventQueue),this.panels.setEnabled(this.dpButtonQueue,!this.showEventQueue),this.panels.setEnabled(this.dpButtonMonitor,this.showEventQueue);var t="dev-panel-control-pressed",e="dev-panel-control-selected";this.showEventQueue?(this.dpButtonQueue.classList.add(t),this.dpButtonQueue.firstElementChild.classList.add(e),this.dpButtonMonitor.classList.remove(t),this.dpButtonMonitor.firstElementChild.classList.remove(e)):(this.dpButtonQueue.classList.remove(t),this.dpButtonQueue.firstElementChild.classList.remove(e),this.dpButtonMonitor.classList.add(t),this.dpButtonMonitor.firstElementChild.classList.add(e))},t.prototype.update=function(e){var r=this.panels.client.getModelTime();if(e){(v=d.cloneHTMLElement("dev-panel-events-queue-table-template")).rows[0].cells[1].innerHTML=p.formatNumber(e.eventCount,0)+" "+v.rows[0].cells[1].innerHTML;for(var i=0,n=void 0,a=0,o=e.events;a<o.length;a++){for(var s=o[a],l=v.rows[0],u=v.insertRow(-1),c=0;c<3;c++)u.insertCell(c),u.cells[c].className=l.cells[c].className;i++,u.cells[0].innerText=s.index;var h=s.name.includes(" "),f=s.name.includes("User's");h&&u.cells[1].classList.add(f?"dev-panel-events-queue-system-pause-name":"dev-panel-events-queue-system-name"),f&&u.classList.add("dev-panel-events-queue-system-pause"),h?u.cells[1].innerText=s.name:(t.setupEventIcon(u,s.type),this.setupEventLink(u,s.name)),u.setAttribute("time",s.time),s.time!=n&&(null!=n&&u.classList.add("dev-panel-events-queue-new-time"),this.setupRunForLink(u),n=s.time)}i<e.eventCount&&t.addRowMore(v,e.eventCount-i),this.dpInfoQueue.innerHTML="",this.dpInfoQueue.appendChild(v),(v=d.cloneHTMLElement("dev-panel-events-monitor-table-template")).rows[0].cells[1].innerHTML=p.formatNumber(e.predicatesCount,0)+" "+v.rows[0].cells[1].innerHTML,i=0;for(var m=0,g=e.predicates;m<g.length;m++){for(s=g[m],l=v.rows[0],u=v.insertRow(-1),c=0;c<2;c++)u.insertCell(c),u.cells[c].className=l.cells[c].className;i++,u.cells[0].innerText=s.index,t.setupEventIcon(u,s.type),this.setupEventLink(u,s.name)}i<e.predicatesCount&&t.addRowMore(v,e.predicatesCount-i),this.dpInfoMonitor.innerHTML="",this.dpInfoMonitor.appendChild(v)}if(e||"RUNNING"!=this.panels.client.getExperimentState()&&r!=this.timeAtLastUpdate){var v;if(!(v=this.dpInfoQueue.firstElementChild))return;for(c=0;c<v.rows.length;c++){u=v.rows[c];var b=p.getFloatAttribute(u,"time");1==c&&b<=r&&(u.classList.add("dev-panel-events-queue-next"),u.cells[1].classList.remove("dev-panel-events-queue-system-name"));var y=u.cells[2].firstElementChild;if(y){var A=p.formatNumber(b-r,3);y.innerHTML!=A&&(y.innerHTML=A)}}this.timeAtLastUpdate=r}},t.createLink=function(t,e){var r=document.createElement("span");return r.innerText=t,r.onclick=function(){return e()},r.classList.add("dev-panel-events-link"),r},t.prototype.setupEventLink=function(e,r){var i=this,n="experiment."+r.substring(0,r.lastIndexOf(".")),a=t.createLink(r,function(){"RUNNING"==i.panels.client.getExperimentState()?i.panels.client.showFadingInfoLine(h.msg.EVENTS_PAUSE_THE_MODEL_TO_FOLLOW_EVENT_LINK(),!0,"white","royalblue"):i.panels.client.postUserCommand("setpresentable",n)});this.panels.setupDynamicTooltip(a,function(){return h.msg.TOOLTIP_EVENTS_SHOW_AGENT()+("RUNNING"==i.panels.client.getExperimentState()?" ("+h.msg.TOOLTIP_EVENTS_IN_PAUSED_STATE_ONLY()+")":"")}),e.cells[1].appendChild(a)},t.prototype.setupRunForLink=function(e){var r=this,i=t.createLink("?",function(){if("PAUSED"!=r.panels.client.getExperimentState())r.panels.client.showFadingInfoLine(h.msg.EVENTS_PAUSE_THE_MODEL_RUN_TO_EVENT(),!0,"white","royalblue");else{var t=p.getFloatAttribute(e,"time");r.panels.client.postUserCommand("rununtiltime",t.toString()),r.panels.execution.showPauseAtReminder(t)}});this.panels.setupDynamicTooltip(i,function(){return h.msg.TOOLTIP_EVENTS_RUN_TO()+("RUNNING"==r.panels.client.getExperimentState()?" ("+h.msg.TOOLTIP_EVENTS_IN_PAUSED_STATE_ONLY()+")":"")}),e.cells[2].appendChild(i)},t.setupEventIcon=function(t,e){var r,i=e.includes("TRANSITION")?"transition":"event";switch(e){case"EVENT_DYNAMIC":r="dynamic";break;case"EVENT_CONDITION":case"TRANSITION_CONDITION":r="condition";break;case"EVENT_TIMEOUT":case"TRANSITION_TIMEOUT":r="timeout";break;case"EVENT_RATE":case"TRANSITION_RATE":r="rate";break;case"TRANSITION_MESSAGE":r="message";break;default:return}var n=d.cloneHTMLElement("dev-panel-icon-event-template");n.firstElementChild.setAttributeNS(d.xlinkns,"href","#dev-panel-icon-"+i),n.lastElementChild.setAttributeNS(d.xlinkns,"href","#dev-panel-icon-"+r),t.cells[1].appendChild(n)},t.addRowMore=function(t,e){for(var r=t.rows[t.rows.length-1],i=t.insertRow(-1),n=0;n<r.cells.length;n++)i.insertCell(n);i.cells[1].innerText=p.formatNumber(e,0)+" "+h.msg.EVENTS_MORE()+"...",i.className="dev-panel-events-row-more"},t.prototype.setSendEvents=function(t){this.panels.client.postUserCommand("sendevents",t?"true":"false")},t}(),Tf=function(){function t(t){var e=this;this.onSnapshotLoadInfo=function(t,r){var i=p.getAttributeValue(t,r,"type");switch(i){case"snapshot-progress":var n=p.getAttributeValue(t,r,"fraction"),a=p.getAttributeValue(t,r,"text");"null"!=n&&kf.setMessageBoxProgress(.25+.75*parseFloat(n)),"null"!=a&&(kf.setMessageBoxProgress(-1),kf.setMessageBoxHTML(a+"\n"+h.msg.OPERATION_CANNOT_BE_INTERRUPTED()+"\n"));break;case"snapshot-ready":case"snapshot-error":if(kf.closeMessageBox(),e.client.frameDrawing.removeInfoCommandListener(e.onSnapshotLoadInfo),"snapshot-error"==i){var o=p.getAttributeValue(t,r,"text");e.client.showMessageBox("error",h.msg.BOX_TITLE_LOAD_SNAPSHOT(),h.msg.SNAPSHOT_FAILED_TO_RESTORE()+":\n"+o)}}},this.onSnapshotSaveInfo=function(t,r){var i=p.getAttributeValue(t,r,"type");switch(i){case"snapshot-progress":var n=p.getAttributeValue(t,r,"fraction"),a=p.getAttributeValue(t,r,"text");"null"!=n&&kf.setMessageBoxProgress(parseFloat(n)),"null"!=a&&(kf.setMessageBoxProgress(-1),kf.setMessageBoxHTML(h.msg.WRITING_SNAPSHOT_FILE()+":\n"+a+"\n"+h.msg.OPERATION_CANNOT_BE_INTERRUPTED()+"\n"));break;case"snapshot-ready":case"snapshot-error":if(kf.closeMessageBox(),e.client.frameDrawing.removeInfoCommandListener(e.onSnapshotSaveInfo),"snapshot-ready"==i){var o=p.getAttributeValue(t,r,"file-name");e.client.networkManager.downloadFile(o),e.client.showMessageBox("message",h.msg.BOX_TITLE_SAVE_SNAPSHOT(),h.msg.DOWNLOADING_SNAPSHOT())}else{var s=p.getAttributeValue(t,r,"text");e.client.showMessageBox("error",h.msg.BOX_TITLE_SAVE_SNAPSHOT(),h.msg.SNAPSHOT_FAILED_TO_SAVE()+":\n"+s)}}},this.panels=t,this.client=t.client,this.fileInput=document.getElementById("file-input-for-svg"),this.dpButtonFileOpt=document.getElementById("dev-panel-button-file-options"),this.dpButtonLoadSnapshot=document.getElementById("dev-panel-button-load-snapshot"),this.dpButtonSaveSnapshot=document.getElementById("dev-panel-button-save-snapshot"),this.panels.setupActionAndTooltip(this.dpButtonFileOpt,function(){Cf.toggleExpanded(e.dpButtonFileOpt),e.updateFileGroup()}),this.panels.setupActionAndTooltip(this.dpButtonLoadSnapshot,function(){return e.loadSnapshot()}),this.panels.setupActionAndTooltip(this.dpButtonSaveSnapshot,function(){return e.saveSnapshot()})}return t.prototype.updateFileGroup=function(){var e="true"==this.dpButtonFileOpt.getAttribute("expanded"),r=t.experimentsSupportingSnapshot.indexOf(this.client.getExperimentType())>=0,i="RUNNING"==this.client.getExperimentState();Cf.setVisible(this.dpButtonLoadSnapshot,e),this.panels.setEnabled(this.dpButtonLoadSnapshot,r&&!i),Cf.setVisible(this.dpButtonSaveSnapshot,e),this.panels.setEnabled(this.dpButtonSaveSnapshot,r&&!i),r&&!i?(Cf.setTooltip(this.dpButtonLoadSnapshot,"TOOLTIP_LOAD_SNAPSHOT"),Cf.setTooltip(this.dpButtonSaveSnapshot,"TOOLTIP_SAVE_SNAPSHOT")):r?(Cf.setTooltip(this.dpButtonLoadSnapshot,"TOOLTIP_SNAPSHOT_NOT_WHILE_RUNNING"),Cf.setTooltip(this.dpButtonSaveSnapshot,"TOOLTIP_SNAPSHOT_NOT_WHILE_RUNNING")):(Cf.setTooltip(this.dpButtonLoadSnapshot,"TOOLTIP_SNAPSHOT_NOT_SUPPORTED"),Cf.setTooltip(this.dpButtonSaveSnapshot,"TOOLTIP_SNAPSHOT_NOT_SUPPORTED"))},t.prototype.loadSnapshot=function(){var t=this;this.client.runningFromCloud()?this.client.showMessageBox("message",h.msg.BOX_TITLE_NOT_SUPPORTED(),h.msg.BOX_TEXT_SNAPSHOT_LOAD_NOT_SUPPORTED()):(this.fileInput.accept=".als",this.fileInput.onchange=function(){return t.onSnapshotFileChosen()},this.fileInput.click())},t.prototype.saveSnapshot=function(){this.client.postUserCommand("savesnapshot",""),this.client.showMessageBox("wait",h.msg.BOX_TITLE_SAVE_SNAPSHOT(),h.msg.WRITING_SNAPSHOT_FILE()+".\n\n"+h.msg.OPERATION_CANNOT_BE_INTERRUPTED()+"\n",!0,!1),this.client.frameDrawing.addInfoCommandListener(this.onSnapshotSaveInfo)},t.prototype.onSnapshotFileChosen=function(){var t=this,e=this.fileInput.files;if(e.length>0){var r=e[0];this.client.showMessageBox("wait",h.msg.BOX_TITLE_LOAD_SNAPSHOT(),h.msg.UPLOADING_SNAPSHOT_FILE()+":\n"+r.name+" ["+p.formatNumber(r.size,0)+" "+h.msg.BYTES()+"]\n"+h.msg.OPERATION_CANNOT_BE_INTERRUPTED()+"\n",!0,!1),this.client.networkManager.uploadFile("0",r,function(e){return t.onSnapshotUploadProgress(e)},function(e){return t.onSnapshotUploaded()},function(e){return t.onSnapshotUploadError(e)},"snapshot")}this.fileInput.value=""},t.prototype.onSnapshotUploadProgress=function(t){if(!this.client.isStoppedAndShouldIgnoreResponses()&&t.lengthComputable){var e=t.loaded/t.total;kf.setMessageBoxProgress(.25*e)}},t.prototype.onSnapshotUploaded=function(){if(!this.client.isStoppedAndShouldIgnoreResponses()){var t=kf.getMessageBoxHTML();kf.setMessageBoxHTML(t.replace(h.msg.UPLOADING_SNAPSHOT_FILE(),h.msg.RESTORING_SNAPSHOT())),this.client.frameDrawing.addInfoCommandListener(this.onSnapshotLoadInfo)}},t.prototype.onSnapshotUploadError=function(t){this.client.isStoppedAndShouldIgnoreResponses()||(kf.closeMessageBox(),this.client.showMessageBox("error",h.msg.BOX_TITLE_LOAD_SNAPSHOT(),h.msg.SNAPSHOT_FAILED_TO_UPLOAD()+":\n"+t))},t.experimentsSupportingSnapshot=["simulation","compare","variation"],t}(),Cf=function(){function t(e){var r=this;this.wsvgmin=100,this.wborder=4,this.wbodymin=300,this.hprogress=4,this.hcontrolpanel=46,this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDevContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDevContainer.parentElement,this.progress=document.getElementById("control-panel-progress"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.progressTooltip=document.getElementById("control-panel-progress-tooltip"),this.controlPanel=document.getElementById("control-panel"),this.cpButtonWebsite=document.getElementById("control-panel-button-website"),this.cpButtonTermsOfUse=document.getElementById("control-panel-button-terms-of-use"),this.cpButtonAbout=document.getElementById("control-panel-button-about"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDevTools=document.getElementById("control-panel-button-dev-panel"),this.cpInfoState=document.getElementById("control-panel-info-state"),this.cpIndicatorMultiRun=document.getElementById("control-panel-multi-run-progress-indicator"),this.cpIndicatorResponse=document.getElementById("control-panel-response-indicator"),this.cpIndicatorNetwork=document.getElementById("control-panel-network-access-indicator"),this.cpIndicatorLag=document.getElementById("control-panel-lag-indicator"),this.devPanel=document.getElementById("svg-dev-panel"),this.dpBorder=document.getElementById("dev-panel-border"),this.dpBody=document.getElementById("dev-panel-body"),this.dpSectionTime=document.getElementById("dev-panel-section-time"),this.dpSectionDate=document.getElementById("dev-panel-section-date"),this.dpIndicatorState=document.getElementById("dev-panel-state-indicator"),this.dpInfoTimeInteger=document.getElementById("dev-panel-info-time-integer"),this.dpInfoTimeFraction=document.getElementById("dev-panel-info-time-fraction"),this.dpInfoTimeUnit=document.getElementById("dev-panel-info-time-unit"),this.dpInfoDate=document.getElementById("dev-panel-info-date"),this.dpInfoRealSpeed=document.getElementById("dev-panel-info-real-speed"),this.dpInfoFps=document.getElementById("dev-panel-info-fps"),this.dpInfoEps=document.getElementById("dev-panel-info-eps"),this.dpInfoStep=document.getElementById("dev-panel-info-step"),this.dpInfoRealTime=document.getElementById("dev-panel-info-real-time"),this.dpInfoMemory=document.getElementById("dev-panel-info-memory");var i=document.getElementById("dev-panel-memory-indicator-container");this.dpMemoryIndicator=t.addArcIndicator(i,.75,"dev-panel-memory-back"),this.dbInfoShapeCount=document.getElementById("dev-panel-info-shape-count"),this.dbInfoCudCount=document.getElementById("dev-panel-info-cud-count"),this.dbInfoFramesQ=document.getElementById("dev-panel-info-frames-queue"),this.dbInfoRequest=document.getElementById("dev-panel-info-request"),this.dbInfoPacket=document.getElementById("dev-panel-info-packet"),this.dbInfoMore=document.getElementById("dev-panel-info-more"),this.execution=new vf(this),this.modelNavigation=new bf(this),this.modelConsole=new yf(this),this.eventsView=new Af(this),this.snapshot=new Tf(this),this.setupGlobalHotkeys(),new f(this.dpBorder,null,null,function(t){r.isDevPanelOpen()&&new fp(t.pageX,t.pageY,function(t,e,i){return r.onDevPanelBorderDrag(e)},null,"col-resize")},null,null),d.isDebugMode()&&this.openDevPanel(),window.onbeforeunload=function(){return r.client.postUserCommand("close","")},window.addEventListener("resize",function(){return r.adjustControlPanelItemsVisibility()},!1),this.setupTooltip(this.cpIndicatorResponse),this.setupActionAndTooltip(this.cpButtonWebsite,function(){return window.open("https://www.anylogic.com")}),this.setupActionAndTooltip(this.cpButtonTermsOfUse,function(){return r.showTermsOfUse()}),this.setupActionAndTooltip(this.cpButtonAbout,function(){return r.showAboutInfo()}),this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},this.setupTooltip(this.cpInfoState),this.setupActionAndTooltip(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),E.addFullScreenListener(function(){return r.onFullScreenChange()}),this.setupActionAndTooltip(this.cpButtonDevTools,function(){return r.toggleDevPanel()}),this.setupTooltip(this.dpInfoTimeInteger),this.setupTooltip(this.dpInfoTimeFraction),this.setupTooltip(this.dpInfoTimeUnit),this.setupTooltip(this.dpInfoDate),this.setupTooltip(this.dpInfoRealSpeed.parentNode),this.setupTooltip(this.dpInfoEps.parentNode),this.setupTooltip(this.dpInfoFps.parentNode),this.setupTooltip(this.dpInfoStep.parentNode),this.setupTooltip(this.dpInfoRealTime.parentNode),this.setupTooltip(this.dpInfoMemory.parentNode.parentNode);var n=document.getElementById("DEBUG-toggle-debug"),a=document.getElementById("DEBUG-panel-choose-model"),o=document.getElementById("DEBUG-panel-info-svg");n.onclick=function(){r.client.DEBUG_SPARK_LOCAL&&("none"==a.style.display?(a.style.removeProperty("display"),o.style.removeProperty("display")):(a.style.display="none",o.style.display="none"))}}return t.prototype.start=function(){var e=this;this.execution.start(),this.modelConsole.start(),this.eventsView.start(),this.cpButtonWebsite.lastElementChild.innerHTML=h.msg.ANYLOGIC_WEBSITE(),this.cpButtonTermsOfUse.lastElementChild.innerHTML=h.msg.TERMS_OF_USE(),this.cpButtonAbout.lastElementChild.innerHTML=h.msg.ABOUT_ANYLOGIC(),this.dpInfoTimeUnit.innerHTML=h.msg.SECOND(),this.dpInfoDate.innerHTML="["+h.msg.DATE()+"]",this.dpInfoEps.previousElementSibling.innerHTML=h.msg.EPS()+":",this.dpInfoFps.previousElementSibling.innerHTML=h.msg.FPS()+":",this.dpInfoStep.previousElementSibling.innerHTML=h.msg.STEP()+":",this.dpInfoRealTime.previousElementSibling.innerHTML=h.msg.REAL_TIME()+":",this.dpInfoRealTime.innerHTML="0 "+h.msg.SECOND(),this.dpInfoMemory.innerHTML="0 "+h.msg.PERCENT_OF()+" 0"+h.msg.MEGABYTES(),this.client.runningFromCloud()||this.svgContainer.classList.add("svg-container-standalone"),this.client.isDevPanelEnabled()?this.client.isDevPanelVisibleOnStart()&&this.openDevPanel():(this.closeDevPanel(),t.setVisible(this.cpButtonDevTools,!1,"logic")),this.eachSecondInterval=window.setInterval(function(){return e.eachSecondUpdate()},1e3),this.each200msInterval=window.setInterval(function(){return e.each200msUpdate()},200),this.realRunningTime=0,this.lastServerRTOf1sec=void 0,this.lastStepOf1sec=0,this.lastServerRTOf200ms=void 0},t.prototype.stop=function(){window.clearInterval(this.eachSecondInterval),window.clearInterval(this.each200msInterval)},t.prototype.setOnToggleFullScreen=function(t){this.onToggleFullScreen=t},t.prototype.setOnResize=function(t){this.onResize=t},t.prototype.setOnStop=function(t){this.onStop=t},t.prototype.onDevPanelBorderDrag=function(t){var e=Math.floor(this.svgAndDevContainer.getBoundingClientRect().width),r=this.dpBody.offsetWidth,i=r-t;return i=Math.min(i,e-this.wsvgmin-this.wborder),i=Math.max(this.wbodymin,i),this.dpBody.style.width=i+"px",this.client.navigation.keepAtNavigationPoint(),[r-i,0]},t.prototype.isDevPanelOpen=function(){return"none"!=this.devPanel.style.display},t.prototype.openDevPanel=function(){if(!(this.isDevPanelOpen()||.8*window.screen.availWidth<this.wsvgmin+this.wborder+this.wbodymin)){var t=this.atModelWindowSize();this.devPanel.style.removeProperty("display"),this.dpBody.style.width||(this.dpBody.style.width=this.wbodymin+"px"),t&&this.resizeWindowToFitModelNativeSize(),this.client.navigation.keepAtNavigationPoint(),this.cpButtonDevTools.classList.add("control-panel-control-pressed"),this.modelConsole.resetNewItemsIndicator(),this.modelConsole.scrollDown(),this.eventsView.onDevPanelOpenClose()}},t.prototype.openConsole=function(){this.eventsView.hide(),this.modelConsole.show()},t.prototype.closeDevPanel=function(){if(this.isDevPanelOpen()){var t=this.atModelWindowSize();this.devPanel.style.display="none",t&&this.resizeWindowToFitModelNativeSize(),this.client.navigation.keepAtNavigationPoint(),this.cpButtonDevTools.classList.remove("control-panel-control-pressed"),this.eventsView.onDevPanelOpenClose()}},t.prototype.toggleDevPanel=function(){this.isDevPanelOpen()?this.closeDevPanel():this.openDevPanel()},t.prototype.getWidthAndHeightTakenByPanels=function(){var t=this.hprogress+this.hcontrolpanel;return{width:this.isDevPanelOpen()?this.wborder+parseInt(this.dpBody.style.width):0,height:t}},t.prototype.resizeWindowToFitModelNativeSize=function(){var t=this,e=this.getWidthAndHeightTakenByPanels(),r=this.client.getWindowWidth()+e.width,i=this.client.getWindowHeight()+e.height;this.client.runningFromCloud()?this.onResize&&this.onResize(r,i,function(){t.client.navigation.keepAtNavigationPoint(),t.adjustControlPanelItemsVisibility()}):(E.setBrowserWindowInnerSize(r,i),this.adjustControlPanelItemsVisibility())},t.prototype.adjustControlPanelItemsVisibility=function(){var e=this.presentationContainer.getBoundingClientRect().width,r=262,i=E.isFullScreenEnabled();t.setVisible(this.cpButtonFullScreen,i,"logic");var n=(e-=r+=i?46:0)>=(r=178);t.setVisible(this.execution.cpButtonSlower,n,"space"),t.setVisible(this.execution.cpInfoScale,n,"space");var a=t.setVisible(this.execution.cpButtonFaster,n,"space");a&&(e-=r),n=e>=(r=46),(a=t.setVisible(this.execution.cpButtonX1,n,"space"))&&(e-=r),n=e>=(r=46),(a=t.setVisible(this.execution.cpButtonVirtual,n,"space"))&&(e-=r),this.client.isDevPanelEnabled()&&(n=e>=(r=70),(a=t.setVisible(this.cpButtonDevTools,n,"space"))&&(e-=r)),n=e>=(r=86),(a=t.setVisible(this.execution.cpInfoMultiRun,n,"space"))&&(e-=r),n=e>=(r=46),(a=t.setVisible(this.cpIndicatorResponse,n,"space"))&&(e-=r)},t.prototype.eachSecondUpdate=function(){var e=this.client.getServerRealTime(),r=this.client.getExperimentStep(),i=this.client.getModelTime();if(null!=this.lastServerRTOf1sec){var n=i-this.lastModelTimeOf1sec;this.dpInfoRealSpeed.innerText=p.formatTimeInterval(n,this.client.getTimeUnit())+"/"+h.msg.SECOND();var a=e-this.lastServerRTOf1sec,o=r-this.lastStepOf1sec,s=a>0?Math.round(1e3*o/a):0;this.dpInfoEps.innerText=p.formatNumber(s,0)}this.lastServerRTOf1sec=e,this.lastStepOf1sec=r,this.lastModelTimeOf1sec=i;var l=this.client.frameDrawing.actualFPS();this.dpInfoFps.innerText=l>=1?Math.round(l).toString():p.formatNumber(l,2,!1),this.dpInfoRealTime.innerText=p.formatNumber(this.realRunningTime/1e3,2)+" "+h.msg.SECOND();var u=this.client.getExperimentMaxMemory(),c=this.client.getExperimentFreeMemory(),d=u>0?(u-c)/u:0,f=Math.round(100*d);this.dpInfoMemory.innerText=f+"% "+h.msg.PERCENT_OF()+" "+t.memoryToString(u);var m=d>.85?"dev-panel-memory-bar-critical":"dev-panel-memory-bar-normal";t.setAcrIndicatorValue(this.dpMemoryIndicator,d),t.setArcIndicatorValueStyle(this.dpMemoryIndicator,m)},t.prototype.each200msUpdate=function(){this.updateExperimentStep(),this.client.isSimulationExperiment()&&this.updateModelTime();var t=this.client.getExperimentState();"INITIALIZE"!=t&&"IDLE"!=t||(this.realRunningTime=0);var e=this.client.getServerRealTime();null!=this.lastServerRTOf200ms&&"RUNNING"==t&&(this.realRunningTime+=e-this.lastServerRTOf200ms),this.lastServerRTOf200ms=e,this.updateLagIndicator(),d.isDebugMode()&&this.updateDebugInfo()},t.prototype.updateExperimentSettings=function(){this.client.runningFromCloud()||(document.title=this.client.getExperimentName()+" - "+this.anyLogicProductName(!1));var e=this.client.isSimulationExperiment();t.setVisible(this.dpSectionTime,e),t.setVisible(this.dpSectionDate,e),t.setVisible(this.dpInfoRealSpeed.parentElement,e),e&&(this.dpInfoTimeUnit.innerText=p.timeUnitToString(this.client.getTimeUnit())),this.snapshot.updateFileGroup(),this.execution.updateExperimentSettings(),this.execution.updateRunGroup(),this.execution.updateSpeedGroup(),this.modelNavigation.setDeepNavigationVisible(e)},t.prototype.updateExperimentState=function(){this.updateInfoState(),this.snapshot.updateFileGroup(),this.execution.updateRunGroup(),this.execution.updateSpeedGroup(),this.modelNavigation.update()},t.prototype.updateExperimentProgress=function(){var t=this.client.getExperimentProgress();if(t<0)this.progress.className="control-panel-progress-inactive";else{this.progress.className="control-panel-progress-active";var e=100*t;if(this.progressBar.style.width=e+"%",this.progressTooltip.innerText=Math.floor(e)+"%",this.client.getMultiRunProgress().length>0){for(var r=this.client.getMultiRunProgress();r.length>this.cpIndicatorMultiRun.childElementCount;){var i=document.createElementNS(d.svgns,"line");this.cpIndicatorMultiRun.appendChild(i)}for(;r.length<this.cpIndicatorMultiRun.childElementCount;)this.cpIndicatorMultiRun.lastElementChild.remove();var n=d.childElements(this.cpIndicatorMultiRun),a=20/r.length;this.cpIndicatorMultiRun.setAttribute("stroke-width",(a/2).toString());for(var o=0;o<r.length;o++){var s=a/2+o*a,l=Math.max(0,r[o]/100*60);p.setMultipleAttributes(n[o],["y1","x2","y2"],[s,l,s])}}}},t.prototype.updateModelTimeScale=function(){this.execution.setSpeed(this.client.getModelTimeScale(),!1)},t.prototype.updateNetworkConnections=function(){var t=this.client.getNetworkConnectionsCount();this.cpIndicatorNetwork.setAttribute("visibility",t>0?"inherit":"hidden")},t.prototype.anyLogicProductName=function(e){var r=t.anyLogicEditionToString(this.client.getAnyLogicEdition()),i=this.client.getAnyLogicVersionModification(),n=t.anyLogicEditionModificationToString(this.client.getAnyLogicEditionModification()),a=r;return e&&(a+=" "+this.client.getAnyLogicVersion()),i&&(a+=" "+i),n&&(a+=" ["+n+"]"),a},t.prototype.updateDebugInfo=function(){var t=this.client.packetManager.totalFrameCount();this.dbInfoFramesQ.innerText=this.client.frameDrawing.framesToPlay()+" ("+p.formatNumber(this.client.frameDrawing.timeToPlay(),2)+")"+(t>0?" + "+t:"")+" | "+this.client.packetRequester.getServerQueue(),this.dbInfoRequest.innerText=Math.round(this.client.packetRequester.getRequestInterval())+" | "+Math.round(this.client.packetRequester.averageResponseTime())},t.prototype.updatePacketInfo=function(t,e,r){this.dbInfoPacket.innerText=p.formatNumber(t,0)+" ["+e+"] @"+p.formatNumber(r,2)},t.prototype.updateShapeCount=function(t){this.dbInfoShapeCount.innerText=t.toString()},t.prototype.updateCreateUpdateDeleteCount=function(t,e,r){this.dbInfoCudCount.innerText=t+"/"+e+"/"+r},t.prototype.updateMoreDebugInfo=function(t){this.dbInfoMore.innerText=t},t.prototype.updateInfoState=function(){var e=this.client.getExperimentState(),r=t.experimentStateToString(e);this.cpInfoState.innerText=t.experimentStateToString(r),this.indicateCpErrorState("ERROR"==e),this.dpIndicatorState.style.fill=t.experimentStateToColor(e);"RUNNING"==e?this.dpIndicatorState.classList.add("dev-panel-state-indicator-running"):this.dpIndicatorState.classList.remove("dev-panel-state-indicator-running"),"ERROR"==e&&this.modelConsole.scrollDown()},t.prototype.indicateCpErrorState=function(t){t&&!this.isDevPanelOpen()?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getExperimentState()&&(this.openDevPanel(),this.openConsole(),this.indicateCpErrorState(!1))},t.prototype.updateModelTime=function(){var e=this.client.getExperimentState(),r=this.client.getModelTime();if(r>=0&&t.statesToShowTime.indexOf(e)>=0){var i=p.formatNumber(r,2,!1),n=i.indexOf("e");n<0?(this.dpInfoTimeInteger.innerText=i.substring(0,i.length-3),this.dpInfoTimeFraction.innerText=i.substring(i.length-3)):(this.dpInfoTimeInteger.innerText=i.substring(0,n),this.dpInfoTimeFraction.innerText=i.substring(n)),this.dpInfoDate.innerText=p.formatDate(this.client.getModelDate())}else r<0&&t.statesToShowTime.indexOf(e)>=0&&this.client.isSimulationExperiment()?(this.dpInfoTimeInteger.innerText="∞",this.dpInfoTimeFraction.innerText="",this.dpInfoDate.innerText="["+h.msg.DATE()+"]"):(this.dpInfoTimeInteger.innerText="-",this.dpInfoTimeFraction.innerText=".--",this.dpInfoDate.innerText="["+h.msg.DATE()+"]");this.execution.updateInfoPauseAt()},t.prototype.updateExperimentStep=function(){this.dpInfoStep.innerText=p.formatNumber(this.client.getExperimentStep(),0)},t.prototype.showTermsOfUse=function(){this.client.runningFromCloud()?window.open("https://www.anylogic.com/downloads/legal-info/"):this.displaySystemInfoFromFile("assets/standalone/anylogic-model-end-user-agreement.html","AnyLogic Model End User Agreement")},t.prototype.showAboutInfo=function(){var t=this;this.displaySystemInfoFromFile("assets/standalone/about-anylogic-model.html",h.msg.ABOUT_ANYLOGIC(),function(){var e="-";switch(t.client.getStartOrigin()){case"FROM_IDE":e=h.msg.RUNNING_FROM_IDE();break;case"STANDALONE":e=h.msg.RUNNING_AS_STANDALONE();break;case"CLOUD":e=h.msg.RUNNING_IN_CLOUD()}var r=t.client.getPlatform()+" "+t.client.getArchitecture();document.getElementById("about-created-with").innerText=h.msg.ABOUT_CREATED_WITH(),document.getElementById("about-and-contains").innerText=h.msg.ABOUT_AND_CONTAINS(),document.getElementById("about-the-model-is-running").innerText=h.msg.ABOUT_THE_MODEL_IS_RUNNING(),document.getElementById("about-the-model-is-running-info").innerText=e,document.getElementById("about-anylogic-version").innerText=h.msg.ABOUT_ANYLOGIC_VERSION(),document.getElementById("about-anylogic-version-info").innerText=t.anyLogicProductName(!0),document.getElementById("about-java-version").innerText=h.msg.ABOUT_JAVA_VERSION(),document.getElementById("about-java-version-info").innerText=t.client.getJavaVersion(),document.getElementById("about-platform").innerText=h.msg.ABOUT_PLATFORM(),document.getElementById("about-platform-info").innerText=r,document.getElementById("about-licensing-information").innerText=h.msg.ABOUT_LICENSING_INFORMATION(),document.getElementById("about-the-product-includes").innerText=h.msg.ABOUT_THE_PRODUCT_INCLUDES(),document.getElementById("about-uses-software").innerText=h.msg.ABOUT_USES_SOFTWARE(),document.getElementById("about-see-also").innerText=h.msg.ABOUT_SEE_ALSO(),document.getElementById("about-file-in-exported-model").innerText=h.msg.ABOUT_FILE_IN_EXPORTED_MODEL(),document.getElementById("about-file-in-installation").innerText=h.msg.ABOUT_FILE_IN_INSTALLATION()})},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=E.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed")),this.adjustControlPanelItemsVisibility()},t.prototype.toggleFullScreen=function(){this.client.runningFromCloud()?this.onToggleFullScreen&&this.onToggleFullScreen():E.toggleFullScreen(this.presentationContainer)},t.prototype.updateLagIndicator=function(){var e=this.client.frameDrawing.timeToPlay();if(e<t.OK_RESPONSE_TIME)this.cpIndicatorLag.setAttribute("visibility","hidden");else{this.cpIndicatorLag.setAttribute("visibility","inherit"),e>t.CRITICAL_RESPONSE_TIME?this.cpIndicatorLag.setAttribute("stroke","indianred"):this.cpIndicatorLag.removeAttribute("stroke");Math.min(e/t.CRITICAL_RESPONSE_TIME,1);var r=3+7*(e-t.OK_RESPONSE_TIME)/(t.CRITICAL_RESPONSE_TIME-t.OK_RESPONSE_TIME);this.cpIndicatorLag.firstElementChild.setAttribute("dur",r+"s")}},t.addArcIndicator=function(t,e,r){var i=document.getElementById("dev-panel-arc-indicator-template").cloneNode(!0);return i.setAttribute("transform","scale("+e+")"),i.firstElementChild.setAttribute("class",r),t.appendChild(i),i},t.setAcrIndicatorValue=function(t,e){e=Math.min(e,.999);var r=2*Math.PI*e,i=8.5*Math.sin(r),n=-8.5*Math.cos(r),a=e>.5?"1":"0";t.lastElementChild.setAttribute("d","M0 -8.5 A 8.5 8.5 0 "+a+" 1 "+i+" "+n)},t.setArcIndicatorValueStyle=function(t,e){t.lastElementChild.setAttribute("class",e)},t.setArcIndicatorBackgroundStyle=function(t,e){t.firstElementChild.setAttribute("class",e)},t.prototype.setupGlobalHotkeys=function(){var e=this;document.onkeydown=function(r){("F5"==r.key||"R"==r.key.toUpperCase()&&r.ctrlKey||"BrowserRefresh"==r.key)&&!e.client.runningFromCloud()?(r.preventDefault(),e.client.showFadingInfoLine(h.msg.WINDOW_REFRESH_DISABLED(),!0,"white","royalblue")):"Backspace"==r.key&&!t.backspaceInUse(r.target)||"BrowserBack"==r.key?(r.preventDefault(),e.client.isNavigationBackEnabled()&&e.modelNavigation.navigate("back")):" "!=r.key||t.spaceInUse(r.target)||(e.execution.canRun()?e.client.postUserCommand("run",""):e.execution.canPause()&&e.client.postUserCommand("pause",""))}},t.backspaceInUse=function(t){return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement},t.spaceInUse=function(t){return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement||t instanceof HTMLButtonElement},t.anyLogicEditionToString=function(t){switch(t){case"PROFESSIONAL":return"AnyLogic Professional";case"PLE":return"AnyLogic Personal Learning Edition";case"UNIVERSITY_RESEARCHER":return"AnyLogic University Researcher";case"EDUCATIONAL":return"AnyLogic Educational";default:return"AnyLogic "}},t.anyLogicEditionModificationToString=function(t){switch(t){case"EVALUATION":return h.msg.EVALUATION_USE_ONLY();case"DISTRIBUTOR":return h.msg.DISTRIBUTOR_DEMO_USE_ONLY();default:return}},t.toggleExpanded=function(t){var e="true"==t.getAttribute("expanded");t.setAttribute("expanded",(!e).toString())},t.experimentStateToString=function(t){switch(t){case"IDLE":return h.msg.STATE_IDLE();case"RUNNING":return h.msg.STATE_RUNNING();case"PAUSED":return h.msg.STATE_PAUSED();case"FINISHED":return h.msg.STATE_FINISHED();case"ERROR":return h.msg.STATE_ERROR();case"PLEASE_WAIT":return h.msg.STATE_PLEASE_WAIT();case"INITIALIZE":return h.msg.STATE_INITIALIZE();case"STOPPED":return h.msg.STATE_STOPPED();case"TIME_LIMIT":return h.msg.STATE_TIME_LIMIT();case"TERMINATED":return h.msg.STATE_TERMINATED()}return t},t.experimentStateToColor=function(t){switch(t){case"IDLE":return"DodgerBlue";case"RUNNING":return"Green";case"PAUSED":return"Orange";case"FINISHED":return"Black";case"ERROR":return"Red";case"PLEASE_WAIT":case"INITIALIZE":return"MediumPurple";case"STOPPED":return"Red";case"TIME_LIMIT":return"Black";case"TERMINATED":return"Red"}return"Gray"},t.memoryToString=function(t){return t<1024?t+h.msg.BYTES():t<1048576?p.formatNumber(Math.round(t/1024),1)+h.msg.KILOBYTES():p.formatNumber(Math.round(t/1048576),1)+h.msg.MEGABYTES()},t.setVisible=function(t,e,r){if(r){var i=t.getAttribute("hide-reasons");i||(i=""),e?""==(i=i.replace(r,""))&&t.style.removeProperty("display"):(i.indexOf(r)<0&&(i+=r),t.style.display="none"),t.setAttribute("hide-reasons",i)}else e?t.style.removeProperty("display"):t.style.display="none";return"none"!=t.style.display},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.prototype.setupActionAndTooltip=function(e,r){r&&(e.onclick=function(){t.isEnabled(e)&&r()}),this.setupTooltip(e)},t.setTooltip=function(t,e){t.setAttribute("tooltip",e)},t.prototype.setupTooltip=function(t){this.setupDynamicTooltip(t,function(t){var e=t.getAttribute("tooltip");return e?h.msg[e]():""})},t.prototype.setupDynamicTooltip=function(t,e){var r=this;p.isIOS()||(t.onmouseover=function(){var i=t.getBoundingClientRect(),n=e(t);r.client.showTooltip(n,i.left+10,i.top+10,"whitesmoke","dimgray")},t.onmouseout=function(){r.client.hideTooltip()})},t.assignActionOnEnterPressed=function(t,e){t.onkeydown=function(t){13==t.keyCode&&e()}},t.prototype.displaySystemInfoFromFile=function(t,e,r){var i=this;void 0===r&&(r=void 0),this.client.networkManager.getStaticFile(t,function(t){i.client.showMessageBox("system-info",e,t.responseText,!1),r&&!i.client.isStoppedAndShouldIgnoreResponses()&&r()})},t.prototype.atModelWindowSize=function(){var e=this.getWidthAndHeightTakenByPanels(),r=this.client.getWindowWidth(),i=this.client.getWindowHeight(),n=this.presentationContainer.getBoundingClientRect(),a=n.width,o=n.height;return Math.abs(a-(r+e.width))<t.WINDDOW_SIZE_TOLERANCE&&Math.abs(o-(i+e.height))<t.WINDDOW_SIZE_TOLERANCE},t.statesToShowTime=["RUNNING","PAUSED","FINISHED","ERROR","PLEASE_WAIT"],t.OK_RESPONSE_TIME=2,t.CRITICAL_RESPONSE_TIME=10,t.WINDDOW_SIZE_TOLERANCE=5,t}(),Sf=function(){function t(t){this.client=t}return t.prototype.getRestRoot=function(){return this.client.DEBUG_SPARK_LOCAL?"/http/":void 0!==this.client.getHost()?this.client.getHost()+"/nodes/"+this.client.getRestURL()+"sessions/"+this.client.getSessionUuid()+"/":"/uuid/"},t.prototype.getConfiguration=function(t){var e=this,r=new XMLHttpRequest;return r.onreadystatechange=function(){return e.onRequestReadyStateChange(r,t)},r.open("GET",this.getRestRoot()+"configuration",!0),r.send(),r},t.prototype.getAnimationPacket=function(t,e){var r=this,i=new XMLHttpRequest;return i.onreadystatechange=function(){return r.onRequestReadyStateChange(i,e)},i.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+performance.now(),!0),i.send(),i},t.prototype.postMaxFPS=function(t){var e=this,r=new XMLHttpRequest;r.onreadystatechange=function(){return e.onRequestReadyStateChange(r)},r.open("POST",this.getRestRoot()+"max-fps"),r.send(t.toString())},t.prototype.postUserAction=function(t,e,r){var i=this,n=new XMLHttpRequest;n.onreadystatechange=function(){return i.onRequestReadyStateChange(n,r)},n.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),n.send()},t.prototype.postUserCommand=function(t,e,r){var i=this,n=new XMLHttpRequest;n.onreadystatechange=function(){return i.onRequestReadyStateChange(n,r)},n.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),n.send()},t.prototype.uploadFile=function(t,e,r,i,n,a){var o=new FormData;o.append("file",e);var s=new XMLHttpRequest;s.upload.addEventListener("progress",r),s.upload.addEventListener("load",i),s.upload.addEventListener("error",function(t){return n("Upload error")}),s.upload.addEventListener("abort",function(t){return n("Upload aborted")}),s.onreadystatechange=function(){s.readyState==XMLHttpRequest.DONE&&200!=s.status&&n(s.responseText)},s.open("POST",this.getRestRoot()+a+"?id="+t+"&name="+encodeURIComponent(e.name)),s.send(o)},t.prototype.getInternalResource=function(t){return this.getRestRoot()+"internal-resources?path="+encodeURIComponent(t)},t.prototype.getResource=function(t,e){var r=new XMLHttpRequest;return r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&e(r)},r.open("GET",this.getRestRoot()+"resources?path="+encodeURIComponent(t),!0),r.send(),r},t.prototype.getStaticFile=function(t,e){var r=new XMLHttpRequest;return r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&e(r)},r.open("GET",encodeURIComponent(t),!0),r.send(),r},t.prototype.downloadFile=function(t){var e=document.createElement("a");e.setAttribute("href",this.getRestRoot()+"resources?path="+encodeURIComponent(t));var r=t.substring(t.lastIndexOf("/")+1);e.setAttribute("download",r),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)},t.prototype.onRequestReadyStateChange=function(t,e){if(!this.client.isStoppedAndShouldIgnoreResponses()&&t.readyState==XMLHttpRequest.DONE)if(200==t.status)e&&e(t);else if(0==t.status)this.client.stop("ERROR"),this.client.runningFromCloud()?this.client.showMessageBox("error",h.msg.BOX_TITLE_CONNECTION_LOST(),h.msg.BOX_TEXT_CONNECTION_LOST()):window.close();else if(403==t.status)this.client.showMessageBox("error",h.msg.FORBIDDEN(),t.responseText);else if(460==t.status)this.client.stop("TIME_LIMIT"),this.client.showMessageBox("message",h.msg.BOX_TITLE_ANIMATED_RUN_TIME_LIMIT(),h.msg.BOX_TEXT_ANIMATED_RUN_TIME_LIMIT()+"<a href='https://www.anylogic.com/features/cloud/#subscription' target='_blank'>"+h.msg.SUBSCRIPTION_OPTION()+"</a>.");else if(461==t.status){var r=t.responseText;this.client.stop("TERMINATED"),this.client.showMessageBox("error",h.msg.BOX_TITLE_FATAL_ERROR(),r)}else{r=t.responseText;this.client.showMessageBox("error",t.status+" "+h.msg.BOX_TITLE_ERROR(),r)}},t}(),Ef=function(){function t(t){this.client=t,this.responseTimeStatistics=new zp(kf.PACKET_STATISTICS_SIZE,kf.MIN_REQUEST_INTERVAL)}return t.prototype.start=function(){this.isStopped=!1,this.requestInterval=kf.MIN_REQUEST_INTERVAL,this.activeRequests=[],this.fullFrame=!0,this.serverQueue=0,this.responseTimeStatistics.reset(),this.requestPacketAndScheduleNext()},t.prototype.stop=function(){this.isStopped=!0,this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&(clearTimeout(this.requestTimeoutId),this.requestTimeoutId=void 0)},t.prototype.requestFullFrame=function(){this.fullFrame=!0},t.prototype.getRequestInterval=function(){return this.requestInterval},t.prototype.getServerQueue=function(){return this.serverQueue},t.prototype.averageResponseTime=function(){return this.responseTimeStatistics.linearWeightedAverage()},t.prototype.requestPacketAndScheduleNext=function(){var t=this;if(!this.isStopped){var e=this.client.networkManager.getAnimationPacket(this.fullFrame,function(e){return t.onResponseReceived(e)});this.fullFrame=!1,this.activeRequests.push(e),this.requestTimeoutId=setTimeout(function(){t.requestTimeoutId=void 0,t.activeRequests.length<kf.MAX_CONCURRENT_REQUESTS&&t.requestPacketAndScheduleNext()},this.requestInterval)}},t.prototype.onResponseReceived=function(t){if(!this.client.isStoppedAndShouldIgnoreResponses()){var e=this.activeRequests.indexOf(t);this.activeRequests.splice(e,1);var r=t.responseURL.indexOf("&time="),i=parseInt(t.responseURL.substring(r+6));this.responseTimeStatistics.add(performance.now()-i);var n=this.responseTimeStatistics.linearWeightedAverage();if(this.requestInterval=n/2,this.requestInterval=Math.max(kf.MIN_REQUEST_INTERVAL,this.requestInterval),this.requestInterval=Math.min(this.requestInterval,kf.MAX_REQUEST_INTERVAL),void 0===this.requestTimeoutId&&this.requestPacketAndScheduleNext(),200==t.status){var a=JSON.parse(t.responseText);if(this.client.packetManager.addPacket(a),this.serverQueue=a.serverQueue,d.isDebugMode()){var o=t.responseText.length;this.client.panels.updatePacketInfo(o,a.frames.length,a.fps)}}}},t}(),wf=function(){function t(t){this.client=t}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.cancelFrameLossRecoveryTimeout()},t.prototype.addPacket=function(t){if(t&&t.frames){var e=t.frames;if(0==e.length)return console.log("Animation: Got empty packet"),void this.client.frameDrawing.addPacket(t);var r=e[0].number;if(r<this.expectedFrameNumber)console.log("Animation: Got packet with outdated frame #"+r+", ignored it");else{if(r==this.expectedFrameNumber||e[0].fullFrame){var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),void this.cancelFrameLossRecoveryTimeout()}this.insertToPacketBuffer(t),console.log("Animation: Reordering  or packet loss, expecting frame #"+this.expectedFrameNumber,", got #"+r+", will wait more"),this.startFrameLossRecoveryTimeout()}}else console.log("Animation: Got ill-formed packet, ignored it")},t.prototype.requestAndWaitFullFrame=function(){console.log("Animation: Picture inconsistency. Requesting full frame"),this.client.packetRequester.requestFullFrame(),this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length){var t=this.packetBuffer[0].frames[0];if(!(t.number>=this.expectedFrameNumber)){var e=this.packetBuffer[this.packetBuffer.length-1],r=e.frames[e.frames.length-1];if(r.number>=this.expectedFrameNumber)return console.log("Animation: discarded "+this.packetBuffer.length+" packets with frames #"+t.number+".."+r.number),void(this.packetBuffer=[]);for(var i=0;i<this.packetBuffer.length&&!(this.packetBuffer[i].frames[0].number>=this.expectedFrameNumber);i++);console.log("Animation: discarded "+i+" packets with frames #"+t.number+".."+this.packetBuffer[i-1].frames[this.packetBuffer[i-1].frames.length-1].number),this.packetBuffer.splice(0,i)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length){var t=this.packetBuffer[0].frames[0];if(t.number==this.expectedFrameNumber){for(var e=this.expectedFrameNumber,r=0;r<this.packetBuffer.length;r++){var i=this.packetBuffer[r].frames;if(i[0].number!=e)break;e=i[i.length-1].number+1}console.log("Animation: got missing packet and drew "+r+" packets with frames #"+t.number+".."+this.packetBuffer[r-1].frames[this.packetBuffer[r-1].frames.length-1].number);var n=this.packetBuffer.splice(0,r);this.client.frameDrawing.addAllPackets(n),this.expectedFrameNumber=e}}},t.prototype.cancelFrameLossRecoveryTimeout=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startFrameLossRecoveryTimeout=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,console.log("Animation: Server response timeout. Requesting full frame"),t.client.packetRequester.requestFullFrame()},4*this.client.packetRequester.getRequestInterval()))},t}(),kf=function(){function t(){this.DEBUG_SPARK_LOCAL=!1,this.windowAdjusted=!1,this.svgBackLogo=document.getElementById("svg-background-logo"),this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new mf(this),this.navigation=new gf(this),this.panels=new Cf(this),this.networkManager=new Sf(this),this.packetRequester=new Ef(this),this.packetManager=new wf(this)}return t.prototype.start=function(t){var e=this;this.serverConnectionInfo=t,this.experimentState="INITIALIZE",this.networkManager.getConfiguration(function(t){var r=JSON.parse(t.responseText);e.onConfigurationReceived(r)}),this.startWaitKill()},t.prototype.onConfigurationReceived=function(t){this.isStoppedAndShouldIgnoreResponses()||(this.cancelWaitKill(),this.configuration=t,t&&t.debug&&d.setDebugMode(),this.runningFromCloud()||t.language&&h.setLanguage(t.language),this.navigation.start(),this.panels.start(),this.frameDrawing.start(),this.packetManager.reset(),this.packetRequester.start())},t.prototype.stop=function(t){this.experimentState=t,this.panels.updateExperimentState(),this.configuration&&(this.packetRequester.stop(),this.packetManager.reset(),this.frameDrawing.stop(),this.panels.stop(),this.navigation.stop(),d.removeAllChildren(this.presentation),d.isDebugMode()&&this.panels.updateShapeCount(d.getElementCount()),this.clearNavigationSettings(),this.windowAdjusted=!1,this.tooltipTimeoutId&&(clearTimeout(this.tooltipTimeoutId),clearTimeout(this.waitKillTimeoutId)))},t.prototype.setCallback=function(t,e){switch(t){case"ontogglefullscreen":this.panels.setOnToggleFullScreen(e);break;case"onstop":this.panels.setOnStop(e);break;case"onresize":this.panels.setOnResize(e)}},t.prototype.isStoppedAndShouldIgnoreResponses=function(){return"STOPPED"==this.experimentState||"TIME_LIMIT"==this.experimentState||"TERMINATED"==this.experimentState},t.prototype.startWaitKill=function(){var e=this;this.timeClientStarted=Date.now(),this.waitKillTimeoutId=setTimeout(function(){return e.displayWaitKillBox()},t.WAIT_KILL_TIMEOUT)},t.prototype.cancelWaitKill=function(){t.closeMessageBox(),clearTimeout(this.waitKillTimeoutId)},t.prototype.displayWaitKillBox=function(){var e=this,r=p.formatNumber(t.KILL_TIMEOUT/6e4,1);this.showMessageBox("wait","<span style='color: red'>"+h.msg.BOX_TITLE_WAIT_OR_KILL()+"</span>",h.msg.BOX_TEXT_WAIT_OR_KILL_OPTIONS()+"\n"+h.msg.BOX_TEXT_WAIT_OR_KILL_IF_DOES_NOT_START()+" "+r+" "+h.msg.BOX_TEXT_WAIT_OR_KILL_WILL_BE_KILLED()+"\n<span id='kill-the-model'  class='svg-message-box-link' style='color: red; font-weight: bold'>"+h.msg.BOX_TEXT_WAIT_OR_KILL_KILL()+"</span> ",!0,!1),document.getElementById("kill-the-model").addEventListener("click",function(){return e.killModel()}),this.updateWaitKillProgress()},t.prototype.updateWaitKillProgress=function(){var e=this,r=(Date.now()-this.timeClientStarted)/t.KILL_TIMEOUT;t.setMessageBoxProgress(Math.min(1,r)),r>=1?this.killModel():this.waitKillTimeoutId=setTimeout(function(){return e.updateWaitKillProgress()},2e3)},t.prototype.killModel=function(){t.closeMessageBox(),this.panels.execution.stopExperiment()},t.prototype.getHost=function(){return this.serverConnectionInfo?this.serverConnectionInfo.host:void 0},t.prototype.getRestURL=function(){return this.serverConnectionInfo?this.serverConnectionInfo.restUrl:void 0},t.prototype.getSessionUuid=function(){return this.serverConnectionInfo?this.serverConnectionInfo.sessionUuid:void 0},t.prototype.runningFromCloud=function(){return!!this.configuration&&"CLOUD"==this.configuration.startOrigin},t.prototype.getStartOrigin=function(){return this.configuration?this.configuration.startOrigin:"-"},t.prototype.getAnyLogicEdition=function(){return this.configuration?this.configuration.edition:"-"},t.prototype.getAnyLogicEditionModification=function(){return this.configuration?this.configuration.editionModification:"-"},t.prototype.getAnyLogicVersion=function(){return this.configuration?this.configuration.version:"-"},t.prototype.getAnyLogicVersionModification=function(){return this.configuration?this.configuration.versionModification:"-"},t.prototype.getJavaVersion=function(){return this.configuration?this.configuration.javaVersion:"-"},t.prototype.getPlatform=function(){return this.configuration?this.configuration.platform:"-"},t.prototype.getArchitecture=function(){return this.configuration?this.configuration.architecture:"-"},t.prototype.isDevPanelEnabled=function(){return!this.configuration||this.configuration.developerPanelEnabled},t.prototype.isDevPanelVisibleOnStart=function(){return!this.configuration||this.configuration.developerPanelVisibleOnStart},t.prototype.setExperimentSettings=function(t,e,r,i,n,a,o,s,l,u){this.experimentType=t,this.experimentName=e,this.maxMemory=r,this.timeUnit=i,this.startTime=n,this.startDate=a,this.stopTime=o,this.stopDate=s,this.runControlEnabled=l,this.speedControlEnabled=u,this.panels.updateExperimentSettings()},t.prototype.getExperimentType=function(){return this.experimentType},t.prototype.isSimulationExperiment=function(){return"simulation"==this.experimentType},t.prototype.getExperimentName=function(){return this.experimentName},t.prototype.getExperimentMaxMemory=function(){return this.maxMemory},t.prototype.getTimeUnit=function(){return this.timeUnit},t.prototype.getStartTime=function(){return this.startTime},t.prototype.getStartDate=function(){return new Date(this.startDate)},t.prototype.toModelDate=function(t){var e=t-this.startTime;return new Date(this.startDate+this.toMilliseconds(e))},t.prototype.getModelDate=function(){return this.toModelDate(this.modelTime)},t.prototype.toMilliseconds=function(t){return p.toMilliseconds(t,this.timeUnit)},t.prototype.toModelTimeUnits=function(t,e){return p.toMilliseconds(t,e)/this.toMilliseconds(1)},t.prototype.isRunControlEnabled=function(){return this.runControlEnabled},t.prototype.isSpeedControlEnabled=function(){return this.speedControlEnabled},t.prototype.updateExperimentState=function(t){t.state!=this.experimentState&&(this.experimentState=t.state,this.panels.updateExperimentState()),this.experimentStep=t.step,this.serverRealTime=t.realTime,this.freeMemory=t.freeMemory,null==t.numConnections&&(t.numConnections=0),t.numConnections!=this.numConnections&&(this.numConnections=t.numConnections,this.panels.updateNetworkConnections()),null==t.multiRunProgress&&(t.multiRunProgress=[]),t.progress==this.experimentProgress&&t.multiRunProgress==this.multiRunProgress||(this.experimentProgress=t.progress,this.multiRunProgress=t.multiRunProgress,this.panels.updateExperimentProgress()),this.modelTime=t.time,t.timeScale<0&&(t.timeScale=1/0),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.panels.updateModelTimeScale()),this.panels.modelConsole.update(t.consoleUpdate),this.panels.eventsView.update(t.eventInfo)},t.prototype.getExperimentState=function(){return this.experimentState},t.prototype.getModelTime=function(){return this.modelTime},t.prototype.getExperimentStep=function(){return this.experimentStep},t.prototype.getModelTimeScale=function(){return this.modelTimeScale},t.prototype.getExperimentProgress=function(){return this.experimentProgress},t.prototype.getMultiRunProgress=function(){return this.multiRunProgress},t.prototype.getServerRealTime=function(){return this.serverRealTime},t.prototype.getExperimentFreeMemory=function(){return this.freeMemory},t.prototype.getNetworkConnectionsCount=function(){return this.numConnections},t.prototype.setNavigationSettings=function(t,e,r,i,n,a,o,s,l,u,c){var h=this.windowX!=t||this.windowY!=e||this.windowWidth!=r||this.windowHeight!=i||this.zoomAndPanningEnabled!=n||this.navigationBackEnabled!=a||this.viewTitle!=o||this.viewAreas.toString()!=s.toString()||this.presentable.toString()!=l.toString();!this.panels.isDevPanelOpen()||null==l||null!=this.presentable&&this.presentable.toString()==l.toString()||this.showFadingInfoLine(l.toString().replace(/,/g,".")),!h&&c||(this.windowX=t,this.windowY=e,this.windowWidth=r,this.windowHeight=i,this.zoomAndPanningEnabled=n,this.navigationBackEnabled=a,this.viewTitle=o,this.viewAreas=s,this.presentable=l,this.nextLevelAgents=u,this.windowAdjusted||(this.panels.resizeWindowToFitModelNativeSize(),this.windowAdjusted=!0),this.navigation.applyNavigationSettings()),this.panels.modelNavigation.update()},t.prototype.clearNavigationSettings=function(){this.windowX=void 0,this.windowY=void 0,this.windowWidth=void 0,this.windowHeight=void 0,this.zoomAndPanningEnabled=void 0,this.navigationBackEnabled=void 0,this.viewTitle=void 0,this.viewAreas=void 0,this.presentable=void 0,this.nextLevelAgents=void 0,this.panels.modelNavigation.update()},t.prototype.getWindowX=function(){return this.windowX},t.prototype.getWindowY=function(){return this.windowY},t.prototype.getWindowWidth=function(){return this.windowWidth},t.prototype.getWindowHeight=function(){return this.windowHeight},t.prototype.isZoomAndPanningEnabled=function(){return this.zoomAndPanningEnabled},t.prototype.isNavigationBackEnabled=function(){return this.navigationBackEnabled},t.prototype.getViewTitle=function(){return this.viewTitle},t.prototype.getViewAreas=function(){return this.viewAreas},t.prototype.getPresentable=function(){return this.presentable},t.prototype.getNextLevelAgents=function(){return this.nextLevelAgents},t.prototype.postUserAction=function(t,e){this.networkManager.postUserAction(t,e)},t.prototype.postUserCommand=function(t,e){this.networkManager.postUserCommand(t,e)},t.prototype.showTooltip=function(t,e,r,i,n){var a=this;if(t&&""!=t){var o=document.getElementById("presentation-tooltip");o.innerText=t;var s=o.offsetWidth,l=o.offsetHeight;o.style.left=Math.max(0,e-s-1)+"px",o.style.top=Math.max(0,r-l-1)+"px",o.style.backgroundColor=i,o.style.color=n,o.className="presentation-tooltip-shown",clearTimeout(this.tooltipTimeoutId),this.tooltipTimeoutId=setTimeout(function(){return a.hideTooltip()},2e3)}},t.prototype.hideTooltip=function(){document.getElementById("presentation-tooltip").className="presentation-tooltip-hidden",clearTimeout(this.tooltipTimeoutId)},t.prototype.openURL=function(t){t.startsWith("http://")||t.startsWith("https://")||(t="http://"+t),this.showMessageBox("message",h.msg.BOX_TITLE_OPEN_URL(),h.msg.ASK_OPEN_URL()+":<br><a href="+t+" target = '_blank' onclick = 'document.getElementById( \"svg-message-background\" ).style.display = \"none\"'>"+t+"</a><br><br>"+h.msg.URL_OPENS_IN_NEW_WINDOW())},t.prototype.copyToClipboard=function(e){var r="allow-copy-to-clipboard";this.showMessageBox("message",h.msg.BOX_TITLE_CLIPBOARD_ACCESS(),h.msg.BOX_TEXT_COPY_TO_CLIPBOARD()+"\n<span id='"+r+"'  class='svg-message-box-link'>"+h.msg.BOX_TEXT_COPY_TO_CLIPBOARD_ALLOW()+"</span> "+h.msg.BOX_TEXT_COPY_TO_CLIPBOARD_REJECT()),document.getElementById(r).addEventListener("click",function(){p.copyToClipboard(e),t.closeMessageBox()})},t.prototype.showMessageBox=function(e,r,i,n,a){var o=this;void 0===n&&(n=!0),void 0===a&&(a=!0);var s=document.getElementById("svg-message-background"),l=document.getElementById("svg-message-box"),u=document.getElementById("svg-message-box-header"),c=document.getElementById("svg-message-box-title"),d=document.getElementById("svg-message-box-text"),p=document.getElementById("svg-message-box-icon-use"),f=document.getElementById("svg-message-box-close"),m=document.getElementById("svg-message-box-progress"),g=e.startsWith("error"),v=e.startsWith("system-info"),b=e.startsWith("wait"),y=a?"dev-panel-control":"dev-panel-control-disabled",A=a?"dev-panel-control-disabled":"dev-panel-control";f.classList.contains(y)||f.classList.add(y),f.classList.remove(A),f.onclick=a?function(){t.closeMessageBox()}:void 0,a&&!g?(s.onclick=function(e){e.target==s&&t.closeMessageBox()},s.onkeydown=function(e){"Escape"==e.code&&t.closeMessageBox()}):(s.onclick=void 0,s.onkeydown=void 0);var T="svg-message-box-colors-info",C="#dev-panel-icon-info";(g?(T="svg-message-box-colors-error",C="#dev-panel-icon-error"):v?C="#control-panel-icon-anylogic-logo":b&&(T="svg-message-box-colors-wait",C="#dev-panel-icon-wait"),u.className=T,p.setAttribute("href",C),p.setAttribute("xlink:href",C),c.innerHTML=r&&""!=r?r:g?h.msg.BOX_TITLE_ERROR():v?h.msg.SYSTEM_INFORMATION()+" ":h.msg.BOX_TITLE_MESSAGE(),n&&(i=i.replace(/\n/g,"<br>")),g&&(i+="<br><br>"+h.msg.FOR_MORE_DETAILS_SEE()+" <span id='svg-message-box-open-console' class='svg-message-box-link'>"+h.msg.SEE_CONSOLE()+"</span>"),d.innerHTML=i,g)&&(document.getElementById("svg-message-box-open-console").onclick=function(){s.style.display="none",o.panels.openDevPanel(),o.panels.openConsole(),o.panels.modelConsole.scrollDown()});if(b?(m.style.removeProperty("display"),m.removeAttribute("value")):m.style.display="none",this.runningFromCloud()){var S=document.getElementById("svg-and-dev-panel-container").parentElement.getBoundingClientRect();l.style.maxWidth=Math.round(.8*S.width)+"px",l.style.maxHeight=Math.round(.8*S.height)+"px"}s.style.removeProperty("display"),a&&!g&&s.focus()},t.setMessageBoxHTML=function(t,e){void 0===e&&(e=!0);var r=document.getElementById("svg-message-box-text");e&&(t=t.replace(/\n/g,"<br>")),r.innerHTML=t},t.getMessageBoxHTML=function(){return document.getElementById("svg-message-box-text").innerHTML},t.setMessageBoxProgress=function(t){var e=document.getElementById("svg-message-box-progress");t>=0?e.value=Math.round(100*t):e.removeAttribute("value")},t.closeMessageBox=function(){document.getElementById("svg-message-background").style.display="none"},t.prototype.showFadingInfoLine=function(t,e,r,i){var n=this;void 0===e&&(e=!0),void 0===r&&(r=null),void 0===i&&(i=null);var a=document.getElementById("svg-fading-info-line");a.innerText=t,null!=r?a.style.color=r:a.style.removeProperty("color"),null!=i?a.style.backgroundColor=i:a.style.removeProperty("background-color"),a.className="svg-fading-info-line-shown",clearTimeout(this.fadingInfoLineTimeoutId),e&&(this.fadingInfoLineTimeoutId=setTimeout(function(){return n.hideFadingInfoLine()},1e3))},t.prototype.hideFadingInfoLine=function(){document.getElementById("svg-fading-info-line").className="svg-fading-info-line-hidden",clearTimeout(this.fadingInfoLineTimeoutId)},t.PACKET_STATISTICS_SIZE=10,t.MAX_FPS=40,t.START_FPS=15,t.MIN_FPS=.2,t.MIN_REQUEST_INTERVAL=250,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_CONCURRENT_REQUESTS=2,t.WAIT_KILL_TIMEOUT=2e4,t.KILL_TIMEOUT=3e5,t}(),xf=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(t){var e=this;d.setDebugMode(),this.client.DEBUG_SPARK_LOCAL=t,t&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return e.onNewModelSelected()})},t.prototype.stop=function(){this.modelSelector&&(this.modelSelector.onchange=void 0)},t.prototype.onNewModelSelected=function(){var t=this;if(this.client.getExperimentState()&&this.client.stop("TERMINATED"),"NO MODEL SELECTED"==this.modelSelector.value)this.client.networkManager.postUserCommand("close","");else{var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&t.client.start({})},e.open("GET","/http/start?path="+this.modelSelector.value,!0),e.send()}},t}(),Mf=function(){function t(){}return t.createClient=function(){return new kf},t.createDebugger=function(){return new xf(new kf)},t}(),Of=function(){function t(t,e,r){if(void 0===t||void 0===e||void 0===r)throw new Error("Illegal argument");this.major=t,this.minor=e,this.extra=r}return t.prototype.compare=function(t){var e;return 0!=(e=this.major-t.major)?e:0!=(e=this.minor-t.minor)?e:e=this.extra-t.extra},t.prototype.between=function(t,e){return this.compare(t)>=0&&this.compare(e)<=0},t.prototype.greaterOrEquals=function(t){return this.compare(t)>=0},t.fromString=function(e){var r=e.split(".");return new t(Number(r[0]),Number(r[1]),Number(r[2]))},t.VERSION_8_0_0=new t(8,0,0),t.VERSION_8_0_1=new t(8,0,1),t.VERSION_8_0_4=new t(8,0,4),t.VERSION_8_0_5=new t(8,0,5),t.VERSION_8_1_0=new t(8,1,0),t.VERSION_8_2_0=new t(8,2,0),t.VERSION_8_3_0=new t(8,3,0),t}(),If=function(){function t(){}return t.createClient=function(t){var e=Of.fromString(t);if(e.greaterOrEquals(Of.VERSION_8_3_0))return Mf.createClient();if(e.greaterOrEquals(Of.VERSION_8_2_0))return Up.createClient();if(e.greaterOrEquals(Of.VERSION_8_1_0))return ap.createClient();if(e.greaterOrEquals(Of.VERSION_8_0_5))return jt.createClient();if(e.greaterOrEquals(Of.VERSION_8_0_4))return gt.createClient();if(e.greaterOrEquals(Of.VERSION_8_0_0))return U.createClient();throw new Error("SVG: Incorrect version: "+t)},t.createDebugger=function(t){var e=Of.fromString(t);if(e.greaterOrEquals(Of.VERSION_8_3_0))return Mf.createDebugger();if(e.greaterOrEquals(Of.VERSION_8_2_0))return Up.createDebugger();if(e.greaterOrEquals(Of.VERSION_8_1_0))return ap.createDebugger();if(e.greaterOrEquals(Of.VERSION_8_0_5))return jt.createDebugger();if(e.greaterOrEquals(Of.VERSION_8_0_4))return gt.createDebugger();if(e.greaterOrEquals(Of.VERSION_8_0_0))return U.createDebugger();throw new Error("SVG: Incorrect version: "+t)},t}();window.SVGFactory=If}]);